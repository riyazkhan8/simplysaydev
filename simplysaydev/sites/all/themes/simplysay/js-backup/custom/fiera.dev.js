/*! Fiera.js Copyright 2016, www.homeTLT.ru (Denis Ponomarev <ponomarevtlt@gmail.com>) */
var fiera =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 8);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

module.exports = fabric;

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var utils = __webpack_require__(2);
utils.object = __webpack_require__(3);
utils.compile = __webpack_require__(5);

function capitalize(string, firstLetterOnly) {
  return string.charAt(0).toUpperCase() + (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());
}

function toDashed(str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
}

var Toolbar = function Toolbar(PARENT, el, menu, options) {
  this.initialize(PARENT, el, menu, options);
};

Toolbar._getKeyString = function (config) {
  var string = "";

  if (config.ctrlKey) string += "Ctrl + ";
  if (config.altKey) string += "Alt + ";
  if (config.shiftKey) string += "Shift + ";

  var _code = config.key;
  if (_code) {
    string += config.key;
  }
  return string;
};

Toolbar.makeActions = function (actions, PARENT) {
  var result = {};
  for (var i in actions) {
    actions[i].id = i;
    var _action = this.makeAction(actions[i], PARENT);
    if (_action) {
      result[i] = _action;
    }
  }
  return result;
};

Toolbar.makeAction = function (original, parent) {
  var _ORIGINAL = original;
  var target;

  if (original.constructor === Function) {
    _ORIGINAL = original.call(parent);
  }

  if (_ORIGINAL.target && _ORIGINAL.target.constructor === Function) {
    target = _ORIGINAL.target.call(parent);
  } else {
    target = _ORIGINAL.target || parent;
  }

  var ___target = _ORIGINAL.target;
  var ___parent = _ORIGINAL.parent;
  delete _ORIGINAL.parent;
  delete _ORIGINAL.target;

  var RES = utils.object.cloneDeep(_ORIGINAL);
  _ORIGINAL.parent = ___parent;
  _ORIGINAL.target = ___target;

  RES.parent = ___parent;
  RES.target = target;
  RES.id = toDashed(_ORIGINAL.id);

  function createGetter(property, useParent) {
    if (property.constructor === Function) {
      return property;
    }
    if (property.constructor === String) {
      var negative = false;
      if (property[0] === "!") {
        property = property.substr(1);
        negative = true;
      }
      if (useParent) {
        return function () {
          if (this[property].constructor === Function) {
            return !!this[property]() ^ negative;
          } else {
            return !!this[property] ^ negative;
          }
        };
      } else {
        return function () {
          if (this[property].constructor === Function) {
            return !!this[property]() ^ negative;
          } else {
            return !!this[property] ^ negative;
          }
        };
      }
    }
    return null;
  }

  /*var _insert = _ORIGINAL.insert;
  if (!_insert || _insert.constructor == String) {
     if(_ORIGINAL.parent){
      var insertproperty = fabric.util.string.capitalize(fabric.util.string.camelize(_ORIGINAL.parent.id))
    }else{
      var insertproperty = _insert || "insert" + fabric.util.string.capitalize(id,true);
    }
     if(target[insertproperty] !== undefined){
      _insert = target[insertproperty]// createGetter(insertproperty,true)()
    }else{
      _insert = true;
    }
  }
   if(!_insert)return;*/

  if (!RES.type) {
    if (RES.menu) {
      RES.type = "menu";
    } else {
      RES.type = "button";
    }
  }
  if (!RES.action) {
    if (RES.type === "button" || RES.type === "key") {
      RES.action = _ORIGINAL.id;
    }
  }

  if (RES.action) {
    if (RES.action.constructor === String) {
      RES.action = target[RES.action];
    }
    //RES = RES.action.bind(target);
    //RES.action = RES.action.bind(target);
    //_.extend(RES, _act);
    //arguments for action function
    if (_ORIGINAL.args) {
      RES._action = RES.action.bind(target, _ORIGINAL.args);
    } else {
      RES._action = RES.action.bind(target);
    }
    RES.action = function () {
      if (RES.disabled) return;
      RES._action.apply(this, arguments);
    };
  }

  if (_ORIGINAL.menu && _ORIGINAL.menu.constructor === Function) {
    RES.menu = _ORIGINAL.menu.bind(target);
  }
  if (_ORIGINAL.active) {
    RES.active = createGetter(_ORIGINAL.active).bind(target);
  }
  if (_ORIGINAL.visible) {
    RES.visible = createGetter(_ORIGINAL.visible).bind(target);
  }
  if (_ORIGINAL.enabled) {
    RES.enabled = createGetter(_ORIGINAL.enabled).bind(target);
  }
  if (!_ORIGINAL.value) {
    switch (_ORIGINAL.type) {
      case "color":
      case "text":
      case "number":
      case "range":
      case "label":
      case "select":
      case "checkbox":
        _ORIGINAL.value = _ORIGINAL.id;
      // console.log(id, _ORIGINAL);
    }
  }
  if (_ORIGINAL.value) {
    var _set, _get, _options;
    if (_ORIGINAL.value.constructor === String) {

      var setFunctionName = "set" + capitalize(_ORIGINAL.value, true),
          getFunctionName = "get" + capitalize(_ORIGINAL.value, true),
          minName = "min" + capitalize(_ORIGINAL.value, true),
          maxName = "max" + capitalize(_ORIGINAL.value, true),
          setFoo = function setFoo(val) {
        target[setFunctionName](val);
        // todo self.setFunctionCallback(target);
      },
          getFoo = target[getFunctionName],
          minFoo = target[minName],
          maxFoo = target[maxName];

      _set = setFoo || (_ORIGINAL.args ? function (val, args) {
        this[_ORIGINAL.value][args] = val;
      } : function (val) {
        this[_ORIGINAL.value] = val;
      });

      _get = getFoo || (_ORIGINAL.args ? function (args) {
        return this[_ORIGINAL.value][args];
      } : function () {
        return this[_ORIGINAL.value];
      });

      RES.value = {
        min: minFoo,
        max: maxFoo
      };
    } else {
      _set = _ORIGINAL.value.set;
      _get = _ORIGINAL.value.get;
      _options = _ORIGINAL.value.options;
    }

    if (RES.value.min !== undefined && RES.value.min.constructor === String) {
      RES.value.min = target[RES.value.min];
    }
    if (RES.value.max !== undefined && RES.value.max.constructor === String) {
      RES.value.max = target[RES.value.max];
    }
    if (RES.value.step !== undefined && RES.value.step.constructor === String) {
      RES.value.step = target[RES.value.step];
    }
    var _min = RES.value.min,
        _max = RES.value.max,
        _step = RES.value.step;

    if (_set) {
      RES.value.set = _ORIGINAL.args ? _set.bind(target, _ORIGINAL.args) : _set.bind(target);
    }
    if (_get) {
      RES.value.get = _ORIGINAL.args ? _get.bind(target, _ORIGINAL.args) : _get.bind(target);
    }
    if (_min && _min.constructor === Function) {
      RES.value.min = _ORIGINAL.args ? _min.bind(target, _ORIGINAL.args) : _min.bind(target);
    }
    if (_max && _max.constructor === Function) {
      RES.value.max = _ORIGINAL.args ? _max.bind(target, _ORIGINAL.args) : _max.bind(target);
    }
    if (_step && _step.constructor === Function) {
      RES.value.step = _ORIGINAL.args ? _step.bind(target, _ORIGINAL.args) : _step.bind(target);
    }
    if (_options) {
      RES.value.options = _ORIGINAL.args ? _options.bind(target, _ORIGINAL.args) : _options.bind(target);
    }
  }

  if (_ORIGINAL.data) {
    RES.data = _ORIGINAL.data.call(target);
  }
  if (RES.menu) {
    if (_ORIGINAL.menu.constructor === Function) {
      RES.menu = _ORIGINAL.menu.call(target);
    }
    if (RES.type === "options") {
      for (var i in RES.menu) {
        RES.menu[i].parent = RES;
        RES.menu[i].type = "option";
        if (!RES.menu[i].title) {
          RES.menu[i].title = i;
        }
        if (!RES.menu[i].option) {
          RES.menu[i].option = i;
        }
      }
    }
    for (var i in RES.menu) {
      if (RES.menu[i].constructor === String) {
        RES.menu[i] = RES.target._getActionValue(RES.menu[i]);
        RES.menu[i].parent = RES;
      }
      if (!RES.menu[i].id) {
        RES.menu[i].id = i;
      }
      RES.menu[i] = Toolbar.makeAction(RES.menu[i], target);
      if (!RES.menu[i]) {
        delete RES.menu[i];
      }
    }
  }

  if (_ORIGINAL.keyboard !== false && (_ORIGINAL.key || _ORIGINAL.keyCode || _ORIGINAL.shiftKey || _ORIGINAL.altKey || _ORIGINAL.ctrlKey || _ORIGINAL.metaKey)) {
    if (_ORIGINAL.key && _ORIGINAL.key.length == 1) {
      RES.ctrlKey = true;
    }
    if (_ORIGINAL.keyCode && _ORIGINAL.keyCode.constructor === String) {
      RES.keyCode = _ORIGINAL.keyCode.toUpperCase().charCodeAt(0);
      RES.key = String.fromCharCode(RES.keyCode);
    }
    RES.keyboard = true;
  }

  return RES;
};

Toolbar.getButtons = function (actions) {
  var _buttons = [];
  for (var i in actions) {
    var action = actions[i];
    if (action.keyboard) {
      action.title += " (" + Toolbar._getKeyString(action) + ")";
      _buttons.push(action);
    }
    if (actions.menu) {
      _buttons = _buttons.concat(Toolbar.getButtons(actions.menu));
    }
  };

  return _buttons;
};
Toolbar.prototype = {
  initKeys: function initKeys(actions) {
    this.buttons = Toolbar.getButtons(actions);
    this.__keydownHandler = this.handleKeydown.bind(this);
    $(document).on("keydown", this.__keydownHandler);

    //$(window).on("mousewheel", function (event) {
    //  for (var i in self.buttons) {
    //    var data = self.buttons[i];
    //    if (!data.mousewheel)continue;
    //    if (!data.ctrlKey || data.ctrlKey && event.ctrlKey) {
    //      if (event.deltaY > 0 && data.mousewheel == ">") {
    //        data.action.call(target, data.option || event, event)
    //      }
    //      if (event.deltaY < 0 && data.mousewheel == "<") {
    //        data.action.call(target, data.option || event, event)
    //      }
    //      event.preventDefault();
    //      event.stopPropagation();
    //      return false;
    //    }
    //  }
    //});
  },
  handleKeydown: function handleKeydown(e) {
    for (var i in this.buttons) {
      var _config = this.buttons[i];

      if (_config.enabled && !_config.enabled()) {
        continue;
      }
      if (_config.disabled || _config.disabled) {
        continue;
      }
      if (!_config.disabled && !_config.hidden && (_config.keyCode == e.keyCode || _config.key == e.key) && (_config.ctrlKey === undefined || _config.ctrlKey == e.ctrlKey) && (_config.altKey === undefined || _config.altKey == e.altKey) && (_config.shiftKey === undefined || _config.shiftKey == e.shiftKey) && (_config.metaKey === undefined || _config.metaKey == e.metaKey)) {

        e.preventDefault();
        e.stopPropagation();
        if (_config.option !== undefined) {
          _config.action.call(_config.target, _config.option, e);
        } else {
          _config.action.call(_config.target, e);
        }
      }
    }
  },
  tools: {
    "key": {},
    "label": {
      scope: function scope(data, options) {
        return {
          getValue: data.value.get,
          valueCurrent: data.value.get()
        };
      },
      template: '<div class="object-menu-item object-menu-label" title="{title}">',
      render: function render($item, data, options, tool, val) {
        var scope = fabric.util.object.defaults(tool.scope.call(this, data, options), data);
        $item.html(data.template.format(data.value.get()));
        utils.compile.compileElement($item, scope);
      }
    },
    "number": {
      scope: function scope(data, options) {
        return {
          getInputValue: function getInputValue() {
            return parseFloat(data.$item.find("input").val());
          },
          getValue: data.value.get,
          setValue: data.value.set,
          minValue: data.value.min && data.value.min(),
          maxValue: data.value.max && data.value.max(),
          valueCurrent: data.value.get(),
          onchange: function onchange(e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        };
      },
      template: '<div class="object-menu-item object-menu-number" title="{title}">' + '<input type="number" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "range": {
      scope: function scope(data, options) {
        return {
          minValue: data.value.min ? typeof data.value.min == "function" ? data.value.min() : data.value.min : 0,
          maxValue: data.value.max ? typeof data.value.max == "function" ? data.value.max() : data.value.max : 1,
          valueStep: data.value.step ? typeof data.value.step == "function" ? data.value.step() : data.value.step : 0.1,
          valueCurrent: data.value.get(),
          onchange: function onchange(e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        };
      },
      template: '<div class="object-menu-item object-menu-range" title="{title}">' + '<input type="range" step="{valueStep}" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "checkbox": {
      scope: function scope(data, options) {
        return {
          onchange: function onchange(e) {
            data.value.set(e.target.checked);
          },
          valueCurrent: data.value.get()
        };
      },
      template: '<div class="object-menu-item object-menu-checkbox" title="{title}">\n          <input type="checkbox" onchange="onchange(event)" dp-checked="{valueCurrent}" id="checkbox-{id}">\n          <label for="checkbox-{id}"  class="btn button-{id} {className}">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(val);
      }
    },
    "menu": {
      template: '<div class="object-menu-item object-menu-menu" title="{title}">\n          <label dp-if="title" for="button-{id}">{title}</label>\n          <button class="btn button-menu-trigger button-{id} {className}" id="button-{id}"/>\n          <div class="object-menu submenu" style="display: none;" transclude/>',
      post: function post($item, data, options, transclude) {
        $item.find(".button-menu-trigger").click(function () {
          $item.find(".object-menu").toggle();
        });
        if (data.hovered) {
          $item.addClass("hovered");
          this.toggleByHover($item, transclude, null, data);
        }
        if (data.toggled) {
          $item.addClass("toggled");
          this.toggleByButton($item, transclude);
        };
        this.generateMenu(data.target, transclude, options, data.menu);
      }
    },
    "button": {
      scope: function scope(data, options) {
        return {
          buttonsTitle: options.buttons && options.buttons.title || false,
          buttonscClassName: options.buttons && options.buttons.className || ''
        };
      },
      template: '<div class="object-menu-item" title="{title}">\n          <button class="btn button-{id} {className} {buttonscClassName}"  onclick="!disabled && option ? action(option) : action()">\n          <img dp-if="icon" dp-src="icon">\n          <span dp-include="svg" dp-if="svg"></span>\n          <span dp-if="buttonsTitle" class="button-title">{title}</span>'
    }
  },
  initialize: function initialize(PARENT, el, menu, options) {
    this.buttons = [];
    //todo это не совсем хорошо. нельзя создать улбраы с разными конфигами кнопок
    // this.tools = utils.object.cloneDeep(this.tools);


    this.options = options || {};
    // if (options) {
    //   if (options.button) {
    //     utils.object.extend(this.tools.button, options.button);
    //   }
    // }
    // if (!PARENT.generatedActions) {
    //   PARENT.makeActions( menu);
    // }

    if (el.constructor === String) {
      this.container = $(document.getElementById(el));
    } else {
      this.container = el;
    }
    if (this.container) {
      this.generateMenu(PARENT, this.container, options, menu);
      this.container.show();
    }
    this.initKeys(PARENT.generatedActions);
  },
  destroy: function destroy(target) {
    for (var i = this.buttons.length; i--;) {
      var _config = this.buttons[i];
      if (target && _config.target != target) {
        continue;
      }
      this.buttons.splice(i, 1);
    }

    if (this.__keydownHandler) {
      $(document).off("keydown", this.__keydownHandler);
    }
    this.fire("destroy");
  },
  createInput: function createInput($item, data, type) {

    var target = data.target;
    var $input = $("<input>").attr("type", type).attr("min", data.value.min()).attr("max", data.value.max());

    $input.val(data.value.get());
    if (data.value.observe) {
      var _foo = function _foo(val) {
        $input.val(data.value.get());
      };
      target.on(data.value.observe, _foo);
      this.on("destroy", function () {
        target.off(data.value.observe, _foo);
      });
    }
    $input.change(function (e) {
      data.value.set(parseFloat($input.val()));
    });
    $item.append($input);
  },
  initItem: function initItem($item, data) {

    if (data.active) {
      if (data.active.call(data.target, data.option)) {
        $item.addClass("active");
      }
    }

    if (data.visible !== undefined) {
      if (data.visible.constructor == Function) {
        if (!data.visible.call(data.target)) {
          $item.hide();
        }
      } else if (!data.visible) {
        $item.hide();
      }
    }

    data.disabled = false;
    if (data.enabled !== undefined) {
      if (data.enabled.constructor == Function) {
        if (!data.enabled.call(data.target)) {
          $item.attr("disabled", true);
          data.disabled = true;
        }
      }
    }

    if (data.observe && data.target) {
      //todo
      if (data.visible && data.visible.constructor == Function) {
        var visibleObserveCallback = function visibleObserveCallback() {
          if (!data.visible.call(data.target)) {
            $item.hide();
            data.hidden = true;
          } else {
            $item.show();
            data.hidden = false;
          }
        };

        if (data.observe.constructor === String) {
          data.target && data.target.on(data.observe, visibleObserveCallback);
        } else {
          data.observe.call(data.target, visibleObserveCallback);
        }
      }

      if (data.type == "options") {
        data.target && data.target.on(data.observe, function () {
          var _val = data.value.get();
          $("[name=" + data.id + "]").prop("checked", false);
          $("[name=" + data.id + "][value=" + _val + "]").prop("checked", true);
        });
      }

      if (data.enabled && data.enabled.constructor == Function) {
        var enabledObserveCallback = function enabledObserveCallback() {
          if (!data.enabled.call(data.target)) {
            $item.attr("disabled", true);
            data.disabled = true;
          } else {
            $item.removeAttr("disabled");
            data.disabled = false;
          }
        };

        data.enableCallback = enabledObserveCallback;
        if (data.observe.constructor === String) {
          data.target && data.target.on(data.observe, enabledObserveCallback);
        } else {
          data.observe.call(data.target, enabledObserveCallback);
        }
      }

      if (data.destroy) {
        this.on("destroy", data.destroy.bind(data.target, data));
        delete data.enabledCallback;
      }
    }
  },
  toggleByHover: function toggleByHover($item, $toggleElement, foo, data) {

    var onClose;

    $toggleElement.hide();
    $item.mouseout(function () {
      $toggleElement.hide();
      onClose && onClose();
    });
    $item.mouseover(function () {
      $toggleElement.show();
      onClose = foo && foo();
    });

    $item.click(function () {
      if (data && data.immediately) {
        data.action();
      }
    });
  },
  toggleByButton: function toggleByButton($item, $toggleElement, foo, data) {

    var onClose;
    var _try_hide = function _try_hide(e) {
      var _parents = $(e.target).parents();
      for (var i in _parents) {
        if (_parents[i] === $item[0]) {
          return false;
        }
      }
      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
      }
    };

    $toggleElement.click(function (e) {
      e.stopPropagation();
    });
    $toggleElement.hide();
    $item.click(function () {

      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
        $(window).off("click", _try_hide);
      } else {
        $toggleElement.show();
        $(window).on("click", _try_hide);

        onClose = foo && foo();

        if (data && data.immediately) {
          data.action();
        }
      }
    });
  },
  generateMenuButton: function generateMenuButton(target, $el, options, data) {
    var _this = this;

    if (data.constructor === String) {
      data = target.actions[data];
    }

    if (!data.target) {
      data = Toolbar.makeAction(data, target);
    }
    if (!data || data.insert !== undefined && !data.insert) {
      return;
    }
    data.type = data.type || "button";

    //todo непонятно зачем аргумент target в начале
    // target = data.target;

    var tool = this.tools[data.type];

    if (!tool) {
      console.warn("tool '" + data.type + "' undefined");
      return;
    }
    var scope = data;
    if (tool.scope) {
      scope = fabric.util.object.defaults(tool.scope.call(this, data, options), data);
    }

    if (tool.template) {
      var $item = $(tool.template.format(scope));
      var transclude = $item.find("[transclude]");
      scope.$item = data.$item = $item;
      if (data.template) {
        $item.html(data.template.format(data.value.get()));
      }

      utils.compile.compileElement($item, scope);

      if (data.value && data.value.observe) {

        var foo = function foo(val) {
          if (tool.post) {
            tool.post.call(_this, $item, scope, options, transclude.length ? transclude : null);
          }
          if (tool.render) {
            tool.render.call(_this, $item, data, options, tool, val);
          }
          //this.fire(data.type + ":render",{item: $item, data: data, options: options, tool: tool, val: val})
        };
        var _target = data.target || target;

        _target.on(data.value.observe, foo);
      }

      this.initItem($item, data);

      if (tool.post) {
        tool.post.call(this, $item, scope, options, transclude.length ? transclude : null);
      }

      $el.append($item);
    }

    this.fire(data.type + ":created", { data: scope, options: options, tool: tool });
  },
  generateMenu: function generateMenu(target, $el, options, menu) {
    var _this2 = this;

    options = options || {
      title: false
    };

    options.buttons = options.buttons || {
      className: "",
      title: false
    };

    $el.empty();

    fabric.util.object.each(menu, function (data) {
      _this2.generateMenuButton(target, $el, options, data);
    });
  }
};
utils.observable(Toolbar.prototype);

Toolbar.single = function (data, element) {
  data.$item = element;
  data.type = data.type || "button";

  var tool = Toolbar.prototype.tools[data.type];

  Toolbar.prototype.initItem(element, data);

  if (data.value && data.value.observe) {
    data.target.on(data.value.observe, function (val) {
      tool.render(element, data, {}, tool, val);
    });
  }

  if (tool.post) {
    var transclude = element.find("[transclude]");

    tool.post.call(Toolbar.prototype, element, data, {}, transclude.length ? transclude : null);
  }

  var scope = data;
  if (tool.scope) {
    scope = _.defaults(data, tool.scope.call(Toolbar.prototype, data, {}));
  }

  element.eachSelf("*", function () {
    var nodes = [],
        values = [];
    for (var att, i = 0, atts = this.attributes, n = atts.length; i < n; i++) {
      att = atts[i];
      nodes.push(att.nodeName);
      values.push(att.nodeValue);
      this.setAttribute(att.nodeName, att.nodeValue.format(scope));
    }
  });
  utils.compile.compileElement(element, scope);
};

module.exports = Toolbar;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var utils = {
  Utf8ArrayToStr: function Utf8ArrayToStr(array) {
    var out, i, len, c;
    var char2, char3;

    out = "";
    len = array.length;
    i = 0;
    while (i < len) {
      c = array[i++];
      switch (c >> 4) {
        case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:
          // 0xxxxxxx
          out += String.fromCharCode(c);
          break;
        case 12:case 13:
          // 110x xxxx   10xx xxxx
          char2 = array[i++];
          out += String.fromCharCode((c & 0x1F) << 6 | char2 & 0x3F);
          break;
        case 14:
          // 1110 xxxx  10xx xxxx  10xx xxxx
          char2 = array[i++];
          char3 = array[i++];
          out += String.fromCharCode((c & 0x0F) << 12 | (char2 & 0x3F) << 6 | (char3 & 0x3F) << 0);
          break;
      }
    }

    return out;
  },
  dataURItoBlob: function dataURItoBlob(dataURI, dataTYPE) {
    var binary = atob(dataURI.split(',')[1]),
        array = [];
    for (var i = 0; i < binary.length; i++) {
      array.push(binary.charCodeAt(i));
    }
    return new Blob([new Uint8Array(array)], { type: dataTYPE });
  },
  blobToDataURL: function blobToDataURL(blob, callback) {
    var a = new FileReader();
    a.onload = function (e) {
      callback(e.target.result);
    };
    a.readAsDataURL(blob);
  },
  worker: function worker(foo) {
    if (window.Worker) {
      var str = foo.toString();
      var eventArg = str.substring(str.indexOf("(") + 1, str.indexOf(","));
      var postMessageArg = str.substring(str.indexOf(",") + 1, str.indexOf(")"));
      var _functionBody = str.substring(str.indexOf("{") + 1);
      str = "onmessage=function(" + eventArg + "){" + postMessageArg + "= postMessage;" + _functionBody;
      var blob = new Blob([str]);
      //"onmessage = function(e) { postMessage('msg from worker'); }"]);
      var blobURL = window.URL.createObjectURL(blob);
      return new Worker(blobURL);
    } else {
      var worker = {
        terminate: function terminate() {},
        postMessage: function postMessage(data) {
          setTimeout(function () {
            foo({ data: data }, function (responseData) {
              worker.onmessage && worker.onmessage({ data: responseData });
            });
          });
        }
      };
      return worker;
    }
  },
  observable: function observable(obj) {
    obj.fire = function fire(eventName, options) {
      if (!this.__eventListeners) {
        return;
      }
      var listenersForEvent = this.__eventListeners[eventName];
      if (!listenersForEvent) {
        return;
      }
      for (var i = 0, len = listenersForEvent.length; i < len; i++) {
        listenersForEvent[i].call(this, options || {});
      }
      return this;
    };
    obj.on = function (eventName, handler) {
      if (eventName.constructor == Object) {
        for (var i in eventName) {
          this.on(i, eventName[i]);
        }
        return this;
      }
      var events = eventName.split(" ");
      for (var i in events) {
        this.observe(events[i], handler);
      }
      return this;
    };
    obj.observe = function (eventName, handler) {
      if (!this.__eventListeners) {
        this.__eventListeners = {};
      }
      if (arguments.length === 1) {
        for (var prop in eventName) {
          this.on(prop, eventName[prop]);
        }
      } else {
        if (!this.__eventListeners[eventName]) {
          this.__eventListeners[eventName] = [];
        }
        this.__eventListeners[eventName].push(handler);
      }
      return this;
    };
    obj.off = function stopObserving(eventName, handler) {
      function _removeEventListener(eventName, handler) {
        if (!this.__eventListeners[eventName]) {
          return;
        }

        if (handler) {
          var idx = this.__eventListeners[eventName].indexOf(handler);
          if (idx !== -1) {
            this.__eventListeners[eventName].splice(idx, 1);
          }
        } else {
          this.__eventListeners[eventName].length = 0;
        }
      }

      if (!this.__eventListeners) {
        return;
      }
      if (arguments.length === 0) {
        this.__eventListeners = {};
      } else if (arguments.length === 1 && _typeof(arguments[0]) === 'object') {
        for (var prop in eventName) {
          _removeEventListener.call(this, prop, eventName[prop]);
        }
      } else {
        _removeEventListener.call(this, eventName, handler);
      }
      return this;
    };
  },
  order: function order(_array, context) {
    (function _call() {
      if (!_array.length) return;
      var foo = _array.shift();
      if (foo) {
        if (foo.length) {
          foo.call(context, _call);
        } else {
          foo.call(context);
          _call();
        }
      } else {
        _call();
      }
    })();
  },
  inOrder: function inOrder(array, foo, callback) {
    var _index = 0;
    function _inOrderIndex() {
      if (++_index < array.length) {
        foo(array[_index], _index, _inOrderIndex);
      } else {
        callback && callback();
      }
    }
    foo(array[_index], _index, _inOrderIndex);
  },
  /**
   * возвращает объект с ключами строки url
   * @returns {{}}
   */
  queryString: function queryString(query) {
    if (query) {
      query = query.substr(query.indexOf("?") + 1);
    } else {
      query = window.location.search.substring(1);
    }
    var obj = {};
    var _length = 0;
    if (!query) return obj;
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      var _vname = pair[0],
          val = pair[1];
      if (typeof obj[_vname] === "undefined") {
        obj[_vname] = val || "";
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
        // If second entry with this name
      } else if (typeof obj[_vname] === "string") {
        var arr = [obj[_vname], val];
        obj[_vname] = arr;
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
        // If third or later entry with this name
      } else {
        obj[_vname].push(val);
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
      }
    }
    Object.defineProperty(obj, "length", { value: _length, enumerable: false });
    return obj;
  },

  splitBy: function splitBy(query, delimiter) {
    var traceQueries = [];
    var r = 0,
        f = 0,
        _p_start = 0;
    if (query == "") return [];
    for (var i = 0; i < query.length; i++) {
      var c = query[i];
      if (c == "(") {
        r++;
        f = 1;
      } else if (c == ")") {
        r--;
      }
      if (r == 0 && f == 1) f = 0;
      if (delimiter.indexOf(c) != -1 && r == 0 && f == 0) {
        traceQueries.push(query.substring(_p_start, i));
        _p_start = i + 1;
      }
    }
    traceQueries.push(query.substring(_p_start));
    return traceQueries;
  },
  queueLoad: function queueLoad(total, completeCB, progressCB) {
    var loader = function loader(el) {
      loader.loaded.push(el);
      loader.progressCB && loader.progressCB(loader.loaded.length, loader.total, el, loader.loaded);

      if (loader.loaded.length == loader.total) {
        loader.completeCB && loader.completeCB(loader.loaded);
        loader.fire("loaded");
      }
    };
    loader.completeCB = completeCB;
    loader.progressCB = progressCB;
    loader.total = total;
    loader.loaded = [];
    utils.observable(loader);

    return loader;
  }
};

module.exports = utils;

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _ = __webpack_require__(11);

var utils = {
  /**
   *
   * @param arr
   * @param arr2
   * @returns {{}}
   * @example
   *    x = {a: 1 ,b: 1, c: [1,2]}
   *    y = {a: 2 ,  c : 3 , d : 1}
   *
   *    extendArraysObject(x,y) = {a: [1,2] b : [1] c : [1,2,3], d [1] }
   */
  extendArraysObject: function extendArraysObject(arr, arr2) {
    var newArray = {};

    for (var i in arr) {
      if (arr[i].constructor == Array) {
        newArray[i] = [].concat(arr[i]);
      } else {
        newArray[i] = [arr[i]];
      }
    }

    for (var i in arr2) {
      if (newArray[i]) {
        newArray[i].push(arr2[i]);
      } else {
        newArray[i] = [arr2[i]];
      }
    }
    return newArray;
  },
  filterValues: function filterValues(array, values) {
    var new_array = [];
    for (var i in array) {
      var _new_object = {};
      for (var j in values) {
        _new_object[values[j]] = array[i][values[j]];
      }
      new_array.push(_new_object);
    }
    return new_array;
  },
  /**
   *  Тасование Фишера–Йетса,случайное тасование множества
   * @param object
   * @returns {*}
   */
  shuffle: function shuffle(object) {
    if (!object.length) return;
    var i = object.length;
    while (--i) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = object[i];
      object[i] = object[j];
      object[j] = temp;
    }

    return object; // for convenience, in case we want a reference to the array
  },
  /**
   * Dependency: underscore.js ( http://documentcloud.github.com/underscore/ )
   *
   * Mix it in with underscore.js:
   * _.mixin({deepExtend: deepExtend});
   *
   * Call it like this:
   * var myObj = utils.deepExtend(grandparent, child, grandchild, greatgrandchild)
   *
   * Notes:
   * Keep it DRY.
   * This function is especially useful if you're working with JSON config documents. It allows you to create a default
   * config document with the most common settings, then override those settings for specific cases. It accepts any
   * number of objects as arguments, giving you fine-grained control over your config document hierarchy.
   *
   * Special Features and Considerations:
   * - parentRE allows you to concatenate strings. example:
   *   var obj = utils.deepExtend({url: "www.example.com"}, {url: "http://#{_}/path/to/file.html"});
   *   console.log(obj.url);
   *   output: "http://www.example.com/path/to/file.html"
   *
   * - parentRE also acts as a placeholder, which can be useful when you need to change one value in an array, while
   *   leaving the others untouched. example:
   *   var arr = utils.deepExtend([100,    {id: 1234}, true,  "foo",  [250, 500]],
   *                          ["#{_}", "#{_}",     false, "#{_}", "#{_}"]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - The previous example can also be written like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false, "#{_}", []]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - And also like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - Array order is important. example:
   *   var arr = utils.deepExtend([1, 2, 3, 4], [1, 4, 3, 2]);
   *   console.log(arr);
   *   output: [1, 4, 3, 2]
   *
   * - You can remove an array element set in a parent object by setting the same index value to null in a child object.
   *   example:
   *   var obj = utils.deepExtend({arr: [1, 2, 3, 4]}, {arr: ["#{_}", null]});
   *   console.log(obj.arr);
   *   output: [1, 3, 4]
   *
   **/
  deepExtend: function deepExtend() /*obj_1, [obj_2], [obj_N]*/{
    if (arguments.length < 1 || _typeof(arguments[0]) !== 'object') {
      return false;
    }
    if (arguments.length < 2) return arguments[0];

    var target = arguments[0];

    // convert arguments to array and cut off target object
    var args = Array.prototype.slice.call(arguments, 1);

    var key, val, src, clone, tmpBuf;

    args.forEach(function (obj) {
      if ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object') return;

      for (key in obj) {
        if (!(key in obj)) continue;

        src = target[key];
        val = utils.cloneDeep(obj[key]);

        if ((typeof src === 'undefined' ? 'undefined' : _typeof(src)) !== 'object' || src === null) {
          target[key] = val;
        } else if (Array.isArray(val)) {
          clone = Array.isArray(src) ? src : [];

          val.forEach(function (item) {
            clone.push(utils.cloneDeep(item));
          });

          target[key] = clone;
          //todo  если заимствуем массив , то ссохраняем значения из обоих массивов
          //target[key] = utils.deepExtend(clone, val);
        } else {
          clone = !Array.isArray(src) ? src : {};
          target[key] = utils.deepExtend(clone, val);
        }
      }
    });

    return target;
  },
  cloneDeep: function cloneDeep(val) {
    if (typeof val === 'undefined') {
      return undefined;
    }

    if (val === null) {
      return null;
    } else if (val instanceof Date) {
      return new Date(val.getTime());
    } else if (val instanceof RegExp) {
      return new RegExp(val);
    }

    if (val.cloneSync) {
      return val.cloneSync();
    } else if (val.constructor == Object) {
      return utils.deepExtend({}, val);
    } else if (val.constructor == Array) {
      var clone = [];
      for (var i = 0; i < val.length; i++) {
        clone.push(utils.cloneDeep(val[i]));
      }
      return clone;
    } else {
      return val;
    }
  },
  rearrange: function rearrange(object, keys) {
    var _newOrder = {};
    for (var i in keys) {
      if (object[keys[i]] !== undefined) {
        _newOrder[keys[i]] = object[keys[i]];
      }
    }
    return _newOrder;
  },
  copyValue: function copyValue(value) {
    if (value == null) {
      return null;
    }
    if (value == undefined) {
      return undefined;
    }
    switch (value.constructor) {
      case Object:
        return utils.deepExtend({}, value);
      case Array:
        return utils.deepExtend([], value);
      case String:
      case Number:
      case Boolean:
        return value;
      default:
        //console.log(value.constructor);
        return utils.deepExtend({}, value);
    }
  },
  clearValue: function clearValue(value) {
    switch (value.constructor) {
      case Object:
        for (var member in value) {
          delete value[member];
        }break;
      case Array:
        value.length = 0;
        break;
      default:
      //delete value;
    }
  },
  difference: function difference(prev, now) {
    var changes = {};
    for (var prop in now) {
      if (!prev || prev[prop] !== now[prop]) {
        if (_typeof(now[prop]) == "object") {
          var c = utils.difference(prev[prop], now[prop]);
          if (!_.isEmpty(c)) // underscore
            changes[prop] = c;
        } else {
          changes[prop] = now[prop];
        }
      }
    }
    return changes;
  },
  clone: function clone(object, deep) {
    if (deep) {
      return utils.cloneDeep(object);
    } else {
      return utils.extend({}, object);
    }
  }
};

_.defaults(utils, _);

module.exports = utils;

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = {
  resolve: function resolve(path) {
    var chunks = path.split("/");
    var prev = 0;
    for (var i = chunks.length; i-- > 0;) {
      if (chunks[i] == "..") {
        prev++;
      } else {
        while (prev > 0) {
          chunks.splice(i, 1);
          chunks.splice(i--, 1);
          prev--;
        }
      }
    }
    return chunks.join("/");
  },
  getParentDirectoryUrl: function getParentDirectoryUrl(url) {
    return url.substr(0, url.lastIndexOf("/") + 1);
  }
};

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

String.prototype.format = function () {
  var str = this.toString();
  if (arguments.length) {
    var type = _typeof(arguments[0]),
        args = type == 'string' || type == 'number' ? Array.prototype.slice.call(arguments) : arguments[0];
    //
    // for (var arg in args) str = str.replace(new RegExp('\\{' + arg + '\\}', 'gi'), args[arg])

    str = str.replace(/\{([^}]*)\}/g, function (a, b) {
      return utils.evalInContext(b, args);
    });
  }

  return str;
};

var utils = {
  extractVariables: function extractVariables(str) {
    return str.match(/(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*/gi);
  },
  evalInContext: function evalInContext(js) {
    js = js.replace(/\s+/g, '');

    var keys = [],
        values = [];

    for (var i = 1; i < arguments.length; i++) {
      keys = keys.concat(Object.keys(arguments[i]));
      for (var j in arguments[i]) {
        values.push(arguments[i][j]);
      }
    }

    //
    //if(_.isCorrectVariableName(js) && keys.indexOf(js) === -1){
    //  keys.push(js);
    //  values.push(undefined);
    //}

    var arr = utils.extractVariables(js);
    //console.log(arr);
    for (var i in arr) {
      if (keys.indexOf(arr[i]) === -1) {
        keys.push(arr[i]);
        values.push(undefined);
      }
    }
    js = "var foo = function(" + keys.join(",") + "){ var __return__value = " + js + " ;return __return__value;}; foo;";
    try {
      var foo = eval(js);
      return foo.apply(this, values);
    } catch (e) {
      return undefined;
    }
  },
  compileElement: function compileElement($item, scope) {

    function _eachSelf(el, selector, foo) {
      el.find(selector).each(foo);
      if (el.is(selector)) {
        foo.call(el[0]);
      }
    }

    //.addBack('selector')
    _eachSelf($item, "[onclick]", function () {
      var onClick = $(this).attr("onclick");
      $(this).removeAttr("onclick");
      $(this).click(function (event) {
        utils.evalInContext(onClick, scope, { event: event });
      });
    });

    _eachSelf($item, "[onchange]", function () {
      var onChange = $(this).attr("onchange");
      $(this).removeAttr("onchange");
      $(this).change(function (event) {
        utils.evalInContext(onChange, scope, { event: event });
      });
    });

    _eachSelf($item, "[dp-checked]", function () {
      var _val = $(this).attr("dp-checked");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("checked", "checked");
      } else {
        $(this).removeAttr("checked");
      }
    });
    _eachSelf($item, "[dp-src]", function () {
      var _val = $(this).attr("dp-src");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("src", val);
      }
    });
    _eachSelf($item, "[dp-if]", function () {
      var _val = $(this).attr("dp-if");
      if (_val === "false") {
        $(this).remove();
      }
      if (_val === "true") {} else {
        var val = utils.evalInContext(_val, scope);
        if (!val) {
          $(this).remove();
        }
      }
    });
    _eachSelf($item, "[dp-include]", function () {
      var _el = $(this);
      var _val = _el.attr("dp-include");
      var val = utils.evalInContext(_val, scope);
      _el.load(val);
    });
  },
  parseTemplate: function parseTemplate(tpl, scope) {
    var $item = $(tpl.format(scope));
    _.compileElement($item, scope);
    return $item;
  }
};
if (true) {
  module.exports = utils;
}

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Canvas.prototype, {
  _setSVGObject: function _setSVGObject(markup, instance, reviver) {
    var result = markup.push(instance.toSVG(reviver));
    if (instance._clipTo) {
      var clipId = 'Clipped' + fabric.Object.__uid++;
      result = '<clipPath id="' + clipId + '">\n                    ' + instance._clipTo.toSVG(reviver) + '\n                </clipPath>\n                <g clip-path="url(#' + clipId + ')">' + result + '</g>';
    }
    // markup.push(instance.toSVG(reviver));
    return reviver ? reviver(result) : result;
  },
  // enableClipAreaZooming: function(){
  //todo
  // this.on('viewport:scaled', function(){
  //   if (!this.layer("background").objects) return;
  //   this._backgroundLayer[0].setCoords();
  // });
  // },
  _fabric_clip_function: function _fabric_clip_function(ctx2) {

    var clipRect = this.clipRect;
    ctx2.save();
    clipRect.render(ctx2);
    ctx2.restore();
  }
});

fabric.util.object.extend(fabric.Object.prototype, {

  setClipTo: function setClipTo(val) {
    this.clipTo = val;
    delete this._clipTo;
    if (!this.clipTo) {
      return;
    }

    if (typeof val !== 'string') {
      this._clipTo = val;
      this.clipTo = val.id;
    }

    var functionBody = fabric.util.getFunctionBody(val);
    if (typeof functionBody !== 'undefined') {
      this._clipTo = new Function('ctx', functionBody);
    }
  },
  _initClipping: function _initClipping(options) {
    if (!options._clipTo) {
      return;
    }

    var functionBody = fabric.util.getFunctionBody(options.clipTo);
    if (typeof functionBody !== 'undefined') {
      this._clipTo = new Function('ctx', functionBody);
    }
  }
});

fabric.util.clipContext = function (receiver, ctx) {
  if (!receiver._clipTo) {
    if (receiver.clipTo === "canvas") {
      var clipObject = receiver.canvas;

      var _w = clipObject.originalWidth || clipObject.width;
      var _h = clipObject.originalHeight || clipObject.height;

      var o = clipObject.offsets;
      var _zoom = clipObject.getZoom();
      ctx.rect(o.left, o.top, _w /*/_zoom */ - o.left - o.right, _h /*/_zoom*/ - o.top - o.bottom);
    } else {

      var _id = receiver.clipTo.substring(1);

      var _clipCtx = receiver.canvas.getObjectByID(_id);
      if (_clipCtx) {
        receiver._clipTo = _clipCtx;
      } else {
        console.warn("error: clipTo not found" + receiver.clipTo);
        delete receiver.clipTo;
        return;
      }
    }
  }

  if (receiver._clipTo.constructor === Function) {
    receiver._clipTo(ctx);
  } else {
    //  fabric.util._clipToObject(receiver, ctx);

    ctx.save();
    // let retina = this.canvas.getRetinaScaling();
    // ctx.setTransform(retina, 0, 0, retina, 0, 0);
    ctx.transform.apply(ctx, receiver.canvas.viewportTransform);
    receiver._clipTo.transform(ctx);
    receiver._clipTo._render(ctx);
    ctx.restore();
    ctx.clip();
  }
};

fabric.util._clipToObject = function (receiver, ctx) {
  /*
  ctx.save();
  ctx.beginPath();
   let fromLeft = false;
  let center = fromLeft ? receiver._getLeftTopCoords() : receiver.getCenterPoint();
  ctx.transform(1, Math.tan(fabric.util.degreesToRadians(-receiver.skewY)), 0, 1, 0, 0);
  ctx.transform(1, 0, Math.tan(fabric.util.degreesToRadians(-receiver.skewX)), 1, 0, 0);
  ctx.scale(
    (1 / receiver.scaleX) * (receiver.flipX ? -1 : 1),
    (1 / receiver.scaleY) * (receiver.flipY ? -1 : 1)
  );
  ctx.rotate(fabric.util.degreesToRadians(-receiver.angle));
  ctx.translate(-center.x, -center.y);
   let clipObject = receiver._clipTo;
   if (clipObject.points) {
    let ps = clipObject.points;
    ctx.moveTo(ps[0].x, ps[0].y);
    for (let j = 1; j < ps.length; j++) {
      ctx.lineTo(ps[j].x, ps[j].y);
    }
    //ctx.stroke();
  } else if (clipObject.type == "path-group") {
     ctx.globalAlpha = 0;
    clipObject.transform(ctx);
     ctx.translate(-clipObject.width/2, -clipObject.height/2);
    for (let i = 0, l = clipObject.paths.length; i < l; ++i) {
      clipObject.paths[i]._render(ctx, true);
    }
  } else if (clipObject.type == "path") {
     ctx.globalAlpha = 0;
    clipObject.transform(ctx);
    clipObject._render(ctx);
     //todo очень плохо. изначально объекты имеют клип к слайду статичному. но потом к канвасу динамическому. нехорошо
  } else if (clipObject.type == "slide" || clipObject.type == "canvas") {
      let _w = clipObject.originalWidth || clipObject.width;
    let _h = clipObject.originalHeight || clipObject.height;
      let o = clipObject.offsets;
    let _zoom = clipObject.getZoom();
    ctx.rect(o.left,o.top, _w /
  }else {
    ctx.translate(clipObject.left, clipObject.top);
    ctx.rotate(-(clipObject.angle * -1) * Math.PI / 180);
    if(clipObject.originX === "center"){
      ctx.rect(- clipObject.width/ 2, - clipObject.height/2, clipObject.width, clipObject.height);
    }else{
      ctx.rect(0,0, clipObject.width, clipObject.height);
    }
  }
   ctx.closePath();
  ctx.restore();*/
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 7 */
/***/ (function(module, exports) {

module.exports = $;

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//fabric.debug = DEVELOPMENT;

__webpack_require__(9);
// fabric.util.data = require('./util/data');
// fabric.util.path = require('./util/path');
// fabric.util.compile = require('./util/compile');
// fabric.util.loader = require('./util/loader');
// fabric.util.syntax = require("./util/syntax");
// fabric.util.object.extend(fabric.util.object,require('./util/object.js'));
// fabric.util.object.extend(fabric.util,require('./util/util.js'));

//require('./modules');

__webpack_require__(18);
__webpack_require__(19);
__webpack_require__(20);
__webpack_require__(21);
__webpack_require__(23);
__webpack_require__(24);
__webpack_require__(25);
__webpack_require__(26);
__webpack_require__(27);
__webpack_require__(28);
__webpack_require__(29);
__webpack_require__(30);
// require('./core/group.ext');


__webpack_require__(31);
__webpack_require__(32);
__webpack_require__(33);
__webpack_require__(34);
// require('./modules/slide.areas');
// require('./modules/slide.drawing-tools');
// require('./modules/canvas.events');
__webpack_require__(35);
__webpack_require__(36);
__webpack_require__(37);
__webpack_require__(38);
__webpack_require__(39);
__webpack_require__(40);
__webpack_require__(41);
__webpack_require__(42);
__webpack_require__(43);
__webpack_require__(45);
__webpack_require__(46);
// require('./modules/resizable');
// require('./modules/ruler');
// require('./modules/render');
__webpack_require__(47);
// require('./modules/clipTo');
// require('./modules/shirt');
__webpack_require__(48);
__webpack_require__(51);
__webpack_require__(53);
__webpack_require__(54);
__webpack_require__(55);
__webpack_require__(56);
__webpack_require__(57);
// require('./modules/borderImage');
// require('./modules/saveAs');
// require('./brushes/BaseBrush');
// require('./brushes/PencilBrush');
// require('./brushes/RectangleBrush');
// require('./brushes/PolygonBrush');
// require('./brushes/PaintPenBrush');
// require('./brushes/PaintBucketBrush');
// require('./brushes/PointsBrush');
__webpack_require__(58);
__webpack_require__(60);
// require('./shapes/path');
// require('./shapes/clipart');
// require('./shapes/photo');
// require('./shapes/polyline');
// require('./shapes/image.photoshop-tools');
// require('./shapes/image.remove-white');

// require('./shapes/bezierText');
__webpack_require__(62);
// require('./shapes/textbox.list');
// require('./shapes/textFrame');


if (!fabric.isLikelyNode) {
  __webpack_require__(63);
  __webpack_require__(65);
  __webpack_require__(67);

  /**
   * inline script images
   * @type {{error: string}}
   */
  fabric.media = {
    /**
     * replace images loaded with errors
     */
    error: 'data:image/svg+xml;base64,' + __webpack_require__(76)
  };
}

module.exports = fabric;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.data = __webpack_require__(10);
fabric.util.path = __webpack_require__(4);
fabric.util.compile = __webpack_require__(5);
fabric.util.loader = __webpack_require__(13);
fabric.util.syntax = __webpack_require__(14);
fabric.util.promise = __webpack_require__(15);
__webpack_require__(16);
__webpack_require__(17);
fabric.util.object.extend(fabric.util, __webpack_require__(2));
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var path = __webpack_require__(4);
var util = __webpack_require__(2);
var object = __webpack_require__(3);

function isServer() {
  return !(typeof window != 'undefined' && window.document);
}

if (isServer()) {
  var fs = __webpack_require__(12);
}

function _load_json(value, callback_success, callback_error) {

  var output = null;
  var errors = [];

  if (value.constructor == String) {

    var filename, regex_data, init_property;
    regex_data = /^([^#]*)#?(.*)$/.exec(value);

    filename = regex_data[1];
    init_property = regex_data[2];
    utils.getInlineJson(filename, "json", _loadJson_data, function (error) {
      errors.push(error);
      if (callback_error) {
        callback_error(error);
      } else {
        console.error("file: \"" + filename + "\". " + error.message);
      }
    });
  } else {
    _loadJson_data(value);
  }

  function _loadJson_data(data) {
    /*
     замена записей "url(./path/to/file)  на "../../path/to/file"
     url начинающиеся с ./ относительно родителького json файла
      url с "/" добавляется APP_STATIC_PATH
     */
    utils.recoursive(data, function (property, value, parent) {
      if (/^url\(.*\)$/.test(value)) {
        var regex_data = /^url\((\.?\/)?(.*)\)$/.exec(value);
        var url = regex_data[2];

        if (regex_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (regex_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        parent[property] = path.resolve(url);
      }
    });

    var loader = util.queueLoad(1, function finalize() {

      if (init_property) {
        var prop_arr = init_property.split("/");
        for (var i = 0; i < prop_arr.length; i++) {
          data = data[prop_arr[i]];
        }
      }

      if (errors.length) {
        if (callback_error) callback_error(errors);
      } else {
        if (callback_success) callback_success(data);
        output = data;
      }
    });

    /**
     * remove comments
     */
    utils.recoursive(data, function (property, value, parent) {
      /*
       remove comments like
       ["@comment()"]
       "@comment": {}
       */
      if (/^\/\/.*$/.test(value) || /^@comment\(.*\)$/.test(value) || property == "@comment") {
        if (parent.constructor == Array) {
          parent.splice(property, 1);
        } else {
          delete parent[property];
        }
      } else if (/^@extend.*$/.test(property)) {

        loader.total++;
        _load_json(value, function (data) {
          var ext_data = object.deepExtend(data, parent);
          object.deepExtend(parent, ext_data);
          delete parent["@extend"];
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@extend\(.*\)$/.test(value)) {
        var _reg_data = /^@extend\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@mixin\(.*\)$/.test(value)) {
        var _reg_data = /^@mixin\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          if (parent.constructor == Array) {
            parent.splice(property, 1);
            for (var i in data) {
              parent.push(data[i]);
            }
          } else {
            delete parent[property];
            for (var i in data) {
              parent[i] = data[i];
            }
          }
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@load\((.*)\)$/.test(value)) {
        var _reg_data = /^@load\((\.?\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (_reg_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        loader.total++;
        utils.getInlineJson(url, "html", function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      }
    });
    loader();
  }

  return output;
}

var utils = {
  CACHED_JSON: {},
  loadJsonSync: function loadJsonSync(src) {
    var data;
    _load_json(src, function (_data) {
      data = _data;
    });
    return data;
  },

  /**
   позволяет использовать конструкции вида
   расширить данные из файла template.json
   "@extend" : "url(data/template.json)",
   "@extend" : "url(data/template.json#settings/stages)",
    //заменить строку наданные из файла
   "stages":       "url(data/template.json#settings/stages)",
    * @param filename
   * @param callback_success
   * @param callback_error
   */
  loadJson: function loadJson(value, resolve_cb, fail_cb) {
    return _load_json(value, function (data) {
      resolve_cb && resolve_cb(data);
    }, function (err) {
      fail_cb && fail_cb(err);
    });
  },

  removeComments: function removeComments(str) {
    str = str.replace(/^\s*(\/\/.*|(?:\/\*[\s\S]*?)\*\/\s*)$/gm, "");
    return str;
  },
  /**
   *
   * @param object
   * @param criteria - выполнять функцию со всеми объектами
   */
  recoursive: function recoursive(object, criteria) {
    var readed = [];
    if (!object) return;
    return function sub_recoursive(object) {
      if (readed.indexOf(object) != -1) {
        return;
      }
      readed.push(object);

      if (object instanceof Array) {
        for (var prop = object.length; prop--;) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      } else {
        for (var prop in object) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      }
    }(object);
  },

  parseCSV: function parseCSV(data) {
    var rows = data.split(/\n/);
    var columns = rows[0].split(',');
    rows.splice(0, 1);

    for (var i = 0; i < rows.length; i++) {
      var output_row_data = {};
      var row_data = [];

      var _quote = false,
          last = -1;
      var j = -1;
      var str = rows[i];
      while (++j < str.length) {
        if (!_quote) {
          if (str[j] == '\'' || str[j] == '\"') {
            _quote = str[j];
          }
          if (str[j] == ",") {
            var _val = str.substring(last, j);
            if (_val[0] == '\"' && _val[_val.length - 1] == '\"') {
              _val = _val.substring(1, _val.length - 1);
            }
            row_data.push(_val);
            last = j + 1;
          }
        } else {
          if (str[j] == _quote) {
            _quote = false;
          }
        }
      }

      for (var j in row_data) {
        output_row_data[columns[j]] = row_data[j];
      }
      rows[i] = output_row_data;
    }
    return rows;
  },
  /**
   *
   * https://stackoverflow.com/questions/4843746/regular-expression-to-add-double-quotes-around-keys-in-javascript
   */
  doubleQuote: function doubleQuote(jsonString) {
    var objKeysRegex = /({|,)(?:\s*)(?:')?([A-Za-z_$\.][A-Za-z0-9_ \-\.$]*)(?:')?(?:\s*):/g; // look for object names
    return jsonString.replace(objKeysRegex, "$1\"$2\":"); // all object names should be double quoted
  },
  parseData: function parseData(data, dataType) {
    var _parsed;
    if (dataType == "csv") {
      _parsed = utils.parseCSV(data);
    } else if (dataType == "json") {
      _parsed = data.trim();
      //if (data[0] != "{" && data[0] != "[") {
      //  return false;
      //}

      _parsed = utils.removeComments(_parsed);
      //data  = data.replace(/\n/g,"")


      _parsed = utils.doubleQuote(_parsed);

      try {
        var _parsed = JSON.parse(_parsed); //= JSON.parse(data.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""));
      } catch (e) {
        return {
          status: "error",
          message: e.toString(),
          data: data
        };
      }
      //var script = $("<script type='text/json' id='" + url + "'>" + JSON.stringify(data) + "</script>");
    }
    return {
      status: "success",
      data: _parsed
    };
  },
  load: function load(url, dataType, callback_success, callback_error) {
    //todo
    if (isServer()) {
      try {
        var data = fs.readFileSync(url, 'utf8');
        data = data.replace(/^\uFEFF/, '');
        var _parsed = utils.parseData(data, dataType);
        if (_parsed.status == "error") {
          callback_error({
            status: "error",
            message: _parsed.message,
            data: _parsed.data
          });
          return;
        }
        callback_success(_parsed.data);
      } catch (e) {

        if (e.code === 'ENOENT') {
          console.log('File not found!');
        } else {
          throw e;
        }
        callback_error(data);
      }
    } else {

      var httpRequest = new XMLHttpRequest();

      httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            var data = httpRequest.responseText;
            var _parsed = utils.parseData(data, dataType);
            if (_parsed.status == "error") {
              callback_error({
                status: httpRequest.status,
                message: _parsed.message,
                response: httpRequest.responseText
              });
              return;
            }
            callback_success(_parsed.data);
          } else {
            callback_error(url, httpRequest);
          }
        }
      };
      httpRequest.open('GET', url);
      httpRequest.send();
    }
  },
  /**
   * Позволяетзагружать json файлы , содержащие ссылки на другие json файлы.
   * вместо ссылок типа
   *  "property" : "url(chunk.json)"
   *  будет загружено содержимое файла
   *  "property" : {...}
   *
   *  если указать якорь
   *  "property" : "url(chunk.json#settings/chunk/0/text)"
   *
   * то будет загружено содержимое поля settings.chunk[0].text из файла chunk.json
   *
   *
   * @param filename  путь к основному json файлу
   * @param callback  будет вызван после окончания загрузки всех файлов
   */
  getInlineJson: function getInlineJson(url, dataType, callback_success, callback_error) {

    if (dataType.constructor != String) {
      callback_error = callback_success;
      callback_success = dataType;
      dataType = "json";
    }

    if (typeof utils.CACHED_JSON !== "undefined" && utils.CACHED_JSON && utils.CACHED_JSON[url]) {
      callback_success(utils.CACHED_JSON[url]);
      return;
    }
    if (typeof $ !== "undefined") {
      if (typeof document !== "undefined") {
        var inline = $("script[id='" + url + "']");
        if (inline.length > 0) {
          var _data = inline[0].innerText || //all
          inline[0].textContent || //firefox
          inline[0].text; //ie8
          if (dataType == "json") {

            var _data = utils.removeComments(_data);
            callback_success(JSON.parse(_data));
          } else {
            callback_success(_data);
          }
          return;
        }
      }
    }
    utils.load(url, dataType, callback_success, callback_error);
  }
};

module.exports = utils;

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.


// Save bytes in the minified (but not gzipped) version:
var ArrayProto = Array.prototype,
    ObjProto = Object.prototype,
    FuncProto = Function.prototype;

// Create quick reference variables for speed access to core prototypes.
var push = ArrayProto.push,
    slice = ArrayProto.slice,
    toString = ObjProto.toString,
    hasOwnProperty = ObjProto.hasOwnProperty;

// All **ECMAScript 5** native function implementations that we hope to use
// are declared here.
var nativeIsArray = Array.isArray,
    nativeKeys = Object.keys,
    nativeBind = FuncProto.bind,
    nativeCreate = Object.create;

// Naked function reference for surrogate-prototype-swapping.
var Ctor = function Ctor() {};

// Create a safe reference to the Underscore object for use below.
var _ = function _(obj) {
  if (obj instanceof _) return obj;
  if (!(this instanceof _)) return new _(obj);
  this._wrapped = obj;
};

// Current version.
_.VERSION = '1.8.3';

// Internal function that returns an efficient (for current engines) version
// of the passed-in callback, to be repeatedly applied in other Underscore
// functions.
var optimizeCb = function optimizeCb(func, context, argCount) {
  if (context === void 0) return func;
  switch (argCount == null ? 3 : argCount) {
    case 1:
      return function (value) {
        return func.call(context, value);
      };
    case 2:
      return function (value, other) {
        return func.call(context, value, other);
      };
    case 3:
      return function (value, index, collection) {
        return func.call(context, value, index, collection);
      };
    case 4:
      return function (accumulator, value, index, collection) {
        return func.call(context, accumulator, value, index, collection);
      };
  }
  return function () {
    return func.apply(context, arguments);
  };
};

// A mostly-internal function to generate callbacks that can be applied
// to each element in a collection, returning the desired result — either
// identity, an arbitrary callback, a property matcher, or a property accessor.
var cb = function cb(value, context, argCount) {
  if (value == null) return _.identity;
  if (_.isFunction(value)) return optimizeCb(value, context, argCount);
  if (_.isObject(value)) return _.matcher(value);
  return _.property(value);
};
_.iteratee = function (value, context) {
  return cb(value, context, Infinity);
};

// An internal function for creating assigner functions.
var createAssigner = function createAssigner(keysFunc, undefinedOnly) {
  return function (obj) {
    var length = arguments.length;
    if (length < 2 || obj == null) return obj;
    for (var index = 1; index < length; index++) {
      var source = arguments[index],
          keys = keysFunc(source),
          l = keys.length;
      for (var i = 0; i < l; i++) {
        var key = keys[i];
        if (!undefinedOnly || obj[key] === void 0) obj[key] = source[key];
      }
    }
    return obj;
  };
};

// An internal function for creating a new object that inherits from another.
var baseCreate = function baseCreate(prototype) {
  if (!_.isObject(prototype)) return {};
  if (nativeCreate) return nativeCreate(prototype);
  Ctor.prototype = prototype;
  var result = new Ctor();
  Ctor.prototype = null;
  return result;
};

var property = function property(key) {
  return function (obj) {
    return obj == null ? void 0 : obj[key];
  };
};

// Helper for collection methods to determine whether a collection
// should be iterated as an array or as an object
// Related: http://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength
// Avoids a very nasty iOS 8 JIT bug on ARM-64. #2094
var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;
var getLength = property('length');
var isArrayLike = function isArrayLike(collection) {
  var length = getLength(collection);
  return typeof length == 'number' && length >= 0 && length <= MAX_ARRAY_INDEX;
};

// Collection Functions
// --------------------

// The cornerstone, an `each` implementation, aka `forEach`.
// Handles raw objects in addition to array-likes. Treats all
// sparse array-likes as if they were dense.
_.each = _.forEach = function (obj, iteratee, context) {
  iteratee = optimizeCb(iteratee, context);
  var i, length;
  if (isArrayLike(obj)) {
    for (i = 0, length = obj.length; i < length; i++) {
      iteratee(obj[i], i, obj);
    }
  } else {
    var keys = _.keys(obj);
    for (i = 0, length = keys.length; i < length; i++) {
      iteratee(obj[keys[i]], keys[i], obj);
    }
  }
  return obj;
};

// Return the results of applying the iteratee to each element.
_.map = _.collect = function (obj, iteratee, context) {
  iteratee = cb(iteratee, context);
  var keys = !isArrayLike(obj) && _.keys(obj),
      length = (keys || obj).length,
      results = Array(length);
  for (var index = 0; index < length; index++) {
    var currentKey = keys ? keys[index] : index;
    results[index] = iteratee(obj[currentKey], currentKey, obj);
  }
  return results;
};

// Create a reducing function iterating left or right.
function createReduce(dir) {
  // Optimized iterator function as using arguments.length
  // in the main function will deoptimize the, see #1991.
  function iterator(obj, iteratee, memo, keys, index, length) {
    for (; index >= 0 && index < length; index += dir) {
      var currentKey = keys ? keys[index] : index;
      memo = iteratee(memo, obj[currentKey], currentKey, obj);
    }
    return memo;
  }

  return function (obj, iteratee, memo, context) {
    iteratee = optimizeCb(iteratee, context, 4);
    var keys = !isArrayLike(obj) && _.keys(obj),
        length = (keys || obj).length,
        index = dir > 0 ? 0 : length - 1;
    // Determine the initial value if none is provided.
    if (arguments.length < 3) {
      memo = obj[keys ? keys[index] : index];
      index += dir;
    }
    return iterator(obj, iteratee, memo, keys, index, length);
  };
}

// **Reduce** builds up a single result from a list of values, aka `inject`,
// or `foldl`.
_.reduce = _.foldl = _.inject = createReduce(1);

// The right-associative version of reduce, also known as `foldr`.
_.reduceRight = _.foldr = createReduce(-1);

// Return the first value which passes a truth test. Aliased as `detect`.
_.find = _.detect = function (obj, predicate, context) {
  var key;
  if (isArrayLike(obj)) {
    key = _.findIndex(obj, predicate, context);
  } else {
    key = _.findKey(obj, predicate, context);
  }
  if (key !== void 0 && key !== -1) return obj[key];
};

// Return all the elements that pass a truth test.
// Aliased as `select`.
_.filter = _.select = function (obj, predicate, context) {
  var results = [];
  predicate = cb(predicate, context);
  _.each(obj, function (value, index, list) {
    if (predicate(value, index, list)) results.push(value);
  });
  return results;
};

// Return all the elements for which a truth test fails.
_.reject = function (obj, predicate, context) {
  return _.filter(obj, _.negate(cb(predicate)), context);
};

// Determine whether all of the elements match a truth test.
// Aliased as `all`.
_.every = _.all = function (obj, predicate, context) {
  predicate = cb(predicate, context);
  var keys = !isArrayLike(obj) && _.keys(obj),
      length = (keys || obj).length;
  for (var index = 0; index < length; index++) {
    var currentKey = keys ? keys[index] : index;
    if (!predicate(obj[currentKey], currentKey, obj)) return false;
  }
  return true;
};

// Determine if at least one element in the object matches a truth test.
// Aliased as `any`.
_.some = _.any = function (obj, predicate, context) {
  predicate = cb(predicate, context);
  var keys = !isArrayLike(obj) && _.keys(obj),
      length = (keys || obj).length;
  for (var index = 0; index < length; index++) {
    var currentKey = keys ? keys[index] : index;
    if (predicate(obj[currentKey], currentKey, obj)) return true;
  }
  return false;
};

// Determine if the array or object contains a given item (using `===`).
// Aliased as `includes` and `include`.
_.contains = _.includes = _.include = function (obj, item, fromIndex, guard) {
  if (!isArrayLike(obj)) obj = _.values(obj);
  if (typeof fromIndex != 'number' || guard) fromIndex = 0;
  return _.indexOf(obj, item, fromIndex) >= 0;
};

// Invoke a method (with arguments) on every item in a collection.
_.invoke = function (obj, method) {
  var args = slice.call(arguments, 2);
  var isFunc = _.isFunction(method);
  return _.map(obj, function (value) {
    var func = isFunc ? method : value[method];
    return func == null ? func : func.apply(value, args);
  });
};

// Convenience version of a common use case of `map`: fetching a property.
_.pluck = function (obj, key) {
  return _.map(obj, _.property(key));
};

// Convenience version of a common use case of `filter`: selecting only objects
// containing specific `key:value` pairs.
_.where = function (obj, attrs) {
  return _.filter(obj, _.matcher(attrs));
};

// Convenience version of a common use case of `find`: getting the first object
// containing specific `key:value` pairs.
_.findWhere = function (obj, attrs) {
  return _.find(obj, _.matcher(attrs));
};

// Return the maximum element (or element-based computation).
_.max = function (obj, iteratee, context) {
  var result = -Infinity,
      lastComputed = -Infinity,
      value,
      computed;
  if (iteratee == null && obj != null) {
    obj = isArrayLike(obj) ? obj : _.values(obj);
    for (var i = 0, length = obj.length; i < length; i++) {
      value = obj[i];
      if (value > result) {
        result = value;
      }
    }
  } else {
    iteratee = cb(iteratee, context);
    _.each(obj, function (value, index, list) {
      computed = iteratee(value, index, list);
      if (computed > lastComputed || computed === -Infinity && result === -Infinity) {
        result = value;
        lastComputed = computed;
      }
    });
  }
  return result;
};

// Return the minimum element (or element-based computation).
_.min = function (obj, iteratee, context) {
  var result = Infinity,
      lastComputed = Infinity,
      value,
      computed;
  if (iteratee == null && obj != null) {
    obj = isArrayLike(obj) ? obj : _.values(obj);
    for (var i = 0, length = obj.length; i < length; i++) {
      value = obj[i];
      if (value < result) {
        result = value;
      }
    }
  } else {
    iteratee = cb(iteratee, context);
    _.each(obj, function (value, index, list) {
      computed = iteratee(value, index, list);
      if (computed < lastComputed || computed === Infinity && result === Infinity) {
        result = value;
        lastComputed = computed;
      }
    });
  }
  return result;
};

// Shuffle a collection, using the modern version of the
// [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher–Yates_shuffle).
_.shuffle = function (obj) {
  var set = isArrayLike(obj) ? obj : _.values(obj);
  var length = set.length;
  var shuffled = Array(length);
  for (var index = 0, rand; index < length; index++) {
    rand = _.random(0, index);
    if (rand !== index) shuffled[index] = shuffled[rand];
    shuffled[rand] = set[index];
  }
  return shuffled;
};

// Sample **n** random values from a collection.
// If **n** is not specified, returns a single random element.
// The internal `guard` argument allows it to work with `map`.
_.sample = function (obj, n, guard) {
  if (n == null || guard) {
    if (!isArrayLike(obj)) obj = _.values(obj);
    return obj[_.random(obj.length - 1)];
  }
  return _.shuffle(obj).slice(0, Math.max(0, n));
};

// Sort the object's values by a criterion produced by an iteratee.
_.sortBy = function (obj, iteratee, context) {
  iteratee = cb(iteratee, context);
  return _.pluck(_.map(obj, function (value, index, list) {
    return {
      value: value,
      index: index,
      criteria: iteratee(value, index, list)
    };
  }).sort(function (left, right) {
    var a = left.criteria;
    var b = right.criteria;
    if (a !== b) {
      if (a > b || a === void 0) return 1;
      if (a < b || b === void 0) return -1;
    }
    return left.index - right.index;
  }), 'value');
};

// An internal function used for aggregate "group by" operations.
var group = function group(behavior) {
  return function (obj, iteratee, context) {
    var result = {};
    iteratee = cb(iteratee, context);
    _.each(obj, function (value, index) {
      var key = iteratee(value, index, obj);
      behavior(result, value, key);
    });
    return result;
  };
};

// Groups the object's values by a criterion. Pass either a string attribute
// to group by, or a function that returns the criterion.
_.groupBy = group(function (result, value, key) {
  if (_.has(result, key)) result[key].push(value);else result[key] = [value];
});

// Indexes the object's values by a criterion, similar to `groupBy`, but for
// when you know that your index values will be unique.
_.indexBy = group(function (result, value, key) {
  result[key] = value;
});

// Counts instances of an object that group by a certain criterion. Pass
// either a string attribute to count by, or a function that returns the
// criterion.
_.countBy = group(function (result, value, key) {
  if (_.has(result, key)) result[key]++;else result[key] = 1;
});

// Safely create a real, live array from anything iterable.
_.toArray = function (obj) {
  if (!obj) return [];
  if (_.isArray(obj)) return slice.call(obj);
  if (isArrayLike(obj)) return _.map(obj, _.identity);
  return _.values(obj);
};

// Return the number of elements in an object.
_.size = function (obj) {
  if (obj == null) return 0;
  return isArrayLike(obj) ? obj.length : _.keys(obj).length;
};

// Split a collection into two arrays: one whose elements all satisfy the given
// predicate, and one whose elements all do not satisfy the predicate.
_.partition = function (obj, predicate, context) {
  predicate = cb(predicate, context);
  var pass = [],
      fail = [];
  _.each(obj, function (value, key, obj) {
    (predicate(value, key, obj) ? pass : fail).push(value);
  });
  return [pass, fail];
};

// Array Functions
// ---------------

// Get the first element of an array. Passing **n** will return the first N
// values in the array. Aliased as `head` and `take`. The **guard** check
// allows it to work with `_.map`.
_.first = _.head = _.take = function (array, n, guard) {
  if (array == null) return void 0;
  if (n == null || guard) return array[0];
  return _.initial(array, array.length - n);
};

// Returns everything but the last entry of the array. Especially useful on
// the arguments object. Passing **n** will return all the values in
// the array, excluding the last N.
_.initial = function (array, n, guard) {
  return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));
};

// Get the last element of an array. Passing **n** will return the last N
// values in the array.
_.last = function (array, n, guard) {
  if (array == null) return void 0;
  if (n == null || guard) return array[array.length - 1];
  return _.rest(array, Math.max(0, array.length - n));
};

// Returns everything but the first entry of the array. Aliased as `tail` and `drop`.
// Especially useful on the arguments object. Passing an **n** will return
// the rest N values in the array.
_.rest = _.tail = _.drop = function (array, n, guard) {
  return slice.call(array, n == null || guard ? 1 : n);
};

// Trim out all falsy values from an array.
_.compact = function (array) {
  return _.filter(array, _.identity);
};

// Internal implementation of a recursive `flatten` function.
var flatten = function flatten(input, shallow, strict, startIndex) {
  var output = [],
      idx = 0;
  for (var i = startIndex || 0, length = getLength(input); i < length; i++) {
    var value = input[i];
    if (isArrayLike(value) && (_.isArray(value) || _.isArguments(value))) {
      //flatten current level of array or arguments object
      if (!shallow) value = flatten(value, shallow, strict);
      var j = 0,
          len = value.length;
      output.length += len;
      while (j < len) {
        output[idx++] = value[j++];
      }
    } else if (!strict) {
      output[idx++] = value;
    }
  }
  return output;
};

// Flatten out an array, either recursively (by default), or just one level.
_.flatten = function (array, shallow) {
  return flatten(array, shallow, false);
};

// Return a version of the array that does not contain the specified value(s).
_.without = function (array) {
  return _.difference(array, slice.call(arguments, 1));
};

// Produce a duplicate-free version of the array. If the array has already
// been sorted, you have the option of using a faster algorithm.
// Aliased as `unique`.
_.uniq = _.unique = function (array, isSorted, iteratee, context) {
  if (!_.isBoolean(isSorted)) {
    context = iteratee;
    iteratee = isSorted;
    isSorted = false;
  }
  if (iteratee != null) iteratee = cb(iteratee, context);
  var result = [];
  var seen = [];
  for (var i = 0, length = getLength(array); i < length; i++) {
    var value = array[i],
        computed = iteratee ? iteratee(value, i, array) : value;
    if (isSorted) {
      if (!i || seen !== computed) result.push(value);
      seen = computed;
    } else if (iteratee) {
      if (!_.contains(seen, computed)) {
        seen.push(computed);
        result.push(value);
      }
    } else if (!_.contains(result, value)) {
      result.push(value);
    }
  }
  return result;
};

// Produce an array that contains the union: each distinct element from all of
// the passed-in arrays.
_.union = function () {
  return _.uniq(flatten(arguments, true, true));
};

// Produce an array that contains every item shared between all the
// passed-in arrays.
_.intersection = function (array) {
  var result = [];
  var argsLength = arguments.length;
  for (var i = 0, length = getLength(array); i < length; i++) {
    var item = array[i];
    if (_.contains(result, item)) continue;
    for (var j = 1; j < argsLength; j++) {
      if (!_.contains(arguments[j], item)) break;
    }
    if (j === argsLength) result.push(item);
  }
  return result;
};

// Take the difference between one array and a number of other arrays.
// Only the elements present in just the first array will remain.
_.difference = function (array) {
  var rest = flatten(arguments, true, true, 1);
  return _.filter(array, function (value) {
    return !_.contains(rest, value);
  });
};

// Zip together multiple lists into a single array -- elements that share
// an index go together.
_.zip = function () {
  return _.unzip(arguments);
};

// Complement of _.zip. Unzip accepts an array of arrays and groups
// each array's elements on shared indices
_.unzip = function (array) {
  var length = array && _.max(array, getLength).length || 0;
  var result = Array(length);

  for (var index = 0; index < length; index++) {
    result[index] = _.pluck(array, index);
  }
  return result;
};

// Converts lists into objects. Pass either a single array of `[key, value]`
// pairs, or two parallel arrays of the same length -- one of keys, and one of
// the corresponding values.
_.object = function (list, values) {
  var result = {};
  for (var i = 0, length = getLength(list); i < length; i++) {
    if (values) {
      result[list[i]] = values[i];
    } else {
      result[list[i][0]] = list[i][1];
    }
  }
  return result;
};

// Generator function to create the findIndex and findLastIndex functions
function createPredicateIndexFinder(dir) {
  return function (array, predicate, context) {
    predicate = cb(predicate, context);
    var length = getLength(array);
    var index = dir > 0 ? 0 : length - 1;
    for (; index >= 0 && index < length; index += dir) {
      if (predicate(array[index], index, array)) return index;
    }
    return -1;
  };
}

// Returns the first index on an array-like that passes a predicate test
_.findIndex = createPredicateIndexFinder(1);
_.findLastIndex = createPredicateIndexFinder(-1);

// Use a comparator function to figure out the smallest index at which
// an object should be inserted so as to maintain order. Uses binary search.
_.sortedIndex = function (array, obj, iteratee, context) {
  iteratee = cb(iteratee, context, 1);
  var value = iteratee(obj);
  var low = 0,
      high = getLength(array);
  while (low < high) {
    var mid = Math.floor((low + high) / 2);
    if (iteratee(array[mid]) < value) low = mid + 1;else high = mid;
  }
  return low;
};

// Generator function to create the indexOf and lastIndexOf functions
function createIndexFinder(dir, predicateFind, sortedIndex) {
  return function (array, item, idx) {
    var i = 0,
        length = getLength(array);
    if (typeof idx == 'number') {
      if (dir > 0) {
        i = idx >= 0 ? idx : Math.max(idx + length, i);
      } else {
        length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;
      }
    } else if (sortedIndex && idx && length) {
      idx = sortedIndex(array, item);
      return array[idx] === item ? idx : -1;
    }
    if (item !== item) {
      idx = predicateFind(slice.call(array, i, length), _.isNaN);
      return idx >= 0 ? idx + i : -1;
    }
    for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {
      if (array[idx] === item) return idx;
    }
    return -1;
  };
}

// Return the position of the first occurrence of an item in an array,
// or -1 if the item is not included in the array.
// If the array is large and already in sort order, pass `true`
// for **isSorted** to use binary search.
_.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);
_.lastIndexOf = createIndexFinder(-1, _.findLastIndex);

// Generate an integer Array containing an arithmetic progression. A port of
// the native Python `range()` function. See
// [the Python documentation](http://docs.python.org/library/functions.html#range).
_.range = function (start, stop, step) {
  if (stop == null) {
    stop = start || 0;
    start = 0;
  }
  step = step || 1;

  var length = Math.max(Math.ceil((stop - start) / step), 0);
  var range = Array(length);

  for (var idx = 0; idx < length; idx++, start += step) {
    range[idx] = start;
  }

  return range;
};

// Function (ahem) Functions
// ------------------

// Determines whether to execute a function as a constructor
// or a normal function with the provided arguments
var executeBound = function executeBound(sourceFunc, boundFunc, context, callingContext, args) {
  if (!(callingContext instanceof boundFunc)) return sourceFunc.apply(context, args);
  var self = baseCreate(sourceFunc.prototype);
  var result = sourceFunc.apply(self, args);
  if (_.isObject(result)) return result;
  return self;
};

// Create a function bound to a given object (assigning `this`, and arguments,
// optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if
// available.
_.bind = function (func, context) {
  if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));
  if (!_.isFunction(func)) throw new TypeError('Bind must be called on a function');
  var args = slice.call(arguments, 2);
  var bound = function bound() {
    return executeBound(func, bound, context, this, args.concat(slice.call(arguments)));
  };
  return bound;
};

// Partially apply a function by creating a version that has had some of its
// arguments pre-filled, without changing its dynamic `this` context. _ acts
// as a placeholder, allowing any combination of arguments to be pre-filled.
_.partial = function (func) {
  var boundArgs = slice.call(arguments, 1);
  var bound = function bound() {
    var position = 0,
        length = boundArgs.length;
    var args = Array(length);
    for (var i = 0; i < length; i++) {
      args[i] = boundArgs[i] === _ ? arguments[position++] : boundArgs[i];
    }
    while (position < arguments.length) {
      args.push(arguments[position++]);
    }return executeBound(func, bound, this, this, args);
  };
  return bound;
};

// Bind a number of an object's methods to that object. Remaining arguments
// are the method names to be bound. Useful for ensuring that all callbacks
// defined on an object belong to it.
_.bindAll = function (obj) {
  var i,
      length = arguments.length,
      key;
  if (length <= 1) throw new Error('bindAll must be passed function names');
  for (i = 1; i < length; i++) {
    key = arguments[i];
    obj[key] = _.bind(obj[key], obj);
  }
  return obj;
};

// Memoize an expensive function by storing its results.
_.memoize = function (func, hasher) {
  var memoize = function memoize(key) {
    var cache = memoize.cache;
    var address = '' + (hasher ? hasher.apply(this, arguments) : key);
    if (!_.has(cache, address)) cache[address] = func.apply(this, arguments);
    return cache[address];
  };
  memoize.cache = {};
  return memoize;
};

// Delays a function for the given number of milliseconds, and then calls
// it with the arguments supplied.
_.delay = function (func, wait) {
  var args = slice.call(arguments, 2);
  return setTimeout(function () {
    return func.apply(null, args);
  }, wait);
};

// Defers a function, scheduling it to run after the current call stack has
// cleared.
_.defer = _.partial(_.delay, _, 1);

// Returns a function, that, when invoked, will only be triggered at most once
// during a given window of time. Normally, the throttled function will run
// as much as it can, without ever going more than once per `wait` duration;
// but if you'd like to disable the execution on the leading edge, pass
// `{leading: false}`. To disable execution on the trailing edge, ditto.
_.throttle = function (func, wait, options) {
  var context, args, result;
  var timeout = null;
  var previous = 0;
  if (!options) options = {};
  var later = function later() {
    previous = options.leading === false ? 0 : _.now();
    timeout = null;
    result = func.apply(context, args);
    if (!timeout) context = args = null;
  };
  return function () {
    var now = _.now();
    if (!previous && options.leading === false) previous = now;
    var remaining = wait - (now - previous);
    context = this;
    args = arguments;
    if (remaining <= 0 || remaining > wait) {
      if (timeout) {
        clearTimeout(timeout);
        timeout = null;
      }
      previous = now;
      result = func.apply(context, args);
      if (!timeout) context = args = null;
    } else if (!timeout && options.trailing !== false) {
      timeout = setTimeout(later, remaining);
    }
    return result;
  };
};

// Returns a function, that, as long as it continues to be invoked, will not
// be triggered. The function will be called after it stops being called for
// N milliseconds. If `immediate` is passed, trigger the function on the
// leading edge, instead of the trailing.
_.debounce = function (func, wait, immediate) {
  var timeout, args, context, timestamp, result;

  var later = function later() {
    var last = _.now() - timestamp;

    if (last < wait && last >= 0) {
      timeout = setTimeout(later, wait - last);
    } else {
      timeout = null;
      if (!immediate) {
        result = func.apply(context, args);
        if (!timeout) context = args = null;
      }
    }
  };

  return function () {
    context = this;
    args = arguments;
    timestamp = _.now();
    var callNow = immediate && !timeout;
    if (!timeout) timeout = setTimeout(later, wait);
    if (callNow) {
      result = func.apply(context, args);
      context = args = null;
    }

    return result;
  };
};

// Returns the first function passed as an argument to the second,
// allowing you to adjust arguments, run code before and after, and
// conditionally execute the original function.
_.wrap = function (func, wrapper) {
  return _.partial(wrapper, func);
};

// Returns a negated version of the passed-in predicate.
_.negate = function (predicate) {
  return function () {
    return !predicate.apply(this, arguments);
  };
};

// Returns a function that is the composition of a list of functions, each
// consuming the return value of the function that follows.
_.compose = function () {
  var args = arguments;
  var start = args.length - 1;
  return function () {
    var i = start;
    var result = args[start].apply(this, arguments);
    while (i--) {
      result = args[i].call(this, result);
    }return result;
  };
};

// Returns a function that will only be executed on and after the Nth call.
_.after = function (times, func) {
  return function () {
    if (--times < 1) {
      return func.apply(this, arguments);
    }
  };
};

// Returns a function that will only be executed up to (but not including) the Nth call.
_.before = function (times, func) {
  var memo;
  return function () {
    if (--times > 0) {
      memo = func.apply(this, arguments);
    }
    if (times <= 1) func = null;
    return memo;
  };
};

// Returns a function that will be executed at most one time, no matter how
// often you call it. Useful for lazy initialization.
_.once = _.partial(_.before, 2);

// Object Functions
// ----------------

// Keys in IE < 9 that won't be iterated by `for key in ...` and thus missed.
var hasEnumBug = !{ toString: null }.propertyIsEnumerable('toString');
var nonEnumerableProps = ['valueOf', 'isPrototypeOf', 'toString', 'propertyIsEnumerable', 'hasOwnProperty', 'toLocaleString'];

function collectNonEnumProps(obj, keys) {
  var nonEnumIdx = nonEnumerableProps.length;
  var constructor = obj.constructor;
  var proto = _.isFunction(constructor) && constructor.prototype || ObjProto;

  // Constructor is a special case.
  var prop = 'constructor';
  if (_.has(obj, prop) && !_.contains(keys, prop)) keys.push(prop);

  while (nonEnumIdx--) {
    prop = nonEnumerableProps[nonEnumIdx];
    if (prop in obj && obj[prop] !== proto[prop] && !_.contains(keys, prop)) {
      keys.push(prop);
    }
  }
}

// Retrieve the names of an object's own properties.
// Delegates to **ECMAScript 5**'s native `Object.keys`
_.keys = function (obj) {
  if (!_.isObject(obj)) return [];
  if (nativeKeys) return nativeKeys(obj);
  var keys = [];
  for (var key in obj) {
    if (_.has(obj, key)) keys.push(key);
  } // Ahem, IE < 9.
  if (hasEnumBug) collectNonEnumProps(obj, keys);
  return keys;
};

// Retrieve all the property names of an object.
_.allKeys = function (obj) {
  if (!_.isObject(obj)) return [];
  var keys = [];
  for (var key in obj) {
    keys.push(key);
  } // Ahem, IE < 9.
  if (hasEnumBug) collectNonEnumProps(obj, keys);
  return keys;
};

// Retrieve the values of an object's properties.
_.values = function (obj) {
  var keys = _.keys(obj);
  var length = keys.length;
  var values = Array(length);
  for (var i = 0; i < length; i++) {
    values[i] = obj[keys[i]];
  }
  return values;
};

// Returns the results of applying the iteratee to each element of the object
// In contrast to _.map it returns an object
_.mapObject = function (obj, iteratee, context) {
  iteratee = cb(iteratee, context);
  var keys = _.keys(obj),
      length = keys.length,
      results = {},
      currentKey;
  for (var index = 0; index < length; index++) {
    currentKey = keys[index];
    results[currentKey] = iteratee(obj[currentKey], currentKey, obj);
  }
  return results;
};

// Convert an object into a list of `[key, value]` pairs.
_.pairs = function (obj) {
  var keys = _.keys(obj);
  var length = keys.length;
  var pairs = Array(length);
  for (var i = 0; i < length; i++) {
    pairs[i] = [keys[i], obj[keys[i]]];
  }
  return pairs;
};

// Invert the keys and values of an object. The values must be serializable.
_.invert = function (obj) {
  var result = {};
  var keys = _.keys(obj);
  for (var i = 0, length = keys.length; i < length; i++) {
    result[obj[keys[i]]] = keys[i];
  }
  return result;
};

// Return a sorted list of the function names available on the object.
// Aliased as `methods`
_.functions = _.methods = function (obj) {
  var names = [];
  for (var key in obj) {
    if (_.isFunction(obj[key])) names.push(key);
  }
  return names.sort();
};

// Extend a given object with all the properties in passed-in object(s).
_.extend = createAssigner(_.allKeys);

// Assigns a given object with all the own properties in the passed-in object(s)
// (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)
_.extendOwn = _.assign = createAssigner(_.keys);

// Returns the first key on an object that passes a predicate test
_.findKey = function (obj, predicate, context) {
  predicate = cb(predicate, context);
  var keys = _.keys(obj),
      key;
  for (var i = 0, length = keys.length; i < length; i++) {
    key = keys[i];
    if (predicate(obj[key], key, obj)) return key;
  }
};

// Return a copy of the object only containing the whitelisted properties.
_.pick = function (object, oiteratee, context) {
  var result = {},
      obj = object,
      iteratee,
      keys;
  if (obj == null) return result;
  if (_.isFunction(oiteratee)) {
    keys = _.allKeys(obj);
    iteratee = optimizeCb(oiteratee, context);
  } else {
    keys = flatten(arguments, false, false, 1);
    iteratee = function iteratee(value, key, obj) {
      return key in obj;
    };
    obj = Object(obj);
  }
  for (var i = 0, length = keys.length; i < length; i++) {
    var key = keys[i];
    var value = obj[key];
    if (iteratee(value, key, obj)) result[key] = value;
  }
  return result;
};

// Return a copy of the object without the blacklisted properties.
_.omit = function (obj, iteratee, context) {
  if (_.isFunction(iteratee)) {
    iteratee = _.negate(iteratee);
  } else {
    var keys = _.map(flatten(arguments, false, false, 1), String);
    iteratee = function iteratee(value, key) {
      return !_.contains(keys, key);
    };
  }
  return _.pick(obj, iteratee, context);
};

// Fill in a given object with default properties.
_.defaults = createAssigner(_.allKeys, true);

// Retrieve all the property names of an object.
_.allKeys = function (obj) {
  if (!_.isObject(obj)) return [];
  var keys = [];
  for (var key in obj) {
    keys.push(key);
  } // Ahem, IE < 9.
  if (hasEnumBug) collectNonEnumProps(obj, keys);
  return keys;
};

var createAssigner = function createAssigner(keysFunc, undefinedOnly) {
  return function (obj) {
    var length = arguments.length;
    if (length < 2 || obj == null) return obj;
    for (var index = 1; index < length; index++) {
      var source = arguments[index],
          keys = keysFunc(source),
          l = keys.length;
      for (var i = 0; i < l; i++) {
        var key = keys[i];
        if (!undefinedOnly || obj[key] === void 0) obj[key] = source[key];
      }
    }
    return obj;
  };
};

// Creates an object that inherits from the given prototype object.
// If additional properties are provided then they will be added to the
// created object.
_.create = function (prototype, props) {
  var result = baseCreate(prototype);
  if (props) _.extendOwn(result, props);
  return result;
};

// Create a (shallow-cloned) duplicate of an object.
_.clone = function (obj) {
  if (!_.isObject(obj)) return obj;
  return _.isArray(obj) ? obj.slice() : _.extend({}, obj);
};

// Invokes interceptor with the obj, and then returns obj.
// The primary purpose of this method is to "tap into" a method chain, in
// order to perform operations on intermediate results within the chain.
_.tap = function (obj, interceptor) {
  interceptor(obj);
  return obj;
};

// Returns whether an object has a given set of `key:value` pairs.
_.isMatch = function (object, attrs) {
  var keys = _.keys(attrs),
      length = keys.length;
  if (object == null) return !length;
  var obj = Object(object);
  for (var i = 0; i < length; i++) {
    var key = keys[i];
    if (attrs[key] !== obj[key] || !(key in obj)) return false;
  }
  return true;
};

// Internal recursive comparison function for `isEqual`.
var eq = function eq(a, b, aStack, bStack) {
  // Identical objects are equal. `0 === -0`, but they aren't identical.
  // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).
  if (a === b) return a !== 0 || 1 / a === 1 / b;
  // A strict comparison is necessary because `null == undefined`.
  if (a == null || b == null) return a === b;
  // Unwrap any wrapped objects.
  if (a instanceof _) a = a._wrapped;
  if (b instanceof _) b = b._wrapped;
  // Compare `[[Class]]` names.
  var className = toString.call(a);
  if (className !== toString.call(b)) return false;
  switch (className) {
    // Strings, numbers, regular expressions, dates, and booleans are compared by value.
    case '[object RegExp]':
    // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')
    case '[object String]':
      // Primitives and their corresponding object wrappers are equivalent; thus, `"5"` is
      // equivalent to `new String("5")`.
      return '' + a === '' + b;
    case '[object Number]':
      // `NaN`s are equivalent, but non-reflexive.
      // Object(NaN) is equivalent to NaN
      if (+a !== +a) return +b !== +b;
      // An `egal` comparison is performed for other numeric values.
      return +a === 0 ? 1 / +a === 1 / b : +a === +b;
    case '[object Date]':
    case '[object Boolean]':
      // Coerce dates and booleans to numeric primitive values. Dates are compared by their
      // millisecond representations. Note that invalid dates with millisecond representations
      // of `NaN` are not equivalent.
      return +a === +b;
  }

  var areArrays = className === '[object Array]';
  if (!areArrays) {
    if ((typeof a === 'undefined' ? 'undefined' : _typeof(a)) != 'object' || (typeof b === 'undefined' ? 'undefined' : _typeof(b)) != 'object') return false;

    // Objects with different constructors are not equivalent, but `Object`s or `Array`s
    // from different frames are.
    var aCtor = a.constructor,
        bCtor = b.constructor;
    if (aCtor !== bCtor && !(_.isFunction(aCtor) && aCtor instanceof aCtor && _.isFunction(bCtor) && bCtor instanceof bCtor) && 'constructor' in a && 'constructor' in b) {
      return false;
    }
  }
  // Assume equality for cyclic structures. The algorithm for detecting cyclic
  // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.

  // Initializing stack of traversed objects.
  // It's done here since we only need them for objects and arrays comparison.
  aStack = aStack || [];
  bStack = bStack || [];
  var length = aStack.length;
  while (length--) {
    // Linear search. Performance is inversely proportional to the number of
    // unique nested structures.
    if (aStack[length] === a) return bStack[length] === b;
  }

  // Add the first object to the stack of traversed objects.
  aStack.push(a);
  bStack.push(b);

  // Recursively compare objects and arrays.
  if (areArrays) {
    // Compare array lengths to determine if a deep comparison is necessary.
    length = a.length;
    if (length !== b.length) return false;
    // Deep compare the contents, ignoring non-numeric properties.
    while (length--) {
      if (!eq(a[length], b[length], aStack, bStack)) return false;
    }
  } else {
    // Deep compare objects.
    var keys = _.keys(a),
        key;
    length = keys.length;
    // Ensure that both objects contain the same number of properties before comparing deep equality.
    if (_.keys(b).length !== length) return false;
    while (length--) {
      // Deep compare each member
      key = keys[length];
      if (!(_.has(b, key) && eq(a[key], b[key], aStack, bStack))) return false;
    }
  }
  // Remove the first object from the stack of traversed objects.
  aStack.pop();
  bStack.pop();
  return true;
};

// Perform a deep comparison to check if two objects are equal.
_.isEqual = function (a, b) {
  return eq(a, b);
};

// Is a given array, string, or object empty?
// An "empty" object has no enumerable own-properties.
_.isEmpty = function (obj) {
  if (obj == null) return true;
  if (isArrayLike(obj) && (_.isArray(obj) || _.isString(obj) || _.isArguments(obj))) return obj.length === 0;
  return _.keys(obj).length === 0;
};

// Is a given value a DOM element?
_.isElement = function (obj) {
  return !!(obj && obj.nodeType === 1);
};

// Is a given value an array?
// Delegates to ECMA5's native Array.isArray
_.isArray = nativeIsArray || function (obj) {
  return toString.call(obj) === '[object Array]';
};

// Is a given variable an object?
_.isObject = function (obj) {
  var type = typeof obj === 'undefined' ? 'undefined' : _typeof(obj);
  return type === 'function' || type === 'object' && !!obj;
};

// Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp, isError.
_.each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp', 'Error'], function (name) {
  _['is' + name] = function (obj) {
    return toString.call(obj) === '[object ' + name + ']';
  };
});

// Optimize `isFunction` if appropriate. Work around some typeof bugs in old v8,
// IE 11 (#1621), and in Safari 8 (#1929).
if (typeof /./ != 'function' && (typeof Int8Array === 'undefined' ? 'undefined' : _typeof(Int8Array)) != 'object') {
  _.isFunction = function (obj) {
    return typeof obj == 'function' || false;
  };
}

// Is a given object a finite number?
_.isFinite = function (obj) {
  return isFinite(obj) && !isNaN(parseFloat(obj));
};

// Is the given value `NaN`? (NaN is the only number which does not equal itself).
_.isNaN = function (obj) {
  return _.isNumber(obj) && obj !== +obj;
};

// Is a given value a boolean?
_.isBoolean = function (obj) {
  return obj === true || obj === false || toString.call(obj) === '[object Boolean]';
};

// Is a given value equal to null?
_.isNull = function (obj) {
  return obj === null;
};

// Is a given variable undefined?
_.isUndefined = function (obj) {
  return obj === void 0;
};

// Shortcut function for checking if an object has a given property directly
// on itself (in other words, not on a prototype).
_.has = function (obj, key) {
  return obj != null && hasOwnProperty.call(obj, key);
};

// Keep the identity function around for default iteratees.
_.identity = function (value) {
  return value;
};

// Predicate-generating functions. Often useful outside of Underscore.
_.constant = function (value) {
  return function () {
    return value;
  };
};

_.noop = function () {};

_.property = property;

// Generates a function for a given object that returns a given property.
_.propertyOf = function (obj) {
  return obj == null ? function () {} : function (key) {
    return obj[key];
  };
};

// Returns a predicate for checking whether an object has a given set of
// `key:value` pairs.
_.matcher = _.matches = function (attrs) {
  attrs = _.extendOwn({}, attrs);
  return function (obj) {
    return _.isMatch(obj, attrs);
  };
};

// Run a function **n** times.
_.times = function (n, iteratee, context) {
  var accum = Array(Math.max(0, n));
  iteratee = optimizeCb(iteratee, context, 1);
  for (var i = 0; i < n; i++) {
    accum[i] = iteratee(i);
  }return accum;
};

// Return a random integer between min and max (inclusive).
_.random = function (min, max) {
  if (max == null) {
    max = min;
    min = 0;
  }
  return min + Math.floor(Math.random() * (max - min + 1));
};

// A (possibly faster) way to get the current timestamp as an integer.
_.now = Date.now || function () {
  return new Date().getTime();
};

// List of HTML entities for escaping.
var escapeMap = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#x27;',
  '`': '&#x60;'
};
var unescapeMap = _.invert(escapeMap);

// Functions for escaping and unescaping strings to/from HTML interpolation.
var createEscaper = function createEscaper(map) {
  var escaper = function escaper(match) {
    return map[match];
  };
  // Regexes for identifying a key that needs to be escaped
  var source = '(?:' + _.keys(map).join('|') + ')';
  var testRegexp = RegExp(source);
  var replaceRegexp = RegExp(source, 'g');
  return function (string) {
    string = string == null ? '' : '' + string;
    return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;
  };
};
_.escape = createEscaper(escapeMap);
_.unescape = createEscaper(unescapeMap);

// If the value of the named `property` is a function then invoke it with the
// `object` as context; otherwise, return it.
_.result = function (object, property, fallback) {
  var value = object == null ? void 0 : object[property];
  if (value === void 0) {
    value = fallback;
  }
  return _.isFunction(value) ? value.call(object) : value;
};

// Generate a unique integer id (unique within the entire client session).
// Useful for temporary DOM ids.
var idCounter = 0;
_.uniqueId = function (prefix) {
  var id = ++idCounter + '';
  return prefix ? prefix + id : id;
};

// By default, Underscore uses ERB-style template delimiters, change the
// following template settings to use alternative delimiters.
_.templateSettings = {
  evaluate: /<%([\s\S]+?)%>/g,
  interpolate: /<%=([\s\S]+?)%>/g,
  escape: /<%-([\s\S]+?)%>/g
};

// When customizing `templateSettings`, if you don't want to define an
// interpolation, evaluation or escaping regex, we need one that is
// guaranteed not to match.
var noMatch = /(.)^/;

// Certain characters need to be escaped so that they can be put into a
// string literal.
var escapes = {
  "'": "'",
  '\\': '\\',
  '\r': 'r',
  '\n': 'n',
  '\u2028': 'u2028',
  '\u2029': 'u2029'
};

var escaper = /\\|'|\r|\n|\u2028|\u2029/g;

var escapeChar = function escapeChar(match) {
  return '\\' + escapes[match];
};

// JavaScript micro-templating, similar to John Resig's implementation.
// Underscore templating handles arbitrary delimiters, preserves whitespace,
// and correctly escapes quotes within interpolated code.
// NB: `oldSettings` only exists for backwards compatibility.
_.template = function (text, settings, oldSettings) {
  if (!settings && oldSettings) settings = oldSettings;
  settings = _.defaults({}, settings, _.templateSettings);

  // Combine delimiters into one regular expression via alternation.
  var matcher = RegExp([(settings.escape || noMatch).source, (settings.interpolate || noMatch).source, (settings.evaluate || noMatch).source].join('|') + '|$', 'g');

  // Compile the template source, escaping string literals appropriately.
  var index = 0;
  var source = "__p+='";
  text.replace(matcher, function (match, escape, interpolate, evaluate, offset) {
    source += text.slice(index, offset).replace(escaper, escapeChar);
    index = offset + match.length;

    if (escape) {
      source += "'+\n((__t=(" + escape + "))==null?'':_.escape(__t))+\n'";
    } else if (interpolate) {
      source += "'+\n((__t=(" + interpolate + "))==null?'':__t)+\n'";
    } else if (evaluate) {
      source += "';\n" + evaluate + "\n__p+='";
    }

    // Adobe VMs need the match returned to produce the correct offest.
    return match;
  });
  source += "';\n";

  // If a variable is not specified, place data values in local scope.
  if (!settings.variable) source = 'with(obj||{}){\n' + source + '}\n';

  source = "var __t,__p='',__j=Array.prototype.join," + "print=function(){__p+=__j.call(arguments,'');};\n" + source + 'return __p;\n';

  try {
    var render = new Function(settings.variable || 'obj', '_', source);
  } catch (e) {
    e.source = source;
    throw e;
  }

  var template = function template(data) {
    return render.call(this, data, _);
  };

  // Provide the compiled source as a convenience for precompilation.
  var argument = settings.variable || 'obj';
  template.source = 'function(' + argument + '){\n' + source + '}';

  return template;
};

// Add a "chain" function. Start chaining a wrapped Underscore object.
_.chain = function (obj) {
  var instance = _(obj);
  instance._chain = true;
  return instance;
};

// OOP
// ---------------
// If Underscore is called as a function, it returns a wrapped object that
// can be used OO-style. This wrapper holds altered versions of all the
// underscore functions. Wrapped objects may be chained.

// Helper function to continue chaining intermediate results.
var result = function result(instance, obj) {
  return instance._chain ? _(obj).chain() : obj;
};

// Add your own custom functions to the Underscore object.
_.mixin = function (obj) {
  _.each(_.functions(obj), function (name) {
    var func = _[name] = obj[name];
    _.prototype[name] = function () {
      var args = [this._wrapped];
      push.apply(args, arguments);
      return result(this, func.apply(_, args));
    };
  });
};

// Add all of the Underscore functions to the wrapper object.
_.mixin(_);

// Add all mutator Array functions to the wrapper.
_.each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function (name) {
  var method = ArrayProto[name];
  _.prototype[name] = function () {
    var obj = this._wrapped;
    method.apply(obj, arguments);
    if ((name === 'shift' || name === 'splice') && obj.length === 0) delete obj[0];
    return result(this, obj);
  };
});

// Add all accessor Array functions to the wrapper.
_.each(['concat', 'join', 'slice'], function (name) {
  var method = ArrayProto[name];
  _.prototype[name] = function () {
    return result(this, method.apply(this._wrapped, arguments));
  };
});

// Extracts the result from a wrapped and chained object.
_.prototype.value = function () {
  return this._wrapped;
};

// Provide unwrapping proxy for some methods used in engine operations
// such as arithmetic and JSON stringification.
_.prototype.valueOf = _.prototype.toJSON = _.prototype.value;

_.prototype.toString = function () {
  return '' + this._wrapped;
};

if (true) {
  module.exports = _;
}

/***/ }),
/* 12 */
/***/ (function(module, exports) {

module.exports = require("fs");

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = {

  loadScript: function loadScript(requirement, helper, error) {
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.onerror = error;
    script.onreadystatechange = function () {
      if (this.readyState == 'complete') {
        helper(script, __src);
      }
    };
    script.addEventListener("load", helper, true);
    script.src = requirement;
    head.appendChild(script);
  },
  scriptURL: function scriptURL() {

    if (document.currentScript) {
      return document.currentScript.src;
    }
    var scripts = document.getElementsByTagName('script');
    for (var i = scripts.length - 1; i--;) {
      if (scripts[i].src) {
        return scripts[i].src;
      }
    }
    return false;
  }
};

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var deepDiffMapper = {
  VALUE_CREATED: 'created',
  VALUE_UPDATED: 'updated',
  VALUE_DELETED: 'deleted',
  VALUE_UNCHANGED: 'unchanged',
  map: function map(obj1, obj2) {
    if (this.isFunction(obj1) || this.isFunction(obj2)) {
      throw 'Invalid argument. Function given, object expected.';
    }
    if (this.isValue(obj1) || this.isValue(obj2)) {
      return {
        '_map_type': this.compareValues(obj1, obj2),
        '_map_data': obj2 === undefined ? obj1 : obj2
      };
    }

    if (_.isArray(obj2)) {
      var _array = true;
      var diff = [];
    } else {
      var diff = {};
    }

    for (var key in obj1) {
      if (this.isFunction(obj1[key])) {
        continue;
      }

      var value2 = undefined;
      if ('undefined' != typeof obj2[key]) {
        value2 = obj2[key];
      }

      diff[key] = this.map(obj1[key], value2);
    }
    for (var key in obj2) {
      if (this.isFunction(obj2[key]) || 'undefined' != typeof diff[key]) {
        continue;
      }

      var _val = this.map(undefined, obj2[key]);
      if (_array) {
        diff.push(_val);
      } else {
        diff[key] = _val;
      }
    }

    return {
      '_map_type': '',
      '_map_data': diff
    };
  },
  compareValues: function compareValues(value1, value2) {
    if (value1 === value2) {
      return this.VALUE_UNCHANGED;
    }
    if ('undefined' == typeof value1) {
      return this.VALUE_CREATED;
    }
    if ('undefined' == typeof value2) {
      return this.VALUE_DELETED;
    }

    return this.VALUE_UPDATED;
  },
  isFunction: function isFunction(obj) {
    return {}.toString.apply(obj) === '[object Function]';
  },
  isArray: function isArray(obj) {
    return {}.toString.apply(obj) === '[object Array]';
  },
  isObject: function isObject(obj) {
    return {}.toString.apply(obj) === '[object Object]';
  },
  isValue: function isValue(obj) {
    return !this.isObject(obj) && !this.isArray(obj);
  }
};

module.exports = {
  differenceMap: deepDiffMapper.map.bind(deepDiffMapper),
  syntaxHighlight: function syntaxHighlight(json) {
    if (typeof json != 'string') {
      json = JSON.stringify(json, null, 2);
    }
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

    json = json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
      var cls = 'number';
      if (/^"/.test(match)) {
        if (/:$/.test(match)) {
          cls = 'key';
        } else {
          cls = 'string';
        }
      } else if (/true|false/.test(match)) {
        cls = 'boolean';
      } else if (/null/.test(match)) {
        cls = 'null';
      }
      return '<span class="' + cls + '">' + match + '</span>';
    });
    return json = json.replace(/[^,\n][^\n]*/g, function (match) {
      return '<span>' + match + '</span>';
    });
  },
  differenceHighlight: function differenceHighlight(json, output) {

    if (output) {
      output.empty();
    } else {
      output = $("<pre>");
    }

    function printObject(json, level, output, comma, objectIndex) {
      var _el = $("<p>");

      _el.append($("<span>").addClass("object-key").append($("<span>").text(new Array(level).join(' '))));
      if (objectIndex) {
        _el.append($("<span>").text('"').addClass("invisible"), $("<span>").addClass("key").text(objectIndex), $("<span>").text('"').addClass("invisible"), $("<span>").text(': '));
      }

      if (json && json._map_type !== undefined) {
        _el.addClass(json._map_type);

        if (_.isArray(json._map_data)) {
          _el.append($("<span>").text("["));
          var _last_key = json._map_data.length - 1;
          for (var i in json._map_data) {
            printObject(json._map_data[i], level + 1, _el, i != _last_key);
          }
          _el.append($("<p>").text(new Array(level).join(' ') + "]" + (comma ? "," : "")));
        } else if (_.isObject(json._map_data)) {
          _el.append($("<span>").text("{"));
          var _last_key = Object.keys(json._map_data).pop();
          for (var i in json._map_data) {
            printObject(json._map_data[i], level + 1, _el, i != _last_key, i);
          }
          _el.append($("<p>").text(new Array(level).join(' ') + "}" + (comma ? "," : "")));
        } else {

          if (_.isNull(json._map_data)) {
            _el.append($("<span>").text(JSON.stringify(json._map_data, null, 2)));
          } else if (json._map_data.constructor === String) {
            _el.append($("<span>").text('"'), $("<span>").addClass('string').text(json._map_data), $("<span>").text('"'));
          } else if (json._map_data.constructor === Number || json._map_data.constructor === Boolean) {
            _el.append($("<span>").addClass('number').text(json._map_data));
          } else {
            _el.append($("<span>").text(JSON.stringify(json._map_data, null, 2)));
          }
          if (comma) {
            _el.append($("<span>").text(","));
          }
        }
      } else {
        _el.append($("<span>").text(JSON.stringify(json, null, 2)));

        if (comma) {
          _el.append($("<span>").text(","));
        }
      }

      output.append(_el);
    }
    printObject(json, 1, output);
    return output;
  }
};

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = {
  map: function map(data, foo) {

    if (data.constructor == Array) {
      return Promise.all(data.map(foo)).then(function (results, error) {
        if (error) {
          return Promise.reject(error);
        }
        return Promise.resolve(results);
      });
    }

    var keys = Object.keys(data);
    var urls = Object.values(data);
    return Promise.all(urls.map(foo)).then(function (results, error) {
      if (error) {
        return Promise.reject(error);
      }
      var _map = {};

      for (var i = 0; i < results.length; i++) {
        _map[keys[i]] = results[i];
      }
      return Promise.resolve(_map);
    });
  },
  wrap: function wrap(context) {
    return function wrap(foo) {
      return function () {
        var options = Array.prototype.slice.call(arguments, 1);
        if (!foo.length) {
          return new Promise(function (resolve, fail) {
            var _result = foo.call(context);
            _result || _result === undefined ? resolve() : fail();
          });
        } else {
          return new Promise(foo.bind(context));
        }
      };
    };
  }
};

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!String.prototype.splice) {
  /**
   * {JSDoc}
   *
   * The splice() method changes the content of a string by removing a range of
   * characters and/or adding new characters.
   *
   * @this {String}
   * @param {number} start Index at which to start changing the string.
   * @param {number} delCount An integer indicating the number of old chars to remove.
   * @param {string} newSubStr The String that is spliced in.
   * @return {string} A new string with the spliced substring.
   */
  String.prototype.splice = function (start, delCount, newSubStr) {
    return this.slice(0, start) + newSubStr + this.slice(start + Math.abs(delCount));
  };
}

fabric.util.string.toDashed = function (str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
};

fabric.util.string.uncapitalize = function (string) {
  return string.charAt(0).toLowerCase() + string.slice(1);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.util.object, __webpack_require__(3));
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.util, {
  idCounter: 1,
  createObject: function createObject(type, options, callback) {
    if (typeof type !== "string") {
      callback = options;
      options = type;
      type = null;
    } else {
      options.type = type;
    }
    var app = options.application;
    app && app.fire("entity:load", { options: options });

    var _klassName = fabric.util.string.camelize(fabric.util.string.capitalize(type || options.type || app.prototypes.Object.type, true));
    var _klass = options.application.klasses[_klassName] || fabric[_klassName];

    if (!_klass) {
      console.warn(_klassName + " is undefined");

      var _text = options.text && options.text.constructor == String ? options.text : _klassName;
      delete options.text;
      return callback(new fabric.Text(_text, options));
    }

    var el = _klass.fromObject(options, function (el) {
      callback && callback(el);
      callback = null;
    });
    if (el) {
      callback && callback(el);
      callback = null;
    }
    return el;
  },
  getProportions: function getProportions(photo, container, mode) {
    mode = mode || 'fit';
    var _w = photo.naturalWidth || photo.width;
    var _h = photo.naturalHeight || photo.height;
    if (!container.height && !container.width) {
      return {
        scale: 1,
        width: _w,
        height: _h
      };
    }
    if (!photo.height && !photo.width) {
      return {
        scale: 0.001,
        width: container.width,
        height: container.height
      };
    }

    // var _asp = _w / _h, _c_asp = container.width / container.height;

    // if (_asp > _c_asp) {
    //   _h = container.height;
    //   _w = _h * _asp;
    //
    // } else {
    //   _w = container.width;
    //   _h = _w / _asp;
    // }
    // var scaleX = container.width / _w;
    // var scaleY = container.height / _h;
    var scaleX = container.width && container.width / _w || 999;
    var scaleY = container.height && container.height / _h || 999;

    var scale;
    if (mode === 'cover') {
      scale = Math.max(scaleX, scaleY);
    }
    if (mode === 'fit') {
      scale = Math.min(scaleX, scaleY);
    }
    if (mode === 'center') {
      scale = 1;
    }
    return {
      scale: scale,
      width: Math.floor(_w * scale),
      height: Math.floor(_h * scale)
    };
  },

  createCanvasElementWithSize: function createCanvasElementWithSize(size) {
    var canvas = fabric.util.createCanvasElement();
    canvas.width = size.width;
    canvas.height = size.height;
    return canvas;
  },

  getRect: function getRect(width, height, options) {
    var rect = {};

    var _flexArray = fabric.util.flex(width, [{ value: options.left, flex: 0 }, { value: options.width, flex: 1 }, { value: options.right, flex: 0 }]);
    rect.left = _flexArray[0];
    rect.width = _flexArray[1];
    rect.right = _flexArray[2];

    var _flexArray = fabric.util.flex(height, [{ value: options.top, flex: 0 }, { value: options.height, flex: 1 }, { value: options.bottom, flex: 0 }]);
    rect.top = _flexArray[0];
    rect.height = _flexArray[1];
    rect.bottom = _flexArray[2];

    return rect;
  },
  /**
   * will divide total width for every object in columnts array
   *
   *
   * @example
   *     var _flexArray = fabric.util.flex(200 , [{flex: 0},{value: 100, flex: 1},{flex: 0}] );
   * @param total
   * @param columns
   * @returns {Array}
   * @example [50,100,50]
   */
  flex: function flex(total, columns) {
    var _return = [];
    var split = 0;
    columns.forEach(function (column, index) {
      if (column.value === undefined) {
        split++;
      } else {
        total -= column.value;
      }
    });
    var _w = total / split;
    columns.forEach(function (column) {
      _return.push(column.value === undefined ? _w : column.value);
    });
    return _return;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * @private
 * @param {String} eventName
 * @param {Function} handler
 */

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function _removeEventListener(eventName, handler) {
  if (!this.__eventListeners[eventName]) {
    return;
  }
  var eventListener = this.__eventListeners[eventName];
  if (handler) {
    eventListener.splice(eventListener.indexOf(handler), 1);
  } else {
    eventListener.length = 0;
  }
}

fabric.Observable.stopObserving = function stopObserving(eventName, handler) {
  if (!this.__eventListeners) {
    return;
  }

  // remove all key/value pairs (event name -> event handler)
  if (arguments.length === 0) {
    for (eventName in this.__eventListeners) {
      _removeEventListener.call(this, eventName);
    }
  }
  // one object with key/value pairs was passed
  else if (arguments.length === 1 && _typeof(arguments[0]) === 'object') {
      for (var prop in eventName) {
        _removeEventListener.call(this, prop, eventName[prop]);
      }
    } else {
      _removeEventListener.call(this, eventName, handler);
    }
  return this;
};

fabric.Observable.on = function (eventName, handler, priority) {
  if (eventName.constructor == Object) {
    for (var i in eventName) {
      this.on(i, eventName[i], priority);
    }
    return this;
  }
  var events = eventName.split(" ");
  for (var i in events) {
    eventName = events[i];
    this.observe(eventName, handler);
    if (priority) {
      this.__eventListeners[eventName].unshift(this.__eventListeners[eventName].pop());
    }
  }
  return this;
};

fabric.Observable.off = function (eventName, handler) {
  var events = eventName.split(" ");
  for (var i in events) {
    this.stopObserving(events[i], handler);
  }
  return this;
};

fabric.Observable.fire = function fire(eventName, options) {
  if (!this.__eventListeners) {
    return;
  }

  var listenersForEvent = this.__eventListeners[eventName];
  if (listenersForEvent) {
    for (var i = 0, len = listenersForEvent.length; i < len; i++) {
      listenersForEvent[i].call(this, options || {});
    }
  }

  var listenersForEventAll = this.__eventListeners['*'];
  if (listenersForEventAll) {
    options = options || {};
    options.eventName = eventName;
    options.listeners = listenersForEvent;
    for (i = 0, len = listenersForEventAll.length; i < len; i++) {
      listenersForEventAll[i].call(this, options);
    }
  }

  return this;
};

fabric.util.object.extend(fabric.Object.prototype, fabric.Observable);
fabric.util.object.extend(fabric.IText.prototype, fabric.Observable);
fabric.util.object.extend(fabric.Textbox.prototype, fabric.Observable);
fabric.util.object.extend(fabric.Image.prototype, fabric.Observable);
fabric.util.object.extend(fabric.Canvas.prototype, fabric.Observable);
fabric.util.object.extend(fabric, fabric.Observable);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var isVML = function isVML() {
  return typeof G_vmlCanvasManager !== 'undefined';
};

//weird stuff
// delete fabric.Rect.prototype.toObject;
// fabric.Rect.prototype.storeProperties = ["*","rx","ry"];


fabric.Object._fromObject = function (className, object, callback, forceAsync, extraParam) {
  var klass = fabric[className];
  var _app = object.application;
  delete object.application;
  object = fabric.util.object.clone(object, true);
  object.application = _app;
  if (forceAsync) {
    fabric.util.enlivenPatterns([object.fill, object.stroke], function (patterns) {
      if (typeof patterns[0] !== 'undefined') {
        object.fill = patterns[0];
      }
      if (typeof patterns[1] !== 'undefined') {
        object.stroke = patterns[1];
      }
      var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);
      callback && callback(instance);
    });
  } else {
    var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);
    callback && callback(instance);
    return instance;
  }
};

fabric.INCLUDE_ALL = "*";

fabric.util.object.extend(fabric.Object.prototype, {
  storeProperties: ["type"],
  eventListeners: {},
  optionsOrder: ["*"],
  setEventListeners: function setEventListeners(val) {
    this.on(val);
  },
  set: function set(key, value) {
    if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
      this._setObject(key, value);
    } else {
      if (key[0] === "&") {
        key = key.substr(1);
        this._set(key, value(this.get(key)));
      } else {
        this._set(key, value);
      }
    }
    return this;
  },
  _setObject: function _setObject(options, callback) {
    var keys = Object.keys(options);
    if (this.optionsOrder) {
      var middleIndex = this.optionsOrder.indexOf("*") || -1;

      var i = middleIndex,
          prop,
          keyIndex;

      while (prop = this.optionsOrder[--i]) {
        if ((keyIndex = keys.indexOf(prop)) !== -1) {
          keys.splice(keyIndex, 1);
          keys.unshift(prop);
        }
      }
      i = middleIndex;
      while (prop = this.optionsOrder[++i]) {
        if ((keyIndex = keys.indexOf(prop)) !== -1) {
          keys.splice(keyIndex, 1);
          keys.push(prop);
        }
      }
    }
    /*  for (var i = 0; i < keys.length; i++) {
        var prop = keys[i];
        if(typeof options[prop] == "function"){
          keys.splice(i, 1);
          keys.unshift(prop);
        }
      }*/
    var queue;
    for (var i in keys) {
      var _key = keys[i];
      if (options[_key] === undefined) continue;

      var _fooName = "set" + fabric.util.string.capitalize(_key, true);
      if (this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous") {
        if (this[_fooName].length == 2) {
          if (!queue) {
            queue = fabric.util.queueLoad(2, callback);
          } else {
            queue.total++;
          }
          this[_fooName](options[_key], function (_key) {
            queue();
          }.bind(this, _key));
        } else {
          this[_fooName](options[_key]);
        }
      } else {
        this.__set(_key, options[_key]);
      }
    }
    if (queue) {
      queue();
    } else if (callback) {
      callback();
    }
  },
  __set: fabric.Object.prototype._set,
  _set: function _set(key, value, callback) {
    var _fooName = "set" + fabric.util.string.capitalize(key, true);
    if (this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous") {
      // if (this.specialProperties.indexOf(key) !== -1) {
      // if(this[_fooName]){
      this[_fooName](value, callback);
    } else {
      this.__set(key, value);
    }
    return this;
  },
  setAngle: function setAngle(angle) {
    this.angle = angle;
  },
  setShadow: function setShadow(options) {
    return this.shadow = options ? new fabric.Shadow(options) : null;
  },
  disable: function disable() {
    this.set({
      selectable: false,
      evented: false,
      hasControls: false,
      lockMovementX: true,
      lockMovementY: true
    });
  },
  stored: true,
  store_left: function store_left() {
    return fabric.util.toFixed(this.left, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_top: function store_top() {
    return fabric.util.toFixed(this.top, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_width: function store_width() {
    return fabric.util.toFixed(this.width, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_height: function store_height() {
    return fabric.util.toFixed(this.height, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_fill: function store_fill() {
    return this.fill && this.fill.toObject ? this.fill.toObject() : this.fill;
  },
  store_stroke: function store_stroke() {
    return this.stroke && this.stroke.toObject ? this.stroke.toObject() : this.stroke;
  },
  store_strokeWidth: function store_strokeWidth() {
    return fabric.util.toFixed(this.strokeWidth, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_strokeDashArray: function store_strokeDashArray() {
    return this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray;
  },
  store_strokeMiterLimit: function store_strokeMiterLimit() {
    return fabric.util.toFixed(this.strokeMiterLimit, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_scaleX: function store_scaleX() {
    return fabric.util.toFixed(this.scaleX, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_scaleY: function store_scaleY() {
    return fabric.util.toFixed(this.scaleY, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_angle: function store_angle() {
    return fabric.util.toFixed(this.getAngle(), fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_opacity: function store_opacity() {
    return fabric.util.toFixed(this.opacity, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_shadow: function store_shadow() {
    return this.shadow && this.shadow.toObject ? this.shadow.toObject() : this.shadow;
  },
  store_clipTo: function store_clipTo() {
    return this.clipTo && (this.clipTo.id && '#' + this.clipTo.id || this.clipTo) || null;
  },
  store_transformMatrix: function store_transformMatrix() {
    return this.transformMatrix ? this.transformMatrix.concat() : null;
  },
  store_skewX: function store_skewX() {
    return fabric.util.toFixed(this.skewX, fabric.Object.NUM_FRACTION_DIGITS);
  },
  store_skewY: function store_skewY() {
    return fabric.util.toFixed(this.skewY, fabric.Object.NUM_FRACTION_DIGITS);
  },

  toObject: function toObject(propertiesToInclude) {
    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties).concat(this.stateProperties);
    var object = this.getProperties(propertiesToInclude);
    if (!this.includeDefaultValues) {
      object = this._removeDefaultValues(object, this.type);
    }
    this.fire("before:object", { object: object });
    return object;
  },
  /**
   * Sets object's properties from options
   * @param {Object} [options] Options object
   */
  setOptions: function setOptions(options) {
    this._setObject(options);
    // this._initGradient(options);
    // this._initPattern(options);
    // this._initClipping(options);
  },
  _initEntity: function _initEntity(options) {
    if (options.canvas && !options.application) {
      options.application = options.canvas.application;
    }
    options.application && options.application.fire("entity:created", { target: this, options: options });
  },
  initialize: function initialize(options, callback) {
    options = options || {};
    this._initEntity(options);
    // if(options.wholeCoordinates){
    //   var coordinates = ["left","top","width","height"];
    //   for(var i in coordinates){
    //     if(options[coordinates[i]]){
    //       options[coordinates[i]] = Math.round(options[coordinates[i]]);
    //     }
    //   }
    // }
    var _self = this;
    this._setObject(options, function () {
      _self.loaded = true;
      _self.fire("loaded");
      callback && callback(_self);
    });
  },
  add: function add(canvas) {
    canvas.add(this);
  },
  hasBoundsControls: true,
  stroke: "transparent",
  stepRotating: function stepRotating() {
    var b = this.getAngle(),
        a = 45 * parseInt(b / 45);
    5 > b - a ? this.setAngle(a) : 40 < b - a && this.setAngle(a + 45);
  },
  onTop: function onTop() {
    return this.canvas._objects.indexOf(this) == this.canvas._objects.length - 1;
  },
  onBottom: function onBottom() {
    return this.canvas._objects.indexOf(this) == 0;
  },
  flop: function flop() {
    this.flipY = !this.flipY;
    this.canvas.renderAll();
  },
  flip: function flip() {
    this.flipX = !this.flipX;
    this.canvas.renderAll();
  },
  duplicate: function duplicate() {
    // var _includeDefaultValues = this.includeDefaultValues;
    // this.includeDefaultValues = true;
    var _object = this.toObject();
    // this.includeDefaultValues = _includeDefaultValues;
    _object.active = true;
    _object.left += 10;
    _object.top += 10;
    var _clone = /*this.cloneSync && this.cloneSync() || */this.canvas.createObject(_object);
    return _clone;
  },
  _normalizeAngle: function _normalizeAngle() {
    if (this.angle < 0) {
      this.angle += 360;
    } else if (this.angle > 360) {
      this.angle %= 360;
    }
  },
  minStrokeWidth: 0,
  maxStrokeWidth: function maxStrokeWidth() {
    return Math.min(this.width, this.height) / 2;
  },
  movementDelta: 1,
  moveUp: function moveUp() {
    this.top -= this.movementDelta;
    this.canvas.renderAll();
  },
  moveDown: function moveDown() {
    this.top += this.movementDelta;
    this.canvas.renderAll();
  },
  moveLeft: function moveLeft() {
    this.left -= this.movementDelta;
    this.canvas.renderAll();
  },
  moveRight: function moveRight() {
    this.left += this.movementDelta;
    this.canvas.renderAll();
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(22);

fabric.util.object.extend(fabric.Image.prototype, fabric.ImageMixin, {
  filters: null,
  resizeFilters: null,
  originalSrc: null,
  storeProperties: fabric.Object.prototype.storeProperties.concat(["filters", "resizeFilters", "originalSrc", "src", "contentOffsets"]),
  store_originalSrc: function store_originalSrc() {
    return this._edited ? this._original_src || this._originalElement.src || this._element.src : null;
  },
  store_src: function store_src() {
    var src = void 0;
    if (this._edited) {
      src = this._element.src;
    } else {
      src = this._original_src || this._originalElement.src || this._element.src;
    }
    if (src.indexOf(fabric.util.mediaRoot) === 0) {
      src = src.replace(fabric.util.mediaRoot, "");
    }
    return src;
  },
  store_filters: function store_filters() {
    var filters = [];
    var scaleX = 1,
        scaleY = 1;
    this.filters.forEach(function (filterObj) {
      if (filterObj) {
        if (filterObj.type === 'Resize') {
          scaleX *= filterObj.scaleX;
          scaleY *= filterObj.scaleY;
        }
        filters.push(filterObj.toObject());
      }
    });
    return filters.length && filters || null;
  },
  store_resizeFilters: function store_resizeFilters() {
    var resizeFilters = [];
    this.resizeFilters.forEach(function (filterObj) {
      filterObj && resizeFilters.push(filterObj.toObject());
    });
    return resizeFilters.length && resizeFilters || null;
  },
  setSrc: function setSrc(opt) {
    // console.log(opt);
  },
  toObject: fabric.Object.prototype.toObject,
  //   var obj = this._toObjectNative.call(this, toInclude);
  //
  //
  //   // if (this.contentOffsets) {
  //   //   obj.contentOffsets = this.contentOffsets;
  //   // }
  //   // //
  //   // if (!this.includeDefaultValues) {
  //   //   if (!obj.filters.length) delete obj.filters;
  //   //   if (!obj.resizeFilters.length) delete obj.resizeFilters;
  //   // }
  //   //if(this._originalElement){
  //   //    obj.thumb = this._element.src;
  //   //}
  //
  //   this._beforeObject(obj,toInclude);
  //   return obj;
  // },
  async: true,
  initialize: function initialize(element, options, callback) {
    options || (options = {});
    this.filters = [];
    this.resizeFilters = [];

    if (options.originalSrc) {
      this._edited = true;
      fabric.util.loadImage(options.originalSrc, function (img) {
        this._originalElement = img;
      }.bind(this));
    }

    this._initElement(element, options, callback && function () {
      fabric.Object.prototype.initialize.call(this, options, callback);
    }.bind(this)); //adding callback
  },

  _initElement: function _initElement(element, options, callback) {
    this.setElement(fabric.util.getById(element), callback, options);
    fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);
  },
  /**
   * Sets crossOrigin value (on an instance and corresponding image element)
   * @return {fabric.Image} thisArg
   * @chainable
   */
  setCrossOrigin: function setCrossOrigin(value) {
    this.crossOrigin = value;
    if (this._element) {
      this._element.crossOrigin = value;
    }
    return this;
  },
  setElement: function setElement(element, callback, options) {

    var _callback, _this;

    this._element = element;
    this._originalElement = element;
    this._initConfig(options);
    // this.setOptions(options );
    // this._setWidthHeight(this);
    // if (this._element && this.crossOrigin) {
    //   this._element.crossOrigin = this.crossOrigin;
    // }


    if (this.resizeFilters.length === 0) {
      _callback = callback;
    } else {
      _this = this;
      _callback = function _callback() {
        _this.applyFilters(callback, _this.resizeFilters, _this._filteredEl || _this._originalElement, true);
      };
    }

    if (this.filters.length !== 0) {
      this.applyFilters(_callback);
    } else if (_callback) {
      _callback(this);
    }
    if (this.canvas) {
      this.canvas.renderAll();
    }
    return this;
  },
  cloneSync: function cloneSync() {
    return new fabric.Image(this._element, this);
  }
});

fabric.util.initFilters = function (img, object, callback) {

  // if (fabric.version >= 1.6) {


  for (var i in object.filters) {
    object.filters[i].type = fabric.util.string.capitalize(fabric.util.string.camelize(object.filters[i].type), true);
  }

  fabric.Image.prototype._initFilters.call(object, object.filters, function (filters) {
    object.filters = filters || [];
    fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function (resizeFilters) {
      object.resizeFilters = resizeFilters || [];
      callback(img, object);
    });
  });
  // } else {
  //   fabric.Image.prototype._initFilters.call(object, object, function (filters) {
  //     object.filters = filters || [];
  //     callback(img, object);
  //   });
  // }
};

fabric.util.initImageAndFilters = function (object, callback) {
  if (object.image) {
    var img = object.image;
    delete object.src;
    delete object.image;
    fabric.util.initFilters(img, object, callback);
  } else if (object.src) {
    fabric.util.loadImage(object.src, function (img) {
      //delete object.src;
      fabric.util.initFilters(img, object, callback);
    }, null, object.crossOrigin);
  } else {
    fabric.util.initFilters(null, object, callback);
  }
};

fabric.Image.fromObject = function (object, callback) {
  fabric.util.initImageAndFilters(object, function (img, object) {
    new fabric.Image(img, object, callback);
  });
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.ImageMixin = {
  setElementFromMenu: function setElementFromMenu(data) {
    this.setElement(data.image);
  },
  initProportinalSize: true,
  /**
   * @private
   * @param {Object} [options] Object with width/height properties
   */
  _setWidthHeight: function _setWidthHeight(options) {
    if (this.element || this._element) {
      var _size = this.getOriginalSize();
    } else {
      _size = {};
    }
    if ('width' in options) {
      this.width = options.width;
    } else {
      if (!_size.width) {
        this.width = 100;
      } else {
        if (this.initProportinalSize && 'height' in options) {
          this.width = options.height / _size.height * _size.width;
        } else {
          this.width = _size.width;
        }
      }
    }

    if ('height' in options) {
      this.height = options.height;
    } else {
      if (!_size.height) {
        this.height = 100;
      } else {
        if (this.initProportinalSize && 'width' in options) {
          this.height = options.width / _size.width * _size.height;
        } else {
          this.height = _size.height;
        }
      }
    }
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _set_dimensions_overwritten = fabric.Canvas.prototype.setDimensions;

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  optionsOrder: [],
  __set: fabric.Object.prototype.__set,
  _set: fabric.Object.prototype._set,
  _setObject: fabric.Object.prototype._setObject,
  get: fabric.Object.prototype.get,
  set: fabric.Object.prototype.set
});

fabric.util.object.extend(fabric.Object.prototype, {
  layer: "objects"
});
fabric.util.object.extend(fabric.Canvas.prototype, {
  //  optionsOrder: ["*"],
  originalState: {},
  stateProperties: [],
  editingObject: null,
  /**
   * Select object which is over the selected one
   */
  frontObjectsSelectionPriority: false,
  /**
   * Method that determines what object we are clicking on
   * the skipGroup parameter is for internal use, is needed for shift+click action
   * @param {Event} e mouse event
   * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through
   */
  findTarget: function findTarget(e, skipGroup) {
    if (this.skipTargetFind) {
      return;
    }
    var ignoreZoom = true,
        pointer = this.getPointer(e, ignoreZoom),
        activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject(),
        activeTarget,
        activeTargetSubs;
    // first check current group (if one exists)
    // active group does not check sub targets like normal groups.
    // if active group just exits.
    this.targets = [];
    if (activeGroup && !skipGroup && activeGroup === this._searchPossibleTargets([activeGroup], pointer)) {
      this._fireOverOutEvents(activeGroup, e);
      return activeGroup;
    }
    // if we hit the corner of an activeObject, let's return that.
    if (activeObject && activeObject._findTargetCorner(pointer)) {
      this._fireOverOutEvents(activeObject, e);
      return activeObject;
    }

    if (!this.frontObjectsSelectionPriority && activeObject && activeObject === this._searchPossibleTargets([activeObject], pointer)) {
      if (!this.preserveObjectStacking) {
        this._fireOverOutEvents(activeObject, e);
        return activeObject;
      } else {
        activeTarget = activeObject;
        activeTargetSubs = this.targets;
        this.targets = [];
      }
    }

    var target = this._searchPossibleTargets(this._objects, pointer);
    if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {
      target = activeTarget;
      this.targets = activeTargetSubs;
    }
    this._fireOverOutEvents(target, e);
    return target;
  },
  setDimensions: function setDimensions(dimensions, options) {
    _set_dimensions_overwritten.call(this, dimensions, options);

    if (this.backgroundImage && this.backgroundImage.constructor !== String) {
      this._update_background_overlay_image("background");
    }
    if (this.overlayImage && this.overlayImage.constructor !== String) {
      this._update_background_overlay_image("overlay");
    }
    //this._update_clip_rect();
    this.fire("dimensions:modified");
    this.renderAll();
  }
});

var ExtCanvasMixin = {
  objects: null,
  // defaultOptions: {},
  animated: false,
  fitIndex: 0.8,
  originalWidth: 0,
  originalHeight: 0,
  /**
   * required to show video
   */
  setAnimated: function setAnimated(val) {
    if (!val) {
      return;
    }

    fabric.util.requestAnimFrame(function render() {
      this.renderAll();
      fabric.util.requestAnimFrame(render);
    }.bind(this));
  },

  /**
   * Divides objects in two groups, one to render immediately
   * and one to render as activeGroup.
   * return objects to render immediately and pushes the other in the activeGroup.
   */
  _chooseObjectsToRender: function _chooseObjectsToRender(layer) {
    if (this.interactive) {
      var activeGroup = this.getActiveGroup(),
          activeObject = this.getActiveObject();
    }
    var object,
        objsToRender = [],
        activeGroupObjects = [];

    if (activeGroup && !this.preserveObjectStacking) {
      for (var i = 0, length = this._objects.length; i < length; i++) {
        object = this._objects[i];
        if (layer && object.layer !== layer) continue;
        if (!activeGroup.contains(object)) {
          if (!object.hiddenActive) {
            objsToRender.push(object);
          }
        } else {
          activeGroupObjects.push(object);
        }
      }
      if (activeGroup) {
        // activeGroup._set('_objects', activeGroupObjects);
        objsToRender.push(activeGroup);
      }
      activeObject && objsToRender.push(activeObject);
      // activeGroup._set('_objects', activeGroupObjects);
    } else {
      if (layer) {
        for (var i = 0, length = this._objects.length; i < length; i++) {
          object = this._objects[i];
          if (layer && object.layer !== layer) continue;
          objsToRender.push(object);
        }
      } else {
        objsToRender = this._objects;
      }
    }
    return objsToRender;
  },

  setEventListeners: function setEventListeners(val) {
    this.on(val);
  },
  find: function find(options) {
    if (typeof options === "string") {
      options = {
        type: options
      };
    }
    return fabric.util.object.where(this._objects, options);
  },
  _update_background_overlay_image: function _update_background_overlay_image(property) {

    var position = this[property + "Position"];
    var photo = this[property + "Image"];
    if (!photo || photo.constructor === Object || photo.constructor === String) return;

    if (position === 'resize') {
      this.originalWidth = photo.width;
      this.originalHeight = photo.height;
    } else if (position !== 'manual') {

      var _w = this.originalWidth || this.width,
          _h = this.originalHeight || this.height;

      if (position === 'fit' || !photo._originalElement) {

        size = {
          width: _w,
          height: _h
        };
      } else {
        var size = fabric.util.getProportions(photo._originalElement, {
          width: _w,
          height: _h
        }, position);
      }

      var _l;
      if (photo.originX === 'center') {
        _l = _w / 2;
      } else {
        _l = (_w - size.width) / 2;
      }
      var _t;
      if (photo.originY === 'center') {
        _t = _h / 2;
      } else {
        _t = (_h - size.height) / 2;
      }

      var _z = this.viewportTransform[0];
      photo.set({
        left: _l, //(_l /*+ this.viewportTransform[4]*/)*_z,
        top: _t, // /*+ this.viewportTransform[5]*/)*_z,
        width: size.width, //*_z,
        height: size.height, //*_z,
        scaleX: 1,
        scaleY: 1
      });
    } else {
      // var _orig = photo.getOriginalSize();
      // photo.set({
      //   originX: 'left',
      //   originY: 'top',
      //   left: 0, //this.viewportTransform[4],
      //   top: 0, //this.viewportTransform[5],
      //   width: _orig.width,
      //   height: _orig.height
      // });
    }
  },
  _setBackgroundOverlayImage: function _setBackgroundOverlayImage(fabricImage, type) {
    var property = type + "Image";
    var positionProperty = type + "Position";

    if (this.loaded) {
      var originalState = {};
      originalState[property] = this[property];
    }

    this[property] = fabricImage;
    this[property].canvas = this;
    this._update_background_overlay_image(type);
    if (this[positionProperty] === "resize") {
      this.originalWidth = fabricImage.width;
      this.originalHeight = fabricImage.height;
    }

    if (this.loaded) {
      var modifiedState = {};
      modifiedState[property] = this[property];
      this.fire('modified', { states: {
          original: originalState,
          modified: modifiedState
        } });
    }

    this.fire("background-image:loaded", { target: fabricImage });
  },
  setBackgroundOverlayImage: function setBackgroundOverlayImage(bg, type, callback) {
    var _this = this;

    var property = type + "Image";
    var prototype = this.application.prototypes && this.application.prototypes[fabric.util.string.capitalize(property)];

    if (!bg) {
      this[property] = null;
      callback && callback();
      return;
    }
    if (bg instanceof HTMLImageElement || bg instanceof Image) {
      var el = new fabric.Image(bg, {
        width: bg.naturalWidth,
        height: bg.naturalHeight
      });

      this._setBackgroundOverlayImage(el, type);
      callback && callback();
      return;
    }
    if (bg.constructor == String) {
      bg = {
        src: bg
      };
    }

    prototype && fabric.util.object.extend(bg, prototype);
    bg.application = this.application;
    bg.disableDefaultProperties = true;
    bg.type = bg.type || "image";

    fabric.util.createObject(bg, function (el) {
      _this._setBackgroundOverlayImage(el, type);
      callback && callback();
    });
  },
  setOverlayImage: function setOverlayImage(bg, callback) {
    this.setBackgroundOverlayImage(bg, "overlay", callback);
  },
  setBackgroundImage: function setBackgroundImage(bg, callback) {
    this.setBackgroundOverlayImage(bg, "background", callback);
  },
  createObjects: function createObjects(objects, callback) {

    if (this.application) {
      for (var i in objects) {
        if (objects[i].constructor == String) {
          objects[i] = this.application.objects[objects[i]];
        }
      }
    }

    var _canvas = this;

    function success(_objects) {
      _canvas.fire("progress:complete", { objects: objects });
      for (var i in _objects) {
        _canvas.add(_objects[i]);
      }
      _canvas.renderAll();
      callback && callback.call(_canvas);
    }

    function progress(l, t) {
      _canvas.fire("progress", { loaded: l, total: t });
      if (fabric.util.loaderDebug) {
        console.log("loaded " + l + " / " + t);
      }
    }

    var _objects = [];
    if (!objects || !objects.length) {
      success(_objects);
      return;
    }

    if (objects[0].constructor.name === "klass") {
      success(objects);
      return;
    }

    var queueLoadCallback = fabric.util.queueLoad(objects.length, function () {
      success(fabric.util.object.pluck(_objects, "object"));
    }, progress);

    queueLoadCallback.data = (this.title || "") + "objects";

    for (var i in objects) {
      (function (options) {
        var _object_slot = { object: null, options: options };
        _objects.push(_object_slot);

        options.application = _canvas.application;
        fabric.util.createObject(options, function (el) {
          _object_slot.object = el;
          queueLoadCallback();
        });
      }).call(this, objects[i]);
    }
  },
  /**
   * apply options for group of filtered objects
   * @param filter
   * @param options
   */
  applyOptions: function applyOptions(filter, options) {
    this._objects.forEach(function (_obj) {
      for (var prop in filter) {
        if (_obj[prop] !== filter[prop]) return;
      }
      _obj.setOptions(options);
    });
  },

  /*
  remove: function () {
    var _objects = this.getObjects(),
      index;
    var objects;
    for (var i = 0, length = arguments.length; i < length; i++) {
      if (arguments[i].layer) {
        objects = arguments[i].layer;
      } else {
        objects = _objects;
      }
       index = objects.indexOf(arguments[i]);
      // only call onObjectRemoved if an object was actually removed
      if (index !== -1) {
        objects.splice(index, 1);
        this._onObjectRemoved(arguments[i]);
      }
    }
     this.renderOnAddRemove && this.renderAll();
    return this;
  },*/
  /**
   * Create Object by type and options
   * @param type
   * @param options
   * @param callback
   */
  createObject: function createObject(type, options, callback) {
    if (typeof type !== "string") {
      callback = options;
      options = fabric.util.object.clone(type);
      type = null;
    } else {
      options = fabric.util.object.clone(options);
      options.type = type;
    }

    var _self = this;

    options = fabric.util.object.extend({}, this.application.getDefaultProperties(options.type), options);

    options.application = this.application;
    // var _active = options.active;
    // var _position = options.position;
    //    delete options.active;
    //  delete options.position;


    function _add(el) {
      if (el.canvas) return;
      // el.application = _self.application;
      _self.add(el);
      /*
            if(_active){
            if(_active){
              _self.setActiveObject(el);
            }*/
      callback && callback(el);
    }

    var el = fabric.util.createObject(options, _add);
    el && _add(el);
    return el;
  },
  onLoad: function onLoad(callback) {
    this.processing = false;
    this.loaded = true;
    this.fire("loading:end", { type: "slide", target: this });
    this.application.fire("slide:loading:end", { target: this, type: "slide" });
    this.interactive = true;
    this.renderAll();
    callback && callback.call(this);
  },
  load: function load(options, callback) {
    if (!options) return;
    this.application._populateWithDefaultProperties(this, options);
    if (options.width) {
      options.originalWidth = options.width;
      options.originalHeight = options.height;
    }

    this.processing = true;
    this.interactive = false;

    this.clear();
    this.fire("loading:begin", { type: "slide", options: options });
    this.application.fire("slide:loading:begin", { target: this, type: "slide", options: options });

    this.set(options, this.onLoad.bind(this, callback));
  },
  setObjects: function setObjects(objects, callback) {

    this._objects.length = 0;
    if (this._hasITextHandlers) {
      this.off('mouse:up', this._mouseUpITextHandler);
      this._iTextInstances = null;
      this._hasITextHandlers = false;
    }
    if (this.interactive) {
      this.discardActiveGroup();
      this.discardActiveObject();
      this.clearContext(this.contextTop);
    }

    this.createObjects(objects, function () {
      for (var i in this._objects) {
        this._objects[i].setCoords();
      }
      callback();
    });
  },
  onResize: function onResize() {
    var _scale = Math.min(1, 800 / this.width);
    // this.setZoom(_scale);
    this.setDimensions({ width: this.width, height: this.height });
  },
  getCenter: function getCenter(el) {
    return {
      top: (this.originalHeight || this.getHeight()) / 2,
      left: (this.originalWidth || this.getWidth()) / 2
    };
  },
  setOriginalSize: function setOriginalSize(w, h) {
    this.originalWidth = h ? w : w.naturalWidth || w.width;
    this.originalHeight = h ? h : w.naturalHeight || w.height;
    return this;
  }
};

var _get_pointer_overwritten = fabric.Canvas.prototype.getPointer;
fabric.util.object.extend(fabric.StaticCanvas.prototype, ExtCanvasMixin, {
  type: "canvas",
  cacheProperties: [],
  optionsOrder: function () {
    var oo = fabric.StaticCanvas.prototype.optionsOrder;
    oo.unshift("originalWidth", "originalHeight", "width", "height", "*");
    return oo;
  }(),
  _initEntity: function _initEntity(options) {
    options.application && options.application.fire("entity:created", { target: this, options: options });
  },
  _layers: ["background", "objects", "areas", "overlayImage", "overlay", "controls"],
  // _overlayObjects: [],
  layers: {
    background: {
      render: function render(canvas, ctx) {
        canvas._renderBackground(ctx);
      },
      svg: function svg(canvas, markup, reviver) {
        canvas._setSVGBgOverlayColor(markup, 'backgroundColor');
        canvas._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);
      }
    },
    areas: {
      render: function render(canvas, ctx) {
        ctx.save();
        if (canvas.clipTo) {
          fabric.util.clipContext(canvas, ctx);
        }
        //apply viewport transform once for all rendering process
        ctx.transform.apply(ctx, canvas.viewportTransform);

        if (canvas._offsetsObject) {
          canvas._offsetsObject.render(ctx);
        }
        if (canvas._areasObjects) {
          canvas._renderObjects(ctx, canvas._areasObjects);
        }
        if (canvas._helpersObjects) {
          canvas._renderObjects(ctx, canvas._helpersObjects);
        }
        // canvas._renderObjects(ctx, canvas._chooseObjectsToRender("areas"));
        ctx.restore();
      },
      objects: function objects(canvas) {
        return canvas._areasObjects || canvas._offsetsObject && [canvas._offsetsObject] || [];
      }
    },
    objects: {
      render: function render(canvas, ctx) {
        ctx.save();
        if (canvas.clipTo) {
          fabric.util.clipContext(canvas, ctx);
        }
        //apply viewport transform once for all rendering process
        ctx.transform.apply(ctx, canvas.viewportTransform);
        canvas._renderObjects(ctx, canvas._chooseObjectsToRender("objects"));
        ctx.restore();
      },
      objects: function objects(canvas) {
        return canvas._objects;
      },
      svg: function svg(canvas, markup, reviver) {
        var objects = canvas._chooseObjectsToRender("objects");
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = objects[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var instance = _step.value;

            if (instance.excludeFromExport) continue;
            canvas._setSVGObject(markup, instance, reviver);
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    },
    overlay: {
      render: function render(canvas, ctx) {
        ctx.save();
        if (canvas.clipTo) {
          fabric.util.clipContext(canvas, ctx);
        }
        //apply viewport transform once for all rendering process
        ctx.transform.apply(ctx, canvas.viewportTransform);
        canvas._renderObjects(ctx, canvas._chooseObjectsToRender("overlay"));
        ctx.restore();
      },
      svg: function svg(canvas, markup, reviver) {
        var objects = canvas._chooseObjectsToRender("overlay");
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = objects[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var instance = _step2.value;

            if (instance.excludeFromExport) continue;
            canvas._setSVGObject(markup, instance, reviver);
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
      // objects: function(canvas){
      //   return canvas._overlayObjects;
      // }
    },
    controls: {
      render: function render(canvas, ctx) {
        // this.controlsAboveOverlay &&
        if (canvas.interactive) {
          canvas.drawControls(ctx);
        }
      }
    },
    overlayImage: {
      render: function render(canvas, ctx) {
        canvas._renderOverlay(ctx);
      },
      svg: function svg(canvas, markup, reviver) {
        canvas._setSVGBgOverlayColor(markup, 'overlayColor');
        canvas._setSVGBgOverlayImage(markup, 'overlayImage', reviver);
      }
    }
  },
  /**
   * Renders background, objects, overlay and controls.
   * @param {CanvasRenderingContext2D} ctx
   * @param {Array} objects to render
   * @return {fabric.Canvas} instance
   * @chainable
   */
  renderCanvas: function renderCanvas(ctx, objects) {
    //do not redraw while working on  something
    // if(this.processing)return false;
    // if (this.selection && !this._groupSelector && !this.isDrawingMode) {
    //   this.clearContext(this.contextTop);
    // }

    this.clearContext(ctx);

    this.fire('before:render');

    var _iteratorNormalCompletion3 = true;
    var _didIteratorError3 = false;
    var _iteratorError3 = undefined;

    try {
      for (var _iterator3 = this._layers[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
        var i = _step3.value;

        this.layers[i].render(this, ctx);
        // if(this._chooseObjectsToRender &&  i === "objects"){
        //   this._renderObjects(ctx, this._chooseObjectsToRender());
        // }else{
        //   this._renderObjects(ctx, this.layers[i].objects);
        // }
      }

      // this._renderBackgroundObjects(ctx);
      // this._renderObjects(ctx, objects);
      // this._renderOverlayObjects(ctx);
      // if (this.controlsAboveOverlay && this.interactive) {
      //   this.drawControls(ctx);
      // }
    } catch (err) {
      _didIteratorError3 = true;
      _iteratorError3 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion3 && _iterator3.return) {
          _iterator3.return();
        }
      } finally {
        if (_didIteratorError3) {
          throw _iteratorError3;
        }
      }
    }

    this.fire('after:render');
  },
  _renderOverlayObjects: function _renderOverlayObjects() {},
  _renderBackgroundObjects: function _renderBackgroundObjects() {},
  /**
   * @private
   * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on
   * @param {Object} [options] Options object
   */
  _initStatic: function _initStatic(el, options) {
    this._objects = [];
    this._helpersObjects = [];
    this._createLowerCanvas(el);
    this._initSize(options);
    this.set(options);
    this._setImageSmoothing();

    // only initialize retina scaling once
    if (!this.interactive) {
      this._initRetinaScaling();
    }
    this.calcOffset();
    this.backgroundRect = new fabric.Rect({
      width: this.width,
      height: this.height,
      background: "#fff",
      shadow: {
        color: 'rgba(0,0,0,0.3)'
      }
    });
  },
  _initSize: function _initSize() {
    this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0;
    this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0;

    if (!this.lowerCanvasEl.style) {
      return;
    }

    this.lowerCanvasEl.width = this.width;
    this.lowerCanvasEl.height = this.height;

    this.lowerCanvasEl.style.width = this.width + 'px';
    this.lowerCanvasEl.style.height = this.height + 'px';

    this.viewportTransform = this.viewportTransform.slice();
  },
  initialize: function initialize(el, options) {
    if (el && el.constructor == Object) {
      // callback = options;
      options = el;
      el = null;
    }
    options = options || {};

    if (options.application) {
      options.application.fire("entity:created", { target: this, options: options });
    }

    // options =  fabric.util.object.defaults(fabric.util.object.deepExtend(options || {}),this.defaultOptions);
    this._initEntity(options);
    this._initStatic(el, options);

    this.updateFonts();
  },
  updateFonts: function updateFonts(data) {
    var _this2 = this;

    fabric.on("fonts:loaded", function () {
      var els = _this2.find({ type: "text" });
      var _iteratorNormalCompletion4 = true;
      var _didIteratorError4 = false;
      var _iteratorError4 = undefined;

      try {
        for (var _iterator4 = els[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
          var el = _step4.value;

          el.dirty = true;
        }
      } catch (err) {
        _didIteratorError4 = true;
        _iteratorError4 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion4 && _iterator4.return) {
            _iterator4.return();
          }
        } finally {
          if (_didIteratorError4) {
            throw _iteratorError4;
          }
        }
      }

      var els = _this2.find({ type: "textbox" });
      var _iteratorNormalCompletion5 = true;
      var _didIteratorError5 = false;
      var _iteratorError5 = undefined;

      try {
        for (var _iterator5 = els[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
          var el = _step5.value;

          el.dirty = true;
        }
      } catch (err) {
        _didIteratorError5 = true;
        _iteratorError5 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion5 && _iterator5.return) {
            _iterator5.return();
          }
        } finally {
          if (_didIteratorError5) {
            throw _iteratorError5;
          }
        }
      }

      var els = _this2.find({ type: "i-text" });
      var _iteratorNormalCompletion6 = true;
      var _didIteratorError6 = false;
      var _iteratorError6 = undefined;

      try {
        for (var _iterator6 = els[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
          var el = _step6.value;

          el.dirty = true;
        }
      } catch (err) {
        _didIteratorError6 = true;
        _iteratorError6 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion6 && _iterator6.return) {
            _iterator6.return();
          }
        } finally {
          if (_didIteratorError6) {
            throw _iteratorError6;
          }
        }
      }

      _this2.renderAll();
    });
  },
  setData: function setData(data) {

    if (data.role === "background") {
      this.setBackgroundImage(data, this.renderAll.bind(this));
    } else {

      var options = {
        position: data.left === undefined && data.top === undefined ? "center" : "manual",
        active: true
      };

      var id = this.activeArea && this.activeArea.id && "#" + this.activeArea.id;
      if (id) {
        options.movementLimits = id;
        options.clipTo = id;
      }

      this.createObject(fabric.util.object.deepExtend(options, data));
    }
  },
  setOriginalWidth: function setOriginalWidth(value) {
    this.originalWidth = value;
    if (!this.stretchable) {
      this.setWidth(value);
    }
  },
  setOriginalHeight: function setOriginalHeight(value) {
    this.originalHeight = value;
    if (!this.stretchable) {
      this.setHeight(value);
    }
  },
  setWidth: function setWidth(value) {
    return this.setDimensions({ width: value }, {});
  },
  setHeight: function setHeight(value) {
    return this.setDimensions({ height: value }, {});
  },

  /**
   * backgroundPosition
   * @values manual | cover | fit
   */
  backgroundPosition: 'manual',
  setBackgroundPosition: function setBackgroundPosition(src) {
    this.backgroundPosition = src;
    this._update_background_overlay_image("background");
    return this;
  },
  store_offsets: function store_offsets() {
    if (!this.offsets) return 0;
    if (this.offsets.left == this.offsets.right && this.offsets.right == this.offsets.top && this.offsets.top == this.offsets.bottom) {
      return this.offsets.left;
    } else {
      return this.offsets;
    }
  },
  offsets: 0,
  fillBackgroundColorOverCanvas: false,
  _renderBackgroundOrOverlay: function _renderBackgroundOrOverlay(ctx, property) {
    var object = this[property + 'Color'];

    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    var _rect = this.backgroundRect;
    if (property === "background" && _rect) {
      _rect.left = this.viewportTransform[4];
      _rect.top = this.viewportTransform[5];
      _rect.width = this.originalWidth * this.viewportTransform[0];
      _rect.height = this.originalHeight * this.viewportTransform[0];
      _rect.fill = object || "#ffffff";
      _rect.dirty = true;
      _rect.render(ctx);
    } else if (object) {

      ctx.fillStyle = object.toLive ? object.toLive(ctx) : object;

      if (!this.fillBackgroundColorOverCanvas) {
        //todo do!!!
        ctx.fillRect(object.offsetX || this.viewportTransform[4], // * this.viewportTransform[0],
        object.offsetY || this.viewportTransform[5], // * this.viewportTransform[0],
        _w * this.viewportTransform[0], _h * this.viewportTransform[0]);
      } else {
        ctx.fillRect(object.offsetX || 0, object.offsetY || 0, this.width, this.height);
      }
    }
    object = this[property + 'Image'];
    if (object && object.constructor !== String && object.constructor !== Object) {

      ctx.save();
      ctx.transform.apply(ctx, this.viewportTransform);

      object.render(ctx);

      ctx.restore();
    }
  },
  getImageData: function getImageData(options) {
    options = fabric.util.object.extend({
      clipped_area: false,
      clipped_area_only: false,
      draw_background: true,
      format: 'png',
      quality: 0.8
    }, options || {});

    var size;
    if (options.clipped_area) {
      size = options.clipped_area.getBoundingRect();
      var _zoom = this.getZoom();
      size.left /= _zoom;
      size.top /= _zoom;
      size.width /= _zoom;
      size.height /= _zoom;
      fabric.util.object.extend(options, size);
    } else {
      size = {
        width: options.width || this.originalWidth || this.width,
        height: options.height || this.originalHeight || this.height
      };

      if (options.clipped_area_only) {
        size.width -= this.offsets.left + this.offsets.right;
        size.height -= this.offsets.top + this.offsets.bottom;
      }
    }
    if (options.zoom) {
      size.width *= options.zoom;
      size.height *= options.zoom;
    }

    var canvas = fabric.util.createCanvasElement();
    canvas.width = size.width;
    canvas.height = size.height;

    options.left = Math.floor(options.left);
    options.top = Math.floor(options.top);
    options.height = Math.ceil(options.height);
    options.width = Math.ceil(options.width);

    this.renderThumb(canvas, options);

    var src = canvas.toDataURL(options);

    var blob = fabric.util.dataURItoBlob(src, 'image/' + options.format);
    var objectURL = URL.createObjectURL(blob);
    return {
      dataURL: src,
      blob: blob,
      url: objectURL,
      canvas: canvas
    };
  },
  getOriginalSize: function getOriginalSize() {
    return {
      width: this.originalWidth,
      height: this.originalHeight
    };
  },

  /**
   * @private
   */

  getObjectByID: function getObjectByID(_id) {
    for (var lid in this.layers) {
      if (this.layers[lid].objects) {
        var _iteratorNormalCompletion7 = true;
        var _didIteratorError7 = false;
        var _iteratorError7 = undefined;

        try {
          for (var _iterator7 = this.layers[lid].objects(this)[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {
            var o = _step7.value;

            if (o.id === _id) {
              return o;
            }
          }
        } catch (err) {
          _didIteratorError7 = true;
          _iteratorError7 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion7 && _iterator7.return) {
              _iterator7.return();
            }
          } finally {
            if (_didIteratorError7) {
              throw _iteratorError7;
            }
          }
        }
      }
    }
    return null;
  },
  /*
   Add Custom Object Tranformations
   */
  getPointer: function getPointer(e, ignoreZoom, upperCanvasEl) {
    var pointer = _get_pointer_overwritten.call(this, e, ignoreZoom, upperCanvasEl);
    if (e._group) {
      return this._normalizePointer(e._group, pointer);
    }
    return pointer;
  },

  hasStateChanged: fabric.Object.prototype.hasStateChanged,
  /** Creates a bottom canvas
   * @private
   * @param {HTMLElement} [canvasEl]
   */
  _createLowerCanvas: function _createLowerCanvas(canvasEl) {
    if (typeof canvasEl == "string") {
      this.lowerCanvasEl = fabric.util.getById(canvasEl);
    } else if (canvasEl) {
      this.lowerCanvasEl = this._createCanvasElement(canvasEl);
    } else {
      //edited allow virtul canvas
      // this.virtual = true;
      this.lowerCanvasEl = fabric.util.createCanvasElement();
    }
    fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');

    if (this.interactive) {
      this._applyCanvasStyle(this.lowerCanvasEl);
    }

    this.contextContainer = this.lowerCanvasEl.getContext('2d');
  },
  findTarget: function findTarget(e, skipGroup) {
    if (this.skipTargetFind) {
      return;
    }

    var ignoreZoom = true,
        pointer = this.getPointer(e, ignoreZoom),
        activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject();
    if (activeGroup && !skipGroup && this._checkTarget(pointer, activeGroup)) {
      return activeGroup;
    }

    if (activeObject && this._checkTarget(pointer, activeObject)) {
      //added visceroid
      this._fireOverOutEvents(activeObject, e);
      return activeObject;
    }

    this.targets = [];

    var target = this._searchPossibleTargets(this._objects, pointer);
    this._fireOverOutEvents(target, e);
    return target;
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, ExtCanvasMixin, {
  type: "slide"
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 24 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var __initializeOverriden = fabric.Text.prototype.initialize;

fabric.util.object.extend(fabric.Text.prototype, {
  stateProperties: fabric.Text.prototype.stateProperties.concat(["text"]),
  initializeOverriden: __initializeOverriden,
  initialize: function initialize(text, options) {
    this._initEntity(options);
    this.initializeOverriden(text, options);
    // this.updateCache();
  },
  accepts: {
    role: "fontFamily"
  },
  setData: function setData(data) {
    if (data.role == "fontFamily") {
      this.setFontFamily(data.fontFamily);
    }
  },
  getStyle: function getStyle(styleName) {
    var object = this;
    return object.getSelectionStyles && object.isEditing ? object.getSelectionStyles()[styleName] || object[styleName] : object[styleName] || object['__' + styleName] || '';
  },
  getPattern: function getPattern(url) {
    var _fill = this.getStyle('fill ');
    return _fill && _fill.source;
  },
  setStyles: function setStyles(val) {
    this.styles = val || {};
  },
  setPattern: function setPattern(url) {
    if (!url) {
      this.setStyle('fill');
    } else {
      // var _texture = _.findWhere(this.project.textures, {id: url});
      var _this = this;
      fabric.util.loadImage(url, function (img) {
        _this.setStyle('fill', new fabric.Pattern({
          source: img,
          repeat: 'repeat'
        }));
      });
    }
  },
  /* getOpacity: function () {
    return this.getStyle('opacity') * 100;
  },
  setOpacity: function (value) {
    this.setStyle('opacity', parseInt(value, 10) / 100);
  },*/
  getRadius: function getRadius() {
    return this.get('radius');
  },
  setShadow: function setShadow(options) {
    return this.setProperty('shadow', options ? new fabric.Shadow(options) : null);
  },
  setRadius: function setRadius(value) {
    this.setProperty('radius', value);
  },
  getSpacing: function getSpacing() {
    return this.get('spacing');
  },
  setSpacing: function setSpacing(value) {
    this.setProperty('spacing', value);
  },
  getReverted: function getReverted() {
    return this.get('reverted');
  },
  setReverted: function setReverted(value) {
    this.setProperty('reverted', value);
  },
  getFill: function getFill() {
    return this.getStyle('fill');
  },
  setFill: function setFill(value) {
    this.setStyle('fill', value);
  },
  getText: function getText() {
    return this.get('text');
  },
  setText: function setText(value) {
    this.setProperty('text', value);
  },
  getTextAlign: function getTextAlign() {
    return this.get('textAlign');
  },
  setTextAlign: function setTextAlign(value) {
    this.setProperty('textAlign', value.toLowerCase());
  },
  getFontFamily: function getFontFamily() {
    return this.get('fontFamily');
  },
  setFontFamily: function setFontFamily(value) {
    this.setStyle('fontFamily', value);
  },
  getStyles: function getStyles() {
    return {
      fill: this.fill,
      fontSize: this.fontSize,
      textBackgroundColor: this.textBackgroundColor,
      textDecoration: this.textDecoration,
      fontFamily: this.fontFamily,
      fontWeight: this.fontWeight,
      fontStyle: this.fontStyle,
      stroke: this.stroke,
      strokeWidth: this.strokeWidth
    };
  },
  getBgColor: function getBgColor() {
    return this.get('backgroundColor');
  },
  setBgColor: function setBgColor(value) {
    this.setProperty('backgroundColor', value);
  },
  getTextBgColor: function getTextBgColor() {
    return this.get('textBackgroundColor');
  },
  setTextBgColor: function setTextBgColor(value) {
    this.setProperty('textBackgroundColor', value);
  },
  getStroke: function getStroke() {
    return this.getStyle('stroke');
  },
  setStroke: function setStroke(value) {
    this.setStyle('stroke', value);
  },
  getStrokeWidth: function getStrokeWidth() {
    return this.getStyle('strokeWidth');
  },
  setStrokeWidth: function setStrokeWidth(value) {
    this.setStyle('strokeWidth', parseInt(value, 10));
  },
  decreaseFontSize: function decreaseFontSize() {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) - 1);
  },
  increaseFontSize: function increaseFontSize() {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) + 1);
  },
  getFontSize: function getFontSize() {
    return this.getStyle('fontSize');
  },
  setFontSize: function setFontSize(value) {
    this.setStyle('fontSize', parseInt(value, 10));
  },
  getLineHeight: function getLineHeight() {
    return this.getStyle('lineHeight');
  },
  setLineHeight: function setLineHeight(value) {
    this.setStyle('lineHeight', parseFloat(value, 10));
  },
  addText: function addText(text, options) {

    var _match = this.text.match(/\n/g);
    var _lineIndex = _match && _match.length || 0;
    var charIndex = this.text.length - this.text.lastIndexOf("\n") - 1;

    if (!this.styles[_lineIndex]) {
      this.styles[_lineIndex] = {};
    }

    if (!this.styles[_lineIndex][charIndex]) {
      this.styles[_lineIndex][charIndex] = {};
    }
    fabric.util.object.extend(this.styles[_lineIndex][charIndex], options);
    this.text += text;
    // this.styles;
  },
  getBold: function getBold() {
    return this.getStyle('fontWeight') === "bold";
  },
  setBold: function setBold(value) {
    this.setStyle('fontWeight', value ? 'bold' : '');
  },
  getItalic: function getItalic() {
    return this.getStyle('fontStyle') === 'italic';
  },
  setItalic: function setItalic(value) {
    this.setStyle('fontStyle', value ? 'italic' : '');
  },
  getUnderline: function getUnderline() {
    return this.getStyle('textDecoration').indexOf('underline') > -1;
  },
  setUnderline: function setUnderline(value) {
    value = value ? this.getStyle('textDecoration') + ' underline' : this.getStyle('textDecoration').replace('underline', '');

    this.setStyle('textDecoration', value);
  },
  getLinethrough: function getLinethrough() {
    return this.getStyle('textDecoration').indexOf('line-through') > -1;
  },
  setLinethrough: function setLinethrough(value) {
    value = value ? this.getStyle('textDecoration') + ' line-through' : this.getStyle('textDecoration').replace('line-through', '');

    this.setStyle('textDecoration', value);
  },
  getOverline: function getOverline() {
    return this.getStyle('textDecoration').indexOf('overline') > -1;
  },
  setOverline: function setOverline(value) {
    value = value ? this.getStyle('textDecoration') + ' overline' : this.getStyle('textDecoration').replace('overlin', '');

    this.setStyle('textDecoration', value);
  },
  _checkModifiedText: function _checkModifiedText(prop, value) {
    if (this.isEditing) {
      var isTextChanged = this._textBeforeEdit !== this.text;
      if (isTextChanged) {
        this.canvas.fire("object:modified", { target: this });
      }
    }
  },
  setProperty: function setProperty(prop, value) {
    this._checkModifiedText();
    this.saveState();
    this[prop] = value;

    this.fire("modified", {});
    if (this.canvas) {
      this.canvas.fire("object:modified", { target: this });
      this.canvas.renderAll();
    }
    this._textBeforeEdit = this.text;
  },

  setStyle: function setStyle(styleName, value) {
    this._checkModifiedText();
    this.saveState();

    var _old = this.getStyles();
    _old.styles = this.styles;

    if (this.setSelectionStyles && this.isEditing && this.selectionStart !== this.selectionEnd) {
      var style = {};
      if (value !== undefined) {
        style[styleName] = value;
      } else {
        delete style[styleName];
      }
      this.setSelectionStyles(style);
      this.setCoords();
    } else {
      if (value !== undefined) {
        this[styleName] = value;
      } else {
        delete this[styleName];
      }
      for (var i in this.styles) {
        for (var j in this.styles[i]) {
          if (this.styles[i][j][styleName] !== undefined) {
            delete this.styles[i][j][styleName];
          }
        }
      }
    }

    this.setCoords();

    if (this.caching) {
      this.dirty = true;
    }

    // if(!this.isEditing){
    this.fire("modified", {});

    if (this.canvas) {
      this.canvas.fire("object:modified", { target: this });
      this.canvas.renderAll();
    }
    // }
  },
  generateTextStyle: function generateTextStyle() {
    return {
      'font-style': this.isItalic() ? 'italic' : 'normal',
      'font-weight': this.isBold() ? 700 : 400,
      'text-decoration': (this.isLinethrough() ? 'line-through ' : '') + (this.isOverline() ? 'overline ' : '') + (this.isUnderline() ? 'underline ' : '')
    };
  }
});

fabric.util.object.extend(fabric.Textbox.prototype, {
  toObject: fabric.Object.prototype.toObject
});

fabric.util.object.extend(fabric.IText.prototype, {
  stateProperties: fabric.IText.prototype.stateProperties.concat(["styles"]),
  store_styles: function store_styles() {
    if (!Object.keys(this.styles).length) return null;
    var _styles = {};
    var _is_not_empty = false;
    for (var row in this.styles) {
      if (Object.keys(this.styles[row]).length) {
        var _row_empty = true;
        for (var char in this.styles[row]) {
          if (Object.keys(this.styles[row][char]).length) {
            if (_row_empty) {
              _styles[row] = {};_row_empty = false;
            }
            _styles[row][char] = fabric.util.object.clone(this.styles[row][char]);
          }
        }
        if (!_row_empty) {
          _is_not_empty = true;
        }
      }
    }
    return _is_not_empty && _styles || null;
  },
  toObject: fabric.Object.prototype.toObject,
  initHiddenTextarea_native: fabric.IText.prototype.initHiddenTextarea,
  initHiddenTextarea: function initHiddenTextarea() {
    this.initHiddenTextarea_native();
    this.hiddenTextarea.style.width = "9999px";
    this.hiddenTextarea.style["margin-left"] = "-9999px";
  },
  /**
   * Exits from editing state
   * @return {fabric.IText} thisArg
   * @chainable
   */
  /* exitEditing: function() {
      var isTextChanged = (this._textBeforeEdit !== this.text);
     this.selected = false;
     this.isEditing = false;
     this.selectable = true;
      this.selectionEnd = this.selectionStart;
      if (this.hiddenTextarea) {
       this.hiddenTextarea.blur && this.hiddenTextarea.blur();
       this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);
       this.hiddenTextarea = null;
     }
      this.abortCursorAnimation();
     this._restoreEditingProps();
     this._currentCursorOpacity = 0;
      this.fire('editing:exited');
     isTextChanged && this.fire('modified');
     if (this.canvas) {
       this.canvas.off('mouse:move', this.mouseMoveHandler);
       this.canvas.fire('text:editing:exited', { target: this });
       isTextChanged && this.canvas.fire('object:modified', { target: this });
       // this.canvas.fireModifiedIfChanged(this);
     }
     return this;
   },*/
  maxStrokeWidth: function maxStrokeWidth() {
    return Math.ceil(this.getFontSize() / 10);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 25 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Application
 *
 * farbic.app function is the entry point of FabricJS application.
 * Application could be initialised with configuration object. Different extensions allows to initialize special application attributes such as *object prototypes*, *resizable canvas*, *available fonts*, etc.
 *
 * ### option: util
 * mediaRoot - root directory for all media files in fabric application
 *
 * ### option: resizable
 * makes canvas responsible. Canvas will be scaled to 100% of its container size
 *
 * ### option: onResize
 * function which override deafult canvas resize behavior.
 *
 * ### option: callback
 * function calls after canvas initialized
 *
 * ### option: initialize
 * function calls before canvas initialize
 *
 * @example
 *
 * new fabric.Editor({
 *      resizable: true,
 *      onResize: function(){},
 *      util: {
 *        mediaRoot: '../../media/'
 *      },
 *      canvasContainer: "fiera-canvas",
 *      prototypes: {},
 *      objects: {},
 *      eventListeners: {},
 *      callback: function(){},
 *      initialize:  function(){}
 *      customPublicApplicationFunction: function(){},
 *      customPublicApplicationAttribute: value
 *  })
 *
 */

fabric.util.object.extend(fabric, {
  errors: []
});

fabric.Editor = function (options) {
  if (options.id) {
    this.id = options.id;
    delete options.id;
  }

  this.initEventListeners();

  this.fire("created", { options: options });

  options = fabric.util.object.deepExtend({}, this.defaultOptions, options || {});
  this.init(options);
};

fabric.Editor.prototype = fabric.util.object.extend({}, fabric.Observable, {
  defaultOptions: {
    /**
     * id of target canvas element
     */
    // canvasContainer: null
  },
  credentials: false,
  ready: false,
  optionsOrder: ["canvasContainer", "*", "objects", "slide"],
  plugins: {
    configuration: [],
    canvas: []
  },
  /**
   * Additional Event Listeners couldbe used to detect activeobject changes
   *  - canvas:created
   *  - entity:load - Event fired on creation of every new fabric instance(canvas,brush,object)
   *
   *  @example
   *  'entity:load' : function(e){
   *     if(e.options.boxType == 'machine') {
   *       e.options.type = "machine-mask-rectangle";
   *     }
   *   }
   */
  eventListeners: {
    "canvas:created": [],
    "entity:created": [function (e) {
      if (!e.options.id) {
        e.options.id = fabric.util.idCounter++;
      }
      if (e.target.eventListeners) {
        for (var i in e.target.eventListeners) {
          var _listeners = e.target.eventListeners[i];
          if (_listeners.constructor == Array) {
            for (var j in _listeners) {
              e.target.on(i, _listeners[j]);
            }
          } else {
            e.target.on(i, _listeners);
          }
        }
      }
      if (e.options.eventListeners) {
        for (var i in e.options.eventListeners) {
          e.target.on(i, e.options.eventListeners[i]);
        }
      }
      delete e.options.eventListeners;
      if (e.target._default_event_listeners) {
        for (var i in e.target._default_event_listeners) {
          e.target.on(i, e.target._default_event_listeners[i]);
        }
      }
    }]
  },
  onSlideLoaded: function onSlideLoaded() {},
  callback: function callback() {},
  init: function init(options) {
    this._options = options;

    this._loading = true;
    this.fire("loading:begin", { options: this._options });

    // new Promise(() => {
    //   return this;
    // })
    // .then(this.preloader.bind(this))
    // .then(this.loadConfiguration.bind(this))
    // .then(this.initOptions.bind(this))
    // .then(this.initialize.bind(this))
    // .then(this.onApplicationCreated.bind(this))
    // .then(this.postloader.bind(this))
    // .then(this.callback && function(app){
    //   setTimeout(this.callback.bind(this),0);
    // })
    // .then(  function(){
    //   this.fire("ready");
    // }.bind(this))


    // if(options.loader){
    //   this.setLoader(options.loader);
    //   delete options.loader;
    // }
    // if(options.prototypes){
    //   this.setPrototypes(options.prototypes);
    //   delete options.prototypes;
    // }
    //
    // if(options.actions){
    //   this.setActions(options.actions);
    //   delete options.actions;
    // }
    // if(options.history){
    //   this.setHistory(options.history);
    //   delete options.history;
    // }
    //
    // if(options.toolbars){
    //   this.setToolbars(options.toolbars);
    //   delete options.toolbars;
    // }
    //
    // if(options.previewMode){
    //   this.previewMode = options.previewMode;
    //   delete options.previewMode;
    // }
    //
    // if(options.slide){
    //   this.slide = options.slide;
    // }
    // this.setCanvasContainer(options.canvasContainer);
    // delete this.slide;
    // delete options.canvasContainer;


    fabric.util.order([
    // function(cb){
    //   this.setWebfonts(options.webfonts,cb);
    //   delete options.webfonts;
    // },
    this.preloader, this.loadConfiguration, this.initOptions, this.initialize, function () {
      // this._loading = false;
      // this.fire("loading:end",{});
    }, this.postloader, function () {
      setTimeout(this.callback.bind(this), 0);
    }, function () {
      this.ready = true;
      this.fire("ready");
    }], this);
  },
  setCredentials: function setCredentials(credentials) {
    if (credentials) {
      console.info("%cFiera Canvas Editor%c by %cDenis Ponomarev%c %c%6$s%c / %c%9$s%c", "color: #ffa500", "color: #202020", "color: #2EC06C", "color: #202020", "color: #337ab7", "www.hometlt.ru", "color: #202020", "color: #337ab7", "ponomarevtlt@gmail.com", "color: #202020");
    }
  },
  initOptions: function initOptions(resolve, error) {
    this.set(this._options, function () {
      resolve();
    });
  },
  configurationProperties: [],
  loadConfiguration: function loadConfiguration(resolve, error) {
    var _this = this;

    if (this.configurationProperties) {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.configurationProperties[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var prop = _step.value;


          if (this._options[prop]) {
            if (!this._options.configuration) {
              this._options.configuration = {};
            }
            this._options.configuration[prop] = this._options[prop];
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }

    if (!this._options.configuration) {
      return resolve();
    }
    var _app = this;
    fabric.util.promise.map(this._options.configuration, function (value) {
      return new Promise(function (resolve, fail) {
        if (value.constructor === Function) {
          if (value.length) {
            value(resolve, fail);
          } else {
            resolve(value());
          }
        } else {
          fabric.util.data.loadJson(value, resolve, fail);
        }
      });
    }).then(function (results) {
      fabric.util.object.extend(_app._options, results);
      delete _this._options.configuration;
    }).then(resolve, error);
  },
  createCanvas: function createCanvas(data) {

    var fabricCanvas;
    if (fabric.isLikelyNode) {
      // fabric.Canvas = fabric.Canvas;
      var w = data.slideWidth; //todo|| slide.template.width;
      var h = data.slideHeight; //todo || slide.template.height;
      var zoom = fabric.Canvas.prototype.zoom || 1;
      fabricCanvas = fabric.createCanvasForNode(w * zoom, h * zoom);
    } else {
      fabricCanvas = new fabric.Canvas({ application: this, width: data.width, height: data.height });
      // this.canvas =  new fabric.StaticCanvas($canvas, {application: application, interactive: false});
    }

    delete data.width;
    delete data.height;

    // var fabricCanvas = new fabric[this.canvasClass]( {application: this});
    this.fire("canvas:created");

    /*if(this.canvasContainer){
      this.canvasContainer.append(fabricCanvas.wrapperEl)
    }*/
    //
    // if (fabricCanvas.load) {
    //   fabricCanvas.load(data, callback);
    // } else {
    //   fabricCanvas.createObjects(data, callback);
    // }
    return fabricCanvas;
  },
  getLibraryElements: function getLibraryElements(options) {
    return [];
  },
  _setCanvasContainer: function _setCanvasContainer(el, callback) {
    this.canvasContainer = el;
    //temporary slide;
    if (this._options.slide) {
      this.canvas = this.createCanvas(this._options.slide);
      this.canvasContainer.appendChild(this.canvas.wrapperEl);
      this.slides = [this.canvas];
    }
    // this.canvas.load({});
  },
  setCanvasContainer: function setCanvasContainer(canvasContainer, callback) {
    var _this2 = this;

    //waiting while doument is ready
    if (canvasContainer.constructor === String) {
      var el = document.getElementById(canvasContainer);
      if (el) {
        //} || fabric.isLikelyNode) {
        this._setCanvasContainer(el);
        callback();
      } else {
        $(document).ready(function () {
          _this2._setCanvasContainer(document.getElementById(canvasContainer));
          callback();
        });
      }
    } else {
      this._setCanvasContainer(canvasContainer);
    }
  },
  dispose: function dispose() {
    this.canvas.dispose();
  },

  //--------------------------------------------------------------------------------------------------------------------
  // Event Listeners
  //--------------------------------------------------------------------------------------------------------------------

  setEventListeners: function setEventListeners(val) {
    this.on(val);
  },
  initEventListeners: function initEventListeners() {
    if (!this.__eventListeners) {
      this.__eventListeners = {};
    }
    for (var event in this.eventListeners) {
      if (!this.__eventListeners[event]) {
        this.__eventListeners[event] = [];
      }
      this.__eventListeners[event] = this.__eventListeners[event].concat(this.eventListeners[event]);
    }
  },
  cacheProperties: [],
  //--------------------------------------------------------------------------------------------------------------------
  //
  toObject: function toObject() {
    var data = {};
    if (this.slide) {
      return this.slide.toObject();
    }
    if (this.slides) {
      data.slides = [];
      for (var i in this.slides) {
        data.slides.push(this.slides[i].toObject());
      }
    }
    return data;
  },
  __set: fabric.Object.prototype.__set,
  _setObject: fabric.Object.prototype._setObject,
  set: fabric.Object.prototype.set,
  setOptions: fabric.Object.prototype.setOptions
});

// fabric.Editor.addPlugin = fabric.PluginsMixin.addPlugin.bind(fabric.Editor);

fabric.app = function (options) {
  return new fabric.Editor(options);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Canvas
 * Inherited from fabric.Canvas
 *
 *

 ## method: load

Mathod allows to add new objects and set new attributes of canvas.

 ```javascript
 load : ({
    backgroundImage: string,
    objects: [FabricShapeOptions],
    customSyncOption: any,
    customAsyncOption: any
  },callback) : void
 ```

 To extend loading behavior and use custom options it is possible to define **set fucntions** in Canvas prototype.

 ```javascript
 // Canvas Prototype
 setCustomAsyncOption: function(val,callback){
  this.doAsyncMethod(val,callback)
}
 setCustomSyncOption: function(val){
  this.customSyncOtion = val;
}
 ```

 ### attribute: backgroundImageProperties

 default attributes for background image

 ### freeDrawingBrush

 default active drawing brush

 ```
 freeDrawingBrush: "PaintBucketBrush" | "PaintPenBrush" | "PencilBrush"
 ```

 ### attribute: onSlideLoaded

 onSlideLoaded calls as a callback for load fucntion

 ### attribute: backgroundPosition

 onSlideLoaded calls as a callback for load fucntion

 ```
 backgroundPosition: 'manual' | 'resize' | 'fit' | 'cover' | 'center'
 ```

 - manual - background will ne not scaled and put at left top corner
 - resize - canvas will be resized according to image size
 - fit - will be scaled to fit canvas size
 - cover - will be scaled to cover all canvas size
 - center - backogrund will be not scaled but put in the middle

 ### method: setInteractiveMode

 switch between drawing and hand( moving cunvas by mouse) modes

 ```javascript
 canvas.setInteractiveMode( mode : "hand" | "mixed") : void
 ```

 ### drawingColor

 drawing color using by brushes

 */

fabric.util.object.extend(fabric.StaticCanvas.prototype, {

  setBackgroundColor: function setBackgroundColor(backgroundColor, callback) {
    var _this = this;

    if (this.loaded) {
      this.saveState(["backgroundColor"]);
    }

    return this.__setBgOverlayColor('backgroundColor', backgroundColor, function () {
      _this.renderAll();

      if (_this.loaded) {
        _this.fire('modified');
      }
      callback && callback();
    });
  },
  storeProperties: ['objects', 'backgroundColor', 'overlayColor', 'backgroundImage', 'overlayImage', 'width', 'height'],
  toObjectSync: function toObjectSync(propertiesToInclude) {
    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties);

    var _data = {
      objects: this.getObjects(),
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    fabric.util.populateWithProperties(this, _data, propertiesToInclude);

    this.fire("before:object", { object: _data });

    return _data;
  },
  /*store_thumb: function (){
    var size = fabric.util.getProportions(this.getOriginalSize(), this.thumbSize, 'fit');
    var canvas = fabric.util.createCanvasElement();
    canvas.width = size.width;
    canvas.height = size.height;
    this.renderThumb(canvas);
    return canvas.toDataURL();
  },
  store_template: function(propertiesToInclude, _data) {
    if (this.template) {
      for (var i in _data.template) {
        if (JSON.stringify(_data[i]) == JSON.stringify(_data.template[i])) {
          delete _data[i];
        }
      }
      return this.template.id;
    }
    return null;
  },*/
  store_backgroundImage: function store_backgroundImage() {
    if (this.backgroundImage && !this.backgroundImage.excludeFromExport) {
      return this.backgroundImage.toObject();
    }
    return null;
  },
  store_overlayImage: function store_overlayImage() {
    if (this.overlayImage && !this.overlayImage.excludeFromExport) {
      return this.overlayImage.toObject();
    }
    return null;
  },
  store_backgroundColor: function store_backgroundColor() {
    if (!this.backgroundColor) return "";
    return this.backgroundColor.toObject ? this.backgroundColor.toObject() : this.backgroundColor;
  },
  store_width: function store_width() {
    return this.originalWidth || this.width;
  },
  store_height: function store_height() {
    return this.originalHeight || this.height;
  },
  store_overlayColor: function store_overlayColor() {
    if (!this.overlayColor) return "";
    return this.overlayColor.toObject ? this.overlayColor.toObject() : this.overlayColor;
  },
  store_objects: function store_objects() {
    var _this2 = this;

    var _objs = fabric.util.object.filter(this.getObjects(), { stored: true });
    if (!_objs.length) return null;
    return _objs.map(function (instance) {
      return instance.toObject(_this2.objectsPropertiesToInclude);
    });
  },
  toObject: fabric.Object.prototype.toObject,

  addText: function addText() {
    this.createObject({
      active: true,
      position: "center",
      type: this.defaultTextType,
      clipTo: this.activeArea,
      text: this.deafultText,
      movementLimits: this.activeArea
    });
  }
});

fabric.util.object.extend(fabric.Canvas.prototype,
// fabric.PluginsMixin,
{
  type: 'canvas',
  /**
   * initialized width of the canvas
   */
  width: 160,
  /**
   * initialized height of the canvas
   */
  height: 90,
  /**
   * output quality
   */
  dotsPerUnit: 1,
  scale: 1,
  loaded: false,
  /**
   * allow user to interact with canvas
   */
  interactive: true,
  /**
   * fill not the slide area, but whole canvas with background color
   */
  defaultTextType: "text",

  thumbSize: {
    width: 50,
    height: 100
  },
  contextTopImageSmoothingEnabled: true,
  setInteractive: function setInteractive(value) {
    this.interactive = value;
  },
  setContextTopImageSmoothingEnabled: function setContextTopImageSmoothingEnabled() {
    var ctx = this.contextTop;
    if (ctx.imageSmoothingEnabled) {
      ctx.imageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
      return;
    }
    ctx.webkitImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.mozImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.msImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.oImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
  },

  _onMouseUpInDrawingMode: function _onMouseUpInDrawingMode(e) {
    this._isCurrentlyDrawing = false;
    if (this.clipTo) {
      this.contextTop.restore();
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseUp(pointer);
    this._handleEvent(e, 'up');
  },
  _clearObjects: function _clearObjects() {
    var _oldObjects = this._objects.splice(0);

    if (this._hasITextHandlers) {
      this.off('mouse:up', this._mouseUpITextHandler);
      this._iTextInstances = null;
      this._hasITextHandlers = false;
    }
    return _oldObjects;
  },
  clearObjects: function clearObjects() {

    var _oldObjects = this._clearObjects();
    this.clearContext(this.contextContainer);
    this.fire('canvas:cleared', { objects: _oldObjects });
    this.renderAll();
    return this;
  },
  renderPageBackground: false,
  initialize: function initialize(el, options, callback) {
    this.processing = true;
    if (el && el.constructor == Object) {
      callback = options;
      options = el;
      el = null;
    }
    options = options || {};

    if (options.application) {
      options.application.fire("entity:created", { target: this, options: options });
    }

    this.fire("before:created", { options: options });

    this._objects = [];
    this._helpersObjects = [];
    this._createLowerCanvas(el);

    this.created = true;
    this._currentTransform = null;
    this._groupSelector = null;
    this._initWrapperElement();
    this._createUpperCanvas();
    this._initEventListeners();
    this.calcOffset();

    this.wrapperEl.appendChild(this.upperCanvasEl);

    this._createCacheCanvas();
    this._setImageSmoothing();
    this._initRetinaScaling();

    this._initSize();
    this.set(options);

    if (this.renderPageBackground) {
      this.backgroundRect = new fabric.Rect({
        width: this.width,
        height: this.height,
        shadow: {
          offsetX: 1,
          offsetY: 3,
          blur: 10,
          color: 'rgba(0,0,0,0.6)'
        }
      });
    }

    this.updateFonts();
    this.calcOffset();

    this.on({
      'canvas:cleared': function canvasCleared() {
        var event = {};
        event.previous = this.application.target;
        if (event.previous) {
          event.previous.fire('deselected');
        }
        this.application.target = null;
        this.application.fire('target:cleared', event);
      },
      'object:modified': function targetModifed(e) {
        if (this.application.target === e.target) {
          this.application.fire('target:modified', { target: e.target, canvas: this });
        }
      },
      'selection:cleared': function targetClear(event) {
        if (!this.application.target) return;
        this.application.target.fire('deselected', event);

        if (this.application.target.canvas === this) {
          event.previous = this.application.target;
          this.application.target = null;
          this.application.fire('target:cleared', event);
        }
      },
      'object:selected': function targetChanged(event) {
        event.previous = this.application.target;
        this.application.target = event.target;
        if (event.previous) {
          event.previous.fire('deselected', event);
        }
        this.application.fire('target:changed', event);
      },
      'group:selected': function targetChanged(event) {
        event.previous = this.application.target;
        this.application.target = event.target;
        this.application.fire('target:changed', event);
      }
    });
    this.fire("created");
    this.processing = false;
    this.renderAll();

    // if(this.application){
    //   this.application.fire("canvas:created",{target : this});
    // }
  },
  animated: false,
  setAnimated: function setAnimated(val) {
    this.animated = val;
    if (val) {
      fabric.util.requestAnimFrame(function render() {
        this.renderAll();
        fabric.util.requestAnimFrame(render);
      }.bind(this));
    }
  },
  create: function create() {
    this.created = true;
    this._initInteractive();
    this._createCacheCanvas();
  }
});
fabric.Canvas.fromJson = function (url, callback, element) {
  fabric.util.data.loadJson(url, function (data) {
    new fabric.Canvas(element, data, callback);
  });
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PREVIEW = {
  NONE: 0,
  SINGLE: 1,
  ALL: 2
};

fabric.Editor.prototype.configurationProperties.push("slides");
fabric.util.object.extend(fabric.Editor.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.Editor.prototype.defaultOptions, {
    activeSlide: 0
  }),
  previewMode: fabric.PREVIEW.SINGLE,
  optionsOrder: function () {
    var oo = fabric.Editor.prototype.optionsOrder;
    oo.push("slides", "activeSlide");
    return oo;
  }(),
  _setSlidesData: function _setSlidesData(slides) {
    var _this = this;

    if (this.slides) {
      this.slides.forEach(function (slide) {
        slide.processing = true;
        slide.dispose();
        slide.lowerCanvasEl.parentNode.removeChild(slide.lowerCanvasEl);
      });
    }
    this.slides = [];

    if (this.canvas) {
      this.canvas._objects.length = 0;
    }
    slides.forEach(function (slide) {
      return _this.addSlide(slide);
    });

    function onSlideLoaded() {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.slides[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var slide = _step.value;

          if (!slide.loaded) return false;
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }

      this.fire("loading:end", {});
      this.off("slide:loading:end", onSlideLoaded);
      return true;
    }

    if (!onSlideLoaded.call(this)) {
      this.on("slide:loading:end", onSlideLoaded);
    }
  },
  _parse_function_json: function _parse_function_json(value, callbackFn, errorFn) {
    if (typeof value === "function") {
      if (value.length) {
        return value.call(this, callbackFn, errorFn);
      } else {
        value = value.call(this);
      }
    }
    fabric.util.data.loadJson(value, callbackFn, errorFn);
  },
  setSlide: function setSlide(value, callbackFn) {
    var _this2 = this;

    this._parse_function_json(value, function (slide) {
      _this2._setSlidesData([slide]);
      _this2._setActiveSlide(_this2.slides[0]);
      callbackFn && callbackFn();
    }, function () {
      console.error("slide loading failed");
      callbackFn && callbackFn();
    });
  },
  setSlides: function setSlides(value, callbackFn) {
    var _this3 = this;

    this._parse_function_json(value, function (slide) {
      _this3._setSlidesData(slide);
      callbackFn && callbackFn();
    }, function () {
      console.error("slides loading failed");
      callbackFn && callbackFn();
    });
  },
  _setActiveSlide: function _setActiveSlide(slide) {

    if (this.canvas === slide) return;
    // this.fire("slide:change:begin", {canvas: this.canvas});
    if (this.canvas) {
      this.canvas.setActive(false);
    }
    this.canvas = slide;
    this.canvas.setActive(true);
    this.canvas._onResize();
    this.fire("slide:changed", { canvas: this.canvas });
  },

  setActiveSlide: function setActiveSlide(slideId) {
    var _this4 = this;

    var slide = void 0;

    if (!this.slides) {
      return false;
    }
    if (slideId.constructor === Number) {
      slide = this.slides[slideId];
    } else if (slideId.constructor === String) {} else {
      slide = slideId;
    }

    if (this.activeSlide === slide) return;

    if (slide.loaded) {
      this._setActiveSlide(slide);
    } else {
      slide.on("loading:end", function () {
        _this4._setActiveSlide(slide);
      });
    }
  },
  unloadUnactiveSlides: false,
  // lazyLoadEnabled: true,
  // lazyLoad: function(){
  //
  //   var app = this;
  //   if(this.lazyLoadEnabled){
  //     this.slides.forEach(function(slide){
  //       if(!slide.loaded && !slide.processing){
  //         slide.load(slide.object,function(){
  //           slide.fire("loaded");
  //           // if(app.activeSlide === slide.id){
  //           //   this.setActiveSlide(slide);
  //           // }
  //
  //           // app.fire("slide:loading:end", {target: this});
  //
  //           for(var _s in app.slides){
  //             if(!app.slides[_s].loaded){
  //               return;
  //             }
  //           }
  //           app.fire("loading:end", {});
  //         }.bind(slide));
  //       }
  //     });
  //   }else{
  //     app.fire("loading:end",{});
  //   }
  // },
  addSlide: function addSlide(options) {
    var slide = this.createCanvas(options);
    slide.load(options);

    this.slides.push(slide);
    if (this.previewMode === fabric.PREVIEW.ALL) {
      if (this.canvasContainer) {
        this.canvasContainer.appendChild(slide.wrapperEl);
        slide._onResize();
      }
    }

    slide.on("mouse:down", function () {
      this.application.setActiveSlide(this);
    }, true);

    this.fire("slide:created", { target: slide });
    return slide;
  },
  removeSlide: function removeSlide(slide) {
    var _s = this.slides;
    var _curPos = _s.indexOf(slide);
    _s.splice(_curPos, 1);
    slide.fire("removed");

    if (slide === this.activeSlide) {
      delete this.activeSlide;
    }

    if (this.slides.length === 0) {
      var slideData = {};
      var _slide = this.addSlide(slideData);
      _slide.load(_slide.object);
      this.setActiveSlide(0);
    } else if (this.slides.length > _curPos) {
      this.setActiveSlide(_curPos);
    } else {
      this.setActiveSlide(_curPos - 1);
    }
  },
  /**
   * move slide to another position
   * @param slide
   * @param newPosition
   */
  moveSlide: function moveSlide(slide, newPosition) {
    var _s = this.slides;

    var _curPos = _s.indexOf(slide);
    newPosition = parseInt(newPosition);

    if (_curPos < newPosition) {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    } else {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    }
  },
  /**
   * replace slide
   * @param slide
   * @param newPosition - position of the second slide
   */
  replaceSlide: function replaceSlide(slide, newPosition) {
    var _s = this.slides;
    var _replacedSlide = _s[newPosition];
    var _curPos = _s.indexOf(slide);
    if (_curPos < newPosition) {
      _s.splice(newPosition, 1, slide);
      _s.splice(_curPos, 1, _replacedSlide);
    } else {
      _s.splice(_curPos, 1, _replacedSlide);
      _s.splice(newPosition, 1, slide);
    }
  },
  // preload: function(){
  //   for(var i in this.slides) {
  //     var _slide = this.slides[i];
  //     // _slide.canvas.preload(_slide.object, function () {
  //     //   _slide.fire("modified");
  //     // });
  //   }
  // },
  setActiveSlideByIndex: function setActiveSlideByIndex(index) {
    this.setActiveSlide(this.slides[index]);
  },
  setActiveSlideById: function setActiveSlideById(id) {
    this.setActiveSlide(fabric.util.object.findWhere(this.slides, { id: id }));
  },
  duplicateSlide: function duplicateSlide(slideData) {
    slideData = slideData.toObject();
    var _slide = this.addSlide(slideData);
    _slide.load(_slide.object);
  },
  nextSlide: function nextSlide() {
    var i = this.slides.indexOf(this.activeSlide);
    if (i < this.slides.length - 1) {
      this.setActiveSlide(i + 1);
    }
  },
  prevSlide: function prevSlide() {
    var i = this.slides.indexOf(this.activeSlide);
    if (i > 0) {
      this.setActiveSlide(i - 1);
    }
  },
  gotoSlide: function gotoSlide(slide) {
    this.setActiveSlide(slide - 1);
  },
  nextSlideAvailable: function nextSlideAvailable() {
    var i = this.slides.indexOf(this.activeSlide);
    return i < this.slides.length - 1;
  },
  prevSlideAvailable: function prevSlideAvailable() {
    var i = this.slides.indexOf(this.activeSlide);
    return i > 0;
  },
  createSlidesListElement: function createSlidesListElement(slide) {
    var _this5 = this;

    var $element = fabric.util.createCanvasElement();
    $element.setAttribute("height", 140);
    fabric.util.createThumb(slide, $element);

    slide.$slideElement = $("<div>").addClass("slide").click(function () {
      return _this5.setActiveSlide(slide);
    }).append($element).append($("<span>").html(slide.title));

    if (slide.description) {
      slide.$slideElement.attr("title", slide.description);
    }

    slide.on({
      "modified": function modified() {
        this.renderAll();
      },
      "removed": function removed() {
        slide.$slideElement.remove();
      }
    });
    this.$slideListInner.append(slide.$slideElement);
  },
  createSlidesList: function createSlidesList($container) {
    var _this6 = this;

    this.$slideList = this.$slidesList = $("<div>").addClass("slides-list");
    this.$slideListInner = $("<div>").addClass("slides-list-inner");
    this.$slideList.append(this.$slideListInner);

    $container.append(this.$slidesList);

    this.slides.forEach(function (slide) {
      return _this6.createSlidesListElement(slide);
    });

    this.on("slide:created", function (e) {
      _this6.createSlidesListElement(e.target);
    });

    return {
      list: this.$slideList

      //this.canvas.on( "dimensions:modified" ,this.updateThumbs.bind(this))
      //this.updateThumbs();
    };
  },
  updateThumbs: function updateThumbs() {
    var _this7 = this;

    this.slides.forEach(function (slide) {
      slide.canvas.setDimensions({ width: _this7.canvas.width, height: _this7.canvas.height });
    });
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  title: "New Slide",
  setActive: function setActive(value) {
    var $el = $(this.wrapperEl);
    if (value === false) {
      this.discardActiveGroup();
      this.discardActiveObject();
      this.renderAll();

      if (this.application.previewMode === fabric.PREVIEW.SINGLE) {
        $el.remove();
      } else {
        $el.removeClass("active");
      }
    } else {

      if (this.application.previewMode === fabric.PREVIEW.SINGLE) {

        this.application.canvasContainer.appendChild(this.wrapperEl);

        // this.application.canvasContainer.append($el);
      } else {
        $el.addClass("active");
      }
    }
  },
  unique: false,
  required: false,
  // stateProperties: ["unique","required"],
  removeSlide: function removeSlide() {
    this.application.removeSlide(this);
  },
  duplicateSlide: function duplicateSlide() {
    this.application.duplicateSlide(this);
  }
  // eventListeners: fabric.util.object.extendArraysObject(fabric.Canvas.prototype.eventListeners, {
  //   "modified" : function(e){
  //     if(this.canvas){
  //       this.canvas.canvas.set(e.states.modified);
  //       this.canvas.fire("modified");
  //     }
  //   },
  //   "object:modified" : function(){
  //     if(this.canvas){
  //       this.canvas.fire("modified");
  //     }
  //   }
  // })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Prototypes

 Prototypes allows to define **prototypes** property in Application configuration.

 ```javascript
 Application ({
  prototypes: {
    ClassName: options
  }
 })
 ```

 If prototype is defined every new Object created by application will have this properties by default.

 ```javascript
   NewClass: {
    $super: "ParentClass",
    type: "new-class",
    \/*other properties and methods*\/
   }
  ```

 if property **type** of Object class is defined then every object be default will have this type.

 ```javascript
   Object: {
    type: "rectangle"
   }
 ...
 //rectangle will be created
 fabric.createObject({width:100, height: 100})
 ```
*/

fabric.util.object.extend(fabric.Object.prototype, {
  /**
   * @private
   * @param {Object} object
   */
  _removeDefaultValues: function _removeDefaultValues(object, _type) {

    var prototype = this.application.getKlass(_type || object.type).prototype;
    // stateProperties = prototype.stateProperties;
    var _protoProperties = this.application && this.application.getDefaultProperties(prototype) || {};

    for (var prop in object) {
      if (prop === "type") continue;
      var _protoValue = _protoProperties[prop] !== undefined ? _protoProperties[prop] : prototype[prop];

      if (object[prop] === _protoValue) {
        delete object[prop];
      }
      var isArray = Object.prototype.toString.call(object[prop]) === '[object Array]' && Object.prototype.toString.call(_protoValue) === '[object Array]';

      // basically a check for [] === []
      if (isArray && object[prop].length === 0 && _protoValue.length === 0) {
        delete object[prop];
      }
    }

    return object;
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  _removeDefaultValues: fabric.Object.prototype._removeDefaultValues
});

fabric.util.object.extend(fabric.Editor.prototype, {
  optionsOrder: function () {
    var oo = fabric.Editor.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"), 0, "prototypes");
    return oo;
  }(),
  getDefaultProperties: function getDefaultProperties(stringTypeOrPrototype) {
    if (!this.prototypes) return;
    var klassname, proto;
    if (stringTypeOrPrototype.constructor === String) {
      klassname = fabric.util.string.capitalize(fabric.util.string.camelize(stringTypeOrPrototype), true);
      var _klass = this.getKlass(klassname);
      proto = _klass.prototype;
    } else {
      proto = stringTypeOrPrototype;
      klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type), true);
    }
    var _protoProperties = proto && proto.__proto__ && proto.__proto__.type && this.getDefaultProperties(proto.__proto__) || {};
    var _defaultProperties = klassname && fabric.util.object.clone(this.prototypes[klassname]) || {};

    fabric.util.object.extend(_protoProperties, _defaultProperties);

    return _protoProperties;
  },
  /**
   * default prototypes propertes for objects
   */
  prototypes: {
    Object: {
      includeDefaultValues: false
    },
    Canvas: {
      includeDefaultValues: false
    }
  },
  setUtils: function setUtils(utilsOptions) {

    if (!utilsOptions) {
      return;
    }
    fabric.util.object.extend(this.util || {}, utilsOptions);

    if (this.options['util']) {
      fabric.util.object.extend(fabric.util, this.options['util']);
    }
    if (this.options['fabric']) {
      fabric.util.object.extend(fabric, this.options['fabric']);
    }
    delete this.options['fabric'];
    delete this.options['util'];
  },
  klasses: [],
  getKlass: function getKlass(type) {
    // capitalize first letter only
    var klassName = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));
    return this.klasses[klassName] || fabric[klassName];
  },
  setPrototypes: function setPrototypes(prototypes) {

    var _prototypes = fabric.util.object.deepExtend({}, this.prototypes, prototypes);

    this.prototypes = _prototypes;

    if (_prototypes.eventListeners) {
      _prototypes.eventListeners.$extend = 'array';
    }

    for (var klassName in _prototypes) {
      var _proto = _prototypes[klassName];

      for (var j in _proto) {
        if (_proto[j] && _proto[j]["$extend"]) {
          var _extend = _proto[j]["$extend"];
          if (_extend == "array") {
            _proto[j] = fabric.util.object.extendArraysObject(fabric[klassName].prototype[j], _proto[j]);
          } else if (_extend == "deep") {
            _proto[j] = fabric.util.object.deepExtend(fabric[klassName].prototype[j], _proto[j]);
          } else {
            _proto[j] = fabric.util.object.extend(fabric[klassName].prototype[j], _proto[j]);
          }
          delete _proto[j]["$extend"];
        }
      }

      if (_proto["$super"]) {
        var _superklass = fabric[_proto["$super"]];
        if (!_superklass) {
          console.warn('class ' + _proto["$super"] + ' doent exists ');
          continue;
        }
        delete _proto["$super"];
        _proto.type = fabric.util.string.toDashed(klassName);

        var _fromObject = _proto.fromObject || _superklass.fromObject;
        delete _proto.fromObject;
        var _klass = this.klasses[klassName] = fabric.util.createClass(_superklass, _proto);
        _klass.fromObject = _fromObject.bind(_klass);
      }

      //   if (klassName.actions && _proto.actions.constructor == Function) {
      //     fabric[klassName].prototype.actions = _proto.actions.call(fabric[klassName].prototype)
      //   }
    }

    if (_prototypes.Editor) {
      fabric.util.object.deepExtend(this, _prototypes.Editor);
    }

    // delete this.options['prototypes'];

    if (this.actions && this.actions.constructor == Function) {
      this.actions = this.actions.call(this);
    }
  },
  _populateWithDefaultProperties: function _populateWithDefaultProperties(target, options) {

    if (!target.disableDefaultProperties) {

      fabric.util.object.defaults(options, this.getDefaultProperties(target, options));

      for (var key in options) {
        var value = options[key];
        if (key[0] == "+") {
          var _key = key.substr(1);
          var _arr = target.get(_key);
          if (_arr instanceof Array) {
            _arr = _arr.slice().concat(value);
          } else {
            _arr = fabric.util.object.extend({}, _arr, value);
          }
          options[_key] = _arr;
          delete options[key];
        }
      }
    }
  },
  eventListeners: fabric.util.object.extendArraysObject(fabric.Editor.prototype.eventListeners, {
    "created": function created(e) {
      if (e.options.prototypes && e.options.prototypes.Editor) {
        fabric.util.object.defaults(e.options, e.options.prototypes.Editor);
      }
    },
    "entity:created": function entityCreated(e) {
      e.target.application = this;
      this._populateWithDefaultProperties(e.target, e.options);
      delete e.options.type;
      delete e.options.application;
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.ActionsMixin = {
  setActions: function setActions(actions) {
    for (var i in actions) {
      actions[i].id = i;
    }
    this.actions = fabric.util.object.deepExtend({}, this.__proto__.actions, actions);
  },
  _getActionValue: function _getActionValue(property) {
    var object = this;
    var defaultProperties = void 0;
    do {
      if (!defaultProperties) {
        var actions = this.application.getDefaultProperties("Object").actions;
        defaultProperties = actions && actions[property];
      }
      if (object.actions && object.actions[property]) {
        return fabric.util.object.extend({}, object.actions[property], defaultProperties);
      }
    } while (object = object.__proto__);
    return fabric.util.object.extend({}, defaultProperties);
  }
};

fabric.util.object.extend(fabric.Editor.prototype, {
  _getActionValue: function _getActionValue(property) {
    return this.actions[property];
  },
  setActions: function setActions(actions) {
    for (var klassName in actions) {
      for (var i in actions[klassName]) {
        actions[klassName][i].id = i;
      }
      if (klassName == "Editor") {
        this.actions = fabric.util.object.deepExtend(this.actions, actions[klassName]);
        continue;
      }
      if (!this.prototypes[klassName]) {
        this.prototypes[klassName] = {};
      }
      var proto = this.getKlass(klassName);
      this.prototypes[klassName].actions = fabric.util.object.deepExtend({}, proto && proto.prototype.actions, actions[klassName]);
    }
  },
  actions: {
    save: {
      title: "save project",
      className: 'fa fa-floppy-o',
      action: function action() {
        var data = this.toObject();
        this.save(data);
      }
    },
    addSlide: {
      title: "add slide",
      className: 'fa fa-plus',
      action: function action() {
        var slideData = {};
        var _slide = this.addSlide(slideData);
        _slide.canvas.load(_slide.object);
        this._setActiveSlide(_slide);
      }
    }
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, fabric.ActionsMixin, {
  actions: {
    clear: {
      title: 'Clear',
      className: 'fa fa-trash'
    },
    clearObjects: {
      title: 'Clear All',
      className: 'fa fa-trash'
    },

    /* selectAll: {
       keyCode: 'a',
       ctrlKey: true,
       title: 'Select All',
       type: 'key'
     },*/
    backgroundColor: {
      title: "Set Background Colour",
      type: "color"
    },
    addText: {
      className: 'fa fa-font',
      title: 'Add Text',
      action: function action() {
        this.addText();
      }
    },
    removeSlide: {
      title: "add slide",
      className: 'fa fa-trash-o'
    },
    duplicateSlide: {
      title: "duplicate slide",
      className: 'fa fa-clone'
    }
  }
});

fabric.util.object.extend(fabric.Object.prototype, fabric.ActionsMixin, {
  actions: {
    movement: {
      className: 'fa fa-arrows',
      menu: ["moveUp", "moveDown", "moveLeft", "moveRight"]
    },
    moveUp: {
      className: "fa fa-arrow-up",
      type: "key",
      keyCode: 38
    },
    moveDown: {
      className: "fa fa-arrow-down",
      type: "key",
      keyCode: 40
    },
    moveLeft: {
      className: "fa fa-arrow-left",
      type: "key",
      keyCode: 37
    },
    moveRight: {
      className: "fa fa-arrow-right",
      type: "key",
      keyCode: 39
    },
    boundingRect: {
      type: 'label',
      template: '<dt>L:</dt><dd class="{leftClass}" title="{left}">{roundLeft}</dd><dt>T:</dt><dd class="{topClass}"  title="{top}">{roundTop}</dd><dt>R:</dt><dd class="{rightClass}" title="{right}">{roundRight}</dd><dt>B:</dt><dd class="{bottomClass}"  title="{bottom}">{roundBottom}</dd>',
      value: {
        observe: "modified scaling moving rotating",
        get: function get() {
          var _rect = this.getBoundingRect();

          if (this.movementLimits) {

            if (this.movementLimits == this.canvas) {
              var _v = this.canvas.viewportTransform;
              var _mlr = {
                left: _v[4],
                top: _v[5],
                width: (this.canvas.originalWidth || this.canvas.width) * _v[0],
                height: (this.canvas.originalHeight || this.canvas.height) * _v[3],
                right: 0,
                bottom: 0
              };
            } else {
              _mlr = this.movementLimits.getBoundingRect();
            }

            _rect.bottom = this.movementLimits.height - _rect.height;
            var _t = _rect.top - _mlr.top;
            var _l = _rect.left - _mlr.left;
            var _r = _mlr.width - _rect.width - _l;
            var _b = _mlr.height - _rect.height - _t;
          } else {
            _t = _rect.top;
            _l = _rect.left;
            _b = this.canvas.height - _rect.height - _rect.top;
            _r = this.canvas.width - _rect.width - _rect.left;
          }

          return {
            topClass: _t > 0 ? "positive" : _t < 0 ? "negative" : "zero",
            bottomClass: _b > 0 ? "positive" : _b < 0 ? "negative" : "zero",
            leftClass: _l > 0 ? "positive" : _l < 0 ? "negative" : "zero",
            rightClass: _r > 0 ? "positive" : _r < 0 ? "negative" : "zero",
            top: _t,
            left: _l,
            bottom: _b,
            right: _r,
            roundTop: Math.round(_t),
            roundLeft: Math.round(_l),
            roundBottom: Math.round(_b),
            roundRight: Math.round(_r)
          };
        }
      }
    },
    left: {
      type: 'number',
      title: 'left',
      value: {
        set: function set(val) {
          this.left = val;
          this.fire("modified");
          this.canvas.fire("object:modified", { target: this });
          this.canvas.renderAll();
        },
        get: function get() {
          return this.left;
        },
        observe: "modified"
      }
    },
    top: {
      type: 'number',
      title: 'top',
      value: {
        set: function set(val) {
          this.top = val;
          this.fire("modified");
          this.canvas.fire("object:modified", { target: this });
          this.canvas.renderAll();
        },
        get: function get() {
          return this.top;
        },
        observe: "modified"
      }
    },
    position: {
      title: 'position',
      type: 'menu',
      menu: ["left", "top"]
    },
    dimensions: {
      title: 'dimensions',
      type: 'menu',
      menu: {
        objectWidth: {
          type: 'number',
          title: 'width',
          value: {
            set: function set(val) {
              this.saveState();
              this.dimensionsWidthValue = val;
              this.scaleToWidth(val * this.canvas.getZoom());
              // this.canvas.fireModifiedIfChanged(this);
              this.fire("modified", {});
              this.canvas.fire("object:modified", { target: this });
              this.canvas.renderAll();
              delete this.dimensionsWidthValue;
            },
            get: function get() {
              if (this.dimensionsWidthValue) {
                return this.dimensionsWidthValue;
              }
              return Math.round(this.getBoundingRect().width / this.canvas.getZoom());
            },
            observe: "modified"
          }
        },
        objectHeight: {
          type: 'number',
          title: 'height',
          value: {
            set: function set(val) {
              this.saveState();
              this.scaleToHeight(val * this.canvas.getZoom());
              this.dimensionsHeightValue = val;
              this.fire("modified", {});
              this.canvas.fire("object:modified", { target: this });
              this.canvas.renderAll();
              delete this.dimensionsHeightValue;
            },
            get: function get() {
              if (this.dimensionsHeightValue) {
                return this.dimensionsHeightValue;
              }
              return Math.round(this.getBoundingRect().height / this.canvas.getZoom());
            },
            observe: "modified"
          }
        }
      }
    },
    center: {
      className: 'fa fa-bullseye',
      title: 'Center',
      action: function action() {
        this.center();
        this.setCoords();
      }
    },
    flip: {
      className: 'fa fa-arrows-h',
      title: 'flip',
      action: 'flip'
    },
    flop: {
      className: 'fa fa-arrows-v',
      title: 'flop'
    },
    order: {
      className: 'fa fa-exchange fa-rotate-90',
      menu: ["bringForward", "sendBackwards", "bringToFront", "sendToBack"]
    },
    bringForward: {
      title: 'bring forward',
      className: 'fa fa-level-up',
      enabled: '!onTop',
      observe: function observe(cb) {
        this.canvas.on("object:added object:removed object:replaced", cb);
      },
      destroy: function destroy(data) {
        this.canvas.off("object:added object:removed object:replaced", data.enableCallback);
      }
    },
    sendBackwards: {
      title: 'send backwards',
      className: 'fa fa-level-down',
      enabled: '!onBottom',
      observe: function observe(cb) {
        this.canvas.on("object:added object:removed object:replaced", cb);
      },
      destroy: function destroy(data) {
        this.canvas.off("object:added object:removed object:replaced", data.enableCallback);
      }
    },
    bringToFront: {
      title: 'bring to front',
      className: 'fa fa-level-up',
      enabled: '!onTop',
      observe: function observe(cb) {
        this.canvas.on("object:added object:removed object:replaced", cb);
      },
      destroy: function destroy(data) {
        this.canvas.off("object:added object:removed object:replaced", data.enableCallback);
      }
    },
    sendToBack: {
      title: 'send to back',
      className: 'fa fa-level-down',
      enabled: '!onBottom',
      observe: function observe(cb) {
        this.canvas.on("object:added object:removed object:replaced", cb);
      },
      destroy: function destroy(data) {
        this.canvas.off("object:added object:removed object:replaced", data.enableCallback);
      }
    },
    remove: {
      className: 'fa fa-trash',
      title: 'remove',
      key: "Delete"
    },
    duplicate: {
      className: 'fa fa-clone',
      title: 'duplicate'
    },
    fill: {
      type: 'color',
      title: 'fill',
      value: 'fill'
    },
    rotateLeft: {
      className: 'fa fa-rotate-left',
      title: 'rotate Left',
      action: function action() {
        this._normalizeAngle();
        var desiredAngle = (Math.floor(this.angle / 90) - 1) * 90;
        this.rotate(desiredAngle);
        this.canvas.renderAll();
      }
    },
    rotateRight: {
      className: 'fa fa-rotate-right',
      title: 'rotate Right',
      action: function action() {
        this._normalizeAngle();
        var desiredAngle = (Math.floor(this.angle / 90) + 1) * 90;
        this.rotate(desiredAngle);
        this.canvas.renderAll();
      }
    },
    stretch: {
      className: 'fa fa-arrows-alt',
      title: 'stretch',
      action: function action() {
        this._normalizeAngle();
        var _deviation = this.angle % 90;
        this.angle = Math.floor(this.angle / 90) * 90;

        if (_deviation > 45) {
          this.angle += 90;
        }

        var scaleX = void 0,
            scaleY = void 0;

        if (this.angle === 90 || this.angle === 270) {
          scaleX = this.canvas.width / this.height;
          scaleY = this.canvas.height / this.width;
        } else {
          scaleX = this.canvas.width / this.width;
          scaleY = this.canvas.height / this.height;
        }

        this._setOriginToCenter();

        this.set({
          scaleX: scaleX,
          scaleY: scaleY,
          left: this.canvas.width / 2,
          top: this.canvas.height / 2
        });

        this.canvas._restoreOriginXY(this);
        this.setCoords();
        this.canvas.renderAll();
      }
    }
  }
});

fabric.util.object.extend(fabric.Text.prototype, {
  actions: {
    fill: {
      type: 'color',
      title: 'fill',
      value: {
        get: function get() {
          //texture pattern fill fix
          return typeof this.fill === "string" ? this.fill : "transparent";
        },
        set: function set(value) {
          this.setFill(value);
        }
      }
    },
    textBgcolor: {
      type: 'color',
      title: 'bgColor',
      value: 'bgColor'
    },
    textTextbgcolor: {
      type: 'color',
      title: 'textBgColor',
      value: 'textBgColor'
    },
    textBold: {
      type: "checkbox",
      title: 'bold',
      value: 'bold',
      className: 'fa fa-bold'
    },
    textItalic: {
      type: "checkbox",
      title: 'italic',
      value: 'italic',
      className: 'fa fa-italic'
    },
    textUnderline: {
      type: "checkbox",
      title: 'Underline',
      value: 'underline',
      className: 'fa fa-underline'
    },
    textLinethrough: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'Linethrough',
      value: 'linethrough',
      className: 'text-linethrough fa fa-strikethrough'
    },
    textOverline: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'overline',
      value: 'overline',
      className: 'text-overline fa fa-overline'
    },
    textAlign: {
      type: 'options',
      title: 'text align',
      insert: 'textAligmentTools',
      value: "textAlign",
      menu: {
        textAlignCenter: {
          title: 'align center',
          option: 'center',
          className: 'fa fa-align-center'
        },
        textAlignLeft: {
          title: 'align left',
          option: 'left',
          className: 'fa fa-align-left'
        },
        textAlignRight: {
          title: 'align right',
          option: 'right',
          className: 'fa fa-align-right'
        },
        textAlignJustify: {
          title: 'align justify',
          option: 'justify',
          className: 'fa fa-align-justify'
        }
      }
    },
    fontFamily: {
      type: 'fontFamily',
      title: 'font family',
      className: 'fa fa-font',
      value: 'fontFamily',
      data: function data() {
        return this.application.fonts;
      }
    },
    textFontSize: {
      insert: 'textFontSizeTools',
      type: 'number',
      title: 'fontSize',
      value: 'fontSize'
    },
    /*textFont: {
     insert: 'textFontSizeTools',
     type: 'menu',
     title: 'font',
     className: 'fa fa-font',
     menu: {
     textFontSizeDecrease: {
     title: 'decreaseFontSize',
     action: _TEX.decreaseFontSize,
     className: 'fa fa-font font-size-decrease'
     },
     textFontSizeIncrease: {
     title: 'increaseFontSize',
     action: _TEX.increaseFontSize,
     className: 'fa fa-font font-size-increase'
     }
     }
     }*/
    advancedColorsTools: {
      className: 'colors',
      type: 'menu',
      title: 'colors',
      toggled: true,
      menu: ["fill", "textBgcolor", "textTextbgcolor", "fill"]
    },
    textStyle: {
      type: 'menu',
      title: 'text style',
      toggled: true,
      className: 'fa fa-font',
      style: 'generateTextStyle',
      menu: ["textBold", "textItalic", "textUnderline", "textLinethrough", "textOverline", "textAlign", "fontFamily", "textFontSize"]
    }
  }
});

fabric.util.object.extend(fabric.IText.prototype, {
  actions: fabric.util.object.extend({
    enterEditing: {
      insert: 'editTool',
      className: 'fa fa-pencil-square-o',
      title: 'edit'
    }
  }, fabric.Text.prototype.actions)
});

fabric.util.object.extend(fabric.Image.prototype, {
  actions: {
    source: {
      type: 'effect',
      className: 'fa fa-file-image-o',
      title: "source",
      actionParameters: function actionParameters($el, data) {
        data.target.application.createGallery(data.target, $el);
      }
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var StateMixin = {
  _saveStateOverwritten: fabric.Object.prototype.saveState,
  getProperties: function getProperties(properties) {
    var object = {};
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = properties[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var prop = _step.value;

        object[prop] = this["store_" + prop] ? this["store_" + prop]() : this[prop];
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return object;
  },
  /**
   * Saves state of an object
   * @param {Object} [options] Object with additional `stateProperties` array to include when saving state
   * @return {fabric.Object} thisArg
   */
  saveState: function saveState(options) {
    var _includeDefaultValues = this.includeDefaultValues;
    if (!_includeDefaultValues) {
      this.includeDefaultValues = true;
    }
    if (fabric.version.indexOf("1.7") === 0) {
      if (!options) {
        this._stateProperties = this.toObject();
      } else if (options.length) {
        this._stateProperties = this.getProperties(options);
      } else {
        this._saveStateOverwritten(options);
      }
    } else {
      this.originalState = this.toObject();
    }
    if (!_includeDefaultValues) {
      this.includeDefaultValues = false;
    }
    return this;
  },

  getModifiedStates: function getModifiedStates() {

    var _originalState = void 0;
    if (fabric.version.indexOf("1.7") === 0) {
      _originalState = this._stateProperties;
    } else {
      _originalState = this.originalState;
    }

    var _counter = 0;
    var states = {
      original: {},
      modified: {}
    };

    var _includeDefaultValues = this.includeDefaultValues;
    if (!_includeDefaultValues) {
      this.includeDefaultValues = true;
    }
    var state = this.toObject();
    if (!_includeDefaultValues) {
      this.includeDefaultValues = false;
    }

    for (var prop in _originalState) {
      if (_originalState[prop] !== state[prop]) {
        if (_originalState[prop] instanceof Object) {
          if (JSON.stringify(_originalState[prop]) === JSON.stringify(state[prop])) {
            continue;
          }
        }
        states.original[prop] = _originalState[prop];
        states.modified[prop] = state[prop];
        _counter++;
      }
    }
    return _counter && states;
  }
};

fabric.util.object.extend(fabric.Object.prototype, StateMixin);

fabric.util.object.extend(fabric.Canvas.prototype, StateMixin, {
  _finalizeCurrentTransform: function _finalizeCurrentTransform() {
    var transform = this._currentTransform,
        target = transform.target;
    if (target._scaling) {
      target._scaling = false;
    }
    target.setCoords();
    this._restoreOriginXY(target);
    target.fire("modified", {});
    this.fire("object:modified", { target: target });
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric, {
  debugTimeout: 0
});

fabric.StaticCanvas.prototype.enableConsoleDebugging = function () {
  window.canvas = this;
  this.on("object:selected", function (e) {
    window.target = e.target;
  });
  this.on("selection:updated", function (e) {
    window.target = e.target;
  });
  this.on("selection:cleared", function (e) {
    window.target = null;
  });
  this.on("selection:created", function (e) {
    window.target = e.target;
  });
};

fabric.StaticCanvas.prototype.setDebug = function (val) {
  if (val) {
    this.enableConsoleDebugging();
  }
};

fabric.Editor && fabric.util.object.extend(fabric.Editor.prototype, {
  logEvents: fabric.Object.prototype.logEvents = function eventsLogger(options) {
    var _counter = {};
    for (var i in options) {
      _counter[i] = 0;
      this.on(options[i], function (i, event) {
        console.log(i + " " + ++_counter[i], event);
      }.bind(this, i));
    }
  },
  setDebug: function setDebug(value) {
    fabric.debug = value;
    this.on("ready", function () {
      this.enableDebugging();
    });
  },

  enableDebugging: function enableDebugging() {
    if (fabric.debug) {

      var _operand = "color: #2EC06C; font-style: italic;";
      console.info("debug enabled. (use %capp%c, %cproject%c, %ccanvas%c, %ctarget%c in console)", _operand, "color: #202020", _operand, "color: #202020", _operand, "color: #202020", _operand, "color: #202020");

      window[fabric.debug] = this;
      window.canvas = this.canvas;
      window.target = null;

      this.on("target:changed", function () {
        window.target = this.target;
      });
      this.on("slide:changed", function (e) {
        window.canvas = e.canvas;
      });
    }
  }
});

fabric.Object.prototype.debug = function (noBorders) {
  var canvas = document.createElement("canvas");
  canvas.width = noBorders ? this.width : this.width + 2;
  canvas.height = noBorders ? this.height : this.height + 2;

  var ctx = canvas.getContext('2d');
  if (!noBorders) {
    ctx.lineWidth = 1;
    ctx.strokeStyle = "yellow";
    ctx.strokeRect(0, 0, this.width + 2, this.height + 2);
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = "#000000";
    ctx.strokeRect(0, 0, this.width + 2, this.height + 2);
  }
  ctx.translate(this.width / 2 + 1, this.height / 2 + 1);
  var _clipTo = this.clipTo;
  delete this.clipTo;
  this.render(ctx, true);
  this.clipTo = _clipTo;
  window.open(canvas.toDataURL(), "_blank");
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * makes canvas responsible. Canvas will be scaled to 100% of its container size
   */
  stretchable: false,
  _onResize: function _onResize() {
    if (this.stretchable) {
      if (!this.wrapperEl.parentNode) return;
      // if (canvas.virtual) return;
      var _parent = $(this.wrapperEl.parentNode);

      var _offset = $(this.wrapperEl).position();
      var _margin = this.application && this.application.widthMargin || 0;
      var _w = _parent.width() - _margin,
          _h = _parent.height();
      if (this.application && this.application.onResize) {
        this.application.onResize({
          width: _w,
          height: _h
        }, {
          width: this.originalWidth,
          height: this.originalHeight
        });
        this.calcOffset();
      } else {
        this.setDimensions({
          width: _w /*- _offset.left*/ - _margin,
          height: _h /*- _offset.top*/
        });
      }
    } else {
      this.calcOffset();
    }
  },
  setStretchable: function setStretchable(val) {
    this.stretchable = val;
    this._onResize();
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

configurationProperties: [];

fabric.Editor.prototype.configurationProperties.push("templates");

fabric.util.object.extend(fabric.Editor.prototype, {
  setTemplates: function setTemplates(value) {
    this.templates = value;
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.Canvas.prototype.eventListeners, {
    "loading:begin": function loadingBegin(e) {
      this._applyTemplate(e.options);
    }
  })
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.StaticCanvas.prototype.eventListeners, {
    "loading:begin": function loadingBegin(e) {
      this._applyTemplate(e.options);
    }
  }),

  _applyTemplate: function _applyTemplate(options) {
    var val = options.template;
    if (val) {
      var tpl = this.getTemplate(val);
      fabric.util.object.extend(options, tpl.data);
      if (tpl.data.width) {
        options.originalWidth = tpl.data.width;
      }
      if (tpl.data.height) {
        options.originalHeight = tpl.data.height;
      }
    }
  },
  /*tTemplate: function(template){
     this.template = template;
    if(!template)return;
     this.setWidth(this.slideWidth || template.width);
    this.setHeight(this.slideHeight || template.height);
    this.originalHeight = this.height;
    this.originalWidth = this.width;
     this.set(fabric.util.object.rearrange(template,["areas","helpers","offsets"]));
     this._update_clip_rect();
    this._update_background_overlay_image("background");
    this.fire("modified",{type: "template"});
    this.renderAll();
  },*/
  // setTemplate: function(value){
  //   this.template = value;
  // },
  //-------------------------------------------------------------------------------
  getTemplate: function getTemplate(id) {
    return fabric.util.object.findWhere(this.application.templates, { id: id });
  },
  updateSlideTemplate: function updateSlideTemplate(slide) {
    slide.canvas.setTemplate(slide.canvas.template);
    this.canvas.template = slide.canvas.template;
    if (this.activeSlide == slide) {
      this.canvas.setTemplate(slide.canvas.template);
    }
  },
  updateTemplate: function updateTemplate(template) {
    for (var i in this.slides) {
      if (this.slides[i].canvas.template == template) {
        this.updateSlideTemplate(this.slides[i]);
      }
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * specific order functions. Allow to move object only within object`s layer
 */
fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  _toFront: function _toFront(obj) {
    if (obj.layer) {
      var layerIndex = this._layers.indexOf(obj.layer);
      for (var i = 0; i < this._objects.length; i++) {
        if (this._objects[i].layer && this._layers.indexOf(this._objects[i].layer) > layerIndex) {
          break;
        }
      }
      this._objects.splice(i, 0, obj);
    } else {
      this._objects.push(obj);
    }
  },
  _toBack: function _toBack(obj) {
    if (obj.layer) {
      var layerIndex = this._layers.indexOf(obj.layer);
      for (var i = this._objects.length; i--;) {
        if (this._objects[i].layer && this._layers.indexOf(this._objects[i].layer) < layerIndex) {
          this._objects.splice(i + 1, 0, obj);
          return;
        }
      }
    }

    this._objects.unshift(obj);
  },
  add: function add() {
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = arguments[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var obj = _step.value;

        this._toFront(obj);

        if (this._onObjectAdded) {
          this._onObjectAdded(obj);
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    this.renderOnAddRemove && this.renderAll();
    return this;
  },

  /**
   * Moves an object or the objects of a multiple selection
   * to the bottom of the stack of drawn objects
   * @param {fabric.Object} object Object to send to back
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  sendToBack: function sendToBack(object) {
    if (!object) {
      return this;
    }
    var activeGroup = this._activeGroup,
        i,
        obj,
        objs;
    if (object === activeGroup) {
      objs = activeGroup._objects;
      for (i = objs.length; i--;) {
        obj = objs[i];
        fabric.util.removeFromArray(this._objects, obj);
        this._objects.unshift(obj);
      }
    } else {
      fabric.util.removeFromArray(this._objects, object);
      this._toBack(object);
      this.fire("object:replaced", { target: object });
    }
    return this.renderAll && this.renderAll();
  },

  /**
   * Moves an object or the objects of a multiple selection
   * to the top of the stack of drawn objects
   * @param {fabric.Object} object Object to send
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  bringToFront: function bringToFront(object) {
    if (!object) {
      return this;
    }
    var activeGroup = this._activeGroup,
        i,
        obj,
        objs;
    if (object === activeGroup) {
      objs = activeGroup._objects;
      for (i = 0; i < objs.length; i++) {
        obj = objs[i];
        fabric.util.removeFromArray(this._objects, obj);
        this._objects.push(obj);
      }
    } else {
      fabric.util.removeFromArray(this._objects, object);

      this._toFront(object);
      this.fire("object:replaced", { target: object });
    }
    return this.renderAll && this.renderAll();
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  onTop: function onTop() {
    var objs = this.canvas._objects;
    var index = objs.indexOf(this);
    if (index === objs.length - 1) {
      return true;
    } else if (this.layer) {
      // If above object is on another layer we could not bring our object forward
      if (objs[index + 1].layer && objs[index + 1].layer != this.layer) {
        return true;
      }
    }
    return false;
  },
  onBottom: function onBottom() {
    var objs = this.canvas._objects;
    var index = objs.indexOf(this);
    if (index === 0) {
      return true;
    } else if (this.layer) {
      // If above object is on another layer we could not bring our object forward
      if (objs[index - 1].layer && objs[index - 1].layer != this.layer) {
        return true;
      }
    }
    return false;
  },

  /**
   * Moves an object down in stack of drawn objects
   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object
   * @return {fabric.Object} thisArg
   * @chainable
   */
  sendBackwards: function sendBackwards(intersecting) {
    if (this.group) {
      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);
    } else {
      this.canvas.sendBackwards(this, intersecting);
      this.canvas.fire("object:replaced", { target: this });
    }
    return this;
  },


  /**
   * Moves an object up in stack of drawn objects
   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object
   * @return {fabric.Object} thisArg
   * @chainable
   */
  bringForward: function bringForward(intersecting) {
    if (this.group) {
      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);
    } else {
      this.canvas.bringForward(this, intersecting);
      this.canvas.fire("object:replaced", { target: this });
    }
    return this;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

{

  /*
   fabric.Image.filters.Redify = fabric.util.createClass(fabric.Image.filters.BaseFilter, {
   type: 'Redify',
   applyTo: function (canvasEl) {
   var context = canvasEl.getContext('2d'),
   imageData = context.getImageData(0, 0,
   canvasEl.width, canvasEl.height),
   data = imageData.data;
   for (var i = 0, len = data.length; i < len; i += 4) {
   data[i + 1] = 0;
   data[i + 2] = 0;
   }
   context.putImageData(imageData, 0, 0);
   }
   });
   fabric.Image.filters.Redify.fromObject = function (object) {
   return new fabric.Image.filters.Redify(object);
   };
   */

  fabric.Image.filters.Sharpen = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Sharpen',
    initialize: function initialize(options) {
      options = options || {};

      this.opaque = options.opaque;
      this.matrix = options.matrix || [0, -1, 0, -1, 5, -1, 0, -1, 0];
    }
  });
  fabric.Image.filters.Sharpen.fromObject = function (object) {
    return new fabric.Image.filters.Sharpen(object);
  };

  fabric.Image.filters.Blur = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Blur',
    initialize: function initialize(options) {
      options = options || {};

      var _v = 1 / 9;
      this.opaque = options.opaque;
      this.matrix = options.matrix || [_v, _v, _v, _v, _v, _v, _v, _v, _v];
    }
  });
  fabric.Image.filters.Blur.fromObject = function (object) {
    return new fabric.Image.filters.Blur(object);
  };

  fabric.Image.filters.Emboss = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Emboss',
    initialize: function initialize(options) {
      options = options || {};

      this.opaque = options.opaque;
      this.matrix = options.matrix || [1, 1, 1, 1, 0.7, -1, -1, -1, -1];
    }
  });
  fabric.Image.filters.Emboss.fromObject = function (object) {
    return new fabric.Image.filters.Emboss(object);
  };

  fabric.Image.filters.Mask.prototype.maskFilter = true;

  var prototypeOptions = {
    Brightness: {
      "brightness": { value: 100, min: 0, max: 255 }
    },
    Noise: {
      "noise": { value: 100, min: 0, max: 1000 }
    },
    Convolute: {
      "opaque": { value: true, type: "boolean" },
      "matrix": { value: [1, 1, 1, 1, 1, 1, 1, 1, 1], type: "matrix" }
    },
    Blur: {},
    Sharpen: {},
    Emboss: {},
    Multiply: {
      "color": { type: 'color', value: "#F0F" }
    },
    Pixelate: {
      "blocksize": { value: 4, min: 2, max: 20 }
    },
    Tint: {
      "color": { type: 'color', value: "#3513B0" },
      "opacity": { value: 1, min: 0, max: 1, step: 0.1 }
    },
    Mask: {
      mask: {
        type: 'image',
        value: {
          src: "photos/explosion.png"
        }
      },
      channel: { value: 0 }
    },
    Blend: {
      "color": { type: 'color', value: "#3513B0" },
      "mode": {
        value: "add",
        options: [{ value: "add", title: "Add" }, { value: "diff", title: "Diff" }, { value: "subtract", title: "Subtract" }, { value: "multiply", title: "Multiply" }, { value: "screen", title: "Screen" }, { value: "lighten", title: "Lighten" }, { value: "darken", title: "Darken" }]
      }
    }
  };

  for (var i in prototypeOptions) {
    fabric.Image.filters[i].prototype.options = prototypeOptions[i];
  }
}

fabric.Image.getFiltersList = function (el) {

  el = el || fabric.Image.prototype;
  var filterList = [];
  for (var i in el.availableFilters) {
    var _f = fabric.Image.filters[el.availableFilters[i]];

    var _data = {
      type: el.availableFilters[i]
    };
    if (_f.prototype.custom) {
      if (!el.customFilters) {
        continue;
      }
    }
    if (_f.prototype.maskFilter) {
      if (!el.maskFilter) {
        continue;
      }
    }
    if (_f.prototype.caman) {
      if (!el.camanFilters) {
        continue;
      }
      _data.caman = true;
    } else {
      if (!el.fabricFilters) {
        continue;
      }
    }
    if (_f.prototype.options) {
      _data.options = fabric.util.object.clone(_f.prototype.options);
    }
    _data.text = _f.prototype.title || el.availableFilters[i];

    filterList.push(_data);
  }
  return filterList;
};

fabric.util.object.extend(fabric.Image.prototype, {
  camanFilters: false,
  fabricFilters: true,
  customFilters: false,
  maskFilter: false,
  getFiltersData: function getFiltersData() {
    var _filters = fabric.Image.getFiltersList(this);
    for (var i in this.filters) {
      var _f = fabric.util.object.findWhere(_filters, { type: fabric.util.string.capitalize(this.filters[i].type) });
      if (_f) {
        _f.enabled = true;
      }
    }
    return _filters;
  },
  availableFilters: [
  //fabricJS
  "Grayscale", "Sepia", "Sepia2", "Invert", "Blur", "Sharpen", "Emboss", "Blend", "Tint", "Multiply",
  //"Convolute",
  "Noise", "Brightness", "Pixelate", "GradientTransparency", "Mask"],
  getFilter: function getFilter(filterName) {
    filterName = fabric.util.string.uncapitalize(filterName);
    for (var i in this.filters) {
      if (fabric.util.string.uncapitalize(this.filters[i].type) === filterName) {
        return this.filters[i];
      }
    }
    return false;
  },
  setFilter: function setFilter(filter) {

    var _old_filter = false;
    if (filter.replace) {
      this.filters = [];
    } else {
      _old_filter = fabric.util.object.findWhere(this.filters, { type: filter.type });
      _old_filter = _old_filter && _old_filter.toObject() || false;
    }

    if (filter.type) {
      var _type = fabric.util.string.capitalize(filter.type, true);
      var _new_filter = filter.options && fabric.util.object.clone(filter.options);
    } else {
      _type = false;
      _new_filter = false;
    }

    /* this.project.history.add({
     data:   [$.extend(true, {}, this.data)],
     slide:  this.slide,
     object: this,
     redo:   filter,
     undo:   _old_filter ,
     type:   "filter",
     undoFn: function(action){
     action.object._set_filter(action.undo);
     },
     redoFn:  function(action){
     action.object._set_filter(action.redo);
     }
     });
     */
    this._set_filter(_type, _new_filter, _old_filter);
  },

  _set_filter: function _set_filter(_type, _new_filter) {

    if (_type) {
      var _old_filter = this.getFilter(_type);
    }

    if (_old_filter && _new_filter) {
      for (var i in _new_filter) {
        _old_filter[i] = _new_filter[i];
      }
    } else if (_old_filter && !_new_filter) {
      this.filters.splice(this.filters.indexOf(_old_filter), 1);
    }
    if (!_old_filter && _new_filter) {
      this.filters.push(new fabric.Image.filters[_type](_new_filter));
    }
    this.applyFilters(this.canvas.renderAll.bind(this.canvas));
  },

  /**
   * @override
   * Applies filters assigned to this image (from "filters" array)
   * @method applyFilters
   * @param {Function} callback Callback is invoked when all filters have been applied and new image is generated
   * @param {Array} filters to be applied
   * @param {fabric.Image} imgElement image to filter ( default to this._element )
   * @param {Boolean} forResizing
   * @return {CanvasElement} canvasEl to be drawn immediately
   * @chainable
   */
  applyFilters: function applyFilters(callback, filters, imgElement, forResizing) {

    filters = filters || this.filters;
    imgElement = imgElement || this._originalElement;

    if (!imgElement) {
      return;
    }

    var replacement = fabric.util.createImage(),
        retinaScaling = this.canvas ? this.canvas.getRetinaScaling() : fabric.devicePixelRatio,
        minimumScale = this.minimumScaleTrigger / retinaScaling,
        _this = this,
        scaleX,
        scaleY;

    if (filters.length === 0) {
      this._element = imgElement;
      callback && callback(this);
      return imgElement;
    }

    var canvasEl = fabric.util.createCanvasElement();
    canvasEl.width = imgElement.naturalWidth; //overridden
    canvasEl.height = imgElement.naturalHeight; //overridden
    canvasEl.getContext('2d').drawImage(imgElement, 0, 0, imgElement.naturalWidth, imgElement.naturalHeight);

    filters.forEach(function (filter) {
      if (!filter) {
        return;
      }
      if (forResizing) {
        scaleX = _this.scaleX < minimumScale ? _this.scaleX : 1;
        scaleY = _this.scaleY < minimumScale ? _this.scaleY : 1;
        if (scaleX * retinaScaling < 1) {
          scaleX *= retinaScaling;
        }
        if (scaleY * retinaScaling < 1) {
          scaleY *= retinaScaling;
        }
      } else {
        scaleX = filter.scaleX;
        scaleY = filter.scaleY;
      }
      filter.applyTo(canvasEl, scaleX, scaleY);
      if (!forResizing && filter.type === 'Resize') {
        _this.width *= filter.scaleX;
        _this.height *= filter.scaleY;
      }
    });

    /** @ignore */
    replacement.width = canvasEl.width;
    replacement.height = canvasEl.height;
    if (fabric.isLikelyNode) {
      replacement.src = canvasEl.toBuffer(undefined, fabric.Image.pngCompression);
      // onload doesn't fire in some node versions, so we invoke callback manually
      _this._element = replacement;
      !forResizing && (_this._filteredEl = replacement);
      callback && callback(_this);
    } else {
      replacement.onload = function () {
        _this._element = replacement;
        !forResizing && (_this._filteredEl = replacement);
        callback && callback(_this);
        replacement.onload = canvasEl = null;
      };
      replacement.src = canvasEl.toDataURL('image/png');
    }
    return canvasEl;
  },

  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    filters: {
      title: "фильтр",
      itemClassName: "filters-selector",
      className: "fa fa-filter",
      type: "select",
      dropdown: {
        theme: "toolbar-filters-selector",
        previewWidth: 0,
        previewHeight: 22,
        templateSelection: function templateSelection(state, container) {
          if (state.any) {
            return state.text;
          }
          return $('<span><span class="color-span" style="background-color:' + state.text + '"></span>' + state.text + '</span>');
        },
        templateResult: function templateResult(state, container, data) {
          var $el = $('<span>' + state.text + '</span>');
          var $canvas = $('<canvas>');
          fabric.util.drawFilter($canvas[0], data.target._originalElement || data.target._element, state.id, {
            width: data.dropdown.previewWidth,
            height: data.dropdown.previewHeight
          });
          $el.prepend($canvas);
          return $el;
        }
      },

      value: {
        set: function set(val, filtersData) {
          var options = false;
          if (val === "none") {
            val = false;
          } else {
            var _f = fabric.util.object.findWhere(filtersData, { id: val });
            _f.enabled = !_f.enabled;
            for (var i in _f.options) {
              if ($.isNumeric(_f.options[i])) {
                _f.options[i] = parseFloat(_f.options[i]);
              }
            }
            if (_f.enabled) {
              options = {};
              for (var i in _f.options) {
                options[i] = _f.options[i].value;
              }
            }
          }
          this.setFilter({
            type: val,
            options: options,
            replace: true
          });
        },
        get: function get() {
          return this.filters.length ? fabric.util.string.capitalize(this.filters[0].type, true) : "none";
        },
        options: function options() {

          var _filters = this.getFiltersData();
          for (var i in _filters) {
            _filters[i].id = _filters[i].type;
          }
          return [{
            id: 'none',
            text: 'original',
            enabled: !this.filters || !this.filters.length
          }].concat(_filters);
        }
      }
    }
  })
});

//
// fabric.Image.filterManager = {
//
//   //hide: function(object){
//   //
//   //},
//   show: function (object) {
//     this.activeObject = object;
//     this.fire('show', object);
//     this.on('target:changed', object)
//   }
// // };


// fabric.util.observable(fabric.Image.filterManager);

fabric.util.drawFilter = function (element, src, filterName, options) {
  if (src.constructor === String) {
    fabric.util.loadImage(src, function (el) {
      fabric.util._drawFilter(element, el, filterName, options);
    });
  } else {
    fabric.util._drawFilter(element, src, filterName, options);
  }
};

fabric.util._drawFilter = function (element, el, filterName, options) {

  var ctx = element.getContext("2d");
  if (options) {
    if (options.width && options.height) {
      element.width = options.width;
      element.height = options.height;
    } else if (options.width) {
      element.width = options.width;
      element.height = options.width * (el.height / el.width);
    } else if (options.height) {
      element.height = options.height;
      element.width = options.height * (el.width / el.height);
    }
  }

  ctx.drawImage(el, 0, 0, element.width, element.height);

  if (!filterName || filterName == "none") return;
  filterName = fabric.util.string.capitalize(filterName, true);

  if (fabric.Image.filters[filterName]) {
    var _filter = new fabric.Image.filters[filterName]();
  } else {
    var _filter = fabric.Image.filters[filterName].create({});
  }

  //var _filter = new fabric.Image.filters[filterName];
  if (_filter) {
    var _fo = fabric.Image.filters[filterName].prototype.options;
    var filterOptions = {};
    for (var i in _fo) {
      filterOptions[i] = _fo[i].value;
    }
    fabric.util.object.extend(_filter, filterOptions);
    _filter.imageData = ctx.getImageData(0, 0, element.width, element.height);
    _filter.applyTo(element);
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/*
export interface GalleryData : {
 target: fabricjs object
}
*/

fabric.util.object.extend(fabric.Editor.prototype, {
  galleries: null,
  /**
   *
   *
    draggableArea: ".main_container",
   photo: config.cardType === CARD_TYPES.PHOTO || config.cardType === CARD_TYPES.BLANK && {
        container: "photos-gallery",
        elements: config.photosGallery,
        mapper: function (val) {
          return {
            preview: "image",
            type: "photo",
            src: config.photosPath + val
          }
        },
        options: {
          itemClass: "prevClose",
          removeButtonTemplate: '<span class="fa fa-close closeIMG">',
          removable: true
        }
      },
    * @param selectedData
   */
  setGalleries: function setGalleries(options) {
    if (options.draggableArea) {
      this.draggableArea = options.draggableArea;
      delete options.draggableArea;
    }
    this.galleries = [];
    for (var i in options) {
      var go = options[i];
      if (!go) {
        continue;
      }
      this.galleries[i] = this.createGallery(go.container, fabric.util.object.map(go.elements, go.mapper), go.options);
    }
  },

  // setElementFromMenu: function (selectedData) {
  //   this.canvas.createImageObject(selectedData.image, this.uploadClass);
  // };
  /*createGallery: function (target, $el, options) {
    if ($el.constructor === String) {
      $el = $("#" + $el);
    }
    options = options || {};
     if (target.galleryCategory) {
      options.category = target.galleryCategory;
    }
     $el.empty();
    var library = this.getLibraryElements(options);
      this.createElementsList($el, library);
     _.each(library, function (libraryItem) {
      var img = new Image();
      img.src = fabric.util.mediaRoot + libraryItem.src;
       var $img = $(img).width(100).height(100)
        .click(function () {
           var selectedData = {
            image: img,
            data: libraryItem,
            options: options
          };
          target.setElementFromMenu(selectedData);
        });
       $el.append($img);
    });
  },*/
  getFontsLibrary: function getFontsLibrary() {
    return _.map(this.fonts, function (fontName) {
      return {
        fontFamily: fontName,
        fontSize: 25,
        category: "fontFamily",
        role: "fontFamily",
        text: fontName,
        type: "text"
      };
    });
  },
  createGallery: function createGallery($el, library, options) {
    if (!options) {
      options = {};
    }
    options.application = this;
    return new fabric.Gallery($el, options, library);
  }
});

fabric.Gallery = function ($el, options, library) {
  if (options.application) {
    this.application = options.application;
  }
  if ($el.constructor === String) {
    $el = $("#" + $el);
  }
  this.element = $el;
  this.elements = [];
  this.options = this._getElementsListOptions(options);
  this.addElements(library);
};

fabric.Gallery.prototype = {
  // draggableArea: ".ff-container",
  draggableArea: "body",
  imageWidth: 300,
  imageHeight: 150,
  _addCanvasEl: function _addCanvasEl(el, element, innerEl) {
    // element = fabric.util.object.cloneDeep(element);

    var canvasEl = document.createElement("canvas");
    innerEl.width = canvasEl.width = this.imageWidth;
    innerEl.height = canvasEl.height = this.imageHeight;

    var _fake_canvas = new fabric.StaticCanvas(canvasEl, { application: this.application });
    _fake_canvas.clear();

    element.position = "center";

    _fake_canvas.createObject(element, function (_object) {
      var b = _object.getBoundingRect();
      /* _object.set({
         left : 80 - b.width/2 - _object.strokeWidth * 2,
         top : 45 - b.height/2 - _object.strokeWidth * 2
       });*/

      fabric.util.object.extend(element, {
        scaleX: _object.scaleX,
        scaleY: _object.scaleY,
        width: _object.width,
        height: _object.fheight,
        left: _object.left,
        top: _object.top,
        strokeWidth: _object.strokeWidth
      });

      delete element.position;

      _fake_canvas.add(_object);
      _fake_canvas.renderAll();

      innerEl.src = canvasEl.toDataURL();

      delete _object.canvas;
      el[0].data = element;
      el[0].element = _object;
    });
  },
  removeElement: function removeElement(element) {
    element.element.remove();
    var index = this.elements.indexOf(element);
    this.elements.splice(index, 1);
    this.fire("removed", { item: element, target: this, index: index });
    this.application && this.application.fire("gallery:removed", { item: element, target: this, index: index });
  },
  addElements: function addElements(elements) {
    var _this = this;

    elements.forEach(function (element) {
      return _this.add(element);
    });
  },
  _getElementsListOptions: function _getElementsListOptions(options) {

    return fabric.util.object.defaults(options || {}, {
      removable: false,
      draggable: true,
      itemClass: "list-item",
      removeButtonTemplate: '<span class="fa fa-close">',
      activate: function activate(data) {
        var data = fabric.util.object.clone(data);
        if (options.activateOptions && (options.activateOptions.width || options.activateOptions.height)) {
          delete data.width;
          delete data.height;
        } else {
          data.width = $(data.activeElement).width();
          data.height = $(data.activeElement).height();
        }

        fabric.util.object.extend(data, options.activateOptions);
        delete data.left;
        delete data.top;
        var _canvas = this.canvas;

        if (_canvas.target && _canvas.isAccepts(_canvas.target.accepts, data)) {
          _canvas.target.setData(data);
        } else {
          _canvas.setData(data);
        }
      }
    });
  },
  add: function add(element) {
    var _this2 = this;

    var options = this.options;

    var el = $("<li>").addClass(options.itemClass);

    var insertedElement = {
      data: element,
      element: el
    };

    el[0].data = element;

    if (options.element) {
      element = options.element(element);
    }

    if (element.title) {
      var $span = $("<span>").text(element.title).addClass("element-title");
      el.append($span);
    }
    var $innerEl = null;

    if (options.render) {
      $innerEl = options.render(element);
    } else {
      if (element.role === "fontFamily") {
        element.preview = "fontFamily";
      }
      if (element.type === "image" || element.type === "video") {
        if (!element.preview) {
          element.preview = element.type;
        }
        if (!element.role) {
          element.role = element.type;
        }
      }

      switch (element.preview) {
        case "fontFamily":
          $innerEl = $("<span>").css({
            "color": element.fill || fabric.Text.prototype.fill,
            "font-family": element.fontFamily,
            "font-size": element.fontSize
          }).text(element.text);
          break;
        case "image":
          var img = element.image;

          if (!img) {
            var img = new Image();
            img.onload = function () {
              element.width = img.width;
              element.height = img.height;
              element.image = img;
            };
            img.crossOrigin = 'anonymous';
            img.src = fabric.util.getURL(element.src);
          }
          // el[0].element = img;
          el[0].element = element;
          $innerEl = $(img);
          break;
        case "video":
          $innerEl = $("<video>");
          $innerEl[0].crossOrigin = 'anonymous';
          for (var type in element.src) {
            $innerEl.append($("<source>").attr({
              src: fabric.util.mediaRoot + element.src[type],
              type: type
            }));
          }
          el[0].element = $innerEl[0];
          break;
        default:
          $innerEl = $("<img>");
          this._addCanvasEl(el, element, $innerEl[0]);
      }
    }
    if ($innerEl.constructor == Array) {
      var _span = $("<span>");
      _span.append($innerEl);
      $innerEl = _span;
    }
    el.append($innerEl);

    if (options.removable) {
      var _span = $(this.options.removeButtonTemplate);
      _span.click(this.removeElement.bind(this, insertedElement));
      el.append(_span);
    }

    if (options.draggable) {
      $innerEl.draggable({
        draggable: "helper",
        droppable: ".canvas-container",
        ngModel: element,
        onMove: function onMove(data) {
          //todo может быть несколько канвасов
          _this2.application.canvas._onDragMove && _this2.application.canvas._onDragMove(data.$event);
        },
        onDrop: function onDrop(data) {
          //todo может быть несколько канвасов
          _this2.application.canvas._onDrop(data.$event);
        },
        draggableArea: this.draggableArea
      });
    }
    element.activeElement = $innerEl;
    $innerEl.click(options.activate.bind(this.application, element));
    this.element.append(el);

    this.elements.push(insertedElement);
  }
};
fabric.util.observable(fabric.Gallery.prototype);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * Aligment library for FabricJS
 *
 *
 *
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */

fabric.GridSnapper = function (canvas, options) {
  this.canvas = canvas;

  this.rect = fabric.util.getRect(canvas.width, canvas.height, canvas.offsets);

  for (var prop in options) {
    this[prop] = options[prop];
  }

  this.createAligmentLines(canvas);

  // for(let i in this.canvas._objects){
  //   this.applySnap(this.canvas._objects[i]);
  // }

  var _gs = this;

  (this.canvas.wrapperEl || this.canvas.lowerCanvasEl).addEventListener("mousedown", function () {
    window.addEventListener("mouseup", _gs._window_mouse_up.bind(_gs));
  });
};

fabric.util.object.extend(fabric.Object.prototype, {
  griddable: true,
  snapCorners: {
    tl: ["tl", "bl", "br", "tr"],
    bl: ["tl", "bl", "br", "tr"],
    tr: ["tl", "bl", "br", "tr"],
    br: ["tl", "bl", "br", "tr"],
    c: ["c"]
  }
});
fabric.util.object.extend(fabric.Canvas.prototype, {
  gridSize: 25,
  gridColor: 25,
  grid: false,
  snapArea: 3,
  snapping: false,
  setSnapping: function setSnapping(val) {
    if (val) {
      this.on("object:moving", this.gridSnapMove);
      this.on('mouse:up', this.clearSnapping);
      if (this.drawSnapping) {
        this.on('after:render', this._drawSnapping);
      }
    } else {
      this.off("object:moving", this.gridSnapMove);
      this.off('mouse:up', this.clearSnapping);
      if (this.drawSnapping) {
        this.off('after:render', this._drawSnapping);
      }
    }
    this.snapping = val;
  },
  setGrid: function setGrid(val) {
    if (val) {
      this.grid = new fabric.GridSnapper(this);
      this.grid.createGrid();
      this.grid.createGridFrame();
    } else if (this.grid) {
      this.grid.removeGrid();
      this.grid.removeGridFrame();
      this.grid = null;
    }
    this.renderAll();
  },
  clearSnapping: function clearSnapping() {
    this.clearContext(this.contextTop);
    this.snapTo = null;
  },


  /**
   * @param object
   * @returns {{x: (false|{value, corner}|{value, corner, object2, corner2}), y: (false|{value, corner}|{value, corner, object2, corner2})}}
   */
  gridSnapMove: function gridSnapMove(options) {

    if (options.e.shiftKey || !options.target.griddable) {
      return;
    }

    options.target.setCoords();

    var x = this.gridSnapMoveByAxe(options.target, "x"),
        y = this.gridSnapMoveByAxe(options.target, "y");

    this.snapTo = { x: x, y: y };
    this.snapCallback && this.snapCallback(this.snapTo);

    return this.snapTo;
  },
  _get_corner: function _get_corner(object, corner_name) {

    if (corner_name == "c") {
      var p = object.getCenterPoint();
      var _scale = this.getZoom();
      p.x *= _scale;
      p.y *= _scale;
      return p;
    }
    return object.oCoords[corner_name];
  },
  gridSnapMoveByAxe: function gridSnapMoveByAxe(object, axe) {

    var _scale = this.getZoom();
    var _l = void 0,
        _w = void 0,
        _c = void 0,
        _p = void 0;

    if (axe == "x") {
      _l = this.offsets.left;
      _w = this.originalWidth - this.offsets.right - _l;
      _c = object.left;
      _p = "left";
    } else {
      _l = this.offsets.top;
      _w = this.originalHeight - this.offsets.bottom - _l;
      _c = object.top;
      _p = "top";
    }
    var sc = object.snapCorners;

    //supportlines
    for (var corner_name in sc) {
      var corner = this._get_corner(object, corner_name);
      for (var i in this.supportLines) {
        var l = this.supportLines[i];
        var _val = l[axe] + this.rect[_p];
        if (l[axe] && Math.abs(_val - corner[axe]) < this.snapArea) {
          object[_p] = (_val - (corner[axe] - object.oCoords.tl[axe])) / object.canvas.viewportTransform[0];
          return { value: _val, corner: corner_name, object2: l, line: true };
        }
      }
    }

    //guidlines
    for (var _corner_name2 in sc) {
      var _corner = this._get_corner(object, _corner_name2);
      for (var _i in this.guidlines) {
        var _l2 = this.guidlines[_i];
        var _val2 = _l2[axe] * _scale;
        if (_l2[axe] && Math.abs(_val2 - _corner[axe]) < this.snapArea) {
          object[_p] = (_val2 - (_corner[axe] - object.oCoords.tl[axe])) / object.canvas.viewportTransform[0];
          return { value: _val2, corner: _corner_name2, object2: _l2, line: true };
        }
      }
    }

    //grid

    for (var _corner_name3 in sc) {
      var _corner2 = this._get_corner(object, _corner_name3);

      if (this.grid.gridEnabled) {
        var x = (_corner2[axe] - _l + this.snapArea + this.grid._gridOffset[axe]) % this.gridSize;
        if (x < -this.gridSize) return false;
        if (x < this.snapArea * 2) {
          //let _xxx = _c + (corner[axe] - object.oCoords.tl[axe]);
          // if (_xxx > _l && _xxx < _w + _l) {
          object[_p] -= x - this.snapArea;
          return { value: _corner2[axe] - x + this.snapArea, corner: _corner_name3, grid: true };
        }
      }

      if (this.borderEnabled) {
        //grid width/height
        var valX = (_w + this.offsets[_p]) * _scale;
        if (Math.abs(valX - _corner2[axe]) < this.snapArea) {
          object[_p] = (valX - (_corner2[axe] - object.oCoords.tl[axe])) / _scale;
          return { value: valX, corner: _corner_name3, grid: true, corner2: axe == "x" ? "width" : "height" };
        }
        //grid top/left
        var valY = this.offsets[_p] * this.getZoom();
        if (Math.abs(valY - _corner2[axe]) < this.snapArea) {
          object[_p] = (valY - (_corner2[axe] - object.oCoords.tl[axe])) / object.canvas.viewportTransform[0];
          return { value: valY, corner: _corner_name3, grid: true, corner2: _p };
        }
      }
    }

    //other objects
    for (var _obj_index in this._objects) {
      var _obj = this._objects[_obj_index];
      if (!_obj.griddable || _obj == object || !_obj.visible || _obj.hiddenActive) continue;

      for (var _corner_name4 in sc) {
        var _corner3 = this._get_corner(object, _corner_name4);

        for (var j in sc[_corner_name4]) {
          var corner_name_2 = sc[_corner_name4][j];
          var corner_2 = this._get_corner(_obj, corner_name_2);

          if (Math.abs(_corner3[axe] - corner_2[axe]) < this.snapArea) {
            object[_p] = (corner_2[axe] - (_corner3[axe] - object.oCoords.tl[axe])) / object.canvas.viewportTransform[0];
            return { value: corner_2[axe], corner: _corner_name4, object2: _obj, corner2: corner_name_2 };
          }
        }
      }
    }
    return false;
  },
  _drawSnapping: function _drawSnapping() {
    var ctx = this.contextTop,
        snapTo = this.snapTo;
    ctx.strokeStyle = "#ffaaaa";

    if (this._currentTransform && snapTo) {
      this.clearContext(ctx);
    }

    if (!snapTo) return;
    if (snapTo.x) {
      ctx.beginPath();
      if (snapTo.x.object2) {
        var _ic = void 0,
            _c = void 0;
        _c = snapTo.x.object2.oCoords;
        if (snapTo.x.line) {
          ctx.moveTo(_c.mt.x, 0);
          ctx.lineTo(_c.mt.x, this.height);
        } else {

          ctx.moveTo(_c.tl.x, _c.tl.y);
          ctx.lineTo(_c.tr.x, _c.tr.y);
          ctx.lineTo(_c.br.x, _c.br.y);
          ctx.lineTo(_c.bl.x, _c.bl.y);
          ctx.lineTo(_c.tl.x, _c.tl.y);

          if (snapTo.x.corner2 == "c") {
            _ic = snapTo.x.object2.getCenterPoint();
          } else {
            _ic = _c[snapTo.x.corner2];
          }
          if (_ic) {
            ctx.moveTo(_ic.x, _ic.y);
            ctx.arc(_ic.x, _ic.y, 2, 0, 2 * Math.PI);
          }
        }

        var _active = this._activeObject || this._activeGroup;
        _c = _active.oCoords;
        if (snapTo.x.corner == "c") {
          _ic = snapTo.x.object2.getCenterPoint();
        } else {
          _ic = _c[snapTo.x.corner];
        }
        ctx.moveTo(_ic.x, _ic.y);
        ctx.arc(_ic.x, _ic.y, 2, 0, 2 * Math.PI);
      }
      ctx.moveTo(snapTo.x.value, 0);
      ctx.lineTo(snapTo.x.value, this.height);
      ctx.stroke();
    }
    if (snapTo.y) {
      ctx.beginPath();

      if (snapTo.y.object2) {
        var _ic2 = void 0,
            _c2 = void 0;
        _c2 = snapTo.y.object2.oCoords;
        if (snapTo.y.line) {
          ctx.moveTo(0, _c2.ml.y);
          ctx.lineTo(this.width, _c2.ml.y);
        } else {
          ctx.moveTo(_c2.tl.x, _c2.tl.y);
          ctx.lineTo(_c2.tr.x, _c2.tr.y);
          ctx.lineTo(_c2.br.x, _c2.br.y);
          ctx.lineTo(_c2.bl.x, _c2.bl.y);
          ctx.lineTo(_c2.tl.x, _c2.tl.y);
          if (snapTo.y.corner2 == "c") {
            _ic2 = snapTo.y.object2.getCenterPoint();
          } else {
            _ic2 = _c2[snapTo.y.corner2];
          }
          if (_ic2) {
            ctx.moveTo(_ic2.x, _ic2.y);
            ctx.arc(_ic2.x, _ic2.y, 2, 0, 2 * Math.PI);
          }

          var _active2 = this._activeObject || this._activeGroup;
          _c2 = _active2.oCoords;
          if (snapTo.y.corner == "c") {
            _ic2 = snapTo.y.object2.getCenterPoint();
          } else {
            _ic2 = _c2[snapTo.y.corner];
          }
          ctx.moveTo(_ic2.x, _ic2.y);
          ctx.arc(_ic2.x, _ic2.y, 2, 0, 2 * Math.PI);
        }
      }

      ctx.moveTo(0, snapTo.y.value);
      ctx.lineTo(this.width, snapTo.y.value);
      ctx.stroke();
    }
  },
  toggleGrid: function toggleGrid() {
    var val = !this.grid;
    this.processing = true;
    this.setGrid(val);
    this.setSnapping(val);
    this.processing = false;
  },

  actions: fabric.util.object.extend(fabric.Canvas.prototype.actions, {
    toggleGrid: {
      className: 'fa fa-th',
      key: 'i',
      title: 'Grid'
    }
  })
});
fabric.util.object.extend(fabric.Editor.prototype, {
  actions: fabric.util.object.extend(fabric.Editor.prototype.actions, {
    toggleGrid: {
      className: 'fa fa-th',
      key: 'i',
      title: 'Grid',
      action: function action() {
        this.canvas.toggleGrid();
      }
    }
  })
});

fabric.GridSnapper.prototype = {
  //offsets and size of the grid
  rect: null,
  //   {
  //   top: 50,
  //   left: 50,
  //   width: 600,
  //   height: 600
  // },
  /**
   * support lines
   * @value [{
     *  [x: integer],
     *  [y: integer]
     * }]
   */
  supportLines: [],
  /**
   * fabrc objects.
   * @value [klass]
   */
  objects: [],
  //the area in pixels, where object will be snapped to the grid
  //flag
  enabled: true,
  //
  gridEnabled: true,
  borderEnabled: true,
  gridBorder: false,
  //size of the grid
  gridSize: 25,
  /**
   * corners that will be snapped to the grid. This is the name from fabric object oCoords property. ( it is possible to more or less points )
   */

  _window_mouse_up: function _window_mouse_up() {
    this.hideAligmentLines();
    window.removeEventListener('mouseup', this._window_mouse_up);
  },

  // applySnap (obj){
  //   let _gs = this;
  //   //
  //   // this.canvas.on("object:removed",function(e){
  //   //   let i = _gs.canvas._objects.indexOf(e.target);
  //   //   if(i == -1)return;
  //   //   _gs.canvas._objects.splice(i,1);
  //   // });
  //
  //   // obj.on("moving",function(){
  //   //   if(_gs.enabled){
  //   //     _gs.gridSnapMove(this);
  //   //   }
  //   // });
  // },

  creteSupportLines: function creteSupportLines() {
    var rect = this.rect;

    var objs = [];
    for (var i = 0; i < this.supportLines.length; i++) {
      var l = this.supportLines[i];
      objs.push(new fabric.Line(l.x ? [l.x, 0, l.x, rect.height] : [0, l.y, rect.width, l.y], { stroke: 'red' }));
    }

    var support = new fabric.Group(objs, {
      left: rect.left,
      top: rect.top,
      selectable: false,
      evented: false
    });
    this.canvas._helpersObjects.push(support);
    return support;
  },
  removeGridFrame: function removeGridFrame() {
    this.canvas._helpersObjects.splice(this.canvas._helpersObjects.indexOf(this.gridFrame), 1);
    delete this.gridFrame;
  },
  removeGrid: function removeGrid() {

    this.canvas._helpersObjects.splice(this.canvas._helpersObjects.indexOf(this._gridObject), 1);
    delete this._gridObject;
  },
  updateGridSize: function updateGridSize() {

    this.removeGridFrame();
    this.createGridFrame();

    if (this._gridObject) {
      this.removeGrid();
      this.createGrid();
    }
    this.canvas.renderAll();
  },
  createGridFrame: function createGridFrame() {
    var objs = [];

    objs.push(new fabric.Line([0, this.rect.top, this.canvas.width, this.rect.top], {
      stroke: this.canvas.gridColor
    }));
    objs.push(new fabric.Line([0, this.rect.top + this.rect.height, this.canvas.width, this.rect.top + this.rect.height], {
      stroke: this.canvas.gridColor
    }));
    objs.push(new fabric.Line([this.rect.left, 0, this.rect.left, this.canvas.height], {
      stroke: this.canvas.gridColor
    }));
    objs.push(new fabric.Line([this.rect.left + this.rect.width, 0, this.rect.left + this.rect.width, this.canvas.height], {
      stroke: this.canvas.gridColor
    }));

    this.gridFrame = new fabric.Group(objs, {
      selectable: false,
      evented: false
    });
    this.canvas._helpersObjects.push(this.gridFrame);
    return this.gridFrame;
  },

  /**
   * create a set of lines on the canvas
   * @returns {*}
   */
  createGrid: function createGrid() {
    var rect = this.rect,
        size = this.canvas.gridSize,
        objs = [];
    this._gridOffset = {
      y: (size - rect.height % size) / 2,
      x: (size - rect.width % size) / 2
    };

    for (var y = size - this._gridOffset.y; y <= rect.height - 1; y += size) {
      objs.push(new fabric.Line([0, y, rect.width, y], {
        stroke: this.canvas.gridColor
      }));
    }

    for (var x = size - this._gridOffset.x; x <= rect.width - 1; x += size) {
      objs.push(new fabric.Line([x, 0, x, rect.height], {
        stroke: this.canvas.gridColor
      }));
    }

    this._gridObject = new fabric.Group(objs, {
      left: rect.left,
      top: rect.top,
      selectable: false,
      evented: false
    });

    this.canvas._helpersObjects.push(this._gridObject);
    return this._gridObject;
  },

  snapCallback: function snapCallback(snapTo) {
    this.snapTo = snapTo;
  },
  hideAligmentLines: function hideAligmentLines(canvas) {

    if (this.xLine) {
      this.xLine.setVisible(false);
      this.xLine.canvas.renderAll();
    }
    if (this.yLine) {
      this.yLine.setVisible(false);
      this.xLine.canvas.renderAll();
    }
  },
  createAligmentLines: function createAligmentLines() {
    //this.xLine = new fabric.Line([1, 0, 1, this.canvas.height], {
    //    left:0,
    //    stroke: '#40D0FF',
    //    selectable: false,
    //    evented: false,
    //    visible: false
    //});
    //this.yLine = new fabric.Line([0, 1, this.canvas.width, 1], {
    //    top:0,
    //    stroke: '#40D0FF',
    //    selectable: false,
    //    evented: false,
    //    visible: false
    //});
    //
    //this.canvas.add(this.xLine);
    //this.canvas.add(this.yLine);

  },


  //snap to grid by x coordinates
  gridSnapResize: function gridSnapResize(object) {

    this.setCoords();
    var x = this.gridSnapXResize(object),
        y = this.gridSnapYResize(object);
    this.snapTo = { x: x, y: y };
    this.snapCallback && this.snapCallback(this.snapTo);
    return this.snapTo;
  },
  gridSnapXResize: function gridSnapXResize(object) {

    var self = this;

    var _l = self.rect.left,
        _w = self.rect.width;

    var active_corner = canvas._currentTransform.corner;

    var coords = [];
    var is_right = false;
    switch (active_corner) {
      case "tr":
      case "br":
      case "mr":
        is_right = true;
        coords = ["tr", "br"];
        break;
      case "tl":
      case "bl":
      case "ml":
        coords = ["bl", "tl"];
        break;
    }

    var to_radians = Math.PI / 180;
    for (var i in this.snapCorners) {
      var _corner_name = this.snapCorners[i];
      if (coords.indexOf(_corner_name) == -1) continue;
      var corner = object.oCoords[this.snapCorners[i]];

      var x = (corner.x - _l + self.area) % self.gridSize;
      var _line = Math.floor((corner.x - _l + self.area) / self.gridSize) + 1;
      if (x < -self.gridSize) return false;
      if (x < self.area * 2) {
        if (corner.x > _l && corner.x < _w + _l) {

          if (is_right) {
            if (_corner_name == "tr") {
              var _opt = {
                scaleX: object.scaleX * (_line * self.gridSize - object.oCoords.tl.x - _l) / (corner.x - object.oCoords.tl.x)
              };
            }
            if (_corner_name == "br") {
              var _opt2 = {
                scaleX: object.scaleX * (_line * self.gridSize - object.oCoords.bl.x - _l) / (corner.x - object.oCoords.bl.x)
              };
            }
            //if(_corner_name == "mr"){
            //    let opt = {
            //        scaleX: object.scaleX *  (_line * self.gridSize - object.oCoords.ml.x - _l)/(corner.x - object.oCoords.ml.x)
            //    };
            //}
          } else {
            var scale2 = (corner.x + object.width * object.scaleX - ((_line - 1) * self.gridSize + _l)) / object.width;
            //if(_corner_name == "tl"){
            //    let _l = (_line - 1) * self.gridSize + _l;
            //    let _r = object.oCoords.tr.x;
            //    let _w = _r - _l;
            //
            //   let _scale   = _w / (object.width *Math.sin(object.angle *  to_radians ));
            //
            //    opt = {
            //
            //        scaleX: scale2
            //    };
            //}
            //else{

            var _opt3 = {
              left: object.oCoords.tr.x - (object.oCoords.tr.x - object.left) / object.scaleX * scale2,
              scaleX: scale2
            };
            if (_corner_name != "ml") {
              _opt3.top = object.oCoords.tr.y - (object.oCoords.tr.y - object.top) / object.scaleX * scale2;
            }
            //}

          }
          object.set(opt);
          return { value: object.left + (corner.x - object.oCoords.tl.x), corner: _corner_name };
        }
      }
    }
    return false;
  },


  //snap to grid by x coordinates
  gridSnapYResize: function gridSnapYResize(object) {

    var self = this;

    var _l = self.rect.top,
        _w = self.rect.height;

    var active_corner = canvas._currentTransform.corner;

    var coords = [];
    var is_right = false;
    switch (active_corner) {
      //             case "ml":
      //                 coords = ["tl","bl"];
      //                 break;
      //             case "mr":
      //                 is_right = true;
      //                 coords = ["tr","br"];
      //                 break;
      case "tr":
      case "tl":
      case "mt":
        coords = ["tl", "tr"];
        break;
      case "bl":
      case "mb":
      case "br":
        is_right = true;
        coords = ["bl", "br"];
        break;
    }

    for (var i in this.snapCorners) {
      var _corner_name = this.snapCorners[i];
      if (coords.indexOf(_corner_name) == -1) continue;
      var corner = object.oCoords[this.snapCorners[i]];

      var y = (corner.y - _l + self.area) % self.gridSize;
      var _line = Math.floor((corner.y - _l + self.area) / self.gridSize) + 1;
      if (y < -self.gridSize) return false;
      if (y < self.area * 2) {
        if (corner.y > _l && corner.y < _w + _l) {

          if (is_right) {
            if (_corner_name == "bl") {
              var _opt4 = {
                scaleY: object.scaleY * (_line * self.gridSize - object.oCoords.tl.y - _l) / (corner.y - object.oCoords.tl.y)
              };
            }
            if (_corner_name == "br") {
              var _opt5 = {
                scaleY: object.scaleY * (_line * self.gridSize - object.oCoords.tr.y - _l) / (corner.y - object.oCoords.tr.y)
              };
            }
            //if(_corner_name == "mb"){
            //    let opt = {
            //        scaleY: object.scaleY *  (_line * self.gridSize - object.oCoords.tr.y - _l)/(corner.y - object.oCoords.mt.y)
            //    };
            //}
          } else {
            var scale2 = (corner.y + object.width * object.scaleY - ((_line - 1) * self.gridSize + _l)) / object.width;
            var _opt6 = {
              top: object.oCoords.bl.y - (object.oCoords.bl.y - object.top) / object.scaleY * scale2,
              scaleY: scale2
            };
            //if(_corner_name != "mt"){
            //    opt.left =  object.oCoords.bl.y - (object.oCoords.bl.y - object.left)/object.scaleY * scale2;
            //}
          }
          object.set(opt);
          return { value: object.left + (corner.y - object.oCoords.tl.y), corner: _corner_name };
        }
      }
    }
    return false;
  }
};

// WEBPACK FOOTER //
// src/modules/grid.js
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.objectsLibrary = {
  text: {
    title: "Text",
    type: "text",
    text: "Текст"
  },
  iText: {
    title: "IText",
    type: "i-text",
    text: "Текст"
  },
  textbox: {
    title: "Textbox",
    type: "textbox",
    text: "Текст",
    width: 100
  },
  line: {
    type: "line",
    strokeWidth: 5,
    stroke: "black",
    scaleX: 1,
    scaleY: 1,
    x1: 0,
    x2: 100,
    y1: 0,
    y2: 50
  },
  triangle: {
    type: "triangle",
    width: function width(w, h) {
      return Math.min(w, h) - 4;
    },
    height: function height(w, h) {
      return Math.min(w, h) - 4;
    }
  },
  rectangle: {
    type: "rect",
    width: function width(w, h) {
      return Math.min(w, h) - 4;
    },
    height: function height(w, h) {
      return Math.min(w, h) - 4;
    }
  },
  polygon: {
    scaleX: 1,
    scaleY: 1,
    type: "polygon",
    points: function points(w, h) {
      return [{ x: 25, y: 1 }, { x: 31, y: 18 }, { x: 49, y: 18 }, { x: 35, y: 29 }, { x: 40, y: 46 }, { x: 25, y: 36 }, { x: 10, y: 46 }, { x: 15, y: 29 }, { x: 1, y: 18 }, { x: 19, y: 18 }];
    }
  },
  path: {
    "type": "path",
    "path": "m581.077942,2.537359c-2.053223,0.047071 -4.04071,0.188348 -6.108093,0.352907c-33.05542,2.663918 -62.235901,19.640541 -77.057678,44.925953l-7.8573,19.135319c1.698822,-6.633144 4.302979,-13.065384 7.8573,-19.135319c-26.430695,-22.16293 -63.531677,-32.388445 -100.192383,-27.574373c-36.661469,4.788353 -68.503082,24.041758 -85.901978,51.935225c-49.116486,-24.490013 -110.34288,-22.999454 -157.711807,3.860092c-47.369164,26.86068 -72.61673,74.40551 -64.941162,122.38308l5.021355,19.49968c-2.263329,-6.38501 -3.960793,-12.887695 -5.021355,-19.49968l-0.761948,1.798569c-41.179165,3.625244 -74.945375,29.465134 -83.716398,64.059235c-8.771805,34.597748 9.46701,70.085876 45.185621,87.96701l55.776558,10.973114c-19.480217,1.291962 -38.915543,-2.534515 -55.776558,-10.973114c-27.5478,24.96817 -33.888516,61.935303 -15.71492,92.467834c18.173733,30.524719 56.988899,48.110687 97.030457,44.11734l24.339722,-5.21109c-7.827499,2.651611 -15.960983,4.379059 -24.339722,5.21109c22.730042,33.857269 60.428192,58.556244 104.66893,68.383514c44.2491,9.81366 91.240952,4.014771 130.425949,-16.094604c31.96701,40.793823 88.707642,62.217468 145.596313,54.99707c56.902466,-7.219666 103.833984,-41.81427 120.501343,-88.770996l5.781433,-26.239532c-0.863708,8.909546 -2.742249,17.681366 -5.781433,26.239532c39.133301,20.753662 88.353333,21.927307 128.785095,3.049316c40.439819,-18.874084 65.665771,-54.869049 66.036133,-94.078247l-14.495605,-58.580597l-57.105713,-39.630768c44.163452,22.374573 71.992615,56.467255 71.601318,98.211365c52.49707,0.448181 97.103394,-35.956573 117.112427,-77.726288c20.011597,-41.769836 12.443604,-89.396759 -19.864929,-125.164642c13.401184,-26.637695 12.609985,-56.937332 -2.183472,-83.034088c-14.786194,-26.097893 -42.065491,-45.476891 -74.873047,-53.098335c-7.341431,-34.580929 -37.602661,-62.404482 -77.600708,-71.526293c-39.998474,-9.121368 -82.584839,2.123992 -109.364807,28.926123l-16.258179,22.19817c4.157959,-8.018612 9.583923,-15.495213 16.258179,-22.19817c-18.876953,-21.060713 -48.486023,-32.954061 -79.348938,-32.155401l0,0z",
    "width": function width(w, h) {
      return w - 4;
    },
    "height": function height(w, h) {
      return h - 4;
    }
  },
  ellipse: {
    "type": "ellipse",
    "rx": function rx(w, h) {
      return w / 2 - 4;
    },
    "ry": function ry(w, h) {
      return h / 2 - 4;
    }
  },
  circle: {
    type: "circle",
    radius: function radius(w, h) {
      return Math.min(w, h) / 2 - 4;
    }
  }
};

fabric.util.object.extend(fabric.Editor.prototype, {
  getLibraryElements: function getLibraryElements(options) {
    var category = fabric.util.object.findWhere(this.library, { id: options.category });

    var category_items = fabric.util.object.cloneDeep(category.items);

    return fabric.util.object.map(fabric.util.object.cloneDeep(category.items), function (el) {
      return fabric.util.object.defaults(el, category.template);
    });
  },
  /**
   *
   * @param value
   * @param callback
   *
   * @example
   [{
    "id": 5,
    "title": "video",
    "template": {
      "type": "video"
    },
    "items": [
      {
        "src": "video.mpg"
        "height": 360,
        "width": 480
      }]
    }]
   */
  setLibrary: function setLibrary(value, callback) {
    var _this = this;

    fabric.util.data.loadJson(value, function (data) {
      data.forEach(function (category) {
        if (!category.id) {
          category.id = ++fabric.util._idCounter;
        }
      });
      _this.library = data;
      callback();
    });
  },
  getObjectsList: function getObjectsList(w, h) {
    var _lib = [];
    for (var i in fabric.objectsLibrary) {
      console.log(i);
      var o = fabric.util.object.cloneDeep(fabric.objectsLibrary[i]);
      o.id = i;
      _lib.push(o);
      o.title = o.title || o.type;
      if (o.width === 0) o.width = w;
      if (o.height === 0) o.height = h;
      for (var j in o) {
        if (o[j].constructor === Function) {
          o[j] = o[j].call(o, w, h);
        }
      }
    }
    return _lib;
  }
});
fabric.Editor.prototype.configurationProperties.push("library");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric, __dirname) {

fabric.util.mediaRoot = "";
fabric.util.addNoCache = false;

fabric.util._loadImage_overwritten = fabric.util.loadImage;

fabric.util.object.extend(fabric.Editor.prototype, {
  optionsOrder: function () {
    var oo = fabric.Editor.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"), 0, "mediaRoot");
    return oo;
  }(),
  setMediaRoot: function setMediaRoot(val) {
    if (val) {
      if (val.indexOf("://" != -1)) {
        fabric.util.mediaRoot = val;
        return;
      }
      var _dirname;
      if (fabric.isLikelyNode) {
        _dirname = __dirname;
      } else {
        _dirname = fabric.util.path.getParentDirectoryUrl(window.location.href);
      }
      var _last = val[val.length - 1];
      if (_last != "/" && _last != "\\") {
        val += "/";
      }
      val = fabric.util.path.resolve(_dirname + val);
      fabric.util.mediaRoot = val;
    }
  }
});

// if(!fabric.isLikelyNode){
//
//   var URL = require('url'),
//     HTTP = require('http'),
//     HTTPS = require('https'),
//     Image = require('canvas').Image;
//
//   /** @private */
//   var request = function (url, encoding, callback) {
//     var oURL = URL.parse(url);
//
//     // detect if http or https is used
//     if ( !oURL.port ) {
//       oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;
//     }
//
//     // assign request handler based on protocol
//     var reqHandler = (oURL.protocol.indexOf('https:') === 0 ) ? HTTPS : HTTP,
//       req = reqHandler.request({
//         hostname: oURL.hostname,
//         port: oURL.port,
//         path: oURL.path,
//         method: 'GET'
//       }, function(response) {
//         var body = '';
//         if (encoding) {
//           response.setEncoding(encoding);
//         }
//         response.on('end', function () {
//           callback(body);
//         });
//         response.on('data', function (chunk) {
//           if (response.statusCode === 200) {
//             body += chunk;
//           }
//         });
//       });
//
//     req.on('error', function(err) {
//       if (err.errno === process.ECONNREFUSED) {
//         fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);
//       }
//       else {
//         fabric.log(err.message);
//       }
//       callback(null);
//     });
//
//     req.end();
//   }
//
//   /** @private */
//   var requestFs = function (path, callback) {
//     var fs = require('fs');
//     fs.readFile(path, function (err, data) {
//       if (err) {
//         fabric.log(err);
//         throw err;
//       }
//       else {
//         callback(data);
//       }
//     });
//   };
//
//   fabric.util.loadImage = function(url, callback, context) {
//
//
//     var img = new Image();
//     img.onerror = function(){
//       console.log("error");
//       callback && callback.call(context, null, true);
//     };
//     img.onload = function(){
//       console.log("success");
//       callback && callback.call(context, img);
//     };
//
//     function createImageAndCallBack(data) {
//       if (data) {
//         img.src = data;
//         // preserving original url, which seems to be lost in node-canvas
//         img._src = url;
//       }
//       else {
//         img = null;
//         callback && callback.call(context, null, true);
//       }
//     }
//
//     if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {
//       img.src = img._src = url;
//     }
//     else if (url && url.indexOf('http') !== 0) {
//       var path = require("path");
//       url = fabric.util.getURL(url);
//       url =   path.resolve(fabric.util.mediaRoot, url);
//       img.src =  url;
//       // requestFs(url, createImageAndCallBack);
//     }
//     else if (url) {
//       request(url, 'binary', createImageAndCallBack);
//     }
//     else {
//       callback && callback.call(context, url);
//     }
//   };
// }else{
fabric.util.loadResources = function (resources, callback, context, crossOrigin) {

  var loadedResources = {};
  var loader = fabric.util.queueLoad(Object.keys(resources).length, function () {
    callback(loadedResources);
  });
  for (var i in resources) {
    (function (i) {
      fabric.util.loadImage(resources[i], function (image) {
        loadedResources[i] = image;
        loader();
      }, context, crossOrigin);
    })(i);
  }
};

fabric.util.loadImage = function (url, callback, context, crossOrigin) {
  url = fabric.util.getURL(url);
  function _check_errors(img) {
    //изображение не было загружено
    if (img) {
      callback.call(this, img);
    } else {
      fabric.errors.push({ type: "image", message: "Image was not loaded" });
      fabric.util._loadImage_overwritten(fabric.media.error, callback, context, crossOrigin || 'Anonymous');
    }
  }

  if (fabric.debugTimeout) {
    setTimeout(fabric.util._loadImage_overwritten.bind(this, url, _check_errors, context, crossOrigin || 'Anonymous'), fabric.debugTimeout);
  } else {
    fabric.util._loadImage_overwritten(url, _check_errors, context, crossOrigin || 'Anonymous');
  }
};

fabric.util.getURL = function (url) {
  if (url.indexOf('blob') !== 0 && url.indexOf('data') !== 0 && url.indexOf('://') == -1 && !url.startsWith('./')) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + new Date().getTime();
  }
  return url;
};

fabric.util.loadVideo = function (sources, callback, context, crossOrigin) {

  function loadIt(url) {
    video.src = fabric.util.getURL(url);
    video.addEventListener("loadeddata", function () {
      callback(video);
    }, true);
    video.load();
  }

  var video = document.createElement('video');

  //trying to find the most suitable source for current browser
  for (var type in sources) {
    if (video.canPlayType(type) == "yes") {
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  for (var type in sources) {
    if (video.canPlayType(type) == "maybe") {
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  console.warn("video sources formats is not supported");
};

fabric.util._loadSVGFromURL_overwritten = fabric.loadSVGFromURL;
fabric.loadSVGFromURL = function (url, callback, reviver) {
  if (url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + moment().format('x');
  }
  fabric.util._loadSVGFromURL_overwritten(url, function (data) {
    if (data) {
      return callback(data);
    }

    var xml = jQuery.parseXML(atob(fabric.media.error.substr(26)));

    fabric.parseSVGDocument(xml.documentElement, function (results, options) {
      callback && callback(results, options);
    }, reviver);
  }, reviver);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), "/"))

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.uploadImageMaxSize = {
  width: 400,
  height: 400
};

fabric.util.uploadImageMinSize = {
  width: 100,
  height: 100
};
//
// fabric.util.onImageUpload = function(img,callback,options){
//
//   if(!options.multiple){
//     if (options.apiAfterUpload) {
//       options.apiAfterUpload([this], function (val) {
//         callback(val);
//       },options)
//     } else {
//       callback(this);
//     }
//   }else{
//     callback();
//   }
// };


fabric.util.readImageFile = function (file, callback) {

  var reader = new FileReader();
  reader.onload = function (e) {
    var result = e.target.result;
    var type = result.substr(11, result.indexOf(";") - 11);
    var img = new Image();
    img.type = type;
    img.name = file.name;
    img.onload = function () {
      callback(img, e);
    };
    img.src = result;
  };
  reader.readAsDataURL(file);
};

fabric.util.createUploadInput = function (options, complete, progress) {

  var input = document.createElement("input");
  input.setAttribute("type", "file");
  if (options.multiple) {
    input.setAttribute("multiple", options.multiple);
  }
  input.className = "hidden";

  $(input).change(function () {
    if (input.files && input.files.length) {
      if (input.files.length === 1) {
        if (options.upload) {
          options.upload(input.files[0], complete);
        } else if (options.multiUpload) {
          options.multiUpload(input.files, complete);
        }
      } else {
        if (options.multiUpload) {
          options.multiUpload(input.files, complete);
        } else {
          var _loader = fabric.util.queueLoad(input.files.length, function (loaded) {
            complete(loaded);
          }, function (total, current, image) {
            progress && progress(total, current, image);
          });
          for (var i = 0; i < input.files.length; i++) {
            options.upload(input.files[i], _loader);
          }
        }
      }
    }
  });

  fabric.util.uploadInput = input;
};

//fabric.util.resizeImage(img, callback);
// fabric.util.uploadPreprocessor = function(img, callback) {
//   app.api.upload({
//     image: img
//   }, callback)
// }


fabric.util.uploadImage = function (options, cb, progress) {
  fabric.util.createUploadInput(options, cb, progress);
  $(fabric.util.uploadInput).trigger('click');
};

fabric.util.resizeUploadedImage = function (img, callback) {

  if (img.type === "svg+xml") {
    callback(img);
    return;
  }
  //Here we can put a restriction to upload a minim sized logo
  if (img.width < fabric.util.uploadImageMinSize.width || img.height < fabric.util.uploadImageMinSize.height) {
    alert("Logo is too small. MInimum size is " + fabric.util.uploadImageMinSize.width + "x" + fabric.util.uploadImageMinSize.height);
    callback(false);
    return;
  }

  if (img.width > fabric.util.uploadImageMaxSize.width || img.height > fabric.util.uploadImageMaxSize.height) {

    var size = fabric.util.getProportions(img, fabric.util.uploadImageMaxSize, "fit");

    var filter = new fabric.Image.filters.ResizeDP();

    var canvas = fabric.util.createCanvasElementWithSize(img);
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    filter.applyTo(canvas, size.width, size.height);
    callback(canvas);
  } else {
    callback(img);
  }
};

fabric.util.object.extend(fabric.Canvas.prototype, {
  uploadClass: 'image',
  multipleUpload: false,
  uploadImage: function uploadImage(options) {

    var _api = this.application.uploader || {};

    options = fabric.util.object.extend({
      upload: _api.upload,
      afterUpload: _api.callback,
      validation: _api.validation,
      data: false,
      multiple: _api.multiple,
      multiUpload: _api.multipleUpload
    }, options);

    options.afterUpload = options.afterUpload && options.afterUpload.bind(this.application, this, options.data) || function (canvas, data, image, event) {
      // this.application.fire("image:upload",{image: img, canvas: this});
      // _api.afterUpload && _api.afterUpload({image: img, canvas: this,event:});
      this.createImageObject(image);
    }.bind(this);

    options.upload = options.upload && options.upload.bind(this.application) || function (file, callback) {
      if (options.validation && options.validation.call(this, file, options.data) === false) {
        return callback();
      }
      fabric.util.readImageFile(file, function (img, event) {
        options.afterUpload(img, event);
        callback();
      });
    }.bind(this.application);

    fabric.util.uploadImage({
      multiple: _api.multiple,
      apiAfterUpload: options.afterUpload,
      multiUpload: options.multiUpload && options.multiUpload.bind(this.application),
      upload: options.upload
    }, function () {});
  },
  createImageObject: function createImageObject(img) {
    var _this = this;

    if (!img) return;

    this.createObject({
      position: "center",
      active: true,
      type: this.uploadClass,
      image: img,
      width: img.width,
      height: img.height,
      clipTo: this.activeArea,
      movementLimits: this.activeArea
    }, function (el) {
      return _this.fitObject(el);
    });
  },
  actions: fabric.util.object.extend(fabric.Canvas.prototype.actions, {
    uploadImage: {
      className: 'fa fa-upload',
      key: 'u',
      title: 'upload image',
      action: function action() {
        this.uploadImage({ data: "default" });
        // this.application.api.upload,
        // this.application.api.afterUpload,
        // this.application.api.uploadValidation)
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Editor.prototype, {
  setInstagram: function setInstagram(data) {
    this.instagram = data;
    this.instagram.api = new InstagramApi(this.instagram.clientID, this.instagram.redirectURI);
  },
  instagramAuth: function instagramAuth(cb) {
    var _this = this;

    if (this.instagram.accessToken) {
      return cb.call(this);
    }

    var authUrl = this.instagram.api.getAuthUrl();
    //the pop-up window size, change if you want
    var popupWidth = 700,
        popupHeight = 500,
        popupLeft = (window.screen.width - popupWidth) / 2,
        popupTop = (window.screen.height - popupHeight) / 2;

    //the url needs to point to instagram_auth.php
    var popup = window.open(authUrl, '', 'width=' + popupWidth + ',height=' + popupHeight + ',left=' + popupLeft + ',top=' + popupTop + '');

    popup.onload = function () {
      //an interval runs to get the access token from the pop-up
      var interval = setInterval(function () {
        try {
          //check if hash exists
          if (popup.location.hash.length) {
            //hash found, that includes the access token
            clearInterval(interval);
            _this.instagram.accessToken = popup.location.hash.slice(14); //slice #access_token= from string
            popup.close();
            cb(_this.instagram.accessToken);
          }
        } catch (evt) {
          //permission denied
        }
      }, 100);
    };
  },
  getInstagramMedia: function getInstagramMedia(callback) {
    var _this2 = this;

    this.instagramAuth(function () {
      _this2.instagram.api.user.media('self', _this2.instagram.accessToken, function (data) {
        callback(data.data);
        // var images = _.pluck(data.data,"images");
        // var thumbnails = _.pluck(images,"thumbnail");
        // var thumbnails_urls = _.pluck(thumbnails,"url");
        //
        // console.log(thumbnails_urls);
      });
    });
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  actions: fabric.util.object.extend(fabric.Canvas.prototype.actions, {
    instagram: {
      className: "fa fa-instagram",
      type: 'effect',
      title: "instagram",
      effectClassName: "instagram-container",
      actionParameters: function actionParameters($el, data) {
        var _this3 = this;

        this.application.getInstagramMedia(function (data) {

          _this3.application.createGallery($el, fabric.util.object.map(data, function (el) {
            return {
              type: "image",
              src: el.images.thumbnail.url,
              title: el.caption && el.caption.text
            };
          }));
        });
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Editor.prototype, {
  setFacebook: function setFacebook(data) {
    this.facebook = data;

    (function (d, s, id) {
      var js,
          fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {
        return;
      }
      js = d.createElement(s);js.id = id;
      js.src = "https://connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    })(document, 'script', 'facebook-jssdk');
  },
  facebookAuth: function facebookAuth(cb) {

    FB.init({
      appId: this.facebook.appId,
      cookie: true, // enable cookies to allow the server to access the session
      xfbml: true, // parse social plugins on this page
      version: 'v2.9' // use graph api version 2.8
    });
    FB.AppEvents.logPageView();

    FB.getLoginStatus(function (response) {

      /**
       * {
      status: 'connected',
      authResponse: {
        accessToken: '...',
        expiresIn:'...',
        signedRequest:'...',
        userID:'...'
      }
      }
       */
      console.log(response);
      // statusChangeCallback(response);
    });
    //
    // if(this.facebook.accessToken){
    //   return cb.call(this)
    // }
  },
  getFacebookMedia: function getFacebookMedia(callback) {
    var _this = this;

    this.facebookAuth(function () {
      _this.facebook.api.user.media('self', _this.facebook.accessToken, function (data) {
        callback(data.data);
      });
    });
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  actions: fabric.util.object.extend(fabric.Canvas.prototype.actions, {
    facebook: {
      className: "fa fa-facebook",
      type: 'effect',
      title: "facebook",
      effectClassName: "facebook-container",
      actionParameters: function actionParameters($el, data) {
        var _this2 = this;

        this.application.getFacebookMedia(function (data) {

          _this2.application.createElementsList($el, fabric.util.object.map(data, function (el) {
            return {
              type: "image",
              src: el.images.thumbnail.url,
              title: el.caption && el.caption.text
            };
          }));
        });
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(44);

fabric.util.object.extend(fabric.Canvas.prototype, {
  setDroppable: function setDroppable(val) {
    if (!this.droppable && val) {
      this.droppable = true;
      this.initDragAndDrop();
    }
  },
  accepts: {},
  droppable: false, //{}
  isAccepts: function isAccepts(accepts, data) {

    for (var i in accepts) {
      if (accepts[i].constructor == Array) {
        if (accepts[i].indexOf(data[i]) == -1) return false;
      } else {
        if (accepts[i] == "*") continue;
        if (accepts[i] != data[i]) return false;
      }
    }
    return true;
    //return (this.supportedTypes == "*" || this.supportedTypes.indexOf(type)!= -1)
  },
  drop: function drop(data) {
    this.setData(data);
  },
  initDragAndDrop: function initDragAndDrop() {
    this.on("mouse:drop", function (e) {
      var _x = e.x - e.offsetX,
          _y = e.y - e.offsetY,
          _w = e.width,
          // (e.data.width || e.width  );
      _h = e.height; //(e.data.height || e.height );

      if (e.data.scaleX) {
        var _scaleX = e.data.scaleX / this.viewportTransform[0];
      } else {
        _scaleX = 1;
        _w /= this.viewportTransform[0];
      }

      if (e.data.scaleY) {
        var _scaleY = e.data.scaleY / this.viewportTransform[3];
      } else {
        _scaleY = 1;
        _h /= this.viewportTransform[3];
      }

      var _stroke = e.data.strokeWidth || 0;
      if (e.data.left) {
        _x += (e.data.left + _stroke) / this.viewportTransform[0];
      }
      if (e.data.top) {
        _y += (e.data.top + _stroke) / this.viewportTransform[3];
      }

      e.data = fabric.util.object.extend({}, e.data, {
        scaleX: _scaleX,
        scaleY: _scaleY,
        left: _x,
        top: _y,
        width: _w,
        height: _h,
        originalWidth: e.data.width,
        originalHeight: e.data.height
      });

      this.fire("before:drop", e);

      e.target = this.findTarget(e.originalEvent);
      if (e.target && !this.isDrawingMode) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        e.target.fire('object:drop', e);
      }

      if (e.target && e.target.accepts) {
        if (this.isAccepts(e.target.accepts, e.data)) {
          e.target.deactivate();
          e.target.setData(e.data);
        }
      } else {
        if (this.isAccepts(this.accepts, e.data)) {
          this.setData(e.data);
        }
      }
    });
    this.on("mouse:dragenter", function (e) {
      if (e.target && e.target.accepts) {
        if (this.isAccepts(e.target.accepts, e.data)) {
          e.target.activate();
          e.e.helper.css("cursor", "alias");
          this.setCursor("alias");
        } else {
          e.e.helper.css("cursor", "not-allowed");
          this.setCursor("not-allowed");
        }
      }
    });
    this.on("mouse:dragleave", function (e) {
      if (e.target && e.target.accepts) {
        if (this.isAccepts(e.target.accepts, e.data)) {
          this._activated = false;
          e.target.deactivate();
        }
        e.e.helper.css("cursor", "pointer");
      }
    });
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _bindEvents2 = fabric.Canvas.prototype._bindEvents;
var _onMouseDown_overwritten = fabric.Canvas.prototype._onMouseDown;
var _onMouseUp_overwritten = fabric.Canvas.prototype._onMouseUp;
var _initEventListeners_overwritten = fabric.Canvas.prototype._initEventListeners;
var removeListeners_overwritten = fabric.Canvas.prototype.removeListeners;

fabric.util.object.extend(fabric.Canvas.prototype, {
  tapholdThreshold: 2000,
  _bindEvents: function _bindEvents() {
    _bindEvents2.call(this);
    this._onClick = this._onClick.bind(this);
    this._onDoubleClick = this._onDoubleClick.bind(this);
    this._onTapHold = this._onTapHold.bind(this);
  },

  _onDoubleClick: function _onDoubleClick(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:dblclick', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('dblclick', {
        e: e
      });
    }
  },

  _onDrop: function _onDrop(e) {
    var _zoom = this.getZoom();
    e.x /= _zoom;
    e.y /= _zoom;
    e.offsetX /= _zoom;
    e.offsetY /= _zoom;
    e.width = e.helper.width() / _zoom;
    e.height = e.helper.height() / _zoom;
    var self = this;

    this.fire('mouse:drop', e);
  },

  _onDragMove: function _onDragMove(e) {
    var self = this;

    var target = self.findTarget(e.originalEvent);
    self.fire('mouse:dragmove', {
      target: target,
      e: e,
      data: e.data
    });
    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('object:dragmove', {
        e: e,
        data: e.data
      });
    }
    if (this._last_target == target) return;
    if (this._last_target) {
      self.fire('mouse:dragleave', {
        target: this._last_target,
        e: e,
        data: e.data
      });
      this._last_target.fire('object:dragleave', {
        e: e,
        data: e.data
      });
      this._last_target = false;
    }
    if (target) {

      self.fire('mouse:dragenter', {
        target: target,
        e: e,
        data: e.data
      });
      target.fire('object:dragenter', {
        e: e,
        data: e.data
      });

      this._last_target = target;
    }
  },

  _onClick: function _onClick(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:click', {
      target: target,
      e: e
    });

    var e1 = this._mouseDownCoordinatesEvent;
    delete this._mouseDownCoordinatesEvent;

    if (target && !self.isDrawingMode) {
      //fabric2.1.0 || fabric 1.6.4
      // var states = target._stateProperties || target.originalState;

      if (e1 && e1.x === e.x && e1.y === e.y) {
        // // target._stateProperties.angle == target.angle
        // states.left == target.left &&
        // states.top == target.top &&
        // states.scaleX == target.scaleX &&
        // states.scaleY == target.scaleY &&
        // states.angle == target.angle
        // ) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        target.fire('object:click', {
          e: e
        });
      }
    }
  },

  _onTapHold: function _onTapHold(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:taphold', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's tap hold event does not fire on drawing mode.
      target.fire('taphold', {
        e: e
      });
    }

    if (e.type === 'touchend' && self.touchStartTimer != null) {
      clearTimeout(self.touchStartTimer);
    }
  },

  _onMouseDown: function _onMouseDown(e) {
    _onMouseDown_overwritten.call(this, e);

    this._mouseDownCoordinatesEvent = e;

    var self = this;
    if (e.type === 'touchstart') {
      var touchStartTimer = setTimeout(function () {
        self._onTapHold(e);
        self.isLongTap = true;
      }, self.tapholdThreshold);
      self.touchStartTimer = touchStartTimer;
      return;
    }

    // Add right click support
    if (e.which === 3) {
      var target = this.findTarget(e);
      self.fire('mouse:down', { target: target, e: e });
      if (target && !self.isDrawingMode) {
        // To unify the behavior, the object's mouse down event does not fire on drawing mode.
        target.fire('mousedown', {
          e: e
        });
      }
    }
  },

  _onMouseUp: function _onMouseUp(e) {

    _onMouseUp_overwritten.call(this, e);

    if (e.type === 'touchend') {
      // Process tap hold.
      if (this.touchStartTimer != null) {
        clearTimeout(this.touchStartTimer);
      }
      // Process long tap.
      if (this.isLongTap) {
        this._onLongTapEnd(e);
        this.isLongTap = false;
      }
      // Process double click
      var now = new Date().getTime();
      var lastTouch = this.lastTouch || now + 1;
      var delta = now - lastTouch;
      if (delta < 300 && delta > 0) {
        // After we detct a doubletap, start over
        this.lastTouch = null;

        this._onDoubleTap(e);
      } else {
        this.lastTouch = now;
      }
    }
  },

  _onDoubleTap: function _onDoubleTap(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:doubletap', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double tap event does not fire on drawing mode.
      target.fire('object:doubletap', {
        e: e
      });
    }
  },

  _onLongTapEnd: function _onLongTapEnd(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:longtapend', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's long tap end event does not fire on drawing mode.
      target.fire('object:longtapend', {
        e: e
      });
    }
  },

  _initEventListeners: function _initEventListeners() {
    var self = this;
    _initEventListeners_overwritten.call(self);

    fabric.util.addListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.addListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);

    self.on('object:scaling', function (e) {
      if (e.target && e.target._scaling_events_enabled) {
        e.target.fire("scaling", e.e);
      }
    });
    self.on('object:selected', function (e) {
      if (e.target) {
        e.target.fire("object:selected", e.e);
      }
    });
    self.on('mouse:over', function (e) {
      if (e.target) {
        e.target.fire("mouse:over", e.e);
      }
    });

    self.on('mouse:out', function (e) {
      if (e.target) {
        e.target.fire("mouse:out", e.e);
      }
    });
  },

  removeListeners: function removeListeners() {
    var self = this;
    removeListeners_overwritten.call(self);

    fabric.util.removeListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.removeListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(6);

/**
 * Cropping do not support skewX and skewY
 */
fabric.util.object.extend(fabric.Image.prototype, {
  stateProperties: fabric.Image.prototype.stateProperties.concat(["crop"]),
  crop: null,
  store_crop: function store_crop() {
    if (!this.crop) return null;
    var DIG = fabric.Object.NUM_FRACTION_DIGITS;
    var _crop = {};

    if (this.crop.left) _crop.left = fabric.util.toFixed(this.crop.left, DIG);
    if (this.crop.top) _crop.top = fabric.util.toFixed(this.crop.top, DIG);
    if (this.crop.scaleX) _crop.scaleX = fabric.util.toFixed(this.crop.scaleX, DIG);
    if (this.crop.scaleY) _crop.scaleY = fabric.util.toFixed(this.crop.scaleY, DIG);
    if (this.crop.angle) _crop.angle = fabric.util.toFixed(this.crop.angle, DIG);
    return _crop;
  },
  setCrop: function setCrop(crop) {
    this.crop = crop;
    if (!crop) {
      delete this._draw_transform_element;
      return;
    }
    if (!this._draw_transform_element) {
      this._draw_transform_element = new fabric.Image(this._element, {
        originX: "center",
        originY: "center"
      });
      this._draw_transform_element.group = this;
    }
    this._draw_transform_element.set({
      skewX: crop.skewX || 0,
      skewY: crop.skewY || 0,
      angle: crop.angle || 0,
      left: crop.left * this.width || 0,
      top: crop.top * this.height || 0,
      width: this.width,
      height: this.height,
      scaleX: crop.scaleX || 1,
      scaleY: crop.scaleY || 1
    });
  },
  _render: function _render(ctx, noTransform) {
    var x,
        y,
        imageMargins = this._findMargins(),
        elementToDraw;

    x = noTransform ? this.left : -this.width / 2;
    y = noTransform ? this.top : -this.height / 2;

    if (this.crop || this.meetOrSlice === 'slice') {
      ctx.beginPath();
      ctx.rect(x, y, this.width, this.height);
      ctx.clip();
    }

    if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {
      this._lastScaleX = this.scaleX;
      this._lastScaleY = this.scaleY;
      elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);
    } else {
      elementToDraw = this._element;
    }
    if (this.crop) {
      // this._draw_transform_element.CropTo = this;
      this._draw_transform_element.canvas = this.canvas;
      // var _el = this._draw_transform_element;
      // _el.transform(ctx);
      // _el._render(ctx);
      // imageMargins = this._draw_transform_element._findMargins();
      // x = (noTransform ? this.left : -this.width / 2);
      // y = (noTransform ? this.top : -this.height / 2);
      this._draw_transform_element.render(ctx);
    } else {

      elementToDraw && ctx.drawImage(elementToDraw, x + imageMargins.marginX, y + imageMargins.marginY, imageMargins.width, imageMargins.height);
    }

    this._stroke(ctx);
    this._renderStroke(ctx);
  },
  /**
   * Execute the drawing operation for an object on a specified context
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {Boolean} [noTransform] When true, context is not transformed
   */
  // drawObject: function(ctx, noTransform) {
  //   this._renderBackground(ctx);
  //   this._setStrokeStyles(ctx);
  //   this._setFillStyles(ctx);
  //   if(this.crop){
  //     // this._transform_element.group = this;
  //     this._transform_element.render(ctx);
  //     // delete this._transform_element.group;
  //     // this._transform_element
  //   }else{
  //     this._render(ctx, noTransform);
  //   }
  // },
  /*crop: {
    left: 0,
    top: 0,
    scaleX: 1,
    scaleY: 1
  },*/
  cropPhotoEnd: function cropPhotoEnd() {

    this.canvas.remove(this._transform_element);

    this.canvas.editingObject = null;
    this.application.off("target:changed target:cleared", this._endFoo);

    if (this.canvas._gridObject) {
      this.canvas._gridObject.enabled = true;
    }

    this.set({
      hasControls: true,
      evented: true,
      flipX: this._transform_element.flipX,
      flipY: this._transform_element.flipY
    });
    this._resetOrigin();

    this._cropmode = false;

    this.canvas.setActiveObject(this);
    this.canvas.renderAll();
    this.canvas.stateful = true;

    // if (this.hasStateChanged()) {
    this.canvas.fire('object:modified', { target: this });
    this.fire('modified', {});
    // }


    // this.fire("cropping:exited");
    // this.canvas.fire('frame:cropping:exited', { target: this });
  },
  updateCrop: function updateCrop() {

    var I = this._transform_element,
        F = this,
        to_radians = Math.PI / 180,
        cosA = Math.cos(F.angle * to_radians),
        sinA = Math.sin(F.angle * to_radians),
        left = ((I.left - F.left) * cosA + (I.top - F.top) * sinA /*- F.width/ 2*/) * (I.flipX ? -1 : 1),
        top = (-(I.left - F.left) * sinA + (I.top - F.top) * cosA /*- F.height/ 2*/) * (I.flipY ? -1 : 1);

    F.setCrop({
      skewX: I.skewX,
      skewY: I.skewY,
      left: left / F.width / F.scaleX,
      top: top / F.height / F.scaleY,
      scaleX: I.scaleX / F.scaleX,
      scaleY: I.scaleY / F.scaleY,
      angle: I.angle - F.angle
    });
  },
  toSVG_overwritten: fabric.Image.prototype.toSVG,
  getShape: function getShape() {
    var path = "M 0 0 L " + this.width + " 0 L " + this.width + " " + this.height + " L 0 " + this.height + " z";
    var element = new fabric.Path(path, {});
    element.group = this;
    element.canvas = this.canvas;
    fabric.Group.prototype.realizeTransform.call(this, element);
    delete element.group;
    element.set({
      originX: "center",
      originY: "center"
    });
    return element;
  },
  toSVG: function toSVG(reviver) {
    if (this.crop) {

      var clipId = "Clipped" + fabric.Object.__uid++;

      return "\n        <clipPath id=\"" + clipId + "\">\n          " + this.getShape().toSVG(reviver) + "\n        </clipPath>\n        <g clip-path=\"url(#" + clipId + ")\">\n          " + this._createTransformedElement().toSVG_overwritten(reviver) + "\n        </g>";
    } else {
      return this.toSVG_overwritten(reviver);
    }
  },
  _createTransformedElement: function _createTransformedElement() {

    var el;
    if (this._draw_transform_element) {
      this._draw_transform_element.group = this;
      this.setCrop(this.crop);
      fabric.Group.prototype.realizeTransform.call(this, this._draw_transform_element);

      el = new fabric.Image(this._element, {
        angle: this._draw_transform_element.angle,
        left: this._draw_transform_element.left,
        top: this._draw_transform_element.top,
        width: this._draw_transform_element.width,
        height: this._draw_transform_element.height,
        scaleX: this._draw_transform_element.scaleX,
        scaleY: this._draw_transform_element.scaleY,
        skewX: this._draw_transform_element.skewX,
        skewY: this._draw_transform_element.skewY
      });
      this.setCrop(this.crop);
    } else {
      el = new fabric.Image(this._element, {
        angle: this.angle,
        left: this.left,
        top: this.top,
        width: this.width,
        height: this.height,
        scaleX: this.scaleX,
        scaleY: this.scaleY
      });
    }
    el.set({
      originX: "center",
      originY: "center",
      movementLimits: this,
      clipTo: this,
      movementLimitMode: "content",
      hasControls: true,
      selectable: true,
      perPixelTargetFind: false
    });
    el.canvas = this.canvas;

    el.application = this.application;
    return el;
  },
  cropPhotoStart: function cropPhotoStart() {
    var _this2 = this;

    this._cropmode = true;

    this.canvas.stateful && this.saveState();
    this.canvas.stateful = false;

    this.canvas.discardActiveGroup();
    if (this.canvas._gridObject) {
      this.canvas._gridObject.enabled = false;
    }

    this.set({
      width: this.width * this.scaleX,
      height: this.height * this.scaleY,
      scaleY: 1,
      scaleX: 1
    });
    this._setOriginToCenter();

    this._transform_element = this._createTransformedElement();
    this._transform_element.parent = this;

    this._transform_element.on("rotating", this._transform_element.stepRotating);

    this._transform_element.set({
      tools: ["cropZoomIn", "cropZoomOut", "cropEnd"],
      actions: {
        cropZoomIn: {
          className: "fa fa-search-plus ",
          title: "zoom in",
          action: function action() {
            this.parent.cropZoomIn();
          }
        },
        cropZoomOut: {
          className: "fa fa fa-search-minus",
          title: "zoom out",
          action: function action() {
            this.parent.cropZoomOut();
          }
        },
        cropEnd: {
          className: "fa fa-crop",
          title: "crop end",
          action: function action() {
            this.parent.cropPhotoEnd();
          }
        }
      },
      opacity: 0.5,
      eventListeners: {
        "rotating moving scaling skewing": function rotatingMovingScalingSkewing() {
          this.parent.updateCrop();
        }
      }
    });

    this.canvas.add(this._transform_element);

    this.canvas.on("mouse:wheel", function (e) {
      if (e.target === _this2._transform_element) {
        if (e.e.deltaY < 0) {
          _this2.cropZoomIn();
        } else {
          _this2.cropZoomOut();
        }
        e.e.stopPropagation();
        e.e.preventDefault();
      }
    });

    //рамку двигать нельзя
    this.set({
      hasControls: false,
      evented: false
    });

    this.canvas.setActiveObject(this._transform_element);
    this.active = true;

    var _this = this;
    this._endFoo = function () {
      _this.cropPhotoEnd();
    };
    this.application.on("target:changed target:cleared", this._endFoo);

    this.fire("cropping:entered");
    this.canvas.fire('frame:cropping:entered', { target: this });

    this.canvas.editingObject = this;
    this.canvas.renderAll();
  },
  cropZoomOut: function cropZoomOut() {
    this._transform_element.set({
      scaleX: Math.max(this._transform_element.scaleX - 0.1, 0.1),
      scaleY: Math.max(this._transform_element.scaleY - 0.1, 0.1)
    });
    this.updateCrop();
    this.canvas.renderAll();
  },
  cropZoomIn: function cropZoomIn() {
    this._transform_element.set({
      scaleX: Math.max(this._transform_element.scaleX + 0.1, 0.1),
      scaleY: Math.max(this._transform_element.scaleY + 0.1, 0.1)
    });
    this.updateCrop();
    this.canvas.renderAll();
  },
  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    crop: {
      title: "crop",
      className: "fa fa-crop",
      action: "cropPhotoStart",
      // visible:    "croppingAvailable",
      observe: "cropping:entered cropping:exited element:modified"
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.Editor.prototype.configurationProperties.push("frames");
fabric.util.object.extend(fabric.Editor.prototype, {
  setFrames: function setFrames(val) {
    this.frames = fabric.util.object.extend(val.map(function (item) {
      return fabric.util.object.defaults(item, {
        frame: false,
        shape: false,
        type: "photo",
        role: "frame"
      });
    }));
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.createThumb = function (slide, $canvasEl) {

  var _canvas = slide,
      firstDraw = true,
      modified,
      _w = +$canvasEl.getAttribute("width"),
      _h = +$canvasEl.getAttribute("height");

  if (_h) {
    $canvasEl.style.height = $canvasEl.height;
  }

  function renderThumb() {
    if (_canvas.processing || !_canvas.loaded) {
      return false;
    }
    _canvas.renderThumb($canvasEl);
    modified = _canvas.modified;
  }

  function forceRenderThumb() {
    if (this.loaded) {
      this.renderThumb($canvasEl);
    } else if (this.thumb) {
      var img = new Image();
      img.onload = function () {
        var ctx = $canvasEl.getContext("2d");
        ctx.clearRect(0, 0, $canvasEl.width, $canvasEl.height);
        ctx.drawImage(img, 0, 0, $canvasEl.width, $canvasEl.height);
        modified = this.modified;
      };
      img.src = this.thumb;
    }
    // //if (attrs.force !== "true") return;
    // var canvas = new fabric.Canvas(null, this.data, function () {
    //   canvas.renderThumb($canvasEl);
    //   //modified = slide.modified;
    // });
  }

  function scaleThumb() {

    var _fitSize = fabric.util.getProportions({
      width: slide.originalWidth || slide.width,
      height: slide.originalHeight || slide.height
    }, {
      width: _w,
      height: _h
    }, "fit");

    $canvasEl.width = _fitSize.width;
    $canvasEl.height = _fitSize.height;

    $canvasEl.style.width = _fitSize.width + 'px';
    $canvasEl.style.height = _fitSize.height + 'px';
    renderThumb();
  }

  slide.on({
    'after:render': renderThumb,
    'dimensions:modified': scaleThumb,
    'loading:end': scaleThumb,
    'modified': forceRenderThumb
  });

  $canvasEl.setAttribute("title", slide.title);

  scaleThumb.call(slide);
  forceRenderThumb.call(slide);
};

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  renderThumb: function renderThumb(canvas, options) {
    options = options || {
      objects: true,
      clipped_area_only: false,
      draw_background: true
    };

    if (options.zoom) {
      var _zoom = options.zoom;
    } else {
      if (canvas.width) {
        var _zoom = canvas.width / (this.originalWidth || this.width);
      } else {
        var _zoom = 1;
      }
    }
    var _old_Scale = this.viewportTransform[0];
    var old_x = this.viewportTransform[4];
    var old_y = this.viewportTransform[5];
    this.viewportTransform[4] = this.viewportTransform[5] = 0;
    this.viewportTransform[0] = this.viewportTransform[3] = 1;

    this.viewportTransform[0] = this.viewportTransform[3] = _zoom;
    //this._update_clip_rect();

    if (this.clipRect) {
      this.clipRect.setOpacity(0);
    }

    var size = {
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    size.width = Math.ceil(size.width * _zoom);
    size.height = Math.ceil(size.height * _zoom);

    var _canvas = fabric.util.createCanvasElement();
    _canvas.width = size.width;
    _canvas.height = size.height;

    var canvasToDrawOn = _canvas.getContext('2d'),
        objsToRender;

    this.clearContext(canvasToDrawOn);
    canvasToDrawOn.save();
    canvasToDrawOn.transform.apply(canvasToDrawOn, this.viewportTransform);

    if (options.draw_background) {
      this._renderBackground(canvasToDrawOn);
      //if (this._backgroundLayer) {
      //  this._renderObjects(canvasToDrawOn, this._backgroundLayer);
      //}
    }

    if (!options.clipped_area_only && this.clipTo) {
      fabric.util.clipContext(this, canvasToDrawOn);
    }

    var _objects;
    if (options.objects && options.objects.constructor === Array) {
      _objects = options.objects;
    } else {
      _objects = options.objects !== false ? this._objects : [];
    }
    if (options.clipped_area) {
      _objects = fabric.util.object.clone(_objects);
      for (var i = _objects.length; i--;) {
        if (_objects[i].clipTo !== options.clipped_area) {
          _objects.splice(i, 1);
        }
      }
    }
    // if (fabric.version >= 1.6) {
    this._renderObjects(canvasToDrawOn, _objects);
    // } else {
    //   for (var i = 0, length = _objects.length; i < length; ++i) {
    //     this._draw(canvasToDrawOn, _objects[i]);
    //   }
    // }


    canvasToDrawOn.restore();
    if (!options.clipped_area_only && this.clipTo) {
      canvasToDrawOn.restore();
    }
    this._renderOverlay(canvasToDrawOn);
    canvasToDrawOn.restore();
    if (this.clipRect) {
      this.clipRect.setOpacity(1);
    }
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (options.clipped_area_only && this.clipRect) {
      var _rect = {
        left: this.clipRect.left * _zoom,
        top: this.clipRect.top * _zoom,
        width: this.clipRect.width * _zoom,
        height: this.clipRect.height * _zoom
      };
    } else {
      var _rect = {
        left: options.left * _zoom || 0,
        top: options.top * _zoom || 0,
        width: options.width * _zoom || size.width,
        height: options.height * _zoom || size.height
      };
    }
    if (options.angle) {
      ctx.rotate(-options.angle * Math.PI / 180);
      ctx.drawImage(_canvas, 0, 0, _rect.width + _rect.left + _canvas.width, _rect.height + _rect.top + _canvas.height, -_rect.left, -_rect.top, canvas.width + _rect.left + _canvas.width, canvas.height + _rect.top + _canvas.height);
    } else {
      ctx.drawImage(_canvas, _rect.left, _rect.top, _rect.width, _rect.height, 0, 0, canvas.width, canvas.height);
    }

    this.viewportTransform[0] = this.viewportTransform[3] = _old_Scale;
    // this._update_background_image();
    //this._update_clip_rect();

    this.viewportTransform[4] = old_x;
    this.viewportTransform[5] = old_y;

    return canvas;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(49);
__webpack_require__(50);

// todo это убрать
//fabric.movementsLimitsEasy = false;
var _scaleObject_overwritten = fabric.Canvas.prototype._scaleObject;

fabric.util.object.extend(fabric.Object.prototype, {
  store_movementLimits: function store_movementLimits() {
    return this.movementLimits ? this.movementLimits.id ? '#' + this.movementLimits.id : this.movementLimits : null;
  },
  setWholeCoordinates: function setWholeCoordinates(val) {
    this.wholeCoordinates = val;
    this.on("added modified", function () {
      if (this.wholeCoordinates) {
        this.set({
          left: Math.round(this.left),
          top: Math.round(this.top),
          width: Math.round(this.width),
          height: Math.round(this.height)
        });
      }
    }, true);
  },
  // setTop: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.top = val;
  // },
  // setLeft: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.left = val;
  // },
  // setWidth: function(w){
  //   if(this.wholeCoordinates){
  //     w = Math.round(w);
  //   }
  //   this.width = w;
  // },
  // setHeight: function(h){
  //   if(this.wholeCoordinates){
  //     h = Math.round(h);
  //   }
  //   this.height = h;
  // },
  // specialProperties: fabric.Object.prototype.specialProperties.concat(["movementLimits"]),

  setActive: function setActive(value) {
    if (!this.canvas) {
      this.on("added", function () {
        if (this.canvas.interactive) {
          this.canvas.setActiveObject(this);
        }
      });
    }

    this.active = value;
  },
  setPosition: function setPosition(_position) {
    if (_position === "center") {
      this.on("added", function setPosition() {
        this.center();
        this.setCoords();
        // this.canvas.fitObject(this);
      }, true);
    }
  },

  setMovementLimits: function setMovementLimits(val) {

    if (!this.movementLimits) {
      this.on({
        added: function added() {
          if (this.canvas.interactive) {
            this.canvas._check_object_position(this);
          }
        },
        rotated: function rotated(event) {
          var target = this;

          if (target.resizable) {
            if (pos.left !== undefined) {
              if (target.left < pos.left) {
                target.width += target.left - pos.left;
                target.left = pos.left;
              } else {
                target.width -= target.left - pos.left;
              }
            }
            if (pos.top !== undefined) {
              if (target.top < pos.top) {
                target.height += target.top - pos.top;
                target.top = pos.top;
              } else {
                target.height -= target.top - pos.top;
              }
            }
          }
          this.canvas._check_object_position(this);
        },
        modified: function modified(event) {
          this.canvas && this.canvas._check_object_after_modified(this);
        }
      });
    }
    this.movementLimits = val;

    /* if(this.canvas){
       this._setMovementLimitsString();
     }*/
  }
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  fitObject: function fitObject(el) {
    var _rect,
        maxSize,
        o = this.offsets;

    if (!el.movementLimits || el.movementLimits == "canvas") {
      var _zoom = this.getZoom();
      var _w = this.originalWidth || this.width / _zoom;
      var _h = this.originalHeight || this.height / _zoom;
      _rect = {
        width: o ? _w - o.left - o.right : _w,
        height: o ? _h - o.top - o.bottom : _h
      };
      /* offsets = {
       left: o && o.top ||0 ,
       top:  o &&  o.left ||0
       }*/
    } else if (el.movementLimits.constructor !== Function) {
      var lim = el.movementLimits;
      _rect = {
        left: lim.left * lim.scaleX,
        width: lim.width * lim.scaleX,
        top: lim.top * lim.scaleY,
        height: lim.height * lim.scaleY
      };
      //maxSize = _rect;
      // offsets = lim;
    }
    maxSize = {
      width: _rect.width * this.fitIndex,
      height: _rect.height * this.fitIndex
    };
    var size = fabric.util.getProportions(el, maxSize, 'fit');

    if (el.resizable) {
      el.setOptions({
        width: el.width * size.scale,
        height: el.height * size.scale
      });
      el.updateElement();
    } else {
      el.setOptions({
        scaleX: size.scale,
        scaleY: size.scale
      });
    }
    this.centerObject(el);
    el.setCoords();
    this.fire("scaling");
  },
  //fix getcenter function
  centerObject: function centerObject(object) {
    var center;
    if (object.movementLimits) {

      center = this._getMovementsLimitsCenter(object.movementLimits);
    } else {
      center = this.getCenter();
    }
    this._centerObject(object, new fabric.Point(center.left, center.top));
    this.renderAll();
    return this;
  },
  getCenter: function getCenter() {
    return {
      top: this.originalHeight || this.height / 2 / this.getZoom(),
      left: this.originalWidth || this.width / 2 / this.getZoom()
    };
  },
  movementLimits: {
    left: false,
    top: false,
    right: false,
    bottom: false
  },
  setMovementLimits: function setMovementLimits(_offsets) {
    this.movementLimits = _offsets;

    return this;
  },
  //content хотя бы  пиксель объекта должен быть внутри зоны
  //fit зона должно полностью находится внутри объекта
  movementLimitMode: "fit",
  _getMovementsLimitsCenter: function _getMovementsLimitsCenter(movementLimits) {

    if (movementLimits === 'canvas') {
      var o = this.offsets;
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      return { top: o.top + (_h - o.top - o.bottom) / 2, left: o.left + (_w - o.left - o.right) / 2 };
    }

    if (typeof movementLimits == "string") {
      var obj = this.getObjectByID(movementLimits.substr(1));
    } else {
      obj = movementLimits;
    }

    var _xy = obj.getCenterPoint();
    return { top: _xy.y, left: _xy.x };
  },
  _getMovementsLimitsRect: function _getMovementsLimitsRect(movementLimits) {

    var o = this.offsets;
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (movementLimits.constructor == Object) {
      return movementLimits;
    }

    var scale = this.viewportTransform[0];

    if (movementLimits === 'canvas') {

      var rect = {
        left: o.left,
        top: o.top,
        width: _w - o.left - o.right,
        height: _h - o.top - o.bottom,
        right: o.right,
        bottom: o.bottom
      };

      rect.width *= scale;
      rect.height *= scale;
      return rect;
    }

    if (movementLimits.constructor == String) {
      var obj = this.getObjectByID(movementLimits.substr(1));
      if (!obj) {
        return false;
      }
    } else {
      obj = movementLimits;
    }

    var _stroke_width = obj.strokeWidth;
    obj.strokeWidth = 0;

    obj.setCoords();
    var rect = obj.getBoundingRect();

    obj.strokeWidth = _stroke_width;

    rect.left /= scale;
    rect.top /= scale;
    rect.width /= scale;
    rect.height /= scale;
    rect.left -= this.viewportTransform[4] / scale;
    rect.top -= this.viewportTransform[5] / scale;

    //rect.left   += sw /2;
    //rect.top    += sw /2;
    //rect.width  -= sw;
    //rect.height -= sw;

    rect.right = _w - (rect.left + rect.width);
    rect.bottom = _h - (rect.top + rect.height);

    return rect;
  },
  contentOffsets: 5,

  getFixedPosition: function getFixedPosition(target, x, y) {

    var _translatedX = 0,
        _translatedY = 0,
        _w = this.originalWidth || this.width,
        _h = this.originalHeight || this.height,
        scale = this.viewportTransform[0];

    if (this._currentTransform) {
      _translatedX = x - this._currentTransform.lastX;
      _translatedY = y - this._currentTransform.lastY;
    }

    // console.log(_translatedX,_translatedY);

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    // target.setCoords();
    // var bounds = target.getBoundingRect();

    var brect = this._currentTransform && this._currentTransform._bounding_rect || target.getBoundingRect();
    var bounds = {
      left: (brect.left + _translatedX - this.viewportTransform[4]) / scale,
      top: (brect.top + _translatedY - this.viewportTransform[5]) / scale,
      width: brect.width / scale,
      height: brect.height / scale
    };

    // bounds.left -= this.viewportTransform[4] / scale;
    // bounds.top -= this.viewportTransform[5] / scale;
    bounds.right = _w - (bounds.left + bounds.width);
    bounds.bottom = _h - (bounds.top + bounds.height);

    var limits = this._currentTransform && this._currentTransform.movementLimits;
    if (!limits) {
      return {};
    }
    // var limits = rect || this.movementLimits;

    var newPos = {},
        _l = limits.left,
        _r = limits.right,
        _t = limits.top,
        _b = limits.bottom;

    if (target.movementLimitMode === "content") {
      _l -= bounds.width - this.contentOffsets;
      _r -= bounds.width - this.contentOffsets;
      _t -= bounds.height - this.contentOffsets;
      _b -= bounds.height - this.contentOffsets;
    }

    if (target.movementLimitMode === "fit" && !target.resizable) {
      if (_l !== false && _r !== false) {
        _w = _w - _l - _r;
        if (bounds.width > _w) {
          var _asp = _w / bounds.width;
          newPos.scaleX = _asp;
          newPos.scaleY = _asp;
        }
      }

      if (_t !== false && _b !== false) {
        _h = _h - _t - _b;
        if (bounds.height > _h) {
          var _asp = _h / bounds.height;
          target.scaleX *= _asp;
          target.scaleY *= _asp;
        }
      }
    }

    if (target.movementLimitMode === "fit" || target.movementLimitMode === "content") {

      if (_l !== false) {
        var _diff = _l - bounds.left;
        if (_diff > 0) {
          newPos.left = x + _diff;
        }
      }

      if (!newPos.left && _r !== false) {
        var _diff = _r - bounds.right;
        if (_diff > 0) {
          newPos.left = x - _diff;
        }
      }

      if (_t !== false) {
        var _diff = _t - bounds.top;
        if (_diff > 0) {
          newPos.top = y + _diff;
        }
      }

      if (!newPos.top && _b !== false) {
        var _diff = _b - bounds.bottom;
        if (_diff > 0) {
          newPos.top = y - _diff;
        }
      }
    }

    return newPos;
  },

  // _restoreOriginXYNative: _restoreOriginXYNative,
  // _restoreOriginXY: function (target) {
  //   this._restoreOriginXYNative(target);
  //
  //   // if (target.wholeCoordinates) {
  //   //   target.left = Math.round(target.left);
  //   //   target.top = Math.round(target.top);
  //   // }
  // },

  /**
   * Sets the position of the object taking into consideration the object's origin
   * @param {fabric.Point} pos The new position of the object
   * @param {String} originX Horizontal origin: 'left', 'center' or 'right'
   * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
   * @return {void}
   */
  setPositionByOrigin: function setPositionByOrigin(pos, originX, originY) {
    var center = this.translateToCenterPoint(pos, originX, originY),
        position = this.translateToOriginPoint(center, this.originX, this.originY);

    // if (this.wholeCoordinates) {
    //   position.x = Math.round(position.x);
    //   position.y = Math.round(position.y);
    // }
    this.set('left', position.x);
    this.set('top', position.y);
  }
});

var _translateObject_overwritten = fabric.Canvas.prototype._translateObject;
var _beforeScaleTransform_overwritten = fabric.Canvas.prototype._beforeScaleTransform;
var _beforeTransform_overwritten = fabric.Canvas.prototype._beforeTransform;
var _restoreOriginXYNative = fabric.Canvas.prototype._restoreOriginXY;
var _setupCurrentTransformNative = fabric.Canvas.prototype._setupCurrentTransform;
fabric.util.object.extend(fabric.Canvas.prototype, {
  _beforeScaleTransform_overwritten: _beforeScaleTransform_overwritten,
  _setupCurrentTransform_overwritten: fabric.Canvas.prototype._setupCurrentTransform,
  _beforeScaleTransform: function _beforeScaleTransform(e, transform) {
    this._beforeScaleTransform_overwritten(e, transform);
    if (!this._currentTransform.original.oCoords) {
      this._currentTransform.original.oCoords = fabric.util.object.cloneDeep(this._currentTransform.target.oCoords);
    }
  },
  _setupCurrentTransform: function _setupCurrentTransform(e, target) {
    this._setupCurrentTransform_overwritten(e, target);
    this._currentTransform._bounding_rect = target.getBoundingRect();
    this._currentTransform.movementLimits = this._getMovementsLimitsRect(target.movementLimits || this.movementLimits);
  },
  getFixedPositionEasy: function getFixedPositionEasy(target, x, y) {
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    target.right = _w - (target.left + target.width);
    target.bottom = _h - (target.top + target.height);

    var _diff, _asp, rect;
    var newPos = {
      left: x,
      top: y,
      width: target.width,
      height: target.height
    };

    if (target.width > _w) {
      newPos.width = _w;
    }
    if (target.height > _h) {
      newPos.height = _h;
    }
    if (target.left < 0) {
      newPos.width += target.left;
      newPos.left -= target.left;
    }
    if (target.right < 0) {
      newPos.width += target.right;
    }
    if (target.top < 0) {
      newPos.height += target.top;
    }
    if (target.bottom < 0) {
      newPos.height += target.bottom;
    }
    return newPos;
  },
  /**
   * функцию можно вызвать с евентом  'after:render'. Позволяет отображать вычисления пересечений изменяемого объекта с рамкой. выделяет красными лиинияи
   * @private
   * @example
   *  eventListeners : {
    Canvas: {
      'before:render': function(){
        this.clearContext(this.contextTop);
      },
      'after:render': function(){
        this._debug_intersections()
      }
    }
  }
   */
  drawInterestionLines: function drawInterestionLines() {
    var tr = this._currentTransform;
    if (tr && tr._intersections) {
      var ctx = this.contextTop;
      ctx.beginPath();
      ctx.strokeStyle = "red";
      for (var i in tr._intersections) {
        var _coord = tr._intersections[i];
        ctx.moveTo(_coord.x + 5, _coord.y);
        ctx.arc(_coord.x, _coord.y, 5, 0, 2 * Math.PI);
      }
      for (var i in tr.lines) {
        var _l = tr.lines[i];
        ctx.moveTo(_l[0].x, _l[0].y);
        ctx.lineTo(_l[1].x, _l[1].y);
      }
      for (var i in tr.mlLines) {
        var _l = tr.mlLines[i];
        ctx.moveTo(_l[0].x, _l[0].y);
        ctx.lineTo(_l[1].x, _l[1].y);
      }
      ctx.stroke();
    }
  },
  _scaleObjectEasy: function _scaleObjectEasy(x, y, by) {
    //_scaleObject_overwritten.call(this, x, y, by);
    var tr = this._currentTransform,
        target = tr.target,
        corner = tr.corner;
    if (!target.movementLimits) {
      return _scaleObject_overwritten.call(this, x, y, by);
    }

    if (target.movementLimitMode !== 'fit') return;
    x = Math.min(target.movementLimits.width, Math.max(0, x));
    y = Math.min(target.movementLimits.height, Math.max(0, y));
    _scaleObject_overwritten.call(this, x, y, by);
  },
  /**
   * Scales object by invoking its scaleX/scaleY methods
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.
   *                    When not provided, an object is scaled by both dimensions equally
   */
  _scaleObject: function _scaleObject(x, y, by) {
    var _scaled = _scaleObject_overwritten.call(this, x, y, by);

    var tr = this._currentTransform,
        target = tr.target,
        corner = tr.corner;
    var _v = this.viewportTransform;

    if (!target.movementLimits || target.movementLimitMode !== "fit") {
      return _scaled;
    }
    target.setCoords();

    var _scale = this.getZoom();

    if (target.movementLimits == this) {
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      var _l = this.viewportTransform[4];
      var _t = this.viewportTransform[5];
      _w *= _scale;
      _h *= _scale;
      var _rc = {
        tl: { x: _l, y: _t },
        tr: { x: _l + _w, y: _t },
        bl: { x: _l, y: _t + _h },
        br: { x: _l + _w, y: _t + _h }
      };
    } else {
      target.movementLimits.setCoords();
      var _rc = target.movementLimits.oCoords;
    }

    if (!tr.pointerOffset) {
      tr.pointerOffset = {
        x: x * _v[0] - target.oCoords[corner].x,
        y: y * _v[3] - target.oCoords[corner].y
      };

      tr.pointCenter = target.getCenterPoint();
      tr.pointCenter.x *= _scale;
      tr.pointCenter.y *= _scale;
      tr.pointOriginal = tr.original.oCoords[corner];
    }

    tr.pointTranformed = target.oCoords[corner];

    tr.mlLines = [];
    tr.lines = [];
    function _intersection(corner, coordinate) {
      var _oc;
      if (coordinate == "x" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[0]];
      } else if (coordinate == "y" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[1]];
      } else {
        _oc = tr.pointCenter;
        _oc = {
          x: _oc.x + _v[4],
          y: _oc.y + _v[5]
        };
      }
      var _tc = target.oCoords[corner];

      tr.lines.push([_oc, _tc]);
      tr.mlLines.push([_rc.tl, _rc.tr]);
      tr.mlLines.push([_rc.tr, _rc.br]);
      tr.mlLines.push([_rc.br, _rc.bl]);
      tr.mlLines.push([_rc.bl, _rc.tl]);

      var inters = fabric.Intersection.intersectLinePolygon(_oc, _tc, [_rc.tl, _rc.tr, _rc.br, _rc.bl]);
      if (!inters.points.length) {
        return;
      }
      inters.points[0].coordinate = coordinate;
      tr._intersections.push(inters.points[0]);

      //         if (coordinate) {
      //           var p1 = inters.points[0];

      //           var corner2;
      //           if (coordinate == "x") {
      //             corner2 = (corner[0] == "t" ? "b" : "t") + corner[1];
      //           } else {
      //             corner2 = corner[0] + (corner[1] == "l" ? "r" : "l");
      //           }
      //           var _p2 = target.oCoords[corner2];
      //           var _diff = {x: _tc.x - p1.x, y: _tc.y - p1.y};

      //           var p2 = {
      //             x: _p2.x - _diff.x,
      //             y: _p2.y - _diff.y
      //           };

      //           var its = fabric.Intersection.intersectLineLine(tr.pointCenter, tr.pointTranformed, p1, p2);
      //           if (!its.points[0]) {
      //             return;
      //           }
      //           tr._intersections.push(its.points[0]);
      //         } else {
      //           tr._intersections.push(inters.points[0]);
      //         }


      //
      //if(inters.points.length){
      //  _scaleObject_overwritten.call(this, inters.points[0].x,  inters.points[0].y, by);
      //  target.setCoords();
      //}else{
      //  _scaleObject_overwritten.call(this, x, y, by);
      //}
    }

    tr._intersection = null;
    tr._intersections = [];
    switch (corner) {
      case "tl":
        _intersection("tl");
        _intersection("bl", "x");
        _intersection("tr", "y");
        break;
      case "tr":
        _intersection("tr");
        _intersection("tl", "y");
        _intersection("br", "x");
        break;
      case "br":
        _intersection("br");
        _intersection("tr", "x");
        _intersection("bl", "y");
        break;
      case "bl":
        _intersection("bl");
        _intersection("tl", "x");
        _intersection("br", "y");
        break;
      case "mt":
        _intersection("mt");
        _intersection("tl", "y");
        _intersection("tr", "y");
        break;
      case "mb":
        _intersection("mb");
        _intersection("bl", "y");
        _intersection("br", "y");
        break;
      case "mr":
        _intersection("mr");
        _intersection("tr", "x");
        _intersection("br", "x");
        break;
      case "ml":
        _intersection("ml");
        _intersection("tl", "x");
        _intersection("bl", "x");
    }

    if (!tr._intersections.length) {
      return _scaled;
    }

    var _newXY = tr._intersections[0];
    var _l = tr._intersections[0].distanceFrom(tr.pointOriginal);

    for (var i = 1; i < tr._intersections.length; i++) {
      var _l2 = tr._intersections[i].distanceFrom(tr.pointOriginal);
      if (_l2 < _l) {
        _newXY = tr._intersections[i];
        _l = _l2;
      }
    }
    tr._intersection = _newXY;

    if (by == "equally") {
      //by = false;

      var _diff2 = { x: _newXY.x - tr.pointCenter.x, y: _newXY.y - tr.pointCenter.y };
      var _l = Math.sqrt(_diff2.x * _diff2.x + _diff2.y * _diff2.y);

      _newXY.x -= _diff2.x / _l * target.strokeWidth;
      _newXY.y -= _diff2.y / _l * target.strokeWidth;
      // scrt(x*x + y*y) = atrokewidth
      var a = 1;
    }
    //return _scaleObject_overwritten.call(this, x, y, by);
    var __x = (_newXY.x + tr.pointerOffset.x) / _v[0];
    var __y = (_newXY.y + tr.pointerOffset.y) / _v[3];
    return _scaleObject_overwritten.call(this, __x, __y, by);

    //
    //if (corner == "br" || corner == "tr" || corner == "mr") {
    //  if (x < target.movementXMaxLimit) {
    //    x = target.movementXMaxLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "tl" || corner == "ml") {
    //  if (x > target.movementXMinLimit) {
    //    x = target.movementXMinLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "br" || corner == "mb") {
    //  if (y < target.movementYMaxLimit) {
    //    y = target.movementYMaxLimit;
    //  }
    //}
    //if (corner == "tl" || corner == "tr" || corner == "mt") {
    //  if (y > target.movementYMinLimit) {
    //    y = target.movementYMinLimit;
    //  }
    //}
    //
    //_scaleObject_overwritten.call(this, x, y, by);
  },
  movementLimitsOnAddAction: 'translate',
  _check_object_after_modified: function _check_object_after_modified(target) {
    if (!this._currentTransform) {
      return;
    }
    var pos = this.getFixedPosition(target, target.left, target.top);

    switch (this._currentTransform.corner) {
      case "mtr":
        if (pos.left !== undefined) {
          target.set('left', pos.left);
        }
        if (pos.top) {
          target.set('top', pos.top);
        }
        break;
      case "mr":
      case "br":
        if (pos.left !== undefined) {
          var _ldiff = target.left - pos.left;
        }
        if (pos.top !== undefined) {
          var _tdiff = target.top - pos.top;
        }

        if (_ldiff && (!_tdiff || Math.abs(_ldiff) > Math.abs(_tdiff))) {
          if (_ldiff < 0) {
            target.width += _ldiff;
          } else {
            target.width -= _ldiff;
          }
        } else if (_tdiff) {
          if (_tdiff < 0) {
            target.width += _tdiff;
          } else {
            target.width -= _tdiff;
          }
        }
      //console.log(pos,_ldiff,_tdiff)
    }
    // this._check_object_position(target)
  },
  _check_object_position: function _check_object_position(target) {

    var pos = this.getFixedPosition(target, target.left, target.top);
    if (this.movementLimitsOnAddAction == 'translate') {
      if (pos.left !== undefined) {
        target.set('left', pos.left);
      }
      if (pos.top !== undefined) {
        target.set('top', pos.top);
      }
    } else {

      if (pos.left !== undefined) {
        if (target.left < pos.left) {
          target.width += target.left - pos.left;
          target.left = pos.left;
        } else {
          target.width -= target.left - pos.left;
        }
      }
      if (pos.top !== undefined) {
        if (target.top < pos.top) {
          target.height += target.top - pos.top;
          target.top = pos.top;
        } else {
          target.height -= target.top - pos.top;
        }
      }
    }

    if (pos.scaleX) {
      target.scaleX = target.scaleX *= pos.scaleX;
    }
    if (pos.scaleY) {
      target.scaleY = target.scaleY *= pos.scaleY;
    }

    target.setCoords();

    this.renderAll();
    // if(target.wholeCoordinates){
    //   target.top = Math.round(target.top);
    //   target.left = Math.round(target.left);
    //   target.height = Math.round(target.height);
    //   target.width = Math.round(target.width);
    // }
  },
  _translateObject: function _translateObject(x, y, limits) {
    var target = this._currentTransform.target;
    if (target.beforeTranslate) {
      var _point = target.beforeTranslate(x, y);
      if (!_point) return false;
      x = _point.x;
      y = _point.y;
    }
    var _translated = _translateObject_overwritten.call(this, x, y, limits);

    if (this.movementLimits) {

      var pos = this.getFixedPosition(target, x, y);

      if (pos.scaleX) {
        target.scaleX = this._currentTransform.scaleX *= pos.scaleX;
      }
      if (pos.scaleY) {
        target.scaleY = this._currentTransform.scaleY *= pos.scaleY;
      }

      if (pos.top !== undefined || pos.left !== undefined) {
        _translated = _translateObject_overwritten.call(this, pos.left !== undefined ? pos.left : x, pos.top !== undefined ? pos.top : y);
      }
    }
    return _translated || pos.scaleX || pos.scaleY;

    /* if (!target.get('lockMovementX')) {
     var _val = x - this._currentTransform.offsetX;
      //left offset
     var lim = this.movementLimits.minX.constructor == Number ? this.movementLimits.minX : -bounds.width + 1;
     if(target.movementXMinLimit && target.movementXMinLimit.constructor == Number && target.movementXMinLimit > lim ){
     lim = target.movementXMinLimit ;
     }
      _val = Math.min(lim, _val);
      //right offset
     var lim = this.movementLimits.maxX.constructor == Number ? this.movementLimits.maxX : this.width + bounds.width - 1;
     if(target.movementXMaxLimit && target.movementXMaxLimit.constructor == Number && target.movementXMaxLimit > lim ){
     lim = target.movementXMaxLimit ;
     }
     _val = Math.max(lim  - target.width * target.scaleX, _val);
     target.set('left', _val);
     }
     if (!target.get('lockMovementY')) {
     var _val = y - this._currentTransform.offsetY;
     if(target.movementYMinLimit !== undefined)
     _val = Math.min(target.movementYMinLimit, _val);
     if(target.movementYMaxLimit !== undefined)
     _val = Math.max(target.movementYMaxLimit  - target.height, _val);
      target.set('top', _val);
     }
     */
    //movementLimits ={
    //    xmin: 0,
    //    xmax: 0,
    //    ymin: 0,
    //    ymax: 0
    //};
  },

  _beforeTransform: function _beforeTransform(e, target) {
    target && target._beforeTransform ? target._beforeTransform(e) : _beforeTransform_overwritten.call(this, e, target);
  },
  _beforeTransformNative: _beforeTransform_overwritten
  /**
   * Translates object by "setting" its left/top
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @return {Boolean} true if the translation occurred
   */
  /* _translateObject: function (x, y) {
     var transform = this._currentTransform,
       target = transform.target,
       newLeft = x - transform.offsetX,
       newTop = y - transform.offsetY,
       moveX = !target.get('lockMovementX') && target.left !== newLeft,
       moveY = !target.get('lockMovementY') && target.top !== newTop;
  
     //round coordinates
     // if (target.wholeCoordinates) {
     //   newLeft = Math.round(newLeft);
     //   newTop = Math.round(newTop);
     // }
      moveX && target.set('left', newLeft);
     moveY && target.set('top', newTop);
     return moveX || moveY;
   }*/
});

//fabric.Canvas.addPlugin("loaders",function(){
//    this.initMovementLimits();
//});

//todo
// fabric.Rect.prototype.stateProperties   = fabric.Rect.prototype.stateProperties.concat(["movementLimits","clipTo"]);
// fabric.Object.prototype.stateProperties = fabric.Object.prototype.stateProperties.concat(["movementLimits","clipTo"]);
// fabric.IText.prototype.stateProperties  = fabric.IText.prototype.stateProperties.concat(["movementLimits","clipTo"]);
// fabric.Image.prototype.stateProperties  = fabric.Image.prototype.stateProperties.concat(["movementLimits","clipTo"]);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 49 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {
//require("./../core/base.js");
//require("./../core/slide.js");

__webpack_require__(6);

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  optionsOrder: fabric.StaticCanvas.prototype.optionsOrder && function () {
    var oo = fabric.StaticCanvas.prototype.optionsOrder;
    oo.splice(oo.indexOf("*"), 0, "areas", "offsets", "helpers");
    return oo;
  }(),
  _helpersObjects: null,
  _areasObjects: null,
  _update_clip_rect: function _update_clip_rect() {
    //todo
    return;
    if (this.areas || !this._areasObjects[0]) return;
    var geometry = fabric.util.getRect(this.width, this.height, this.offsets);
    this._areasObjects[0].set(geometry);
  },
  //offsets: {left : 0,t``````````````````````````````op : 0, right: 0, bottom:0},
  setHelpers: function setHelpers(helpers, callback) {
    var _this2 = this;

    return false; //todo
    this.helpers = helpers;
    this._helpersObjects = [];
    if (helpers) {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = helpers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var h = _step.value;

          this.createObject(h, function (helper) {
            _this2._helpersObjects.push(helper);
            _this2.renderAll();
          });
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }
    callback && callback();
  },
  storeProperties: fabric.StaticCanvas.prototype.storeProperties && fabric.StaticCanvas.prototype.storeProperties.concat(["offsets", "helpers", "areas"]),
  areaActivating: false,
  addElementsInsideActiveArea: false,
  areaProperties: {
    originX: 'left',
    originY: 'top',
    fill: 'transparent',
    strokeDashArray: [5, 5],
    strokeWidth: 1,
    stroke: 'black',
    resizable: true
    //selectable: false
  },
  setAreaProperty: function setAreaProperty(property, value) {
    this["area_" + property] = value;
    if (this._offsetsObject) {
      this._offsetsObject[property] = value;
    }
    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = this._areasObjects[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        var object = _step2.value;

        object[property] = value;
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    this.renderAll();
  },
  setActiveArea: function setActiveArea(area) {
    if (this.activeArea) {
      this.activeArea.setStroke("#000");
    }
    this.activeArea = area;
    if (area) {
      area.setStroke("#B7F1ED");
    }
  },
  setAreaActivating: function setAreaActivating(value /*, force*/) {
    //todo force
    var force = true;
    if (force || value && !this.areaActivating) {
      this.areaActivating = true;
      this.on("object:modified", function (e) {
        if (!this._areasObjects) return;
        if (this.editingObject) {
          return;
        }
        //todo event! не ъотел бы это тут испольовать,но работает
        var pointer = this.getPointer(event, true);
        var target = this._searchPossibleTargets(this._areasObjects, pointer);
        if (this._currentTransform && target && this.application.target.movementLimits != target) {
          this.application.target.set({
            movementLimits: target,
            clipTo: target
          });
          this.setActiveArea(target);
        }
      });
      this.on("mouse:down", function (e) {
        if (!this._areasObjects) return;
        var pointer = this.getPointer(e.e, true);
        var target = this._searchPossibleTargets(this._areasObjects, pointer);
        if (target) {
          this.setActiveArea(target);
        }
      });
    }
  },
  _update_area_geometry: function _update_area_geometry(el, options) {

    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (options.path) {

      options.width = options.width || el.width;
      var geometry = fabric.util.getRect(_w, _h, options);
      var _scale = el.width / geometry.width;
      el.set({
        left: geometry.left, ///* el.left * _scale*/,
        top: geometry.top, //+ el.top * _scale,
        scaleX: _scale,
        scaleY: _scale
      });
      return;
    }

    var geometry = fabric.util.getRect(_w, _h, options);

    if (options.src) {
      var _scale = geometry.width / img.width;
      el.set({
        left: geometry.left, // + el.left * _scale,
        top: geometry.top, //+ el.top * _scale,
        strokeWidth: this.areaProperties.strokeWidth / _scale,
        scaleX: _scale,
        scaleY: _scale
      });
    } else {
      // geometry.width -= el.strokeWidth * 2;
      // geometry.height -= el.strokeWidth * 2;
      el.set(geometry);
    }
  },
  _renderOverlayObjects: function _renderOverlayObjects(ctx) {
    if (this._offsetsObject) {
      this._offsetsObject.render(ctx);
    }
    if (this._areasObjects) {
      this._renderObjects(ctx, this._areasObjects);
    }
    if (this._helpersObjects) {
      this._renderObjects(ctx, this._helpersObjects);
    }
  },
  createArea: function createArea(area, callback) {

    var _this = this;

    var _finalize = function (path, area) {
      path.id = area.id;
      //
      // area.instance = path;
      // path.layer = "background";
      // this.add(path);
      this._update_area_geometry(path, area);
      this._areasObjects.push(path);
      // _this._backgroundLayer.push(path);
      // path.canvas = _this;
      callback();
    }.bind(this);

    var path, rectarea;
    if (area.path) {
      path = new fabric.Path(area.path, this.areaProperties);
      area.top = path.top;
      area.left = path.left;
      area.width = path.width;
      area.height = path.height;
      _finalize(path, area);
    } else if (area.src) {
      var clipFiller = new fabric.Pathfinder({});
      fabric.util.loadImage(area.src, function (img) {
        clipFiller.setImage(img);
        clipFiller.mask = MagicWand.selectBackground(clipFiller.getInfo(), null, 15);

        var contours = clipFiller.getContours();
        var clipPoints = contours[1].points;
        var pathData = fabric.PencilBrush.prototype.convertPointsToSVGPath(clipPoints).join(''); //todo
        path = new fabric.Path(pathData, _this.areaProperties);

        _finalize(path, area);
      });
    } else {
      path = new fabric.Rect(this.areaProperties);
      _finalize(path, area);
    }

    if ((area.right || area.bottom || area.path) && (!this.originalWidth || !this.originalHeight)) {
      this.on("background-image:loaded", function () {
        this._update_area_geometry(path, area);
        this.renderAll();
      }.bind(this));
    }

    /*
     app.canvas.setOffsets({
     right:  1,
     left:   1,
     top:    1,
     bottom: 1
     });
       app.canvas.clipTo = function (ctx) {
     var zoom = app.canvas_config.width / app.canvas.backgroundImage.filters[0].pathfinder.mask.width;
     ctx.save();
     ctx.scale(zoom, zoom);
     app.clipFiller.traceInner(ctx);
     ctx.restore();
     };*/
  },
  removeArea: function removeArea(area) {
    /*
        var objs = this.getObjects();
        for (var i in objs) {
          if (objs[i].movementLimits === area) {
            delete objs[i].movementLimits;
          }
          if (objs[i].clipTo === area) {
            //if(objs[i].olcClipToID){
            //    objs[i].clipToID = objs[i].oldClipToID;
            //}
            delete objs[i].clipTo;
            //objs[i].olcClipToID = area.id;
          }
        }
        area.remove();*/
  },
  /**
   *
   * @param offsets : {top: number, right: number, bottom: number, left: number} | number | [?number,?number,?number,?number]
   * @param callback
   */
  setOffsets: function setOffsets(offsets) {
    var _this3 = this;

    if (offsets === null) {
      this.offsets = { top: 0, right: 0, bottom: 0, left: 0 };
    } else if (offsets.constructor === Number) {
      this.offsets = { top: offsets, right: offsets, bottom: offsets, left: offsets };
    } else if (offsets.constructor === Array) {
      switch (offsets.length) {
        case 0:
          this.offsets = { top: 0, right: 0, bottom: 0, left: 0 };break;
        case 1:
          this.offsets = { top: offsets[0], right: offsets[0], bottom: offsets[0], left: offsets[0] };break;
        case 2:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[0], left: offsets[1] };break;
        case 3:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[1] };break;
        case 4:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[3] };break;
      }
    } else {
      this.offsets = offsets;
    }

    if (this.offsets.top || this.offsets.bottom || this.offsets.left || this.offsets.right) {

      this._offsetsObject = new fabric.Rect(this.offsets);
      this._offsetsObject.set(this.areaProperties);
      this._update_area_geometry(this._offsetsObject, this.offsets);

      this.on("viewport:scaled", function () {
        _this3._update_area_geometry(_this3._offsetsObject, _this3.offsets);
      });

      this.on("dimensions:modified", function () {
        _this3._update_area_geometry(_this3._offsetsObject, _this3.offsets);
      });

      if (this.areaActivating) {
        this.setActiveArea(this._offsetsObject || null);
      }
    } else {
      this._offsetsObject = null;
    }

    this.renderAll();
  },
  setAreas: function setAreas(areas, callback) {
    this._areasObjects = [];
    areas = areas || [];
    if (this.areas) {
      for (var i = this.areas.length; i--;) {
        this.removeArea(this.areas[i].instance);
      }
    }
    this.areas = areas;

    var cb = fabric.util.queueLoad(areas.length + 1, function () {
      if (this.areaActivating) {
        this.setActiveArea(this._areasObjects[0] || null);
      }

      /* var objs = this.getObjects();
      //work with object
       if (!areas.length) {
         objs.length && this.clear();
       } else {
         /* todo : применить текущую зону ко всем объектам
          var _area = this.activeArea || this.layers.background.objects[0];
          for (var i in objs) {
          var obj = objs[i];
          obj.clipTo = _area;
          obj.setMovementLimits(_area);
          obj.setCoords();
          }*/
      //}*/
      callback && callback.call(this);
    }.bind(this));

    for (var i in areas) {
      if (!areas[i].id) {
        areas[i].id = "__" + i;
      }
      this.createArea(areas[i], cb);
    }
    cb();

    this.renderAll();
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.Canvas.prototype.defaultOptions, {
    //offsets: {left : 0,top : 0, right: 0, bottom:0}
  }),
  eventListeners: fabric.util.object.extendArraysObject(fabric.Canvas.prototype.eventListeners, {
    "before:drop": function beforeDrop(e) {
      //todo;
      if (!this._backgroundLayer) {
        return;
      }
      var pointer = this.getPointer(e.originalEvent, true);
      var target = this._searchPossibleTargets(this._backgroundLayer, pointer);
      if (target) {
        this.setActiveArea(target);
        e.data.clipTo = "#" + target.id;
        e.data.movementLimits = "#" + target.id;
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _OBJ = fabric.Object.prototype;
var _handleGrouping_overwritten = fabric.Canvas.prototype._handleGrouping;
fabric.Object.prototype.groupable = true;

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * Deactivates all objects and dispatches appropriate events
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  deactivateAllWithDispatch: function deactivateAllWithDispatch(e) {
    var activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject();
    var _target = activeObject || activeGroup;
    if (_target) {
      this.fire('before:selection:cleared', { target: _target, e: e });
    }
    this.deactivateAll();
    if (_target) {
      this.fire('selection:cleared', { e: e, target: _target });
      _target.fire('deselected');
    }
    return this;
  },

  /**
   * adding before:selection:created event
   * @private
   * @param {Event} e Event object
   * @param {fabric.Object} target
   */
  _handleGrouping: function _handleGrouping(e, target) {
    this.fire("before:selection:created");
    _handleGrouping_overwritten.call(this, e, target);
  },
  /**
   * @private
   * @param {Event} e mouse event
   */
  _groupSelectedObjects: function _groupSelectedObjects(e) {

    var group = this._collectObjects();

    group = fabric.util.object.filter(group, { groupable: true });

    // do not create group for 1 element only
    if (group.length === 1) {
      this.setActiveObject(group[0], e);
    } else if (group.length > 1) {
      group = new fabric.Group(group.reverse(), {
        canvas: this
      });
      group.addWithUpdate();
      this.setActiveGroup(group, e);
      group.saveCoords();
      this.fire('selection:created', { target: group });
      this.renderAll();
    }
  }
});

_OBJ.clone = function (callback, propertiesToInclude) {
  var _obj = this.toObject(propertiesToInclude);
  _obj.application = this.application;
  if (this.constructor.fromObject) {
    return this.constructor.fromObject(_obj, callback);
  }
  return new fabric.Object(this.toObject(propertiesToInclude));
};

_OBJ.cloneSync = function () {
  var _klass = fabric[fabric.util.string.camelize(fabric.util.string.capitalize(this.type))];
  if (_klass.async) {
    var _obj = new _klass.fromObject(this, function () {});
  } else {
    var _obj = this.clone();
  }
  _obj.canvas = this.canvas;
  return _obj;
};

fabric.util.object.extend(fabric.Group.prototype, {
  isPossibleTarget: function isPossibleTarget(e, object) {
    return this.searchPossibleTargets(e, [object]).target !== null;
  },
  /**
   * return inner target and group of targets under the cursor
   * @param e
   * @param objects
   * @returns {{target: null, group: Array}}
   */
  searchPossibleTargets: function searchPossibleTargets(e, objects) {

    if (!objects) objects = this._objects;
    var pointer = this.canvas.getPointer(e, true);
    var i = objects.length,
        normalizedPointer = this.canvas._normalizePointer(this, pointer);

    var targets = {
      target: null,
      group: []
    };
    while (i--) {
      if (this.canvas._checkTarget(normalizedPointer, objects[i])) {
        if (!targets.target) targets.target = objects[i];
        targets.group.push(objects[i]);
      }
    }
    return targets;
  },

  groupSelectable: true,
  cloneSync: function cloneSync() {
    var _clonedObjects = this._objects.map(function (object) {
      return object.cloneSync();
    });

    var object = this.toObject();
    delete object.objects;

    return new fabric.Group(_clonedObjects, object, true);

    // fabric.util.enlivenObjects(object.objects, function (enlivenedObjects) {
    //   delete object.objects;
    //   callback && callback(new fabric.Group(enlivenedObjects, object, true));
    // });
  },
  _calcBounds: function _calcBounds(onlyWidthHeight) {
    var aX = [],
        aY = [],
        o,
        prop,
        props = ['tr', 'br', 'bl', 'tl'];

    for (var i = 0, len = this._objects.length; i < len; ++i) {
      o = this._objects[i];
      if (o.notSelectableInTheGroup) {
        continue;
      }
      o.setCoords();
      for (var j = 0; j < props.length; j++) {
        prop = props[j];
        aX.push(o.oCoords[prop].x);
        aY.push(o.oCoords[prop].y);
      }
    }

    this.set(this._getBounds(aX, aY, onlyWidthHeight));
  },
  initialize_overwritten: fabric.Group.prototype.initialize,
  isSelectionGroup: function isSelectionGroup() {
    return this.canvas._objects.indexOf(this) === -1;
  },
  //clone: function(callback){
  //  if(callback === true || callback.constructor === Object){
  //    var _frame = new fabric.Group(this);
  //    if(callback.constructor === Object){
  //      _frame.set(callback);
  //      return _frame;
  //    }
  //  }
  //  return this.callSuper('clone',callback);
  //},
  initialize: function initialize(objects, options) {
    if (objects.constructor != Array) {
      var el = objects;
      options = el.toObject();
      objects = [];
      for (var i in el._objects) {
        objects.push(el._objects[i].cloneSync());
      }
    }

    this.initialize_overwritten(objects, options);
    if (this.type == 'group') {
      this.on("dblclick", function () {
        if (this.canvas._objects.indexOf(this) === -1) {
          this.groupSelectedElements();
        } else {
          this.ungroup();
        }
      });
    }
  },
  ungroup: function ungroup() {
    var _canvas = this.canvas;
    _canvas.discardActiveGroup();
    this._restoreObjectsState();
    for (var i in this._objects) {
      _canvas.add(this._objects[i]);
      this._objects[i].clipTo = this.clipTo;
      //this._objects[i].active = true;
    }
    _canvas.remove(this);
    var group = new fabric.Group(this._objects, {
      canvas: _canvas
    });
    group.addWithUpdate();
    _canvas.setActiveGroup(group);
    group.saveCoords();
    _canvas.fire('selection:created', { target: group });
    _canvas.renderAll();

    //var _group = new fabric.Group(this._objects);
    //_group.canvas = _canvas;
    //_canvas.setActiveObject(_group);
  },

  groupSelectedElements: function groupSelectedElements() {

    var el = this.cloneSync();
    this.canvas.add(el);
    this.canvas.discardActiveGroup();
    this.canvas.setActiveObject(el);

    for (var i in this._objects) {
      this.canvas.remove(this._objects[i].originalObject);
    }
  },
  actions: {

    remove: {
      className: 'fa fa-trash',
      title: 'Delete',
      key: "Delete",
      action: function action() {
        if (this.isSelectionGroup()) {
          for (var i in this._objects) {
            var _obj = this._objects[i];
            this.canvas.remove(_obj.originalObject);
          }
          this.canvas.discardActiveGroup();
          this.canvas.discardActiveObject();
        } else {
          this.canvas.remove(this);
        }
        this.canvas.renderAll();
      }
    },
    duplicate: {
      className: 'fa fa-clone',
      title: 'Duplicate',
      action: function action() {
        if (this.isSelectionGroup()) {
          this.canvas.fire('before:selection:cleared', { target: this, e: null });
          this.canvas.discardActiveGroup();
          this.duplicate(function (el) {
            el.ungroup();
          });

          this.canvas.renderAll();
        } else {
          this.duplicate();
        }
      }
    },
    groupSelectedElements: {
      title: 'группа',
      className: 'fa fa-object-group',
      visible: function visible() {
        return this.isSelectionGroup();
      },
      action: function action() {
        this.groupSelectedElements();
        this.canvas.renderAll();
      }
      //visible: IDE.groupAvailable
    },
    ungroup: {
      title: 'группа',
      className: 'fa fa-object-ungroup',
      visible: function visible() {
        return this.type == "group" && this.canvas._objects.indexOf(this) !== -1;
      },
      action: function action() {
        this.ungroup();
        this.canvas.renderAll();
      }
    }
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.Canvas.prototype.eventListeners, {
    'selection:created': function selectionCreated(event) {
      this._onSelectionCreated(event);
    }
  }),
  _onSelectionModified: function _onSelectionModified() {
    for (var i in this._objects) {

      var copy = this._objects[i].cloneSync();
      copy.group = this;
      this._restoreObjectState(copy);

      this._objects[i].originalObject.set({
        clipTo: this.clipTo,
        movementLimits: this.movementLimits,
        left: copy.left,
        top: copy.top,
        angle: copy.angle,
        scaleX: copy.scaleX,
        scaleY: copy.scaleY,
        skewX: copy.skewX,
        skewY: copy.skewY,
        width: copy.width,
        height: copy.height
      });
    }
  },
  _onSelectionDeselected: function _onSelectionDeselected(data) {
    for (var i in this._objects) {
      var _obj = this._objects[i];
      _obj.originalObject.setCoords();
      _obj.originalObject.evented = true;
      delete _obj.originalObject.hiddenActive;
    }
  },
  _onSelectionCreated: function _onSelectionCreated(el) {

    var group = el.target;

    var originalObjects = [];
    for (var i in group._objects) {
      var _obj = group._objects[i];
      originalObjects.push(_obj.originalObject || _obj);
    }

    group.destroy();
    group._objects = [];

    var _clipTo = originalObjects[0].clipTo;

    for (var i in originalObjects) {
      var original = originalObjects[i];

      if (_clipTo != original.clipTo) {
        _clipTo = false;
      }

      var _obj = original.cloneSync();

      _obj.set({
        clipTo: null,
        originalObject: original
      });
      original.set({
        active: false,
        evented: false,
        hiddenActive: true
      });

      group.addWithUpdate(_obj);
      group.setCoords();
    }

    group.clipTo = _clipTo;

    group.on({
      "modified": this._onSelectionModified,
      'deselected': this._onSelectionDeselected
    });
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 51 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.History = __webpack_require__(52);

fabric.util.object.extend(fabric.Editor.prototype.actions, {
  undo: {
    key: 'z',
    observe: 'changed',
    className: 'fa fa-  undo',
    title: 'Undo',
    enabled: 'canUndo',
    action: function action() {
      this.undo();
    },
    target: function target() {
      return this.history;
    }
  },
  records: {
    title: "Records",
    itemClassName: "filters-selector",
    className: "fa fa-history",
    type: "select",
    target: function target() {
      return this.history;
    },
    dropdown: {
      width: 300,
      templateSelection: function templateSelection(state, container) {
        if (state.any) {
          return state.text;
        }
        return $('<span>' + state.id + ":" + state.type + '</span>');
      },
      templateResult: function templateResult(state, container, data) {
        if (!state.type) return;
        var _keys = state.originalState && Object.keys(state.originalState).join(',') || '';
        var type = state.object && state.object.type || '';
        return $("<span title='{id}:{type}({otype} {keys})'>{id}:{type}({otype} {keys})</span>".format(fabric.util.object.extend({
          keys: _keys,
          otype: type
        }, state)));
      }
    },
    value: {
      observe: 'changed',
      set: function set(val, filtersData) {
        this.goto(val);
      },
      get: function get() {
        return this.records[this.current].id;
      },
      options: function options() {
        return this.records;
      }
    }
  },
  redo: {
    key: 'y',
    observe: 'changed',
    className: 'fa fa-repeat',
    title: 'Redo',
    enabled: 'canRedo',
    action: function action() {
      this.redo();
    },
    target: function target() {
      return this.history;
    }
  },
  history: {
    title: 'History',
    type: 'menu',
    menu: ["redo", "undo"]
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  onCanvasModified: function onCanvasModified(e) {
    var _this = this;

    if (!this._isHistoryActive()) return;

    var states = this.getModifiedStates();
    if (!states) return;

    this.history.add({
      canvas: this,
      originalState: states.original,
      modifiedState: states.modified,
      type: 'canvas:modified',
      undo: function undo(a) {
        _this.set(a.originalState).fire('modified').renderAll();
      },
      redo: function redo(a) {
        _this.set(a.modifiedState).fire('modified').renderAll();
      }
    });
  },
  onCanvasCleared: function onCanvasCleared(e) {
    var _this2 = this;

    if (!this._isHistoryActive()) return;

    var states = this.getModifiedStates();

    if (!e.objects.length && !states) {
      return;
    }

    this.history.add({
      originalState: states && states.original,
      modifiedState: states && states.modified,
      originalObjects: e.objects,
      type: 'canvas:cleared',
      redo: function redo(a) {
        _this2._clearObjects();
        if (a.originalState) {
          _this2.set(a.modifiedState).fire('modified');
        }
        _this2.renderAll();
      },
      undo: function undo(a) {
        _this2._objects = _this2._objects.concat(a.originalObjects);
        if (a.modifiedState) {
          _this2.set(a.originalState).fire('modified');
        }
        _this2.renderAll();
      }
    });
  },
  onObjectModified: function onObjectModified(e) {
    if (!this._isHistoryActive()) return;

    var target = e.target,
        states = e.target.getModifiedStates();

    if (!states) return;

    this.history.add({
      canvas: target.canvas.originalSlide || target.canvas,
      originalState: states.original,
      modifiedState: states.modified,
      object: target,
      type: 'object:modified',
      undo: function undo(a) {
        a.object.set(a.originalState);
        a.object.setCoords();
        a.object.fire('modified');
        a.canvas.fire('object:modified', { target: a.object });
        a.canvas.renderAll();
      },
      redo: function redo(a) {
        a.object.set(a.modifiedState);
        a.object.setCoords();
        a.canvas.fire('object:modified', { target: a.object });
        a.object.fire('modified');
        a.canvas.renderAll();
      }
    });
  },
  clearHistory: function clearHistory() {
    this.history.clear();
  },
  disableHistory: function disableHistory() {
    this.history.enabled = false;
  },
  _add_object_historya: function _add_object_historya(a) {
    var _canvas = this.canvas || this;
    // if(this.canvas && a.canvas.mirrorSlide == this.canvas){
    //   _canvas.add(a.object);
    //   _canvas.setActiveObject(a.object);
    //   _canvas.renderAll();
    // }else{
    a.canvas.add(a.object);
    // }
    a.canvas.renderAll();
  },
  _remove_object_historya: function _remove_object_historya(a) {
    a.canvas.remove(a.object);
    a.canvas.renderAll();
    // if(this.canvas && a.canvas.mirrorSlide == this.canvas){
    //   this.canvas.renderAll();
    // }
  },
  _isHistoryActive: function _isHistoryActive() {
    return this.stateful && this.history.enabled && !this.processing && !this.history.processing;
  },
  onObjectRemoved: function onObjectRemoved(e) {
    if (!this._isHistoryActive()) return;
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:removed',
      redo: this._remove_object_historya,
      undo: this._add_object_historya
    });
  },
  onDrawAfter: function onDrawAfter(event) {
    if (!e.target.canvas.stateful || !this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add(this.freeDrawingBrush.getHistoryRecord(event));
  },
  onObjectAdded: function onObjectAdded(e) {
    if (!this._isHistoryActive()) return;
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:added',
      undo: this._remove_object_historya,
      redo: this._add_object_historya
    });
  },
  initHistory: function initHistory(history) {
    if (!history) {
      history = new fabric.History(this);
      history.application = this.application;
    }
    this.stateful = true;
    this.history = history;

    this.on({
      'modified': this.onCanvasModified,
      'loading:begin': this.clearHistory,
      'draw:after': this.onDrawAfter,
      'object:modified': this.onObjectModified,
      'canvas:cleared': this.onCanvasCleared,
      'object:added': this.onObjectAdded,
      'object:removed': this.onObjectRemoved
    });

    // let _this = this;
    // this.history.on('changed', function(e){
    // });
    var proto = this.application.prototypes.History;
    if (proto) {
      if (proto.eventListeners) {
        history.on(proto.eventListeners);
      }
    }
  },
  enableHistory: function enableHistory() {
    this.history.enabled = true;
  }
});

fabric.HISTORY_MODE = {
  INDIVIDUAL: "slide",
  SHARED: "global"
};

fabric.util.object.extend(fabric.Editor.prototype, {
  optionsOrder: function () {
    var oo = fabric.Editor.prototype.optionsOrder;
    oo.splice(oo.indexOf("*"), 0, "history");
    return oo;
  }(),
  history: null,
  // _default_event_listeners : {
  //   "slide:change:begin" : function(){
  //     this.processing = true ;
  //     if(this.history){
  //       this.history.processing = true ;
  //     }
  //   },
  //   "slide:changed" : function(){
  //     this.processing = false;
  //     if(this.history){
  //       this.history.processing = false;
  //     }
  //   }
  // },
  setHistory: function setHistory(historyOption) {
    var _this3 = this;

    if (historyOption === fabric.HISTORY_MODE.SHARED) {
      this.history = new fabric.History(this);
      this.enableHistory();

      this.on("slide:created", function (e) {
        e.target.initHistory(_this3.history);
      });
      // this.on("ready",() => {
      //   if (this.slides) {
      //     this.slides.forEach(slide => {
      //       slide.initHistory(this.history);
      //     })
      //   }
      // })
    }
    /* if(historyOption === fabric.HISTORY_MODE.INDIVIDUAL){
       if(this.canvas){
         this.history = new fabric.History(this);
         this.enableHistory();
         this.canvas.initHistory(this.history);
       }
       //todo unsupported
     }*/
  },
  enableHistory: function enableHistory() {
    this.history.enabled = true;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 52 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var utils = __webpack_require__(2);
utils.object = __webpack_require__(3);

/***********************************************************************************************************************
 ** DPHistory
 ***********************************************************************************************************************/

var DPHistory = function DPHistory(parent, initAction) {
  this.parent = parent;
  this.clear(initAction);
};

DPHistory.prototype.setRecords = function (records, current) {
  this.canUndo = records.length;
  this.canRedo = false;

  if (!records.length) {
    records = [{
      type: 'initialized',
      id: 0,
      text: 'initialized'
    }];
  }
  this.records = records;
  this.length = this.records.length;
  this.current = current === undefined ? records.length - 1 : current;
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.restore = function () {
  this.setRecords(this.saved.records, this.saved.current);
  return this;
};

DPHistory.prototype.save = function () {
  this.saved = {
    current: this.current,
    records: utils.object.cloneDeep(this.records)
  };
  return this;
};

DPHistory.prototype.clear = function (initAction) {
  if (initAction) {
    initAction.id = 0;
  } else {
    initAction = {
      type: 'initialized',
      id: 0,
      text: 'initialized'
    };
  }
  this.records = [initAction];
  this.current = 0;
  this.canUndo = false;
  this.canRedo = false;
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.add = function (action) {

  if (!this.enabled || this.processing) {
    return false;
  }

  action.moment = new Date().getTime();
  this.canUndo = true;
  this.canRedo = false;
  this.records.splice(this.current + 1);
  this.records.push(action);
  this.length = this.records.length;
  action.id = this.length - 1;
  action.text = action.type || action.text;
  this.current = this.length - 1;

  this.activeAction = this.records[this.current];
  this.fire("changed", { action: action });
  return this;
};
DPHistory.prototype.disable = function () {
  this.enabled = false;
  return this;
};
DPHistory.prototype.enable = function () {
  this.enabled = true;
  return this;
};
DPHistory.prototype.undo = function (noFire) {
  this.canRedo = true;
  var _action = this.records[this.current];
  this.current--;
  this.processing = true;
  _action.undo.call(this.parent, _action);
  this.processing = false;
  if (this.current == 0) {
    this.canUndo = false;
  }
  if (!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed", { action: _action });
  }
  return this;
};

DPHistory.prototype.goto = function (index) {
  if (index == this.current) return;
  if (index < this.current) {
    for (var i = this.current - index; i--;) {
      this.undo(true);
    }
  }if (index > this.current) {
    for (var i = index - this.current; i--;) {
      this.redo(true);
    }
  }
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.redo = function (noFire) {
  if (this.current == this.length - 1) {
    return;
  }
  this.processing = true;
  this.canUndo = true;
  this.current++;
  var _action = this.records[this.current];

  _action.redo.call(this.parent, _action);

  if (this.current == this.length - 1) {
    this.canRedo = false;
  }
  this.processing = false;
  if (!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed", { action: _action });
  }
  return this;
};
utils.observable(DPHistory.prototype);
module.exports = DPHistory;

/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/////////////////module responsive borders//////////////////////////////////////////////////////////////////////////////////////////

fabric.util.object.extend(fabric.Object.prototype, {
  responsiveBorders: false,
  centerAndZoomOut: function centerAndZoomOut() {
    this.canvas.centerOnObject(this);
  }
});

if (!fabric.Canvas.prototype._default_event_listeners) {
  fabric.Canvas.prototype._default_event_listeners = {};
};

fabric.Object.prototype.updateResponsiveBorder = function () {
  if (this.responsiveBorders) {
    if (!this.originalStrokeWidth) {
      this.originalStrokeWidth = this.strokeWidth;
    }
    this.strokeWidth = this.canvas ? this.originalStrokeWidth / this.canvas.viewportTransform[0] : 0;
  }
};

fabric.util.object.extend(fabric.Canvas.prototype, {
  _default_event_listeners: {
    "dimensions:modified": function dimensionsModified() {
      if (this.autoCenterAndZoomOutEnabled) {
        this.centerAndZoomOut();
      }
    },
    'viewport:scaled': function viewportScaled() {
      if (this.backgroundImage) {
        this.backgroundImage.updateResponsiveBorder();
      }
      for (var i in this._objects) {
        this._objects[i].updateResponsiveBorder();
      }
    },
    "background-image:loaded": function backgroundImageLoaded(event) {
      if (this.autoCenterAndZoomOutEnabled) {
        this.centerAndZoomOut();
      }
    },
    "loading:end": function loadingEnd(event) {
      if (this.autoCenterAndZoomOutEnabled && (this.originalHeight || this.originalWidth)) {
        this.centerAndZoomOut();
      }
    },
    "object:added": function objectAdded(event) {
      event.target.updateResponsiveBorder();
    }
  }
});

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


fabric.util.object.extend(fabric.Canvas.prototype, {
  zoomCtrlKey: true,
  mouseWheelZoom: false,
  setMouseWheelZoom: function setMouseWheelZoom(val) {
    this.mouseWheelZoom = val;
    this.on("mouse:wheel", this.wheelZoom);
  },
  _setZoomNative: fabric.Canvas.prototype.setZoom,
  _zoomToPointNative: fabric.Canvas.prototype.zoomToPoint,
  changeDimensionOnZoom: false,
  drawZoomArea: function drawZoomArea(_ctx, left, top, width, height) {
    _ctx.save();
    _ctx.translate(left || 0, top || 0);
    var _scale = this.getZoom();
    var _size = fabric.util.getProportions(this.backgroundImage, { width: width || 100, height: height || 100 });
    _ctx.globalAlpha = 0.5;
    _ctx.fillRect(0, 0, _size.width, _size.height);
    _ctx.strokeStyle = "red";

    var v = this.viewportTransform;

    var x1 = -v[4] * _size.scale / _scale;
    var y1 = -v[5] * _size.scale / _scale;
    var x2 = x1 + this.width * _size.scale / _scale;
    var y2 = y1 + this.height * _size.scale / _scale;

    x1 = Math.max(x1, 0);
    y1 = Math.max(y1, 0);
    x2 = Math.min(x2, _size.width);
    y2 = Math.min(y2, _size.height);

    _ctx.globalAlpha = 1;
    _ctx.beginPath();
    _ctx.moveTo(x1, y1);
    _ctx.lineTo(x2, y1);
    _ctx.lineTo(x2, y2);
    _ctx.lineTo(x1, y2);
    _ctx.lineTo(x1, y1);

    _ctx.fill();
    _ctx.clip();
    // _ctx.globalCompositeOperation = "source-in";
    _ctx.drawImage(this.backgroundImage._element, 0, 0, _size.width, _size.height);
    // _ctx.globalCompositeOperation = "source-over";
    // _ctx.drawImage(this.backgroundImage._element,0,0,_size.width, _size.height)
    _ctx.stroke();
    _ctx.strokeRect(0, 0, _size.width, _size.height);
    _ctx.restore();
  },
  setZoom: function setZoom(_scale, point) {

    if (!point) {
      point = new fabric.Point(0, 0);
    }

    if (this.changeDimensionOnZoom) {

      if (!this.originalWidth) {
        this.originalWidth = this.width;
      }
      if (!this.originalHeight) {
        this.originalHeight = this.height;
      }
      this.setDimensions({
        width: Math.round(this.originalWidth * _scale),
        height: Math.round(this.originalHeight * _scale)
      }, {
        // cssOnly: true
      });
    }
    this._zoomToPointNative(point, _scale);

    this._update_background_overlay_image("background");
    this._update_background_overlay_image("overlay");
    //  this._setZoomNative(_scale);
    this.fire('viewport:scaled', { scale: _scale });
  },
  zoomToPoint: function zoomToPoint(point, newZoom) {
    var _max = this.getMaxZoom();
    var _min = this.getMinZoom().scale;
    if (newZoom > _max) {
      newZoom = _max;
    }
    if (newZoom < _min) {
      newZoom = _min;
    }
    this.setZoom(newZoom, point);
  },
  resetViewport: function resetViewport() {
    _canvas.viewportTransform[0] = 1;
    _canvas.viewportTransform[3] = 1;
    _canvas.viewportTransform[4] = 0;
    _canvas.viewportTransform[5] = 0;
    _canvas.renderAll();
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
  },
  zoomToPointEnabled: true,
  minZoomFactor: 1,
  maxZoom: 20,
  autoCenterAndZoomOutEnabled: false,
  getMaxZoom: function getMaxZoom() {
    return this.maxZoom;
  },
  getMinZoom: function getMinZoom() {
    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };
    var _bgSize = {
      width: this.originalWidth,
      height: this.originalHeight
    };
    var _maxSize = {
      width: _containerSize.width * this.minZoomFactor,
      height: _containerSize.height * this.minZoomFactor
    };

    return fabric.util.getProportions(_bgSize, _maxSize, 'fit');
  },
  centerAndZoomOut: function centerAndZoomOut() {

    if (this.virtual) {
      return;
    }
    var options = this.getMinZoom();

    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };

    var vpt = this.viewportTransform.slice(0);
    vpt[0] = options.scale;
    vpt[3] = options.scale;
    vpt[4] = (_containerSize.width - options.width) / 2;
    vpt[5] = (_containerSize.height - options.height) / 2;

    this.setViewportTransform(vpt);

    this._update_background_overlay_image("background");
    this._update_background_overlay_image("overlay");
    // this.fire("viewport:scaled",{scale: options.scale})
    //this.renderAll();
  },
  centerOnObject: function centerOnObject(tag) {
    var br = tag.getBoundingRect();
    var ct = this.viewportTransform;
    br.width /= ct[0];
    br.height /= ct[3];
    var size = {
      width: br.width * 1.1,
      height: br.height * 1.1
    };

    var prop = fabric.util.getProportions(size, this);
    var _w = (this.width / prop.scale - size.width) / 2;
    var _h = (this.height / prop.scale - size.height) / 2;
    var _l = (br.left - ct[4]) / ct[0];
    var _t = (br.top - ct[5]) / ct[3];

    var x1 = [prop.scale, 0, 0, prop.scale, -tag.left * prop.scale + (tag.width * 0.05 + _w) * prop.scale, -tag.top * prop.scale + (tag.height * 0.05 + _h) * prop.scale];
    var x2 = [prop.scale, 0, 0, prop.scale, -_l * prop.scale + (br.width * 0.05 + _w) * prop.scale, -_t * prop.scale + (br.height * 0.05 + _h) * prop.scale];

    this.setViewportTransform(x2);
    this.fire("viewport:scaled", { scale: prop.scale });
    this.renderAll();
  },

  wheelZoom: function wheelZoom(event) {

    if (!this.mouseWheelEnabled || this.zoomCtrlKey && !event.ctrlKey) {
      return;
    }
    //Find nearest point, that is inside image END
    var zoomStep; // = 0.1 * event.deltaY;
    if (event.deltaY < 0) {
      zoomStep = 1.1;
    } else {
      zoomStep = 0.9;
    }

    var cZoom = this.getZoom();
    var newZoom = cZoom * zoomStep;
    var minZoom = this.getMinZoom().scale;

    if (this.zoomToPointEnabled) {
      var point = new fabric.Point(event.offsetX, event.offsetY);
      var _x = this.viewportTransform[4];
      var _y = this.viewportTransform[5];

      // Find nearest point, that is inside image BEGIN
      // It is needed to prevent canvas to zoom outside image
      var _w = this.originalWidth * this.getZoom() + _x;
      var _h = this.originalHeight * this.getZoom() + _y;

      if (point.x < _x) {
        point.x = _x;
      }
      if (point.y < _y) {
        point.y = _y;
      }
      if (point.x > _w) {
        point.x = _w;
      }
      if (point.y > _h) {
        point.y = _h;
      }
      if (minZoom > newZoom) {
        if (this.autoCenterAndZoomOutEnabled) {
          this.centerAndZoomOut();
        } else if (event.deltaY < 0) {
          this.zoomToPoint(point, newZoom);
        }
      } else {
        this.zoomToPoint(point, newZoom);
      }
    } else {
      this.setZoom(newZoom);
    }

    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.renderAll();
    event.stopPropagation();
    event.preventDefault();
    return false; //preventing scroll page
  },
  scaleFactor: 1.1,
  getOrignalCenter: function getOrignalCenter() {
    var point = this.getCenter();
    point.left += this.viewportTransform[4];
    point.top += this.viewportTransform[5];
    return point;
  }
});

fabric.util.object.extend(fabric.Object.prototype.actions, {
  centerAndZoomOut: {
    className: 'fa fa-search-plus',
    title: 'centerAndZoomOut'
  }
});

fabric.util.object.extend(fabric.Canvas.prototype.actions, {
  zoomOut: {
    className: 'fa fa-search-minus',
    title: 'zoom-out',
    action: function action() {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() / this.scaleFactor;
      this.zoomToPoint({ x: point.left, y: point.top }, scaleValue);
    }
  },
  zoomNumber: {
    type: 'number',
    value: {
      min: function min() {
        return 0.01;
      },
      max: function max() {
        return 10;
      },
      set: function set(val) {
        this.setZoom(val);
      },
      get: function get() {
        return this.getZoom();
      },
      observe: "viewport:scaled"
    }
  },
  zoomIn: {
    className: 'fa fa-search-plus',
    title: 'zoom-in',
    action: function action() {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() * this.scaleFactor;
      this.zoomToPoint({ x: point.left, y: point.top }, scaleValue);
    }
    // zoom: {
    //   title: "zoom",
    //   menu: zoomOut
    // }
  } });
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 54 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  _toSVG_overwritten: fabric.StaticCanvas.prototype.toSVG,
  toSVG: function toSVG(options, reviver) {

    var _w = this.width,
        _h = this.height;
    if (this.originalWidth) {
      this.svgViewportTransformation = false;
      this.width = this.originalWidth;
      this.height = this.originalHeight;
    }

    options || (options = {});

    var markup = [];

    this._setSVGPreamble(markup, options);
    this._setSVGHeader(markup, options);
    this._setSVGLayers(markup, reviver);

    markup.push('</svg>');

    if (this.originalWidth) {
      this.width = _w;
      this.height = _h;
    }
    return markup.join('');
  },
  _setSVGLayers: function _setSVGLayers(markup, reviver) {
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {

      for (var _iterator = this._layers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var layerId = _step.value;

        if (this.layers[layerId].svg) {
          this.layers[layerId].svg(this, markup, reviver);
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }
  },
  getSVGBody: function getSVGBody(options, reviver) {

    var _w = this.width,
        _h = this.height;

    if (this.originalWidth) {
      this.width = this.originalWidth;
      this.height = this.originalHeight;
    }
    options = options || {};

    var scaleX = options.scaleX || (options.width ? options.width / this.width : 1),
        scaleY = options.scaleY || (options.height ? options.height / this.height : 1),
        _l = options.left || 0,
        _t = options.top || 0,
        angle = options.angle || 0,
        clipPath = "";

    if (options.clipPath) {
      clipPath = 'clip-path: url(#' + options.clipPath + ');';
    }

    var transform = "";
    if (angle !== 0) {
      transform += 'rotate(' + angle + ') ';
    }
    if (_l !== 0 || _t !== 0) {
      transform += 'translate(' + _l + ' ' + _t + ') ';
    }
    if (scaleX !== 1 || scaleY !== 1) {
      transform += 'scale(' + scaleX + ' ' + scaleY + ') ';
    }

    var markup = ['<g transform="' + transform + '" style="' + clipPath + '" id="' + options.clipPath + '">'];

    this._setSVGLayers(markup, reviver);

    markup.push('</g>');

    if (this.originalWidth) {
      this.width = _w;
      this.height = _h;
    }
    return markup;
  }
});

fabric.StaticCanvas.prototype.inlineSVG = false;

fabric.Image.prototype.getSvgSrc = function (filtered) {
  var element = filtered ? this._element : this._originalElement;
  if (element) {
    var _src = fabric.isLikelyNode ? element._src : element.src;
    if (this.canvas.inlineSVG && !_src.startsWith("data:image")) {
      if (element.toDataURL) {
        return element.toDataURL();
      } else {
        var canvas = fabric.util.createCanvasElement();
        canvas.width = element.width;
        canvas.height = element.height;
        var ctx = canvas.getContext('2d');
        ctx.drawImage(element, 0, 0);
        var dataURL = canvas.toDataURL();
        return dataURL;
      }
    }
    return _src;
  } else {
    return this.src || '';
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 55 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var $ = window.jQuery || window.$;
$.focusNextElement = function (previos) {
  //add all elements we want to include in our selection
  var focussableElements = 'a:not([disabled]), button:not([disabled]), input[type=text]:not([disabled]), textarea:not([disabled]), [tabindex]:not([disabled]):not([tabindex="-1"])';
  // if (document.activeElement ) {
  var focussable = Array.prototype.filter.call(document.querySelectorAll(focussableElements), function (element) {
    //check for visibility while always include the current activeElement
    return element.offsetWidth > 0 || element.offsetHeight > 0 || element === document.activeElement;
  });

  var index = focussable.indexOf(document.activeElement);
  var nextElement;
  if (previos) {
    nextElement = focussable[index - 1] || focussable[focussable.length - 1];
  } else {
    nextElement = focussable[index + 1] || focussable[0];
  }
  nextElement.focus();
  // }
};

fabric.IText.prototype.activateNextObject = function (e) {
  this.exitEditing();
  var _prev = e.shiftKey;
  this.canvas.activateNextObject(_prev);
};

fabric.IText.prototype.keysMap[9] = "activateNextObject";

fabric.focusedCanvas = null;
fabric.util.addListener(fabric.window, 'keydown', function (e) {
  if (e.code === "Tab") {
    fabric._tabbableSetToLast = e.shiftKey;
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  tabbable: false,
  activateFirstObject: function activateFirstObject() {
    this.discardActiveGroup();
    this.discardActiveObject();
    if (this._objects.length > 0) {
      this.setActiveObject(this._objects[0]);
    }
  },
  activateLastObject: function activateLastObject() {
    this.discardActiveGroup();
    this.discardActiveObject();
    if (this._objects.length > 0) {
      this.setActiveObject(this._objects[this._objects.length - 1]);
    }
  },
  activateNextObject: function activateNextObject(previos) {
    var _active = this.getActiveObject();
    var _index = this._objects.indexOf(_active);
    var next = this._objects[_index + (previos ? -1 : 1)];
    if (next) {
      this.setActiveObject(next);
    } else {
      this.discardActiveGroup();
      this.discardActiveObject();

      this._ignoreFocusEvent = true;
      $(this.inputElement).focus();
      fabric._tabbableSetToLast = previos;
      $.focusNextElement(previos);
    }
  },
  setTabbable: function setTabbable(value) {
    if (this.tabbable === value) {
      return;
    }
    this.tabbable = value;
    if (!value) {
      $(this.inputElement).remove();
      delete this.inputElement;
      return;
    }
    var _this = this;

    this.inputElement = fabric.document.createElement('input');
    this.inputElement.setAttribute("type", "text");
    this.inputElement.style.cssText = 'position: absolute; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;';
    this.wrapperEl.appendChild(this.inputElement);
    fabric.util.addListener(this.inputElement, 'focus', this.focus.bind(this));

    $(this.inputElement).bind({
      focus: function focus() {
        if (_this._ignoreFocusEvent) {
          delete _this._ignoreFocusEvent;
          return false;
        }
        _this.focus();
        // fabric.focusedCanvas = _this;
        fabric._tabbableSetToLast ? _this.activateLastObject() : _this.activateFirstObject();
        // $(_this.wrapperEl).css('border','1px dotted #000');
      },
      blur: function blur() {
        // fabric.focusedCanvas = null;
        // $(this.wrapperEl).css('border','none');
      }
    });
    this.on("mouse:down", this.focus.bind(this));
  },
  onkeyUp: function onkeyUp(e) {
    console.log(e);
  },
  blur: function blur() {
    if (this._activeObject) {
      if (this._activeObject.isEditing) {
        this._activeObject.exitEditing();
      }
    }
    this.discardActiveGroup();
    this.discardActiveObject();
    this.renderAll();
    return this;
  },
  focus: function focus() {
    if (fabric.focusedCanvas == this) {
      return;
    }
    if (fabric.focusedCanvas) {
      fabric.focusedCanvas.blur();
    }
    fabric.focusedCanvas = this;
    return this;
    // this.activateNextObject();
    // $(this.wrapperEl).css('border','1px dotted #000');
    // $(this.wrapperEl).focus();
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 56 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Text.prototype, {
    staticBorderColor: false,
    _render_staticBorderColorOverwritten: fabric.Text.prototype.render,
    render: function render(ctx, noTransform) {
        this._render_staticBorderColorOverwritten(ctx);

        ctx.save();
        if (!noTransform) {
            this.transform(ctx);
        }
        this._drawBorders(ctx);
        ctx.restore();
    },
    _staticBorderColorRender: fabric.IText.prototype._render,
    _drawBorders: function _drawBorders(ctx) {
        if (this.active || !this.staticBorderColor) {
            return;
        }
        ctx.strokeStyle = this.staticBorderColor;
        ctx.strokeRect(-this.width / 2, -this.height / 2, this.width, this.height);
    }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 57 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
* InteractiveMode mixin. Allow to switch between pan/edit/drawing canvas modes.
*/



var _mouse_down_overwritten = fabric.Canvas.prototype._onMouseDown;
var _mouse_up_overwritten = fabric.Canvas.prototype._onMouseUp;
var _mouse_move_overwritten = fabric.Canvas.prototype._onMouseMove;

fabric.util.object.extend(fabric.Canvas.prototype, {
  _initEventListeners_overwritten: fabric.Canvas.prototype._initEventListeners,
  _initEventListeners: function _initEventListeners() {
    this._initEventListeners_overwritten();
    this.___onKeyDown = this._onKeyDown.bind(this);
    fabric.util.addListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _removeListeners_overwritten: fabric.Canvas.prototype.removeListeners,
  removeListeners: function removeListeners() {
    this._removeListeners_overwritten();
    fabric.util.removeListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _onKeyDown: function _onKeyDown(e) {
    return this._applyMixedMode(e);
  },
  getInteractiveMode: function getInteractiveMode() {
    return this.interactiveMode;
  },
  setInteractiveMode: function setInteractiveMode(tool) {
    //todo checkthis out
    // if (tool === 'hand') {
    //   this.setCursor('pointer');
    // }
    this.isDrawingMode = tool === 'draw';
    this.isHandMode = tool === 'hand';
    this.interactive = tool !== 'disabled';
    this.isMixedMode = tool === 'mixed';

    if (!this.interactive) {
      this.upperCanvasEl.style.cursor = 'default';
    }
    this.interactiveMode = tool;
  },

  /**
   *  current mode
   *  @values default | hand | selection
   *  @comment
   *      hand      - moving canvas
   *      draw - drawing reactangles
   *      selection - default behavior
   */
  interactiveMode: 'default',

  isHandMode: false,
  _handModeCursorMove: false,
  _handModeCursorDown: false,
  _handModeCursorPosition: { x: 0, y: 0 },
  _handModeMouseMove: function _handModeMouseMove(e) {
    if (this._handModeCursorDown === true) {

      if (e.pageY === this._handModeCursorPosition.y && e.pageX === this._handModeCursorPosition.x) {
        return;
      }

      this._handModeCursorMove = true;

      var scroll = { x: this.viewportTransform[4], y: this.viewportTransform[5] };

      var newScroll = {
        x: scroll.x - (this._handModeCursorPosition.x - e.pageX),
        y: scroll.y - (this._handModeCursorPosition.y - e.pageY)
      };

      var dims = {
        width: this.size.width * this.zoom - this.lowerCanvasEl.width,
        height: this.size.height * this.zoom - this.lowerCanvasEl.height
      };
      /*  todo need to add some restrictions later
       //Math.max(Math.min(0,newScroll.x),-dims.width);
       //Math.max(Math.min(0,newScroll.y),-dims.height);
       */
      this.viewportTransform[4] = newScroll.x;
      this.viewportTransform[5] = newScroll.y;

      this.fire('viewport:translate');

      this.renderAll();
      for (var i = 0, len = this._objects.length; i < len; i++) {
        this._objects[i].setCoords();
      }

      this._handModeCursorPosition.y = e.pageY;
      this._handModeCursorPosition.x = e.pageX;
    }
  },
  _handModeMouseUp: function _handModeMouseUp() {
    this._handModeCursorDown = false;
    if (!this._handModeCursorMove) {}
  },
  _handModeMouseDown: function _handModeMouseDown(e) {

    this._handModeCursorMove = false;
    this._handModeCursorDown = true;
    this._handModeCursorPosition = {
      y: e.pageY,
      x: e.pageX
    };
  },
  handModeEnabled: false,
  handModeKey: "Alt",
  _applyMixedMode: function _applyMixedMode(e) {

    if (this.handModeEnabled && e.altKey || e.key === this.handModeKey) {
      //if shift use hand mode
      if (!this.isHandMode) {
        this.isHandMode = true;
        this.isDrawingMode = false;
        this.setCursor('pointer');
      }
    } else if (this.isMixedMode && !this._isCurrentlyDrawing && !this._currentTransform) {

      this.isHandMode = false;

      this._current_target = this.findTarget(e);
      if (this._current_target) {
        if (this.freeDrawingBrush && this._current_target.allowDrawing) {
          var corner = this._current_target._findTargetCorner(this.getPointer(e, true));
          if (!corner) {
            this.isDrawingMode = true;
          } else {
            this.isDrawingMode = false;
          }
        } else if (this.isDrawingMode) {
          this.isDrawingMode = false;
        }
      } else {
        if (this.freeDrawingBrush && !this.isDrawingMode) {
          this.setCursor(this.freeDrawingCursor);
          this.isDrawingMode = true;
        }
      }
    } else {
      this.isHandMode = false;
    }
  },
  _onMouseMove: function _onMouseMove(e) {
    if (!this.interactive) {
      return;
    }

    this._applyMixedMode(e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }

      if (this._handModeActive) {
        return this._handModeMouseMove(e);
      }
      this.fire('mouse:move', { target: this._current_target, e: e });
      this._current_target && this._current_target.fire('mousemove', { e: e });
      return true;
    } else {
      return _mouse_move_overwritten.call(this, e);
    }
  }, /**
     * @private
     */
  _onScale: function _onScale(e, transform, x, y) {

    var useUniScale = e.shiftKey ^ this.shiftInverted;
    // rotate object only if shift key is not pressed
    // and if it is not a group we are transforming
    if ((useUniScale || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {
      transform.currentAction = 'scale';
      return this._scaleObject(x, y);
    } else {
      // Switch from a normal resize to proportional
      if (!transform.reset && transform.currentAction === 'scale') {
        this._resetCurrentTransform(e);
      }

      transform.currentAction = 'scaleEqually';
      return this._scaleObject(x, y, 'equally');
    }
  },
  shiftInverted: false,
  _setCursorFromEvent_overwritten: fabric.Canvas.prototype._setCursorFromEvent,
  _setCursorFromEvent: function _setCursorFromEvent(e, target) {
    if (this.isHandMode) {
      this.setCursor('pointer');
    } else {
      this._setCursorFromEvent_overwritten(e, target);
    }
  },
  _onMouseDown: function _onMouseDown(e) {
    if (!this.interactive) {
      return;
    }

    e.preventDefault();
    e.stopPropagation();

    this._applyMixedMode(e);
    if (this.isHandMode && this._current_target) {
      this._current_target.selectable_overwritten = this._current_target.selectable;
      this._current_target.selectable = false;
    }

    _mouse_down_overwritten.call(this, e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }
      this._handModeActive = true;
      this._handModeMouseDown(e);
    }
  },

  _onMouseUp: function _onMouseUp(e) {
    if (!this.interactive) {
      return;
    }
    e.preventDefault();
    e.stopPropagation();
    _mouse_up_overwritten.call(this, e);

    if (this.isHandMode) {
      this._handModeActive = false;
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 58 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!fabric.StrokeMixin) {
  __webpack_require__(59);
}

/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
fabric.Frame = fabric.util.createClass(fabric.Group, fabric.StrokeMixin, {
  type: 'frame',
  //strokeActive:   "lightgreen",
  //stroke: "red",
  minWidth: 35,
  minHeight: 35,
  fill: "transparent",
  resizable: true,
  contentTools: false,
  //states : Empty / Full / Active
  stateProperties: fabric.Group.prototype.stateProperties.concat(["clip"]),
  optionsOrder: function () {
    var oo = fabric.Object.prototype.optionsOrder.slice();
    oo.splice(oo.indexOf("*") + 1, 0, "element", "clip");
    return oo;
  }(),
  clip: {
    left: 0,
    top: 0,
    scaleX: 1,
    scaleY: 1
  },
  clippingAvailable: function clippingAvailable() {
    return this.clipEnabled && this.element && !this._clipmode;
  },
  clipEnabled: true,
  /**
   * create clone with same image and shape as original (syncronous)
   * @param callback
   * @returns {*}
   */
  cloneSync: function cloneSync(options) {
    var _frame = new fabric.Frame(this);
    options && _frame.set(options);
    return _frame;
  },
  initialize: function initialize(options) {
    options || (options = {});

    if (options.constructor != Object) {

      var _obj = options.toObject();
      if (options.element) {
        _obj.element = options.element.cloneSync();
        _obj.element.clipTo = _obj._fabric_shape;
      }
      _obj.shape = options.shape;
      options = _obj;
    }

    this.on({
      "object:click": this._check_text_as_target_and_edit,
      "dblclick": this.toggleClipModeByClick,
      "redraw": this._apply_shape,
      "element:modified": function elementModified(event) {
        this.updateStroke();
        this._apply_shape();
      }
    });

    this.initShape(options);
    this.callSuper('initialize', [this._fabric_shape], options);
    this._elements_to_update = [];
  },
  toggleClipModeByClick: function toggleClipModeByClick(e) {
    if (this._is_clipping_available(e.e)) {
      if (!this._clipmode) {
        this.clipPhotoStart();
      } else {
        this.clipPhotoEnd();
      }
    }
  },
  _check_text_as_target_and_edit: function _check_text_as_target_and_edit(e) {
    if (this.isPossibleTarget(e.e, this.text)) {
      this.text.setOpacity(1);
      this._on_text_edit(e);
    }
  },
  clipPhotoEnd: function clipPhotoEnd() {
    this.canvas.editingObject = null;
    this.application.off("target:changed target:cleared", this._endFoo);

    if (this.canvas._gridObject) {
      this.canvas._gridObject.enabled = true;
    }

    //this.project.clipMode = false;


    this.canvas.remove(this.element);
    this.set({
      hasControls: false,
      evented: true,
      flipX: this.element.flipX,
      flipY: this.element.flipY
    });

    var to_radians = Math.PI / 180;
    var cosA = Math.cos(this.angle * to_radians);
    var sinA = Math.sin(this.angle * to_radians);
    var I = this.element,
        F = this;

    var _newGeometry = {
      angle: this.element.angle - this.angle,
      left: ((I.left - F.left) * cosA + (I.top - F.top) * sinA - F.width / 2) * (I.flipX ? -1 : 1),
      top: (-(I.left - F.left) * sinA + (I.top - F.top) * cosA - F.height / 2) * (I.flipY ? -1 : 1),
      flipX: false,
      flipY: false
    };

    if (this.element.originX === "center") {
      //   _newGeometry.left += this.element.width /2;
    }
    if (this.element.originY === "center") {
      //_newGeometry.top += this.element.height /2;
    }

    this.add(this.element);
    this.element.set(_newGeometry);
    //
    //
    this._clipmode = false;
    //рамку двигать нельзя
    this.set({
      hasControls: true,
      evented: true
    });
    this.canvas.remove(this._fabric_shape);
    this.add(this._fabric_shape);
    this.updateStroke();
    this._apply_shape();

    this.element.active = false;
    this.canvas.setActiveObject(this);
    this.canvas.renderAll();

    var w = this.width,
        h = this.height,
        el = this.element;

    this.clip = {
      left: el.left / w,
      top: el.top / h,
      scaleX: el.width / w,
      scaleY: el.height / h
    };

    this.fire("clipping:exited");
    this.canvas.fire('frame:clipping:exited', { target: this });
  },
  clipPhotoStart: function clipPhotoStart() {
    var _this = this;
    this._clipmode = true;
    this.updateStroke();
    this._apply_shape();
    this.canvas.discardActiveGroup();
    if (this.canvas._gridObject) {
      this.canvas._gridObject.enabled = false;
    }

    /* this.fabric.set({
     originX: "center",
     originY:  "center",
     left: this.fabric.left + this.fabric.width/2,
     top: this.fabric.top + this.fabric.height/2,
     });*/

    this.element.set({
      movementLimits: this,
      movementLimitMode: "content",
      //clipTo:         this,
      flipX: this.flipX,
      flipY: this.flipY
      //left: this.element.left* (this.flipX ? -1 : 1),
      //top:  this.element.top* (this.flipY ? -1 : 1)
    });

    this._restoreObjectState(this.element);
    this.element.set({
      hasControls: true,
      //selectable: false,
      //perPixelTargetFind: true,
      selectable: true,
      perPixelTargetFind: false
    });
    this.remove(this.element);
    this.canvas.add(this.element);

    this._restoreObjectState(this._fabric_shape);
    this.remove(this._fabric_shape);
    this.canvas.add(this._fabric_shape);

    //рамка должна рисоваться над картинкой, иначе  некрасиво
    //      this.slide.canvas.bringToFront(this.fabric);

    //рамку двигать нельзя
    this.set({
      hasControls: false,
      evented: false
    });

    this.canvas.setActiveObject(this.element);
    this.active = true;

    this._endFoo = function () {
      _this.clipPhotoEnd();
    };
    this.application.on("target:changed target:cleared", this._endFoo);

    this.fire("clipping:entered");
    this.canvas.fire('frame:clipping:entered', { target: this });

    this.canvas.editingObject = this;
    this.canvas.renderAll();
  },
  render: function render(ctx, noTransform) {

    if (this.dirty) {

      if (this.dirtyHeight) {
        for (var i in this._elements_to_update) {
          var data = this._elements_to_update[i];
          this._update_interface_element_position(data.element, data, "height");
        }
        this._update_element_height();
        this.dirtyHeight = false;
      }
      if (this.dirtyWidth) {
        for (var i in this._elements_to_update) {
          var data = this._elements_to_update[i];
          this._update_interface_element_position(data.element, data, "width");
        }
        this._update_element_width();
        this.dirtyWidth = false;
      }
      this.dirty = false;
      this.fire("redraw");
    }

    if (this._clipmode) {
      var _zoom = this.canvas.getZoom();
      ctx.save();
      //  this.transform(ctx);
      ctx.globalAlpha = 0.5;
      var _clip_to = this.element.clipTo;
      this.element.clipTo = null;
      this.element.render(ctx);
      ctx.scale(_zoom, _zoom);
      this.element.clipTo = _clip_to;
      this.transform(ctx);
      ctx.strokeStyle = this.borderColor;
      ctx.lineWidth = 1 / this.borderScaleFactor;
      ctx.beginPath();
      ctx.closePath();
      ctx.stroke();
      ctx.restore();
    }
    this.callSuper('render', ctx, noTransform);
  },
  //supportedTypes: "*", // * or ["image","video",...]
  clippingSupportedTypes: "*", // * or ["image","video",...]
  _is_clipping_available: function _is_clipping_available(e) {
    if (!this.clipEnabled) return false;
    if (e && this.isPossibleTarget(e, this.button)) {
      return;
    }
    return this.element && (this.clippingSupportedTypes == "*" || this.clippingSupportedTypes.indexOf(this.element.type) != -1);
  },
  _remove_element: function _remove_element() {},
  setData: function setData(data) {
    if (data.role == "frame") {
      this.setFrame(data.frame);
      this.setShape(data.shape);
    } else {
      this.setElementObject(data);
    }
  },
  accepts: {
    role: ["image", "video", "frame"]
  },
  setElementObject: function setElementObject(options, callback) {
    var newOptions = {
      src: options.src
    };
    if (options.role == "image") {
      newOptions.type = "image";
    }
    if (options.role == "video") {
      newOptions.type = "video";
    }
    this._set_pending(true);
    this.fire("element:loading");
    fabric.util.createObject(newOptions, function (el) {
      this._set_pending(false);
      this.setElementKlass(el);
      callback && callback(el);
    }.bind(this));
  },
  setElement: function setElement(el, cb) {
    if (el) {
      if (el.constructor == Object) {
        this.setElementObject(el, cb);
      } else {
        this.setElementKlass(el);
        cb && cb();
      }
    } else {
      this.setElementKlass();
      cb && cb();
    }
  },
  dropElementMethod: "cover", //resize
  /**
   * Создание элемента фото
   * @private
   */
  setElementKlass: function setElementKlass(el) {
    if (this.element === el) return;

    if (this.element) {
      this._remove_element();
      this.element.destructor && this.element.destructor();
      this.remove(this.element);
      this.canvas && this.canvas.remove(this.element);
    }
    this.element = el;

    if (el) {
      el.on("dblclick", function (e) {
        this.parent.toggleClipModeByClick(e);
      });
      el.setupState();

      if (this.dropElementMethod == "resize") {
        this.clip = {
          left: 0,
          top: 0,
          scaleX: 1,
          scaleY: 1
        };
      }

      if (this.dropElementMethod == "cover") {
        var size = fabric.util.getProportions(el, this, 'cover');
        this.clip = {
          left: 0,
          top: 0,
          scaleX: size.width / this.width,
          scaleY: size.height / this.height
        };
      }

      el.set({
        tools: ["clipEnd"],
        actions: {
          clipEnd: {
            className: "fa fa-crop",
            title: "clip end",
            action: function action() {
              this.parent.clipPhotoEnd();
            }
          }
        },
        parent: this,
        notSelectableInTheGroup: true,
        originX: "center",
        originY: "center",
        transparentCorners: false,
        resizable: true,
        clipTo: this._fabric_shape
      });

      this.add(el);

      for (var i in this._elements_to_update) {
        this.remove(this._elements_to_update[i].element);
        this.add(this._elements_to_update[i].element);
      }
      this._update_element_size();
    }

    this.fire("element:modified", { element: el });
    this.canvas && this.canvas.renderAll();
  },

  /**
   * ограничиваем перемещение фотографии внутри рамки
   * @param el
   */
  _limit_moving: function _limit_moving(data) {

    var r = this.getBoundingRect();
    var i = this.element;
    i.on("moving", function () {
      var b = {
        l: r.left + i.width * i.scaleX / 2,
        r: r.left + r.width - i.width * i.scaleX / 2,
        t: r.top + i.height * i.scaleY / 2,
        b: r.top + r.height - i.height * i.scaleY / 2
      };
      // capping logic here
      i.setLeft(Math.max(Math.min(b.l, i.left), b.r));
      i.setTop(Math.max(Math.min(b.t, i.top), b.b));
    });

    i.on("scaling", function () {
      i.set({
        width: Math.max(r.width, i.width * i.scaleX),
        height: Math.max(r.height, i.height * i.scaleY),
        scaleX: 1,
        scaleY: 1
      });

      var b = {
        l: r.left + i.width * i.scaleX / 2,
        r: r.left + r.width - i.width * i.scaleX / 2,
        t: r.top + i.height * i.scaleY / 2,
        b: r.top + r.height - i.height * i.scaleY / 2
      };
      //// capping logic here
      //i.setLeft(Math.min(Math.max(b.l, i.left),b.r));
      //i.setTop(Math.min(Math.max(b.t, i.top),b.b));
    });
  },

  _set_pending: function _set_pending(val) {
    this._pending = val;
  },

  /**
   * Создание элемента фото
   * @private
   */
  _create_remove_button: function _create_remove_button(options) {

    this.button = this._create_button({
      text: "",
      options: {
        visible: false
      },
      position: {
        top: 0,
        right: 0
      }
    });

    this.button.on('click', function (e) {
      if (!this._pending) {
        this.setElement(false);
      }
    }.bind(this));
  },
  _add_element_to_update: function _add_element_to_update(data) {
    this._elements_to_update.push(data);

    if (data.right !== undefined) {
      data.element.setOriginX("right");
    }
    if (data.left !== undefined) {
      data.element.setOriginX("left");
    }
    if (data.bottom !== undefined) {
      data.element.setOriginY("bottom");
    }
    if (data.top !== undefined) {
      data.element.setOriginY("top");
    }

    this._update_interface_element_position(data.element, data);
  },
  setClip: function setClip(val) {
    this.clip = val;
    this._update_element_size();
  },
  _update_element_size: function _update_element_size() {
    this._update_element_width();
    this._update_element_height();
  },

  _update_element_width: function _update_element_width() {
    if (this.element) {
      if (this.element.type == "ellipse") {
        this.element.set({
          rx: this.width / 2 * this.clip.scaleX
        });
      } else if (this.element.type == "video" || this.element.type == "path") {

        this.element.set({
          left: 0,
          scaleX: this.width / this.element.width
        });
      } else {
        this.element.setWidth(this.width * this.clip.scaleX);
        this.element.setLeft(this.width * this.clip.left);
      }
    }
  },
  _update_element_height: function _update_element_height() {
    if (this.element) {

      if (this.element.type == "ellipse") {
        this.element.set({
          ry: this.height / 2 * this.clip.scaleY
        });
      } else if (this.element.type == "video" || this.element.type == "path") {

        this.element.set({
          top: 0,
          scaleY: this.height / this.element.height
        });
      } else {
        this.element.setHeight(this.height * this.clip.scaleY);
        this.element.setTop(this.height * this.clip.top);
      }
    }
  },
  _update_interface_element_position: function _update_interface_element_position(el, data, prop) {
    if (!prop || prop == "height") {
      if (data.top !== undefined && data.bottom !== undefined) {
        el.setTop(-this.height / 2 + data.top);
        el.setHeight(this.height - data.top - data.bottom);
      }if (data.top !== undefined) {
        el.setTop(-this.height / 2 + data.top);
      } else if (data.bottom !== undefined) {
        el.setTop(this.height / 2 - data.bottom);
      } else if (data.height !== undefined) {
        el.setHeight(data.height);
      }
    }
    if (!prop || prop == "width") {
      if (data.right !== undefined && data.left !== undefined) {
        el.setLeft(-this.width / 2 + data.left);
        el.setWidth(this.width - data.left - data.right);
      } else if (data.right !== undefined) {
        el.setLeft(this.width / 2 - data.right);
      } else if (data.left !== undefined) {
        el.setLeft(-this.width / 2 + data.left);
      } else if (data.width !== undefined) {
        el.setWidth(data.width);
      }
    }
    el.setCoords();
  },
  dirty: false,
  dirtyHeight: false,
  dirtyWidth: false,
  setHeight: function setHeight(h) {
    this.height = h;
    this.dirty = true;
    this.dirtyHeight = true;
  },
  setWidth: function setWidth(w) {
    this.width = w;
    this.dirty = true;
    this.dirtyWidth = true;
  },
  toObject: function toObject(propertiesToInclude) {
    propertiesToInclude = ["clip", "data"].concat(propertiesToInclude);

    // var object = this.callSuper('toObject', propertiesToInclude);
    var object = fabric.Object.prototype.toObject.call(this, propertiesToInclude);

    if (this.shape) {
      object.shape = fabric.util.object.clone(this.shape);
      if (object.shape.src) {
        delete object.shape.paths;
        delete object.shape.height;
        delete object.shape.width;
        delete object.shape.svgUid;
        delete object.shape.toBeParsed;
      }
    }

    delete object.objects;

    if (this.element) {
      var _obj2 = this.element.toObject();
      object.element = {
        type: _obj2.type,
        src: _obj2.src
      };
    }
    return object;
  }
});

var _FRA = fabric.Frame.prototype;
fabric.Frame.prototype.actions = fabric.util.object.extend({}, fabric.Object.prototype.actions, {
  clear: {
    title: "Remove content",
    className: "fa fa-times",
    action: _FRA.setElement,
    visible: "element",
    observe: "element:modified"
  },
  crop: {
    title: "crop",
    className: "fa fa-crop",
    action: _FRA.clipPhotoStart,
    visible: _FRA.clippingAvailable,
    observe: "clipping:entered clipping:exited element:modified"
  }
});

fabric.Frame.fromObject = function (object, callback) {
  var _app = object.application;
  delete object.application;
  object = fabric.util.object.cloneDeep(object);
  object.application = _app;

  var cb = fabric.util.queueLoad(2, function () {
    callback && callback(new fabric.Frame(object));
  });

  if (object.image) {

    fabric.util.createObject({
      type: "image",
      image: object.image,
      width: object.image.width,
      height: object.image.height
    }, function (el) {
      object.element = el;
      cb();
    });
  } else if (object.element) {
    fabric.util.createObject(object.element, function (el) {
      object.element = el;
      cb();
    });
  } else {
    cb();
  }

  if (object.shape && object.shape.src) {
    fabric.loadSVGFromURL(object.shape.src, function (paths, options) {
      object.shape.paths = paths;
      fabric.util.object.extend(object.shape, options);
      cb();
    });
  } else {
    cb();
  }
};
fabric.Frame.async = true;

fabric.util.createAccessors(fabric.Frame);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 59 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.StrokeMixin = {
  shape: {
    strokeWidthFull: 0,
    strokeWidthEmpty: 2,
    strokeWidthActive: 2,
    strokeDashArray: [5, 5],
    fill: "transparent",
    strokeEmpty: "red",
    strokeFull: "red",
    strokeActive: "green"
  },
  setShape: function setShape(el, cb) {

    el = fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray: this.shape.dashArray,
      strokeEmpty: this.shape.strokeEmpty,
      strokeFull: this.shape.strokeFull,
      strokeActive: this.shape.strokeActive
    }, el);

    var _this = this;
    if (el && el.src && !el.paths) {
      fabric.loadSVGFromURL(el.src, function (paths, options) {
        el.paths = paths;
        fabric.util.object.extend(el, options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape);
        _this._apply_shape();
        _this._fabric_shape.sendToBack();
        cb && cb();
      });
    } else {
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      _this._fabric_shape.sendToBack();
      cb && cb();
    }
  },
  initShape: function initShape(options) {

    var _shapeOptions = fabric.util.object.extend(options.shape || {}, this.shape);

    this._fabric_shape = new fabric.Rect(fabric.util.object.extend({}, _shapeOptions, {
      width: options.width,
      height: options.height,
      stroke: _shapeOptions.strokeEmpty,
      strokeWidth: _shapeOptions.strokeWidthEmpty
    }));
  },

  /**
   * �������������� ����� �� ������� ������� ����
   * @private
   */
  _apply_shape: function _apply_shape() {
    var shape = this.shape;

    var _off = shape && shape.offsets;

    if (!_off) {
      _off = [0, 0, 0, 0];
    }

    var _off_units = shape && shape.offsets_units;

    if (!_off_units) {
      //if (frame.border_image) {todo
      //    _off_units = frame.border_image.width_units || [0, 0, 0, 0];
      //} else {
      _off_units = [1, 1, 1, 1];
      //}
    }

    /*else if(shape.offsets && shape.offsets_units){
     var s = this.slide.scaleValue;
     this._fabric_shape = new fabric.Rect({
     originX: 'center',
     originY: 'center',
     width:  (this.data.geometry.width - shape.offsets[3] - shape.offsets[1]) * s,
     height: (this.data.geometry.height -shape.offsets[0] - shape.offsets[2]) * s
     });*/

    _off = {
      top: _off[0] * (_off_units[0] ? this.height / 100 : 1) || 0,
      right: _off[1] * (_off_units[1] ? this.width / 100 : 1) || 0,
      bottom: _off[2] * (_off_units[2] ? this.height / 100 : 1) || 0,
      left: _off[3] * (_off_units[3] ? this.width / 100 : 1) || 0
    };

    var _w = this.width - _off.left - _off.right; // *this.slide.scaleValue;
    var _h = this.height - _off.top - _off.bottom; // *this.slide.scaleValue;


    //if(this.resources.frame.data.shape && this.resources.frame.data.shape.radius){
    //
    //    this._fabric_shape.set({
    //        left: -this.width/2  + _off.left ,
    //        top:  -this.height/2 + _off.top ,
    //        width: _w - _off.left -_off.right,
    //        height:  _h - _off.top -_off.bottom,
    //        scaleX:  1,
    //        scaleY:  1
    //    });
    //}else{


    //if(this.shape.path || this.shape.paths || this.shape.offsets){
    var _sw = this.shape.width || this._fabric_shape.width;
    var _sh = this.shape.height || this._fabric_shape.height;

    // if(this._fabric_shape.strokeWidth){
    //   _sw += this._fabric_shape.strokeWidth ;
    //   _sh += this._fabric_shape.strokeWidth ;
    // }

    var options = {
      left: -this.width / 2 + _off.left,
      top: -this.height / 2 + _off.top,
      scaleX: _w / 100 / (_sw / 100), // * (shape.scaleX || 1),
      scaleY: _h / 100 / (_sh / 100), // * (shape.scaleY || 1)
      angle: 0
    };
    /*}else{
      var options = {
        left:   -this.width / 2 + _off.left,
        top:    -this.height / 2 + _off.top,
        width:    _w,// * (shape.scaleX || 1),
        height:   _h,// * (shape.scaleY || 1)
        angle: 0
      };
    }*/

    this._fabric_shape.set(options);

    this.updateStroke();
    this.canvas && this.canvas.renderAll();
  },
  _set_shape: function _set_shape(shape) {

    if (this._fabric_shape) {
      this.remove(this._fabric_shape);
      delete this._fabric_shape;
    }
    var _fabric_shape;
    var _options = {
      fill: "transparent",
      strokeDashArray: this.shape.dashArray
    };

    if (!shape) {
      shape = {};
    }

    this.shape = shape;

    if (shape.paths) {

      for (var i in shape.paths) {
        shape.paths[i].set(_options);
      }

      _fabric_shape = fabric.util.groupSVGElements(shape.paths, shape);
      //
      // _fabric_shape.set({
      //   width: this.width,
      //   height: this.height
      // });

      //this._objects.unshift(this._objects.pop());
    } else {
      var path;

      if (shape.radius) {
        path = fabric.util.getRadiusClipPath(shape.radius, shape.radius_units, this.width, this.height);
        _fabric_shape = new fabric.Path(path, _options);
      } else if (shape.path) {
        _fabric_shape = new fabric.Path(shape.path, _options);
        //} else if(shape.offsets){
        //  path = fabric.util.getOffsetsClipPath(shape.offsets, shape.offsets_units)
      } else {

        if (!shape.width) {
          shape.width = 100;
        }
        if (!shape.height) {
          shape.height = 100;
        }
        path = "M 0 0 L " + shape.width + " 0 L " + shape.width + " " + shape.height + " L 0 " + shape.height + " z";

        _fabric_shape = new fabric.Path(path, _options);
        //
        //_fabric_shape =  new fabric.Rect(fabric.util.object.extend({
        //  width:            100,
        //  height:           100
        //},shape));
      }
    }

    _fabric_shape.set({
      scaleX: this.width / _fabric_shape.width,
      scaleY: this.height / _fabric_shape.height,
      perPixelTargetFind: true,
      selectable: false,
      originX: "left",
      originY: "top"
    });

    this._fabric_shape = _fabric_shape;

    if (this.element) {
      this.element.setClipTo(this._fabric_shape);
    }

    this.updateStroke();
  },

  updateStroke: function updateStroke() {

    var _stroke = this.shape.stroke;
    var _sw = 0;
    if ((this._activated || this._clipmode) && this.shape.strokeWidthActive) {
      _sw = this.shape.strokeWidthActive;
    } else if (this.element && this.shape.strokeWidthFull) {
      _sw = this.shape.strokeWidthFull;
    } else if (!this.element && this.shape.strokeWidthEmpty) {
      _sw = this.shape.strokeWidthEmpty;
    }
    if ((this._activated || this._clipmode) && this.shape.strokeActive) {
      _stroke = this.shape.strokeActive;
    } else if (this.element && this.shape.strokeFull) {
      _stroke = this.shape.strokeFull;
    } else if (!this.element && this.shape.strokeEmpty) {
      _stroke = this.shape.strokeEmpty;
    }

    var _strokeWidth = _sw / Math.max(this._fabric_shape.scaleX, this._fabric_shape.scaleY);

    if (this.shape) {
      if (this.shape.paths) {
        for (var i in this._fabric_shape.paths) {
          this._fabric_shape.paths[i].setStrokeWidth(_strokeWidth);
          this._fabric_shape.paths[i].setStroke(_stroke);
        }
      } else {
        this._fabric_shape.setStrokeWidth(_strokeWidth);
        this._fabric_shape.setStroke(_stroke);
      }
    }
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function activate() {
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function deactivate() {
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 60 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(61);

fabric.Barcode = fabric.util.createClass(fabric.Image, {
  type: 'barcode',
  storeProperties: fabric.Object.prototype.storeProperties,
  stateProperties: fabric.Image.prototype.stateProperties.concat(["text"]),
  correctLevel: QRCode.CorrectLevel.L,
  setText: function setText(text) {
    this.text = text;
    this.qrcode = new QRCode({ correctLevel: this.correctLevel });
    this._element = this.qrcode.makeCode(text);
    this.dirty = true;
    this.canvas.renderAll();
    return this;
  },
  setCorrectLevel: function setCorrectLevel() {
    this.qrcode = new QRCode({ correctLevel: this.correctLevel });
    return this;
  },
  initialize: function initialize(options) {
    this.setCorrectLevel(new QRCode({ correctLevel: this.correctLevel || options.correctLevel }));
    var image = this.qrcode.makeCode(options.text);
    this.text = options.text;
    delete options.text;

    this.callSuper('initialize', image, options);
  }
});
fabric.Barcode.fromObject = function (object) {
  return new fabric.Barcode(object);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 61 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * @fileoverview
 * - Using the 'QRCode for Javascript library'
 * - Fixed dataset of 'QRCode for Javascript library' for support full-spec.
 * - this library has no dependencies.
 *
 * @author davidshimjs
 * @see <a href="http://www.d-project.com/" target="_blank">http://www.d-project.com/</a>
 * @see <a href="http://jeromeetienne.github.com/jquery-qrcode/" target="_blank">http://jeromeetienne.github.com/jquery-qrcode/</a>
 */
window.QRCode = function () {
  var QRCode;
  //---------------------------------------------------------------------
  // QRCode for JavaScript
  //
  // Copyright (c) 2009 Kazuhiko Arase
  //
  // URL: http://www.d-project.com/
  //
  // Licensed under the MIT license:
  //   http://www.opensource.org/licenses/mit-license.php
  //
  // The word "QR Code" is registered trademark of
  // DENSO WAVE INCORPORATED
  //   http://www.denso-wave.com/qrcode/faqpatent-e.html
  //
  //---------------------------------------------------------------------
  function QR8bitByte(data) {
    this.mode = QRMode.MODE_8BIT_BYTE;
    this.data = data;
    this.parsedData = [];

    // Added to support UTF-8 Characters
    for (var i = 0, l = this.data.length; i < l; i++) {
      var byteArray = [];
      var code = this.data.charCodeAt(i);

      if (code > 0x10000) {
        byteArray[0] = 0xF0 | (code & 0x1C0000) >>> 18;
        byteArray[1] = 0x80 | (code & 0x3F000) >>> 12;
        byteArray[2] = 0x80 | (code & 0xFC0) >>> 6;
        byteArray[3] = 0x80 | code & 0x3F;
      } else if (code > 0x800) {
        byteArray[0] = 0xE0 | (code & 0xF000) >>> 12;
        byteArray[1] = 0x80 | (code & 0xFC0) >>> 6;
        byteArray[2] = 0x80 | code & 0x3F;
      } else if (code > 0x80) {
        byteArray[0] = 0xC0 | (code & 0x7C0) >>> 6;
        byteArray[1] = 0x80 | code & 0x3F;
      } else {
        byteArray[0] = code;
      }

      this.parsedData.push(byteArray);
    }

    this.parsedData = Array.prototype.concat.apply([], this.parsedData);

    if (this.parsedData.length != this.data.length) {
      this.parsedData.unshift(191);
      this.parsedData.unshift(187);
      this.parsedData.unshift(239);
    }
  }

  QR8bitByte.prototype = {
    getLength: function getLength(buffer) {
      return this.parsedData.length;
    },
    write: function write(buffer) {
      for (var i = 0, l = this.parsedData.length; i < l; i++) {
        buffer.put(this.parsedData[i], 8);
      }
    }
  };

  function QRCodeModel(typeNumber, errorCorrectLevel) {
    this.typeNumber = typeNumber;
    this.errorCorrectLevel = errorCorrectLevel;
    this.modules = null;
    this.moduleCount = 0;
    this.dataCache = null;
    this.dataList = [];
  }

  QRCodeModel.prototype = {
    addData: function addData(data) {
      var newData = new QR8bitByte(data);
      this.dataList.push(newData);
      this.dataCache = null;
    }, isDark: function isDark(row, col) {
      if (row < 0 || this.moduleCount <= row || col < 0 || this.moduleCount <= col) {
        throw new Error(row + "," + col);
      }
      return this.modules[row][col];
    }, getModuleCount: function getModuleCount() {
      return this.moduleCount;
    }, make: function make() {
      this.makeImpl(false, this.getBestMaskPattern());
    }, makeImpl: function makeImpl(test, maskPattern) {
      this.moduleCount = this.typeNumber * 4 + 17;
      this.modules = new Array(this.moduleCount);
      for (var row = 0; row < this.moduleCount; row++) {
        this.modules[row] = new Array(this.moduleCount);
        for (var col = 0; col < this.moduleCount; col++) {
          this.modules[row][col] = null;
        }
      }
      this.setupPositionProbePattern(0, 0);
      this.setupPositionProbePattern(this.moduleCount - 7, 0);
      this.setupPositionProbePattern(0, this.moduleCount - 7);
      this.setupPositionAdjustPattern();
      this.setupTimingPattern();
      this.setupTypeInfo(test, maskPattern);
      if (this.typeNumber >= 7) {
        this.setupTypeNumber(test);
      }
      if (this.dataCache == null) {
        this.dataCache = QRCodeModel.createData(this.typeNumber, this.errorCorrectLevel, this.dataList);
      }
      this.mapData(this.dataCache, maskPattern);
    }, setupPositionProbePattern: function setupPositionProbePattern(row, col) {
      for (var r = -1; r <= 7; r++) {
        if (row + r <= -1 || this.moduleCount <= row + r) continue;
        for (var c = -1; c <= 7; c++) {
          if (col + c <= -1 || this.moduleCount <= col + c) continue;
          if (0 <= r && r <= 6 && (c == 0 || c == 6) || 0 <= c && c <= 6 && (r == 0 || r == 6) || 2 <= r && r <= 4 && 2 <= c && c <= 4) {
            this.modules[row + r][col + c] = true;
          } else {
            this.modules[row + r][col + c] = false;
          }
        }
      }
    }, getBestMaskPattern: function getBestMaskPattern() {
      var minLostPoint = 0;
      var pattern = 0;
      for (var i = 0; i < 8; i++) {
        this.makeImpl(true, i);
        var lostPoint = QRUtil.getLostPoint(this);
        if (i == 0 || minLostPoint > lostPoint) {
          minLostPoint = lostPoint;
          pattern = i;
        }
      }
      return pattern;
    }, createMovieClip: function createMovieClip(target_mc, instance_name, depth) {
      var qr_mc = target_mc.createEmptyMovieClip(instance_name, depth);
      var cs = 1;
      this.make();
      for (var row = 0; row < this.modules.length; row++) {
        var y = row * cs;
        for (var col = 0; col < this.modules[row].length; col++) {
          var x = col * cs;
          var dark = this.modules[row][col];
          if (dark) {
            qr_mc.beginFill(0, 100);
            qr_mc.moveTo(x, y);
            qr_mc.lineTo(x + cs, y);
            qr_mc.lineTo(x + cs, y + cs);
            qr_mc.lineTo(x, y + cs);
            qr_mc.endFill();
          }
        }
      }
      return qr_mc;
    }, setupTimingPattern: function setupTimingPattern() {
      for (var r = 8; r < this.moduleCount - 8; r++) {
        if (this.modules[r][6] != null) {
          continue;
        }
        this.modules[r][6] = r % 2 == 0;
      }
      for (var c = 8; c < this.moduleCount - 8; c++) {
        if (this.modules[6][c] != null) {
          continue;
        }
        this.modules[6][c] = c % 2 == 0;
      }
    }, setupPositionAdjustPattern: function setupPositionAdjustPattern() {
      var pos = QRUtil.getPatternPosition(this.typeNumber);
      for (var i = 0; i < pos.length; i++) {
        for (var j = 0; j < pos.length; j++) {
          var row = pos[i];
          var col = pos[j];
          if (this.modules[row][col] != null) {
            continue;
          }
          for (var r = -2; r <= 2; r++) {
            for (var c = -2; c <= 2; c++) {
              if (r == -2 || r == 2 || c == -2 || c == 2 || r == 0 && c == 0) {
                this.modules[row + r][col + c] = true;
              } else {
                this.modules[row + r][col + c] = false;
              }
            }
          }
        }
      }
    }, setupTypeNumber: function setupTypeNumber(test) {
      var bits = QRUtil.getBCHTypeNumber(this.typeNumber);
      for (var i = 0; i < 18; i++) {
        var mod = !test && (bits >> i & 1) == 1;
        this.modules[Math.floor(i / 3)][i % 3 + this.moduleCount - 8 - 3] = mod;
      }
      for (var i = 0; i < 18; i++) {
        var mod = !test && (bits >> i & 1) == 1;
        this.modules[i % 3 + this.moduleCount - 8 - 3][Math.floor(i / 3)] = mod;
      }
    }, setupTypeInfo: function setupTypeInfo(test, maskPattern) {
      var data = this.errorCorrectLevel << 3 | maskPattern;
      var bits = QRUtil.getBCHTypeInfo(data);
      for (var i = 0; i < 15; i++) {
        var mod = !test && (bits >> i & 1) == 1;
        if (i < 6) {
          this.modules[i][8] = mod;
        } else if (i < 8) {
          this.modules[i + 1][8] = mod;
        } else {
          this.modules[this.moduleCount - 15 + i][8] = mod;
        }
      }
      for (var i = 0; i < 15; i++) {
        var mod = !test && (bits >> i & 1) == 1;
        if (i < 8) {
          this.modules[8][this.moduleCount - i - 1] = mod;
        } else if (i < 9) {
          this.modules[8][15 - i - 1 + 1] = mod;
        } else {
          this.modules[8][15 - i - 1] = mod;
        }
      }
      this.modules[this.moduleCount - 8][8] = !test;
    }, mapData: function mapData(data, maskPattern) {
      var inc = -1;
      var row = this.moduleCount - 1;
      var bitIndex = 7;
      var byteIndex = 0;
      for (var col = this.moduleCount - 1; col > 0; col -= 2) {
        if (col == 6) col--;
        while (true) {
          for (var c = 0; c < 2; c++) {
            if (this.modules[row][col - c] == null) {
              var dark = false;
              if (byteIndex < data.length) {
                dark = (data[byteIndex] >>> bitIndex & 1) == 1;
              }
              var mask = QRUtil.getMask(maskPattern, row, col - c);
              if (mask) {
                dark = !dark;
              }
              this.modules[row][col - c] = dark;
              bitIndex--;
              if (bitIndex == -1) {
                byteIndex++;
                bitIndex = 7;
              }
            }
          }
          row += inc;
          if (row < 0 || this.moduleCount <= row) {
            row -= inc;
            inc = -inc;
            break;
          }
        }
      }
    }
  };
  QRCodeModel.PAD0 = 0xEC;
  QRCodeModel.PAD1 = 0x11;
  QRCodeModel.createData = function (typeNumber, errorCorrectLevel, dataList) {
    var rsBlocks = QRRSBlock.getRSBlocks(typeNumber, errorCorrectLevel);
    var buffer = new QRBitBuffer();
    for (var i = 0; i < dataList.length; i++) {
      var data = dataList[i];
      buffer.put(data.mode, 4);
      buffer.put(data.getLength(), QRUtil.getLengthInBits(data.mode, typeNumber));
      data.write(buffer);
    }
    var totalDataCount = 0;
    for (var i = 0; i < rsBlocks.length; i++) {
      totalDataCount += rsBlocks[i].dataCount;
    }
    if (buffer.getLengthInBits() > totalDataCount * 8) {
      throw new Error("code length overflow. (" + buffer.getLengthInBits() + ">" + totalDataCount * 8 + ")");
    }
    if (buffer.getLengthInBits() + 4 <= totalDataCount * 8) {
      buffer.put(0, 4);
    }
    while (buffer.getLengthInBits() % 8 != 0) {
      buffer.putBit(false);
    }
    while (true) {
      if (buffer.getLengthInBits() >= totalDataCount * 8) {
        break;
      }
      buffer.put(QRCodeModel.PAD0, 8);
      if (buffer.getLengthInBits() >= totalDataCount * 8) {
        break;
      }
      buffer.put(QRCodeModel.PAD1, 8);
    }
    return QRCodeModel.createBytes(buffer, rsBlocks);
  };
  QRCodeModel.createBytes = function (buffer, rsBlocks) {
    var offset = 0;
    var maxDcCount = 0;
    var maxEcCount = 0;
    var dcdata = new Array(rsBlocks.length);
    var ecdata = new Array(rsBlocks.length);
    for (var r = 0; r < rsBlocks.length; r++) {
      var dcCount = rsBlocks[r].dataCount;
      var ecCount = rsBlocks[r].totalCount - dcCount;
      maxDcCount = Math.max(maxDcCount, dcCount);
      maxEcCount = Math.max(maxEcCount, ecCount);
      dcdata[r] = new Array(dcCount);
      for (var i = 0; i < dcdata[r].length; i++) {
        dcdata[r][i] = 0xff & buffer.buffer[i + offset];
      }
      offset += dcCount;
      var rsPoly = QRUtil.getErrorCorrectPolynomial(ecCount);
      var rawPoly = new QRPolynomial(dcdata[r], rsPoly.getLength() - 1);
      var modPoly = rawPoly.mod(rsPoly);
      ecdata[r] = new Array(rsPoly.getLength() - 1);
      for (var i = 0; i < ecdata[r].length; i++) {
        var modIndex = i + modPoly.getLength() - ecdata[r].length;
        ecdata[r][i] = modIndex >= 0 ? modPoly.get(modIndex) : 0;
      }
    }
    var totalCodeCount = 0;
    for (var i = 0; i < rsBlocks.length; i++) {
      totalCodeCount += rsBlocks[i].totalCount;
    }
    var data = new Array(totalCodeCount);
    var index = 0;
    for (var i = 0; i < maxDcCount; i++) {
      for (var r = 0; r < rsBlocks.length; r++) {
        if (i < dcdata[r].length) {
          data[index++] = dcdata[r][i];
        }
      }
    }
    for (var i = 0; i < maxEcCount; i++) {
      for (var r = 0; r < rsBlocks.length; r++) {
        if (i < ecdata[r].length) {
          data[index++] = ecdata[r][i];
        }
      }
    }
    return data;
  };
  var QRMode = { MODE_NUMBER: 1 << 0, MODE_ALPHA_NUM: 1 << 1, MODE_8BIT_BYTE: 1 << 2, MODE_KANJI: 1 << 3 };
  var QRErrorCorrectLevel = { L: 1, M: 0, Q: 3, H: 2 };
  var QRMaskPattern = {
    PATTERN000: 0,
    PATTERN001: 1,
    PATTERN010: 2,
    PATTERN011: 3,
    PATTERN100: 4,
    PATTERN101: 5,
    PATTERN110: 6,
    PATTERN111: 7
  };
  var QRUtil = {
    PATTERN_POSITION_TABLE: [[], [6, 18], [6, 22], [6, 26], [6, 30], [6, 34], [6, 22, 38], [6, 24, 42], [6, 26, 46], [6, 28, 50], [6, 30, 54], [6, 32, 58], [6, 34, 62], [6, 26, 46, 66], [6, 26, 48, 70], [6, 26, 50, 74], [6, 30, 54, 78], [6, 30, 56, 82], [6, 30, 58, 86], [6, 34, 62, 90], [6, 28, 50, 72, 94], [6, 26, 50, 74, 98], [6, 30, 54, 78, 102], [6, 28, 54, 80, 106], [6, 32, 58, 84, 110], [6, 30, 58, 86, 114], [6, 34, 62, 90, 118], [6, 26, 50, 74, 98, 122], [6, 30, 54, 78, 102, 126], [6, 26, 52, 78, 104, 130], [6, 30, 56, 82, 108, 134], [6, 34, 60, 86, 112, 138], [6, 30, 58, 86, 114, 142], [6, 34, 62, 90, 118, 146], [6, 30, 54, 78, 102, 126, 150], [6, 24, 50, 76, 102, 128, 154], [6, 28, 54, 80, 106, 132, 158], [6, 32, 58, 84, 110, 136, 162], [6, 26, 54, 82, 110, 138, 166], [6, 30, 58, 86, 114, 142, 170]],
    G15: 1 << 10 | 1 << 8 | 1 << 5 | 1 << 4 | 1 << 2 | 1 << 1 | 1 << 0,
    G18: 1 << 12 | 1 << 11 | 1 << 10 | 1 << 9 | 1 << 8 | 1 << 5 | 1 << 2 | 1 << 0,
    G15_MASK: 1 << 14 | 1 << 12 | 1 << 10 | 1 << 4 | 1 << 1,
    getBCHTypeInfo: function getBCHTypeInfo(data) {
      var d = data << 10;
      while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15) >= 0) {
        d ^= QRUtil.G15 << QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15);
      }
      return (data << 10 | d) ^ QRUtil.G15_MASK;
    },
    getBCHTypeNumber: function getBCHTypeNumber(data) {
      var d = data << 12;
      while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18) >= 0) {
        d ^= QRUtil.G18 << QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18);
      }
      return data << 12 | d;
    },
    getBCHDigit: function getBCHDigit(data) {
      var digit = 0;
      while (data != 0) {
        digit++;
        data >>>= 1;
      }
      return digit;
    },
    getPatternPosition: function getPatternPosition(typeNumber) {
      return QRUtil.PATTERN_POSITION_TABLE[typeNumber - 1];
    },
    getMask: function getMask(maskPattern, i, j) {
      switch (maskPattern) {
        case QRMaskPattern.PATTERN000:
          return (i + j) % 2 == 0;
        case QRMaskPattern.PATTERN001:
          return i % 2 == 0;
        case QRMaskPattern.PATTERN010:
          return j % 3 == 0;
        case QRMaskPattern.PATTERN011:
          return (i + j) % 3 == 0;
        case QRMaskPattern.PATTERN100:
          return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 == 0;
        case QRMaskPattern.PATTERN101:
          return i * j % 2 + i * j % 3 == 0;
        case QRMaskPattern.PATTERN110:
          return (i * j % 2 + i * j % 3) % 2 == 0;
        case QRMaskPattern.PATTERN111:
          return (i * j % 3 + (i + j) % 2) % 2 == 0;
        default:
          throw new Error("bad maskPattern:" + maskPattern);
      }
    },
    getErrorCorrectPolynomial: function getErrorCorrectPolynomial(errorCorrectLength) {
      var a = new QRPolynomial([1], 0);
      for (var i = 0; i < errorCorrectLength; i++) {
        a = a.multiply(new QRPolynomial([1, QRMath.gexp(i)], 0));
      }
      return a;
    },
    getLengthInBits: function getLengthInBits(mode, type) {
      if (1 <= type && type < 10) {
        switch (mode) {
          case QRMode.MODE_NUMBER:
            return 10;
          case QRMode.MODE_ALPHA_NUM:
            return 9;
          case QRMode.MODE_8BIT_BYTE:
            return 8;
          case QRMode.MODE_KANJI:
            return 8;
          default:
            throw new Error("mode:" + mode);
        }
      } else if (type < 27) {
        switch (mode) {
          case QRMode.MODE_NUMBER:
            return 12;
          case QRMode.MODE_ALPHA_NUM:
            return 11;
          case QRMode.MODE_8BIT_BYTE:
            return 16;
          case QRMode.MODE_KANJI:
            return 10;
          default:
            throw new Error("mode:" + mode);
        }
      } else if (type < 41) {
        switch (mode) {
          case QRMode.MODE_NUMBER:
            return 14;
          case QRMode.MODE_ALPHA_NUM:
            return 13;
          case QRMode.MODE_8BIT_BYTE:
            return 16;
          case QRMode.MODE_KANJI:
            return 12;
          default:
            throw new Error("mode:" + mode);
        }
      } else {
        throw new Error("type:" + type);
      }
    },
    getLostPoint: function getLostPoint(qrCode) {
      var moduleCount = qrCode.getModuleCount();
      var lostPoint = 0;
      for (var row = 0; row < moduleCount; row++) {
        for (var col = 0; col < moduleCount; col++) {
          var sameCount = 0;
          var dark = qrCode.isDark(row, col);
          for (var r = -1; r <= 1; r++) {
            if (row + r < 0 || moduleCount <= row + r) {
              continue;
            }
            for (var c = -1; c <= 1; c++) {
              if (col + c < 0 || moduleCount <= col + c) {
                continue;
              }
              if (r == 0 && c == 0) {
                continue;
              }
              if (dark == qrCode.isDark(row + r, col + c)) {
                sameCount++;
              }
            }
          }
          if (sameCount > 5) {
            lostPoint += 3 + sameCount - 5;
          }
        }
      }
      for (var row = 0; row < moduleCount - 1; row++) {
        for (var col = 0; col < moduleCount - 1; col++) {
          var count = 0;
          if (qrCode.isDark(row, col)) count++;
          if (qrCode.isDark(row + 1, col)) count++;
          if (qrCode.isDark(row, col + 1)) count++;
          if (qrCode.isDark(row + 1, col + 1)) count++;
          if (count == 0 || count == 4) {
            lostPoint += 3;
          }
        }
      }
      for (var row = 0; row < moduleCount; row++) {
        for (var col = 0; col < moduleCount - 6; col++) {
          if (qrCode.isDark(row, col) && !qrCode.isDark(row, col + 1) && qrCode.isDark(row, col + 2) && qrCode.isDark(row, col + 3) && qrCode.isDark(row, col + 4) && !qrCode.isDark(row, col + 5) && qrCode.isDark(row, col + 6)) {
            lostPoint += 40;
          }
        }
      }
      for (var col = 0; col < moduleCount; col++) {
        for (var row = 0; row < moduleCount - 6; row++) {
          if (qrCode.isDark(row, col) && !qrCode.isDark(row + 1, col) && qrCode.isDark(row + 2, col) && qrCode.isDark(row + 3, col) && qrCode.isDark(row + 4, col) && !qrCode.isDark(row + 5, col) && qrCode.isDark(row + 6, col)) {
            lostPoint += 40;
          }
        }
      }
      var darkCount = 0;
      for (var col = 0; col < moduleCount; col++) {
        for (var row = 0; row < moduleCount; row++) {
          if (qrCode.isDark(row, col)) {
            darkCount++;
          }
        }
      }
      var ratio = Math.abs(100 * darkCount / moduleCount / moduleCount - 50) / 5;
      lostPoint += ratio * 10;
      return lostPoint;
    }
  };
  var QRMath = {
    glog: function glog(n) {
      if (n < 1) {
        throw new Error("glog(" + n + ")");
      }
      return QRMath.LOG_TABLE[n];
    }, gexp: function gexp(n) {
      while (n < 0) {
        n += 255;
      }
      while (n >= 256) {
        n -= 255;
      }
      return QRMath.EXP_TABLE[n];
    }, EXP_TABLE: new Array(256), LOG_TABLE: new Array(256)
  };
  for (var i = 0; i < 8; i++) {
    QRMath.EXP_TABLE[i] = 1 << i;
  }
  for (var i = 8; i < 256; i++) {
    QRMath.EXP_TABLE[i] = QRMath.EXP_TABLE[i - 4] ^ QRMath.EXP_TABLE[i - 5] ^ QRMath.EXP_TABLE[i - 6] ^ QRMath.EXP_TABLE[i - 8];
  }
  for (var i = 0; i < 255; i++) {
    QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]] = i;
  }

  function QRPolynomial(num, shift) {
    if (num.length == undefined) {
      throw new Error(num.length + "/" + shift);
    }
    var offset = 0;
    while (offset < num.length && num[offset] == 0) {
      offset++;
    }
    this.num = new Array(num.length - offset + shift);
    for (var i = 0; i < num.length - offset; i++) {
      this.num[i] = num[i + offset];
    }
  }

  QRPolynomial.prototype = {
    get: function get(index) {
      return this.num[index];
    }, getLength: function getLength() {
      return this.num.length;
    }, multiply: function multiply(e) {
      var num = new Array(this.getLength() + e.getLength() - 1);
      for (var i = 0; i < this.getLength(); i++) {
        for (var j = 0; j < e.getLength(); j++) {
          num[i + j] ^= QRMath.gexp(QRMath.glog(this.get(i)) + QRMath.glog(e.get(j)));
        }
      }
      return new QRPolynomial(num, 0);
    }, mod: function mod(e) {
      if (this.getLength() - e.getLength() < 0) {
        return this;
      }
      var ratio = QRMath.glog(this.get(0)) - QRMath.glog(e.get(0));
      var num = new Array(this.getLength());
      for (var i = 0; i < this.getLength(); i++) {
        num[i] = this.get(i);
      }
      for (var i = 0; i < e.getLength(); i++) {
        num[i] ^= QRMath.gexp(QRMath.glog(e.get(i)) + ratio);
      }
      return new QRPolynomial(num, 0).mod(e);
    }
  };

  function QRRSBlock(totalCount, dataCount) {
    this.totalCount = totalCount;
    this.dataCount = dataCount;
  }

  QRRSBlock.RS_BLOCK_TABLE = [[1, 26, 19], [1, 26, 16], [1, 26, 13], [1, 26, 9], [1, 44, 34], [1, 44, 28], [1, 44, 22], [1, 44, 16], [1, 70, 55], [1, 70, 44], [2, 35, 17], [2, 35, 13], [1, 100, 80], [2, 50, 32], [2, 50, 24], [4, 25, 9], [1, 134, 108], [2, 67, 43], [2, 33, 15, 2, 34, 16], [2, 33, 11, 2, 34, 12], [2, 86, 68], [4, 43, 27], [4, 43, 19], [4, 43, 15], [2, 98, 78], [4, 49, 31], [2, 32, 14, 4, 33, 15], [4, 39, 13, 1, 40, 14], [2, 121, 97], [2, 60, 38, 2, 61, 39], [4, 40, 18, 2, 41, 19], [4, 40, 14, 2, 41, 15], [2, 146, 116], [3, 58, 36, 2, 59, 37], [4, 36, 16, 4, 37, 17], [4, 36, 12, 4, 37, 13], [2, 86, 68, 2, 87, 69], [4, 69, 43, 1, 70, 44], [6, 43, 19, 2, 44, 20], [6, 43, 15, 2, 44, 16], [4, 101, 81], [1, 80, 50, 4, 81, 51], [4, 50, 22, 4, 51, 23], [3, 36, 12, 8, 37, 13], [2, 116, 92, 2, 117, 93], [6, 58, 36, 2, 59, 37], [4, 46, 20, 6, 47, 21], [7, 42, 14, 4, 43, 15], [4, 133, 107], [8, 59, 37, 1, 60, 38], [8, 44, 20, 4, 45, 21], [12, 33, 11, 4, 34, 12], [3, 145, 115, 1, 146, 116], [4, 64, 40, 5, 65, 41], [11, 36, 16, 5, 37, 17], [11, 36, 12, 5, 37, 13], [5, 109, 87, 1, 110, 88], [5, 65, 41, 5, 66, 42], [5, 54, 24, 7, 55, 25], [11, 36, 12], [5, 122, 98, 1, 123, 99], [7, 73, 45, 3, 74, 46], [15, 43, 19, 2, 44, 20], [3, 45, 15, 13, 46, 16], [1, 135, 107, 5, 136, 108], [10, 74, 46, 1, 75, 47], [1, 50, 22, 15, 51, 23], [2, 42, 14, 17, 43, 15], [5, 150, 120, 1, 151, 121], [9, 69, 43, 4, 70, 44], [17, 50, 22, 1, 51, 23], [2, 42, 14, 19, 43, 15], [3, 141, 113, 4, 142, 114], [3, 70, 44, 11, 71, 45], [17, 47, 21, 4, 48, 22], [9, 39, 13, 16, 40, 14], [3, 135, 107, 5, 136, 108], [3, 67, 41, 13, 68, 42], [15, 54, 24, 5, 55, 25], [15, 43, 15, 10, 44, 16], [4, 144, 116, 4, 145, 117], [17, 68, 42], [17, 50, 22, 6, 51, 23], [19, 46, 16, 6, 47, 17], [2, 139, 111, 7, 140, 112], [17, 74, 46], [7, 54, 24, 16, 55, 25], [34, 37, 13], [4, 151, 121, 5, 152, 122], [4, 75, 47, 14, 76, 48], [11, 54, 24, 14, 55, 25], [16, 45, 15, 14, 46, 16], [6, 147, 117, 4, 148, 118], [6, 73, 45, 14, 74, 46], [11, 54, 24, 16, 55, 25], [30, 46, 16, 2, 47, 17], [8, 132, 106, 4, 133, 107], [8, 75, 47, 13, 76, 48], [7, 54, 24, 22, 55, 25], [22, 45, 15, 13, 46, 16], [10, 142, 114, 2, 143, 115], [19, 74, 46, 4, 75, 47], [28, 50, 22, 6, 51, 23], [33, 46, 16, 4, 47, 17], [8, 152, 122, 4, 153, 123], [22, 73, 45, 3, 74, 46], [8, 53, 23, 26, 54, 24], [12, 45, 15, 28, 46, 16], [3, 147, 117, 10, 148, 118], [3, 73, 45, 23, 74, 46], [4, 54, 24, 31, 55, 25], [11, 45, 15, 31, 46, 16], [7, 146, 116, 7, 147, 117], [21, 73, 45, 7, 74, 46], [1, 53, 23, 37, 54, 24], [19, 45, 15, 26, 46, 16], [5, 145, 115, 10, 146, 116], [19, 75, 47, 10, 76, 48], [15, 54, 24, 25, 55, 25], [23, 45, 15, 25, 46, 16], [13, 145, 115, 3, 146, 116], [2, 74, 46, 29, 75, 47], [42, 54, 24, 1, 55, 25], [23, 45, 15, 28, 46, 16], [17, 145, 115], [10, 74, 46, 23, 75, 47], [10, 54, 24, 35, 55, 25], [19, 45, 15, 35, 46, 16], [17, 145, 115, 1, 146, 116], [14, 74, 46, 21, 75, 47], [29, 54, 24, 19, 55, 25], [11, 45, 15, 46, 46, 16], [13, 145, 115, 6, 146, 116], [14, 74, 46, 23, 75, 47], [44, 54, 24, 7, 55, 25], [59, 46, 16, 1, 47, 17], [12, 151, 121, 7, 152, 122], [12, 75, 47, 26, 76, 48], [39, 54, 24, 14, 55, 25], [22, 45, 15, 41, 46, 16], [6, 151, 121, 14, 152, 122], [6, 75, 47, 34, 76, 48], [46, 54, 24, 10, 55, 25], [2, 45, 15, 64, 46, 16], [17, 152, 122, 4, 153, 123], [29, 74, 46, 14, 75, 47], [49, 54, 24, 10, 55, 25], [24, 45, 15, 46, 46, 16], [4, 152, 122, 18, 153, 123], [13, 74, 46, 32, 75, 47], [48, 54, 24, 14, 55, 25], [42, 45, 15, 32, 46, 16], [20, 147, 117, 4, 148, 118], [40, 75, 47, 7, 76, 48], [43, 54, 24, 22, 55, 25], [10, 45, 15, 67, 46, 16], [19, 148, 118, 6, 149, 119], [18, 75, 47, 31, 76, 48], [34, 54, 24, 34, 55, 25], [20, 45, 15, 61, 46, 16]];
  QRRSBlock.getRSBlocks = function (typeNumber, errorCorrectLevel) {
    var rsBlock = QRRSBlock.getRsBlockTable(typeNumber, errorCorrectLevel);
    if (rsBlock == undefined) {
      throw new Error("bad rs block @ typeNumber:" + typeNumber + "/errorCorrectLevel:" + errorCorrectLevel);
    }
    var length = rsBlock.length / 3;
    var list = [];
    for (var i = 0; i < length; i++) {
      var count = rsBlock[i * 3 + 0];
      var totalCount = rsBlock[i * 3 + 1];
      var dataCount = rsBlock[i * 3 + 2];
      for (var j = 0; j < count; j++) {
        list.push(new QRRSBlock(totalCount, dataCount));
      }
    }
    return list;
  };
  QRRSBlock.getRsBlockTable = function (typeNumber, errorCorrectLevel) {
    switch (errorCorrectLevel) {
      case QRErrorCorrectLevel.L:
        return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 0];
      case QRErrorCorrectLevel.M:
        return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 1];
      case QRErrorCorrectLevel.Q:
        return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 2];
      case QRErrorCorrectLevel.H:
        return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 3];
      default:
        return undefined;
    }
  };

  function QRBitBuffer() {
    this.buffer = [];
    this.length = 0;
  }

  QRBitBuffer.prototype = {
    get: function get(index) {
      var bufIndex = Math.floor(index / 8);
      return (this.buffer[bufIndex] >>> 7 - index % 8 & 1) == 1;
    }, put: function put(num, length) {
      for (var i = 0; i < length; i++) {
        this.putBit((num >>> length - i - 1 & 1) == 1);
      }
    }, getLengthInBits: function getLengthInBits() {
      return this.length;
    }, putBit: function putBit(bit) {
      var bufIndex = Math.floor(this.length / 8);
      if (this.buffer.length <= bufIndex) {
        this.buffer.push(0);
      }
      if (bit) {
        this.buffer[bufIndex] |= 0x80 >>> this.length % 8;
      }
      this.length++;
    }
  };
  var QRCodeLimitLength = [[17, 14, 11, 7], [32, 26, 20, 14], [53, 42, 32, 24], [78, 62, 46, 34], [106, 84, 60, 44], [134, 106, 74, 58], [154, 122, 86, 64], [192, 152, 108, 84], [230, 180, 130, 98], [271, 213, 151, 119], [321, 251, 177, 137], [367, 287, 203, 155], [425, 331, 241, 177], [458, 362, 258, 194], [520, 412, 292, 220], [586, 450, 322, 250], [644, 504, 364, 280], [718, 560, 394, 310], [792, 624, 442, 338], [858, 666, 482, 382], [929, 711, 509, 403], [1003, 779, 565, 439], [1091, 857, 611, 461], [1171, 911, 661, 511], [1273, 997, 715, 535], [1367, 1059, 751, 593], [1465, 1125, 805, 625], [1528, 1190, 868, 658], [1628, 1264, 908, 698], [1732, 1370, 982, 742], [1840, 1452, 1030, 790], [1952, 1538, 1112, 842], [2068, 1628, 1168, 898], [2188, 1722, 1228, 958], [2303, 1809, 1283, 983], [2431, 1911, 1351, 1051], [2563, 1989, 1423, 1093], [2699, 2099, 1499, 1139], [2809, 2213, 1579, 1219], [2953, 2331, 1663, 1273]];

  function _isSupportCanvas() {
    return typeof CanvasRenderingContext2D != "undefined";
  }

  // android 2.x doesn't support Data-URI spec
  function _getAndroid() {
    var android = false;
    var sAgent = navigator.userAgent;

    if (/android/i.test(sAgent)) {
      // android
      android = true;
      var aMat = sAgent.toString().match(/android ([0-9]\.[0-9])/i);

      if (aMat && aMat[1]) {
        android = parseFloat(aMat[1]);
      }
    }

    return android;
  }

  var svgDrawer = function () {

    var Drawing = function Drawing(htOption) {
      this._htOption = htOption;
    };

    Drawing.prototype.draw = function (oQRCode) {
      var _htOption = this._htOption;
      var nCount = oQRCode.getModuleCount();
      var nWidth = Math.floor(_htOption.width / nCount);
      var nHeight = Math.floor(_htOption.height / nCount);

      this.clear();

      function makeSVG(tag, attrs) {
        var el = document.createElementNS('http://www.w3.org/2000/svg', tag);
        for (var k in attrs) {
          if (attrs.hasOwnProperty(k)) el.setAttribute(k, attrs[k]);
        }return el;
      }

      var svg = makeSVG("svg", {
        'viewBox': '0 0 ' + String(nCount) + " " + String(nCount),
        'width': '100%',
        'height': '100%',
        'fill': _htOption.colorLight
      });
      svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");
      svg.appendChild(makeSVG("rect", { "fill": _htOption.colorLight, "width": "100%", "height": "100%" }));
      svg.appendChild(makeSVG("rect", { "fill": _htOption.colorDark, "width": "1", "height": "1", "id": "template" }));

      for (var row = 0; row < nCount; row++) {
        for (var col = 0; col < nCount; col++) {
          if (oQRCode.isDark(row, col)) {
            var child = makeSVG("use", { "x": String(col), "y": String(row) });
            child.setAttributeNS("http://www.w3.org/1999/xlink", "href", "#template");
            svg.appendChild(child);
          }
        }
      }
      return svg;
    };
    return Drawing;
  }();

  var useSVG = document.documentElement.tagName.toLowerCase() === "svg";

  // Drawing in DOM by using Table tag
  var Drawing = useSVG ? svgDrawer : !_isSupportCanvas() ? function () {
    var Drawing = function Drawing(htOption) {
      this._htOption = htOption;
    };

    /**
     * Draw the QRCode
     *
     * @param {QRCode} oQRCode
     */
    Drawing.prototype.draw = function (oQRCode) {
      var _htOption = this._htOption;
      var nCount = oQRCode.getModuleCount();
      var nWidth = Math.floor(_htOption.width / nCount);
      var nHeight = Math.floor(_htOption.height / nCount);
      var aHTML = ['<table style="border:0;border-collapse:collapse;">'];

      for (var row = 0; row < nCount; row++) {
        aHTML.push('<tr>');

        for (var col = 0; col < nCount; col++) {
          aHTML.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:' + nWidth + 'px;height:' + nHeight + 'px;background-color:' + (oQRCode.isDark(row, col) ? _htOption.colorDark : _htOption.colorLight) + ';"></td>');
        }

        aHTML.push('</tr>');
      }

      aHTML.push('</table>');
      _el.innerHTML = aHTML.join('');

      // Fix the margin values as real size.
      var elTable = _el.childNodes[0];
      var nLeftMarginTable = (_htOption.width - elTable.offsetWidth) / 2;
      var nTopMarginTable = (_htOption.height - elTable.offsetHeight) / 2;

      if (nLeftMarginTable > 0 && nTopMarginTable > 0) {
        elTable.style.margin = nTopMarginTable + "px " + nLeftMarginTable + "px";
      }
    };

    /**
     * Clear the QRCode
     */
    Drawing.prototype.clear = function () {
      this._el.innerHTML = '';
    };

    return Drawing;
  }() : function () {
    // Drawing in Canvas
    function _onMakeImage() {

      this._elCanvas = document.createElement("canvas");
      // this._elImage.src = this._elCanvas.toDataURL("image/png");
      // this._elImage.style.display = "block";
      // this._elCanvas.style.display = "none";
    }

    // Android 2.1 bug workaround
    // http://code.google.com/p/android/issues/detail?id=5141
    if (window._android && window._android <= 2.1) {
      var factor = 1 / window.devicePixelRatio;
      var drawImage = CanvasRenderingContext2D.prototype.drawImage;
      CanvasRenderingContext2D.prototype.drawImage = function (image, sx, sy, sw, sh, dx, dy, dw, dh) {
        if ("nodeName" in image && /img/i.test(image.nodeName)) {
          for (var i = arguments.length - 1; i >= 1; i--) {
            arguments[i] = arguments[i] * factor;
          }
        } else if (typeof dw == "undefined") {
          arguments[1] *= factor;
          arguments[2] *= factor;
          arguments[3] *= factor;
          arguments[4] *= factor;
        }

        drawImage.apply(this, arguments);
      };
    }

    /**
     * Check whether the user's browser supports Data URI or not
     *
     * @private
     * @param {Function} fSuccess Occurs if it supports Data URI
     * @param {Function} fFail Occurs if it doesn't support Data URI
     */
    function _safeSetDataURI(fSuccess, fFail) {
      var self = this;
      self._fFail = fFail;
      self._fSuccess = fSuccess;

      // Check it just once
      if (self._bSupportDataURI === null) {
        var el = document.createElement("img");
        var fOnError = function fOnError() {
          self._bSupportDataURI = false;

          if (self._fFail) {
            self._fFail.call(self);
          }
        };
        var fOnSuccess = function fOnSuccess() {
          self._bSupportDataURI = true;

          if (self._fSuccess) {
            self._fSuccess.call(self);
          }
        };

        el.onabort = fOnError;
        el.onerror = fOnError;
        el.onload = fOnSuccess;
        el.src = "data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=="; // the Image contains 1px data.
        return el;
      } else if (self._bSupportDataURI === true && self._fSuccess) {
        self._fSuccess.call(self);
      } else if (self._bSupportDataURI === false && self._fFail) {
        self._fFail.call(self);
      }
    };

    /**
     * Drawing QRCode by using canvas
     *
     * @constructor
     * @param {Object} htOption QRCode Options
     */
    var Drawing = function Drawing(htOption) {
      this._bIsPainted = false;
      window._android = _getAndroid();

      this._htOption = htOption;
      this._elCanvas = document.createElement("canvas");
      this._elCanvas.width = htOption.width;
      this._elCanvas.height = htOption.height;
      this._oContext = this._elCanvas.getContext("2d");
      this._bIsPainted = false;
      this._elImage = document.createElement("img");
      this._elImage.alt = "Scan me!";
      this._elImage.style.display = "none";
      this._bSupportDataURI = null;
    };

    /**
     * Draw the QRCode
     *
     * @param {QRCode} oQRCode
     */
    Drawing.prototype.draw = function (oQRCode) {
      var _elImage = this._elImage;
      var _oContext = this._oContext;
      var _htOption = this._htOption;

      var nCount = oQRCode.getModuleCount();
      var nWidth = _htOption.width / nCount;
      var nHeight = _htOption.height / nCount;
      var nRoundedWidth = Math.round(nWidth);
      var nRoundedHeight = Math.round(nHeight);

      _elImage.style.display = "none";
      this.clear();

      for (var row = 0; row < nCount; row++) {
        for (var col = 0; col < nCount; col++) {
          var bIsDark = oQRCode.isDark(row, col);
          var nLeft = col * nWidth;
          var nTop = row * nHeight;
          _oContext.strokeStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;
          _oContext.lineWidth = 1;
          _oContext.fillStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;
          _oContext.fillRect(nLeft, nTop, nWidth, nHeight);

          // 안티 앨리어싱 방지 처리
          _oContext.strokeRect(Math.floor(nLeft) + 0.5, Math.floor(nTop) + 0.5, nRoundedWidth, nRoundedHeight);

          _oContext.strokeRect(Math.ceil(nLeft) - 0.5, Math.ceil(nTop) - 0.5, nRoundedWidth, nRoundedHeight);
        }
      }

      this._bIsPainted = true;
    };

    /**
     * Make the image from Canvas if the browser supports Data URI.
     */
    Drawing.prototype.makeImage = function () {
      if (this._bIsPainted) {
        _safeSetDataURI.call(this, _onMakeImage);
      }
      var img = new Image();
      img.src = this._elCanvas.toDataURL();
      return img;
    };

    /**
     * Return whether the QRCode is painted or not
     *
     * @return {Boolean}
     */
    Drawing.prototype.isPainted = function () {
      return this._bIsPainted;
    };

    /**
     * Clear the QRCode
     */
    Drawing.prototype.clear = function () {
      this._oContext.clearRect(0, 0, this._elCanvas.width, this._elCanvas.height);
      this._bIsPainted = false;
    };

    /**
     * @private
     * @param {Number} nNumber
     */
    Drawing.prototype.round = function (nNumber) {
      if (!nNumber) {
        return nNumber;
      }

      return Math.floor(nNumber * 1000) / 1000;
    };

    return Drawing;
  }();

  /**
   * Get the type by string length
   *
   * @private
   * @param {String} sText
   * @param {Number} nCorrectLevel
   * @return {Number} type
   */
  function _getTypeNumber(sText, nCorrectLevel) {
    var nType = 1;
    var length = _getUTF8Length(sText);

    for (var i = 0, len = QRCodeLimitLength.length; i <= len; i++) {
      var nLimit = 0;

      switch (nCorrectLevel) {
        case QRErrorCorrectLevel.L:
          nLimit = QRCodeLimitLength[i][0];
          break;
        case QRErrorCorrectLevel.M:
          nLimit = QRCodeLimitLength[i][1];
          break;
        case QRErrorCorrectLevel.Q:
          nLimit = QRCodeLimitLength[i][2];
          break;
        case QRErrorCorrectLevel.H:
          nLimit = QRCodeLimitLength[i][3];
          break;
      }

      if (length <= nLimit) {
        break;
      } else {
        nType++;
      }
    }

    if (nType > QRCodeLimitLength.length) {
      throw new Error("Too long data");
    }

    return nType;
  }

  function _getUTF8Length(sText) {
    var replacedText = encodeURI(sText).toString().replace(/\%[0-9a-fA-F]{2}/g, 'a');
    return replacedText.length + (replacedText.length != sText ? 3 : 0);
  }

  /**
   * @class QRCode
   * @constructor
   * @example
   * new QRCode(document.getElementById("test"), "http://jindo.dev.naver.com/collie");
   *
   * @example
   * var oQRCode = new QRCode("test", {
  *    text : "http://naver.com",
  *    width : 128,
  *    height : 128
  * });
   *
   * oQRCode.clear(); // Clear the QRCode.
   * oQRCode.makeCode("http://map.naver.com"); // Re-create the QRCode.
   *
   * @param {HTMLElement|String} el target element or 'id' attribute of element.
   * @param {Object|String} vOption
   * @param {String} vOption.text QRCode link data
   * @param {Number} [vOption.width=256]
   * @param {Number} [vOption.height=256]
   * @param {String} [vOption.colorDark="#000000"]
   * @param {String} [vOption.colorLight="#ffffff"]
   * @param {QRCode.CorrectLevel} [vOption.correctLevel=QRCode.CorrectLevel.H] [L|M|Q|H]
   */
  QRCode = function QRCode(vOption) {
    this._htOption = {
      width: 256,
      height: 256,
      typeNumber: 4,
      colorDark: "#000000",
      colorLight: "#ffffff",
      correctLevel: QRErrorCorrectLevel.H
    };

    if (typeof vOption === 'string') {
      vOption = {
        text: vOption
      };
    }

    // Overwrites options
    if (vOption) {
      for (var i in vOption) {
        this._htOption[i] = vOption[i];
      }
    }

    if (this._htOption.useSVG) {
      Drawing = svgDrawer;
    }

    window._android = _getAndroid();
    this._oQRCode = null;
    this._oDrawing = new Drawing(this._htOption);

    if (this._htOption.text) {
      this.makeCode(this._htOption.text);
    }
  };

  /**
   * Make the QRCode
   *
   * @param {String} sText link data
   */
  QRCode.prototype.makeCode = function (sText) {
    this._oQRCode = new QRCodeModel(_getTypeNumber(sText, this._htOption.correctLevel), this._htOption.correctLevel);
    this._oQRCode.addData(sText);
    this._oQRCode.make();
    this._oDrawing.draw(this._oQRCode);
    return this.makeImage();
  };

  /**
   * Make the Image from Canvas element
   * - It occurs automatically
   * - Android below 3 doesn't support Data-URI spec.
   *
   * @private
   */
  QRCode.prototype.makeImage = function () {
    if (typeof this._oDrawing.makeImage == "function" && (!window._android || window._android >= 3)) {
      return this._oDrawing.makeImage();
    }
  };

  /**
   * Clear the QRCode
   */
  QRCode.prototype.clear = function () {
    this._oDrawing.clear();
  };

  /**
   * @name QRCode.CorrectLevel
   */
  QRCode.CorrectLevel = QRErrorCorrectLevel;

  return QRCode;
}();

/***/ }),
/* 62 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Textbox.prototype, {
    stateProperties: fabric.Textbox.prototype.stateProperties.concat(["maxLines", "maxWidth", "fixedWidth", "maxHeight", "easyEdit"]),
    maxLines: 0,
    maxWidth: 0,
    fixedWidth: false,
    maxHeight: 0,
    _longLines: [],
    easyEdit: false,
    setEasyEdit: function setEasyEdit(val) {
        this.easyEdit = val;
        if (val) {
            this._enterEditing = this.enterEditing.bind(this);
            this.on('selected', this._enterEditing);
        } else {
            this.off('selected', this._enterEditing);
            delete this._enterEditing;
        }
    },
    render: function render(ctx) {
        if (this.dirty) {
            this._forceClearCache = true;
            this._textLines = this._splitTextIntoLines(ctx);
            this._updateTextarea();
            this.setCoords();
        }
        this.callSuper("render", ctx);
    },
    _getNewSelectionStartFromOffset: function _getNewSelectionStartFromOffset(mouseOffset, prevWidth, width, index, jlen) {

        var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,
            distanceBtwNextCharAndCursor = width - mouseOffset.x,
            offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ? 0 : 1,
            newSelectionStart = index + offset;

        // if object is horizontally flipped, mirror cursor location from the end
        if (this.flipX) {
            newSelectionStart = jlen - newSelectionStart;
        }

        // the index passed into the function is padded by the amount of lines from _textLines (to account for \n)
        // we need to remove this padding, and pad it by actual lines, and / or spaces that are meant to be there
        var tmp = 0,
            removed = 0,
            _long = 0; //modified @den.ponomarev

        // account for removed characters
        for (var i = 0; i < this._textLines.length; i++) {
            tmp += this._textLines[i].length;
            if (tmp + removed >= newSelectionStart) {
                break;
            }
            //modified @den.ponomarev
            if (this._longLines[i]) {
                newSelectionStart--;
                _long++;
            }

            if (this.text[tmp + removed] === '\n' || this.text[tmp + removed] === ' ') {
                removed++;
            }
        }

        if (newSelectionStart > this.text.length) {
            newSelectionStart = this.text.length;
        }
        //modified @den.ponomarev
        return newSelectionStart - i + removed + _long;
    },
    /**
     * Wraps a line of text using the width of the Textbox and a context.
     * @param {CanvasRenderingContext2D} ctx Context to use for measurements
     * @param {String} text The string of text to split into lines
     * @param {Number} lineIndex
     * @returns {Array} Array of line(s) into which the given text is wrapped
     * to.
     */
    _wrapLine: function _wrapLine(ctx, text, lineIndex) {
        var lineWidth = 0,
            lines = [],
            line = '',
            words = text.split(' '),
            word = '',
            offset = 0,
            infix = ' ',
            wordWidth = 0,
            infixWidth = 0,
            largestWordWidth = 0,
            lineJustStarted = true,
            additionalSpace = this._getWidthOfCharSpacing();

        this._longLines = [];
        var _maxWidth = this.maxWidth || this.fixedWidth && this.width;
        var isLongWord = false;
        for (var i = 0; i < words.length; i++) {
            word = words[i];
            wordWidth = this._measureText(ctx, word, lineIndex, offset);

            var _isLong = _maxWidth && wordWidth > _maxWidth;
            if (_isLong) {
                if (line != '') {
                    lines.push(line);
                    this._longLines.push(isLongWord);
                    isLongWord = false;
                    lineWidth = 0;
                    line = '';
                }

                var _bigWordWidth = 0; // lineWidth + infixWidth;
                for (var k = 0, len = word.length; k < len && _bigWordWidth < _maxWidth - 10; k++) {
                    _bigWordWidth += this._getWidthOfChar(ctx, word[k], lineIndex, k + offset);
                }
                var new_word = word.substring(0, k - 1);
                isLongWord = true;

                words.splice(i, 1, new_word, word.substr(k - 1));
                i--;
                // line ='';
                lineJustStarted = true;
                continue;
            }
            lineWidth += infixWidth + wordWidth - additionalSpace;

            if (lineWidth >= this.width) {
                if (!lineJustStarted) {
                    lines.push(line);
                    this._longLines.push(isLongWord);
                    isLongWord = false;
                    line = '';
                    lineWidth = wordWidth;
                    lineJustStarted = true;
                }
            } else {

                lineWidth += additionalSpace;
            }
            offset += word.length;

            if (!lineJustStarted) {
                line += infix;
            }
            line += word;

            infixWidth = this._measureText(ctx, infix, lineIndex, offset);
            offset++;

            // keep track of largest word
            if (wordWidth > largestWordWidth) {
                largestWordWidth = wordWidth;
            }
            lineJustStarted = false;
        }

        i && lines.push(line);
        this._longLines.push(false);

        if (largestWordWidth > this.dynamicMinWidth) {
            this.dynamicMinWidth = largestWordWidth - additionalSpace;
        }
        return lines;
    },

    /**
     * @private
     * @param {CanvasRenderingContext2D} ctx Context to render on
     */
    _renderText: function _renderText(ctx) {
        this._renderTextFill(ctx);
        this._renderTextStroke(ctx);
        this._renderTextOversize(ctx);
    },
    _renderTextOversize: function _renderTextOversize(ctx) {

        var lineHeight = 0;
        for (var i = 0, len = this._textLines.length; i < len; i++) {

            var lineWidth = this._getLineWidth(ctx, i);
            var lineLeftOffset = this._getLineLeftOffset(lineWidth);
            var heightOfLine = this._getHeightOfLine(ctx, i);

            if (this._longLines[i]) {
                ctx.fillRect(this._getLeftOffset() + lineLeftOffset + lineWidth + 2, this._getTopOffset() + lineHeight + heightOfLine / 2 - 1, 5, this.fontSize / 15);
            }

            lineHeight += heightOfLine;
        }
    },

    insertChar: function insertChar(_char, skipUpdate, styleObject) {
        var isEndOfLine = this.text[this.selectionStart] === '\n';

        var _old_text = this.text;
        var _old_textLines = this._textLines;
        var _old_styleMap = this._styleMap;
        this.text = this.text.slice(0, this.selectionStart) + _char + this.text.slice(this.selectionEnd);
        this._textLines = this._splitTextIntoLines();
        this.insertStyleObjects(_char, isEndOfLine, styleObject);
        this.selectionStart += _char.length;
        this.selectionEnd = this.selectionStart;

        var oversize = false;
        if (this.maxHeight) {
            var _h = 0;
            for (var i = 0; i < this._textLines.length; i++) {
                _h += this._getHeightOfLine(this.ctx, 0);
            }
            if (_h > this.maxHeight) {
                oversize = true;
            }
        }
        if (this.maxLines && this._textLines.length > this.maxLines) {
            oversize = true;
        }

        if (oversize) {
            this.text = _old_text;
            this.selectionStart -= _char.length;
            this.selectionEnd = this.selectionStart;
            this._textLines = this._splitTextIntoLines();
        }

        if (skipUpdate) {
            return;
        }

        this._updateTextarea();
        this.setCoords();
        this._fireSelectionChanged();
        this.fire('changed');
        this.restartCursorIfNeeded();
        if (this.canvas) {
            this.canvas.fire('text:changed', { target: this });
            this.canvas.renderAll();
        }
    }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 63 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.StaticCanvas.prototype, {

  _showMainLoaderIndicator: function _showMainLoaderIndicator(e) {
    var canvas = e.target;
    canvas.loaderElement = $(this.loader.template);
    $(canvas.wrapperEl).append(canvas.loaderElement).addClass("loading");
  },
  _hideMainLoaderIndicator: function _hideMainLoaderIndicator(e) {
    var canvas = e.target;
    canvas.loaderElement.remove();
    $(canvas.wrapperEl).removeClass("loading");
  }
});

fabric.util.object.extend(fabric.Editor.prototype, {
  pending: false,
  setPending: function setPending(val) {
    this.pending = val;
    if (val) {
      if (this.canvas) {
        this.canvas.interactive = false;
      }
      if (this.slides) {
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
          for (var _iterator = this.slides[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var slide = _step.value;

            slide.interactive = false;
          }
        } catch (err) {
          _didIteratorError = true;
          _iteratorError = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion && _iterator.return) {
              _iterator.return();
            }
          } finally {
            if (_didIteratorError) {
              throw _iteratorError;
            }
          }
        }
      }
    }
  },
  loader: {
    container: "",
    template: "<div class='canvas-loader'><span class='loader-spinner fa fa-pulse fa-spinner canvas-load-spinner'></span><span class='loader-message'>Loading...</span></div>",
    icon: 'data:image/svg+xml;base64,' + __webpack_require__(64)
  },
  _showMainLoaderIndicator: function _showMainLoaderIndicator(e) {
    $(this.canvasContainer).append(this._loaderElement).addClass("loading");
  },
  _hideMainLoaderIndicator: function _hideMainLoaderIndicator(e) {
    if (this.pending) {
      this.pending = false;
      return;
    }
    this._loaderElement.remove();
    $(this.canvasContainer).removeClass("loading");
  },
  setLoader: function setLoader(val) {
    if (!val) return;
    if (val.constructor === String) {
      val = {
        id: val
      };
    }
    if (val.id) {
      this._loaderElement = $(document.getElementById(val.id));
    }
    if (val.template) {
      this.loader.template = val.template.replace("{loaderIcon}", this.loader.icon);
      this._loaderElement = $(this.loader.template);
    }
    if (val) {
      // this.loader.container = $(val.container);
      // this.loader.element = $(val.template).hide();
      // this.on("loading:begin", this._showMainLoaderIndicator);
      // this.on("loading:end", this._hideMainLoaderIndicator);
      if (this._loading) {
        this._showMainLoaderIndicator();
      }
      if (val.pending) {
        this._showMainLoaderIndicator();
      }
      this.on("loading:begin", this._showMainLoaderIndicator.bind(this));
      this.on("loading:end", this._hideMainLoaderIndicator.bind(this));
      // this.on("slide:loading:begin", this._showMainLoaderIndicator.bind(this));
      // this.on("slide:loading:end", this._hideMainLoaderIndicator.bind(this));

    }
  }
});

// fabric.util.object.extend(fabric.Canvas.prototype, {
//   // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
//   setLoaderTemplate: function (val) {
//     if(this.virtual) return false;
//     this.loaderTemplate = val;
//     if(val) {
//       this.loaderEl = $(this.loaderTemplate).hide();
//       $(this.wrapperEl).append(this.loaderEl);
//       this.on("loading:begin", function () {
//         this.loaderEl.show();
//         $(this.wrapperEl).addClass("loading");
//       });
//       this.on("loading:end", function () {
//         this.loaderEl.hide();
//         $(this.wrapperEl).removeClass("loading");
//       });
//     }
//   }
// });
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 64 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPScxODhweCcgaGVpZ2h0PScxODhweCcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiIGNsYXNzPSJ1aWwtc3BpbiI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9Im5vbmUiIGNsYXNzPSJiayI+PC9yZWN0PjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUwIDUwKSI+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjBzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwcyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoNDUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjEycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4xMnMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDkwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC4yNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgxMzUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjM3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4zN3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDE4MCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDIyNSkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNjJzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwLjYycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMjcwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC43NXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNzVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgzMTUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjg3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC44N3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjwvZz48L3N2Zz4="

/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//if ( fabric.isLikelyNode ){
//    //fabric.webFontsLoader = require("webfontloader");
//} else {
fabric.webFontsLoader = __webpack_require__(66);
//}


// if(typeof WebFont == "undefined"){
//   fabric.webFontsLoader = require("./../../plugins/webfont.js");
// } else {
//   fabric.webFontsLoader = WebFont;
// }

//интересная библиотека
// http://opentype.js.org/index.html
//todo add step
//
// fabric.Editor.prototype.steps.splice(3,0,"loadWebfonts");

fabric.loadFonts = function (options) {
  var _this = this;

  this.webFontsStatus = "loading";
  var options = fabric.util.object.extend({
    active: function active() {
      if (_this.waitForWebfonts) {
        fabric.util.fonts.waitFor(options.google.families.concat(options.custom.families), function () {
          _this.webFontsStatus = "ready";
          _this.fire("fonts:loaded");
        });
      } else {

        if (options.google && options.google.families.length) {
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = options.google.families[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var family = _step.value;

              fabric.util.clearFabricFontCache(family);
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        }
        if (options.custom && options.custom.families.length) {
          var _iteratorNormalCompletion2 = true;
          var _didIteratorError2 = false;
          var _iteratorError2 = undefined;

          try {
            for (var _iterator2 = options.custom.families[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
              var _family = _step2.value;

              fabric.util.clearFabricFontCache(_family);
            }
          } catch (err) {
            _didIteratorError2 = true;
            _iteratorError2 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion2 && _iterator2.return) {
                _iterator2.return();
              }
            } finally {
              if (_didIteratorError2) {
                throw _iteratorError2;
              }
            }
          }
        }

        // callback()
        _this.webFontsStatus = "ready";
        _this.fire("fonts:loaded");
      }
    },
    inactive: function inactive() {
      console.warn("fonts could not be loaded");
      _this.webFontsStatus = "failed";
      _this.fire("fonts:loaded");
    }
  }, options);
  fabric.webFontsLoader.load(options);
};

fabric.util.object.extend(fabric.Editor.prototype, {
  setWebfonts: function setWebfonts(options, callback) {

    var _fonts = [].concat(options.native || []).concat(options.custom || []).concat(options.google || []);
    this.fonts = fabric.util.object.sortBy(_fonts, function (font) {
      return font;
    });

    if (fabric.webFontsStatus === "ready" || fabric.webFontsStatus === "failed") {
      return callback();
    }
    fabric.on("fonts:loaded fonts:failed", function () {
      callback();
    });
    if (fabric.webFontsStatus === "loading") {
      return;
    }
    if (fabric.isLikelyNode) {
      fabric.webFontsStatus = "failed";
      //todo шрифты не грузятся на сервере
      return callback();
    }

    if (options.google) {
      if (options.google.length) {
        options.google = { families: options.google };
      } else {
        delete options.google;
      }
    }
    if (options.custom) {
      if (options.custom.length) {
        options.custom = { families: options.custom };
      } else {
        delete options.custom;
      }
    }
    fabric.loadFonts(options);
  },
  setFonts: function setFonts(fonts) {
    this.fonts = fonts;
  },
  fonts: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Georgia', 'Impact', 'Lucida Console', 'Tahoma', 'Times New Roman', 'Geneva', 'sans-serif', 'serif', 'monospace', 'cursive'],
  /*
  {
    native: []
    google: [],
    custom: []
  }
   */
  webfonts: null
});

fabric.util.fonts = {
  waitFor: function waitFor(fonts, callback) {
    var checklist = [];
    var interval;
    var node = void 0,
        font = void 0;
    var initialWidth = void 0;
    for (var i = 0, l = fonts.length; i < l; ++i) {
      font = fonts[i];

      node = document.createElement('span');
      // Characters that vary significantly among different fonts
      node.innerHTML = 'giItT1WQy@!-/#';
      // Visible - so we can measure it - but not on the screen
      node.style.position = 'absolute';
      node.style.left = '-10000px';
      node.style.top = '-10000px';
      // Large font size makes even subtle changes obvious
      node.style.fontSize = '300px';
      // Reset any font properties
      node.style.fontFamily = 'sans-serif';
      node.style.fontVariant = 'normal';
      node.style.fontStyle = 'normal';
      node.style.fontWeight = 'normal';
      node.style.letterSpacing = '0';
      document.body.appendChild(node);
      initialWidth = node.offsetWidth;
      // Remember width with no applied web font
      node.style.fontFamily = font;
      if (node.offsetWidth === initialWidth) {
        checklist.push(node);
      } else {
        fabric.clearFabricFontCache(node.style.fontFamily);
      }
    }

    function checkFonts() {
      for (var i = checklist.length; i--;) {
        if (node.offsetWidth !== initialWidth) {
          checklist.splice(checklist.indexOf(font), 1);
          node.parentNode.removeChild(node);

          fabric.clearFabricFontCache(node.style.fontFamily);
          // If all fonts have been loaded
          if (!checklist.length) {
            clearInterval(interval);
            callback();
          }
        }
      }
    }
    if (checklist.length) {
      interval = setInterval(checkFonts, 50);
    } else {
      callback();
    }
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 66 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
var __WEBPACK_AMD_DEFINE_RESULT__;

/* Web Font Loader v1.6.28 - (c) Adobe Systems, Google. License: Apache 2.0 */(function () {
    function aa(a, b, c) {
        return a.call.apply(a.bind, arguments);
    }function ba(a, b, c) {
        if (!a) throw Error();if (2 < arguments.length) {
            var d = Array.prototype.slice.call(arguments, 2);return function () {
                var c = Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c, d);return a.apply(b, c);
            };
        }return function () {
            return a.apply(b, arguments);
        };
    }function p(a, b, c) {
        p = Function.prototype.bind && -1 != Function.prototype.bind.toString().indexOf("native code") ? aa : ba;return p.apply(null, arguments);
    }var q = Date.now || function () {
        return +new Date();
    };function ca(a, b) {
        this.a = a;this.o = b || a;this.c = this.o.document;
    }var da = !!window.FontFace;function t(a, b, c, d) {
        b = a.c.createElement(b);if (c) for (var e in c) {
            c.hasOwnProperty(e) && ("style" == e ? b.style.cssText = c[e] : b.setAttribute(e, c[e]));
        }d && b.appendChild(a.c.createTextNode(d));return b;
    }function u(a, b, c) {
        a = a.c.getElementsByTagName(b)[0];a || (a = document.documentElement);a.insertBefore(c, a.lastChild);
    }function v(a) {
        a.parentNode && a.parentNode.removeChild(a);
    }
    function w(a, b, c) {
        b = b || [];c = c || [];for (var d = a.className.split(/\s+/), e = 0; e < b.length; e += 1) {
            for (var f = !1, g = 0; g < d.length; g += 1) {
                if (b[e] === d[g]) {
                    f = !0;break;
                }
            }f || d.push(b[e]);
        }b = [];for (e = 0; e < d.length; e += 1) {
            f = !1;for (g = 0; g < c.length; g += 1) {
                if (d[e] === c[g]) {
                    f = !0;break;
                }
            }f || b.push(d[e]);
        }a.className = b.join(" ").replace(/\s+/g, " ").replace(/^\s+|\s+$/, "");
    }function y(a, b) {
        for (var c = a.className.split(/\s+/), d = 0, e = c.length; d < e; d++) {
            if (c[d] == b) return !0;
        }return !1;
    }
    function ea(a) {
        return a.o.location.hostname || a.a.location.hostname;
    }function z(a, b, c) {
        function d() {
            m && e && f && (m(g), m = null);
        }b = t(a, "link", { rel: "stylesheet", href: b, media: "all" });var e = !1,
            f = !0,
            g = null,
            m = c || null;da ? (b.onload = function () {
            e = !0;d();
        }, b.onerror = function () {
            e = !0;g = Error("Stylesheet failed to load");d();
        }) : setTimeout(function () {
            e = !0;d();
        }, 0);u(a, "head", b);
    }
    function A(a, b, c, d) {
        var e = a.c.getElementsByTagName("head")[0];if (e) {
            var f = t(a, "script", { src: b }),
                g = !1;f.onload = f.onreadystatechange = function () {
                g || this.readyState && "loaded" != this.readyState && "complete" != this.readyState || (g = !0, c && c(null), f.onload = f.onreadystatechange = null, "HEAD" == f.parentNode.tagName && e.removeChild(f));
            };e.appendChild(f);setTimeout(function () {
                g || (g = !0, c && c(Error("Script load timeout")));
            }, d || 5E3);return f;
        }return null;
    };function B() {
        this.a = 0;this.c = null;
    }function C(a) {
        a.a++;return function () {
            a.a--;D(a);
        };
    }function E(a, b) {
        a.c = b;D(a);
    }function D(a) {
        0 == a.a && a.c && (a.c(), a.c = null);
    };function F(a) {
        this.a = a || "-";
    }F.prototype.c = function (a) {
        for (var b = [], c = 0; c < arguments.length; c++) {
            b.push(arguments[c].replace(/[\W_]+/g, "").toLowerCase());
        }return b.join(this.a);
    };function G(a, b) {
        this.c = a;this.f = 4;this.a = "n";var c = (b || "n4").match(/^([nio])([1-9])$/i);c && (this.a = c[1], this.f = parseInt(c[2], 10));
    }function fa(a) {
        return H(a) + " " + (a.f + "00") + " 300px " + I(a.c);
    }function I(a) {
        var b = [];a = a.split(/,\s*/);for (var c = 0; c < a.length; c++) {
            var d = a[c].replace(/['"]/g, "");-1 != d.indexOf(" ") || /^\d/.test(d) ? b.push("'" + d + "'") : b.push(d);
        }return b.join(",");
    }function J(a) {
        return a.a + a.f;
    }function H(a) {
        var b = "normal";"o" === a.a ? b = "oblique" : "i" === a.a && (b = "italic");return b;
    }
    function ga(a) {
        var b = 4,
            c = "n",
            d = null;a && ((d = a.match(/(normal|oblique|italic)/i)) && d[1] && (c = d[1].substr(0, 1).toLowerCase()), (d = a.match(/([1-9]00|normal|bold)/i)) && d[1] && (/bold/i.test(d[1]) ? b = 7 : /[1-9]00/.test(d[1]) && (b = parseInt(d[1].substr(0, 1), 10))));return c + b;
    };function ha(a, b) {
        this.c = a;this.f = a.o.document.documentElement;this.h = b;this.a = new F("-");this.j = !1 !== b.events;this.g = !1 !== b.classes;
    }function ia(a) {
        a.g && w(a.f, [a.a.c("wf", "loading")]);K(a, "loading");
    }function L(a) {
        if (a.g) {
            var b = y(a.f, a.a.c("wf", "active")),
                c = [],
                d = [a.a.c("wf", "loading")];b || c.push(a.a.c("wf", "inactive"));w(a.f, c, d);
        }K(a, "inactive");
    }function K(a, b, c) {
        if (a.j && a.h[b]) if (c) a.h[b](c.c, J(c));else a.h[b]();
    };function ja() {
        this.c = {};
    }function ka(a, b, c) {
        var d = [],
            e;for (e in b) {
            if (b.hasOwnProperty(e)) {
                var f = a.c[e];f && d.push(f(b[e], c));
            }
        }return d;
    };function M(a, b) {
        this.c = a;this.f = b;this.a = t(this.c, "span", { "aria-hidden": "true" }, this.f);
    }function N(a) {
        u(a.c, "body", a.a);
    }function O(a) {
        return "display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:" + I(a.c) + ";" + ("font-style:" + H(a) + ";font-weight:" + (a.f + "00") + ";");
    };function P(a, b, c, d, e, f) {
        this.g = a;this.j = b;this.a = d;this.c = c;this.f = e || 3E3;this.h = f || void 0;
    }P.prototype.start = function () {
        var a = this.c.o.document,
            b = this,
            c = q(),
            d = new Promise(function (d, e) {
            function f() {
                q() - c >= b.f ? e() : a.fonts.load(fa(b.a), b.h).then(function (a) {
                    1 <= a.length ? d() : setTimeout(f, 25);
                }, function () {
                    e();
                });
            }f();
        }),
            e = null,
            f = new Promise(function (a, d) {
            e = setTimeout(d, b.f);
        });Promise.race([f, d]).then(function () {
            e && (clearTimeout(e), e = null);b.g(b.a);
        }, function () {
            b.j(b.a);
        });
    };function Q(a, b, c, d, e, f, g) {
        this.v = a;this.B = b;this.c = c;this.a = d;this.s = g || "BESbswy";this.f = {};this.w = e || 3E3;this.u = f || null;this.m = this.j = this.h = this.g = null;this.g = new M(this.c, this.s);this.h = new M(this.c, this.s);this.j = new M(this.c, this.s);this.m = new M(this.c, this.s);a = new G(this.a.c + ",serif", J(this.a));a = O(a);this.g.a.style.cssText = a;a = new G(this.a.c + ",sans-serif", J(this.a));a = O(a);this.h.a.style.cssText = a;a = new G("serif", J(this.a));a = O(a);this.j.a.style.cssText = a;a = new G("sans-serif", J(this.a));a = O(a);this.m.a.style.cssText = a;N(this.g);N(this.h);N(this.j);N(this.m);
    }var R = { D: "serif", C: "sans-serif" },
        S = null;function T() {
        if (null === S) {
            var a = /AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);S = !!a && (536 > parseInt(a[1], 10) || 536 === parseInt(a[1], 10) && 11 >= parseInt(a[2], 10));
        }return S;
    }Q.prototype.start = function () {
        this.f.serif = this.j.a.offsetWidth;this.f["sans-serif"] = this.m.a.offsetWidth;this.A = q();U(this);
    };
    function la(a, b, c) {
        for (var d in R) {
            if (R.hasOwnProperty(d) && b === a.f[R[d]] && c === a.f[R[d]]) return !0;
        }return !1;
    }function U(a) {
        var b = a.g.a.offsetWidth,
            c = a.h.a.offsetWidth,
            d;(d = b === a.f.serif && c === a.f["sans-serif"]) || (d = T() && la(a, b, c));d ? q() - a.A >= a.w ? T() && la(a, b, c) && (null === a.u || a.u.hasOwnProperty(a.a.c)) ? V(a, a.v) : V(a, a.B) : ma(a) : V(a, a.v);
    }function ma(a) {
        setTimeout(p(function () {
            U(this);
        }, a), 50);
    }function V(a, b) {
        setTimeout(p(function () {
            v(this.g.a);v(this.h.a);v(this.j.a);v(this.m.a);b(this.a);
        }, a), 0);
    };function W(a, b, c) {
        this.c = a;this.a = b;this.f = 0;this.m = this.j = !1;this.s = c;
    }var X = null;W.prototype.g = function (a) {
        var b = this.a;b.g && w(b.f, [b.a.c("wf", a.c, J(a).toString(), "active")], [b.a.c("wf", a.c, J(a).toString(), "loading"), b.a.c("wf", a.c, J(a).toString(), "inactive")]);K(b, "fontactive", a);this.m = !0;na(this);
    };
    W.prototype.h = function (a) {
        var b = this.a;if (b.g) {
            var c = y(b.f, b.a.c("wf", a.c, J(a).toString(), "active")),
                d = [],
                e = [b.a.c("wf", a.c, J(a).toString(), "loading")];c || d.push(b.a.c("wf", a.c, J(a).toString(), "inactive"));w(b.f, d, e);
        }K(b, "fontinactive", a);na(this);
    };function na(a) {
        0 == --a.f && a.j && (a.m ? (a = a.a, a.g && w(a.f, [a.a.c("wf", "active")], [a.a.c("wf", "loading"), a.a.c("wf", "inactive")]), K(a, "active")) : L(a.a));
    };function oa(a) {
        this.j = a;this.a = new ja();this.h = 0;this.f = this.g = !0;
    }oa.prototype.load = function (a) {
        this.c = new ca(this.j, a.context || this.j);this.g = !1 !== a.events;this.f = !1 !== a.classes;pa(this, new ha(this.c, a), a);
    };
    function qa(a, b, c, d, e) {
        var f = 0 == --a.h;(a.f || a.g) && setTimeout(function () {
            var a = e || null,
                m = d || null || {};if (0 === c.length && f) L(b.a);else {
                b.f += c.length;f && (b.j = f);var h,
                    l = [];for (h = 0; h < c.length; h++) {
                    var k = c[h],
                        n = m[k.c],
                        r = b.a,
                        x = k;r.g && w(r.f, [r.a.c("wf", x.c, J(x).toString(), "loading")]);K(r, "fontloading", x);r = null;if (null === X) if (window.FontFace) {
                        var x = /Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),
                            xa = /OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent) && /Apple/.exec(window.navigator.vendor);
                        X = x ? 42 < parseInt(x[1], 10) : xa ? !1 : !0;
                    } else X = !1;X ? r = new P(p(b.g, b), p(b.h, b), b.c, k, b.s, n) : r = new Q(p(b.g, b), p(b.h, b), b.c, k, b.s, a, n);l.push(r);
                }for (h = 0; h < l.length; h++) {
                    l[h].start();
                }
            }
        }, 0);
    }function pa(a, b, c) {
        var d = [],
            e = c.timeout;ia(b);var d = ka(a.a, c, a.c),
            f = new W(a.c, b, e);a.h = d.length;b = 0;for (c = d.length; b < c; b++) {
            d[b].load(function (b, d, c) {
                qa(a, f, b, d, c);
            });
        }
    };function ra(a, b) {
        this.c = a;this.a = b;
    }
    ra.prototype.load = function (a) {
        function b() {
            if (f["__mti_fntLst" + d]) {
                var c = f["__mti_fntLst" + d](),
                    e = [],
                    h;if (c) for (var l = 0; l < c.length; l++) {
                    var k = c[l].fontfamily;void 0 != c[l].fontStyle && void 0 != c[l].fontWeight ? (h = c[l].fontStyle + c[l].fontWeight, e.push(new G(k, h))) : e.push(new G(k));
                }a(e);
            } else setTimeout(function () {
                b();
            }, 50);
        }var c = this,
            d = c.a.projectId,
            e = c.a.version;if (d) {
            var f = c.c.o;A(this.c, (c.a.api || "https://fast.fonts.net/jsapi") + "/" + d + ".js" + (e ? "?v=" + e : ""), function (e) {
                e ? a([]) : (f["__MonotypeConfiguration__" + d] = function () {
                    return c.a;
                }, b());
            }).id = "__MonotypeAPIScript__" + d;
        } else a([]);
    };function sa(a, b) {
        this.c = a;this.a = b;
    }sa.prototype.load = function (a) {
        var b,
            c,
            d = this.a.urls || [],
            e = this.a.families || [],
            f = this.a.testStrings || {},
            g = new B();b = 0;for (c = d.length; b < c; b++) {
            z(this.c, d[b], C(g));
        }var m = [];b = 0;for (c = e.length; b < c; b++) {
            if (d = e[b].split(":"), d[1]) for (var h = d[1].split(","), l = 0; l < h.length; l += 1) {
                m.push(new G(d[0], h[l]));
            } else m.push(new G(d[0]));
        }E(g, function () {
            a(m, f);
        });
    };function ta(a, b) {
        a ? this.c = a : this.c = ua;this.a = [];this.f = [];this.g = b || "";
    }var ua = "https://fonts.googleapis.com/css";function va(a, b) {
        for (var c = b.length, d = 0; d < c; d++) {
            var e = b[d].split(":");3 == e.length && a.f.push(e.pop());var f = "";2 == e.length && "" != e[1] && (f = ":");a.a.push(e.join(f));
        }
    }
    function wa(a) {
        if (0 == a.a.length) throw Error("No fonts to load!");if (-1 != a.c.indexOf("kit=")) return a.c;for (var b = a.a.length, c = [], d = 0; d < b; d++) {
            c.push(a.a[d].replace(/ /g, "+"));
        }b = a.c + "?family=" + c.join("%7C");0 < a.f.length && (b += "&subset=" + a.f.join(","));0 < a.g.length && (b += "&text=" + encodeURIComponent(a.g));return b;
    };function ya(a) {
        this.f = a;this.a = [];this.c = {};
    }
    var za = { latin: "BESbswy", "latin-ext": "\xE7\xF6\xFC\u011F\u015F", cyrillic: "\u0439\u044F\u0416", greek: "\u03B1\u03B2\u03A3", khmer: "\u1780\u1781\u1782", Hanuman: "\u1780\u1781\u1782" },
        Aa = { thin: "1", extralight: "2", "extra-light": "2", ultralight: "2", "ultra-light": "2", light: "3", regular: "4", book: "4", medium: "5", "semi-bold": "6", semibold: "6", "demi-bold": "6", demibold: "6", bold: "7", "extra-bold": "8", extrabold: "8", "ultra-bold": "8", ultrabold: "8", black: "9", heavy: "9", l: "3", r: "4", b: "7" },
        Ba = { i: "i", italic: "i", n: "n", normal: "n" },
        Ca = /^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
    function Da(a) {
        for (var b = a.f.length, c = 0; c < b; c++) {
            var d = a.f[c].split(":"),
                e = d[0].replace(/\+/g, " "),
                f = ["n4"];if (2 <= d.length) {
                var g;var m = d[1];g = [];if (m) for (var m = m.split(","), h = m.length, l = 0; l < h; l++) {
                    var k;k = m[l];if (k.match(/^[\w-]+$/)) {
                        var n = Ca.exec(k.toLowerCase());if (null == n) k = "";else {
                            k = n[2];k = null == k || "" == k ? "n" : Ba[k];n = n[1];if (null == n || "" == n) n = "4";else var r = Aa[n],
                                n = r ? r : isNaN(n) ? "4" : n.substr(0, 1);k = [k, n].join("");
                        }
                    } else k = "";k && g.push(k);
                }0 < g.length && (f = g);3 == d.length && (d = d[2], g = [], d = d ? d.split(",") : g, 0 < d.length && (d = za[d[0]]) && (a.c[e] = d));
            }a.c[e] || (d = za[e]) && (a.c[e] = d);for (d = 0; d < f.length; d += 1) {
                a.a.push(new G(e, f[d]));
            }
        }
    };function Ea(a, b) {
        this.c = a;this.a = b;
    }var Fa = { Arimo: !0, Cousine: !0, Tinos: !0 };Ea.prototype.load = function (a) {
        var b = new B(),
            c = this.c,
            d = new ta(this.a.api, this.a.text),
            e = this.a.families;va(d, e);var f = new ya(e);Da(f);z(c, wa(d), C(b));E(b, function () {
            a(f.a, f.c, Fa);
        });
    };function Ga(a, b) {
        this.c = a;this.a = b;
    }Ga.prototype.load = function (a) {
        var b = this.a.id,
            c = this.c.o;b ? A(this.c, (this.a.api || "https://use.typekit.net") + "/" + b + ".js", function (b) {
            if (b) a([]);else if (c.Typekit && c.Typekit.config && c.Typekit.config.fn) {
                b = c.Typekit.config.fn;for (var e = [], f = 0; f < b.length; f += 2) {
                    for (var g = b[f], m = b[f + 1], h = 0; h < m.length; h++) {
                        e.push(new G(g, m[h]));
                    }
                }try {
                    c.Typekit.load({ events: !1, classes: !1, async: !0 });
                } catch (l) {}a(e);
            }
        }, 2E3) : a([]);
    };function Ha(a, b) {
        this.c = a;this.f = b;this.a = [];
    }Ha.prototype.load = function (a) {
        var b = this.f.id,
            c = this.c.o,
            d = this;b ? (c.__webfontfontdeckmodule__ || (c.__webfontfontdeckmodule__ = {}), c.__webfontfontdeckmodule__[b] = function (b, c) {
            for (var g = 0, m = c.fonts.length; g < m; ++g) {
                var h = c.fonts[g];d.a.push(new G(h.name, ga("font-weight:" + h.weight + ";font-style:" + h.style)));
            }a(d.a);
        }, A(this.c, (this.f.api || "https://f.fontdeck.com/s/css/js/") + ea(this.c) + "/" + b + ".js", function (b) {
            b && a([]);
        })) : a([]);
    };var Y = new oa(window);Y.a.c.custom = function (a, b) {
        return new sa(b, a);
    };Y.a.c.fontdeck = function (a, b) {
        return new Ha(b, a);
    };Y.a.c.monotype = function (a, b) {
        return new ra(b, a);
    };Y.a.c.typekit = function (a, b) {
        return new Ga(b, a);
    };Y.a.c.google = function (a, b) {
        return new Ea(b, a);
    };var Z = { load: p(Y.load, Y) }; true ? !(__WEBPACK_AMD_DEFINE_RESULT__ = (function () {
        return Z;
    }).call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : "undefined" !== typeof module && module.exports ? module.exports = Z : (window.WebFont = Z, window.WebFontConfig && Y.load(window.WebFontConfig));
})();

/***/ }),
/* 67 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!Toolbar) {
  __webpack_require__(68);
  var Toolbar = __webpack_require__(1);
  __webpack_require__(69);
  __webpack_require__(71);
  __webpack_require__(73);
  __webpack_require__(74);
  __webpack_require__(75);
}

Toolbar.prototype.setFunctionCallback = function (target) {
  if (target.canvas) {
    return target.canvas.renderAll();
  }
  if (target.renderAll) {
    return target.renderAll();
  }
};

fabric.ToolsMixin = {
  /**
   *
   * @param tools ["x", "*", "y"]
   * @param proto
   * @returns ["x", "a", "b", "c", "y"]
   * @private
   */
  _getTools: function _getTools(tools, proto) {
    var indexOfStar = -1;
    if ((indexOfStar = tools.indexOf("*")) == -1) {
      return tools;
    }

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type), true);
    var protoFabric = fabric[klassname].prototype;
    var protoApp = this.application.prototypes[klassname];

    var tools2 = protoApp && protoApp.tools || protoFabric.tools;
    if (tools2) {
      tools.splice.apply(tools, [indexOfStar, 1].concat(tools2));
    }
    var _tools = this._getTools(tools, protoFabric.__proto__);
    return _tools;
  },
  setTools: function setTools(tools) {
    if (this.application.toolbars.objects) {
      var _tools = [].concat(tools); //
      this.tools = this._getTools(_tools, this.__proto__.__proto__);
      this.makeActions();
    }
  },
  makeActions: function makeActions() {
    var actions = {};
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = this.tools[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var tool = _step.value;

        var _val = this._getActionValue(tool);
        if (_val) {
          actions[tool] = _val;
        } else {
          console.warn("tool " + tool + " is undefined");
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    this.generatedActions = Toolbar.makeActions(actions, this);
  }
};

fabric.Toolbar = Toolbar;

fabric.util.object.extend(fabric.Object.prototype, fabric.ToolsMixin, {
  optionsOrder: function () {
    var oo = fabric.Object.prototype.optionsOrder;
    oo.push("actions", "tools");
    return oo;
  }()
});

fabric.util.object.extend(fabric.Editor.prototype, fabric.ToolsMixin, {
  optionsOrder: function () {
    var oo = fabric.Editor.prototype.optionsOrder;
    oo.splice(oo.indexOf("prototypes") + 1, 0, "actions");
    oo.splice(oo.indexOf("objects"), 0, "toolbars", "tools");
    return oo;
  }(),
  objectsToolbarContainer: null,
  target: null,
  setToolbarCoords: function setToolbarCoords($menu, target, options) {

    options = fabric.util.object.extend({
      originX: "left",
      originY: "top",
      marginX: 0,
      marginY: 0
    }, options);

    target.setCoords();
    var r = target.getBoundingRect();

    var _left;
    switch (options.originX) {
      case "left":
        _left = r.left;
        break;
      case "right":
        _left = r.left + r.width;
        break;
      case "center":
        _left = r.left + r.width / 2;
        break;
    }

    var _top;
    switch (options.originY) {
      case "top":
        _top = r.top - $menu.height();
        break;
      case "bottom":
        _top = r.top + r.height;
        break;
      case "center":
        _top = r.top + r.height / 2 - $menu.height() / 2;
        break;
    }

    var $wrapper = $menu.relativeParent(); // $(target.canvas.wrapperEl);
    var _menuContainerOffset = $($menu.parents()[0]).offset();
    var _canvasOffset = $(target.canvas.wrapperEl).offset();
    var _pos = $(target.canvas.wrapperEl).position();

    var _scale = $(target.canvas.wrapperEl).height() / target.canvas.height;
    _top *= _scale;
    _left *= _scale;

    _top += options.marginY + _canvasOffset.top - _menuContainerOffset.top; // + _pos.top;
    _left += options.marginX + _canvasOffset.left - _menuContainerOffset.left; // + _pos.left;

    _left = Math.max(3, _left);

    var _overflow = -$wrapper.width() + _left + $menu.width() + 3;

    if (_overflow > 0) {
      _left -= _overflow;
    }

    var coords = {
      top: Math.max(3, _top),
      left: _left
    };

    //  $(this.wrapperEl).offset();

    $menu.css(coords);
    return coords;
  },
  _createObjectsToolbar: function _createObjectsToolbar(options) {
    var _this = this;

    var $ctr;
    if (options.container) {
      $ctr = $(document.getElementById(options.container));
    } else {
      $ctr = $('<div>');
      $(this.wrapperEl).prepend($ctr);
    }
    if (options.position) {
      fabric.util.object.defaults(options.position, {
        originX: "left",
        originY: "top",
        marginX: 0,
        marginY: 0
      });
      $ctr.addClass("floated-menu");
      $ctr.css({
        "position": "absolute",
        "z-index": 999
      });
    }

    $ctr.hide();
    this.on({
      'target:cleared': function targetCleared(event) {
        if (event.previous) {
          $ctr.hide();
          _this.objectToolbar.destroy();
          delete _this.objectToolbar;
        }
      },
      'target:changed': function targetChanged(event) {
        if (event.previous) {
          _this.objectToolbar.destroy();
        }
        $ctr.show();
        if (_this.target.actions) {
          _this.objectToolbar = new fabric.Toolbar(_this.target, $ctr, _this.target.generatedActions, options);
        }
        if (options.position) {
          _this.setToolbarCoords($ctr, _this.target, options.position);
          // this.objectToolbar.moving_eventListener = this.setToolbarCoords.bind(this, $ctr, this.target, options.position);
          // this.target.on("moving",this.objectToolbar.moving_eventListener)
        }
      },
      'target:modified': function targetModified(event) {
        if (options.position) {
          _this.setToolbarCoords($ctr, _this.target, options.position);
        }
      }
    });
  },
  _createCanvasToolbar: function _createCanvasToolbar(options) {
    if (!options) return;

    this.on("slide:changed", function (e) {
      var canvas = e.canvas;
      if (this.slideToolbar) {
        this.slideToolbar.destroy();
      }
      this.slideToolbar = new fabric.Toolbar(canvas, options.container, canvas.generatedActions, options);
    });

    if (this.canvas) {
      this.slideToolbar = new fabric.Toolbar(this.canvas, options.container, this.canvas.generatedActions, options);
    }
  },
  setToolbars: function setToolbars(options) {
    this.toolbars = options;

    if (options.tools) {
      if (options.tools.Editor) {
        this.setTools(options.tools.Editor);
        delete options.tools.Editor;
      }
      for (var klassName in options.tools) {
        if (!this.prototypes[klassName]) {
          this.prototypes[klassName] = {};
        }
        this.prototypes[klassName].tools = options.tools[klassName];
      }
    }
    if (options.application) {}
    if (options.objects) {
      this._createObjectsToolbar(options.objects);
    }
    if (options.canvas) {
      this._createCanvasToolbar(options.canvas);
    }
  },
  setTools: function setTools(tools) {
    if (this.toolbars.application) {
      var _tools = [].concat(tools); //
      this.tools = this._getTools(_tools, this.__proto__.__proto__);
      this.makeActions();
      new fabric.Toolbar(this, this.toolbars.application.container, this.generatedActions, this.toolbars.application);
    }
  },
  /*setToolbarOptions: function(toolbarOptions){
     fabric.util.object.deepExtend(Toolbar.tools, toolbarOptions.tools);
    for (var klassName in toolbarOptions.actions) {
      var actions = toolbarOptions.actions[klassName];
      if(!fabric[klassName].prototype.actions){
        fabric[klassName].prototype.actions = {}
      }
      var protoActions = fabric[klassName].prototype.actions;
       if (actions.constructor == Function) {
        actions = actions.call(fabric[klassName].prototype)
      }else{
        actions = fabric.util.object.cloneDeep(actions);
      }
     // var $order = actions["$order"];
     // delete actions["$order"];
       for (var j in actions) {
        if(protoActions[j]){
          if (actions[j]["$clone"]) {
            protoActions[j] = fabric.util.object.deepExtend({}, protoActions[j]);
            delete actions[j]["$clone"];
          }
          fabric.util.object.deepExtend(protoActions[j], actions[j]);
        }else{
          protoActions[j] = actions[j];
        }
      }
    }
  },*/
  eventListeners: fabric.util.object.extendArraysObject(fabric.Editor.prototype.eventListeners, {
    // "canvas:created" : function(){
    //  this.initTools();
    // },
    //  "canvas:created": function(){
    //    this.createToolbars();
    //  }
  })
});

//todo нужно сделать порядок свойст унаследуемым
fabric.util.object.extend(fabric.Canvas.prototype, fabric.ToolsMixin, {
  setTools: function setTools(tools) {
    if (this.application.toolbars.canvas) {
      var _tools = [].concat(tools);
      this.tools = this._getTools(_tools, this.__proto__.__proto__);
      this.makeActions();
    }
  },
  optionsOrder: function () {
    var oo = fabric.StaticCanvas.prototype.optionsOrder;
    oo.push("actions", "tools");
    return oo;
  }()
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 68 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


$.fn.extend({
  relativeParent: function relativeParent() {
    var regex = /(static|relative|absolute)/;
    var relativeParent = this.parents().filter(function () {
      var parent = $(this);
      return regex.test(parent.css("position"));
    }).eq(0);

    return !relativeParent.length ? $(this[0].ownerDocument || document) : relativeParent;
  },
  scrollParent: function scrollParent(includeHidden) {
    var position = this.css("position"),
        excludeStaticParent = position === "absolute",
        overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
        scrollParent = this.parents().filter(function () {
      var parent = $(this);
      if (excludeStaticParent && parent.css("position") === "static") {
        return false;
      }
      return overflowRegex.test(parent.css("overflow") + parent.css("overflow-y") + parent.css("overflow-x"));
    }).eq(0);

    return position === "fixed" || !scrollParent.length ? $(this[0].ownerDocument || document) : scrollParent;
  },
  eachSelf: function eachSelf(selector, foo) {
    this.find(selector).each(foo);
    if (this.is(selector)) {
      foo.call(this[0]);
    }
  }

});

$.fn.appendText = function (text) {
  return this.each(function () {
    var textNode = document.createTextNode(text);
    $(this).append(textNode);
  });
};

/***/ }),
/* 69 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!$.minicolors) {
  __webpack_require__(70);
}

if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.colorpickerOptions = {
  position: "right bottom"
};

Toolbar.prototype.tools.color = {
  template: '<div class="object-menu-item" title="{title}">' + '<div class="btn button-{id} {className}">' + '<input type="text" data-format="rgba" data-opacity="true" data-text="true" data-control="saturation" data-swatches="#fff|#000|#f00|#0f0|#00f|#ff0|#0ff"  value="{valueCurrent}" transclude>',
  post: function post($item, data, options, transclude) {
    //var target = data.target;

    var _visible = false;
    this.colorpicker(transclude, fabric.util.object.extend({
      // value:        data.value.get() ,//|| data.value.get(),
      defaultValue: /*data.value.defaultValue ||*/data.value.get(),
      control: 'hue',
      format: 'hex',
      keywords: '',
      inline: false,
      letterCase: 'lowercase',
      opacity: true,
      position: "right bottom",
      swatches: "#fff|#000|#f00|#0f0|#00f|#ff0|#0ff".split('|'),
      text: true,
      hide: function hide() {
        _visible = false;
      },
      show: function show() {
        _visible = true;
      },
      change: function change(value, opacity) {
        data.value.set(value);
      }
    }, options.colorpicker));

    var _el = $(transclude.parents()[0]).find(".minicolors-panel");

    var _HIDE = function _HIDE(e) {
      if (_visible && $(e.target).parents().index(_el) == -1) {
        transclude.minicolors("hide");
        $("body").off("mousedown", _HIDE);
      }
    };
    $("body").on("mousedown", _HIDE);
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 70 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/*
 * jQuery MiniColors: A tiny color picker built on jQuery
 *
 * Copyright: Cory LaViska for A Beautiful Site, LLC: http://www.abeautifulsite.net/
 *
 * Contribute: https://github.com/claviska/jquery-minicolors
 *
 * @license: http://opensource.org/licenses/MIT
 *
 */

(function (factory) {
  if (( false ? 'undefined' : _typeof(exports)) === 'object') {
    module.exports = factory(__webpack_require__(7));
  } else {
    factory(jQuery);
  }
})(function ($) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.minicolors')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.minicolors.css");
  //}

  // Defaults

  $.minicolors = {
    defaults: {
      animationSpeed: 50,
      animationEasing: 'swing',
      change: null,
      changeDelay: 0,
      control: 'hue',
      dataUris: true,
      defaultValue: '',
      format: 'hex',
      hide: null,
      hideSpeed: 100,
      inline: false,
      keywords: '',
      letterCase: 'lowercase',
      opacity: false,
      position: 'bottom left',
      show: null,
      showSpeed: 100,
      theme: 'default',
      swatches: []
    }
  };

  // Public methods
  $.extend($.fn, {
    minicolors: function minicolors(method, data) {

      switch (method) {

        // Destroy the control
        case 'destroy':
          $(this).each(function () {
            destroy($(this));
          });
          return $(this);

        // Hide the color picker
        case 'hide':
          hide();
          return $(this);

        // Get/set opacity
        case 'opacity':
          // Getter
          if (data === undefined) {
            // Getter
            return $(this).attr('data-opacity');
          } else {
            // Setter
            $(this).each(function () {
              updateFromInput($(this).attr('data-opacity', data));
            });
          }
          return $(this);

        // Get an RGB(A) object based on the current color/opacity
        case 'rgbObject':
          return rgbObject($(this), method === 'rgbaObject');

        // Get an RGB(A) string based on the current color/opacity
        case 'rgbString':
        case 'rgbaString':
          return rgbString($(this), method === 'rgbaString');

        // Get/set settings on the fly
        case 'settings':
          if (data === undefined) {
            return $(this).data('minicolors-settings');
          } else {
            // Setter
            $(this).each(function () {
              var settings = $(this).data('minicolors-settings') || {};
              destroy($(this));
              $(this).minicolors($.extend(true, settings, data));
            });
          }
          return $(this);

        // Show the color picker
        case 'show':
          show($(this).eq(0));
          return $(this);

        // Get/set the hex color value
        case 'value':
          if (data === undefined) {
            // Getter
            return $(this).val();
          } else {
            // Setter
            $(this).each(function () {
              if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) === 'object') {
                if (data.opacity) {
                  $(this).attr('data-opacity', keepWithin(data.opacity, 0, 1));
                }
                if (data.color) {
                  $(this).val(data.color);
                }
              } else {
                $(this).val(data);
              }
              updateFromInput($(this));
            });
          }
          return $(this);

        // Initializes the control
        default:
          if (method !== 'create') data = method;
          $(this).each(function () {
            init($(this), data);
          });
          return $(this);

      }
    }
  });

  var inputText, globalSettings, globalTarget, globalInput;
  // Initialize input elements
  function init(input, settings) {

    var minicolors = $('<div class="minicolors" />'),
        defaults = $.minicolors.defaults,
        size,
        swatches,
        textPanel,
        swatch,
        panel,
        globalTarget = input,
        i;

    // Do nothing if already initialized
    if (input.data('minicolors-initialized')) return;

    // Handle settings
    globalSettings = settings = $.extend(true, {}, defaults, settings);

    // The wrapper
    minicolors.addClass('minicolors-theme-' + settings.theme).toggleClass('minicolors-with-opacity', settings.opacity).toggleClass('minicolors-no-data-uris', settings.dataUris !== true);

    // Custom positioning
    if (settings.position !== undefined) {
      $.each(settings.position.split(' '), function () {
        minicolors.addClass('minicolors-position-' + this);
      });
    }

    // Input size
    if (settings.format === 'rgb') {
      size = settings.opacity ? '25' : '20';
    } else {
      size = settings.keywords ? '11' : '7';
    }
    globalInput = input;
    // The input
    input.addClass('minicolors-input').data('minicolors-initialized', false).data('minicolors-settings', settings).prop('size', size).wrap(minicolors).after('<div class="minicolors-panel minicolors-slider-' + settings.control + '">' + '<div class="minicolors-slider minicolors-sprite">' + '<div class="minicolors-picker"></div>' + '</div>' + '<div class="minicolors-opacity-slider minicolors-sprite">' + '<div class="minicolors-picker"></div>' + '</div>' + '<div class="minicolors-grid minicolors-sprite">' + '<div class="minicolors-grid-inner"></div>' + '<div class="minicolors-picker"><div></div></div>' + '</div>' + '</div>');

    // The swatch
    if (!settings.inline) {
      input.after('<span class="minicolors-swatch minicolors-sprite minicolors-input-swatch"><span class="minicolors-swatch-color"></span></span>');
      input.next('.minicolors-input-swatch').on('click', function (event) {
        event.preventDefault();
        input.focus();
      });
    }

    // Prevent text selection in IE
    panel = input.parent().find('.minicolors-panel');
    panel.on('selectstart', function () {
      return false;
    }).end();

    // Swatches
    if (settings.swatches && settings.swatches.length !== 0) {
      if (settings.swatches.length > 7) {
        settings.swatches.length = 7;
      }
      panel.addClass('minicolors-with-swatches');
      swatches = $('<ul class="minicolors-swatches"></ul>').appendTo(panel);
      for (i = 0; i < settings.swatches.length; ++i) {
        swatch = settings.swatches[i];
        swatch = isRgb(swatch) ? parseRgb(swatch, true) : hex2rgb(parseHex(swatch, true));
        $('<li class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></li>').appendTo(swatches).data('swatch-color', settings.swatches[i]).find('.minicolors-swatch-color').css({
          backgroundColor: rgb2hex(swatch),
          opacity: swatch.a
        });
        settings.swatches[i] = swatch;
      }
    }

    // Swatches
    if (settings.text) {
      panel.addClass('minicolors-with-text');
      textPanel = $('<div class="minicolors-text"></div>').appendTo(panel);
      inputText = $('<input type="text">').appendTo(textPanel);

      $(inputText).change(function () {
        input.val(inputText.val());
        updateFromInput(input, true);
      });
    }

    // Inline controls
    if (settings.inline) input.parent().addClass('minicolors-inline');

    updateFromInput(input, false);

    input.data('minicolors-initialized', true);
  }

  // Returns the input back to its original state
  function destroy(input) {

    var minicolors = input.parent();

    // Revert the input element
    input.removeData('minicolors-initialized').removeData('minicolors-settings').removeProp('size').removeClass('minicolors-input');

    // Remove the wrap and destroy whatever remains
    minicolors.before(input).remove();
  }

  // Shows the specified dropdown panel
  function show(input) {

    var minicolors = input.parent(),
        panel = minicolors.find('.minicolors-panel'),
        settings = input.data('minicolors-settings');

    // Do nothing if uninitialized, disabled, inline, or already open
    if (!input.data('minicolors-initialized') || input.prop('disabled') || minicolors.hasClass('minicolors-inline') || minicolors.hasClass('minicolors-focus')) return;

    hide();

    minicolors.addClass('minicolors-focus');
    panel.stop(true, true).fadeIn(settings.showSpeed, function () {
      if (settings.show) settings.show.call(input.get(0));
    });
  }

  // Hides all dropdown panels
  function hide() {

    $('.minicolors-focus').each(function () {

      var minicolors = $(this),
          input = minicolors.find('.minicolors-input'),
          panel = minicolors.find('.minicolors-panel'),
          settings = input.data('minicolors-settings');

      panel.fadeOut(settings.hideSpeed, function () {
        if (settings.hide) settings.hide.call(input.get(0));
        minicolors.removeClass('minicolors-focus');
      });
    });
  }

  // Moves the selected picker
  function move(target, event, animate) {

    var input = target.parents('.minicolors').find('.minicolors-input'),
        settings = input.data('minicolors-settings'),
        picker = target.find('[class$=-picker]'),
        offsetX = target.offset().left,
        offsetY = target.offset().top,
        x = Math.round(event.pageX - offsetX),
        y = Math.round(event.pageY - offsetY),
        duration = animate ? settings.animationSpeed : 0,
        wx,
        wy,
        r,
        phi;

    // Touch support
    if (event.originalEvent.changedTouches) {
      x = event.originalEvent.changedTouches[0].pageX - offsetX;
      y = event.originalEvent.changedTouches[0].pageY - offsetY;
    }

    // Constrain picker to its container
    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x > target.width()) x = target.width();
    if (y > target.height()) y = target.height();

    // Constrain color wheel values to the wheel
    if (target.parent().is('.minicolors-slider-wheel') && picker.parent().is('.minicolors-grid')) {
      wx = 75 - x;
      wy = 75 - y;
      r = Math.sqrt(wx * wx + wy * wy);
      phi = Math.atan2(wy, wx);
      if (phi < 0) phi += Math.PI * 2;
      if (r > 75) {
        r = 75;
        x = 75 - 75 * Math.cos(phi);
        y = 75 - 75 * Math.sin(phi);
      }
      x = Math.round(x);
      y = Math.round(y);
    }

    // Move the picker
    if (target.is('.minicolors-grid')) {
      picker.stop(true).animate({
        top: y + 'px',
        left: x + 'px'
      }, duration, settings.animationEasing, function () {
        updateFromControl(input, target);
      });
    } else {
      picker.stop(true).animate({
        top: y + 'px'
      }, duration, settings.animationEasing, function () {
        updateFromControl(input, target);
      });
    }
  }

  // Sets the input based on the color picker values
  function updateFromControl(input, target) {

    function getCoords(picker, container) {

      var left, top;
      if (!picker.length || !container) return null;
      left = picker.offset().left;
      top = picker.offset().top;

      return {
        x: left - container.offset().left + picker.outerWidth() / 2,
        y: top - container.offset().top + picker.outerHeight() / 2
      };
    }

    var hue,
        saturation,
        brightness,
        x,
        y,
        r,
        phi,
        hex = input.val(),
        opacity = input.attr('data-opacity'),


    // Helpful references
    minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch'),


    // Panel objects
    grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),


    // Picker objects
    gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]'),


    // Picker positions
    gridPos = getCoords(gridPicker, grid),
        sliderPos = getCoords(sliderPicker, slider),
        opacityPos = getCoords(opacityPicker, opacitySlider);

    // Handle colors
    if (target.is('.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider')) {

      // Determine HSB values
      switch (settings.control) {

        case 'wheel':
          // Calculate hue, saturation, and brightness
          x = grid.width() / 2 - gridPos.x;
          y = grid.height() / 2 - gridPos.y;
          r = Math.sqrt(x * x + y * y);
          phi = Math.atan2(y, x);
          if (phi < 0) phi += Math.PI * 2;
          if (r > 75) {
            r = 75;
            gridPos.x = 69 - 75 * Math.cos(phi);
            gridPos.y = 69 - 75 * Math.sin(phi);
          }
          saturation = keepWithin(r / 0.75, 0, 100);
          hue = keepWithin(phi * 180 / Math.PI, 0, 360);
          brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
          break;

        case 'saturation':
          // Calculate hue, saturation, and brightness
          hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
          saturation = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: brightness }));
          minicolors.find('.minicolors-grid-inner').css('opacity', saturation / 100);
          break;

        case 'brightness':
          // Calculate hue, saturation, and brightness
          hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
          saturation = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
          minicolors.find('.minicolors-grid-inner').css('opacity', 1 - brightness / 100);
          break;

        default:
          // Calculate hue, saturation, and brightness
          hue = keepWithin(360 - parseInt(sliderPos.y * (360 / slider.height()), 10), 0, 360);
          saturation = keepWithin(Math.floor(gridPos.x * (100 / grid.width())), 0, 100);
          brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          grid.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: 100 }));
          break;

      }

      // Handle opacity
      if (settings.opacity) {
        opacity = parseFloat(1 - opacityPos.y / opacitySlider.height()).toFixed(2);
      } else {
        opacity = 1;
      }

      updateInput(input, hex, opacity);
    } else {
      // Set swatch color
      swatch.find('span').css({
        backgroundColor: hex,
        opacity: opacity
      });

      // Handle change event
      doChange(input, hex, opacity);
    }
  }

  // Sets the value of the input and does the appropriate conversions
  // to respect settings, also updates the swatch
  function updateInput(input, value, opacity) {
    var rgb,


    // Helpful references
    minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch');

    if (settings.opacity) input.attr('data-opacity', opacity);

    // Set color string
    if (settings.format === 'rgb') {
      // Returns RGB(A) string

      // Checks for input format and does the conversion
      if (isRgb(value)) {
        rgb = parseRgb(value, true);
      } else {
        rgb = hex2rgb(parseHex(value, true));
      }

      opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
      if (isNaN(opacity) || !settings.opacity) opacity = 1;

      if (input.minicolors('rgbObject').a <= 1 && rgb && settings.opacity) {
        // Set RGBA string if alpha
        value = 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
      } else {
        // Set RGB string (alpha = 1)
        value = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
      }
    } else {
      // Returns hex color

      // Checks for input format and does the conversion
      if (isRgb(value)) {
        value = rgbString2hex(value);
      }

      value = convertCase(value, settings.letterCase);
    }

    // Update value from picker
    //globalInput.val( value );
    input.val(value);

    if (inputText) {
      inputText.val(value);
    }

    // Set swatch color
    swatch.find('span').css({
      backgroundColor: value,
      opacity: opacity
    });

    // Handle change event
    doChange(input, value, opacity);
  }

  // Sets the color picker values from the input
  function updateFromInput(input, preserveInputValue) {
    var settings = globalSettings;
    var hex,
        hsb,
        opacity,
        keywords,
        alpha,
        value,
        x,
        y,
        r,
        phi,


    // Helpful references
    minicolors = input.parent(),

    //  settings = input.data('minicolors-settings'),
    swatch = minicolors.find('.minicolors-input-swatch'),


    // Panel objects
    grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),


    // Picker objects
    gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]');

    // Determine hex/HSB values
    if (isRgb(input.val())) {
      // If input value is a rgb(a) string, convert it to hex color and update opacity
      hex = rgbString2hex(input.val());
      alpha = keepWithin(parseFloat(getAlpha(input.val())).toFixed(2), 0, 1);
      if (alpha) {
        input.attr('data-opacity', alpha);
      }
    } else {
      hex = convertCase(parseHex(input.val(), true), settings.letterCase);
    }

    if (!hex) {
      hex = convertCase(parseInput(settings.defaultValue, true), settings.letterCase);
    }
    hsb = hex2hsb(hex);

    // Get array of lowercase keywords
    keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function (a) {
      return $.trim(a.toLowerCase());
    });

    // Set color string
    if (input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1) {
      value = convertCase(input.val());
    } else {
      value = isRgb(input.val()) ? parseRgb(input.val()) : hex;
    }

    // Update input value
    if (!preserveInputValue) {
      globalInput.val(value);

      inputText && inputText.val(value);
    }
    globalSettings = settings;
    // Determine opacity value
    if (settings.opacity) {
      // Get from data-opacity attribute and keep within 0-1 range
      opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
      if (isNaN(opacity)) opacity = 1;
      input.attr('data-opacity', opacity);
      swatch.find('span').css('opacity', opacity);

      // Set opacity picker position
      y = keepWithin(opacitySlider.height() - opacitySlider.height() * opacity, 0, opacitySlider.height());
      opacityPicker.css('top', y + 'px');
    }

    // Set opacity to zero if input value is transparent
    if (input.val().toLowerCase() === 'transparent') {
      swatch.find('span').css('opacity', 0);
    }

    // Update swatch
    swatch.find('span').css('backgroundColor', hex);

    // Determine picker locations
    switch (settings.control) {

      case 'wheel':
        // Set grid position
        r = keepWithin(Math.ceil(hsb.s * 0.75), 0, grid.height() / 2);
        phi = hsb.h * Math.PI / 180;
        x = keepWithin(75 - Math.cos(phi) * r, 0, grid.width());
        y = keepWithin(75 - Math.sin(phi) * r, 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = 150 - hsb.b / (100 / grid.height());
        if (hex === '') y = 0;
        sliderPicker.css('top', y + 'px');

        // Update panel color
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
        break;

      case 'saturation':
        // Set grid position
        x = keepWithin(5 * hsb.h / 12, 0, 150);
        y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.s * (slider.height() / 100), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update UI
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: hsb.b }));
        minicolors.find('.minicolors-grid-inner').css('opacity', hsb.s / 100);
        break;

      case 'brightness':
        // Set grid position
        x = keepWithin(5 * hsb.h / 12, 0, 150);
        y = keepWithin(grid.height() - Math.ceil(hsb.s / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.b * (slider.height() / 100), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update UI
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
        minicolors.find('.minicolors-grid-inner').css('opacity', 1 - hsb.b / 100);
        break;

      default:
        // Set grid position
        x = keepWithin(Math.ceil(hsb.s / (100 / grid.width())), 0, grid.width());
        y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.h / (360 / slider.height()), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update panel color
        grid.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: 100 }));
        break;

    }

    // Fire change event, but only if minicolors is fully initialized
    if (input.data('minicolors-initialized')) {
      doChange(input, value, opacity);
    }
  }

  // Runs the change and changeDelay callbacks
  function doChange(input, value, opacity) {

    var settings = input.data('minicolors-settings'),
        lastChange = input.data('minicolors-lastChange'),
        obj,
        sel,
        i;

    // Only run if it actually changed
    if (!lastChange || lastChange.value !== value || lastChange.opacity !== opacity) {

      // Remember last-changed value
      input.data('minicolors-lastChange', {
        value: value,
        opacity: opacity
      });

      // Check and select applicable swatch
      if (settings.swatches && settings.swatches.length !== 0) {
        if (!isRgb(value)) {
          obj = hex2rgb(value);
        } else {
          obj = parseRgb(value, true);
        }
        sel = -1;
        for (i = 0; i < settings.swatches.length; ++i) {
          if (obj.r === settings.swatches[i].r && obj.g === settings.swatches[i].g && obj.b === settings.swatches[i].b && obj.a === settings.swatches[i].a) {
            sel = i;
            break;
          }
        }

        input.parent().find('.minicolors-swatches .minicolors-swatch').removeClass('selected');
        if (i !== -1) {
          input.parent().find('.minicolors-swatches .minicolors-swatch').eq(i).addClass('selected');
        }
      }

      // Fire change event
      if (settings.change) {
        if (settings.changeDelay) {
          // Call after a delay
          clearTimeout(input.data('minicolors-changeTimeout'));
          input.data('minicolors-changeTimeout', setTimeout(function () {
            settings.change.call(input.get(0), value, opacity);
          }, settings.changeDelay));
        } else {
          // Call immediately
          settings.change.call(input.get(0), value, opacity);
        }
      }
      input.trigger('change').trigger('input');
    }
  }

  // Generates an RGB(A) object based on the input's value
  function rgbObject(input) {
    var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
    if (!rgb) return null;
    if (opacity !== undefined) $.extend(rgb, { a: parseFloat(opacity) });
    return rgb;
  }

  // Generates an RGB(A) string based on the input's value
  function rgbString(input, alpha) {
    var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
    if (!rgb) return null;
    if (opacity === undefined) opacity = 1;
    if (alpha) {
      return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
    } else {
      return 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
    }
  }

  // Converts to the letter case specified in settings
  function convertCase(string, letterCase) {
    return letterCase === 'uppercase' ? string.toUpperCase() : string.toLowerCase();
  }

  // Parses a string and returns a valid hex string when possible
  function parseHex(string, expand) {
    string = string.replace(/^#/g, '');
    if (!string.match(/^[A-F0-9]{3,6}/ig)) return '';
    if (string.length !== 3 && string.length !== 6) return '';
    if (string.length === 3 && expand) {
      string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
    }
    return '#' + string;
  }

  // Parses a string and returns a valid RGB(A) string when possible
  function parseRgb(string, obj) {

    var values = string.replace(/[^\d,.]/g, ''),
        rgba = values.split(',');

    rgba[0] = keepWithin(parseInt(rgba[0], 10), 0, 255);
    rgba[1] = keepWithin(parseInt(rgba[1], 10), 0, 255);
    rgba[2] = keepWithin(parseInt(rgba[2], 10), 0, 255);
    if (rgba[3]) {
      rgba[3] = keepWithin(parseFloat(rgba[3], 10), 0, 1);
    }

    // Return RGBA object
    if (obj) {
      return {
        r: rgba[0],
        g: rgba[1],
        b: rgba[2],
        a: rgba[3] ? rgba[3] : null
      };
    }

    // Return RGBA string
    if (typeof rgba[3] !== 'undefined' && rgba[3] <= 1) {
      return 'rgba(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ', ' + rgba[3] + ')';
    } else {
      return 'rgb(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ')';
    }
  }

  // Parses a string and returns a valid color string when possible
  function parseInput(string, expand) {
    if (isRgb(string)) {
      // Returns a valid rgb(a) string
      return parseRgb(string);
    } else {
      return parseHex(string, expand);
    }
  }

  // Keeps value within min and max
  function keepWithin(value, min, max) {
    if (value < min) value = min;
    if (value > max) value = max;
    return value;
  }

  // Checks if a string is a valid RGB(A) string
  function isRgb(string) {
    var rgb = string.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return rgb && rgb.length === 4 ? true : false;
  }

  // Function to get alpha from a RGB(A) string
  function getAlpha(rgba) {
    rgba = rgba.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+(\.\d{1,2})?|\.\d{1,2})[\s+]?/i);
    return rgba && rgba.length === 6 ? rgba[4] : '1';
  }

  // Converts an HSB object to an RGB object
  function hsb2rgb(hsb) {
    var rgb = {};
    var h = Math.round(hsb.h);
    var s = Math.round(hsb.s * 255 / 100);
    var v = Math.round(hsb.b * 255 / 100);
    if (s === 0) {
      rgb.r = rgb.g = rgb.b = v;
    } else {
      var t1 = v;
      var t2 = (255 - s) * v / 255;
      var t3 = (t1 - t2) * (h % 60) / 60;
      if (h === 360) h = 0;
      if (h < 60) {
        rgb.r = t1;rgb.b = t2;rgb.g = t2 + t3;
      } else if (h < 120) {
        rgb.g = t1;rgb.b = t2;rgb.r = t1 - t3;
      } else if (h < 180) {
        rgb.g = t1;rgb.r = t2;rgb.b = t2 + t3;
      } else if (h < 240) {
        rgb.b = t1;rgb.r = t2;rgb.g = t1 - t3;
      } else if (h < 300) {
        rgb.b = t1;rgb.g = t2;rgb.r = t2 + t3;
      } else if (h < 360) {
        rgb.r = t1;rgb.g = t2;rgb.b = t1 - t3;
      } else {
        rgb.r = 0;rgb.g = 0;rgb.b = 0;
      }
    }
    return {
      r: Math.round(rgb.r),
      g: Math.round(rgb.g),
      b: Math.round(rgb.b)
    };
  }

  // Converts an RGB string to a hex string
  function rgbString2hex(rgb) {
    rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return rgb && rgb.length === 4 ? '#' + ('0' + parseInt(rgb[1], 10).toString(16)).slice(-2) + ('0' + parseInt(rgb[2], 10).toString(16)).slice(-2) + ('0' + parseInt(rgb[3], 10).toString(16)).slice(-2) : '';
  }

  // Converts an RGB object to a hex string
  function rgb2hex(rgb) {
    var hex = [rgb.r.toString(16), rgb.g.toString(16), rgb.b.toString(16)];
    $.each(hex, function (nr, val) {
      if (val.length === 1) hex[nr] = '0' + val;
    });
    return '#' + hex.join('');
  }

  // Converts an HSB object to a hex string
  function hsb2hex(hsb) {
    return rgb2hex(hsb2rgb(hsb));
  }

  // Converts a hex string to an HSB object
  function hex2hsb(hex) {
    var hsb = rgb2hsb(hex2rgb(hex));
    if (hsb.s === 0) hsb.h = 360;
    return hsb;
  }

  // Converts an RGB object to an HSB object
  function rgb2hsb(rgb) {
    var hsb = { h: 0, s: 0, b: 0 };
    var min = Math.min(rgb.r, rgb.g, rgb.b);
    var max = Math.max(rgb.r, rgb.g, rgb.b);
    var delta = max - min;
    hsb.b = max;
    hsb.s = max !== 0 ? 255 * delta / max : 0;
    if (hsb.s !== 0) {
      if (rgb.r === max) {
        hsb.h = (rgb.g - rgb.b) / delta;
      } else if (rgb.g === max) {
        hsb.h = 2 + (rgb.b - rgb.r) / delta;
      } else {
        hsb.h = 4 + (rgb.r - rgb.g) / delta;
      }
    } else {
      hsb.h = -1;
    }
    hsb.h *= 60;
    if (hsb.h < 0) {
      hsb.h += 360;
    }
    hsb.s *= 100 / 255;
    hsb.b *= 100 / 255;
    return hsb;
  }

  // Converts a hex string to an RGB object
  function hex2rgb(hex) {
    hex = parseInt(hex.indexOf('#') > -1 ? hex.substring(1) : hex, 16);
    return {
      /* jshint ignore:start */
      r: hex >> 16,
      g: (hex & 0x00FF00) >> 8,
      b: hex & 0x0000FF
      /* jshint ignore:end */
    };
  }

  // Handle events
  $(document)
  // Hide on clicks outside of the control
  .on('mousedown.minicolors touchstart.minicolors', function (event) {
    if (!$(event.target).parents().add(event.target).hasClass('minicolors')) {
      hide();
    }
  })
  // Start moving
  .on('mousedown.minicolors touchstart.minicolors', '.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider', function (event) {
    var target = $(this);
    event.preventDefault();
    $(document).data('minicolors-target', target);
    move(target, event, true);
  })
  // Move pickers
  .on('mousemove.minicolors touchmove.minicolors', function (event) {
    var target = $(document).data('minicolors-target');
    if (target) move(target, event);
  })
  // Stop moving
  .on('mouseup.minicolors touchend.minicolors', function () {
    $(this).removeData('minicolors-target');
  })
  // Selected a swatch
  .on('click.minicolors', '.minicolors-swatches li', function (event) {
    event.preventDefault();
    var target = $(this),
        input = target.parents('.minicolors').find('.minicolors-input'),
        color = target.data('swatch-color');
    updateInput(input, color, getAlpha(color));
    updateFromInput(input);
  })
  // Show panel when swatch is clicked
  .on('mousedown.minicolors touchstart.minicolors', '.minicolors-input-swatch', function (event) {
    var input = $(this).parent().find('.minicolors-input');
    event.preventDefault();
    if (input.parent().find('.minicolors-panel').css("display") !== "none") {
      //todo
      //hide();
    } else {
      show(input);
    }
  })
  // Show on focus
  .on('focus.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    show(input);
  })
  // Update value on blur
  .on('blur.minicolors', '.minicolors-input', function () {
    var input = $(this),
        settings = input.data('minicolors-settings'),
        keywords,
        hex,
        rgba,
        swatchOpacity,
        value;

    if (!input.data('minicolors-initialized')) return;

    // Get array of lowercase keywords
    keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function (a) {
      return $.trim(a.toLowerCase());
    });

    // Set color string
    if (input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1) {
      value = input.val();
    } else {
      // Get RGBA values for easy conversion
      if (isRgb(input.val())) {
        rgba = parseRgb(input.val(), true);
      } else {
        hex = parseHex(input.val(), true);
        rgba = hex ? hex2rgb(hex) : null;
      }

      // Convert to format
      if (rgba === null) {
        value = settings.defaultValue;
      } else if (settings.format === 'rgb') {
        value = settings.opacity ? parseRgb('rgba(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ',' + input.attr('data-opacity') + ')') : parseRgb('rgb(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ')');
      } else {
        value = rgb2hex(rgba);
      }
    }

    // Update swatch opacity
    swatchOpacity = settings.opacity ? input.attr('data-opacity') : 1;
    if (value.toLowerCase() === 'transparent') swatchOpacity = 0;
    input.closest('.minicolors').find('.minicolors-input-swatch > span').css('opacity', swatchOpacity);

    // Set input value
    input.val(value);

    // Is it blank?
    if (input.val() === '') input.val(parseInput(settings.defaultValue, true));

    // Adjust case
    input.val(convertCase(input.val(), settings.letterCase));
  })
  // Handle keypresses
  .on('keydown.minicolors', '.minicolors-input', function (event) {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    switch (event.keyCode) {
      case 9:
        // tab
        hide();
        break;
      case 13: // enter
      case 27:
        // esc
        hide();
        input.blur();
        break;
    }
  })
  // Update on keyup
  .on('keyup.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    updateFromInput(input, true);
  })
  // Update on paste
  .on('paste.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    setTimeout(function () {
      updateFromInput(input, true);
    }, 1);
  });
});

/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


if (!$.fontSelector) {
  __webpack_require__(72);
}

if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.fonts = ['Arial,Helvetica,sans-serif', 'Arial Black,Gadget,sans-serif', 'Comic Sans MS,cursive', 'Courier New,Courier,monospace', 'Georgia,serif', 'Impact,Charcoal,sans-serif', 'Lucida Console,Monaco,monospace', 'Lucida Sans Unicode,Lucida Grande,sans-serif', 'Palatino Linotype,Book Antiqua,Palatino,serif', 'Tahoma,Geneva,sans-serif', 'Times New Roman,Times,serif', 'Trebuchet MS,Helvetica,sans-serif', 'Verdana,Geneva,sans-serif', 'Gill Sans,Geneva,sans-serif'];

Toolbar.prototype.tools.fontFamily = {
  scope: function scope(data, options) {
    return {
      //currentValue: data.value.get(),
      onchange: function onchange(e) {
        data.value.set(parseFloat($(e.target).val()));
      }
    };
  },
  template: "<div class=\"object-menu-item object-menu-font-family\" title=\"{title}\">\n      <label class=\"btn button-{id} {className}\">\n      <div class=\"fontSelect\" transclude><div class=\"arrow-down\">",
  post: function post($item, data, options, transclude) {

    transclude.fontSelector({
      'hide_fallbacks': true,
      'initial': data.value.get(), //'Courier New,Courier New,Courier,monospace',
      'selected': data.value.set.bind(data.target),
      'fonts': data.data
    });

    this.on("destroy", function () {
      transclude.fontSelector("destroy");
    });
  }
};

/***/ }),
/* 72 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Font Selector - jQuery plugin 0.1
 *
 * Copyright (c) 2012 Chris Dyer
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following
 * conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions
 * and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
 * EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

(function (factory) {
  if (( false ? 'undefined' : _typeof(exports)) === 'object') {
    module.exports = factory(__webpack_require__(7));
  } else {
    factory(jQuery);
  }
})(function ($) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.fontSelect')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.fontSelector.css");
  //}

  var settings;

  var methods = {
    destroy: function destroy(options) {
      this.ul.remove();
    },
    close: function close(options) {
      this.closeUl();
    },
    init: function init(options) {

      settings = $.extend({
        'hide_fallbacks': false,
        'selected': function selected(style) {},
        'opened': function opened() {},
        'closed': function closed() {},
        'initial': '',
        'fonts': []
      }, options);

      var root = this;
      var $root = $(this);
      root.selectedCallback = settings['selected'];
      root.openedCallback = settings['opened'];
      root.closedCallback = settings['closed'];
      var visible = false;
      var selected = false;
      var openedClass = 'fontSelectOpen';

      var displayName = function displayName(font) {
        if (settings['hide_fallbacks']) {
          var index = font.indexOf(',');
          if (index == -1) return font;
          return font.substr(0, index);
        } else return font;
      };

      var select = function select(font, initial) {
        root.find('span').html(displayName(font).replace(/["']{1}/gi, ""));
        root.css('font-family', font);
        selected = font;

        if (!initial) root.selectedCallback(selected);
      };

      var positionUl = function positionUl() {
        var left, top;
        left = $(root).offset().left;
        top = $(root).offset().top + $(root).outerHeight();

        $(ul).css({
          'position': 'absolute',
          'left': left + 'px',
          'top': top + 'px',
          'width': $(root).outerWidth() + 'px'
        });
      };

      var closeUl = this.closeUl = function () {
        ul.slideUp('fast', function () {
          visible = false;
        });

        $root.removeClass(openedClass);

        root.closedCallback();
      };

      var openUi = function openUi() {
        ul.slideDown('fast', function () {
          visible = true;
        });

        $root.addClass(openedClass);

        root.openedCallback();
      };

      // Setup markup
      $root.prepend('<span>' + settings['initial'].replace(/'/g, '&#039;') + '</span>');
      var ul = this.ul = $('<ul class="fontSelectUl"></ul>').appendTo('body');
      ul.hide();
      positionUl();

      for (var i = 0; i < settings['fonts'].length; i++) {
        var item = $('<li>' + displayName(settings['fonts'][i]) + '</li>').appendTo(ul);
        item.css('font-family', settings['fonts'][i]);
        item[0].data = settings['fonts'][i];
      }

      if (settings['initial'] != '') select(settings['initial'], true);

      ul.find('li').click(function () {

        if (!visible) return;

        positionUl();
        closeUl();

        select(this.data);
      });

      $root.click(function (event) {

        if (visible) return;

        event.stopPropagation();

        positionUl();
        openUi();
      });

      $('html').click(function () {
        if (visible) {
          closeUl();
        }
      });
    },
    selected: function selected() {
      return this.data;
    },
    select: function select(font) {
      this.find('span').html(font.substr(0, font.indexOf(',')).replace(/["']{1}/gi, ""));
      this.css('font-family', font);
      var selected = false;
      selected = font;
    }
  };
  $.fontSelector = {};

  $.fn.fontSelector = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if ((typeof method === 'undefined' ? 'undefined' : _typeof(method)) === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on jQuery.fontSelector');
    }
  };
});

/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


;
if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.updateSelectedOption = function (data) {
  var $checked = data.$item.find(":checked");
  var $checkedOptionEl = $($checked.parents()[0]);

  var selOption = data.$item.find('.btn-selected-option');
  selOption.html($checkedOptionEl.find("label")[0].outerHTML);
};

Toolbar.prototype.tools.option = {
  scope: function scope(data, options) {
    var _self = this;
    return {
      parentId: data.parent.id,
      valueCurrent: data.parent.value.get() === data.option,
      onchange: function onchange() {
        //оптимизировать

        var $checked = data.$item.find(":checked");
        var _value = $checked.val();
        if (_value == data.option) {
          data.parent.value.set(_value);
        }
        _self.updateSelectedOption(data.parent);
      }
    };
  },
  template: '<div class="object-menu-item object-menu-option " title="{title}" >' + '<input type="radio" id="tool-{id}" dp-checked="{valueCurrent}" name="{parentId}" value="{option}" onchange="onchange()">' + '<label class="btn button-{id} {className}" for="tool-{id}">' + '<img dp-if="icon" dp-src="icon">' + '<span dp-include="svg" dp-if="svg"></span>' + '<span dp-if="title" class="option-title">{title}</span>'
};

Toolbar.prototype.tools.options = {
  scope: function scope(data, options) {
    return {
      position: options.options && options.options.position,
      className: data.className || 'items-column',
      buttonsTitle: options.buttons && options.buttons.title || false,
      buttonsClassName: options.buttons.className || ''
    };
  },
  template: "<div class=\"object-menu-item object-menu-options {className}\" title=\"{title}\">\n      <div class=\"btn-selected-option\"></div>\n      <div class=\"object-menu-options-container {position}\" transclude>",
  post: function post($item, data, options, transclude) {
    this.generateMenu(data.target, transclude, options, data.menu);
    this.updateSelectedOption(data);
  }
};

/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


;
if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.tools.select = {
  scope: function scope(data, options) {
    return {
      getInputValue: function getInputValue() {
        return parseFloat(data.$item.find("input").val());
      },
      getValue: data.value.get,
      setValue: data.value.set,
      onchange: function onchange(e, model) {
        data.value.set(e.params.data.id, model);
      }
    };
  },
  template: '<div class="object-menu-item object-menu-select {itemClassName}" title="{title}" ><label for="xxx" class="btn button-{id} {className}"></label><select id="xxx">',
  render: function render($item, data, options, tool, val) {
    var model = data.value.options(),
        _val = data.value.get(),
        _select = $item.find("select");

    _select.dpSelect("data", model);
    _select.dpSelect("val", [_val]);
  },
  post: function post($item, data, options, tool, val) {
    var model = data.value.options(),
        _val = data.value.get(),
        _select = $item.find("select");
    var dropdown = data.dropdown;

    _select.dpSelect({
      width: dropdown.width || 40,
      minimumResultsForSearch: dropdown.minimumResultsForSearch || Infinity,
      dropdownParent: this.container.relativeParent(),
      data: model,
      theme: dropdown.theme,
      templateSelection: function templateSelection(state, container) {
        return dropdown.templateSelection(state, container, data);
      },
      templateResult: function templateResult(state, container) {
        return dropdown.templateResult(state, container, data);
      }
    }).on("select2:select", function (e) {
      data.onchange(e, model);
    });
    _select.dpSelect("val", [_val]);

    this.on("destroy", function () {
      _select.dpSelect("destroy");
    });
  }
};

/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  // options.format = 'rgb';
  // options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.tools.effect = {
  scope: function scope(data, options) {
    return {
      buttonsTitle: options.buttons && options.buttons.title || false,
      isParameters: !!data.actionParameters,
      buttonsClassName: options.buttons && options.buttons.className || ''
      // effectClassName: data
    };
  },
  template: '<div class="object-menu-item" title="{title}">' + '<button class="btn button-{id} {className} {buttonsClassName}">' + '<span dp-if="buttonsTitle" class="button-title">{title}</span>' + '</button>' + '<div dp-if="isParameters" class="menu-action-parameters {effectClassName}" style="display: none" transclude></div>' + '</div>',
  post: function post($item, data, options, transclude) {

    if (data.container) {
      transclude = $(document.getElementById(data.container));
    }

    var $tpl;
    var foo = function foo() {
      if (data.effectTpl) {
        $tpl = $(data.effectTpl);
        transclude.html($tpl);
      }
      if (data.actionParametersId) {
        $tpl = $("#" + data.actionParametersId).clone();
        transclude.html($tpl);
      }
      return data.actionParameters.call(data.target, transclude, data, options);
    };
    this.toggleByButton($item, transclude, foo, data);
  }
};

/***/ }),
/* 76 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICB4bWxuczpuczE9Imh0dHA6Ly9zb3ppLmJhaWVyb3VnZS5mciIKICAgIGlkPSJzdmc0ODg4IgogICAgc29kaXBvZGk6ZG9jbmFtZT0id2FybmluZ19idXR0b24uc3ZnIgogICAgdmlld0JveD0iMCAwIDQwMCA0MDAiCiAgICB2ZXJzaW9uPSIxLjEiCiAgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjAgcjk2NTQiCiAgPgogIDxkZWZzCiAgICAgIGlkPSJkZWZzNDg5MCIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTEiCiAgICAgICAgeTI9IjM2Ny44OCIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMjg3LjQ5IgogICAgICAgIHgyPSIzMTUuNDciCiAgICAgICAgeDE9IjI0MS40MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNDE1OCIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNjAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPGZpbHRlcgogICAgICAgIGlkPSJmaWx0ZXI2MTI2IgogICAgICAgIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPGZlR2F1c3NpYW5CbHVyCiAgICAgICAgICBpZD0iZmVHYXVzc2lhbkJsdXI2MTI4IgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIwLjUzMDM1NzEzIgogICAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICAvPgogICAgPC9maWx0ZXIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTMiCiAgICAgICAgeTI9IjM5MS40NSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMzAwLjg2IgogICAgICAgIHgyPSIzNDIiCiAgICAgICAgeDE9IjI3NS42MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNzIwMSIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTAwMDAiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcyMDMiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmYwMDAwIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPHJhZGlhbEdyYWRpZW50CiAgICAgICAgaWQ9InJhZGlhbEdyYWRpZW50ODQxNSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICBjeD0iMzEyLjc4IgogICAgICAgIGN5PSIzODYuNTciCiAgICAgICAgcj0iNTMuMDM2IgogICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLS41OTMyNyAtLjU5MzI3IC43MTUwNSAtLjcxNTA1IDI0My4yNyA4NDkuMDMpIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A3MTEzLTciCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTouNDA4MTYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcxMTUtNyIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmY7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgICBvZmZzZXQ9IjEiCiAgICAgIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50CiAgICA+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgICBpZD0ibGluZWFyR3JhZGllbnQxMDQ0OSIKICAgICAgICB5Mj0iMzM4LjgyIgogICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgIHkxPSIyODYuNjciCiAgICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCguOTU1MzQgMCAwIC45NTUzNCAxMzYuMTIgMTQuMDU1KSIKICAgICAgICB4Mj0iMzAwLjI3IgogICAgICAgIHgxPSIyNTUuMzIiCiAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICA+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNTAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmIgogICAgICAgICAgb2Zmc2V0PSIwIgogICAgICAvPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A0MTUyIgogICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MCIKICAgICAgICAgIG9mZnNldD0iMSIKICAgICAgLz4KICAgIDwvbGluZWFyR3JhZGllbnQKICAgID4KICAgIDxmaWx0ZXIKICAgICAgICBpZD0iZmlsdGVyMTE0MjgiCiAgICAgICAgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8ZmVHYXVzc2lhbkJsdXIKICAgICAgICAgIGlkPSJmZUdhdXNzaWFuQmx1cjExNDMwIgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIxLjI0MzQ2NzgiCiAgICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgIC8+CiAgICA8L2ZpbHRlcgogICAgPgogIDwvZGVmcwogID4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgIGlkPSJiYXNlIgogICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii04IgogICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijk4OCIKICAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICAgaW5rc2NhcGU6em9vbT0iMC43MDcxMDY3OCIKICAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii04IgogICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgICBpbmtzY2FwZTpjeD0iMzA0Ljg5NDA5IgogICAgICBpbmtzY2FwZTpjeT0iMzQxLjUyMTg2IgogICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE2ODAiCiAgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAvPgogIDxnCiAgICAgIGlkPSJsYXllcjEiCiAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC02NTIuMzYpIgogICAgPgogICAgPGcKICAgICAgICBpZD0iZzExNDMyIgogICAgICAgIGlua3NjYXBlOmV4cG9ydC15ZHBpPSI5MCIKICAgICAgICBpbmtzY2FwZTpleHBvcnQteGRwaT0iOTAiCiAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMi45MDUxIDAgMCAyLjkwNTEgLTEwMDEuOSAtNzguOTYxKSIKICAgICAgPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjc2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDojOTk5OTk5IgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTczNTQgMCAwIC45NzM1NCAxMjAuMDkgLTEyLjYyOCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI3OCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTEpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTU5NjAgMCAwIC45NTk2MCAxMjQuMzMgLTcuODAxNCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6I2VjZWNlYyIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjg3MzU1IDAgMCAuODczNTUgMTUwLjQ3IDIxLjk4MSkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MiIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6Izk5OTk5OSIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjgzODM4IDAgMCAuODM4MzggMTYxLjE1IDM0LjE1MikiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4NCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTMpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguODA1ODcgMCAwIC44MDU4NyAxNzEuMDMgNDUuNDA1KSIKICAgICAgICAgIHNvZGlwb2RpOmN5PSIzNDYuMTEyMTgiCiAgICAgICAgICBzb2RpcG9kaTpjeD0iMzAzLjc1IgogICAgICAvPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjg2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDp1cmwoI3JhZGlhbEdyYWRpZW50ODQxNSkiCiAgICAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICAgICBkPSJtMzU2Ljc5IDM0Ni4xMWMwIDI5LjI5MS0yMy43NDUgNTMuMDM2LTUzLjAzNiA1My4wMzZzLTUzLjAzNi0yMy43NDUtNTMuMDM2LTUzLjAzNiAyMy43NDUtNTMuMDM2IDUzLjAzNi01My4wMzYgNTMuMDM2IDIzLjc0NSA1My4wMzYgNTMuMDM2eiIKICAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC43NTgyNSAwIDAgLjc1ODI1IDE4Ni43NSA2My45MDYpIgogICAgICAgICAgc29kaXBvZGk6Y3k9IjM0Ni4xMTIxOCIKICAgICAgICAgIHNvZGlwb2RpOmN4PSIzMDMuNzUiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDcyODgiCiAgICAgICAgICBzdHlsZT0ib3BhY2l0eTouMzE3NzE7ZmlsbDp1cmwoI2xpbmVhckdyYWRpZW50MTA0NDkpIgogICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgIGQ9Im00MTQuOCAyODQuMTVjLTEzLjMzMSAwLjMwMDY5LTI2LjE4NiA3LjM1OC0zMy4zMzYgMTkuNzQyLTcuNjkwMyAxMy4zMi02LjcxMzkgMjkuMjY2IDEuMTU0NSA0MS4zMzEgMC44NTMwNi0yNi41MzIgMjEuMTMyLTQ2LjUxNSA0Ni4zMjQtNDUuMDU0IDguMjU4OSAwLjQ3OTA3IDE2LjA1NCAzLjIwMDEgMjIuODU5IDcuNTkwOC0zLjI1NzgtNy40NDk4LTguODE3MS0xMy45NTMtMTYuMzk0LTE4LjMyNy02LjQ4NjctMy43NDUxLTEzLjYyNS01LjQzOTMtMjAuNjA4LTUuMjgxOHoiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icmVjdDczNzAiCiAgICAgICAgICBkPSJtNDAyLjg4IDMwMC4wOS0xMS41ODEgMTEuNTgxIDEzLjI5NSAxMy4yOTUtMTMuMjk1IDEzLjI4MSAxMS41ODEgMTEuNTgxIDEzLjI4MS0xMy4yOTUgMTMuMjk1IDEzLjI5NSAxMS41ODEtMTEuNTgxLTEzLjI4MS0xMy4yODEgMTMuMjgxLTEzLjI5NS0xMS41ODEtMTEuNTgxLTEzLjI5NSAxMy4yODEtMTMuMjgxLTEzLjI4MXoiCiAgICAgICAgICBzdHlsZT0iZmlsdGVyOnVybCgjZmlsdGVyMTE0MjgpO2ZpbGw6IzFhMWExYSIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDEwNDU3IgogICAgICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICBkPSJtNDAzLjQ1IDMwMS4xNS0xMS4wODcgMTEuMDg3IDEyLjcyOCAxMi43MjgtMTIuNzI4IDEyLjcxNCAxMS4wODcgMTEuMDg3IDEyLjcxNC0xMi43MjggMTIuNzI4IDEyLjcyOCAxMS4wODctMTEuMDg3LTEyLjcxNC0xMi43MTQgMTIuNzE0LTEyLjcyOC0xMS4wODctMTEuMDg3LTEyLjcyOCAxMi43MTQtMTIuNzE0LTEyLjcxNHoiCiAgICAgIC8+CiAgICA8L2cKICAgID4KICA8L2cKICA+CiAgPG1ldGFkYXRhCiAgICA+CiAgICA8cmRmOlJERgogICAgICA+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgPgogICAgICAgIDxkYzpmb3JtYXQKICAgICAgICAgID5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQKICAgICAgICA+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIKICAgICAgICAvPgogICAgICAgIDxjYzpsaWNlbnNlCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICAvPgogICAgICAgIDxkYzpwdWJsaXNoZXIKICAgICAgICAgID4KICAgICAgICAgIDxjYzpBZ2VudAogICAgICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL29wZW5jbGlwYXJ0Lm9yZy8iCiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPk9wZW5jbGlwYXJ0PC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpwdWJsaXNoZXIKICAgICAgICA+CiAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICA+ZXJyb3IgYnV0dG9uPC9kYzp0aXRsZQogICAgICAgID4KICAgICAgICA8ZGM6ZGF0ZQogICAgICAgICAgPjIwMTEtMDItMjRUMTc6NDU6NDU8L2RjOmRhdGUKICAgICAgICA+CiAgICAgICAgPGRjOmRlc2NyaXB0aW9uCiAgICAgICAgLz4KICAgICAgICA8ZGM6c291cmNlCiAgICAgICAgICA+aHR0cHM6Ly9vcGVuY2xpcGFydC5vcmcvZGV0YWlsLzEyMjQyNS9lcnJvci1idXR0b24tYnktcmljYXJkb21haWE8L2RjOnNvdXJjZQogICAgICAgID4KICAgICAgICA8ZGM6Y3JlYXRvcgogICAgICAgICAgPgogICAgICAgICAgPGNjOkFnZW50CiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPnJpY2FyZG9tYWlhPC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpjcmVhdG9yCiAgICAgICAgPgogICAgICAgIDxkYzpzdWJqZWN0CiAgICAgICAgICA+CiAgICAgICAgICA8cmRmOkJhZwogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+YnV0dG9uPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPmNhbmNlbDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5jaXJjbGU8L3JkZjpsaQogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+ZGVsZXRlPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPnJlZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5yb3VuZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgIDwvcmRmOkJhZwogICAgICAgICAgPgogICAgICAgIDwvZGM6c3ViamVjdAogICAgICAgID4KICAgICAgPC9jYzpXb3JrCiAgICAgID4KICAgICAgPGNjOkxpY2Vuc2UKICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICA+CiAgICAgICAgPGNjOnBlcm1pdHMKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyNSZXByb2R1Y3Rpb24iCiAgICAgICAgLz4KICAgICAgICA8Y2M6cGVybWl0cwogICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI0Rpc3RyaWJ1dGlvbiIKICAgICAgICAvPgogICAgICAgIDxjYzpwZXJtaXRzCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjRGVyaXZhdGl2ZVdvcmtzIgogICAgICAgIC8+CiAgICAgIDwvY2M6TGljZW5zZQogICAgICA+CiAgICA8L3JkZjpSREYKICAgID4KICA8L21ldGFkYXRhCiAgPgo8L3N2Zwo+Cg=="

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllcmEuZGV2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIDQwNDlkNjZjNmZmZDJjY2QzMjJiIiwid2VicGFjazovLy9leHRlcm5hbCBcImZhYnJpY1wiIiwid2VicGFjazovLy90b29sYmFyL3Rvb2xiYXIuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL3V0aWwuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL29iamVjdC5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvcGF0aC5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvY29tcGlsZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvY2xpcFRvLmpzIiwid2VicGFjazovLy9leHRlcm5hbCBcIiRcIiIsIndlYnBhY2s6Ly8vc3JjL2ZpZXJhLmpzIiwid2VicGFjazovLy9zcmMvdXRpbC9mYWJyaWMudXRpbC5yZXF1aXJlLmpzIiwid2VicGFjazovLy9zcmMvdXRpbC9kYXRhLmpzIiwid2VicGFjazovLy9wbHVnaW5zL3VuZGVyc2NvcmUuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZnNcIiIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvbG9hZGVyLmpzIiwid2VicGFjazovLy9zcmMvdXRpbC9zeW50YXguanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL3Byb21pc2UuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL3N0cmluZy5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvZmFicmljLnV0aWwub2JqZWN0LmpzIiwid2VicGFjazovLy9zcmMvY29yZS9mYWJyaWMudXRpbC5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvb2JzZXJ2YWJsZS5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvb2JqZWN0LmV4dC5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvaW1hZ2UuZXh0LmpzIiwid2VicGFjazovLy9zcmMvbWl4aW5zL2ltYWdlTWl4aW4uanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL2NhbnZhcy5leHQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL3RleHQuZXh0LmpzIiwid2VicGFjazovLy9zcmMvY29yZS9hcHBsaWNhdGlvbi5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvc2xpZGUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL2FwcGxpY2F0aW9uLnNsaWRlcy5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvYXBwbGljYXRpb24ucHJvdG90eXBlcy5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvYWN0aW9ucy5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvZmFicmljLnN0YXRlcy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZGVidWcuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3NsaWRlLnN0cmV0Y2hhYmxlLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9zbGlkZS50ZW1wbGF0ZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvb2JqZWN0Lm9yZGVyLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9pbWFnZS5maWx0ZXJzLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9nYWxsZXJ5LmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9ncmlkLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9saWJyYXJ5LmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9mcm9tVVJMLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy91cGxvYWQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2luc3RhZ3JhbS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZmFjZWJvb2suanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2Ryb3BwYWJsZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvY2FudmFzLmV2ZW50cy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvaW1hZ2UuY3JvcC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvaW1hZ2UuZnJhbWUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3RodW1iLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9tb3ZlbWVudExpbWl0cy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvc2xpZGUuYXJlYXMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2dyb3Vwcy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvaGlzdG9yeS5qcyIsIndlYnBhY2s6Ly8vc3JjL3BsdWdpbnMvaGlzdG9yeS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvem9vbS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvc3ZnLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9mYWJyaWMudGFiYmFibGUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3N0YXRpY0JvcmRlckNvbG9yLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9pbnRlcmFjdGl2ZU1vZGUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9zaGFwZXMvZnJhbWUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9taXhpbnMvc3Ryb2tlTWl4aW4uanMiLCJ3ZWJwYWNrOi8vL3NyYy9zaGFwZXMvYmFyY29kZS5qcyIsIndlYnBhY2s6Ly8vcGx1Z2lucy9xcmNvZGUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9zaGFwZXMvdGV4dGJveC5tYXhMaW5lcy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvbG9hZGVyLmpzIiwid2VicGFjazovLy8uL21lZGlhL2xvYWRlci5zdmciLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2ZvbnRzLmpzIiwid2VicGFjazovLy9wbHVnaW5zL3dlYmZvbnQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3Rvb2xiYXJzLmpzIiwid2VicGFjazovLy9wbHVnaW5zLyQudXRpbC5qcyIsIndlYnBhY2s6Ly8vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuY29sb3JzLmpzIiwid2VicGFjazovLy9wbHVnaW5zLyQubWluaWNvbG9ycy5qcyIsIndlYnBhY2s6Ly8vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuZm9udHMuanMiLCJ3ZWJwYWNrOi8vL3BsdWdpbnMvJC5mb250U2VsZWN0b3IuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLm9wdGlvbnMuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLnNlbGVjdC5qcyIsIndlYnBhY2s6Ly8vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuZWZmZWN0LmpzIiwid2VicGFjazovLy8uL21lZGlhL2Vycm9yLWJ1dHRvbi5zdmciXSwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gOCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgNDA0OWQ2NmM2ZmZkMmNjZDMyMmIiLCJtb2R1bGUuZXhwb3J0cyA9IGZhYnJpYztcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcImZhYnJpY1wiXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi8uLi9zcmMvdXRpbC91dGlsLmpzJyk7XG51dGlscy5vYmplY3QgPSByZXF1aXJlKCcuLy4uL3NyYy91dGlsL29iamVjdC5qcycpO1xudXRpbHMuY29tcGlsZSA9IHJlcXVpcmUoJy4vLi4vc3JjL3V0aWwvY29tcGlsZS5qcycpO1xuXG5mdW5jdGlvbiBjYXBpdGFsaXplKHN0cmluZywgZmlyc3RMZXR0ZXJPbmx5KSB7XG4gIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgK1xuICAgIChmaXJzdExldHRlck9ubHkgPyBzdHJpbmcuc2xpY2UoMSkgOiBzdHJpbmcuc2xpY2UoMSkudG9Mb3dlckNhc2UoKSk7XG59XG5cbmZ1bmN0aW9uIHRvRGFzaGVkIChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpO1xufVxuXG5cbnZhciBUb29sYmFyID0gZnVuY3Rpb24oUEFSRU5ULCBlbCwgbWVudSwgb3B0aW9ucyl7XG4gIHRoaXMuaW5pdGlhbGl6ZShQQVJFTlQsIGVsLCBtZW51LCBvcHRpb25zKVxufTtcblxuVG9vbGJhci5fZ2V0S2V5U3RyaW5nID0gZnVuY3Rpb24gKGNvbmZpZykge1xuICB2YXIgc3RyaW5nID0gXCJcIjtcblxuICBpZiAoY29uZmlnLmN0cmxLZXkpc3RyaW5nICs9IFwiQ3RybCArIFwiO1xuICBpZiAoY29uZmlnLmFsdEtleSlzdHJpbmcgKz0gXCJBbHQgKyBcIjtcbiAgaWYgKGNvbmZpZy5zaGlmdEtleSlzdHJpbmcgKz0gXCJTaGlmdCArIFwiO1xuXG4gIHZhciBfY29kZSA9IGNvbmZpZy5rZXk7XG4gIGlmKF9jb2RlKXtcbiAgICBzdHJpbmcgKz0gY29uZmlnLmtleTtcbiAgfVxuICByZXR1cm4gc3RyaW5nO1xufTtcblxuVG9vbGJhci5tYWtlQWN0aW9ucyA9IGZ1bmN0aW9uIChhY3Rpb25zLCBQQVJFTlQpIHtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgZm9yICh2YXIgaSBpbiBhY3Rpb25zKSB7XG4gICAgICBhY3Rpb25zW2ldLmlkID0gaTtcbiAgICAgIHZhciBfYWN0aW9uID0gdGhpcy5tYWtlQWN0aW9uKGFjdGlvbnNbaV0sIFBBUkVOVCk7XG4gICAgICBpZihfYWN0aW9uKXtcbiAgICAgICAgcmVzdWx0W2ldID0gX2FjdGlvbjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cblRvb2xiYXIubWFrZUFjdGlvbiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgcGFyZW50KSB7XG4gIHZhciBfT1JJR0lOQUwgPSBvcmlnaW5hbDtcbiAgdmFyIHRhcmdldDtcblxuICBpZiAob3JpZ2luYWwuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgX09SSUdJTkFMID0gb3JpZ2luYWwuY2FsbChwYXJlbnQpO1xuICB9XG5cbiAgaWYgKF9PUklHSU5BTC50YXJnZXQgJiYgX09SSUdJTkFMLnRhcmdldC5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICB0YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0LmNhbGwocGFyZW50KTtcbiAgfSBlbHNlIHtcbiAgICB0YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0IHx8IHBhcmVudDtcbiAgfVxuXG4gIHZhciBfX190YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0O1xuICB2YXIgX19fcGFyZW50ID0gX09SSUdJTkFMLnBhcmVudDtcbiAgZGVsZXRlIF9PUklHSU5BTC5wYXJlbnQ7XG4gIGRlbGV0ZSBfT1JJR0lOQUwudGFyZ2V0O1xuXG4gIHZhciBSRVMgPSB1dGlscy5vYmplY3QuY2xvbmVEZWVwKF9PUklHSU5BTCk7XG4gIF9PUklHSU5BTC5wYXJlbnQgPSBfX19wYXJlbnQ7XG4gIF9PUklHSU5BTC50YXJnZXQgPSBfX190YXJnZXQ7XG5cbiAgUkVTLnBhcmVudCA9IF9fX3BhcmVudDtcbiAgUkVTLnRhcmdldCA9IHRhcmdldDtcbiAgUkVTLmlkID0gdG9EYXNoZWQoX09SSUdJTkFMLmlkKTtcblxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUdldHRlcihwcm9wZXJ0eSx1c2VQYXJlbnQpIHtcbiAgICBpZiAocHJvcGVydHkuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgICByZXR1cm4gcHJvcGVydHk7XG4gICAgfVxuICAgIGlmIChwcm9wZXJ0eS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgICB2YXIgbmVnYXRpdmUgPSBmYWxzZTtcbiAgICAgIGlmIChwcm9wZXJ0eVswXSA9PT0gXCIhXCIpIHtcbiAgICAgICAgcHJvcGVydHkgPSBwcm9wZXJ0eS5zdWJzdHIoMSk7XG4gICAgICAgIG5lZ2F0aXZlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmKHVzZVBhcmVudCl7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYodGhpc1twcm9wZXJ0eV0uY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKXtcbiAgICAgICAgICAgIHJldHVybiAhIXRoaXNbcHJvcGVydHldKCkgXiBuZWdhdGl2ZTtcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHJldHVybiAhIXRoaXNbcHJvcGVydHldIF4gbmVnYXRpdmU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZih0aGlzW3Byb3BlcnR5XS5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pe1xuICAgICAgICAgICAgcmV0dXJuICEhdGhpc1twcm9wZXJ0eV0oKSBeIG5lZ2F0aXZlO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgcmV0dXJuICEhdGhpc1twcm9wZXJ0eV0gXiBuZWdhdGl2ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuXG4gIC8qdmFyIF9pbnNlcnQgPSBfT1JJR0lOQUwuaW5zZXJ0O1xuICBpZiAoIV9pbnNlcnQgfHwgX2luc2VydC5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcblxuICAgIGlmKF9PUklHSU5BTC5wYXJlbnQpe1xuICAgICAgdmFyIGluc2VydHByb3BlcnR5ID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKF9PUklHSU5BTC5wYXJlbnQuaWQpKVxuICAgIH1lbHNle1xuICAgICAgdmFyIGluc2VydHByb3BlcnR5ID0gX2luc2VydCB8fCBcImluc2VydFwiICsgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoaWQsdHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYodGFyZ2V0W2luc2VydHByb3BlcnR5XSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIF9pbnNlcnQgPSB0YXJnZXRbaW5zZXJ0cHJvcGVydHldLy8gY3JlYXRlR2V0dGVyKGluc2VydHByb3BlcnR5LHRydWUpKClcbiAgICB9ZWxzZXtcbiAgICAgIF9pbnNlcnQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGlmKCFfaW5zZXJ0KXJldHVybjsqL1xuXG4gIGlmICghUkVTLnR5cGUpIHtcbiAgICBpZiAoUkVTLm1lbnUpIHtcbiAgICAgIFJFUy50eXBlID0gXCJtZW51XCI7XG4gICAgfWVsc2V7XG4gICAgICBSRVMudHlwZSA9IFwiYnV0dG9uXCI7XG4gICAgfVxuICB9XG4gIGlmICghUkVTLmFjdGlvbikge1xuICAgIGlmKFJFUy50eXBlID09PSBcImJ1dHRvblwiIHx8IFJFUy50eXBlID09PSBcImtleVwiKXtcbiAgICAgIFJFUy5hY3Rpb24gPSBfT1JJR0lOQUwuaWQ7XG4gICAgfVxuICB9XG5cblxuICBpZiAoUkVTLmFjdGlvbikge1xuICAgIGlmIChSRVMuYWN0aW9uLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgIFJFUy5hY3Rpb24gPSB0YXJnZXRbUkVTLmFjdGlvbl07XG4gICAgfVxuICAgIC8vUkVTID0gUkVTLmFjdGlvbi5iaW5kKHRhcmdldCk7XG4gICAgLy9SRVMuYWN0aW9uID0gUkVTLmFjdGlvbi5iaW5kKHRhcmdldCk7XG4gICAgLy9fLmV4dGVuZChSRVMsIF9hY3QpO1xuICAgIC8vYXJndW1lbnRzIGZvciBhY3Rpb24gZnVuY3Rpb25cbiAgICBpZiAoX09SSUdJTkFMLmFyZ3MpIHtcbiAgICAgIFJFUy5fYWN0aW9uID0gUkVTLmFjdGlvbi5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICBSRVMuX2FjdGlvbiA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQpO1xuICAgIH1cbiAgICBSRVMuYWN0aW9uID0gZnVuY3Rpb24oKXtcbiAgICAgIGlmKFJFUy5kaXNhYmxlZClyZXR1cm47XG4gICAgICBSRVMuX2FjdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG4gICAgfVxuICB9XG5cblxuICBpZiAoX09SSUdJTkFMLm1lbnUgJiYgX09SSUdJTkFMLm1lbnUuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgUkVTLm1lbnUgPSBfT1JJR0lOQUwubWVudS5iaW5kKHRhcmdldCk7XG4gIH1cbiAgaWYgKF9PUklHSU5BTC5hY3RpdmUpIHtcbiAgICBSRVMuYWN0aXZlID0gY3JlYXRlR2V0dGVyKF9PUklHSU5BTC5hY3RpdmUpLmJpbmQodGFyZ2V0KTtcbiAgfVxuICBpZiAoX09SSUdJTkFMLnZpc2libGUpIHtcbiAgICBSRVMudmlzaWJsZSA9IGNyZWF0ZUdldHRlcihfT1JJR0lOQUwudmlzaWJsZSkuYmluZCh0YXJnZXQpO1xuICB9XG4gIGlmIChfT1JJR0lOQUwuZW5hYmxlZCkge1xuICAgIFJFUy5lbmFibGVkID0gY3JlYXRlR2V0dGVyKF9PUklHSU5BTC5lbmFibGVkKS5iaW5kKHRhcmdldCk7XG4gIH1cbiAgaWYgKCFfT1JJR0lOQUwudmFsdWUpIHtcbiAgICBzd2l0Y2goX09SSUdJTkFMLnR5cGUpe1xuICAgICAgY2FzZSBcImNvbG9yXCI6XG4gICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgY2FzZSBcInJhbmdlXCI6XG4gICAgICBjYXNlIFwibGFiZWxcIjpcbiAgICAgIGNhc2UgXCJzZWxlY3RcIjpcbiAgICAgIGNhc2UgXCJjaGVja2JveFwiOlxuICAgICAgICBfT1JJR0lOQUwudmFsdWUgPSBfT1JJR0lOQUwuaWQ7XG4gICAgICAvLyBjb25zb2xlLmxvZyhpZCwgX09SSUdJTkFMKTtcbiAgICB9XG4gIH1cbiAgaWYgKF9PUklHSU5BTC52YWx1ZSkge1xuICAgIHZhciBfc2V0LCBfZ2V0LCBfb3B0aW9ucztcbiAgICBpZiAoX09SSUdJTkFMLnZhbHVlLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcblxuICAgICAgdmFyIHNldEZ1bmN0aW9uTmFtZSA9IFwic2V0XCIgKyBjYXBpdGFsaXplKF9PUklHSU5BTC52YWx1ZSwgdHJ1ZSksXG4gICAgICAgIGdldEZ1bmN0aW9uTmFtZSA9IFwiZ2V0XCIgKyBjYXBpdGFsaXplKF9PUklHSU5BTC52YWx1ZSwgdHJ1ZSksXG4gICAgICAgIG1pbk5hbWUgPSBcIm1pblwiICsgY2FwaXRhbGl6ZShfT1JJR0lOQUwudmFsdWUsIHRydWUpLFxuICAgICAgICBtYXhOYW1lID0gXCJtYXhcIiArIGNhcGl0YWxpemUoX09SSUdJTkFMLnZhbHVlLCB0cnVlKSxcbiAgICAgICAgc2V0Rm9vID0gZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICB0YXJnZXRbc2V0RnVuY3Rpb25OYW1lXSh2YWwpO1xuICAgICAgICAgIC8vIHRvZG8gc2VsZi5zZXRGdW5jdGlvbkNhbGxiYWNrKHRhcmdldCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEZvbyA9IHRhcmdldFtnZXRGdW5jdGlvbk5hbWVdLFxuICAgICAgICBtaW5Gb28gPSB0YXJnZXRbbWluTmFtZV0sXG4gICAgICAgIG1heEZvbyA9IHRhcmdldFttYXhOYW1lXTtcblxuICAgICAgX3NldCA9IHNldEZvbyB8fCAoX09SSUdJTkFMLmFyZ3MgP1xuICAgICAgICAgIGZ1bmN0aW9uICh2YWwsIGFyZ3MpIHtcbiAgICAgICAgICAgIHRoaXNbX09SSUdJTkFMLnZhbHVlXVthcmdzXSA9IHZhbDtcbiAgICAgICAgICB9IDpcbiAgICAgICAgICBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICB0aGlzW19PUklHSU5BTC52YWx1ZV0gPSB2YWw7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIF9nZXQgPSBnZXRGb28gfHwgKF9PUklHSU5BTC5hcmdzID9cbiAgICAgICAgICBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbX09SSUdJTkFMLnZhbHVlXVthcmdzXTtcbiAgICAgICAgICB9IDpcbiAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1tfT1JJR0lOQUwudmFsdWVdO1xuICAgICAgICAgIH0pO1xuXG5cbiAgICAgIFJFUy52YWx1ZSA9IHtcbiAgICAgICAgbWluOiBtaW5Gb28sXG4gICAgICAgIG1heDogbWF4Rm9vXG4gICAgICB9XG5cbiAgICB9IGVsc2Uge1xuICAgICAgX3NldCA9IF9PUklHSU5BTC52YWx1ZS5zZXQ7XG4gICAgICBfZ2V0ID0gX09SSUdJTkFMLnZhbHVlLmdldDtcbiAgICAgIF9vcHRpb25zID0gX09SSUdJTkFMLnZhbHVlLm9wdGlvbnM7XG4gICAgfVxuXG4gICAgaWYoUkVTLnZhbHVlLm1pbiAhPT0gdW5kZWZpbmVkICYmIFJFUy52YWx1ZS5taW4uY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBSRVMudmFsdWUubWluID0gdGFyZ2V0W1JFUy52YWx1ZS5taW5dO1xuICAgIH1cbiAgICBpZihSRVMudmFsdWUubWF4ICE9PSB1bmRlZmluZWQgJiYgUkVTLnZhbHVlLm1heC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIFJFUy52YWx1ZS5tYXggPSB0YXJnZXRbUkVTLnZhbHVlLm1heF07XG4gICAgfVxuICAgIGlmKFJFUy52YWx1ZS5zdGVwICE9PSB1bmRlZmluZWQgJiYgUkVTLnZhbHVlLnN0ZXAuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBSRVMudmFsdWUuc3RlcCA9IHRhcmdldFtSRVMudmFsdWUuc3RlcF07XG4gICAgfVxuICAgIHZhciBfbWluID0gUkVTLnZhbHVlLm1pbiwgX21heCA9IFJFUy52YWx1ZS5tYXgsIF9zdGVwID0gUkVTLnZhbHVlLnN0ZXA7XG5cbiAgICBpZiAoX3NldCkge1xuICAgICAgUkVTLnZhbHVlLnNldCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfc2V0LmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfc2V0LmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfZ2V0KSB7XG4gICAgICBSRVMudmFsdWUuZ2V0ID0gKCBfT1JJR0lOQUwuYXJncyA/IF9nZXQuYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9nZXQuYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9taW4gJiYgX21pbi5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgIFJFUy52YWx1ZS5taW4gPSAoIF9PUklHSU5BTC5hcmdzID8gX21pbi5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX21pbi5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX21heCAmJiBfbWF4LmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgICAgUkVTLnZhbHVlLm1heCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfbWF4LmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfbWF4LmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfc3RlcCAmJiBfc3RlcC5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgIFJFUy52YWx1ZS5zdGVwID0gKCBfT1JJR0lOQUwuYXJncyA/IF9zdGVwLmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfc3RlcC5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX29wdGlvbnMpIHtcbiAgICAgIFJFUy52YWx1ZS5vcHRpb25zID0gKCBfT1JJR0lOQUwuYXJncyA/IF9vcHRpb25zLmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfb3B0aW9ucy5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChfT1JJR0lOQUwuZGF0YSkge1xuICAgIFJFUy5kYXRhID0gX09SSUdJTkFMLmRhdGEuY2FsbCh0YXJnZXQpO1xuICB9XG4gIGlmIChSRVMubWVudSkge1xuICAgIGlmIChfT1JJR0lOQUwubWVudS5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pe1xuICAgICAgUkVTLm1lbnUgPSAgX09SSUdJTkFMLm1lbnUuY2FsbCh0YXJnZXQpO1xuICAgIH1cbiAgICBpZiAoUkVTLnR5cGUgPT09IFwib3B0aW9uc1wiKSB7XG4gICAgICBmb3IgKHZhciBpIGluIFJFUy5tZW51KSB7XG4gICAgICAgIFJFUy5tZW51W2ldLnBhcmVudCA9IFJFUztcbiAgICAgICAgUkVTLm1lbnVbaV0udHlwZSA9IFwib3B0aW9uXCI7XG4gICAgICAgIGlmKCFSRVMubWVudVtpXS50aXRsZSl7XG4gICAgICAgICAgUkVTLm1lbnVbaV0udGl0bGUgPSBpO1xuICAgICAgICB9XG4gICAgICAgIGlmKCFSRVMubWVudVtpXS5vcHRpb24pIHtcbiAgICAgICAgICBSRVMubWVudVtpXS5vcHRpb24gPSBpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAodmFyIGkgaW4gUkVTLm1lbnUpIHtcbiAgICAgIGlmKFJFUy5tZW51W2ldLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgICBSRVMubWVudVtpXSA9IFJFUy50YXJnZXQuX2dldEFjdGlvblZhbHVlKFJFUy5tZW51W2ldKTtcbiAgICAgICAgUkVTLm1lbnVbaV0ucGFyZW50ID0gUkVTO1xuICAgICAgfVxuICAgICAgaWYoIVJFUy5tZW51W2ldLmlkKXtcbiAgICAgICAgUkVTLm1lbnVbaV0uaWQgPSBpO1xuICAgICAgfVxuICAgICAgUkVTLm1lbnVbaV0gPSBUb29sYmFyLm1ha2VBY3Rpb24oUkVTLm1lbnVbaV0sIHRhcmdldCk7XG4gICAgICBpZighUkVTLm1lbnVbaV0pe1xuICAgICAgICBkZWxldGUgUkVTLm1lbnVbaV07XG4gICAgICB9XG4gICAgfVxuICB9XG5cblxuICBpZiAoX09SSUdJTkFMLmtleWJvYXJkICE9PSBmYWxzZSAmJiAoX09SSUdJTkFMLmtleSB8fF9PUklHSU5BTC5rZXlDb2RlIHx8IF9PUklHSU5BTC5zaGlmdEtleSB8fCBfT1JJR0lOQUwuYWx0S2V5IHx8IF9PUklHSU5BTC5jdHJsS2V5IHx8IF9PUklHSU5BTC5tZXRhS2V5KSkge1xuICAgIGlmKF9PUklHSU5BTC5rZXkgJiYgX09SSUdJTkFMLmtleS5sZW5ndGggPT0gMSl7XG4gICAgICBSRVMuY3RybEtleSA9IHRydWU7XG4gICAgfVxuICAgIGlmKF9PUklHSU5BTC5rZXlDb2RlICYmIF9PUklHSU5BTC5rZXlDb2RlLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgUkVTLmtleUNvZGUgPSBfT1JJR0lOQUwua2V5Q29kZS50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCk7XG4gICAgICBSRVMua2V5ID0gU3RyaW5nLmZyb21DaGFyQ29kZShSRVMua2V5Q29kZSk7XG4gICAgfVxuICAgIFJFUy5rZXlib2FyZCA9IHRydWVcbiAgfVxuXG4gIHJldHVybiBSRVM7XG59O1xuXG5Ub29sYmFyLmdldEJ1dHRvbnMgPSBmdW5jdGlvbiAoYWN0aW9ucykge1xuICB2YXIgX2J1dHRvbnMgPSBbXTtcbiAgZm9yKHZhciBpIGluIGFjdGlvbnMpe1xuICAgIHZhciBhY3Rpb24gPSBhY3Rpb25zW2ldO1xuICAgIGlmKGFjdGlvbi5rZXlib2FyZCl7XG4gICAgICBhY3Rpb24udGl0bGUgKz0gXCIgKFwiICsgVG9vbGJhci5fZ2V0S2V5U3RyaW5nKGFjdGlvbikgKyBcIilcIjtcbiAgICAgIF9idXR0b25zLnB1c2goYWN0aW9uKTtcbiAgICB9XG4gICAgaWYgKGFjdGlvbnMubWVudSkge1xuICAgICAgX2J1dHRvbnMgPSBfYnV0dG9ucy5jb25jYXQoVG9vbGJhci5nZXRCdXR0b25zKGFjdGlvbnMubWVudSkpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gX2J1dHRvbnM7XG59O1xuVG9vbGJhci5wcm90b3R5cGUgPSB7XG4gIGluaXRLZXlzOiBmdW5jdGlvbiAoYWN0aW9ucykge1xuICAgIHRoaXMuYnV0dG9ucyA9IFRvb2xiYXIuZ2V0QnV0dG9ucyhhY3Rpb25zKTtcbiAgICB0aGlzLl9fa2V5ZG93bkhhbmRsZXIgPSB0aGlzLmhhbmRsZUtleWRvd24uYmluZCh0aGlzKTtcbiAgICAkKGRvY3VtZW50KS5vbiggXCJrZXlkb3duXCIsdGhpcy5fX2tleWRvd25IYW5kbGVyKTtcblxuICAgIC8vJCh3aW5kb3cpLm9uKFwibW91c2V3aGVlbFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAvLyAgZm9yICh2YXIgaSBpbiBzZWxmLmJ1dHRvbnMpIHtcbiAgICAvLyAgICB2YXIgZGF0YSA9IHNlbGYuYnV0dG9uc1tpXTtcbiAgICAvLyAgICBpZiAoIWRhdGEubW91c2V3aGVlbCljb250aW51ZTtcbiAgICAvLyAgICBpZiAoIWRhdGEuY3RybEtleSB8fCBkYXRhLmN0cmxLZXkgJiYgZXZlbnQuY3RybEtleSkge1xuICAgIC8vICAgICAgaWYgKGV2ZW50LmRlbHRhWSA+IDAgJiYgZGF0YS5tb3VzZXdoZWVsID09IFwiPlwiKSB7XG4gICAgLy8gICAgICAgIGRhdGEuYWN0aW9uLmNhbGwodGFyZ2V0LCBkYXRhLm9wdGlvbiB8fCBldmVudCwgZXZlbnQpXG4gICAgLy8gICAgICB9XG4gICAgLy8gICAgICBpZiAoZXZlbnQuZGVsdGFZIDwgMCAmJiBkYXRhLm1vdXNld2hlZWwgPT0gXCI8XCIpIHtcbiAgICAvLyAgICAgICAgZGF0YS5hY3Rpb24uY2FsbCh0YXJnZXQsIGRhdGEub3B0aW9uIHx8IGV2ZW50LCBldmVudClcbiAgICAvLyAgICAgIH1cbiAgICAvLyAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgLy8gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAvLyAgICAgIHJldHVybiBmYWxzZTtcbiAgICAvLyAgICB9XG4gICAgLy8gIH1cbiAgICAvL30pO1xuICB9LFxuICBoYW5kbGVLZXlkb3duOiBmdW5jdGlvbiAoZSkge1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5idXR0b25zKSB7XG4gICAgICB2YXIgX2NvbmZpZyA9IHRoaXMuYnV0dG9uc1tpXTtcblxuICAgICAgaWYoX2NvbmZpZy5lbmFibGVkICYmICFfY29uZmlnLmVuYWJsZWQoKSl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYoX2NvbmZpZy5kaXNhYmxlZCB8fCBfY29uZmlnLmRpc2FibGVkKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoKCFfY29uZmlnLmRpc2FibGVkICYmICFfY29uZmlnLmhpZGRlbikgJiZcbiAgICAgICAgKF9jb25maWcua2V5Q29kZSA9PSBlLmtleUNvZGUgfHwgX2NvbmZpZy5rZXkgPT0gZS5rZXkpICYmXG4gICAgICAgIChfY29uZmlnLmN0cmxLZXkgPT09IHVuZGVmaW5lZCB8fCBfY29uZmlnLmN0cmxLZXkgPT0gZS5jdHJsS2V5ICkgJiZcbiAgICAgICAgKF9jb25maWcuYWx0S2V5ID09PSB1bmRlZmluZWQgfHwgX2NvbmZpZy5hbHRLZXkgPT0gZS5hbHRLZXkgKSAmJlxuICAgICAgICAoX2NvbmZpZy5zaGlmdEtleSA9PT0gdW5kZWZpbmVkIHx8IF9jb25maWcuc2hpZnRLZXkgPT0gZS5zaGlmdEtleSApICYmXG4gICAgICAgIChfY29uZmlnLm1ldGFLZXkgPT09IHVuZGVmaW5lZCB8fCBfY29uZmlnLm1ldGFLZXkgPT0gZS5tZXRhS2V5ICkpIHtcblxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmIChfY29uZmlnLm9wdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgX2NvbmZpZy5hY3Rpb24uY2FsbChfY29uZmlnLnRhcmdldCwgX2NvbmZpZy5vcHRpb24sIGUpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgX2NvbmZpZy5hY3Rpb24uY2FsbChfY29uZmlnLnRhcmdldCwgZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgdG9vbHM6IHtcbiAgICBcImtleVwiOiB7fSxcbiAgICBcImxhYmVsXCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGdldFZhbHVlOiBkYXRhLnZhbHVlLmdldCxcbiAgICAgICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEudmFsdWUuZ2V0KClcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtbGFiZWxcIiB0aXRsZT1cInt0aXRsZX1cIj4nLFxuICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgICAgICB2YXIgc2NvcGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHModG9vbC5zY29wZS5jYWxsKHRoaXMsIGRhdGEsIG9wdGlvbnMpLGRhdGEpO1xuICAgICAgICAkaXRlbS5odG1sKGRhdGEudGVtcGxhdGUuZm9ybWF0KGRhdGEudmFsdWUuZ2V0KCkpKTtcbiAgICAgICAgdXRpbHMuY29tcGlsZS5jb21waWxlRWxlbWVudCgkaXRlbSxzY29wZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcIm51bWJlclwiOiB7XG4gICAgICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBnZXRJbnB1dFZhbHVlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoZGF0YS4kaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKCkpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0VmFsdWU6IGRhdGEudmFsdWUuZ2V0LFxuICAgICAgICAgIHNldFZhbHVlOiBkYXRhLnZhbHVlLnNldCxcbiAgICAgICAgICBtaW5WYWx1ZTogZGF0YS52YWx1ZS5taW4gJiYgZGF0YS52YWx1ZS5taW4oKSxcbiAgICAgICAgICBtYXhWYWx1ZTogZGF0YS52YWx1ZS5tYXggJiYgZGF0YS52YWx1ZS5tYXgoKSxcbiAgICAgICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBkYXRhLnZhbHVlLnNldChwYXJzZUZsb2F0KCQoZS50YXJnZXQpLnZhbCgpKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1udW1iZXJcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8aW5wdXQgdHlwZT1cIm51bWJlclwiIG1pbj1cInttaW5WYWx1ZX1cIiBtYXg9XCJ7bWF4VmFsdWV9XCIgdmFsdWU9XCJ7dmFsdWVDdXJyZW50fVwiIG9uY2hhbmdlPVwib25jaGFuZ2UoZXZlbnQpXCI+JyxcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpIHtcbiAgICAgICAgJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbChkYXRhLnZhbHVlLmdldCgpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwicmFuZ2VcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbWluVmFsdWU6IGRhdGEudmFsdWUubWluID8gdHlwZW9mIGRhdGEudmFsdWUubWluID09IFwiZnVuY3Rpb25cIiA/IGRhdGEudmFsdWUubWluKCkgOiBkYXRhLnZhbHVlLm1pbjogMCxcbiAgICAgICAgICBtYXhWYWx1ZTogZGF0YS52YWx1ZS5tYXggPyB0eXBlb2YgZGF0YS52YWx1ZS5tYXggPT0gXCJmdW5jdGlvblwiID8gZGF0YS52YWx1ZS5tYXgoKSA6IGRhdGEudmFsdWUubWF4OiAxLFxuICAgICAgICAgIHZhbHVlU3RlcDogZGF0YS52YWx1ZS5zdGVwID8gdHlwZW9mIGRhdGEudmFsdWUuc3RlcCA9PSBcImZ1bmN0aW9uXCIgPyBkYXRhLnZhbHVlLnN0ZXAoKSA6IGRhdGEudmFsdWUuc3RlcDogMC4xLFxuICAgICAgICAgIHZhbHVlQ3VycmVudDogZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgICAgICBvbmNoYW5nZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJChlLnRhcmdldCkudmFsKCkpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LXJhbmdlXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAnPGlucHV0IHR5cGU9XCJyYW5nZVwiIHN0ZXA9XCJ7dmFsdWVTdGVwfVwiIG1pbj1cInttaW5WYWx1ZX1cIiBtYXg9XCJ7bWF4VmFsdWV9XCIgdmFsdWU9XCJ7dmFsdWVDdXJyZW50fVwiIG9uY2hhbmdlPVwib25jaGFuZ2UoZXZlbnQpXCI+JyxcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpIHtcbiAgICAgICAgJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbChkYXRhLnZhbHVlLmdldCgpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiY2hlY2tib3hcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBkYXRhLnZhbHVlLnNldChlLnRhcmdldC5jaGVja2VkKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWVDdXJyZW50OiBkYXRhLnZhbHVlLmdldCgpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgYDxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LWNoZWNrYm94XCIgdGl0bGU9XCJ7dGl0bGV9XCI+XG4gICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG9uY2hhbmdlPVwib25jaGFuZ2UoZXZlbnQpXCIgZHAtY2hlY2tlZD1cInt2YWx1ZUN1cnJlbnR9XCIgaWQ9XCJjaGVja2JveC17aWR9XCI+XG4gICAgICAgICAgPGxhYmVsIGZvcj1cImNoZWNrYm94LXtpZH1cIiAgY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX1cIj5gLFxuICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgICAgICAkaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKHZhbCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcIm1lbnVcIjoge1xuICAgICAgdGVtcGxhdGU6XG4gICAgICAgIGA8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1tZW51XCIgdGl0bGU9XCJ7dGl0bGV9XCI+XG4gICAgICAgICAgPGxhYmVsIGRwLWlmPVwidGl0bGVcIiBmb3I9XCJidXR0b24te2lkfVwiPnt0aXRsZX08L2xhYmVsPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnV0dG9uLW1lbnUtdHJpZ2dlciBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiIGlkPVwiYnV0dG9uLXtpZH1cIi8+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51IHN1Ym1lbnVcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCIgdHJhbnNjbHVkZS8+YCxcbiAgICAgIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdHJhbnNjbHVkZSkge1xuICAgICAgICAkaXRlbS5maW5kKFwiLmJ1dHRvbi1tZW51LXRyaWdnZXJcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgJGl0ZW0uZmluZChcIi5vYmplY3QtbWVudVwiKS50b2dnbGUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgaWYgKGRhdGEuaG92ZXJlZCkge1xuICAgICAgICAgICRpdGVtLmFkZENsYXNzKFwiaG92ZXJlZFwiKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUJ5SG92ZXIoJGl0ZW0sIHRyYW5zY2x1ZGUsIG51bGwsIGRhdGEpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEudG9nZ2xlZCkge1xuICAgICAgICAgICRpdGVtLmFkZENsYXNzKFwidG9nZ2xlZFwiKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUJ5QnV0dG9uKCRpdGVtLCB0cmFuc2NsdWRlKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdlbmVyYXRlTWVudShkYXRhLnRhcmdldCwgdHJhbnNjbHVkZSwgb3B0aW9ucywgZGF0YS5tZW51KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiYnV0dG9uXCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJ1dHRvbnNUaXRsZTogb3B0aW9ucy5idXR0b25zICYmIG9wdGlvbnMuYnV0dG9ucy50aXRsZSB8fCBmYWxzZSxcbiAgICAgICAgICBidXR0b25zY0NsYXNzTmFtZTogKG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMuY2xhc3NOYW1lIHx8ICcnKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6XG4gICAgICAgIGA8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbVwiIHRpdGxlPVwie3RpdGxlfVwiPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX0ge2J1dHRvbnNjQ2xhc3NOYW1lfVwiICBvbmNsaWNrPVwiIWRpc2FibGVkICYmIG9wdGlvbiA/IGFjdGlvbihvcHRpb24pIDogYWN0aW9uKClcIj5cbiAgICAgICAgICA8aW1nIGRwLWlmPVwiaWNvblwiIGRwLXNyYz1cImljb25cIj5cbiAgICAgICAgICA8c3BhbiBkcC1pbmNsdWRlPVwic3ZnXCIgZHAtaWY9XCJzdmdcIj48L3NwYW4+XG4gICAgICAgICAgPHNwYW4gZHAtaWY9XCJidXR0b25zVGl0bGVcIiBjbGFzcz1cImJ1dHRvbi10aXRsZVwiPnt0aXRsZX08L3NwYW4+YFxuICAgIH1cbiAgfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oUEFSRU5ULCBlbCwgbWVudSwgb3B0aW9ucyApe1xuICAgIHRoaXMuYnV0dG9ucyA9IFtdO1xuICAgIC8vdG9kbyDRjdGC0L4g0L3QtSDRgdC+0LLRgdC10Lwg0YXQvtGA0L7RiNC+LiDQvdC10LvRjNC30Y8g0YHQvtC30LTQsNGC0Ywg0YPQu9Cx0YDQsNGLINGBINGA0LDQt9C90YvQvNC4INC60L7QvdGE0LjQs9Cw0LzQuCDQutC90L7Qv9C+0LpcbiAgICAvLyB0aGlzLnRvb2xzID0gdXRpbHMub2JqZWN0LmNsb25lRGVlcCh0aGlzLnRvb2xzKTtcblxuXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAvLyBpZiAob3B0aW9ucykge1xuICAgIC8vICAgaWYgKG9wdGlvbnMuYnV0dG9uKSB7XG4gICAgLy8gICAgIHV0aWxzLm9iamVjdC5leHRlbmQodGhpcy50b29scy5idXR0b24sIG9wdGlvbnMuYnV0dG9uKTtcbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgLy8gaWYgKCFQQVJFTlQuZ2VuZXJhdGVkQWN0aW9ucykge1xuICAgIC8vICAgUEFSRU5ULm1ha2VBY3Rpb25zKCBtZW51KTtcbiAgICAvLyB9XG5cbiAgICBpZihlbC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIHRoaXMuY29udGFpbmVyID0gJChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbCkpO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5jb250YWluZXIgPSBlbDtcbiAgICB9XG4gICAgaWYodGhpcy5jb250YWluZXIpe1xuICAgICAgdGhpcy5nZW5lcmF0ZU1lbnUoUEFSRU5ULCB0aGlzLmNvbnRhaW5lciwgb3B0aW9ucywgbWVudSk7XG4gICAgICB0aGlzLmNvbnRhaW5lci5zaG93KCk7XG4gICAgfVxuICAgIHRoaXMuaW5pdEtleXMoUEFSRU5ULmdlbmVyYXRlZEFjdGlvbnMpO1xuICB9LFxuICBkZXN0cm95OiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgZm9yICh2YXIgaSA9IHRoaXMuYnV0dG9ucy5sZW5ndGg7aS0tOykge1xuICAgICAgdmFyIF9jb25maWcgPSB0aGlzLmJ1dHRvbnNbaV07XG4gICAgICBpZih0YXJnZXQgJiYgX2NvbmZpZy50YXJnZXQgIT0gdGFyZ2V0ICl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5idXR0b25zLnNwbGljZShpLDEpO1xuICAgIH1cblxuICAgIGlmKHRoaXMuX19rZXlkb3duSGFuZGxlcil7XG4gICAgICAkKGRvY3VtZW50KS5vZmYoXCJrZXlkb3duXCIsdGhpcy5fX2tleWRvd25IYW5kbGVyKTtcbiAgICB9XG4gICAgdGhpcy5maXJlKFwiZGVzdHJveVwiKTtcbiAgfSxcbiAgY3JlYXRlSW5wdXQ6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgdHlwZSkge1xuXG4gICAgdmFyIHRhcmdldCA9IGRhdGEudGFyZ2V0O1xuICAgIHZhciAkaW5wdXQgPSAkKFwiPGlucHV0PlwiKVxuICAgICAgLmF0dHIoXCJ0eXBlXCIsIHR5cGUpXG4gICAgICAuYXR0cihcIm1pblwiLCBkYXRhLnZhbHVlLm1pbigpKVxuICAgICAgLmF0dHIoXCJtYXhcIiwgZGF0YS52YWx1ZS5tYXgoKSk7XG5cbiAgICAkaW5wdXQudmFsKGRhdGEudmFsdWUuZ2V0KCkpO1xuICAgIGlmIChkYXRhLnZhbHVlLm9ic2VydmUpIHtcbiAgICAgIHZhciBfZm9vID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAkaW5wdXQudmFsKGRhdGEudmFsdWUuZ2V0KCkpO1xuICAgICAgfVxuICAgICAgdGFyZ2V0Lm9uKGRhdGEudmFsdWUub2JzZXJ2ZSwgX2Zvbyk7XG4gICAgICB0aGlzLm9uKFwiZGVzdHJveVwiLGZ1bmN0aW9uKCl7XG4gICAgICAgIHRhcmdldC5vZmYoZGF0YS52YWx1ZS5vYnNlcnZlLCBfZm9vKTtcbiAgICAgIH0pXG4gICAgfVxuICAgICRpbnB1dC5jaGFuZ2UoZnVuY3Rpb24gKGUpIHtcbiAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJGlucHV0LnZhbCgpKSlcbiAgICB9KTtcbiAgICAkaXRlbS5hcHBlbmQoJGlucHV0KTtcbiAgfSxcbiAgaW5pdEl0ZW06IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSkge1xuXG4gICAgaWYgKGRhdGEuYWN0aXZlKSB7XG4gICAgICBpZiAoZGF0YS5hY3RpdmUuY2FsbChkYXRhLnRhcmdldCwgZGF0YS5vcHRpb24pKSB7XG4gICAgICAgICRpdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkYXRhLnZpc2libGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKGRhdGEudmlzaWJsZS5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBpZiAoIWRhdGEudmlzaWJsZS5jYWxsKGRhdGEudGFyZ2V0KSkge1xuICAgICAgICAgICRpdGVtLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghZGF0YS52aXNpYmxlKSB7XG4gICAgICAgICRpdGVtLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkYXRhLmRpc2FibGVkID0gZmFsc2U7XG4gICAgaWYgKGRhdGEuZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAoZGF0YS5lbmFibGVkLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGlmICghZGF0YS5lbmFibGVkLmNhbGwoZGF0YS50YXJnZXQpKSB7XG4gICAgICAgICAgJGl0ZW0uYXR0cihcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgIGRhdGEuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGEub2JzZXJ2ZSAmJiBkYXRhLnRhcmdldCkge1xuICAgICAgLy90b2RvXG4gICAgICBpZiAoZGF0YS52aXNpYmxlICYmIGRhdGEudmlzaWJsZS5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbiApIHtcblxuXG4gICAgICAgIGZ1bmN0aW9uIHZpc2libGVPYnNlcnZlQ2FsbGJhY2sgKCkge1xuICAgICAgICAgIGlmICghZGF0YS52aXNpYmxlLmNhbGwoZGF0YS50YXJnZXQpKSB7XG4gICAgICAgICAgICAkaXRlbS5oaWRlKCk7XG4gICAgICAgICAgICBkYXRhLmhpZGRlbiA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRpdGVtLnNob3coKTtcbiAgICAgICAgICAgIGRhdGEuaGlkZGVuID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGRhdGEub2JzZXJ2ZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgICAgICBkYXRhLnRhcmdldCAmJiBkYXRhLnRhcmdldC5vbihkYXRhLm9ic2VydmUsIHZpc2libGVPYnNlcnZlQ2FsbGJhY2sgKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgZGF0YS5vYnNlcnZlLmNhbGwoZGF0YS50YXJnZXQsIHZpc2libGVPYnNlcnZlQ2FsbGJhY2sgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZGF0YS50eXBlID09IFwib3B0aW9uc1wiKSB7XG4gICAgICAgIGRhdGEudGFyZ2V0ICYmIGRhdGEudGFyZ2V0Lm9uKGRhdGEub2JzZXJ2ZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBfdmFsID0gZGF0YS52YWx1ZS5nZXQoKTtcbiAgICAgICAgICAkKFwiW25hbWU9XCIgKyBkYXRhLmlkICsgXCJdXCIpLnByb3AoXCJjaGVja2VkXCIsZmFsc2UpO1xuICAgICAgICAgICQoXCJbbmFtZT1cIiArIGRhdGEuaWQgKyBcIl1bdmFsdWU9XCIgKyBfdmFsICtcIl1cIikucHJvcChcImNoZWNrZWRcIix0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRhLmVuYWJsZWQgJiYgZGF0YS5lbmFibGVkLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG5cbiAgICAgICAgZnVuY3Rpb24gZW5hYmxlZE9ic2VydmVDYWxsYmFjayAoKSB7XG4gICAgICAgICAgaWYgKCFkYXRhLmVuYWJsZWQuY2FsbChkYXRhLnRhcmdldCkpIHtcbiAgICAgICAgICAgICRpdGVtLmF0dHIoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIGRhdGEuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkaXRlbS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICBkYXRhLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZGF0YS5lbmFibGVDYWxsYmFjayA9IGVuYWJsZWRPYnNlcnZlQ2FsbGJhY2s7XG4gICAgICAgIGlmKGRhdGEub2JzZXJ2ZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgICAgICBkYXRhLnRhcmdldCAmJiBkYXRhLnRhcmdldC5vbihkYXRhLm9ic2VydmUsIGVuYWJsZWRPYnNlcnZlQ2FsbGJhY2sgKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgZGF0YS5vYnNlcnZlLmNhbGwoZGF0YS50YXJnZXQsIGVuYWJsZWRPYnNlcnZlQ2FsbGJhY2sgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZihkYXRhLmRlc3Ryb3kpe1xuICAgICAgICB0aGlzLm9uKFwiZGVzdHJveVwiLGRhdGEuZGVzdHJveS5iaW5kKGRhdGEudGFyZ2V0LGRhdGEpKTtcbiAgICAgICAgZGVsZXRlIGRhdGEuZW5hYmxlZENhbGxiYWNrO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgdG9nZ2xlQnlIb3ZlcjogZnVuY3Rpb24gKCRpdGVtLCAkdG9nZ2xlRWxlbWVudCwgZm9vLGRhdGEpIHtcblxuICAgIHZhciBvbkNsb3NlO1xuXG4gICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICRpdGVtLm1vdXNlb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAgIG9uQ2xvc2UgJiYgb25DbG9zZSgpO1xuICAgIH0pO1xuICAgICRpdGVtLm1vdXNlb3ZlcihmdW5jdGlvbiAoKSB7XG4gICAgICAkdG9nZ2xlRWxlbWVudC5zaG93KCk7XG4gICAgICBvbkNsb3NlID0gZm9vICYmIGZvbygpO1xuICAgIH0pO1xuXG4gICAgJGl0ZW0uY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGRhdGEgJiYgZGF0YS5pbW1lZGlhdGVseSkge1xuICAgICAgICBkYXRhLmFjdGlvbigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICB0b2dnbGVCeUJ1dHRvbjogZnVuY3Rpb24gKCRpdGVtLCAkdG9nZ2xlRWxlbWVudCwgZm9vLGRhdGEpIHtcblxuICAgIHZhciBvbkNsb3NlO1xuICAgIHZhciBfdHJ5X2hpZGUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIF9wYXJlbnRzID0gJChlLnRhcmdldCkucGFyZW50cygpO1xuICAgICAgZm9yICh2YXIgaSBpbiBfcGFyZW50cykge1xuICAgICAgICBpZiAoX3BhcmVudHNbaV0gPT09ICRpdGVtWzBdKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoJHRvZ2dsZUVsZW1lbnQuY3NzKFwiZGlzcGxheVwiKSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICAgICBvbkNsb3NlICYmIG9uQ2xvc2UoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgJHRvZ2dsZUVsZW1lbnQuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfSk7XG4gICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICRpdGVtLmNsaWNrKGZ1bmN0aW9uICgpIHtcblxuICAgICAgaWYgKCR0b2dnbGVFbGVtZW50LmNzcyhcImRpc3BsYXlcIikgIT09IFwibm9uZVwiKSB7XG4gICAgICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAgICAgb25DbG9zZSAmJiBvbkNsb3NlKCk7XG4gICAgICAgICQod2luZG93KS5vZmYoXCJjbGlja1wiLCBfdHJ5X2hpZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHRvZ2dsZUVsZW1lbnQuc2hvdygpO1xuICAgICAgICAkKHdpbmRvdykub24oXCJjbGlja1wiLCBfdHJ5X2hpZGUpO1xuXG4gICAgICAgIG9uQ2xvc2UgPSBmb28gJiYgZm9vKCk7XG5cbiAgICAgICAgaWYoZGF0YSAmJiBkYXRhLmltbWVkaWF0ZWx5KXtcbiAgICAgICAgICBkYXRhLmFjdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgZ2VuZXJhdGVNZW51QnV0dG9uOiBmdW5jdGlvbiAodGFyZ2V0LCAkZWwsIG9wdGlvbnMsIGRhdGEpIHtcblxuICAgIGlmKGRhdGEuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBkYXRhID0gdGFyZ2V0LmFjdGlvbnNbZGF0YV07XG4gICAgfVxuXG4gICAgaWYoIWRhdGEudGFyZ2V0KXtcbiAgICAgIGRhdGEgPSBUb29sYmFyLm1ha2VBY3Rpb24oZGF0YSwgdGFyZ2V0KTtcbiAgICB9XG4gICAgaWYgKCFkYXRhIHx8IGRhdGEuaW5zZXJ0ICE9PSB1bmRlZmluZWQgJiYgIWRhdGEuaW5zZXJ0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGRhdGEudHlwZSA9IGRhdGEudHlwZSB8fCBcImJ1dHRvblwiO1xuXG4gICAgLy90b2RvINC90LXQv9C+0L3Rj9GC0L3QviDQt9Cw0YfQtdC8INCw0YDQs9GD0LzQtdC90YIgdGFyZ2V0INCyINC90LDRh9Cw0LvQtVxuICAgIC8vIHRhcmdldCA9IGRhdGEudGFyZ2V0O1xuXG4gICAgbGV0IHRvb2wgPSB0aGlzLnRvb2xzW2RhdGEudHlwZV07XG5cbiAgICBpZiAoIXRvb2wpIHtcbiAgICAgIGNvbnNvbGUud2FybihcInRvb2wgJ1wiICsgZGF0YS50eXBlICsgXCInIHVuZGVmaW5lZFwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IHNjb3BlID0gZGF0YTtcbiAgICBpZiAodG9vbC5zY29wZSkge1xuICAgICAgc2NvcGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHModG9vbC5zY29wZS5jYWxsKHRoaXMsIGRhdGEsIG9wdGlvbnMpLGRhdGEpO1xuICAgIH1cblxuICAgIGlmKHRvb2wudGVtcGxhdGUpe1xuICAgICAgbGV0ICRpdGVtID0gJCh0b29sLnRlbXBsYXRlLmZvcm1hdChzY29wZSkpO1xuICAgICAgbGV0IHRyYW5zY2x1ZGUgPSAkaXRlbS5maW5kKFwiW3RyYW5zY2x1ZGVdXCIpO1xuICAgICAgc2NvcGUuJGl0ZW0gPSBkYXRhLiRpdGVtID0gJGl0ZW07XG4gICAgICBpZihkYXRhLnRlbXBsYXRlKXtcbiAgICAgICAgJGl0ZW0uaHRtbChkYXRhLnRlbXBsYXRlLmZvcm1hdChkYXRhLnZhbHVlLmdldCgpKSk7XG4gICAgICB9XG5cbiAgICAgIHV0aWxzLmNvbXBpbGUuY29tcGlsZUVsZW1lbnQoJGl0ZW0sc2NvcGUpO1xuXG4gICAgICBpZiAoZGF0YS52YWx1ZSAmJiBkYXRhLnZhbHVlLm9ic2VydmUpIHtcblxuICAgICAgICBsZXQgZm9vID0gKHZhbCkgPT57XG4gICAgICAgICAgaWYgKHRvb2wucG9zdCkge1xuICAgICAgICAgICAgdG9vbC5wb3N0LmNhbGwodGhpcywkaXRlbSwgc2NvcGUsIG9wdGlvbnMsIHRyYW5zY2x1ZGUubGVuZ3RoID8gdHJhbnNjbHVkZSA6IG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZih0b29sLnJlbmRlcil7XG4gICAgICAgICAgICB0b29sLnJlbmRlci5jYWxsKHRoaXMsICRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvL3RoaXMuZmlyZShkYXRhLnR5cGUgKyBcIjpyZW5kZXJcIix7aXRlbTogJGl0ZW0sIGRhdGE6IGRhdGEsIG9wdGlvbnM6IG9wdGlvbnMsIHRvb2w6IHRvb2wsIHZhbDogdmFsfSlcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIF90YXJnZXQgPSBkYXRhLnRhcmdldCB8fCB0YXJnZXQ7XG5cblxuICAgICAgICBfdGFyZ2V0Lm9uKGRhdGEudmFsdWUub2JzZXJ2ZSxmb28gKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pbml0SXRlbSgkaXRlbSwgZGF0YSk7XG5cbiAgICAgIGlmICh0b29sLnBvc3QpIHtcbiAgICAgICAgdG9vbC5wb3N0LmNhbGwodGhpcywkaXRlbSwgc2NvcGUsIG9wdGlvbnMsIHRyYW5zY2x1ZGUubGVuZ3RoID8gdHJhbnNjbHVkZSA6IG51bGwpO1xuICAgICAgfVxuXG4gICAgICAkZWwuYXBwZW5kKCRpdGVtKTtcblxuICAgIH1cblxuICAgIHRoaXMuZmlyZShkYXRhLnR5cGUgKyBcIjpjcmVhdGVkXCIse2RhdGE6IHNjb3BlLCBvcHRpb25zOiBvcHRpb25zLCB0b29sOiB0b29sfSk7XG5cbiAgfSxcbiAgZ2VuZXJhdGVNZW51OiBmdW5jdGlvbiAodGFyZ2V0LCAkZWwsIG9wdGlvbnMsIG1lbnUpIHtcblxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHtcbiAgICAgIHRpdGxlOiBmYWxzZVxuICAgIH07XG5cbiAgICBvcHRpb25zLmJ1dHRvbnMgPSBvcHRpb25zLmJ1dHRvbnMgfHwge1xuICAgICAgY2xhc3NOYW1lOiBcIlwiLFxuICAgICAgdGl0bGU6IGZhbHNlXG4gICAgfTtcblxuICAgICRlbC5lbXB0eSgpO1xuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmVhY2goIG1lbnUsIGRhdGEgPT4ge1xuICAgICAgdGhpcy5nZW5lcmF0ZU1lbnVCdXR0b24odGFyZ2V0LCAkZWwsIG9wdGlvbnMsIGRhdGEpXG4gICAgfSlcbiAgfVxufTtcbnV0aWxzLm9ic2VydmFibGUoVG9vbGJhci5wcm90b3R5cGUpO1xuXG5Ub29sYmFyLnNpbmdsZSA9IGZ1bmN0aW9uKGRhdGEsZWxlbWVudCl7XG4gIGRhdGEuJGl0ZW0gPSBlbGVtZW50O1xuICBkYXRhLnR5cGUgPSBkYXRhLnR5cGUgfHwgXCJidXR0b25cIjtcblxuICB2YXIgdG9vbCA9IFRvb2xiYXIucHJvdG90eXBlLnRvb2xzW2RhdGEudHlwZV07XG5cbiAgVG9vbGJhci5wcm90b3R5cGUuaW5pdEl0ZW0oZWxlbWVudCxkYXRhKTtcblxuICBpZiAoZGF0YS52YWx1ZSAmJiBkYXRhLnZhbHVlLm9ic2VydmUpIHtcbiAgICBkYXRhLnRhcmdldC5vbihkYXRhLnZhbHVlLm9ic2VydmUsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgIHRvb2wucmVuZGVyKCBlbGVtZW50LCBkYXRhLCB7fSwgdG9vbCwgdmFsKVxuICAgIH0pO1xuICB9XG5cbiAgaWYodG9vbC5wb3N0KXtcbiAgICB2YXIgdHJhbnNjbHVkZSA9IGVsZW1lbnQuZmluZChcIlt0cmFuc2NsdWRlXVwiKTtcblxuICAgIHRvb2wucG9zdC5jYWxsKFRvb2xiYXIucHJvdG90eXBlLCBlbGVtZW50LCBkYXRhLCB7fSwgdHJhbnNjbHVkZS5sZW5ndGggPyB0cmFuc2NsdWRlIDogbnVsbCk7XG4gIH1cblxuICB2YXIgc2NvcGUgPSBkYXRhO1xuICBpZih0b29sLnNjb3BlKXtcbiAgICBzY29wZSA9IF8uZGVmYXVsdHMoZGF0YSwgdG9vbC5zY29wZS5jYWxsKFRvb2xiYXIucHJvdG90eXBlLCBkYXRhLCB7fSkpO1xuICB9XG5cbiAgZWxlbWVudC5lYWNoU2VsZihcIipcIixmdW5jdGlvbigpe1xuICAgIHZhciBub2Rlcz1bXSwgdmFsdWVzPVtdO1xuICAgIGZvciAodmFyIGF0dCwgaSA9IDAsIGF0dHMgPSB0aGlzLmF0dHJpYnV0ZXMsIG4gPSBhdHRzLmxlbmd0aDsgaSA8IG47IGkrKyl7XG4gICAgICBhdHQgPSBhdHRzW2ldO1xuICAgICAgbm9kZXMucHVzaChhdHQubm9kZU5hbWUpO1xuICAgICAgdmFsdWVzLnB1c2goYXR0Lm5vZGVWYWx1ZSk7XG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZShhdHQubm9kZU5hbWUsYXR0Lm5vZGVWYWx1ZS5mb3JtYXQoc2NvcGUpKTtcbiAgICB9XG4gIH0pO1xuICB1dGlscy5jb21waWxlLmNvbXBpbGVFbGVtZW50KGVsZW1lbnQsc2NvcGUpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBUb29sYmFyO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHRvb2xiYXIvdG9vbGJhci5qcyIsImxldCB1dGlscyA9IHtcbiAgVXRmOEFycmF5VG9TdHI6IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgdmFyIG91dCwgaSwgbGVuLCBjO1xuICAgIHZhciBjaGFyMiwgY2hhcjM7XG5cbiAgICBvdXQgPSBcIlwiO1xuICAgIGxlbiA9IGFycmF5Lmxlbmd0aDtcbiAgICBpID0gMDtcbiAgICB3aGlsZShpIDwgbGVuKSB7XG4gICAgICBjID0gYXJyYXlbaSsrXTtcbiAgICAgIHN3aXRjaChjID4+IDQpXG4gICAgICB7XG4gICAgICAgIGNhc2UgMDogY2FzZSAxOiBjYXNlIDI6IGNhc2UgMzogY2FzZSA0OiBjYXNlIDU6IGNhc2UgNjogY2FzZSA3OlxuICAgICAgICAvLyAweHh4eHh4eFxuICAgICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMTI6IGNhc2UgMTM6XG4gICAgICAgIC8vIDExMHggeHh4eCAgIDEweHggeHh4eFxuICAgICAgICBjaGFyMiA9IGFycmF5W2krK107XG4gICAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDB4MUYpIDw8IDYpIHwgKGNoYXIyICYgMHgzRikpO1xuICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxNDpcbiAgICAgICAgICAvLyAxMTEwIHh4eHggIDEweHggeHh4eCAgMTB4eCB4eHh4XG4gICAgICAgICAgY2hhcjIgPSBhcnJheVtpKytdO1xuICAgICAgICAgIGNoYXIzID0gYXJyYXlbaSsrXTtcbiAgICAgICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAweDBGKSA8PCAxMikgfFxuICAgICAgICAgICAgKChjaGFyMiAmIDB4M0YpIDw8IDYpIHxcbiAgICAgICAgICAgICgoY2hhcjMgJiAweDNGKSA8PCAwKSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dDtcbiAgfSxcbiAgZGF0YVVSSXRvQmxvYjogZnVuY3Rpb24gKGRhdGFVUkksIGRhdGFUWVBFKSB7XG4gICAgdmFyIGJpbmFyeSA9IGF0b2IoZGF0YVVSSS5zcGxpdCgnLCcpWzFdKSwgYXJyYXkgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmFyeS5sZW5ndGg7IGkrKykge1xuICAgICAgYXJyYXkucHVzaChiaW5hcnkuY2hhckNvZGVBdChpKSk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgQmxvYihbbmV3IFVpbnQ4QXJyYXkoYXJyYXkpXSwge3R5cGU6IGRhdGFUWVBFfSk7XG4gIH0sXG4gIGJsb2JUb0RhdGFVUkw6IGZ1bmN0aW9uIChibG9iLCBjYWxsYmFjaykge1xuICAgIHZhciBhID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICBhLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBjYWxsYmFjayhlLnRhcmdldC5yZXN1bHQpO1xuICAgIH07XG4gICAgYS5yZWFkQXNEYXRhVVJMKGJsb2IpO1xuICB9LFxuICB3b3JrZXI6IGZ1bmN0aW9uIChmb28pIHtcbiAgICBpZiAod2luZG93Lldvcmtlcikge1xuICAgICAgdmFyIHN0ciA9IGZvby50b1N0cmluZygpO1xuICAgICAgdmFyIGV2ZW50QXJnID0gc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIihcIikgKyAxLHN0ci5pbmRleE9mKFwiLFwiKSk7XG4gICAgICB2YXIgcG9zdE1lc3NhZ2VBcmcgPSBzdHIuc3Vic3RyaW5nKHN0ci5pbmRleE9mKFwiLFwiKSArIDEsc3RyLmluZGV4T2YoXCIpXCIpKTtcbiAgICAgIHZhciBfZnVuY3Rpb25Cb2R5ID0gc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIntcIikgKyAxKTtcbiAgICAgIHN0ciA9IFwib25tZXNzYWdlPWZ1bmN0aW9uKFwiICsgZXZlbnRBcmcgKyBcIil7XCIgKyBwb3N0TWVzc2FnZUFyZyArIFwiPSBwb3N0TWVzc2FnZTtcIiArIF9mdW5jdGlvbkJvZHk7XG4gICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtzdHJdKTtcbiAgICAgIC8vXCJvbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7IHBvc3RNZXNzYWdlKCdtc2cgZnJvbSB3b3JrZXInKTsgfVwiXSk7XG4gICAgICB2YXIgYmxvYlVSTCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgcmV0dXJuIG5ldyBXb3JrZXIoYmxvYlVSTCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB3b3JrZXIgPSB7XG4gICAgICAgIHRlcm1pbmF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB9LFxuICAgICAgICBwb3N0TWVzc2FnZTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvbyh7ZGF0YTogZGF0YX0sIGZ1bmN0aW9uIChyZXNwb25zZURhdGEpIHtcbiAgICAgICAgICAgICAgd29ya2VyLm9ubWVzc2FnZSAmJiB3b3JrZXIub25tZXNzYWdlKHtkYXRhOiByZXNwb25zZURhdGF9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gd29ya2VyO1xuICAgIH1cbiAgfSxcbiAgb2JzZXJ2YWJsZTogZnVuY3Rpb24gKG9iaikge1xuICAgIG9iai5maXJlID0gZnVuY3Rpb24gZmlyZShldmVudE5hbWUsIG9wdGlvbnMpIHtcbiAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBsaXN0ZW5lcnNGb3JFdmVudCA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdO1xuICAgICAgaWYgKCFsaXN0ZW5lcnNGb3JFdmVudCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdGVuZXJzRm9yRXZlbnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgbGlzdGVuZXJzRm9yRXZlbnRbaV0uY2FsbCh0aGlzLCBvcHRpb25zIHx8IHt9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgb2JqLm9uID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgICAgaWYgKGV2ZW50TmFtZS5jb25zdHJ1Y3RvciA9PSBPYmplY3QpIHtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBldmVudE5hbWUpIHtcbiAgICAgICAgICB0aGlzLm9uKGksIGV2ZW50TmFtZVtpXSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHZhciBldmVudHMgPSBldmVudE5hbWUuc3BsaXQoXCIgXCIpO1xuICAgICAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlKGV2ZW50c1tpXSwgaGFuZGxlcilcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgb2JqLm9ic2VydmUgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gZXZlbnROYW1lKSB7XG4gICAgICAgICAgdGhpcy5vbihwcm9wLCBldmVudE5hbWVbcHJvcF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkge1xuICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0ucHVzaChoYW5kbGVyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG4gICAgb2JqLm9mZiA9IGZ1bmN0aW9uIHN0b3BPYnNlcnZpbmcoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICBmdW5jdGlvbiBfcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgICAgdmFyIGlkeCA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLmluZGV4T2YoaGFuZGxlcik7XG4gICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVycyA9IHt9O1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuICAgICAgICBmb3IgKHZhciBwcm9wIGluIGV2ZW50TmFtZSkge1xuICAgICAgICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgcHJvcCwgZXZlbnROYW1lW3Byb3BdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgfSxcbiAgb3JkZXI6IGZ1bmN0aW9uKF9hcnJheSxjb250ZXh0ICl7XG4gICAgKGZ1bmN0aW9uIF9jYWxsKCl7XG4gICAgICBpZighX2FycmF5Lmxlbmd0aClyZXR1cm47XG4gICAgICB2YXIgZm9vID0gX2FycmF5LnNoaWZ0KCk7XG4gICAgICBpZihmb28pe1xuICAgICAgICBpZihmb28ubGVuZ3RoKXtcbiAgICAgICAgICBmb28uY2FsbChjb250ZXh0LF9jYWxsKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgZm9vLmNhbGwoY29udGV4dCk7XG4gICAgICAgICAgX2NhbGwoKTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIF9jYWxsKCk7XG4gICAgICB9XG4gICAgfSkoKVxuICB9LFxuICBpbk9yZGVyOiBmdW5jdGlvbiAoYXJyYXksIGZvbywgY2FsbGJhY2spIHtcbiAgICB2YXIgX2luZGV4ID0gMDtcbiAgICBmdW5jdGlvbiBfaW5PcmRlckluZGV4KCkge1xuICAgICAgaWYgKCsrX2luZGV4IDwgYXJyYXkubGVuZ3RoKSB7XG4gICAgICAgIGZvbyhhcnJheVtfaW5kZXhdLCBfaW5kZXgsIF9pbk9yZGVySW5kZXgpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH1cbiAgICBmb28oYXJyYXlbX2luZGV4XSwgX2luZGV4LCBfaW5PcmRlckluZGV4KVxuICB9LFxuICAvKipcbiAgICog0LLQvtC30LLRgNCw0YnQsNC10YIg0L7QsdGK0LXQutGCINGBINC60LvRjtGH0LDQvNC4INGB0YLRgNC+0LrQuCB1cmxcbiAgICogQHJldHVybnMge3t9fVxuICAgKi9cbiAgcXVlcnlTdHJpbmc6IGZ1bmN0aW9uIChxdWVyeSkge1xuICAgIGlmKHF1ZXJ5KSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LnN1YnN0cihxdWVyeS5pbmRleE9mKFwiP1wiKSArIDEpIDtcbiAgICB9ZWxzZXtcbiAgICAgIHF1ZXJ5ID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7XG4gICAgfVxuICAgIHZhciBvYmogPSB7fTtcbiAgICB2YXIgX2xlbmd0aCA9IDA7XG4gICAgaWYgKCFxdWVyeSlyZXR1cm4gb2JqO1xuICAgIHZhciB2YXJzID0gcXVlcnkuc3BsaXQoXCImXCIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHBhaXIgPSB2YXJzW2ldLnNwbGl0KFwiPVwiKTtcbiAgICAgIHZhciBfdm5hbWUgPSBwYWlyWzBdLCB2YWwgPSBwYWlyWzFdO1xuICAgICAgaWYgKHR5cGVvZiBvYmpbX3ZuYW1lXSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBvYmpbX3ZuYW1lXSA9IHZhbCB8fCBcIlwiO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBfbGVuZ3RoLCB7dmFsdWU6IF92bmFtZSwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICAgICAgX2xlbmd0aCsrO1xuICAgICAgICAvLyBJZiBzZWNvbmQgZW50cnkgd2l0aCB0aGlzIG5hbWVcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9ialtfdm5hbWVdID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHZhciBhcnIgPSBbb2JqW192bmFtZV0sIHZhbF07XG4gICAgICAgIG9ialtfdm5hbWVdID0gYXJyO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBfbGVuZ3RoLCB7dmFsdWU6IF92bmFtZSwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICAgICAgX2xlbmd0aCsrO1xuICAgICAgICAvLyBJZiB0aGlyZCBvciBsYXRlciBlbnRyeSB3aXRoIHRoaXMgbmFtZVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqW192bmFtZV0ucHVzaCh2YWwpO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBfbGVuZ3RoLCB7dmFsdWU6IF92bmFtZSwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICAgICAgX2xlbmd0aCsrO1xuICAgICAgfVxuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBcImxlbmd0aFwiLCB7dmFsdWU6IF9sZW5ndGgsIGVudW1lcmFibGU6IGZhbHNlfSk7XG4gICAgcmV0dXJuIG9iajtcbiAgfSxcblxuICBzcGxpdEJ5OiBmdW5jdGlvbiAocXVlcnksIGRlbGltaXRlcikge1xuICAgIHZhciB0cmFjZVF1ZXJpZXMgPSBbXTtcbiAgICB2YXIgciA9IDAsXG4gICAgICBmID0gMCxcbiAgICAgIF9wX3N0YXJ0ID0gMDtcbiAgICBpZiAocXVlcnkgPT0gXCJcIikgcmV0dXJuIFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcXVlcnkubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjID0gcXVlcnlbaV07XG4gICAgICBpZiAoYyA9PSBcIihcIikge1xuICAgICAgICByKys7XG4gICAgICAgIGYgPSAxO1xuICAgICAgfSBlbHNlIGlmIChjID09IFwiKVwiKSB7XG4gICAgICAgIHItLTtcbiAgICAgIH1cbiAgICAgIGlmIChyID09IDAgJiYgZiA9PSAxKSBmID0gMDtcbiAgICAgIGlmIChkZWxpbWl0ZXIuaW5kZXhPZihjKSAhPSAtMSAmJiByID09IDAgJiYgZiA9PSAwKSB7XG4gICAgICAgIHRyYWNlUXVlcmllcy5wdXNoKHF1ZXJ5LnN1YnN0cmluZyhfcF9zdGFydCwgaSkpO1xuICAgICAgICBfcF9zdGFydCA9IGkgKyAxO1xuICAgICAgfVxuICAgIH1cbiAgICB0cmFjZVF1ZXJpZXMucHVzaChxdWVyeS5zdWJzdHJpbmcoX3Bfc3RhcnQpKTtcbiAgICByZXR1cm4gdHJhY2VRdWVyaWVzO1xuICB9LFxuICBxdWV1ZUxvYWQ6IGZ1bmN0aW9uICh0b3RhbCwgY29tcGxldGVDQiwgcHJvZ3Jlc3NDQikge1xuICAgIHZhciBsb2FkZXIgPSBmdW5jdGlvbiAoZWwpIHtcbiAgICAgIGxvYWRlci5sb2FkZWQucHVzaChlbCk7XG4gICAgICBsb2FkZXIucHJvZ3Jlc3NDQiAmJiBsb2FkZXIucHJvZ3Jlc3NDQihsb2FkZXIubG9hZGVkLmxlbmd0aCwgbG9hZGVyLnRvdGFsLCBlbCwgbG9hZGVyLmxvYWRlZCk7XG5cbiAgICAgIGlmIChsb2FkZXIubG9hZGVkLmxlbmd0aCA9PSBsb2FkZXIudG90YWwpIHtcbiAgICAgICAgbG9hZGVyLmNvbXBsZXRlQ0IgJiYgbG9hZGVyLmNvbXBsZXRlQ0IobG9hZGVyLmxvYWRlZCk7XG4gICAgICAgIGxvYWRlci5maXJlKFwibG9hZGVkXCIpO1xuICAgICAgfVxuICAgIH07XG4gICAgbG9hZGVyLmNvbXBsZXRlQ0IgPSBjb21wbGV0ZUNCO1xuICAgIGxvYWRlci5wcm9ncmVzc0NCID0gcHJvZ3Jlc3NDQjtcbiAgICBsb2FkZXIudG90YWwgPSB0b3RhbDtcbiAgICBsb2FkZXIubG9hZGVkID0gW107XG4gICAgdXRpbHMub2JzZXJ2YWJsZShsb2FkZXIpO1xuXG4gICAgcmV0dXJuIGxvYWRlcjtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSAgdXRpbHM7XG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvdXRpbC91dGlsLmpzIiwiXG5sZXQgXyA9IHJlcXVpcmUoXCIuLy4uLy4uL3BsdWdpbnMvdW5kZXJzY29yZVwiKTtcblxubGV0IHV0aWxzID0ge1xuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGFyclxuICAgKiBAcGFyYW0gYXJyMlxuICAgKiBAcmV0dXJucyB7e319XG4gICAqIEBleGFtcGxlXG4gICAqICAgIHggPSB7YTogMSAsYjogMSwgYzogWzEsMl19XG4gICAqICAgIHkgPSB7YTogMiAsICBjIDogMyAsIGQgOiAxfVxuICAgKlxuICAgKiAgICBleHRlbmRBcnJheXNPYmplY3QoeCx5KSA9IHthOiBbMSwyXSBiIDogWzFdIGMgOiBbMSwyLDNdLCBkIFsxXSB9XG4gICAqL1xuICBleHRlbmRBcnJheXNPYmplY3QgOiBmdW5jdGlvbihhcnIsYXJyMil7XG4gICAgdmFyIG5ld0FycmF5ID0ge307XG5cbiAgICBmb3IodmFyIGkgaW4gYXJyKXtcbiAgICAgIGlmKGFycltpXS5jb25zdHJ1Y3RvciA9PSBBcnJheSl7XG4gICAgICAgIG5ld0FycmF5W2ldICA9IFtdLmNvbmNhdChhcnJbaV0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIG5ld0FycmF5W2ldID0gW2FycltpXV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yKHZhciBpIGluIGFycjIpe1xuICAgICAgaWYobmV3QXJyYXlbaV0pe1xuICAgICAgICBuZXdBcnJheVtpXS5wdXNoKGFycjJbaV0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIG5ld0FycmF5W2ldID0gW2FycjJbaV1dO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3QXJyYXk7XG4gIH0sXG4gIGZpbHRlclZhbHVlczogZnVuY3Rpb24gKGFycmF5LCB2YWx1ZXMpIHtcbiAgICB2YXIgbmV3X2FycmF5ID0gW107XG4gICAgZm9yICh2YXIgaSBpbiBhcnJheSkge1xuICAgICAgdmFyIF9uZXdfb2JqZWN0ID0ge307XG4gICAgICBmb3IgKHZhciBqIGluIHZhbHVlcykge1xuICAgICAgICBfbmV3X29iamVjdFt2YWx1ZXNbal1dID0gYXJyYXlbaV1bdmFsdWVzW2pdXVxuICAgICAgfVxuICAgICAgbmV3X2FycmF5LnB1c2goX25ld19vYmplY3QpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3X2FycmF5O1xuICB9LFxuICAvKipcbiAgICogINCi0LDRgdC+0LLQsNC90LjQtSDQpNC40YjQtdGA0LDigJPQmdC10YLRgdCwLNGB0LvRg9GH0LDQudC90L7QtSDRgtCw0YHQvtCy0LDQvdC40LUg0LzQvdC+0LbQtdGB0YLQstCwXG4gICAqIEBwYXJhbSBvYmplY3RcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBzaHVmZmxlOiBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgaWYgKCFvYmplY3QubGVuZ3RoKSByZXR1cm47XG4gICAgdmFyIGkgPSBvYmplY3QubGVuZ3RoO1xuICAgIHdoaWxlICgtLWkpIHtcbiAgICAgIHZhciBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7XG4gICAgICB2YXIgdGVtcCA9IG9iamVjdFtpXTtcbiAgICAgIG9iamVjdFtpXSA9IG9iamVjdFtqXTtcbiAgICAgIG9iamVjdFtqXSA9IHRlbXA7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9iamVjdDsgLy8gZm9yIGNvbnZlbmllbmNlLCBpbiBjYXNlIHdlIHdhbnQgYSByZWZlcmVuY2UgdG8gdGhlIGFycmF5XG4gIH0sXG4gIC8qKlxuICAgKiBEZXBlbmRlbmN5OiB1bmRlcnNjb3JlLmpzICggaHR0cDovL2RvY3VtZW50Y2xvdWQuZ2l0aHViLmNvbS91bmRlcnNjb3JlLyApXG4gICAqXG4gICAqIE1peCBpdCBpbiB3aXRoIHVuZGVyc2NvcmUuanM6XG4gICAqIF8ubWl4aW4oe2RlZXBFeHRlbmQ6IGRlZXBFeHRlbmR9KTtcbiAgICpcbiAgICogQ2FsbCBpdCBsaWtlIHRoaXM6XG4gICAqIHZhciBteU9iaiA9IHV0aWxzLmRlZXBFeHRlbmQoZ3JhbmRwYXJlbnQsIGNoaWxkLCBncmFuZGNoaWxkLCBncmVhdGdyYW5kY2hpbGQpXG4gICAqXG4gICAqIE5vdGVzOlxuICAgKiBLZWVwIGl0IERSWS5cbiAgICogVGhpcyBmdW5jdGlvbiBpcyBlc3BlY2lhbGx5IHVzZWZ1bCBpZiB5b3UncmUgd29ya2luZyB3aXRoIEpTT04gY29uZmlnIGRvY3VtZW50cy4gSXQgYWxsb3dzIHlvdSB0byBjcmVhdGUgYSBkZWZhdWx0XG4gICAqIGNvbmZpZyBkb2N1bWVudCB3aXRoIHRoZSBtb3N0IGNvbW1vbiBzZXR0aW5ncywgdGhlbiBvdmVycmlkZSB0aG9zZSBzZXR0aW5ncyBmb3Igc3BlY2lmaWMgY2FzZXMuIEl0IGFjY2VwdHMgYW55XG4gICAqIG51bWJlciBvZiBvYmplY3RzIGFzIGFyZ3VtZW50cywgZ2l2aW5nIHlvdSBmaW5lLWdyYWluZWQgY29udHJvbCBvdmVyIHlvdXIgY29uZmlnIGRvY3VtZW50IGhpZXJhcmNoeS5cbiAgICpcbiAgICogU3BlY2lhbCBGZWF0dXJlcyBhbmQgQ29uc2lkZXJhdGlvbnM6XG4gICAqIC0gcGFyZW50UkUgYWxsb3dzIHlvdSB0byBjb25jYXRlbmF0ZSBzdHJpbmdzLiBleGFtcGxlOlxuICAgKiAgIHZhciBvYmogPSB1dGlscy5kZWVwRXh0ZW5kKHt1cmw6IFwid3d3LmV4YW1wbGUuY29tXCJ9LCB7dXJsOiBcImh0dHA6Ly8je199L3BhdGgvdG8vZmlsZS5odG1sXCJ9KTtcbiAgICogICBjb25zb2xlLmxvZyhvYmoudXJsKTtcbiAgICogICBvdXRwdXQ6IFwiaHR0cDovL3d3dy5leGFtcGxlLmNvbS9wYXRoL3RvL2ZpbGUuaHRtbFwiXG4gICAqXG4gICAqIC0gcGFyZW50UkUgYWxzbyBhY3RzIGFzIGEgcGxhY2Vob2xkZXIsIHdoaWNoIGNhbiBiZSB1c2VmdWwgd2hlbiB5b3UgbmVlZCB0byBjaGFuZ2Ugb25lIHZhbHVlIGluIGFuIGFycmF5LCB3aGlsZVxuICAgKiAgIGxlYXZpbmcgdGhlIG90aGVycyB1bnRvdWNoZWQuIGV4YW1wbGU6XG4gICAqICAgdmFyIGFyciA9IHV0aWxzLmRlZXBFeHRlbmQoWzEwMCwgICAge2lkOiAxMjM0fSwgdHJ1ZSwgIFwiZm9vXCIsICBbMjUwLCA1MDBdXSxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIFtcIiN7X31cIiwgXCIje199XCIsICAgICBmYWxzZSwgXCIje199XCIsIFwiI3tffVwiXSk7XG4gICAqICAgY29uc29sZS5sb2coYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxMDAsIHtpZDogMTIzNH0sIGZhbHNlLCBcImZvb1wiLCBbMjUwLCA1MDBdXVxuICAgKlxuICAgKiAtIFRoZSBwcmV2aW91cyBleGFtcGxlIGNhbiBhbHNvIGJlIHdyaXR0ZW4gbGlrZSB0aGlzOlxuICAgKiAgIHZhciBhcnIgPSB1dGlscy5kZWVwRXh0ZW5kKFsxMDAsICAgIHtpZDoxMjM0fSwgICB0cnVlLCAgXCJmb29cIiwgIFsyNTAsIDUwMF1dLFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiI3tffVwiLCB7fSwgICAgICAgICAgZmFsc2UsIFwiI3tffVwiLCBbXV0pO1xuICAgKiAgIGNvbnNvbGUubG9nKGFycik7XG4gICAqICAgb3V0cHV0OiBbMTAwLCB7aWQ6IDEyMzR9LCBmYWxzZSwgXCJmb29cIiwgWzI1MCwgNTAwXV1cbiAgICpcbiAgICogLSBBbmQgYWxzbyBsaWtlIHRoaXM6XG4gICAqICAgdmFyIGFyciA9IHV0aWxzLmRlZXBFeHRlbmQoWzEwMCwgICAge2lkOjEyMzR9LCAgIHRydWUsICBcImZvb1wiLCAgWzI1MCwgNTAwXV0sXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICBbXCIje199XCIsIHt9LCAgICAgICAgICBmYWxzZV0pO1xuICAgKiAgIGNvbnNvbGUubG9nKGFycik7XG4gICAqICAgb3V0cHV0OiBbMTAwLCB7aWQ6IDEyMzR9LCBmYWxzZSwgXCJmb29cIiwgWzI1MCwgNTAwXV1cbiAgICpcbiAgICogLSBBcnJheSBvcmRlciBpcyBpbXBvcnRhbnQuIGV4YW1wbGU6XG4gICAqICAgdmFyIGFyciA9IHV0aWxzLmRlZXBFeHRlbmQoWzEsIDIsIDMsIDRdLCBbMSwgNCwgMywgMl0pO1xuICAgKiAgIGNvbnNvbGUubG9nKGFycik7XG4gICAqICAgb3V0cHV0OiBbMSwgNCwgMywgMl1cbiAgICpcbiAgICogLSBZb3UgY2FuIHJlbW92ZSBhbiBhcnJheSBlbGVtZW50IHNldCBpbiBhIHBhcmVudCBvYmplY3QgYnkgc2V0dGluZyB0aGUgc2FtZSBpbmRleCB2YWx1ZSB0byBudWxsIGluIGEgY2hpbGQgb2JqZWN0LlxuICAgKiAgIGV4YW1wbGU6XG4gICAqICAgdmFyIG9iaiA9IHV0aWxzLmRlZXBFeHRlbmQoe2FycjogWzEsIDIsIDMsIDRdfSwge2FycjogW1wiI3tffVwiLCBudWxsXX0pO1xuICAgKiAgIGNvbnNvbGUubG9nKG9iai5hcnIpO1xuICAgKiAgIG91dHB1dDogWzEsIDMsIDRdXG4gICAqXG4gICAqKi9cbiAgZGVlcEV4dGVuZDogZnVuY3Rpb24gKC8qb2JqXzEsIFtvYmpfMl0sIFtvYmpfTl0qLykge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMSB8fCB0eXBlb2YgYXJndW1lbnRzWzBdICE9PSAnb2JqZWN0Jykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHJldHVybiBhcmd1bWVudHNbMF07XG5cbiAgICB2YXIgdGFyZ2V0ID0gYXJndW1lbnRzWzBdO1xuXG4gICAgLy8gY29udmVydCBhcmd1bWVudHMgdG8gYXJyYXkgYW5kIGN1dCBvZmYgdGFyZ2V0IG9iamVjdFxuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcblxuICAgIHZhciBrZXksIHZhbCwgc3JjLCBjbG9uZSwgdG1wQnVmO1xuXG4gICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JykgcmV0dXJuO1xuXG4gICAgICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICAgICAgaWYgKCEoa2V5IGluIG9iaikpIGNvbnRpbnVlO1xuXG4gICAgICAgIHNyYyA9IHRhcmdldFtrZXldO1xuICAgICAgICB2YWwgPSB1dGlscy5jbG9uZURlZXAob2JqW2tleV0pO1xuXG5cbiAgICAgICAgaWYgKHR5cGVvZiBzcmMgIT09ICdvYmplY3QnIHx8IHNyYyA9PT0gbnVsbCkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsO1xuICAgICAgICB9ZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7XG4gICAgICAgICAgY2xvbmUgPSAoQXJyYXkuaXNBcnJheShzcmMpKSA/IHNyYyA6IFtdO1xuXG4gICAgICAgICAgdmFsLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICBjbG9uZS5wdXNoKHV0aWxzLmNsb25lRGVlcChpdGVtKSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0YXJnZXRba2V5XSA9IGNsb25lO1xuICAgICAgICAgIC8vdG9kbyAg0LXRgdC70Lgg0LfQsNC40LzRgdGC0LLRg9C10Lwg0LzQsNGB0YHQuNCyICwg0YLQviDRgdGB0L7RhdGA0LDQvdGP0LXQvCDQt9C90LDRh9C10L3QuNGPINC40Lcg0L7QsdC+0LjRhSDQvNCw0YHRgdC40LLQvtCyXG4gICAgICAgICAgLy90YXJnZXRba2V5XSA9IHV0aWxzLmRlZXBFeHRlbmQoY2xvbmUsIHZhbCk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjbG9uZSA9ICghQXJyYXkuaXNBcnJheShzcmMpKSA/IHNyYyA6IHt9O1xuICAgICAgICAgIHRhcmdldFtrZXldID0gdXRpbHMuZGVlcEV4dGVuZChjbG9uZSwgdmFsKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9LFxuICBjbG9uZURlZXA6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKHZhbCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUodmFsLmdldFRpbWUoKSk7XG4gICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgIHJldHVybiBuZXcgUmVnRXhwKHZhbCk7XG4gICAgfVxuXG4gICAgaWYodmFsLmNsb25lU3luYyl7XG4gICAgICByZXR1cm4gdmFsLmNsb25lU3luYygpO1xuICAgIH1lbHNlIGlmKHZhbC5jb25zdHJ1Y3RvciA9PSBPYmplY3Qpe1xuICAgICAgcmV0dXJuIHV0aWxzLmRlZXBFeHRlbmQoe30sIHZhbCk7XG4gICAgfWVsc2UgaWYodmFsLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHZhciBjbG9uZSA9IFtdO1xuICAgICAgZm9yKHZhciBpID0wIDtpIDwgdmFsLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgY2xvbmUucHVzaCh1dGlscy5jbG9uZURlZXAodmFsW2ldKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2xvbmU7XG4gICAgfWVsc2V7XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH1cbiAgfSxcbiAgcmVhcnJhbmdlOiBmdW5jdGlvbiAob2JqZWN0LCBrZXlzKSB7XG4gICAgdmFyIF9uZXdPcmRlciA9IHt9O1xuICAgIGZvciAodmFyIGkgaW4ga2V5cykge1xuICAgICAgaWYob2JqZWN0W2tleXNbaV1dICE9PSB1bmRlZmluZWQpe1xuICAgICAgICBfbmV3T3JkZXJba2V5c1tpXV0gPSBvYmplY3Rba2V5c1tpXV1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9uZXdPcmRlcjtcbiAgfSxcbiAgY29weVZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gICAgaWYgKHZhbHVlID09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cbiAgICBzd2l0Y2ggKHZhbHVlLmNvbnN0cnVjdG9yKSB7XG4gICAgICBjYXNlIE9iamVjdDpcbiAgICAgICAgcmV0dXJuIHV0aWxzLmRlZXBFeHRlbmQoe30sIHZhbHVlKTtcbiAgICAgIGNhc2UgQXJyYXk6XG4gICAgICAgIHJldHVybiB1dGlscy5kZWVwRXh0ZW5kKFtdLCB2YWx1ZSk7XG4gICAgICBjYXNlIFN0cmluZzpcbiAgICAgIGNhc2UgTnVtYmVyOlxuICAgICAgY2FzZSBCb29sZWFuOlxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICAvL2NvbnNvbGUubG9nKHZhbHVlLmNvbnN0cnVjdG9yKTtcbiAgICAgICAgcmV0dXJuIHV0aWxzLmRlZXBFeHRlbmQoe30sIHZhbHVlKTtcbiAgICB9XG4gIH0sXG4gIGNsZWFyVmFsdWU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUuY29uc3RydWN0b3IpIHtcbiAgICAgIGNhc2UgT2JqZWN0OlxuICAgICAgICBmb3IgKHZhciBtZW1iZXIgaW4gdmFsdWUpIGRlbGV0ZSB2YWx1ZVttZW1iZXJdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQXJyYXk6XG4gICAgICAgIHZhbHVlLmxlbmd0aCA9IDA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgIC8vZGVsZXRlIHZhbHVlO1xuICAgIH1cbiAgfSxcbiAgZGlmZmVyZW5jZTogZnVuY3Rpb24gKHByZXYsIG5vdykge1xuICAgIHZhciBjaGFuZ2VzID0ge307XG4gICAgZm9yICh2YXIgcHJvcCBpbiBub3cpIHtcbiAgICAgIGlmICghcHJldiB8fCBwcmV2W3Byb3BdICE9PSBub3dbcHJvcF0pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBub3dbcHJvcF0gPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgIHZhciBjID0gdXRpbHMuZGlmZmVyZW5jZShwcmV2W3Byb3BdLCBub3dbcHJvcF0pO1xuICAgICAgICAgIGlmICghXy5pc0VtcHR5KGMpKSAvLyB1bmRlcnNjb3JlXG4gICAgICAgICAgICBjaGFuZ2VzW3Byb3BdID0gYztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjaGFuZ2VzW3Byb3BdID0gbm93W3Byb3BdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGFuZ2VzO1xuICB9LFxuICBjbG9uZTogZnVuY3Rpb24ob2JqZWN0LCBkZWVwKXtcbiAgICBpZihkZWVwKXtcbiAgICAgIHJldHVybiB1dGlscy5jbG9uZURlZXAob2JqZWN0KTtcbiAgICB9ZWxzZXtcbiAgICAgIHJldHVybiB1dGlscy5leHRlbmQoe30sb2JqZWN0KTtcbiAgICB9XG4gIH1cbn07XG5cblxuXy5kZWZhdWx0cyh1dGlscyxfKTtcblxubW9kdWxlLmV4cG9ydHMgPSB1dGlscztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvdXRpbC9vYmplY3QuanMiLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgcmVzb2x2ZTogZnVuY3Rpb24gKHBhdGgpIHtcbiAgICB2YXIgY2h1bmtzID0gcGF0aC5zcGxpdChcIi9cIik7XG4gICAgdmFyIHByZXYgPSAwO1xuICAgIGZvciAodmFyIGkgPSBjaHVua3MubGVuZ3RoOyBpLS0gPiAwOykge1xuICAgICAgaWYgKGNodW5rc1tpXSA9PSBcIi4uXCIpIHtcbiAgICAgICAgcHJldisrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2hpbGUgKHByZXYgPiAwKSB7XG4gICAgICAgICAgY2h1bmtzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBjaHVua3Muc3BsaWNlKGktLSwgMSk7XG4gICAgICAgICAgcHJldi0tO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaHVua3Muam9pbihcIi9cIik7XG4gIH0sXG4gIGdldFBhcmVudERpcmVjdG9yeVVybDogZnVuY3Rpb24gKHVybCkge1xuICAgIHJldHVybiB1cmwuc3Vic3RyKDAsIHVybC5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcbiAgfVxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL3BhdGguanMiLCJcblN0cmluZy5wcm90b3R5cGUuZm9ybWF0ICA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHN0ciA9IHRoaXMudG9TdHJpbmcoKTtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICB2YXIgdHlwZSA9IHR5cGVvZiBhcmd1bWVudHNbMF1cbiAgICAgICwgYXJncyA9IHR5cGUgPT0gJ3N0cmluZycgfHwgdHlwZSA9PSAnbnVtYmVyJyA/IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykgOiBhcmd1bWVudHNbMF1cbiAgICAvL1xuICAgIC8vIGZvciAodmFyIGFyZyBpbiBhcmdzKSBzdHIgPSBzdHIucmVwbGFjZShuZXcgUmVnRXhwKCdcXFxceycgKyBhcmcgKyAnXFxcXH0nLCAnZ2knKSwgYXJnc1thcmddKVxuXG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL1xceyhbXn1dKilcXH0vZyxmdW5jdGlvbihhLGIpe1xuICAgICAgcmV0dXJuIHV0aWxzLmV2YWxJbkNvbnRleHQoYixhcmdzKVxuICAgIH0pXG4gIH1cblxuICByZXR1cm4gc3RyXG59O1xuXG52YXIgdXRpbHMgPSB7XG4gIGV4dHJhY3RWYXJpYWJsZXM6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICByZXR1cm4gc3RyLm1hdGNoKC8oPyEoPzpkb3xpZnxpbnxmb3J8bGV0fG5ld3x0cnl8dmFyfGNhc2V8ZWxzZXxlbnVtfGV2YWx8ZmFsc2V8bnVsbHx0aGlzfHRydWV8dm9pZHx3aXRofGJyZWFrfGNhdGNofGNsYXNzfGNvbnN0fHN1cGVyfHRocm93fHdoaWxlfHlpZWxkfGRlbGV0ZXxleHBvcnR8aW1wb3J0fHB1YmxpY3xyZXR1cm58c3RhdGljfHN3aXRjaHx0eXBlb2Z8ZGVmYXVsdHxleHRlbmRzfGZpbmFsbHl8cGFja2FnZXxwcml2YXRlfGNvbnRpbnVlfGRlYnVnZ2VyfGZ1bmN0aW9ufGFyZ3VtZW50c3xpbnRlcmZhY2V8cHJvdGVjdGVkfGltcGxlbWVudHN8aW5zdGFuY2VvZikkKVskQS1aXFxfYS16XFx4YWFcXHhiNVxceGJhXFx4YzAtXFx4ZDZcXHhkOC1cXHhmNlxceGY4LVxcdTAyYzFcXHUwMmM2LVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVjXFx1MDJlZVxcdTAzNzAtXFx1MDM3NFxcdTAzNzZcXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM4NlxcdTAzODgtXFx1MDM4YVxcdTAzOGNcXHUwMzhlLVxcdTAzYTFcXHUwM2EzLVxcdTAzZjVcXHUwM2Y3LVxcdTA0ODFcXHUwNDhhLVxcdTA1MjdcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVkMC1cXHUwNWVhXFx1MDVmMC1cXHUwNWYyXFx1MDYyMC1cXHUwNjRhXFx1MDY2ZVxcdTA2NmZcXHUwNjcxLVxcdTA2ZDNcXHUwNmQ1XFx1MDZlNVxcdTA2ZTZcXHUwNmVlXFx1MDZlZlxcdTA2ZmEtXFx1MDZmY1xcdTA2ZmZcXHUwNzEwXFx1MDcxMi1cXHUwNzJmXFx1MDc0ZC1cXHUwN2E1XFx1MDdiMVxcdTA3Y2EtXFx1MDdlYVxcdTA3ZjRcXHUwN2Y1XFx1MDdmYVxcdTA4MDAtXFx1MDgxNVxcdTA4MWFcXHUwODI0XFx1MDgyOFxcdTA4NDAtXFx1MDg1OFxcdTA4YTBcXHUwOGEyLVxcdTA4YWNcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NzEtXFx1MDk3N1xcdTA5NzktXFx1MDk3ZlxcdTA5ODUtXFx1MDk4Y1xcdTA5OGZcXHUwOTkwXFx1MDk5My1cXHUwOWE4XFx1MDlhYS1cXHUwOWIwXFx1MDliMlxcdTA5YjYtXFx1MDliOVxcdTA5YmRcXHUwOWNlXFx1MDlkY1xcdTA5ZGRcXHUwOWRmLVxcdTA5ZTFcXHUwOWYwXFx1MDlmMVxcdTBhMDUtXFx1MGEwYVxcdTBhMGZcXHUwYTEwXFx1MGExMy1cXHUwYTI4XFx1MGEyYS1cXHUwYTMwXFx1MGEzMlxcdTBhMzNcXHUwYTM1XFx1MGEzNlxcdTBhMzhcXHUwYTM5XFx1MGE1OS1cXHUwYTVjXFx1MGE1ZVxcdTBhNzItXFx1MGE3NFxcdTBhODUtXFx1MGE4ZFxcdTBhOGYtXFx1MGE5MVxcdTBhOTMtXFx1MGFhOFxcdTBhYWEtXFx1MGFiMFxcdTBhYjJcXHUwYWIzXFx1MGFiNS1cXHUwYWI5XFx1MGFiZFxcdTBhZDBcXHUwYWUwXFx1MGFlMVxcdTBiMDUtXFx1MGIwY1xcdTBiMGZcXHUwYjEwXFx1MGIxMy1cXHUwYjI4XFx1MGIyYS1cXHUwYjMwXFx1MGIzMlxcdTBiMzNcXHUwYjM1LVxcdTBiMzlcXHUwYjNkXFx1MGI1Y1xcdTBiNWRcXHUwYjVmLVxcdTBiNjFcXHUwYjcxXFx1MGI4M1xcdTBiODUtXFx1MGI4YVxcdTBiOGUtXFx1MGI5MFxcdTBiOTItXFx1MGI5NVxcdTBiOTlcXHUwYjlhXFx1MGI5Y1xcdTBiOWVcXHUwYjlmXFx1MGJhM1xcdTBiYTRcXHUwYmE4LVxcdTBiYWFcXHUwYmFlLVxcdTBiYjlcXHUwYmQwXFx1MGMwNS1cXHUwYzBjXFx1MGMwZS1cXHUwYzEwXFx1MGMxMi1cXHUwYzI4XFx1MGMyYS1cXHUwYzMzXFx1MGMzNS1cXHUwYzM5XFx1MGMzZFxcdTBjNThcXHUwYzU5XFx1MGM2MFxcdTBjNjFcXHUwYzg1LVxcdTBjOGNcXHUwYzhlLVxcdTBjOTBcXHUwYzkyLVxcdTBjYThcXHUwY2FhLVxcdTBjYjNcXHUwY2I1LVxcdTBjYjlcXHUwY2JkXFx1MGNkZVxcdTBjZTBcXHUwY2UxXFx1MGNmMVxcdTBjZjJcXHUwZDA1LVxcdTBkMGNcXHUwZDBlLVxcdTBkMTBcXHUwZDEyLVxcdTBkM2FcXHUwZDNkXFx1MGQ0ZVxcdTBkNjBcXHUwZDYxXFx1MGQ3YS1cXHUwZDdmXFx1MGQ4NS1cXHUwZDk2XFx1MGQ5YS1cXHUwZGIxXFx1MGRiMy1cXHUwZGJiXFx1MGRiZFxcdTBkYzAtXFx1MGRjNlxcdTBlMDEtXFx1MGUzMFxcdTBlMzJcXHUwZTMzXFx1MGU0MC1cXHUwZTQ2XFx1MGU4MVxcdTBlODJcXHUwZTg0XFx1MGU4N1xcdTBlODhcXHUwZThhXFx1MGU4ZFxcdTBlOTQtXFx1MGU5N1xcdTBlOTktXFx1MGU5ZlxcdTBlYTEtXFx1MGVhM1xcdTBlYTVcXHUwZWE3XFx1MGVhYVxcdTBlYWJcXHUwZWFkLVxcdTBlYjBcXHUwZWIyXFx1MGViM1xcdTBlYmRcXHUwZWMwLVxcdTBlYzRcXHUwZWM2XFx1MGVkYy1cXHUwZWRmXFx1MGYwMFxcdTBmNDAtXFx1MGY0N1xcdTBmNDktXFx1MGY2Y1xcdTBmODgtXFx1MGY4Y1xcdTEwMDAtXFx1MTAyYVxcdTEwM2ZcXHUxMDUwLVxcdTEwNTVcXHUxMDVhLVxcdTEwNWRcXHUxMDYxXFx1MTA2NVxcdTEwNjZcXHUxMDZlLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhlXFx1MTBhMC1cXHUxMGM1XFx1MTBjN1xcdTEwY2RcXHUxMGQwLVxcdTEwZmFcXHUxMGZjLVxcdTEyNDhcXHUxMjRhLVxcdTEyNGRcXHUxMjUwLVxcdTEyNTZcXHUxMjU4XFx1MTI1YS1cXHUxMjVkXFx1MTI2MC1cXHUxMjg4XFx1MTI4YS1cXHUxMjhkXFx1MTI5MC1cXHUxMmIwXFx1MTJiMi1cXHUxMmI1XFx1MTJiOC1cXHUxMmJlXFx1MTJjMFxcdTEyYzItXFx1MTJjNVxcdTEyYzgtXFx1MTJkNlxcdTEyZDgtXFx1MTMxMFxcdTEzMTItXFx1MTMxNVxcdTEzMTgtXFx1MTM1YVxcdTEzODAtXFx1MTM4ZlxcdTEzYTAtXFx1MTNmNFxcdTE0MDEtXFx1MTY2Y1xcdTE2NmYtXFx1MTY3ZlxcdTE2ODEtXFx1MTY5YVxcdTE2YTAtXFx1MTZlYVxcdTE2ZWUtXFx1MTZmMFxcdTE3MDAtXFx1MTcwY1xcdTE3MGUtXFx1MTcxMVxcdTE3MjAtXFx1MTczMVxcdTE3NDAtXFx1MTc1MVxcdTE3NjAtXFx1MTc2Y1xcdTE3NmUtXFx1MTc3MFxcdTE3ODAtXFx1MTdiM1xcdTE3ZDdcXHUxN2RjXFx1MTgyMC1cXHUxODc3XFx1MTg4MC1cXHUxOGE4XFx1MThhYVxcdTE4YjAtXFx1MThmNVxcdTE5MDAtXFx1MTkxY1xcdTE5NTAtXFx1MTk2ZFxcdTE5NzAtXFx1MTk3NFxcdTE5ODAtXFx1MTlhYlxcdTE5YzEtXFx1MTljN1xcdTFhMDAtXFx1MWExNlxcdTFhMjAtXFx1MWE1NFxcdTFhYTdcXHUxYjA1LVxcdTFiMzNcXHUxYjQ1LVxcdTFiNGJcXHUxYjgzLVxcdTFiYTBcXHUxYmFlXFx1MWJhZlxcdTFiYmEtXFx1MWJlNVxcdTFjMDAtXFx1MWMyM1xcdTFjNGQtXFx1MWM0ZlxcdTFjNWEtXFx1MWM3ZFxcdTFjZTktXFx1MWNlY1xcdTFjZWUtXFx1MWNmMVxcdTFjZjVcXHUxY2Y2XFx1MWQwMC1cXHUxZGJmXFx1MWUwMC1cXHUxZjE1XFx1MWYxOC1cXHUxZjFkXFx1MWYyMC1cXHUxZjQ1XFx1MWY0OC1cXHUxZjRkXFx1MWY1MC1cXHUxZjU3XFx1MWY1OVxcdTFmNWJcXHUxZjVkXFx1MWY1Zi1cXHUxZjdkXFx1MWY4MC1cXHUxZmI0XFx1MWZiNi1cXHUxZmJjXFx1MWZiZVxcdTFmYzItXFx1MWZjNFxcdTFmYzYtXFx1MWZjY1xcdTFmZDAtXFx1MWZkM1xcdTFmZDYtXFx1MWZkYlxcdTFmZTAtXFx1MWZlY1xcdTFmZjItXFx1MWZmNFxcdTFmZjYtXFx1MWZmY1xcdTIwNzFcXHUyMDdmXFx1MjA5MC1cXHUyMDljXFx1MjEwMlxcdTIxMDdcXHUyMTBhLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFkXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyYS1cXHUyMTJkXFx1MjEyZi1cXHUyMTM5XFx1MjEzYy1cXHUyMTNmXFx1MjE0NS1cXHUyMTQ5XFx1MjE0ZVxcdTIxNjAtXFx1MjE4OFxcdTJjMDAtXFx1MmMyZVxcdTJjMzAtXFx1MmM1ZVxcdTJjNjAtXFx1MmNlNFxcdTJjZWItXFx1MmNlZVxcdTJjZjJcXHUyY2YzXFx1MmQwMC1cXHUyZDI1XFx1MmQyN1xcdTJkMmRcXHUyZDMwLVxcdTJkNjdcXHUyZDZmXFx1MmQ4MC1cXHUyZDk2XFx1MmRhMC1cXHUyZGE2XFx1MmRhOC1cXHUyZGFlXFx1MmRiMC1cXHUyZGI2XFx1MmRiOC1cXHUyZGJlXFx1MmRjMC1cXHUyZGM2XFx1MmRjOC1cXHUyZGNlXFx1MmRkMC1cXHUyZGQ2XFx1MmRkOC1cXHUyZGRlXFx1MmUyZlxcdTMwMDUtXFx1MzAwN1xcdTMwMjEtXFx1MzAyOVxcdTMwMzEtXFx1MzAzNVxcdTMwMzgtXFx1MzAzY1xcdTMwNDEtXFx1MzA5NlxcdTMwOWQtXFx1MzA5ZlxcdTMwYTEtXFx1MzBmYVxcdTMwZmMtXFx1MzBmZlxcdTMxMDUtXFx1MzEyZFxcdTMxMzEtXFx1MzE4ZVxcdTMxYTAtXFx1MzFiYVxcdTMxZjAtXFx1MzFmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjY1xcdWEwMDAtXFx1YTQ4Y1xcdWE0ZDAtXFx1YTRmZFxcdWE1MDAtXFx1YTYwY1xcdWE2MTAtXFx1YTYxZlxcdWE2MmFcXHVhNjJiXFx1YTY0MC1cXHVhNjZlXFx1YTY3Zi1cXHVhNjk3XFx1YTZhMC1cXHVhNmVmXFx1YTcxNy1cXHVhNzFmXFx1YTcyMi1cXHVhNzg4XFx1YTc4Yi1cXHVhNzhlXFx1YTc5MC1cXHVhNzkzXFx1YTdhMC1cXHVhN2FhXFx1YTdmOC1cXHVhODAxXFx1YTgwMy1cXHVhODA1XFx1YTgwNy1cXHVhODBhXFx1YTgwYy1cXHVhODIyXFx1YTg0MC1cXHVhODczXFx1YTg4Mi1cXHVhOGIzXFx1YThmMi1cXHVhOGY3XFx1YThmYlxcdWE5MGEtXFx1YTkyNVxcdWE5MzAtXFx1YTk0NlxcdWE5NjAtXFx1YTk3Y1xcdWE5ODQtXFx1YTliMlxcdWE5Y2ZcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTYwLVxcdWFhNzZcXHVhYTdhXFx1YWE4MC1cXHVhYWFmXFx1YWFiMVxcdWFhYjVcXHVhYWI2XFx1YWFiOS1cXHVhYWJkXFx1YWFjMFxcdWFhYzJcXHVhYWRiLVxcdWFhZGRcXHVhYWUwLVxcdWFhZWFcXHVhYWYyLVxcdWFhZjRcXHVhYjAxLVxcdWFiMDZcXHVhYjA5LVxcdWFiMGVcXHVhYjExLVxcdWFiMTZcXHVhYjIwLVxcdWFiMjZcXHVhYjI4LVxcdWFiMmVcXHVhYmMwLVxcdWFiZTJcXHVhYzAwLVxcdWQ3YTNcXHVkN2IwLVxcdWQ3YzZcXHVkN2NiLVxcdWQ3ZmJcXHVmOTAwLVxcdWZhNmRcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDBcXHVmYjQxXFx1ZmI0M1xcdWZiNDRcXHVmYjQ2LVxcdWZiYjFcXHVmYmQzLVxcdWZkM2RcXHVmZDUwLVxcdWZkOGZcXHVmZDkyLVxcdWZkYzdcXHVmZGYwLVxcdWZkZmJcXHVmZTcwLVxcdWZlNzRcXHVmZTc2LVxcdWZlZmNcXHVmZjIxLVxcdWZmM2FcXHVmZjQxLVxcdWZmNWFcXHVmZjY2LVxcdWZmYmVcXHVmZmMyLVxcdWZmYzdcXHVmZmNhLVxcdWZmY2ZcXHVmZmQyLVxcdWZmZDdcXHVmZmRhLVxcdWZmZGNdWyRBLVpcXF9hLXpcXHhhYVxceGI1XFx4YmFcXHhjMC1cXHhkNlxceGQ4LVxceGY2XFx4ZjgtXFx1MDJjMVxcdTAyYzYtXFx1MDJkMVxcdTAyZTAtXFx1MDJlNFxcdTAyZWNcXHUwMmVlXFx1MDM3MC1cXHUwMzc0XFx1MDM3NlxcdTAzNzdcXHUwMzdhLVxcdTAzN2RcXHUwMzg2XFx1MDM4OC1cXHUwMzhhXFx1MDM4Y1xcdTAzOGUtXFx1MDNhMVxcdTAzYTMtXFx1MDNmNVxcdTAzZjctXFx1MDQ4MVxcdTA0OGEtXFx1MDUyN1xcdTA1MzEtXFx1MDU1NlxcdTA1NTlcXHUwNTYxLVxcdTA1ODdcXHUwNWQwLVxcdTA1ZWFcXHUwNWYwLVxcdTA1ZjJcXHUwNjIwLVxcdTA2NGFcXHUwNjZlXFx1MDY2ZlxcdTA2NzEtXFx1MDZkM1xcdTA2ZDVcXHUwNmU1XFx1MDZlNlxcdTA2ZWVcXHUwNmVmXFx1MDZmYS1cXHUwNmZjXFx1MDZmZlxcdTA3MTBcXHUwNzEyLVxcdTA3MmZcXHUwNzRkLVxcdTA3YTVcXHUwN2IxXFx1MDdjYS1cXHUwN2VhXFx1MDdmNFxcdTA3ZjVcXHUwN2ZhXFx1MDgwMC1cXHUwODE1XFx1MDgxYVxcdTA4MjRcXHUwODI4XFx1MDg0MC1cXHUwODU4XFx1MDhhMFxcdTA4YTItXFx1MDhhY1xcdTA5MDQtXFx1MDkzOVxcdTA5M2RcXHUwOTUwXFx1MDk1OC1cXHUwOTYxXFx1MDk3MS1cXHUwOTc3XFx1MDk3OS1cXHUwOTdmXFx1MDk4NS1cXHUwOThjXFx1MDk4ZlxcdTA5OTBcXHUwOTkzLVxcdTA5YThcXHUwOWFhLVxcdTA5YjBcXHUwOWIyXFx1MDliNi1cXHUwOWI5XFx1MDliZFxcdTA5Y2VcXHUwOWRjXFx1MDlkZFxcdTA5ZGYtXFx1MDllMVxcdTA5ZjBcXHUwOWYxXFx1MGEwNS1cXHUwYTBhXFx1MGEwZlxcdTBhMTBcXHUwYTEzLVxcdTBhMjhcXHUwYTJhLVxcdTBhMzBcXHUwYTMyXFx1MGEzM1xcdTBhMzVcXHUwYTM2XFx1MGEzOFxcdTBhMzlcXHUwYTU5LVxcdTBhNWNcXHUwYTVlXFx1MGE3Mi1cXHUwYTc0XFx1MGE4NS1cXHUwYThkXFx1MGE4Zi1cXHUwYTkxXFx1MGE5My1cXHUwYWE4XFx1MGFhYS1cXHUwYWIwXFx1MGFiMlxcdTBhYjNcXHUwYWI1LVxcdTBhYjlcXHUwYWJkXFx1MGFkMFxcdTBhZTBcXHUwYWUxXFx1MGIwNS1cXHUwYjBjXFx1MGIwZlxcdTBiMTBcXHUwYjEzLVxcdTBiMjhcXHUwYjJhLVxcdTBiMzBcXHUwYjMyXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjXFx1MGI1ZFxcdTBiNWYtXFx1MGI2MVxcdTBiNzFcXHUwYjgzXFx1MGI4NS1cXHUwYjhhXFx1MGI4ZS1cXHUwYjkwXFx1MGI5Mi1cXHUwYjk1XFx1MGI5OVxcdTBiOWFcXHUwYjljXFx1MGI5ZVxcdTBiOWZcXHUwYmEzXFx1MGJhNFxcdTBiYTgtXFx1MGJhYVxcdTBiYWUtXFx1MGJiOVxcdTBiZDBcXHUwYzA1LVxcdTBjMGNcXHUwYzBlLVxcdTBjMTBcXHUwYzEyLVxcdTBjMjhcXHUwYzJhLVxcdTBjMzNcXHUwYzM1LVxcdTBjMzlcXHUwYzNkXFx1MGM1OFxcdTBjNTlcXHUwYzYwXFx1MGM2MVxcdTBjODUtXFx1MGM4Y1xcdTBjOGUtXFx1MGM5MFxcdTBjOTItXFx1MGNhOFxcdTBjYWEtXFx1MGNiM1xcdTBjYjUtXFx1MGNiOVxcdTBjYmRcXHUwY2RlXFx1MGNlMFxcdTBjZTFcXHUwY2YxXFx1MGNmMlxcdTBkMDUtXFx1MGQwY1xcdTBkMGUtXFx1MGQxMFxcdTBkMTItXFx1MGQzYVxcdTBkM2RcXHUwZDRlXFx1MGQ2MFxcdTBkNjFcXHUwZDdhLVxcdTBkN2ZcXHUwZDg1LVxcdTBkOTZcXHUwZDlhLVxcdTBkYjFcXHUwZGIzLVxcdTBkYmJcXHUwZGJkXFx1MGRjMC1cXHUwZGM2XFx1MGUwMS1cXHUwZTMwXFx1MGUzMlxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTgxXFx1MGU4MlxcdTBlODRcXHUwZTg3XFx1MGU4OFxcdTBlOGFcXHUwZThkXFx1MGU5NC1cXHUwZTk3XFx1MGU5OS1cXHUwZTlmXFx1MGVhMS1cXHUwZWEzXFx1MGVhNVxcdTBlYTdcXHUwZWFhXFx1MGVhYlxcdTBlYWQtXFx1MGViMFxcdTBlYjJcXHUwZWIzXFx1MGViZFxcdTBlYzAtXFx1MGVjNFxcdTBlYzZcXHUwZWRjLVxcdTBlZGZcXHUwZjAwXFx1MGY0MC1cXHUwZjQ3XFx1MGY0OS1cXHUwZjZjXFx1MGY4OC1cXHUwZjhjXFx1MTAwMC1cXHUxMDJhXFx1MTAzZlxcdTEwNTAtXFx1MTA1NVxcdTEwNWEtXFx1MTA1ZFxcdTEwNjFcXHUxMDY1XFx1MTA2NlxcdTEwNmUtXFx1MTA3MFxcdTEwNzUtXFx1MTA4MVxcdTEwOGVcXHUxMGEwLVxcdTEwYzVcXHUxMGM3XFx1MTBjZFxcdTEwZDAtXFx1MTBmYVxcdTEwZmMtXFx1MTI0OFxcdTEyNGEtXFx1MTI0ZFxcdTEyNTAtXFx1MTI1NlxcdTEyNThcXHUxMjVhLVxcdTEyNWRcXHUxMjYwLVxcdTEyODhcXHUxMjhhLVxcdTEyOGRcXHUxMjkwLVxcdTEyYjBcXHUxMmIyLVxcdTEyYjVcXHUxMmI4LVxcdTEyYmVcXHUxMmMwXFx1MTJjMi1cXHUxMmM1XFx1MTJjOC1cXHUxMmQ2XFx1MTJkOC1cXHUxMzEwXFx1MTMxMi1cXHUxMzE1XFx1MTMxOC1cXHUxMzVhXFx1MTM4MC1cXHUxMzhmXFx1MTNhMC1cXHUxM2Y0XFx1MTQwMS1cXHUxNjZjXFx1MTY2Zi1cXHUxNjdmXFx1MTY4MS1cXHUxNjlhXFx1MTZhMC1cXHUxNmVhXFx1MTZlZS1cXHUxNmYwXFx1MTcwMC1cXHUxNzBjXFx1MTcwZS1cXHUxNzExXFx1MTcyMC1cXHUxNzMxXFx1MTc0MC1cXHUxNzUxXFx1MTc2MC1cXHUxNzZjXFx1MTc2ZS1cXHUxNzcwXFx1MTc4MC1cXHUxN2IzXFx1MTdkN1xcdTE3ZGNcXHUxODIwLVxcdTE4NzdcXHUxODgwLVxcdTE4YThcXHUxOGFhXFx1MThiMC1cXHUxOGY1XFx1MTkwMC1cXHUxOTFjXFx1MTk1MC1cXHUxOTZkXFx1MTk3MC1cXHUxOTc0XFx1MTk4MC1cXHUxOWFiXFx1MTljMS1cXHUxOWM3XFx1MWEwMC1cXHUxYTE2XFx1MWEyMC1cXHUxYTU0XFx1MWFhN1xcdTFiMDUtXFx1MWIzM1xcdTFiNDUtXFx1MWI0YlxcdTFiODMtXFx1MWJhMFxcdTFiYWVcXHUxYmFmXFx1MWJiYS1cXHUxYmU1XFx1MWMwMC1cXHUxYzIzXFx1MWM0ZC1cXHUxYzRmXFx1MWM1YS1cXHUxYzdkXFx1MWNlOS1cXHUxY2VjXFx1MWNlZS1cXHUxY2YxXFx1MWNmNVxcdTFjZjZcXHUxZDAwLVxcdTFkYmZcXHUxZTAwLVxcdTFmMTVcXHUxZjE4LVxcdTFmMWRcXHUxZjIwLVxcdTFmNDVcXHUxZjQ4LVxcdTFmNGRcXHUxZjUwLVxcdTFmNTdcXHUxZjU5XFx1MWY1YlxcdTFmNWRcXHUxZjVmLVxcdTFmN2RcXHUxZjgwLVxcdTFmYjRcXHUxZmI2LVxcdTFmYmNcXHUxZmJlXFx1MWZjMi1cXHUxZmM0XFx1MWZjNi1cXHUxZmNjXFx1MWZkMC1cXHUxZmQzXFx1MWZkNi1cXHUxZmRiXFx1MWZlMC1cXHUxZmVjXFx1MWZmMi1cXHUxZmY0XFx1MWZmNi1cXHUxZmZjXFx1MjA3MVxcdTIwN2ZcXHUyMDkwLVxcdTIwOWNcXHUyMTAyXFx1MjEwN1xcdTIxMGEtXFx1MjExM1xcdTIxMTVcXHUyMTE5LVxcdTIxMWRcXHUyMTI0XFx1MjEyNlxcdTIxMjhcXHUyMTJhLVxcdTIxMmRcXHUyMTJmLVxcdTIxMzlcXHUyMTNjLVxcdTIxM2ZcXHUyMTQ1LVxcdTIxNDlcXHUyMTRlXFx1MjE2MC1cXHUyMTg4XFx1MmMwMC1cXHUyYzJlXFx1MmMzMC1cXHUyYzVlXFx1MmM2MC1cXHUyY2U0XFx1MmNlYi1cXHUyY2VlXFx1MmNmMlxcdTJjZjNcXHUyZDAwLVxcdTJkMjVcXHUyZDI3XFx1MmQyZFxcdTJkMzAtXFx1MmQ2N1xcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUyZTJmXFx1MzAwNS1cXHUzMDA3XFx1MzAyMS1cXHUzMDI5XFx1MzAzMS1cXHUzMDM1XFx1MzAzOC1cXHUzMDNjXFx1MzA0MS1cXHUzMDk2XFx1MzA5ZC1cXHUzMDlmXFx1MzBhMS1cXHUzMGZhXFx1MzBmYy1cXHUzMGZmXFx1MzEwNS1cXHUzMTJkXFx1MzEzMS1cXHUzMThlXFx1MzFhMC1cXHUzMWJhXFx1MzFmMC1cXHUzMWZmXFx1MzQwMC1cXHU0ZGI1XFx1NGUwMC1cXHU5ZmNjXFx1YTAwMC1cXHVhNDhjXFx1YTRkMC1cXHVhNGZkXFx1YTUwMC1cXHVhNjBjXFx1YTYxMC1cXHVhNjFmXFx1YTYyYVxcdWE2MmJcXHVhNjQwLVxcdWE2NmVcXHVhNjdmLVxcdWE2OTdcXHVhNmEwLVxcdWE2ZWZcXHVhNzE3LVxcdWE3MWZcXHVhNzIyLVxcdWE3ODhcXHVhNzhiLVxcdWE3OGVcXHVhNzkwLVxcdWE3OTNcXHVhN2EwLVxcdWE3YWFcXHVhN2Y4LVxcdWE4MDFcXHVhODAzLVxcdWE4MDVcXHVhODA3LVxcdWE4MGFcXHVhODBjLVxcdWE4MjJcXHVhODQwLVxcdWE4NzNcXHVhODgyLVxcdWE4YjNcXHVhOGYyLVxcdWE4ZjdcXHVhOGZiXFx1YTkwYS1cXHVhOTI1XFx1YTkzMC1cXHVhOTQ2XFx1YTk2MC1cXHVhOTdjXFx1YTk4NC1cXHVhOWIyXFx1YTljZlxcdWFhMDAtXFx1YWEyOFxcdWFhNDAtXFx1YWE0MlxcdWFhNDQtXFx1YWE0YlxcdWFhNjAtXFx1YWE3NlxcdWFhN2FcXHVhYTgwLVxcdWFhYWZcXHVhYWIxXFx1YWFiNVxcdWFhYjZcXHVhYWI5LVxcdWFhYmRcXHVhYWMwXFx1YWFjMlxcdWFhZGItXFx1YWFkZFxcdWFhZTAtXFx1YWFlYVxcdWFhZjItXFx1YWFmNFxcdWFiMDEtXFx1YWIwNlxcdWFiMDktXFx1YWIwZVxcdWFiMTEtXFx1YWIxNlxcdWFiMjAtXFx1YWIyNlxcdWFiMjgtXFx1YWIyZVxcdWFiYzAtXFx1YWJlMlxcdWFjMDAtXFx1ZDdhM1xcdWQ3YjAtXFx1ZDdjNlxcdWQ3Y2ItXFx1ZDdmYlxcdWY5MDAtXFx1ZmE2ZFxcdWZhNzAtXFx1ZmFkOVxcdWZiMDAtXFx1ZmIwNlxcdWZiMTMtXFx1ZmIxN1xcdWZiMWRcXHVmYjFmLVxcdWZiMjhcXHVmYjJhLVxcdWZiMzZcXHVmYjM4LVxcdWZiM2NcXHVmYjNlXFx1ZmI0MFxcdWZiNDFcXHVmYjQzXFx1ZmI0NFxcdWZiNDYtXFx1ZmJiMVxcdWZiZDMtXFx1ZmQzZFxcdWZkNTAtXFx1ZmQ4ZlxcdWZkOTItXFx1ZmRjN1xcdWZkZjAtXFx1ZmRmYlxcdWZlNzAtXFx1ZmU3NFxcdWZlNzYtXFx1ZmVmY1xcdWZmMjEtXFx1ZmYzYVxcdWZmNDEtXFx1ZmY1YVxcdWZmNjYtXFx1ZmZiZVxcdWZmYzItXFx1ZmZjN1xcdWZmY2EtXFx1ZmZjZlxcdWZmZDItXFx1ZmZkN1xcdWZmZGEtXFx1ZmZkYzAtOVxcdTAzMDAtXFx1MDM2ZlxcdTA0ODMtXFx1MDQ4N1xcdTA1OTEtXFx1MDViZFxcdTA1YmZcXHUwNWMxXFx1MDVjMlxcdTA1YzRcXHUwNWM1XFx1MDVjN1xcdTA2MTAtXFx1MDYxYVxcdTA2NGItXFx1MDY2OVxcdTA2NzBcXHUwNmQ2LVxcdTA2ZGNcXHUwNmRmLVxcdTA2ZTRcXHUwNmU3XFx1MDZlOFxcdTA2ZWEtXFx1MDZlZFxcdTA2ZjAtXFx1MDZmOVxcdTA3MTFcXHUwNzMwLVxcdTA3NGFcXHUwN2E2LVxcdTA3YjBcXHUwN2MwLVxcdTA3YzlcXHUwN2ViLVxcdTA3ZjNcXHUwODE2LVxcdTA4MTlcXHUwODFiLVxcdTA4MjNcXHUwODI1LVxcdTA4MjdcXHUwODI5LVxcdTA4MmRcXHUwODU5LVxcdTA4NWJcXHUwOGU0LVxcdTA4ZmVcXHUwOTAwLVxcdTA5MDNcXHUwOTNhLVxcdTA5M2NcXHUwOTNlLVxcdTA5NGZcXHUwOTUxLVxcdTA5NTdcXHUwOTYyXFx1MDk2M1xcdTA5NjYtXFx1MDk2ZlxcdTA5ODEtXFx1MDk4M1xcdTA5YmNcXHUwOWJlLVxcdTA5YzRcXHUwOWM3XFx1MDljOFxcdTA5Y2ItXFx1MDljZFxcdTA5ZDdcXHUwOWUyXFx1MDllM1xcdTA5ZTYtXFx1MDllZlxcdTBhMDEtXFx1MGEwM1xcdTBhM2NcXHUwYTNlLVxcdTBhNDJcXHUwYTQ3XFx1MGE0OFxcdTBhNGItXFx1MGE0ZFxcdTBhNTFcXHUwYTY2LVxcdTBhNzFcXHUwYTc1XFx1MGE4MS1cXHUwYTgzXFx1MGFiY1xcdTBhYmUtXFx1MGFjNVxcdTBhYzctXFx1MGFjOVxcdTBhY2ItXFx1MGFjZFxcdTBhZTJcXHUwYWUzXFx1MGFlNi1cXHUwYWVmXFx1MGIwMS1cXHUwYjAzXFx1MGIzY1xcdTBiM2UtXFx1MGI0NFxcdTBiNDdcXHUwYjQ4XFx1MGI0Yi1cXHUwYjRkXFx1MGI1NlxcdTBiNTdcXHUwYjYyXFx1MGI2M1xcdTBiNjYtXFx1MGI2ZlxcdTBiODJcXHUwYmJlLVxcdTBiYzJcXHUwYmM2LVxcdTBiYzhcXHUwYmNhLVxcdTBiY2RcXHUwYmQ3XFx1MGJlNi1cXHUwYmVmXFx1MGMwMS1cXHUwYzAzXFx1MGMzZS1cXHUwYzQ0XFx1MGM0Ni1cXHUwYzQ4XFx1MGM0YS1cXHUwYzRkXFx1MGM1NVxcdTBjNTZcXHUwYzYyXFx1MGM2M1xcdTBjNjYtXFx1MGM2ZlxcdTBjODJcXHUwYzgzXFx1MGNiY1xcdTBjYmUtXFx1MGNjNFxcdTBjYzYtXFx1MGNjOFxcdTBjY2EtXFx1MGNjZFxcdTBjZDVcXHUwY2Q2XFx1MGNlMlxcdTBjZTNcXHUwY2U2LVxcdTBjZWZcXHUwZDAyXFx1MGQwM1xcdTBkM2UtXFx1MGQ0NFxcdTBkNDYtXFx1MGQ0OFxcdTBkNGEtXFx1MGQ0ZFxcdTBkNTdcXHUwZDYyXFx1MGQ2M1xcdTBkNjYtXFx1MGQ2ZlxcdTBkODJcXHUwZDgzXFx1MGRjYVxcdTBkY2YtXFx1MGRkNFxcdTBkZDZcXHUwZGQ4LVxcdTBkZGZcXHUwZGYyXFx1MGRmM1xcdTBlMzFcXHUwZTM0LVxcdTBlM2FcXHUwZTQ3LVxcdTBlNGVcXHUwZTUwLVxcdTBlNTlcXHUwZWIxXFx1MGViNC1cXHUwZWI5XFx1MGViYlxcdTBlYmNcXHUwZWM4LVxcdTBlY2RcXHUwZWQwLVxcdTBlZDlcXHUwZjE4XFx1MGYxOVxcdTBmMjAtXFx1MGYyOVxcdTBmMzVcXHUwZjM3XFx1MGYzOVxcdTBmM2VcXHUwZjNmXFx1MGY3MS1cXHUwZjg0XFx1MGY4NlxcdTBmODdcXHUwZjhkLVxcdTBmOTdcXHUwZjk5LVxcdTBmYmNcXHUwZmM2XFx1MTAyYi1cXHUxMDNlXFx1MTA0MC1cXHUxMDQ5XFx1MTA1Ni1cXHUxMDU5XFx1MTA1ZS1cXHUxMDYwXFx1MTA2Mi1cXHUxMDY0XFx1MTA2Ny1cXHUxMDZkXFx1MTA3MS1cXHUxMDc0XFx1MTA4Mi1cXHUxMDhkXFx1MTA4Zi1cXHUxMDlkXFx1MTM1ZC1cXHUxMzVmXFx1MTcxMi1cXHUxNzE0XFx1MTczMi1cXHUxNzM0XFx1MTc1MlxcdTE3NTNcXHUxNzcyXFx1MTc3M1xcdTE3YjQtXFx1MTdkM1xcdTE3ZGRcXHUxN2UwLVxcdTE3ZTlcXHUxODBiLVxcdTE4MGRcXHUxODEwLVxcdTE4MTlcXHUxOGE5XFx1MTkyMC1cXHUxOTJiXFx1MTkzMC1cXHUxOTNiXFx1MTk0Ni1cXHUxOTRmXFx1MTliMC1cXHUxOWMwXFx1MTljOFxcdTE5YzlcXHUxOWQwLVxcdTE5ZDlcXHUxYTE3LVxcdTFhMWJcXHUxYTU1LVxcdTFhNWVcXHUxYTYwLVxcdTFhN2NcXHUxYTdmLVxcdTFhODlcXHUxYTkwLVxcdTFhOTlcXHUxYjAwLVxcdTFiMDRcXHUxYjM0LVxcdTFiNDRcXHUxYjUwLVxcdTFiNTlcXHUxYjZiLVxcdTFiNzNcXHUxYjgwLVxcdTFiODJcXHUxYmExLVxcdTFiYWRcXHUxYmIwLVxcdTFiYjlcXHUxYmU2LVxcdTFiZjNcXHUxYzI0LVxcdTFjMzdcXHUxYzQwLVxcdTFjNDlcXHUxYzUwLVxcdTFjNTlcXHUxY2QwLVxcdTFjZDJcXHUxY2Q0LVxcdTFjZThcXHUxY2VkXFx1MWNmMi1cXHUxY2Y0XFx1MWRjMC1cXHUxZGU2XFx1MWRmYy1cXHUxZGZmXFx1MjAwY1xcdTIwMGRcXHUyMDNmXFx1MjA0MFxcdTIwNTRcXHUyMGQwLVxcdTIwZGNcXHUyMGUxXFx1MjBlNS1cXHUyMGYwXFx1MmNlZi1cXHUyY2YxXFx1MmQ3ZlxcdTJkZTAtXFx1MmRmZlxcdTMwMmEtXFx1MzAyZlxcdTMwOTlcXHUzMDlhXFx1YTYyMC1cXHVhNjI5XFx1YTY2ZlxcdWE2NzQtXFx1YTY3ZFxcdWE2OWZcXHVhNmYwXFx1YTZmMVxcdWE4MDJcXHVhODA2XFx1YTgwYlxcdWE4MjMtXFx1YTgyN1xcdWE4ODBcXHVhODgxXFx1YThiNC1cXHVhOGM0XFx1YThkMC1cXHVhOGQ5XFx1YThlMC1cXHVhOGYxXFx1YTkwMC1cXHVhOTA5XFx1YTkyNi1cXHVhOTJkXFx1YTk0Ny1cXHVhOTUzXFx1YTk4MC1cXHVhOTgzXFx1YTliMy1cXHVhOWMwXFx1YTlkMC1cXHVhOWQ5XFx1YWEyOS1cXHVhYTM2XFx1YWE0M1xcdWFhNGNcXHVhYTRkXFx1YWE1MC1cXHVhYTU5XFx1YWE3YlxcdWFhYjBcXHVhYWIyLVxcdWFhYjRcXHVhYWI3XFx1YWFiOFxcdWFhYmVcXHVhYWJmXFx1YWFjMVxcdWFhZWItXFx1YWFlZlxcdWFhZjVcXHVhYWY2XFx1YWJlMy1cXHVhYmVhXFx1YWJlY1xcdWFiZWRcXHVhYmYwLVxcdWFiZjlcXHVmYjFlXFx1ZmUwMC1cXHVmZTBmXFx1ZmUyMC1cXHVmZTI2XFx1ZmUzM1xcdWZlMzRcXHVmZTRkLVxcdWZlNGZcXHVmZjEwLVxcdWZmMTlcXHVmZjNmXSovZ2kpO1xuICB9LFxuICBldmFsSW5Db250ZXh0OiBmdW5jdGlvbiAoanMpIHtcbiAgICBqcyA9IGpzLnJlcGxhY2UoL1xccysvZywgJycpO1xuXG5cbiAgICB2YXIga2V5cyA9IFtdLCB2YWx1ZXMgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBrZXlzID0ga2V5cy5jb25jYXQoT2JqZWN0LmtleXMoYXJndW1lbnRzW2ldKSk7XG4gICAgICBmb3IgKHZhciBqIGluIGFyZ3VtZW50c1tpXSkge1xuICAgICAgICB2YWx1ZXMucHVzaChhcmd1bWVudHNbaV1bal0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vXG4gICAgLy9pZihfLmlzQ29ycmVjdFZhcmlhYmxlTmFtZShqcykgJiYga2V5cy5pbmRleE9mKGpzKSA9PT0gLTEpe1xuICAgIC8vICBrZXlzLnB1c2goanMpO1xuICAgIC8vICB2YWx1ZXMucHVzaCh1bmRlZmluZWQpO1xuICAgIC8vfVxuXG4gICAgdmFyIGFyciA9IHV0aWxzLmV4dHJhY3RWYXJpYWJsZXMoanMpO1xuICAgIC8vY29uc29sZS5sb2coYXJyKTtcbiAgICBmb3IgKHZhciBpIGluIGFycikge1xuICAgICAgaWYgKGtleXMuaW5kZXhPZihhcnJbaV0pID09PSAtMSkge1xuICAgICAgICBrZXlzLnB1c2goYXJyW2ldKTtcbiAgICAgICAgdmFsdWVzLnB1c2godW5kZWZpbmVkKTtcbiAgICAgIH1cbiAgICB9XG4gICAganMgPSBcInZhciBmb28gPSBmdW5jdGlvbihcIiArIGtleXMuam9pbihcIixcIikgKyBcIil7IHZhciBfX3JldHVybl9fdmFsdWUgPSBcIiArIGpzICsgXCIgO3JldHVybiBfX3JldHVybl9fdmFsdWU7fTsgZm9vO1wiO1xuICAgIHRyeSB7XG4gICAgICB2YXIgZm9vID0gZXZhbChqcyk7XG4gICAgICByZXR1cm4gZm9vLmFwcGx5KHRoaXMsIHZhbHVlcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgfSxcbiAgY29tcGlsZUVsZW1lbnQ6IGZ1bmN0aW9uICgkaXRlbSwgc2NvcGUpIHtcblxuICAgIGZ1bmN0aW9uIF9lYWNoU2VsZihlbCwgc2VsZWN0b3IsIGZvbykge1xuICAgICAgZWwuZmluZChzZWxlY3RvcikuZWFjaChmb28pO1xuICAgICAgaWYgKGVsLmlzKHNlbGVjdG9yKSkge1xuICAgICAgICBmb28uY2FsbChlbFswXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8uYWRkQmFjaygnc2VsZWN0b3InKVxuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbb25jbGlja11cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG9uQ2xpY2sgPSAkKHRoaXMpLmF0dHIoXCJvbmNsaWNrXCIpO1xuICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwib25jbGlja1wiKTtcbiAgICAgICQodGhpcykuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHV0aWxzLmV2YWxJbkNvbnRleHQob25DbGljaywgc2NvcGUsIHtldmVudDogZXZlbnR9KTtcbiAgICAgIH0pXG4gICAgfSlcblxuXG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltvbmNoYW5nZV1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG9uQ2hhbmdlID0gJCh0aGlzKS5hdHRyKFwib25jaGFuZ2VcIik7XG4gICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJvbmNoYW5nZVwiKTtcbiAgICAgICQodGhpcykuY2hhbmdlKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB1dGlscy5ldmFsSW5Db250ZXh0KG9uQ2hhbmdlLCBzY29wZSwge2V2ZW50OiBldmVudH0pO1xuICAgICAgfSlcbiAgICB9KTtcblxuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbZHAtY2hlY2tlZF1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF92YWwgPSAkKHRoaXMpLmF0dHIoXCJkcC1jaGVja2VkXCIpO1xuICAgICAgdmFyIHZhbCA9IHV0aWxzLmV2YWxJbkNvbnRleHQoX3ZhbCwgc2NvcGUpO1xuICAgICAgaWYgKHZhbCkge1xuICAgICAgICAkKHRoaXMpLmF0dHIoXCJjaGVja2VkXCIsIFwiY2hlY2tlZFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQodGhpcykucmVtb3ZlQXR0cihcImNoZWNrZWRcIik7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW2RwLXNyY11cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF92YWwgPSAkKHRoaXMpLmF0dHIoXCJkcC1zcmNcIik7XG4gICAgICB2YXIgdmFsID0gdXRpbHMuZXZhbEluQ29udGV4dChfdmFsLCBzY29wZSk7XG4gICAgICBpZiAodmFsKSB7XG4gICAgICAgICQodGhpcykuYXR0cihcInNyY1wiLCB2YWwpO1xuICAgICAgfVxuXG4gICAgfSk7XG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltkcC1pZl1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF92YWwgPSAkKHRoaXMpLmF0dHIoXCJkcC1pZlwiKTtcbiAgICAgIGlmIChfdmFsID09PSBcImZhbHNlXCIpIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICAgIGlmIChfdmFsID09PSBcInRydWVcIikge1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdmFsID0gdXRpbHMuZXZhbEluQ29udGV4dChfdmFsLCBzY29wZSk7XG4gICAgICAgIGlmICghdmFsKSB7XG4gICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbZHAtaW5jbHVkZV1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF9lbCA9ICQodGhpcyk7XG4gICAgICB2YXIgX3ZhbCA9IF9lbC5hdHRyKFwiZHAtaW5jbHVkZVwiKTtcbiAgICAgIHZhciB2YWwgPSB1dGlscy5ldmFsSW5Db250ZXh0KF92YWwsIHNjb3BlKTtcbiAgICAgIF9lbC5sb2FkKHZhbCk7XG4gICAgfSk7XG4gIH0sXG4gIHBhcnNlVGVtcGxhdGU6IGZ1bmN0aW9uICh0cGwsIHNjb3BlKSB7XG4gICAgdmFyICRpdGVtID0gJCh0cGwuZm9ybWF0KHNjb3BlKSk7XG4gICAgXy5jb21waWxlRWxlbWVudCgkaXRlbSwgc2NvcGUpO1xuICAgIHJldHVybiAkaXRlbTtcbiAgfVxufTtcbmlmKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIpe1xuICBtb2R1bGUuZXhwb3J0cyA9IHV0aWxzO1xufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL2NvbXBpbGUuanMiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICBfc2V0U1ZHT2JqZWN0OiBmdW5jdGlvbihtYXJrdXAsIGluc3RhbmNlLCByZXZpdmVyKSB7XG4gICAgbGV0IHJlc3VsdCA9IG1hcmt1cC5wdXNoKGluc3RhbmNlLnRvU1ZHKHJldml2ZXIpKTtcbiAgICBpZihpbnN0YW5jZS5fY2xpcFRvKSB7XG4gICAgICBjb25zdCBjbGlwSWQgPSBgQ2xpcHBlZCR7ZmFicmljLk9iamVjdC5fX3VpZCsrfWA7XG4gICAgICByZXN1bHQgPSBgPGNsaXBQYXRoIGlkPVwiJHtjbGlwSWR9XCI+XG4gICAgICAgICAgICAgICAgICAgICR7aW5zdGFuY2UuX2NsaXBUby50b1NWRyhyZXZpdmVyKX1cbiAgICAgICAgICAgICAgICA8L2NsaXBQYXRoPlxuICAgICAgICAgICAgICAgIDxnIGNsaXAtcGF0aD1cInVybCgjJHtjbGlwSWR9KVwiPiR7cmVzdWx0fTwvZz5gXG4gICAgfVxuICAgIC8vIG1hcmt1cC5wdXNoKGluc3RhbmNlLnRvU1ZHKHJldml2ZXIpKTtcbiAgICByZXR1cm4gcmV2aXZlciA/IHJldml2ZXIocmVzdWx0KSA6IHJlc3VsdFxuICB9LFxuICAvLyBlbmFibGVDbGlwQXJlYVpvb21pbmc6IGZ1bmN0aW9uKCl7XG4gIC8vdG9kb1xuICAvLyB0aGlzLm9uKCd2aWV3cG9ydDpzY2FsZWQnLCBmdW5jdGlvbigpe1xuICAvLyAgIGlmICghdGhpcy5sYXllcihcImJhY2tncm91bmRcIikub2JqZWN0cykgcmV0dXJuO1xuICAvLyAgIHRoaXMuX2JhY2tncm91bmRMYXllclswXS5zZXRDb29yZHMoKTtcbiAgLy8gfSk7XG4gIC8vIH0sXG4gIF9mYWJyaWNfY2xpcF9mdW5jdGlvbjogZnVuY3Rpb24gKGN0eDIpIHtcblxuICAgIGxldCBjbGlwUmVjdCA9IHRoaXMuY2xpcFJlY3Q7XG4gICAgY3R4Mi5zYXZlKCk7XG4gICAgY2xpcFJlY3QucmVuZGVyKGN0eDIpO1xuICAgIGN0eDIucmVzdG9yZSgpO1xuXG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG5cbiAgc2V0Q2xpcFRvOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgdGhpcy5jbGlwVG8gPSB2YWw7XG4gICAgZGVsZXRlIHRoaXMuX2NsaXBUbztcbiAgICBpZighdGhpcy5jbGlwVG8pe1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgdmFsICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5fY2xpcFRvID0gdmFsO1xuICAgICAgdGhpcy5jbGlwVG8gPSB2YWwuaWQ7XG4gICAgfVxuXG4gICAgbGV0IGZ1bmN0aW9uQm9keSA9IGZhYnJpYy51dGlsLmdldEZ1bmN0aW9uQm9keSh2YWwpO1xuICAgIGlmICh0eXBlb2YgZnVuY3Rpb25Cb2R5ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5fY2xpcFRvID0gbmV3IEZ1bmN0aW9uKCdjdHgnLCBmdW5jdGlvbkJvZHkpO1xuICAgIH1cbiAgfSxcbiAgX2luaXRDbGlwcGluZzogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZiAoIW9wdGlvbnMuX2NsaXBUbykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBmdW5jdGlvbkJvZHkgPSBmYWJyaWMudXRpbC5nZXRGdW5jdGlvbkJvZHkob3B0aW9ucy5jbGlwVG8pO1xuICAgIGlmICh0eXBlb2YgZnVuY3Rpb25Cb2R5ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhpcy5fY2xpcFRvID0gbmV3IEZ1bmN0aW9uKCdjdHgnLCBmdW5jdGlvbkJvZHkpO1xuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLmNsaXBDb250ZXh0ID0gZnVuY3Rpb24gKHJlY2VpdmVyLCBjdHgpIHtcbiAgaWYgKCFyZWNlaXZlci5fY2xpcFRvKSB7XG4gICAgaWYgKHJlY2VpdmVyLmNsaXBUbyA9PT0gXCJjYW52YXNcIikge1xuICAgICAgbGV0IGNsaXBPYmplY3QgPSByZWNlaXZlci5jYW52YXM7XG5cblxuICAgICAgbGV0IF93ID0gY2xpcE9iamVjdC5vcmlnaW5hbFdpZHRoIHx8IGNsaXBPYmplY3Qud2lkdGg7XG4gICAgICBsZXQgX2ggPSBjbGlwT2JqZWN0Lm9yaWdpbmFsSGVpZ2h0IHx8IGNsaXBPYmplY3QuaGVpZ2h0O1xuXG5cbiAgICAgIGxldCBvID0gY2xpcE9iamVjdC5vZmZzZXRzO1xuICAgICAgbGV0IF96b29tID0gY2xpcE9iamVjdC5nZXRab29tKCk7XG4gICAgICBjdHgucmVjdChvLmxlZnQsby50b3AsIF93IC8qL196b29tICovLSAgby5sZWZ0IC0gby5yaWdodCwgX2ggLyovX3pvb20qLyAtICBvLnRvcCAtIG8uYm90dG9tKTtcbiAgICB9XG4gICAgZWxzZXtcblxuICAgICAgbGV0IF9pZCA9IHJlY2VpdmVyLmNsaXBUby5zdWJzdHJpbmcoMSk7XG5cbiAgICAgIGxldCBfY2xpcEN0eCA9IHJlY2VpdmVyLmNhbnZhcy5nZXRPYmplY3RCeUlEKF9pZCk7XG4gICAgICBpZihfY2xpcEN0eCl7XG4gICAgICAgIHJlY2VpdmVyLl9jbGlwVG8gPSBfY2xpcEN0eDtcbiAgICAgIH1lbHNle1xuICAgICAgICBjb25zb2xlLndhcm4oXCJlcnJvcjogY2xpcFRvIG5vdCBmb3VuZFwiICsgcmVjZWl2ZXIuY2xpcFRvKTtcbiAgICAgICAgZGVsZXRlIHJlY2VpdmVyLmNsaXBUbztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICB9XG5cblxuICBpZiAocmVjZWl2ZXIuX2NsaXBUby5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICByZWNlaXZlci5fY2xpcFRvKGN0eCk7XG4gIH0gZWxzZSB7XG4gIC8vICBmYWJyaWMudXRpbC5fY2xpcFRvT2JqZWN0KHJlY2VpdmVyLCBjdHgpO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICAvLyBsZXQgcmV0aW5hID0gdGhpcy5jYW52YXMuZ2V0UmV0aW5hU2NhbGluZygpO1xuICAgIC8vIGN0eC5zZXRUcmFuc2Zvcm0ocmV0aW5hLCAwLCAwLCByZXRpbmEsIDAsIDApO1xuICAgIGN0eC50cmFuc2Zvcm0uYXBwbHkoY3R4LCByZWNlaXZlci5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm0pO1xuICAgIHJlY2VpdmVyLl9jbGlwVG8udHJhbnNmb3JtKGN0eCk7XG4gICAgcmVjZWl2ZXIuX2NsaXBUby5fcmVuZGVyKGN0eCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgICBjdHguY2xpcCgpO1xuICB9XG5cbn07XG5cbmZhYnJpYy51dGlsLl9jbGlwVG9PYmplY3QgPSBmdW5jdGlvbiAocmVjZWl2ZXIsIGN0eCkge1xuICAvKlxuICBjdHguc2F2ZSgpO1xuICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgbGV0IGZyb21MZWZ0ID0gZmFsc2U7XG4gIGxldCBjZW50ZXIgPSBmcm9tTGVmdCA/IHJlY2VpdmVyLl9nZXRMZWZ0VG9wQ29vcmRzKCkgOiByZWNlaXZlci5nZXRDZW50ZXJQb2ludCgpO1xuICBjdHgudHJhbnNmb3JtKDEsIE1hdGgudGFuKGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoLXJlY2VpdmVyLnNrZXdZKSksIDAsIDEsIDAsIDApO1xuICBjdHgudHJhbnNmb3JtKDEsIDAsIE1hdGgudGFuKGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoLXJlY2VpdmVyLnNrZXdYKSksIDEsIDAsIDApO1xuICBjdHguc2NhbGUoXG4gICAgKDEgLyByZWNlaXZlci5zY2FsZVgpICogKHJlY2VpdmVyLmZsaXBYID8gLTEgOiAxKSxcbiAgICAoMSAvIHJlY2VpdmVyLnNjYWxlWSkgKiAocmVjZWl2ZXIuZmxpcFkgPyAtMSA6IDEpXG4gICk7XG4gIGN0eC5yb3RhdGUoZmFicmljLnV0aWwuZGVncmVlc1RvUmFkaWFucygtcmVjZWl2ZXIuYW5nbGUpKTtcbiAgY3R4LnRyYW5zbGF0ZSgtY2VudGVyLngsIC1jZW50ZXIueSk7XG5cbiAgbGV0IGNsaXBPYmplY3QgPSByZWNlaXZlci5fY2xpcFRvO1xuXG4gIGlmIChjbGlwT2JqZWN0LnBvaW50cykge1xuICAgIGxldCBwcyA9IGNsaXBPYmplY3QucG9pbnRzO1xuICAgIGN0eC5tb3ZlVG8ocHNbMF0ueCwgcHNbMF0ueSk7XG4gICAgZm9yIChsZXQgaiA9IDE7IGogPCBwcy5sZW5ndGg7IGorKykge1xuICAgICAgY3R4LmxpbmVUbyhwc1tqXS54LCBwc1tqXS55KTtcbiAgICB9XG4gICAgLy9jdHguc3Ryb2tlKCk7XG4gIH0gZWxzZSBpZiAoY2xpcE9iamVjdC50eXBlID09IFwicGF0aC1ncm91cFwiKSB7XG5cbiAgICBjdHguZ2xvYmFsQWxwaGEgPSAwO1xuICAgIGNsaXBPYmplY3QudHJhbnNmb3JtKGN0eCk7XG5cbiAgICBjdHgudHJhbnNsYXRlKC1jbGlwT2JqZWN0LndpZHRoLzIsIC1jbGlwT2JqZWN0LmhlaWdodC8yKTtcbiAgICBmb3IgKGxldCBpID0gMCwgbCA9IGNsaXBPYmplY3QucGF0aHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICBjbGlwT2JqZWN0LnBhdGhzW2ldLl9yZW5kZXIoY3R4LCB0cnVlKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoY2xpcE9iamVjdC50eXBlID09IFwicGF0aFwiKSB7XG5cbiAgICBjdHguZ2xvYmFsQWxwaGEgPSAwO1xuICAgIGNsaXBPYmplY3QudHJhbnNmb3JtKGN0eCk7XG4gICAgY2xpcE9iamVjdC5fcmVuZGVyKGN0eCk7XG5cbiAgICAvL3RvZG8g0L7Rh9C10L3RjCDQv9C70L7RhdC+LiDQuNC30L3QsNGH0LDQu9GM0L3QviDQvtCx0YrQtdC60YLRiyDQuNC80LXRjtGCINC60LvQuNC/INC6INGB0LvQsNC50LTRgyDRgdGC0LDRgtC40YfQvdC+0LzRgy4g0L3QviDQv9C+0YLQvtC8INC6INC60LDQvdCy0LDRgdGDINC00LjQvdCw0LzQuNGH0LXRgdC60L7QvNGDLiDQvdC10YXQvtGA0L7RiNC+XG4gIH0gZWxzZSBpZiAoY2xpcE9iamVjdC50eXBlID09IFwic2xpZGVcIiB8fCBjbGlwT2JqZWN0LnR5cGUgPT0gXCJjYW52YXNcIikge1xuXG5cbiAgICBsZXQgX3cgPSBjbGlwT2JqZWN0Lm9yaWdpbmFsV2lkdGggfHwgY2xpcE9iamVjdC53aWR0aDtcbiAgICBsZXQgX2ggPSBjbGlwT2JqZWN0Lm9yaWdpbmFsSGVpZ2h0IHx8IGNsaXBPYmplY3QuaGVpZ2h0O1xuXG5cbiAgICBsZXQgbyA9IGNsaXBPYmplY3Qub2Zmc2V0cztcbiAgICBsZXQgX3pvb20gPSBjbGlwT2JqZWN0LmdldFpvb20oKTtcbiAgICBjdHgucmVjdChvLmxlZnQsby50b3AsIF93IC9cbiAgfWVsc2Uge1xuICAgIGN0eC50cmFuc2xhdGUoY2xpcE9iamVjdC5sZWZ0LCBjbGlwT2JqZWN0LnRvcCk7XG4gICAgY3R4LnJvdGF0ZSgtKGNsaXBPYmplY3QuYW5nbGUgKiAtMSkgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICBpZihjbGlwT2JqZWN0Lm9yaWdpblggPT09IFwiY2VudGVyXCIpe1xuICAgICAgY3R4LnJlY3QoLSBjbGlwT2JqZWN0LndpZHRoLyAyLCAtIGNsaXBPYmplY3QuaGVpZ2h0LzIsIGNsaXBPYmplY3Qud2lkdGgsIGNsaXBPYmplY3QuaGVpZ2h0KTtcbiAgICB9ZWxzZXtcbiAgICAgIGN0eC5yZWN0KDAsMCwgY2xpcE9iamVjdC53aWR0aCwgY2xpcE9iamVjdC5oZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIGN0eC5jbG9zZVBhdGgoKTtcbiAgY3R4LnJlc3RvcmUoKTsqL1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9jbGlwVG8uanMiLCJtb2R1bGUuZXhwb3J0cyA9ICQ7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCIkXCJcbi8vIG1vZHVsZSBpZCA9IDdcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLy9mYWJyaWMuZGVidWcgPSBERVZFTE9QTUVOVDtcblxucmVxdWlyZSgnLi91dGlsL2ZhYnJpYy51dGlsLnJlcXVpcmUnKTtcbi8vIGZhYnJpYy51dGlsLmRhdGEgPSByZXF1aXJlKCcuL3V0aWwvZGF0YScpO1xuLy8gZmFicmljLnV0aWwucGF0aCA9IHJlcXVpcmUoJy4vdXRpbC9wYXRoJyk7XG4vLyBmYWJyaWMudXRpbC5jb21waWxlID0gcmVxdWlyZSgnLi91dGlsL2NvbXBpbGUnKTtcbi8vIGZhYnJpYy51dGlsLmxvYWRlciA9IHJlcXVpcmUoJy4vdXRpbC9sb2FkZXInKTtcbi8vIGZhYnJpYy51dGlsLnN5bnRheCA9IHJlcXVpcmUoXCIuL3V0aWwvc3ludGF4XCIpO1xuLy8gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMudXRpbC5vYmplY3QscmVxdWlyZSgnLi91dGlsL29iamVjdC5qcycpKTtcbi8vIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwscmVxdWlyZSgnLi91dGlsL3V0aWwuanMnKSk7XG5cbi8vcmVxdWlyZSgnLi9tb2R1bGVzJyk7XG5cbnJlcXVpcmUoJy4vY29yZS9mYWJyaWMudXRpbCcpO1xucmVxdWlyZSgnLi9jb3JlL29ic2VydmFibGUnKTtcbnJlcXVpcmUoJy4vY29yZS9vYmplY3QuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvaW1hZ2UuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvY2FudmFzLmV4dCcpO1xucmVxdWlyZSgnLi9jb3JlL3RleHQuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvYXBwbGljYXRpb24nKTtcbnJlcXVpcmUoJy4vY29yZS9zbGlkZScpO1xucmVxdWlyZSgnLi9jb3JlL2FwcGxpY2F0aW9uLnNsaWRlcycpO1xucmVxdWlyZSgnLi9jb3JlL2FwcGxpY2F0aW9uLnByb3RvdHlwZXMnKTtcbnJlcXVpcmUoJy4vY29yZS9hY3Rpb25zJyk7XG5yZXF1aXJlKCcuL2NvcmUvZmFicmljLnN0YXRlcycpO1xuLy8gcmVxdWlyZSgnLi9jb3JlL2dyb3VwLmV4dCcpO1xuXG5cbnJlcXVpcmUoJy4vbW9kdWxlcy9kZWJ1ZycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3NsaWRlLnN0cmV0Y2hhYmxlJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvc2xpZGUudGVtcGxhdGUnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9vYmplY3Qub3JkZXInKTtcbi8vIHJlcXVpcmUoJy4vbW9kdWxlcy9zbGlkZS5hcmVhcycpO1xuLy8gcmVxdWlyZSgnLi9tb2R1bGVzL3NsaWRlLmRyYXdpbmctdG9vbHMnKTtcbi8vIHJlcXVpcmUoJy4vbW9kdWxlcy9jYW52YXMuZXZlbnRzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvaW1hZ2UuZmlsdGVycycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2dhbGxlcnknKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9ncmlkJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvbGlicmFyeScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2Zyb21VUkwnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy91cGxvYWQnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9pbnN0YWdyYW0nKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9mYWNlYm9vaycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2Ryb3BwYWJsZScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2ltYWdlLmNyb3AnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9pbWFnZS5mcmFtZScpO1xuLy8gcmVxdWlyZSgnLi9tb2R1bGVzL3Jlc2l6YWJsZScpO1xuLy8gcmVxdWlyZSgnLi9tb2R1bGVzL3J1bGVyJyk7XG4vLyByZXF1aXJlKCcuL21vZHVsZXMvcmVuZGVyJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvdGh1bWInKTtcbi8vIHJlcXVpcmUoJy4vbW9kdWxlcy9jbGlwVG8nKTtcbi8vIHJlcXVpcmUoJy4vbW9kdWxlcy9zaGlydCcpO1xucmVxdWlyZSgnLi9tb2R1bGVzL21vdmVtZW50TGltaXRzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvaGlzdG9yeScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3pvb20nKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9zdmcnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9mYWJyaWMudGFiYmFibGUnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9zdGF0aWNCb3JkZXJDb2xvcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2ludGVyYWN0aXZlTW9kZScpO1xuLy8gcmVxdWlyZSgnLi9tb2R1bGVzL2JvcmRlckltYWdlJyk7XG4vLyByZXF1aXJlKCcuL21vZHVsZXMvc2F2ZUFzJyk7XG4vLyByZXF1aXJlKCcuL2JydXNoZXMvQmFzZUJydXNoJyk7XG4vLyByZXF1aXJlKCcuL2JydXNoZXMvUGVuY2lsQnJ1c2gnKTtcbi8vIHJlcXVpcmUoJy4vYnJ1c2hlcy9SZWN0YW5nbGVCcnVzaCcpO1xuLy8gcmVxdWlyZSgnLi9icnVzaGVzL1BvbHlnb25CcnVzaCcpO1xuLy8gcmVxdWlyZSgnLi9icnVzaGVzL1BhaW50UGVuQnJ1c2gnKTtcbi8vIHJlcXVpcmUoJy4vYnJ1c2hlcy9QYWludEJ1Y2tldEJydXNoJyk7XG4vLyByZXF1aXJlKCcuL2JydXNoZXMvUG9pbnRzQnJ1c2gnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL2ZyYW1lJyk7XG5yZXF1aXJlKCcuL3NoYXBlcy9iYXJjb2RlJyk7XG4vLyByZXF1aXJlKCcuL3NoYXBlcy9wYXRoJyk7XG4vLyByZXF1aXJlKCcuL3NoYXBlcy9jbGlwYXJ0Jyk7XG4vLyByZXF1aXJlKCcuL3NoYXBlcy9waG90bycpO1xuLy8gcmVxdWlyZSgnLi9zaGFwZXMvcG9seWxpbmUnKTtcbi8vIHJlcXVpcmUoJy4vc2hhcGVzL2ltYWdlLnBob3Rvc2hvcC10b29scycpO1xuLy8gcmVxdWlyZSgnLi9zaGFwZXMvaW1hZ2UucmVtb3ZlLXdoaXRlJyk7XG5cbi8vIHJlcXVpcmUoJy4vc2hhcGVzL2JlemllclRleHQnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL3RleHRib3gubWF4TGluZXMnKTtcbi8vIHJlcXVpcmUoJy4vc2hhcGVzL3RleHRib3gubGlzdCcpO1xuLy8gcmVxdWlyZSgnLi9zaGFwZXMvdGV4dEZyYW1lJyk7XG5cblxuaWYoIWZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICByZXF1aXJlKCcuL21vZHVsZXMvbG9hZGVyJyk7XG4gIHJlcXVpcmUoJy4vbW9kdWxlcy9mb250cycpO1xuICByZXF1aXJlKCcuL21vZHVsZXMvdG9vbGJhcnMnKTtcblxuICAvKipcbiAgICogaW5saW5lIHNjcmlwdCBpbWFnZXNcbiAgICogQHR5cGUge3tlcnJvcjogc3RyaW5nfX1cbiAgICovXG4gIGZhYnJpYy5tZWRpYSA9IHtcbiAgICAvKipcbiAgICAgKiByZXBsYWNlIGltYWdlcyBsb2FkZWQgd2l0aCBlcnJvcnNcbiAgICAgKi9cbiAgICBlcnJvcjogJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9lcnJvci1idXR0b24uc3ZnJylcbiAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgID0gZmFicmljO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9maWVyYS5qcyIsImZhYnJpYy51dGlsLmRhdGEgPSByZXF1aXJlKCcuL2RhdGEnKTtcbmZhYnJpYy51dGlsLnBhdGggPSByZXF1aXJlKCcuL3BhdGgnKTtcbmZhYnJpYy51dGlsLmNvbXBpbGUgPSByZXF1aXJlKCcuL2NvbXBpbGUnKTtcbmZhYnJpYy51dGlsLmxvYWRlciA9IHJlcXVpcmUoJy4vbG9hZGVyJyk7XG5mYWJyaWMudXRpbC5zeW50YXggPSByZXF1aXJlKFwiLi9zeW50YXhcIik7XG5mYWJyaWMudXRpbC5wcm9taXNlID0gcmVxdWlyZSgnLi9wcm9taXNlJyk7XG5yZXF1aXJlKCcuL3N0cmluZycpO1xucmVxdWlyZSgnLi9mYWJyaWMudXRpbC5vYmplY3QnKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwscmVxdWlyZSgnLi91dGlsJykpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL2ZhYnJpYy51dGlsLnJlcXVpcmUuanMiLCJcbnZhciBwYXRoID0gcmVxdWlyZShcIi4vcGF0aFwiKTtcbnZhciB1dGlsID0gcmVxdWlyZShcIi4vdXRpbFwiKTtcbnZhciBvYmplY3QgPSByZXF1aXJlKFwiLi9vYmplY3RcIik7XG5cbmZ1bmN0aW9uIGlzU2VydmVyKCkge1xuICByZXR1cm4gISAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuZG9jdW1lbnQpO1xufVxuXG5cbmlmIChpc1NlcnZlcigpKSB7XG4gIHZhciBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbn1cblxuXG5mdW5jdGlvbiBfbG9hZF9qc29uICh2YWx1ZSwgY2FsbGJhY2tfc3VjY2VzcywgY2FsbGJhY2tfZXJyb3Ipe1xuXG4gIHZhciBvdXRwdXQgPSBudWxsO1xuICB2YXIgZXJyb3JzID0gW107XG5cbiAgaWYgKHZhbHVlLmNvbnN0cnVjdG9yID09IFN0cmluZykge1xuXG4gICAgdmFyIGZpbGVuYW1lLCByZWdleF9kYXRhLCBpbml0X3Byb3BlcnR5O1xuICAgIHJlZ2V4X2RhdGEgPSAvXihbXiNdKikjPyguKikkLy5leGVjKHZhbHVlKTtcblxuICAgIGZpbGVuYW1lID0gcmVnZXhfZGF0YVsxXTtcbiAgICBpbml0X3Byb3BlcnR5ID0gcmVnZXhfZGF0YVsyXTtcbiAgICB1dGlscy5nZXRJbmxpbmVKc29uKGZpbGVuYW1lLCBcImpzb25cIiwgX2xvYWRKc29uX2RhdGEsIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgaWYgKGNhbGxiYWNrX2Vycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrX2Vycm9yKGVycm9yKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcImZpbGU6IFxcXCJcIiArIGZpbGVuYW1lICsgXCJcXFwiLiBcIiArIGVycm9yLm1lc3NhZ2UpXG4gICAgICB9XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgX2xvYWRKc29uX2RhdGEodmFsdWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gX2xvYWRKc29uX2RhdGEoZGF0YSkge1xuICAgIC8qXG4gICAgINC30LDQvNC10L3QsCDQt9Cw0L/QuNGB0LXQuSBcInVybCguL3BhdGgvdG8vZmlsZSkgINC90LAgXCIuLi8uLi9wYXRoL3RvL2ZpbGVcIlxuICAgICB1cmwg0L3QsNGH0LjQvdCw0Y7RidC40LXRgdGPINGBIC4vINC+0YLQvdC+0YHQuNGC0LXQu9GM0L3QviDRgNC+0LTQuNGC0LXQu9GM0LrQvtCz0L4ganNvbiDRhNCw0LnQu9CwXG5cbiAgICAgdXJsINGBIFwiL1wiINC00L7QsdCw0LLQu9GP0LXRgtGB0Y8gQVBQX1NUQVRJQ19QQVRIXG4gICAgICovXG4gICAgdXRpbHMucmVjb3Vyc2l2ZShkYXRhLFxuICAgICAgZnVuY3Rpb24gKHByb3BlcnR5LCB2YWx1ZSwgcGFyZW50KSB7XG4gICAgICAgIGlmICgvXnVybFxcKC4qXFwpJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICB2YXIgcmVnZXhfZGF0YSA9IC9edXJsXFwoKFxcLj9cXC8pPyguKilcXCkkLy5leGVjKHZhbHVlKTtcbiAgICAgICAgICB2YXIgdXJsID0gcmVnZXhfZGF0YVsyXTtcblxuICAgICAgICAgIGlmIChyZWdleF9kYXRhWzFdID09IFwiL1wiKSB7XG4gICAgICAgICAgICB1cmwgPSB3aW5kb3cuQVBQX1NUQVRJQ19QQVRIICsgdXJsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocmVnZXhfZGF0YVsxXSA9PSBcIi4vXCIpIHtcbiAgICAgICAgICAgIHVybCA9IHBhdGguZ2V0UGFyZW50RGlyZWN0b3J5VXJsKGZpbGVuYW1lKSArIHVybDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwYXJlbnRbcHJvcGVydHldID0gcGF0aC5yZXNvbHZlKHVybCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuXG5cbiAgICB2YXIgbG9hZGVyID0gdXRpbC5xdWV1ZUxvYWQoMSwgZnVuY3Rpb24gZmluYWxpemUoKSB7XG5cbiAgICAgIGlmIChpbml0X3Byb3BlcnR5KSB7XG4gICAgICAgIHZhciBwcm9wX2FyciA9IGluaXRfcHJvcGVydHkuc3BsaXQoXCIvXCIpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BfYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgZGF0YSA9IGRhdGFbcHJvcF9hcnJbaV1dO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChlcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgIGlmIChjYWxsYmFja19lcnJvcikgY2FsbGJhY2tfZXJyb3IoZXJyb3JzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChjYWxsYmFja19zdWNjZXNzKSBjYWxsYmFja19zdWNjZXNzKGRhdGEpO1xuICAgICAgICBvdXRwdXQgPSBkYXRhO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogcmVtb3ZlIGNvbW1lbnRzXG4gICAgICovXG4gICAgdXRpbHMucmVjb3Vyc2l2ZShkYXRhLCBmdW5jdGlvbiAocHJvcGVydHksIHZhbHVlLCBwYXJlbnQpIHtcbiAgICAgIC8qXG4gICAgICAgcmVtb3ZlIGNvbW1lbnRzIGxpa2VcbiAgICAgICBbXCJAY29tbWVudCgpXCJdXG4gICAgICAgXCJAY29tbWVudFwiOiB7fVxuICAgICAgICovXG4gICAgICBpZiAoL15cXC9cXC8uKiQvLnRlc3QodmFsdWUpIHx8IC9eQGNvbW1lbnRcXCguKlxcKSQvLnRlc3QodmFsdWUpIHx8IHByb3BlcnR5ID09IFwiQGNvbW1lbnRcIikge1xuICAgICAgICBpZiAocGFyZW50LmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgICAgcGFyZW50LnNwbGljZShwcm9wZXJ0eSwgMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIHBhcmVudFtwcm9wZXJ0eV07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoL15AZXh0ZW5kLiokLy50ZXN0KHByb3BlcnR5KSkge1xuXG4gICAgICAgIGxvYWRlci50b3RhbCsrO1xuICAgICAgICBfbG9hZF9qc29uKHZhbHVlLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHZhciBleHRfZGF0YSA9IG9iamVjdC5kZWVwRXh0ZW5kKGRhdGEsIHBhcmVudCk7XG4gICAgICAgICAgb2JqZWN0LmRlZXBFeHRlbmQocGFyZW50LCBleHRfZGF0YSk7XG4gICAgICAgICAgZGVsZXRlIHBhcmVudFtcIkBleHRlbmRcIl07XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhLCBlcnJvcikge1xuICAgICAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKC9eQGV4dGVuZFxcKC4qXFwpJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgdmFyIF9yZWdfZGF0YSA9IC9eQGV4dGVuZFxcKChcXC5cXC8pPyguKilcXCkkLy5leGVjKHZhbHVlKTtcbiAgICAgICAgdmFyIHVybCA9IF9yZWdfZGF0YVsyXTtcbiAgICAgICAgaWYgKF9yZWdfZGF0YVsxXSkge1xuICAgICAgICAgIHVybCA9IHBhdGguZ2V0UGFyZW50RGlyZWN0b3J5VXJsKGZpbGVuYW1lKSArIHVybDtcbiAgICAgICAgfVxuICAgICAgICBsb2FkZXIudG90YWwrKztcbiAgICAgICAgX2xvYWRfanNvbih1cmwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgcGFyZW50W3Byb3BlcnR5XSA9IGRhdGE7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhLCBlcnJvcikge1xuICAgICAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKC9eQG1peGluXFwoLipcXCkkLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICB2YXIgX3JlZ19kYXRhID0gL15AbWl4aW5cXCgoXFwuXFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgIHZhciB1cmwgPSBfcmVnX2RhdGFbMl07XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0pIHtcbiAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgIH1cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIF9sb2FkX2pzb24odXJsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIGlmIChwYXJlbnQuY29uc3RydWN0b3IgPT0gQXJyYXkpIHtcbiAgICAgICAgICAgIHBhcmVudC5zcGxpY2UocHJvcGVydHksIDEpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgIHBhcmVudC5wdXNoKGRhdGFbaV0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbcHJvcGVydHldO1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7XG4gICAgICAgICAgICAgIHBhcmVudFtpXSA9IGRhdGFbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICgvXkBsb2FkXFwoKC4qKVxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHZhciBfcmVnX2RhdGEgPSAvXkBsb2FkXFwoKFxcLj9cXC8pPyguKilcXCkkLy5leGVjKHZhbHVlKTtcbiAgICAgICAgdmFyIHVybCA9IF9yZWdfZGF0YVsyXTtcbiAgICAgICAgaWYgKF9yZWdfZGF0YVsxXSA9PSBcIi9cIikge1xuICAgICAgICAgIHVybCA9IHdpbmRvdy5BUFBfU1RBVElDX1BBVEggKyB1cmw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9yZWdfZGF0YVsxXSA9PSBcIi4vXCIpIHtcbiAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgIH1cblxuICAgICAgICBsb2FkZXIudG90YWwrKztcbiAgICAgICAgdXRpbHMuZ2V0SW5saW5lSnNvbih1cmwsIFwiaHRtbFwiLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHBhcmVudFtwcm9wZXJ0eV0gPSBkYXRhO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgfSk7XG4gICAgbG9hZGVyKCk7XG5cbiAgfVxuXG4gIHJldHVybiBvdXRwdXQ7XG59XG5cbnZhciB1dGlscyA9IHtcbiAgQ0FDSEVEX0pTT04gOiB7fSxcbiAgbG9hZEpzb25TeW5jOiBmdW5jdGlvbihzcmMpe1xuICAgIHZhciBkYXRhO1xuICAgIF9sb2FkX2pzb24oc3JjLGZ1bmN0aW9uKF9kYXRhKXtcbiAgICAgIGRhdGEgPSBfZGF0YTtcbiAgICB9KTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfSxcblxuICAvKipcbiAgINC/0L7Qt9Cy0L7Qu9GP0LXRgiDQuNGB0L/QvtC70YzQt9C+0LLQsNGC0Ywg0LrQvtC90YHRgtGA0YPQutGG0LjQuCDQstC40LTQsFxuICAg0YDQsNGB0YjQuNGA0LjRgtGMINC00LDQvdC90YvQtSDQuNC3INGE0LDQudC70LAgdGVtcGxhdGUuanNvblxuICAgXCJAZXh0ZW5kXCIgOiBcInVybChkYXRhL3RlbXBsYXRlLmpzb24pXCIsXG4gICBcIkBleHRlbmRcIiA6IFwidXJsKGRhdGEvdGVtcGxhdGUuanNvbiNzZXR0aW5ncy9zdGFnZXMpXCIsXG5cbiAgIC8v0LfQsNC80LXQvdC40YLRjCDRgdGC0YDQvtC60YMg0L3QsNC00LDQvdC90YvQtSDQuNC3INGE0LDQudC70LBcbiAgIFwic3RhZ2VzXCI6ICAgICAgIFwidXJsKGRhdGEvdGVtcGxhdGUuanNvbiNzZXR0aW5ncy9zdGFnZXMpXCIsXG5cbiAgICogQHBhcmFtIGZpbGVuYW1lXG4gICAqIEBwYXJhbSBjYWxsYmFja19zdWNjZXNzXG4gICAqIEBwYXJhbSBjYWxsYmFja19lcnJvclxuICAgKi9cbiAgbG9hZEpzb246IGZ1bmN0aW9uICh2YWx1ZSxyZXNvbHZlX2NiLGZhaWxfY2IpIHtcbiAgICAgIHJldHVybiBfbG9hZF9qc29uKHZhbHVlLGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICByZXNvbHZlX2NiICYmIHJlc29sdmVfY2IoZGF0YSk7XG4gICAgICB9LGZ1bmN0aW9uKGVycil7XG4gICAgICAgIGZhaWxfY2IgJiYgZmFpbF9jYihlcnIpO1xuICAgICAgfSk7XG4gIH0sXG5cbiAgcmVtb3ZlQ29tbWVudHM6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXlxccyooXFwvXFwvLip8KD86XFwvXFwqW1xcc1xcU10qPylcXCpcXC9cXHMqKSQvZ20sXCJcIik7XG4gICAgcmV0dXJuIHN0cjtcbiAgfSxcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBvYmplY3RcbiAgICogQHBhcmFtIGNyaXRlcmlhIC0g0LLRi9C/0L7Qu9C90Y/RgtGMINGE0YPQvdC60YbQuNGOINGB0L4g0LLRgdC10LzQuCDQvtCx0YrQtdC60YLQsNC80LhcbiAgICovXG4gIHJlY291cnNpdmU6IGZ1bmN0aW9uIChvYmplY3QsIGNyaXRlcmlhKSB7XG4gICAgdmFyIHJlYWRlZCA9IFtdO1xuICAgIGlmICghb2JqZWN0KSByZXR1cm47XG4gICAgcmV0dXJuIChmdW5jdGlvbiBzdWJfcmVjb3Vyc2l2ZShvYmplY3QpIHtcbiAgICAgIGlmIChyZWFkZWQuaW5kZXhPZihvYmplY3QpICE9IC0xKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHJlYWRlZC5wdXNoKG9iamVjdCk7XG5cblxuICAgICAgaWYgKG9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGZvciAodmFyIHByb3AgPSBvYmplY3QubGVuZ3RoOyBwcm9wLS07KSB7XG4gICAgICAgICAgaWYgKG9iamVjdFtwcm9wXSAmJiAob2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IE9iamVjdCB8fCBvYmplY3RbcHJvcF0uY29uc3RydWN0b3IgPT0gQXJyYXkpKSB7XG4gICAgICAgICAgICBzdWJfcmVjb3Vyc2l2ZShvYmplY3RbcHJvcF0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgYnJlYWtfID0gY3JpdGVyaWEocHJvcCwgb2JqZWN0W3Byb3BdLCBvYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBvYmplY3QpIHtcbiAgICAgICAgICBpZiAob2JqZWN0W3Byb3BdICYmIChvYmplY3RbcHJvcF0uY29uc3RydWN0b3IgPT0gT2JqZWN0IHx8IG9iamVjdFtwcm9wXS5jb25zdHJ1Y3RvciA9PSBBcnJheSkpIHtcbiAgICAgICAgICAgIHN1Yl9yZWNvdXJzaXZlKG9iamVjdFtwcm9wXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBicmVha18gPSBjcml0ZXJpYShwcm9wLCBvYmplY3RbcHJvcF0sIG9iamVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSkob2JqZWN0KTtcbiAgfSxcblxuICBwYXJzZUNTVjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB2YXIgcm93cyA9IGRhdGEuc3BsaXQoL1xcbi8pO1xuICAgIHZhciBjb2x1bW5zID0gcm93c1swXS5zcGxpdCgnLCcpO1xuICAgIHJvd3Muc3BsaWNlKDAsIDEpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgb3V0cHV0X3Jvd19kYXRhID0ge307XG4gICAgICB2YXIgcm93X2RhdGEgPSBbXTtcblxuXG4gICAgICB2YXIgX3F1b3RlID0gZmFsc2UsIGxhc3QgPSAtMTtcbiAgICAgIHZhciBqID0gLTE7XG4gICAgICB2YXIgc3RyID0gcm93c1tpXTtcbiAgICAgIHdoaWxlICgrK2ogPCBzdHIubGVuZ3RoKSB7XG4gICAgICAgIGlmICghX3F1b3RlKSB7XG4gICAgICAgICAgaWYgKHN0cltqXSA9PSAnXFwnJyB8fCBzdHJbal0gPT0gJ1xcXCInKSB7XG4gICAgICAgICAgICBfcXVvdGUgPSBzdHJbal07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzdHJbal0gPT0gXCIsXCIpIHtcbiAgICAgICAgICAgIHZhciBfdmFsID0gc3RyLnN1YnN0cmluZyhsYXN0LCBqKTtcbiAgICAgICAgICAgIGlmIChfdmFsWzBdID09ICdcXFwiJyAmJiBfdmFsW192YWwubGVuZ3RoIC0gMV0gPT0gJ1xcXCInKSB7XG4gICAgICAgICAgICAgIF92YWwgPSBfdmFsLnN1YnN0cmluZygxLCBfdmFsLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcm93X2RhdGEucHVzaChfdmFsKTtcbiAgICAgICAgICAgIGxhc3QgPSBqICsgMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHN0cltqXSA9PSBfcXVvdGUpIHtcbiAgICAgICAgICAgIF9xdW90ZSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBqIGluIHJvd19kYXRhKSB7XG4gICAgICAgIG91dHB1dF9yb3dfZGF0YVtjb2x1bW5zW2pdXSA9IHJvd19kYXRhW2pdO1xuICAgICAgfVxuICAgICAgcm93c1tpXSA9IG91dHB1dF9yb3dfZGF0YTtcbiAgICB9XG4gICAgcmV0dXJuIHJvd3M7XG4gIH0sXG4gIC8qKlxuICAgKlxuICAgKiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80ODQzNzQ2L3JlZ3VsYXItZXhwcmVzc2lvbi10by1hZGQtZG91YmxlLXF1b3Rlcy1hcm91bmQta2V5cy1pbi1qYXZhc2NyaXB0XG4gICAqL1xuICBkb3VibGVRdW90ZTogZnVuY3Rpb24oanNvblN0cmluZyl7XG4gICAgdmFyIG9iaktleXNSZWdleCA9IC8oe3wsKSg/OlxccyopKD86Jyk/KFtBLVphLXpfJFxcLl1bQS1aYS16MC05XyBcXC1cXC4kXSopKD86Jyk/KD86XFxzKik6L2c7Ly8gbG9vayBmb3Igb2JqZWN0IG5hbWVzXG4gICAgcmV0dXJuIGpzb25TdHJpbmcucmVwbGFjZShvYmpLZXlzUmVnZXgsIFwiJDFcXFwiJDJcXFwiOlwiKTsvLyBhbGwgb2JqZWN0IG5hbWVzIHNob3VsZCBiZSBkb3VibGUgcXVvdGVkXG4gIH0sXG4gIHBhcnNlRGF0YTogZnVuY3Rpb24gKGRhdGEsIGRhdGFUeXBlKSB7XG4gICAgdmFyIF9wYXJzZWQ7XG4gICAgaWYgKGRhdGFUeXBlID09IFwiY3N2XCIpIHtcbiAgICAgIF9wYXJzZWQgPSB1dGlscy5wYXJzZUNTVihkYXRhKTtcbiAgICB9IGVsc2UgaWYgKGRhdGFUeXBlID09IFwianNvblwiKSB7XG4gICAgICBfcGFyc2VkID0gZGF0YS50cmltKCk7XG4gICAgICAvL2lmIChkYXRhWzBdICE9IFwie1wiICYmIGRhdGFbMF0gIT0gXCJbXCIpIHtcbiAgICAgIC8vICByZXR1cm4gZmFsc2U7XG4gICAgICAvL31cblxuICAgICAgX3BhcnNlZCA9IHV0aWxzLnJlbW92ZUNvbW1lbnRzKF9wYXJzZWQpO1xuICAgICAgLy9kYXRhICA9IGRhdGEucmVwbGFjZSgvXFxuL2csXCJcIilcblxuXG4gICAgICBfcGFyc2VkID0gdXRpbHMuZG91YmxlUXVvdGUoX3BhcnNlZCk7XG5cbiAgICAgIHRyeXtcbiAgICAgICAgdmFyIF9wYXJzZWQgPSBKU09OLnBhcnNlKF9wYXJzZWQpOy8vPSBKU09OLnBhcnNlKGRhdGEucmVwbGFjZSgvXFwvXFwqW1xcc1xcU10qP1xcKlxcL3xcXC9cXC8uKi9nLFwiXCIpKTtcbiAgICAgIH1jYXRjaChlKXtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgICBtZXNzYWdlOiBlLnRvU3RyaW5nKCksXG4gICAgICAgICAgZGF0YTogIGRhdGFcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIC8vdmFyIHNjcmlwdCA9ICQoXCI8c2NyaXB0IHR5cGU9J3RleHQvanNvbicgaWQ9J1wiICsgdXJsICsgXCInPlwiICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkgKyBcIjwvc2NyaXB0PlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICBkYXRhOiBfcGFyc2VkXG4gICAgfTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKHVybCwgZGF0YVR5cGUsIGNhbGxiYWNrX3N1Y2Nlc3MsIGNhbGxiYWNrX2Vycm9yKSB7XG4gICAgLy90b2RvXG4gICAgaWYgKGlzU2VydmVyKCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBkYXRhID0gZnMucmVhZEZpbGVTeW5jKHVybCwgJ3V0ZjgnKTtcbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXlxcdUZFRkYvLCAnJyk7XG4gICAgICAgIHZhciBfcGFyc2VkID0gdXRpbHMucGFyc2VEYXRhKGRhdGEsIGRhdGFUeXBlKTtcbiAgICAgICAgaWYoX3BhcnNlZC5zdGF0dXMgPT0gXCJlcnJvclwiKXtcbiAgICAgICAgICBjYWxsYmFja19lcnJvcih7XG4gICAgICAgICAgICBzdGF0dXM6ICAgXCJlcnJvclwiLFxuICAgICAgICAgICAgbWVzc2FnZTogIF9wYXJzZWQubWVzc2FnZSxcbiAgICAgICAgICAgIGRhdGE6ICAgICBfcGFyc2VkLmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhfcGFyc2VkLmRhdGEpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICAgIGlmIChlLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZpbGUgbm90IGZvdW5kIScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2tfZXJyb3IoZGF0YSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcblxuICAgICAgdmFyIGh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgIGh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICBpZiAoaHR0cFJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gaHR0cFJlcXVlc3QucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgdmFyIF9wYXJzZWQgPSB1dGlscy5wYXJzZURhdGEoZGF0YSwgZGF0YVR5cGUpO1xuICAgICAgICAgICAgaWYoX3BhcnNlZC5zdGF0dXMgPT0gXCJlcnJvclwiKXtcbiAgICAgICAgICAgICAgY2FsbGJhY2tfZXJyb3Ioe1xuICAgICAgICAgICAgICAgIHN0YXR1czogaHR0cFJlcXVlc3Quc3RhdHVzLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICBfcGFyc2VkLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U6IGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhfcGFyc2VkLmRhdGEpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFja19lcnJvcih1cmwsIGh0dHBSZXF1ZXN0KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGh0dHBSZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICBodHRwUmVxdWVzdC5zZW5kKCk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICog0J/QvtC30LLQvtC70Y/QtdGC0LfQsNCz0YDRg9C20LDRgtGMIGpzb24g0YTQsNC50LvRiyAsINGB0L7QtNC10YDQttCw0YnQuNC1INGB0YHRi9C70LrQuCDQvdCwINC00YDRg9Cz0LjQtSBqc29uINGE0LDQudC70YsuXG4gICAqINCy0LzQtdGB0YLQviDRgdGB0YvQu9C+0Log0YLQuNC/0LBcbiAgICogIFwicHJvcGVydHlcIiA6IFwidXJsKGNodW5rLmpzb24pXCJcbiAgICogINCx0YPQtNC10YIg0LfQsNCz0YDRg9C20LXQvdC+INGB0L7QtNC10YDQttC40LzQvtC1INGE0LDQudC70LBcbiAgICogIFwicHJvcGVydHlcIiA6IHsuLi59XG4gICAqXG4gICAqICDQtdGB0LvQuCDRg9C60LDQt9Cw0YLRjCDRj9C60L7RgNGMXG4gICAqICBcInByb3BlcnR5XCIgOiBcInVybChjaHVuay5qc29uI3NldHRpbmdzL2NodW5rLzAvdGV4dClcIlxuICAgKlxuICAgKiDRgtC+INCx0YPQtNC10YIg0LfQsNCz0YDRg9C20LXQvdC+INGB0L7QtNC10YDQttC40LzQvtC1INC/0L7Qu9GPIHNldHRpbmdzLmNodW5rWzBdLnRleHQg0LjQtyDRhNCw0LnQu9CwIGNodW5rLmpzb25cbiAgICpcbiAgICpcbiAgICogQHBhcmFtIGZpbGVuYW1lICDQv9GD0YLRjCDQuiDQvtGB0L3QvtCy0L3QvtC80YMganNvbiDRhNCw0LnQu9GDXG4gICAqIEBwYXJhbSBjYWxsYmFjayAg0LHRg9C00LXRgiDQstGL0LfQstCw0L0g0L/QvtGB0LvQtSDQvtC60L7QvdGH0LDQvdC40Y8g0LfQsNCz0YDRg9C30LrQuCDQstGB0LXRhSDRhNCw0LnQu9C+0LJcbiAgICovXG4gIGdldElubGluZUpzb246IGZ1bmN0aW9uICh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcikge1xuXG4gICAgaWYgKGRhdGFUeXBlLmNvbnN0cnVjdG9yICE9IFN0cmluZykge1xuICAgICAgY2FsbGJhY2tfZXJyb3IgPSBjYWxsYmFja19zdWNjZXNzO1xuICAgICAgY2FsbGJhY2tfc3VjY2VzcyA9IGRhdGFUeXBlO1xuICAgICAgZGF0YVR5cGUgPSBcImpzb25cIjtcbiAgICB9XG5cblxuICAgIGlmICh0eXBlb2YgdXRpbHMuQ0FDSEVEX0pTT04gIT09IFwidW5kZWZpbmVkXCIgJiYgdXRpbHMuQ0FDSEVEX0pTT04gJiYgdXRpbHMuQ0FDSEVEX0pTT05bdXJsXSkge1xuICAgICAgY2FsbGJhY2tfc3VjY2Vzcyh1dGlscy5DQUNIRURfSlNPTlt1cmxdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiAkICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHZhciBpbmxpbmUgPSAkKFwic2NyaXB0W2lkPSdcIiArIHVybCArIFwiJ11cIik7XG4gICAgICAgIGlmIChpbmxpbmUubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciBfZGF0YSA9XG4gICAgICAgICAgICBpbmxpbmVbMF0uaW5uZXJUZXh0IHx8IC8vYWxsXG4gICAgICAgICAgICBpbmxpbmVbMF0udGV4dENvbnRlbnQgfHwgLy9maXJlZm94XG4gICAgICAgICAgICBpbmxpbmVbMF0udGV4dDsgLy9pZThcbiAgICAgICAgICBpZiAoZGF0YVR5cGUgPT0gXCJqc29uXCIpIHtcblxuICAgICAgICAgICAgdmFyIF9kYXRhID0gdXRpbHMucmVtb3ZlQ29tbWVudHMoX2RhdGEpO1xuICAgICAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhKU09OLnBhcnNlKF9kYXRhKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoX2RhdGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdXRpbHMubG9hZCh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcik7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvZGF0YS5qcyIsIi8vICAgICBVbmRlcnNjb3JlLmpzIDEuOC4zXG4vLyAgICAgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmdcbi8vICAgICAoYykgMjAwOS0yMDE1IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzXG4vLyAgICAgVW5kZXJzY29yZSBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cblxuXG4gIC8vIFNhdmUgYnl0ZXMgaW4gdGhlIG1pbmlmaWVkIChidXQgbm90IGd6aXBwZWQpIHZlcnNpb246XG4gIHZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlLCBPYmpQcm90byA9IE9iamVjdC5wcm90b3R5cGUsIEZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZTtcblxuICAvLyBDcmVhdGUgcXVpY2sgcmVmZXJlbmNlIHZhcmlhYmxlcyBmb3Igc3BlZWQgYWNjZXNzIHRvIGNvcmUgcHJvdG90eXBlcy5cbiAgdmFyXG4gICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCxcbiAgICBzbGljZSAgICAgICAgICAgID0gQXJyYXlQcm90by5zbGljZSxcbiAgICB0b1N0cmluZyAgICAgICAgID0gT2JqUHJvdG8udG9TdHJpbmcsXG4gICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5O1xuXG4gIC8vIEFsbCAqKkVDTUFTY3JpcHQgNSoqIG5hdGl2ZSBmdW5jdGlvbiBpbXBsZW1lbnRhdGlvbnMgdGhhdCB3ZSBob3BlIHRvIHVzZVxuICAvLyBhcmUgZGVjbGFyZWQgaGVyZS5cbiAgdmFyXG4gICAgbmF0aXZlSXNBcnJheSAgICAgID0gQXJyYXkuaXNBcnJheSxcbiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cyxcbiAgICBuYXRpdmVCaW5kICAgICAgICAgPSBGdW5jUHJvdG8uYmluZCxcbiAgICBuYXRpdmVDcmVhdGUgICAgICAgPSBPYmplY3QuY3JlYXRlO1xuXG4gIC8vIE5ha2VkIGZ1bmN0aW9uIHJlZmVyZW5jZSBmb3Igc3Vycm9nYXRlLXByb3RvdHlwZS1zd2FwcGluZy5cbiAgdmFyIEN0b3IgPSBmdW5jdGlvbigpe307XG5cbiAgLy8gQ3JlYXRlIGEgc2FmZSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciB1c2UgYmVsb3cuXG4gIHZhciBfID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7XG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIF8pKSByZXR1cm4gbmV3IF8ob2JqKTtcbiAgICB0aGlzLl93cmFwcGVkID0gb2JqO1xuICB9O1xuXG4gIC8vIEN1cnJlbnQgdmVyc2lvbi5cbiAgXy5WRVJTSU9OID0gJzEuOC4zJztcblxuICAvLyBJbnRlcm5hbCBmdW5jdGlvbiB0aGF0IHJldHVybnMgYW4gZWZmaWNpZW50IChmb3IgY3VycmVudCBlbmdpbmVzKSB2ZXJzaW9uXG4gIC8vIG9mIHRoZSBwYXNzZWQtaW4gY2FsbGJhY2ssIHRvIGJlIHJlcGVhdGVkbHkgYXBwbGllZCBpbiBvdGhlciBVbmRlcnNjb3JlXG4gIC8vIGZ1bmN0aW9ucy5cbiAgdmFyIG9wdGltaXplQ2IgPSBmdW5jdGlvbihmdW5jLCBjb250ZXh0LCBhcmdDb3VudCkge1xuICAgIGlmIChjb250ZXh0ID09PSB2b2lkIDApIHJldHVybiBmdW5jO1xuICAgIHN3aXRjaCAoYXJnQ291bnQgPT0gbnVsbCA/IDMgOiBhcmdDb3VudCkge1xuICAgICAgY2FzZSAxOiByZXR1cm4gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbChjb250ZXh0LCB2YWx1ZSk7XG4gICAgICB9O1xuICAgICAgY2FzZSAyOiByZXR1cm4gZnVuY3Rpb24odmFsdWUsIG90aGVyKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUsIG90aGVyKTtcbiAgICAgIH07XG4gICAgICBjYXNlIDM6IHJldHVybiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pO1xuICAgICAgfTtcbiAgICAgIGNhc2UgNDogcmV0dXJuIGZ1bmN0aW9uKGFjY3VtdWxhdG9yLCB2YWx1ZSwgaW5kZXgsIGNvbGxlY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGZ1bmMuY2FsbChjb250ZXh0LCBhY2N1bXVsYXRvciwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTtcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfTtcblxuICAvLyBBIG1vc3RseS1pbnRlcm5hbCBmdW5jdGlvbiB0byBnZW5lcmF0ZSBjYWxsYmFja3MgdGhhdCBjYW4gYmUgYXBwbGllZFxuICAvLyB0byBlYWNoIGVsZW1lbnQgaW4gYSBjb2xsZWN0aW9uLCByZXR1cm5pbmcgdGhlIGRlc2lyZWQgcmVzdWx0IOKAlCBlaXRoZXJcbiAgLy8gaWRlbnRpdHksIGFuIGFyYml0cmFyeSBjYWxsYmFjaywgYSBwcm9wZXJ0eSBtYXRjaGVyLCBvciBhIHByb3BlcnR5IGFjY2Vzc29yLlxuICB2YXIgY2IgPSBmdW5jdGlvbih2YWx1ZSwgY29udGV4dCwgYXJnQ291bnQpIHtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCkgcmV0dXJuIF8uaWRlbnRpdHk7XG4gICAgaWYgKF8uaXNGdW5jdGlvbih2YWx1ZSkpIHJldHVybiBvcHRpbWl6ZUNiKHZhbHVlLCBjb250ZXh0LCBhcmdDb3VudCk7XG4gICAgaWYgKF8uaXNPYmplY3QodmFsdWUpKSByZXR1cm4gXy5tYXRjaGVyKHZhbHVlKTtcbiAgICByZXR1cm4gXy5wcm9wZXJ0eSh2YWx1ZSk7XG4gIH07XG4gIF8uaXRlcmF0ZWUgPSBmdW5jdGlvbih2YWx1ZSwgY29udGV4dCkge1xuICAgIHJldHVybiBjYih2YWx1ZSwgY29udGV4dCwgSW5maW5pdHkpO1xuICB9O1xuXG4gIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIGZvciBjcmVhdGluZyBhc3NpZ25lciBmdW5jdGlvbnMuXG4gIHZhciBjcmVhdGVBc3NpZ25lciA9IGZ1bmN0aW9uKGtleXNGdW5jLCB1bmRlZmluZWRPbmx5KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikge1xuICAgICAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICBpZiAobGVuZ3RoIDwgMiB8fCBvYmogPT0gbnVsbCkgcmV0dXJuIG9iajtcbiAgICAgIGZvciAodmFyIGluZGV4ID0gMTsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpbmRleF0sXG4gICAgICAgICAgICBrZXlzID0ga2V5c0Z1bmMoc291cmNlKSxcbiAgICAgICAgICAgIGwgPSBrZXlzLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgICAgICBpZiAoIXVuZGVmaW5lZE9ubHkgfHwgb2JqW2tleV0gPT09IHZvaWQgMCkgb2JqW2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG9iajtcbiAgICB9O1xuICB9O1xuXG4gIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIGZvciBjcmVhdGluZyBhIG5ldyBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIGFub3RoZXIuXG4gIHZhciBiYXNlQ3JlYXRlID0gZnVuY3Rpb24ocHJvdG90eXBlKSB7XG4gICAgaWYgKCFfLmlzT2JqZWN0KHByb3RvdHlwZSkpIHJldHVybiB7fTtcbiAgICBpZiAobmF0aXZlQ3JlYXRlKSByZXR1cm4gbmF0aXZlQ3JlYXRlKHByb3RvdHlwZSk7XG4gICAgQ3Rvci5wcm90b3R5cGUgPSBwcm90b3R5cGU7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBDdG9yO1xuICAgIEN0b3IucHJvdG90eXBlID0gbnVsbDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHZhciBwcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkge1xuICAgIHJldHVybiBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiBvYmogPT0gbnVsbCA/IHZvaWQgMCA6IG9ialtrZXldO1xuICAgIH07XG4gIH07XG5cbiAgLy8gSGVscGVyIGZvciBjb2xsZWN0aW9uIG1ldGhvZHMgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBjb2xsZWN0aW9uXG4gIC8vIHNob3VsZCBiZSBpdGVyYXRlZCBhcyBhbiBhcnJheSBvciBhcyBhbiBvYmplY3RcbiAgLy8gUmVsYXRlZDogaHR0cDovL3Blb3BsZS5tb3ppbGxhLm9yZy9+am9yZW5kb3JmZi9lczYtZHJhZnQuaHRtbCNzZWMtdG9sZW5ndGhcbiAgLy8gQXZvaWRzIGEgdmVyeSBuYXN0eSBpT1MgOCBKSVQgYnVnIG9uIEFSTS02NC4gIzIwOTRcbiAgdmFyIE1BWF9BUlJBWV9JTkRFWCA9IE1hdGgucG93KDIsIDUzKSAtIDE7XG4gIHZhciBnZXRMZW5ndGggPSBwcm9wZXJ0eSgnbGVuZ3RoJyk7XG4gIHZhciBpc0FycmF5TGlrZSA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pIHtcbiAgICB2YXIgbGVuZ3RoID0gZ2V0TGVuZ3RoKGNvbGxlY3Rpb24pO1xuICAgIHJldHVybiB0eXBlb2YgbGVuZ3RoID09ICdudW1iZXInICYmIGxlbmd0aCA+PSAwICYmIGxlbmd0aCA8PSBNQVhfQVJSQVlfSU5ERVg7XG4gIH07XG5cbiAgLy8gQ29sbGVjdGlvbiBGdW5jdGlvbnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBUaGUgY29ybmVyc3RvbmUsIGFuIGBlYWNoYCBpbXBsZW1lbnRhdGlvbiwgYWthIGBmb3JFYWNoYC5cbiAgLy8gSGFuZGxlcyByYXcgb2JqZWN0cyBpbiBhZGRpdGlvbiB0byBhcnJheS1saWtlcy4gVHJlYXRzIGFsbFxuICAvLyBzcGFyc2UgYXJyYXktbGlrZXMgYXMgaWYgdGhleSB3ZXJlIGRlbnNlLlxuICBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0ZWUgPSBvcHRpbWl6ZUNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICB2YXIgaSwgbGVuZ3RoO1xuICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7XG4gICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaXRlcmF0ZWUob2JqW2ldLCBpLCBvYmopO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopO1xuICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBpdGVyYXRlZShvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH07XG5cbiAgLy8gUmV0dXJuIHRoZSByZXN1bHRzIG9mIGFwcGx5aW5nIHRoZSBpdGVyYXRlZSB0byBlYWNoIGVsZW1lbnQuXG4gIF8ubWFwID0gXy5jb2xsZWN0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksXG4gICAgICAgIGxlbmd0aCA9IChrZXlzIHx8IG9iaikubGVuZ3RoLFxuICAgICAgICByZXN1bHRzID0gQXJyYXkobGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4O1xuICAgICAgcmVzdWx0c1tpbmRleF0gPSBpdGVyYXRlZShvYmpbY3VycmVudEtleV0sIGN1cnJlbnRLZXksIG9iaik7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIC8vIENyZWF0ZSBhIHJlZHVjaW5nIGZ1bmN0aW9uIGl0ZXJhdGluZyBsZWZ0IG9yIHJpZ2h0LlxuICBmdW5jdGlvbiBjcmVhdGVSZWR1Y2UoZGlyKSB7XG4gICAgLy8gT3B0aW1pemVkIGl0ZXJhdG9yIGZ1bmN0aW9uIGFzIHVzaW5nIGFyZ3VtZW50cy5sZW5ndGhcbiAgICAvLyBpbiB0aGUgbWFpbiBmdW5jdGlvbiB3aWxsIGRlb3B0aW1pemUgdGhlLCBzZWUgIzE5OTEuXG4gICAgZnVuY3Rpb24gaXRlcmF0b3Iob2JqLCBpdGVyYXRlZSwgbWVtbywga2V5cywgaW5kZXgsIGxlbmd0aCkge1xuICAgICAgZm9yICg7IGluZGV4ID49IDAgJiYgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IGRpcikge1xuICAgICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4O1xuICAgICAgICBtZW1vID0gaXRlcmF0ZWUobWVtbywgb2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1lbW87XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIG1lbW8sIGNvbnRleHQpIHtcbiAgICAgIGl0ZXJhdGVlID0gb3B0aW1pemVDYihpdGVyYXRlZSwgY29udGV4dCwgNCk7XG4gICAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLFxuICAgICAgICAgIGxlbmd0aCA9IChrZXlzIHx8IG9iaikubGVuZ3RoLFxuICAgICAgICAgIGluZGV4ID0gZGlyID4gMCA/IDAgOiBsZW5ndGggLSAxO1xuICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBpbml0aWFsIHZhbHVlIGlmIG5vbmUgaXMgcHJvdmlkZWQuXG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDMpIHtcbiAgICAgICAgbWVtbyA9IG9ialtrZXlzID8ga2V5c1tpbmRleF0gOiBpbmRleF07XG4gICAgICAgIGluZGV4ICs9IGRpcjtcbiAgICAgIH1cbiAgICAgIHJldHVybiBpdGVyYXRvcihvYmosIGl0ZXJhdGVlLCBtZW1vLCBrZXlzLCBpbmRleCwgbGVuZ3RoKTtcbiAgICB9O1xuICB9XG5cbiAgLy8gKipSZWR1Y2UqKiBidWlsZHMgdXAgYSBzaW5nbGUgcmVzdWx0IGZyb20gYSBsaXN0IG9mIHZhbHVlcywgYWthIGBpbmplY3RgLFxuICAvLyBvciBgZm9sZGxgLlxuICBfLnJlZHVjZSA9IF8uZm9sZGwgPSBfLmluamVjdCA9IGNyZWF0ZVJlZHVjZSgxKTtcblxuICAvLyBUaGUgcmlnaHQtYXNzb2NpYXRpdmUgdmVyc2lvbiBvZiByZWR1Y2UsIGFsc28ga25vd24gYXMgYGZvbGRyYC5cbiAgXy5yZWR1Y2VSaWdodCA9IF8uZm9sZHIgPSBjcmVhdGVSZWR1Y2UoLTEpO1xuXG4gIC8vIFJldHVybiB0aGUgZmlyc3QgdmFsdWUgd2hpY2ggcGFzc2VzIGEgdHJ1dGggdGVzdC4gQWxpYXNlZCBhcyBgZGV0ZWN0YC5cbiAgXy5maW5kID0gXy5kZXRlY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkge1xuICAgIHZhciBrZXk7XG4gICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHtcbiAgICAgIGtleSA9IF8uZmluZEluZGV4KG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAga2V5ID0gXy5maW5kS2V5KG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB9XG4gICAgaWYgKGtleSAhPT0gdm9pZCAwICYmIGtleSAhPT0gLTEpIHJldHVybiBvYmpba2V5XTtcbiAgfTtcblxuICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LlxuICAvLyBBbGlhc2VkIGFzIGBzZWxlY3RgLlxuICBfLmZpbHRlciA9IF8uc2VsZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgIHByZWRpY2F0ZSA9IGNiKHByZWRpY2F0ZSwgY29udGV4dCk7XG4gICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7XG4gICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH07XG5cbiAgLy8gUmV0dXJuIGFsbCB0aGUgZWxlbWVudHMgZm9yIHdoaWNoIGEgdHJ1dGggdGVzdCBmYWlscy5cbiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkge1xuICAgIHJldHVybiBfLmZpbHRlcihvYmosIF8ubmVnYXRlKGNiKHByZWRpY2F0ZSkpLCBjb250ZXh0KTtcbiAgfTtcblxuICAvLyBEZXRlcm1pbmUgd2hldGhlciBhbGwgb2YgdGhlIGVsZW1lbnRzIG1hdGNoIGEgdHJ1dGggdGVzdC5cbiAgLy8gQWxpYXNlZCBhcyBgYWxsYC5cbiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksXG4gICAgICAgIGxlbmd0aCA9IChrZXlzIHx8IG9iaikubGVuZ3RoO1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7XG4gICAgICBpZiAoIXByZWRpY2F0ZShvYmpbY3VycmVudEtleV0sIGN1cnJlbnRLZXksIG9iaikpIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgLy8gRGV0ZXJtaW5lIGlmIGF0IGxlYXN0IG9uZSBlbGVtZW50IGluIHRoZSBvYmplY3QgbWF0Y2hlcyBhIHRydXRoIHRlc3QuXG4gIC8vIEFsaWFzZWQgYXMgYGFueWAuXG4gIF8uc29tZSA9IF8uYW55ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksXG4gICAgICAgIGxlbmd0aCA9IChrZXlzIHx8IG9iaikubGVuZ3RoO1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7XG4gICAgICBpZiAocHJlZGljYXRlKG9ialtjdXJyZW50S2V5XSwgY3VycmVudEtleSwgb2JqKSkgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICAvLyBEZXRlcm1pbmUgaWYgdGhlIGFycmF5IG9yIG9iamVjdCBjb250YWlucyBhIGdpdmVuIGl0ZW0gKHVzaW5nIGA9PT1gKS5cbiAgLy8gQWxpYXNlZCBhcyBgaW5jbHVkZXNgIGFuZCBgaW5jbHVkZWAuXG4gIF8uY29udGFpbnMgPSBfLmluY2x1ZGVzID0gXy5pbmNsdWRlID0gZnVuY3Rpb24ob2JqLCBpdGVtLCBmcm9tSW5kZXgsIGd1YXJkKSB7XG4gICAgaWYgKCFpc0FycmF5TGlrZShvYmopKSBvYmogPSBfLnZhbHVlcyhvYmopO1xuICAgIGlmICh0eXBlb2YgZnJvbUluZGV4ICE9ICdudW1iZXInIHx8IGd1YXJkKSBmcm9tSW5kZXggPSAwO1xuICAgIHJldHVybiBfLmluZGV4T2Yob2JqLCBpdGVtLCBmcm9tSW5kZXgpID49IDA7XG4gIH07XG5cbiAgLy8gSW52b2tlIGEgbWV0aG9kICh3aXRoIGFyZ3VtZW50cykgb24gZXZlcnkgaXRlbSBpbiBhIGNvbGxlY3Rpb24uXG4gIF8uaW52b2tlID0gZnVuY3Rpb24ob2JqLCBtZXRob2QpIHtcbiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTtcbiAgICB2YXIgaXNGdW5jID0gXy5pc0Z1bmN0aW9uKG1ldGhvZCk7XG4gICAgcmV0dXJuIF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHZhciBmdW5jID0gaXNGdW5jID8gbWV0aG9kIDogdmFsdWVbbWV0aG9kXTtcbiAgICAgIHJldHVybiBmdW5jID09IG51bGwgPyBmdW5jIDogZnVuYy5hcHBseSh2YWx1ZSwgYXJncyk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgbWFwYDogZmV0Y2hpbmcgYSBwcm9wZXJ0eS5cbiAgXy5wbHVjayA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7XG4gICAgcmV0dXJuIF8ubWFwKG9iaiwgXy5wcm9wZXJ0eShrZXkpKTtcbiAgfTtcblxuICAvLyBDb252ZW5pZW5jZSB2ZXJzaW9uIG9mIGEgY29tbW9uIHVzZSBjYXNlIG9mIGBmaWx0ZXJgOiBzZWxlY3Rpbmcgb25seSBvYmplY3RzXG4gIC8vIGNvbnRhaW5pbmcgc3BlY2lmaWMgYGtleTp2YWx1ZWAgcGFpcnMuXG4gIF8ud2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7XG4gICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgXy5tYXRjaGVyKGF0dHJzKSk7XG4gIH07XG5cbiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgZmluZGA6IGdldHRpbmcgdGhlIGZpcnN0IG9iamVjdFxuICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLlxuICBfLmZpbmRXaGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHtcbiAgICByZXR1cm4gXy5maW5kKG9iaiwgXy5tYXRjaGVyKGF0dHJzKSk7XG4gIH07XG5cbiAgLy8gUmV0dXJuIHRoZSBtYXhpbXVtIGVsZW1lbnQgKG9yIGVsZW1lbnQtYmFzZWQgY29tcHV0YXRpb24pLlxuICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0ID0gLUluZmluaXR5LCBsYXN0Q29tcHV0ZWQgPSAtSW5maW5pdHksXG4gICAgICAgIHZhbHVlLCBjb21wdXRlZDtcbiAgICBpZiAoaXRlcmF0ZWUgPT0gbnVsbCAmJiBvYmogIT0gbnVsbCkge1xuICAgICAgb2JqID0gaXNBcnJheUxpa2Uob2JqKSA/IG9iaiA6IF8udmFsdWVzKG9iaik7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gb2JqLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhbHVlID0gb2JqW2ldO1xuICAgICAgICBpZiAodmFsdWUgPiByZXN1bHQpIHtcbiAgICAgICAgICByZXN1bHQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkge1xuICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgbGlzdCk7XG4gICAgICAgIGlmIChjb21wdXRlZCA+IGxhc3RDb21wdXRlZCB8fCBjb21wdXRlZCA9PT0gLUluZmluaXR5ICYmIHJlc3VsdCA9PT0gLUluZmluaXR5KSB7XG4gICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgbWluaW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS5cbiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdCA9IEluZmluaXR5LCBsYXN0Q29tcHV0ZWQgPSBJbmZpbml0eSxcbiAgICAgICAgdmFsdWUsIGNvbXB1dGVkO1xuICAgIGlmIChpdGVyYXRlZSA9PSBudWxsICYmIG9iaiAhPSBudWxsKSB7XG4gICAgICBvYmogPSBpc0FycmF5TGlrZShvYmopID8gb2JqIDogXy52YWx1ZXMob2JqKTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFsdWUgPSBvYmpbaV07XG4gICAgICAgIGlmICh2YWx1ZSA8IHJlc3VsdCkge1xuICAgICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7XG4gICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBsaXN0KTtcbiAgICAgICAgaWYgKGNvbXB1dGVkIDwgbGFzdENvbXB1dGVkIHx8IGNvbXB1dGVkID09PSBJbmZpbml0eSAmJiByZXN1bHQgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIFNodWZmbGUgYSBjb2xsZWN0aW9uLCB1c2luZyB0aGUgbW9kZXJuIHZlcnNpb24gb2YgdGhlXG4gIC8vIFtGaXNoZXItWWF0ZXMgc2h1ZmZsZV0oaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9GaXNoZXLigJNZYXRlc19zaHVmZmxlKS5cbiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIHNldCA9IGlzQXJyYXlMaWtlKG9iaikgPyBvYmogOiBfLnZhbHVlcyhvYmopO1xuICAgIHZhciBsZW5ndGggPSBzZXQubGVuZ3RoO1xuICAgIHZhciBzaHVmZmxlZCA9IEFycmF5KGxlbmd0aCk7XG4gICAgZm9yICh2YXIgaW5kZXggPSAwLCByYW5kOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgcmFuZCA9IF8ucmFuZG9tKDAsIGluZGV4KTtcbiAgICAgIGlmIChyYW5kICE9PSBpbmRleCkgc2h1ZmZsZWRbaW5kZXhdID0gc2h1ZmZsZWRbcmFuZF07XG4gICAgICBzaHVmZmxlZFtyYW5kXSA9IHNldFtpbmRleF07XG4gICAgfVxuICAgIHJldHVybiBzaHVmZmxlZDtcbiAgfTtcblxuICAvLyBTYW1wbGUgKipuKiogcmFuZG9tIHZhbHVlcyBmcm9tIGEgY29sbGVjdGlvbi5cbiAgLy8gSWYgKipuKiogaXMgbm90IHNwZWNpZmllZCwgcmV0dXJucyBhIHNpbmdsZSByYW5kb20gZWxlbWVudC5cbiAgLy8gVGhlIGludGVybmFsIGBndWFyZGAgYXJndW1lbnQgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgbWFwYC5cbiAgXy5zYW1wbGUgPSBmdW5jdGlvbihvYmosIG4sIGd1YXJkKSB7XG4gICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkge1xuICAgICAgaWYgKCFpc0FycmF5TGlrZShvYmopKSBvYmogPSBfLnZhbHVlcyhvYmopO1xuICAgICAgcmV0dXJuIG9ialtfLnJhbmRvbShvYmoubGVuZ3RoIC0gMSldO1xuICAgIH1cbiAgICByZXR1cm4gXy5zaHVmZmxlKG9iaikuc2xpY2UoMCwgTWF0aC5tYXgoMCwgbikpO1xuICB9O1xuXG4gIC8vIFNvcnQgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiBwcm9kdWNlZCBieSBhbiBpdGVyYXRlZS5cbiAgXy5zb3J0QnkgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgcmV0dXJuIF8ucGx1Y2soXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgaW5kZXg6IGluZGV4LFxuICAgICAgICBjcml0ZXJpYTogaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBsaXN0KVxuICAgICAgfTtcbiAgICB9KS5zb3J0KGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7XG4gICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7XG4gICAgICB2YXIgYiA9IHJpZ2h0LmNyaXRlcmlhO1xuICAgICAgaWYgKGEgIT09IGIpIHtcbiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7XG4gICAgICAgIGlmIChhIDwgYiB8fCBiID09PSB2b2lkIDApIHJldHVybiAtMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7XG4gICAgfSksICd2YWx1ZScpO1xuICB9O1xuXG4gIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIHVzZWQgZm9yIGFnZ3JlZ2F0ZSBcImdyb3VwIGJ5XCIgb3BlcmF0aW9ucy5cbiAgdmFyIGdyb3VwID0gZnVuY3Rpb24oYmVoYXZpb3IpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgICBfLmVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHtcbiAgICAgICAgdmFyIGtleSA9IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgb2JqKTtcbiAgICAgICAgYmVoYXZpb3IocmVzdWx0LCB2YWx1ZSwga2V5KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICB9O1xuXG4gIC8vIEdyb3VwcyB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uLiBQYXNzIGVpdGhlciBhIHN0cmluZyBhdHRyaWJ1dGVcbiAgLy8gdG8gZ3JvdXAgYnksIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBjcml0ZXJpb24uXG4gIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkge1xuICAgIGlmIChfLmhhcyhyZXN1bHQsIGtleSkpIHJlc3VsdFtrZXldLnB1c2godmFsdWUpOyBlbHNlIHJlc3VsdFtrZXldID0gW3ZhbHVlXTtcbiAgfSk7XG5cbiAgLy8gSW5kZXhlcyB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uLCBzaW1pbGFyIHRvIGBncm91cEJ5YCwgYnV0IGZvclxuICAvLyB3aGVuIHlvdSBrbm93IHRoYXQgeW91ciBpbmRleCB2YWx1ZXMgd2lsbCBiZSB1bmlxdWUuXG4gIF8uaW5kZXhCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkge1xuICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gIH0pO1xuXG4gIC8vIENvdW50cyBpbnN0YW5jZXMgb2YgYW4gb2JqZWN0IHRoYXQgZ3JvdXAgYnkgYSBjZXJ0YWluIGNyaXRlcmlvbi4gUGFzc1xuICAvLyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlIHRvIGNvdW50IGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGVcbiAgLy8gY3JpdGVyaW9uLlxuICBfLmNvdW50QnkgPSBncm91cChmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHtcbiAgICBpZiAoXy5oYXMocmVzdWx0LCBrZXkpKSByZXN1bHRba2V5XSsrOyBlbHNlIHJlc3VsdFtrZXldID0gMTtcbiAgfSk7XG5cbiAgLy8gU2FmZWx5IGNyZWF0ZSBhIHJlYWwsIGxpdmUgYXJyYXkgZnJvbSBhbnl0aGluZyBpdGVyYWJsZS5cbiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKCFvYmopIHJldHVybiBbXTtcbiAgICBpZiAoXy5pc0FycmF5KG9iaikpIHJldHVybiBzbGljZS5jYWxsKG9iaik7XG4gICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHJldHVybiBfLm1hcChvYmosIF8uaWRlbnRpdHkpO1xuICAgIHJldHVybiBfLnZhbHVlcyhvYmopO1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9iamVjdC5cbiAgXy5zaXplID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gMDtcbiAgICByZXR1cm4gaXNBcnJheUxpa2Uob2JqKSA/IG9iai5sZW5ndGggOiBfLmtleXMob2JqKS5sZW5ndGg7XG4gIH07XG5cbiAgLy8gU3BsaXQgYSBjb2xsZWN0aW9uIGludG8gdHdvIGFycmF5czogb25lIHdob3NlIGVsZW1lbnRzIGFsbCBzYXRpc2Z5IHRoZSBnaXZlblxuICAvLyBwcmVkaWNhdGUsIGFuZCBvbmUgd2hvc2UgZWxlbWVudHMgYWxsIGRvIG5vdCBzYXRpc2Z5IHRoZSBwcmVkaWNhdGUuXG4gIF8ucGFydGl0aW9uID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgIHZhciBwYXNzID0gW10sIGZhaWwgPSBbXTtcbiAgICBfLmVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmopIHtcbiAgICAgIChwcmVkaWNhdGUodmFsdWUsIGtleSwgb2JqKSA/IHBhc3MgOiBmYWlsKS5wdXNoKHZhbHVlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdO1xuICB9O1xuXG4gIC8vIEFycmF5IEZ1bmN0aW9uc1xuICAvLyAtLS0tLS0tLS0tLS0tLS1cblxuICAvLyBHZXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gYXJyYXkuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gdGhlIGZpcnN0IE5cbiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgaGVhZGAgYW5kIGB0YWtlYC4gVGhlICoqZ3VhcmQqKiBjaGVja1xuICAvLyBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBfLm1hcGAuXG4gIF8uZmlyc3QgPSBfLmhlYWQgPSBfLnRha2UgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICBpZiAoYXJyYXkgPT0gbnVsbCkgcmV0dXJuIHZvaWQgMDtcbiAgICBpZiAobiA9PSBudWxsIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbMF07XG4gICAgcmV0dXJuIF8uaW5pdGlhbChhcnJheSwgYXJyYXkubGVuZ3RoIC0gbik7XG4gIH07XG5cbiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgbGFzdCBlbnRyeSBvZiB0aGUgYXJyYXkuIEVzcGVjaWFsbHkgdXNlZnVsIG9uXG4gIC8vIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIGFsbCB0aGUgdmFsdWVzIGluXG4gIC8vIHRoZSBhcnJheSwgZXhjbHVkaW5nIHRoZSBsYXN0IE4uXG4gIF8uaW5pdGlhbCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkge1xuICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAwLCBNYXRoLm1heCgwLCBhcnJheS5sZW5ndGggLSAobiA9PSBudWxsIHx8IGd1YXJkID8gMSA6IG4pKSk7XG4gIH07XG5cbiAgLy8gR2V0IHRoZSBsYXN0IGVsZW1lbnQgb2YgYW4gYXJyYXkuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gdGhlIGxhc3QgTlxuICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LlxuICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICBpZiAoYXJyYXkgPT0gbnVsbCkgcmV0dXJuIHZvaWQgMDtcbiAgICBpZiAobiA9PSBudWxsIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07XG4gICAgcmV0dXJuIF8ucmVzdChhcnJheSwgTWF0aC5tYXgoMCwgYXJyYXkubGVuZ3RoIC0gbikpO1xuICB9O1xuXG4gIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC5cbiAgLy8gRXNwZWNpYWxseSB1c2VmdWwgb24gdGhlIGFyZ3VtZW50cyBvYmplY3QuIFBhc3NpbmcgYW4gKipuKiogd2lsbCByZXR1cm5cbiAgLy8gdGhlIHJlc3QgTiB2YWx1ZXMgaW4gdGhlIGFycmF5LlxuICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgbiA9PSBudWxsIHx8IGd1YXJkID8gMSA6IG4pO1xuICB9O1xuXG4gIC8vIFRyaW0gb3V0IGFsbCBmYWxzeSB2YWx1ZXMgZnJvbSBhbiBhcnJheS5cbiAgXy5jb21wYWN0ID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIF8uaWRlbnRpdHkpO1xuICB9O1xuXG4gIC8vIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIGEgcmVjdXJzaXZlIGBmbGF0dGVuYCBmdW5jdGlvbi5cbiAgdmFyIGZsYXR0ZW4gPSBmdW5jdGlvbihpbnB1dCwgc2hhbGxvdywgc3RyaWN0LCBzdGFydEluZGV4KSB7XG4gICAgdmFyIG91dHB1dCA9IFtdLCBpZHggPSAwO1xuICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4IHx8IDAsIGxlbmd0aCA9IGdldExlbmd0aChpbnB1dCk7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHZhbHVlID0gaW5wdXRbaV07XG4gICAgICBpZiAoaXNBcnJheUxpa2UodmFsdWUpICYmIChfLmlzQXJyYXkodmFsdWUpIHx8IF8uaXNBcmd1bWVudHModmFsdWUpKSkge1xuICAgICAgICAvL2ZsYXR0ZW4gY3VycmVudCBsZXZlbCBvZiBhcnJheSBvciBhcmd1bWVudHMgb2JqZWN0XG4gICAgICAgIGlmICghc2hhbGxvdykgdmFsdWUgPSBmbGF0dGVuKHZhbHVlLCBzaGFsbG93LCBzdHJpY3QpO1xuICAgICAgICB2YXIgaiA9IDAsIGxlbiA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgb3V0cHV0Lmxlbmd0aCArPSBsZW47XG4gICAgICAgIHdoaWxlIChqIDwgbGVuKSB7XG4gICAgICAgICAgb3V0cHV0W2lkeCsrXSA9IHZhbHVlW2orK107XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoIXN0cmljdCkge1xuICAgICAgICBvdXRwdXRbaWR4KytdID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXRwdXQ7XG4gIH07XG5cbiAgLy8gRmxhdHRlbiBvdXQgYW4gYXJyYXksIGVpdGhlciByZWN1cnNpdmVseSAoYnkgZGVmYXVsdCksIG9yIGp1c3Qgb25lIGxldmVsLlxuICBfLmZsYXR0ZW4gPSBmdW5jdGlvbihhcnJheSwgc2hhbGxvdykge1xuICAgIHJldHVybiBmbGF0dGVuKGFycmF5LCBzaGFsbG93LCBmYWxzZSk7XG4gIH07XG5cbiAgLy8gUmV0dXJuIGEgdmVyc2lvbiBvZiB0aGUgYXJyYXkgdGhhdCBkb2VzIG5vdCBjb250YWluIHRoZSBzcGVjaWZpZWQgdmFsdWUocykuXG4gIF8ud2l0aG91dCA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgcmV0dXJuIF8uZGlmZmVyZW5jZShhcnJheSwgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcbiAgfTtcblxuICAvLyBQcm9kdWNlIGEgZHVwbGljYXRlLWZyZWUgdmVyc2lvbiBvZiB0aGUgYXJyYXkuIElmIHRoZSBhcnJheSBoYXMgYWxyZWFkeVxuICAvLyBiZWVuIHNvcnRlZCwgeW91IGhhdmUgdGhlIG9wdGlvbiBvZiB1c2luZyBhIGZhc3RlciBhbGdvcml0aG0uXG4gIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuXG4gIF8udW5pcSA9IF8udW5pcXVlID0gZnVuY3Rpb24oYXJyYXksIGlzU29ydGVkLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGlmICghXy5pc0Jvb2xlYW4oaXNTb3J0ZWQpKSB7XG4gICAgICBjb250ZXh0ID0gaXRlcmF0ZWU7XG4gICAgICBpdGVyYXRlZSA9IGlzU29ydGVkO1xuICAgICAgaXNTb3J0ZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGl0ZXJhdGVlICE9IG51bGwpIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICB2YXIgc2VlbiA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBnZXRMZW5ndGgoYXJyYXkpOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB2YWx1ZSA9IGFycmF5W2ldLFxuICAgICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUgPyBpdGVyYXRlZSh2YWx1ZSwgaSwgYXJyYXkpIDogdmFsdWU7XG4gICAgICBpZiAoaXNTb3J0ZWQpIHtcbiAgICAgICAgaWYgKCFpIHx8IHNlZW4gIT09IGNvbXB1dGVkKSByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICAgIHNlZW4gPSBjb21wdXRlZDtcbiAgICAgIH0gZWxzZSBpZiAoaXRlcmF0ZWUpIHtcbiAgICAgICAgaWYgKCFfLmNvbnRhaW5zKHNlZW4sIGNvbXB1dGVkKSkge1xuICAgICAgICAgIHNlZW4ucHVzaChjb21wdXRlZCk7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCFfLmNvbnRhaW5zKHJlc3VsdCwgdmFsdWUpKSB7XG4gICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2ZcbiAgLy8gdGhlIHBhc3NlZC1pbiBhcnJheXMuXG4gIF8udW5pb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gXy51bmlxKGZsYXR0ZW4oYXJndW1lbnRzLCB0cnVlLCB0cnVlKSk7XG4gIH07XG5cbiAgLy8gUHJvZHVjZSBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIGV2ZXJ5IGl0ZW0gc2hhcmVkIGJldHdlZW4gYWxsIHRoZVxuICAvLyBwYXNzZWQtaW4gYXJyYXlzLlxuICBfLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIHZhciBhcmdzTGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGFycmF5KTsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaXRlbSA9IGFycmF5W2ldO1xuICAgICAgaWYgKF8uY29udGFpbnMocmVzdWx0LCBpdGVtKSkgY29udGludWU7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IGFyZ3NMZW5ndGg7IGorKykge1xuICAgICAgICBpZiAoIV8uY29udGFpbnMoYXJndW1lbnRzW2pdLCBpdGVtKSkgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoaiA9PT0gYXJnc0xlbmd0aCkgcmVzdWx0LnB1c2goaXRlbSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gVGFrZSB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIG9uZSBhcnJheSBhbmQgYSBudW1iZXIgb2Ygb3RoZXIgYXJyYXlzLlxuICAvLyBPbmx5IHRoZSBlbGVtZW50cyBwcmVzZW50IGluIGp1c3QgdGhlIGZpcnN0IGFycmF5IHdpbGwgcmVtYWluLlxuICBfLmRpZmZlcmVuY2UgPSBmdW5jdGlvbihhcnJheSkge1xuICAgIHZhciByZXN0ID0gZmxhdHRlbihhcmd1bWVudHMsIHRydWUsIHRydWUsIDEpO1xuICAgIHJldHVybiBfLmZpbHRlcihhcnJheSwgZnVuY3Rpb24odmFsdWUpe1xuICAgICAgcmV0dXJuICFfLmNvbnRhaW5zKHJlc3QsIHZhbHVlKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBaaXAgdG9nZXRoZXIgbXVsdGlwbGUgbGlzdHMgaW50byBhIHNpbmdsZSBhcnJheSAtLSBlbGVtZW50cyB0aGF0IHNoYXJlXG4gIC8vIGFuIGluZGV4IGdvIHRvZ2V0aGVyLlxuICBfLnppcCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBfLnVuemlwKGFyZ3VtZW50cyk7XG4gIH07XG5cbiAgLy8gQ29tcGxlbWVudCBvZiBfLnppcC4gVW56aXAgYWNjZXB0cyBhbiBhcnJheSBvZiBhcnJheXMgYW5kIGdyb3Vwc1xuICAvLyBlYWNoIGFycmF5J3MgZWxlbWVudHMgb24gc2hhcmVkIGluZGljZXNcbiAgXy51bnppcCA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgdmFyIGxlbmd0aCA9IGFycmF5ICYmIF8ubWF4KGFycmF5LCBnZXRMZW5ndGgpLmxlbmd0aCB8fCAwO1xuICAgIHZhciByZXN1bHQgPSBBcnJheShsZW5ndGgpO1xuXG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgcmVzdWx0W2luZGV4XSA9IF8ucGx1Y2soYXJyYXksIGluZGV4KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBDb252ZXJ0cyBsaXN0cyBpbnRvIG9iamVjdHMuIFBhc3MgZWl0aGVyIGEgc2luZ2xlIGFycmF5IG9mIGBba2V5LCB2YWx1ZV1gXG4gIC8vIHBhaXJzLCBvciB0d28gcGFyYWxsZWwgYXJyYXlzIG9mIHRoZSBzYW1lIGxlbmd0aCAtLSBvbmUgb2Yga2V5cywgYW5kIG9uZSBvZlxuICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuXG4gIF8ub2JqZWN0ID0gZnVuY3Rpb24obGlzdCwgdmFsdWVzKSB7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBnZXRMZW5ndGgobGlzdCk7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHZhbHVlcykge1xuICAgICAgICByZXN1bHRbbGlzdFtpXV0gPSB2YWx1ZXNbaV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHRbbGlzdFtpXVswXV0gPSBsaXN0W2ldWzFdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIEdlbmVyYXRvciBmdW5jdGlvbiB0byBjcmVhdGUgdGhlIGZpbmRJbmRleCBhbmQgZmluZExhc3RJbmRleCBmdW5jdGlvbnNcbiAgZnVuY3Rpb24gY3JlYXRlUHJlZGljYXRlSW5kZXhGaW5kZXIoZGlyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICAgIHByZWRpY2F0ZSA9IGNiKHByZWRpY2F0ZSwgY29udGV4dCk7XG4gICAgICB2YXIgbGVuZ3RoID0gZ2V0TGVuZ3RoKGFycmF5KTtcbiAgICAgIHZhciBpbmRleCA9IGRpciA+IDAgPyAwIDogbGVuZ3RoIC0gMTtcbiAgICAgIGZvciAoOyBpbmRleCA+PSAwICYmIGluZGV4IDwgbGVuZ3RoOyBpbmRleCArPSBkaXIpIHtcbiAgICAgICAgaWYgKHByZWRpY2F0ZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSkpIHJldHVybiBpbmRleDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAtMTtcbiAgICB9O1xuICB9XG5cbiAgLy8gUmV0dXJucyB0aGUgZmlyc3QgaW5kZXggb24gYW4gYXJyYXktbGlrZSB0aGF0IHBhc3NlcyBhIHByZWRpY2F0ZSB0ZXN0XG4gIF8uZmluZEluZGV4ID0gY3JlYXRlUHJlZGljYXRlSW5kZXhGaW5kZXIoMSk7XG4gIF8uZmluZExhc3RJbmRleCA9IGNyZWF0ZVByZWRpY2F0ZUluZGV4RmluZGVyKC0xKTtcblxuICAvLyBVc2UgYSBjb21wYXJhdG9yIGZ1bmN0aW9uIHRvIGZpZ3VyZSBvdXQgdGhlIHNtYWxsZXN0IGluZGV4IGF0IHdoaWNoXG4gIC8vIGFuIG9iamVjdCBzaG91bGQgYmUgaW5zZXJ0ZWQgc28gYXMgdG8gbWFpbnRhaW4gb3JkZXIuIFVzZXMgYmluYXJ5IHNlYXJjaC5cbiAgXy5zb3J0ZWRJbmRleCA9IGZ1bmN0aW9uKGFycmF5LCBvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCwgMSk7XG4gICAgdmFyIHZhbHVlID0gaXRlcmF0ZWUob2JqKTtcbiAgICB2YXIgbG93ID0gMCwgaGlnaCA9IGdldExlbmd0aChhcnJheSk7XG4gICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHtcbiAgICAgIHZhciBtaWQgPSBNYXRoLmZsb29yKChsb3cgKyBoaWdoKSAvIDIpO1xuICAgICAgaWYgKGl0ZXJhdGVlKGFycmF5W21pZF0pIDwgdmFsdWUpIGxvdyA9IG1pZCArIDE7IGVsc2UgaGlnaCA9IG1pZDtcbiAgICB9XG4gICAgcmV0dXJuIGxvdztcbiAgfTtcblxuICAvLyBHZW5lcmF0b3IgZnVuY3Rpb24gdG8gY3JlYXRlIHRoZSBpbmRleE9mIGFuZCBsYXN0SW5kZXhPZiBmdW5jdGlvbnNcbiAgZnVuY3Rpb24gY3JlYXRlSW5kZXhGaW5kZXIoZGlyLCBwcmVkaWNhdGVGaW5kLCBzb3J0ZWRJbmRleCkge1xuICAgIHJldHVybiBmdW5jdGlvbihhcnJheSwgaXRlbSwgaWR4KSB7XG4gICAgICB2YXIgaSA9IDAsIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7XG4gICAgICBpZiAodHlwZW9mIGlkeCA9PSAnbnVtYmVyJykge1xuICAgICAgICBpZiAoZGlyID4gMCkge1xuICAgICAgICAgICAgaSA9IGlkeCA+PSAwID8gaWR4IDogTWF0aC5tYXgoaWR4ICsgbGVuZ3RoLCBpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxlbmd0aCA9IGlkeCA+PSAwID8gTWF0aC5taW4oaWR4ICsgMSwgbGVuZ3RoKSA6IGlkeCArIGxlbmd0aCArIDE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc29ydGVkSW5kZXggJiYgaWR4ICYmIGxlbmd0aCkge1xuICAgICAgICBpZHggPSBzb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7XG4gICAgICAgIHJldHVybiBhcnJheVtpZHhdID09PSBpdGVtID8gaWR4IDogLTE7XG4gICAgICB9XG4gICAgICBpZiAoaXRlbSAhPT0gaXRlbSkge1xuICAgICAgICBpZHggPSBwcmVkaWNhdGVGaW5kKHNsaWNlLmNhbGwoYXJyYXksIGksIGxlbmd0aCksIF8uaXNOYU4pO1xuICAgICAgICByZXR1cm4gaWR4ID49IDAgPyBpZHggKyBpIDogLTE7XG4gICAgICB9XG4gICAgICBmb3IgKGlkeCA9IGRpciA+IDAgPyBpIDogbGVuZ3RoIC0gMTsgaWR4ID49IDAgJiYgaWR4IDwgbGVuZ3RoOyBpZHggKz0gZGlyKSB7XG4gICAgICAgIGlmIChhcnJheVtpZHhdID09PSBpdGVtKSByZXR1cm4gaWR4O1xuICAgICAgfVxuICAgICAgcmV0dXJuIC0xO1xuICAgIH07XG4gIH1cblxuICAvLyBSZXR1cm4gdGhlIHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGFuIGl0ZW0gaW4gYW4gYXJyYXksXG4gIC8vIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuXG4gIC8vIElmIHRoZSBhcnJheSBpcyBsYXJnZSBhbmQgYWxyZWFkeSBpbiBzb3J0IG9yZGVyLCBwYXNzIGB0cnVlYFxuICAvLyBmb3IgKippc1NvcnRlZCoqIHRvIHVzZSBiaW5hcnkgc2VhcmNoLlxuICBfLmluZGV4T2YgPSBjcmVhdGVJbmRleEZpbmRlcigxLCBfLmZpbmRJbmRleCwgXy5zb3J0ZWRJbmRleCk7XG4gIF8ubGFzdEluZGV4T2YgPSBjcmVhdGVJbmRleEZpbmRlcigtMSwgXy5maW5kTGFzdEluZGV4KTtcblxuICAvLyBHZW5lcmF0ZSBhbiBpbnRlZ2VyIEFycmF5IGNvbnRhaW5pbmcgYW4gYXJpdGhtZXRpYyBwcm9ncmVzc2lvbi4gQSBwb3J0IG9mXG4gIC8vIHRoZSBuYXRpdmUgUHl0aG9uIGByYW5nZSgpYCBmdW5jdGlvbi4gU2VlXG4gIC8vIFt0aGUgUHl0aG9uIGRvY3VtZW50YXRpb25dKGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS9mdW5jdGlvbnMuaHRtbCNyYW5nZSkuXG4gIF8ucmFuZ2UgPSBmdW5jdGlvbihzdGFydCwgc3RvcCwgc3RlcCkge1xuICAgIGlmIChzdG9wID09IG51bGwpIHtcbiAgICAgIHN0b3AgPSBzdGFydCB8fCAwO1xuICAgICAgc3RhcnQgPSAwO1xuICAgIH1cbiAgICBzdGVwID0gc3RlcCB8fCAxO1xuXG4gICAgdmFyIGxlbmd0aCA9IE1hdGgubWF4KE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApLCAwKTtcbiAgICB2YXIgcmFuZ2UgPSBBcnJheShsZW5ndGgpO1xuXG4gICAgZm9yICh2YXIgaWR4ID0gMDsgaWR4IDwgbGVuZ3RoOyBpZHgrKywgc3RhcnQgKz0gc3RlcCkge1xuICAgICAgcmFuZ2VbaWR4XSA9IHN0YXJ0O1xuICAgIH1cblxuICAgIHJldHVybiByYW5nZTtcbiAgfTtcblxuICAvLyBGdW5jdGlvbiAoYWhlbSkgRnVuY3Rpb25zXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vIERldGVybWluZXMgd2hldGhlciB0byBleGVjdXRlIGEgZnVuY3Rpb24gYXMgYSBjb25zdHJ1Y3RvclxuICAvLyBvciBhIG5vcm1hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm92aWRlZCBhcmd1bWVudHNcbiAgdmFyIGV4ZWN1dGVCb3VuZCA9IGZ1bmN0aW9uKHNvdXJjZUZ1bmMsIGJvdW5kRnVuYywgY29udGV4dCwgY2FsbGluZ0NvbnRleHQsIGFyZ3MpIHtcbiAgICBpZiAoIShjYWxsaW5nQ29udGV4dCBpbnN0YW5jZW9mIGJvdW5kRnVuYykpIHJldHVybiBzb3VyY2VGdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgIHZhciBzZWxmID0gYmFzZUNyZWF0ZShzb3VyY2VGdW5jLnByb3RvdHlwZSk7XG4gICAgdmFyIHJlc3VsdCA9IHNvdXJjZUZ1bmMuYXBwbHkoc2VsZiwgYXJncyk7XG4gICAgaWYgKF8uaXNPYmplY3QocmVzdWx0KSkgcmV0dXJuIHJlc3VsdDtcbiAgICByZXR1cm4gc2VsZjtcbiAgfTtcblxuICAvLyBDcmVhdGUgYSBmdW5jdGlvbiBib3VuZCB0byBhIGdpdmVuIG9iamVjdCAoYXNzaWduaW5nIGB0aGlzYCwgYW5kIGFyZ3VtZW50cyxcbiAgLy8gb3B0aW9uYWxseSkuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZlxuICAvLyBhdmFpbGFibGUuXG4gIF8uYmluZCA9IGZ1bmN0aW9uKGZ1bmMsIGNvbnRleHQpIHtcbiAgICBpZiAobmF0aXZlQmluZCAmJiBmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQpIHJldHVybiBuYXRpdmVCaW5kLmFwcGx5KGZ1bmMsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gICAgaWYgKCFfLmlzRnVuY3Rpb24oZnVuYykpIHRocm93IG5ldyBUeXBlRXJyb3IoJ0JpbmQgbXVzdCBiZSBjYWxsZWQgb24gYSBmdW5jdGlvbicpO1xuICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpO1xuICAgIHZhciBib3VuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGV4ZWN1dGVCb3VuZChmdW5jLCBib3VuZCwgY29udGV4dCwgdGhpcywgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7XG4gICAgfTtcbiAgICByZXR1cm4gYm91bmQ7XG4gIH07XG5cbiAgLy8gUGFydGlhbGx5IGFwcGx5IGEgZnVuY3Rpb24gYnkgY3JlYXRpbmcgYSB2ZXJzaW9uIHRoYXQgaGFzIGhhZCBzb21lIG9mIGl0c1xuICAvLyBhcmd1bWVudHMgcHJlLWZpbGxlZCwgd2l0aG91dCBjaGFuZ2luZyBpdHMgZHluYW1pYyBgdGhpc2AgY29udGV4dC4gXyBhY3RzXG4gIC8vIGFzIGEgcGxhY2Vob2xkZXIsIGFsbG93aW5nIGFueSBjb21iaW5hdGlvbiBvZiBhcmd1bWVudHMgdG8gYmUgcHJlLWZpbGxlZC5cbiAgXy5wYXJ0aWFsID0gZnVuY3Rpb24oZnVuYykge1xuICAgIHZhciBib3VuZEFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG4gICAgdmFyIGJvdW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcG9zaXRpb24gPSAwLCBsZW5ndGggPSBib3VuZEFyZ3MubGVuZ3RoO1xuICAgICAgdmFyIGFyZ3MgPSBBcnJheShsZW5ndGgpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBhcmdzW2ldID0gYm91bmRBcmdzW2ldID09PSBfID8gYXJndW1lbnRzW3Bvc2l0aW9uKytdIDogYm91bmRBcmdzW2ldO1xuICAgICAgfVxuICAgICAgd2hpbGUgKHBvc2l0aW9uIDwgYXJndW1lbnRzLmxlbmd0aCkgYXJncy5wdXNoKGFyZ3VtZW50c1twb3NpdGlvbisrXSk7XG4gICAgICByZXR1cm4gZXhlY3V0ZUJvdW5kKGZ1bmMsIGJvdW5kLCB0aGlzLCB0aGlzLCBhcmdzKTtcbiAgICB9O1xuICAgIHJldHVybiBib3VuZDtcbiAgfTtcblxuICAvLyBCaW5kIGEgbnVtYmVyIG9mIGFuIG9iamVjdCdzIG1ldGhvZHMgdG8gdGhhdCBvYmplY3QuIFJlbWFpbmluZyBhcmd1bWVudHNcbiAgLy8gYXJlIHRoZSBtZXRob2QgbmFtZXMgdG8gYmUgYm91bmQuIFVzZWZ1bCBmb3IgZW5zdXJpbmcgdGhhdCBhbGwgY2FsbGJhY2tzXG4gIC8vIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC5cbiAgXy5iaW5kQWxsID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIGksIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsIGtleTtcbiAgICBpZiAobGVuZ3RoIDw9IDEpIHRocm93IG5ldyBFcnJvcignYmluZEFsbCBtdXN0IGJlIHBhc3NlZCBmdW5jdGlvbiBuYW1lcycpO1xuICAgIGZvciAoaSA9IDE7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAga2V5ID0gYXJndW1lbnRzW2ldO1xuICAgICAgb2JqW2tleV0gPSBfLmJpbmQob2JqW2tleV0sIG9iaik7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH07XG5cbiAgLy8gTWVtb2l6ZSBhbiBleHBlbnNpdmUgZnVuY3Rpb24gYnkgc3RvcmluZyBpdHMgcmVzdWx0cy5cbiAgXy5tZW1vaXplID0gZnVuY3Rpb24oZnVuYywgaGFzaGVyKSB7XG4gICAgdmFyIG1lbW9pemUgPSBmdW5jdGlvbihrZXkpIHtcbiAgICAgIHZhciBjYWNoZSA9IG1lbW9pemUuY2FjaGU7XG4gICAgICB2YXIgYWRkcmVzcyA9ICcnICsgKGhhc2hlciA/IGhhc2hlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDoga2V5KTtcbiAgICAgIGlmICghXy5oYXMoY2FjaGUsIGFkZHJlc3MpKSBjYWNoZVthZGRyZXNzXSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiBjYWNoZVthZGRyZXNzXTtcbiAgICB9O1xuICAgIG1lbW9pemUuY2FjaGUgPSB7fTtcbiAgICByZXR1cm4gbWVtb2l6ZTtcbiAgfTtcblxuICAvLyBEZWxheXMgYSBmdW5jdGlvbiBmb3IgdGhlIGdpdmVuIG51bWJlciBvZiBtaWxsaXNlY29uZHMsIGFuZCB0aGVuIGNhbGxzXG4gIC8vIGl0IHdpdGggdGhlIGFyZ3VtZW50cyBzdXBwbGllZC5cbiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHtcbiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTtcbiAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7XG4gICAgfSwgd2FpdCk7XG4gIH07XG5cbiAgLy8gRGVmZXJzIGEgZnVuY3Rpb24sIHNjaGVkdWxpbmcgaXQgdG8gcnVuIGFmdGVyIHRoZSBjdXJyZW50IGNhbGwgc3RhY2sgaGFzXG4gIC8vIGNsZWFyZWQuXG4gIF8uZGVmZXIgPSBfLnBhcnRpYWwoXy5kZWxheSwgXywgMSk7XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCB3aGVuIGludm9rZWQsIHdpbGwgb25seSBiZSB0cmlnZ2VyZWQgYXQgbW9zdCBvbmNlXG4gIC8vIGR1cmluZyBhIGdpdmVuIHdpbmRvdyBvZiB0aW1lLiBOb3JtYWxseSwgdGhlIHRocm90dGxlZCBmdW5jdGlvbiB3aWxsIHJ1blxuICAvLyBhcyBtdWNoIGFzIGl0IGNhbiwgd2l0aG91dCBldmVyIGdvaW5nIG1vcmUgdGhhbiBvbmNlIHBlciBgd2FpdGAgZHVyYXRpb247XG4gIC8vIGJ1dCBpZiB5b3UnZCBsaWtlIHRvIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzXG4gIC8vIGB7bGVhZGluZzogZmFsc2V9YC4gVG8gZGlzYWJsZSBleGVjdXRpb24gb24gdGhlIHRyYWlsaW5nIGVkZ2UsIGRpdHRvLlxuICBfLnRocm90dGxlID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgb3B0aW9ucykge1xuICAgIHZhciBjb250ZXh0LCBhcmdzLCByZXN1bHQ7XG4gICAgdmFyIHRpbWVvdXQgPSBudWxsO1xuICAgIHZhciBwcmV2aW91cyA9IDA7XG4gICAgaWYgKCFvcHRpb25zKSBvcHRpb25zID0ge307XG4gICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogXy5ub3coKTtcbiAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgIGlmICghdGltZW91dCkgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG5vdyA9IF8ubm93KCk7XG4gICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93O1xuICAgICAgdmFyIHJlbWFpbmluZyA9IHdhaXQgLSAobm93IC0gcHJldmlvdXMpO1xuICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgaWYgKHJlbWFpbmluZyA8PSAwIHx8IHJlbWFpbmluZyA+IHdhaXQpIHtcbiAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcHJldmlvdXMgPSBub3c7XG4gICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgIGlmICghdGltZW91dCkgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgICAgfSBlbHNlIGlmICghdGltZW91dCAmJiBvcHRpb25zLnRyYWlsaW5nICE9PSBmYWxzZSkge1xuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90XG4gIC8vIGJlIHRyaWdnZXJlZC4gVGhlIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGFmdGVyIGl0IHN0b3BzIGJlaW5nIGNhbGxlZCBmb3JcbiAgLy8gTiBtaWxsaXNlY29uZHMuIElmIGBpbW1lZGlhdGVgIGlzIHBhc3NlZCwgdHJpZ2dlciB0aGUgZnVuY3Rpb24gb24gdGhlXG4gIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuXG4gIF8uZGVib3VuY2UgPSBmdW5jdGlvbihmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHtcbiAgICB2YXIgdGltZW91dCwgYXJncywgY29udGV4dCwgdGltZXN0YW1wLCByZXN1bHQ7XG5cbiAgICB2YXIgbGF0ZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBsYXN0ID0gXy5ub3coKSAtIHRpbWVzdGFtcDtcblxuICAgICAgaWYgKGxhc3QgPCB3YWl0ICYmIGxhc3QgPj0gMCkge1xuICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCAtIGxhc3QpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGltZW91dCA9IG51bGw7XG4gICAgICAgIGlmICghaW1tZWRpYXRlKSB7XG4gICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICAgICAgICBpZiAoIXRpbWVvdXQpIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICBjb250ZXh0ID0gdGhpcztcbiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICB0aW1lc3RhbXAgPSBfLm5vdygpO1xuICAgICAgdmFyIGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XG4gICAgICBpZiAoIXRpbWVvdXQpIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcbiAgICAgIGlmIChjYWxsTm93KSB7XG4gICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICB9O1xuXG4gIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLFxuICAvLyBhbGxvd2luZyB5b3UgdG8gYWRqdXN0IGFyZ3VtZW50cywgcnVuIGNvZGUgYmVmb3JlIGFuZCBhZnRlciwgYW5kXG4gIC8vIGNvbmRpdGlvbmFsbHkgZXhlY3V0ZSB0aGUgb3JpZ2luYWwgZnVuY3Rpb24uXG4gIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHtcbiAgICByZXR1cm4gXy5wYXJ0aWFsKHdyYXBwZXIsIGZ1bmMpO1xuICB9O1xuXG4gIC8vIFJldHVybnMgYSBuZWdhdGVkIHZlcnNpb24gb2YgdGhlIHBhc3NlZC1pbiBwcmVkaWNhdGUuXG4gIF8ubmVnYXRlID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuICFwcmVkaWNhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuICB9O1xuXG4gIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IGlzIHRoZSBjb21wb3NpdGlvbiBvZiBhIGxpc3Qgb2YgZnVuY3Rpb25zLCBlYWNoXG4gIC8vIGNvbnN1bWluZyB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBmdW5jdGlvbiB0aGF0IGZvbGxvd3MuXG4gIF8uY29tcG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgIHZhciBzdGFydCA9IGFyZ3MubGVuZ3RoIC0gMTtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaSA9IHN0YXJ0O1xuICAgICAgdmFyIHJlc3VsdCA9IGFyZ3Nbc3RhcnRdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB3aGlsZSAoaS0tKSByZXN1bHQgPSBhcmdzW2ldLmNhbGwodGhpcywgcmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgb24gYW5kIGFmdGVyIHRoZSBOdGggY2FsbC5cbiAgXy5hZnRlciA9IGZ1bmN0aW9uKHRpbWVzLCBmdW5jKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKC0tdGltZXMgPCAxKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgdXAgdG8gKGJ1dCBub3QgaW5jbHVkaW5nKSB0aGUgTnRoIGNhbGwuXG4gIF8uYmVmb3JlID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHtcbiAgICB2YXIgbWVtbztcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoLS10aW1lcyA+IDApIHtcbiAgICAgICAgbWVtbyA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aW1lcyA8PSAxKSBmdW5jID0gbnVsbDtcbiAgICAgIHJldHVybiBtZW1vO1xuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93XG4gIC8vIG9mdGVuIHlvdSBjYWxsIGl0LiBVc2VmdWwgZm9yIGxhenkgaW5pdGlhbGl6YXRpb24uXG4gIF8ub25jZSA9IF8ucGFydGlhbChfLmJlZm9yZSwgMik7XG5cbiAgLy8gT2JqZWN0IEZ1bmN0aW9uc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gS2V5cyBpbiBJRSA8IDkgdGhhdCB3b24ndCBiZSBpdGVyYXRlZCBieSBgZm9yIGtleSBpbiAuLi5gIGFuZCB0aHVzIG1pc3NlZC5cbiAgdmFyIGhhc0VudW1CdWcgPSAhe3RvU3RyaW5nOiBudWxsfS5wcm9wZXJ0eUlzRW51bWVyYWJsZSgndG9TdHJpbmcnKTtcbiAgdmFyIG5vbkVudW1lcmFibGVQcm9wcyA9IFsndmFsdWVPZicsICdpc1Byb3RvdHlwZU9mJywgJ3RvU3RyaW5nJyxcbiAgICAgICAgICAgICAgICAgICAgICAncHJvcGVydHlJc0VudW1lcmFibGUnLCAnaGFzT3duUHJvcGVydHknLCAndG9Mb2NhbGVTdHJpbmcnXTtcblxuICBmdW5jdGlvbiBjb2xsZWN0Tm9uRW51bVByb3BzKG9iaiwga2V5cykge1xuICAgIHZhciBub25FbnVtSWR4ID0gbm9uRW51bWVyYWJsZVByb3BzLmxlbmd0aDtcbiAgICB2YXIgY29uc3RydWN0b3IgPSBvYmouY29uc3RydWN0b3I7XG4gICAgdmFyIHByb3RvID0gKF8uaXNGdW5jdGlvbihjb25zdHJ1Y3RvcikgJiYgY29uc3RydWN0b3IucHJvdG90eXBlKSB8fCBPYmpQcm90bztcblxuICAgIC8vIENvbnN0cnVjdG9yIGlzIGEgc3BlY2lhbCBjYXNlLlxuICAgIHZhciBwcm9wID0gJ2NvbnN0cnVjdG9yJztcbiAgICBpZiAoXy5oYXMob2JqLCBwcm9wKSAmJiAhXy5jb250YWlucyhrZXlzLCBwcm9wKSkga2V5cy5wdXNoKHByb3ApO1xuXG4gICAgd2hpbGUgKG5vbkVudW1JZHgtLSkge1xuICAgICAgcHJvcCA9IG5vbkVudW1lcmFibGVQcm9wc1tub25FbnVtSWR4XTtcbiAgICAgIGlmIChwcm9wIGluIG9iaiAmJiBvYmpbcHJvcF0gIT09IHByb3RvW3Byb3BdICYmICFfLmNvbnRhaW5zKGtleXMsIHByb3ApKSB7XG4gICAgICAgIGtleXMucHVzaChwcm9wKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3Mgb3duIHByb3BlcnRpZXMuXG4gIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBPYmplY3Qua2V5c2BcbiAgXy5rZXlzID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBbXTtcbiAgICBpZiAobmF0aXZlS2V5cykgcmV0dXJuIG5hdGl2ZUtleXMob2JqKTtcbiAgICB2YXIga2V5cyA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvYmopIGlmIChfLmhhcyhvYmosIGtleSkpIGtleXMucHVzaChrZXkpO1xuICAgIC8vIEFoZW0sIElFIDwgOS5cbiAgICBpZiAoaGFzRW51bUJ1ZykgY29sbGVjdE5vbkVudW1Qcm9wcyhvYmosIGtleXMpO1xuICAgIHJldHVybiBrZXlzO1xuICB9O1xuXG4gIC8vIFJldHJpZXZlIGFsbCB0aGUgcHJvcGVydHkgbmFtZXMgb2YgYW4gb2JqZWN0LlxuICBfLmFsbEtleXMgPSBmdW5jdGlvbihvYmopIHtcbiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIFtdO1xuICAgIHZhciBrZXlzID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG9iaikga2V5cy5wdXNoKGtleSk7XG4gICAgLy8gQWhlbSwgSUUgPCA5LlxuICAgIGlmIChoYXNFbnVtQnVnKSBjb2xsZWN0Tm9uRW51bVByb3BzKG9iaiwga2V5cyk7XG4gICAgcmV0dXJuIGtleXM7XG4gIH07XG5cbiAgLy8gUmV0cmlldmUgdGhlIHZhbHVlcyBvZiBhbiBvYmplY3QncyBwcm9wZXJ0aWVzLlxuICBfLnZhbHVlcyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7XG4gICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICAgIHZhciB2YWx1ZXMgPSBBcnJheShsZW5ndGgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlcztcbiAgfTtcblxuICAvLyBSZXR1cm5zIHRoZSByZXN1bHRzIG9mIGFwcGx5aW5nIHRoZSBpdGVyYXRlZSB0byBlYWNoIGVsZW1lbnQgb2YgdGhlIG9iamVjdFxuICAvLyBJbiBjb250cmFzdCB0byBfLm1hcCBpdCByZXR1cm5zIGFuIG9iamVjdFxuICBfLm1hcE9iamVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICB2YXIga2V5cyA9ICBfLmtleXMob2JqKSxcbiAgICAgICAgICBsZW5ndGggPSBrZXlzLmxlbmd0aCxcbiAgICAgICAgICByZXN1bHRzID0ge30sXG4gICAgICAgICAgY3VycmVudEtleTtcbiAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgY3VycmVudEtleSA9IGtleXNbaW5kZXhdO1xuICAgICAgICByZXN1bHRzW2N1cnJlbnRLZXldID0gaXRlcmF0ZWUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gIH07XG5cbiAgLy8gQ29udmVydCBhbiBvYmplY3QgaW50byBhIGxpc3Qgb2YgYFtrZXksIHZhbHVlXWAgcGFpcnMuXG4gIF8ucGFpcnMgPSBmdW5jdGlvbihvYmopIHtcbiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopO1xuICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICB2YXIgcGFpcnMgPSBBcnJheShsZW5ndGgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHBhaXJzW2ldID0gW2tleXNbaV0sIG9ialtrZXlzW2ldXV07XG4gICAgfVxuICAgIHJldHVybiBwYWlycztcbiAgfTtcblxuICAvLyBJbnZlcnQgdGhlIGtleXMgYW5kIHZhbHVlcyBvZiBhbiBvYmplY3QuIFRoZSB2YWx1ZXMgbXVzdCBiZSBzZXJpYWxpemFibGUuXG4gIF8uaW52ZXJ0ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBSZXR1cm4gYSBzb3J0ZWQgbGlzdCBvZiB0aGUgZnVuY3Rpb24gbmFtZXMgYXZhaWxhYmxlIG9uIHRoZSBvYmplY3QuXG4gIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgXG4gIF8uZnVuY3Rpb25zID0gXy5tZXRob2RzID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIG5hbWVzID0gW107XG4gICAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgICAgaWYgKF8uaXNGdW5jdGlvbihvYmpba2V5XSkpIG5hbWVzLnB1c2goa2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIG5hbWVzLnNvcnQoKTtcbiAgfTtcblxuICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS5cbiAgXy5leHRlbmQgPSBjcmVhdGVBc3NpZ25lcihfLmFsbEtleXMpO1xuXG4gIC8vIEFzc2lnbnMgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIG93biBwcm9wZXJ0aWVzIGluIHRoZSBwYXNzZWQtaW4gb2JqZWN0KHMpXG4gIC8vIChodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvYXNzaWduKVxuICBfLmV4dGVuZE93biA9IF8uYXNzaWduID0gY3JlYXRlQXNzaWduZXIoXy5rZXlzKTtcblxuICAvLyBSZXR1cm5zIHRoZSBmaXJzdCBrZXkgb24gYW4gb2JqZWN0IHRoYXQgcGFzc2VzIGEgcHJlZGljYXRlIHRlc3RcbiAgXy5maW5kS2V5ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaiksIGtleTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAga2V5ID0ga2V5c1tpXTtcbiAgICAgIGlmIChwcmVkaWNhdGUob2JqW2tleV0sIGtleSwgb2JqKSkgcmV0dXJuIGtleTtcbiAgICB9XG4gIH07XG5cbiAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgb2JqZWN0IG9ubHkgY29udGFpbmluZyB0aGUgd2hpdGVsaXN0ZWQgcHJvcGVydGllcy5cbiAgXy5waWNrID0gZnVuY3Rpb24ob2JqZWN0LCBvaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0ID0ge30sIG9iaiA9IG9iamVjdCwgaXRlcmF0ZWUsIGtleXM7XG4gICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0O1xuICAgIGlmIChfLmlzRnVuY3Rpb24ob2l0ZXJhdGVlKSkge1xuICAgICAga2V5cyA9IF8uYWxsS2V5cyhvYmopO1xuICAgICAgaXRlcmF0ZWUgPSBvcHRpbWl6ZUNiKG9pdGVyYXRlZSwgY29udGV4dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGtleXMgPSBmbGF0dGVuKGFyZ3VtZW50cywgZmFsc2UsIGZhbHNlLCAxKTtcbiAgICAgIGl0ZXJhdGVlID0gZnVuY3Rpb24odmFsdWUsIGtleSwgb2JqKSB7IHJldHVybiBrZXkgaW4gb2JqOyB9O1xuICAgICAgb2JqID0gT2JqZWN0KG9iaik7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgIHZhciB2YWx1ZSA9IG9ialtrZXldO1xuICAgICAgaWYgKGl0ZXJhdGVlKHZhbHVlLCBrZXksIG9iaikpIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCB3aXRob3V0IHRoZSBibGFja2xpc3RlZCBwcm9wZXJ0aWVzLlxuICBfLm9taXQgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihpdGVyYXRlZSkpIHtcbiAgICAgIGl0ZXJhdGVlID0gXy5uZWdhdGUoaXRlcmF0ZWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIga2V5cyA9IF8ubWFwKGZsYXR0ZW4oYXJndW1lbnRzLCBmYWxzZSwgZmFsc2UsIDEpLCBTdHJpbmcpO1xuICAgICAgaXRlcmF0ZWUgPSBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgIHJldHVybiAhXy5jb250YWlucyhrZXlzLCBrZXkpO1xuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIF8ucGljayhvYmosIGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgfTtcblxuICAvLyBGaWxsIGluIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzLlxuICBfLmRlZmF1bHRzID0gY3JlYXRlQXNzaWduZXIoXy5hbGxLZXlzLCB0cnVlKTtcblxuLy8gUmV0cmlldmUgYWxsIHRoZSBwcm9wZXJ0eSBuYW1lcyBvZiBhbiBvYmplY3QuXG5fLmFsbEtleXMgPSBmdW5jdGlvbihvYmopIHtcbiAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBbXTtcbiAgdmFyIGtleXMgPSBbXTtcbiAgZm9yICh2YXIga2V5IGluIG9iaikga2V5cy5wdXNoKGtleSk7XG4gIC8vIEFoZW0sIElFIDwgOS5cbiAgaWYgKGhhc0VudW1CdWcpIGNvbGxlY3ROb25FbnVtUHJvcHMob2JqLCBrZXlzKTtcbiAgcmV0dXJuIGtleXM7XG59O1xuXG52YXIgY3JlYXRlQXNzaWduZXIgPSBmdW5jdGlvbihrZXlzRnVuYywgdW5kZWZpbmVkT25seSkge1xuICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgaWYgKGxlbmd0aCA8IDIgfHwgb2JqID09IG51bGwpIHJldHVybiBvYmo7XG4gICAgZm9yICh2YXIgaW5kZXggPSAxOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpbmRleF0sXG4gICAgICAgIGtleXMgPSBrZXlzRnVuYyhzb3VyY2UpLFxuICAgICAgICBsID0ga2V5cy5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykge1xuICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgICAgaWYgKCF1bmRlZmluZWRPbmx5IHx8IG9ialtrZXldID09PSB2b2lkIDApIG9ialtrZXldID0gc291cmNlW2tleV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH07XG59O1xuXG5cbi8vIENyZWF0ZXMgYW4gb2JqZWN0IHRoYXQgaW5oZXJpdHMgZnJvbSB0aGUgZ2l2ZW4gcHJvdG90eXBlIG9iamVjdC5cbiAgLy8gSWYgYWRkaXRpb25hbCBwcm9wZXJ0aWVzIGFyZSBwcm92aWRlZCB0aGVuIHRoZXkgd2lsbCBiZSBhZGRlZCB0byB0aGVcbiAgLy8gY3JlYXRlZCBvYmplY3QuXG4gIF8uY3JlYXRlID0gZnVuY3Rpb24ocHJvdG90eXBlLCBwcm9wcykge1xuICAgIHZhciByZXN1bHQgPSBiYXNlQ3JlYXRlKHByb3RvdHlwZSk7XG4gICAgaWYgKHByb3BzKSBfLmV4dGVuZE93bihyZXN1bHQsIHByb3BzKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIENyZWF0ZSBhIChzaGFsbG93LWNsb25lZCkgZHVwbGljYXRlIG9mIGFuIG9iamVjdC5cbiAgXy5jbG9uZSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gb2JqO1xuICAgIHJldHVybiBfLmlzQXJyYXkob2JqKSA/IG9iai5zbGljZSgpIDogXy5leHRlbmQoe30sIG9iaik7XG4gIH07XG5cbiAgLy8gSW52b2tlcyBpbnRlcmNlcHRvciB3aXRoIHRoZSBvYmosIGFuZCB0aGVuIHJldHVybnMgb2JqLlxuICAvLyBUaGUgcHJpbWFyeSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvIFwidGFwIGludG9cIiBhIG1ldGhvZCBjaGFpbiwgaW5cbiAgLy8gb3JkZXIgdG8gcGVyZm9ybSBvcGVyYXRpb25zIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uXG4gIF8udGFwID0gZnVuY3Rpb24ob2JqLCBpbnRlcmNlcHRvcikge1xuICAgIGludGVyY2VwdG9yKG9iaik7XG4gICAgcmV0dXJuIG9iajtcbiAgfTtcblxuICAvLyBSZXR1cm5zIHdoZXRoZXIgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHNldCBvZiBga2V5OnZhbHVlYCBwYWlycy5cbiAgXy5pc01hdGNoID0gZnVuY3Rpb24ob2JqZWN0LCBhdHRycykge1xuICAgIHZhciBrZXlzID0gXy5rZXlzKGF0dHJzKSwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gIWxlbmd0aDtcbiAgICB2YXIgb2JqID0gT2JqZWN0KG9iamVjdCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgICBpZiAoYXR0cnNba2V5XSAhPT0gb2JqW2tleV0gfHwgIShrZXkgaW4gb2JqKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuXG4gIC8vIEludGVybmFsIHJlY3Vyc2l2ZSBjb21wYXJpc29uIGZ1bmN0aW9uIGZvciBgaXNFcXVhbGAuXG4gIHZhciBlcSA9IGZ1bmN0aW9uKGEsIGIsIGFTdGFjaywgYlN0YWNrKSB7XG4gICAgLy8gSWRlbnRpY2FsIG9iamVjdHMgYXJlIGVxdWFsLiBgMCA9PT0gLTBgLCBidXQgdGhleSBhcmVuJ3QgaWRlbnRpY2FsLlxuICAgIC8vIFNlZSB0aGUgW0hhcm1vbnkgYGVnYWxgIHByb3Bvc2FsXShodHRwOi8vd2lraS5lY21hc2NyaXB0Lm9yZy9kb2t1LnBocD9pZD1oYXJtb255OmVnYWwpLlxuICAgIGlmIChhID09PSBiKSByZXR1cm4gYSAhPT0gMCB8fCAxIC8gYSA9PT0gMSAvIGI7XG4gICAgLy8gQSBzdHJpY3QgY29tcGFyaXNvbiBpcyBuZWNlc3NhcnkgYmVjYXVzZSBgbnVsbCA9PSB1bmRlZmluZWRgLlxuICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjtcbiAgICAvLyBVbndyYXAgYW55IHdyYXBwZWQgb2JqZWN0cy5cbiAgICBpZiAoYSBpbnN0YW5jZW9mIF8pIGEgPSBhLl93cmFwcGVkO1xuICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7XG4gICAgLy8gQ29tcGFyZSBgW1tDbGFzc11dYCBuYW1lcy5cbiAgICB2YXIgY2xhc3NOYW1lID0gdG9TdHJpbmcuY2FsbChhKTtcbiAgICBpZiAoY2xhc3NOYW1lICE9PSB0b1N0cmluZy5jYWxsKGIpKSByZXR1cm4gZmFsc2U7XG4gICAgc3dpdGNoIChjbGFzc05hbWUpIHtcbiAgICAgIC8vIFN0cmluZ3MsIG51bWJlcnMsIHJlZ3VsYXIgZXhwcmVzc2lvbnMsIGRhdGVzLCBhbmQgYm9vbGVhbnMgYXJlIGNvbXBhcmVkIGJ5IHZhbHVlLlxuICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzpcbiAgICAgIC8vIFJlZ0V4cHMgYXJlIGNvZXJjZWQgdG8gc3RyaW5ncyBmb3IgY29tcGFyaXNvbiAoTm90ZTogJycgKyAvYS9pID09PSAnL2EvaScpXG4gICAgICBjYXNlICdbb2JqZWN0IFN0cmluZ10nOlxuICAgICAgICAvLyBQcmltaXRpdmVzIGFuZCB0aGVpciBjb3JyZXNwb25kaW5nIG9iamVjdCB3cmFwcGVycyBhcmUgZXF1aXZhbGVudDsgdGh1cywgYFwiNVwiYCBpc1xuICAgICAgICAvLyBlcXVpdmFsZW50IHRvIGBuZXcgU3RyaW5nKFwiNVwiKWAuXG4gICAgICAgIHJldHVybiAnJyArIGEgPT09ICcnICsgYjtcbiAgICAgIGNhc2UgJ1tvYmplY3QgTnVtYmVyXSc6XG4gICAgICAgIC8vIGBOYU5gcyBhcmUgZXF1aXZhbGVudCwgYnV0IG5vbi1yZWZsZXhpdmUuXG4gICAgICAgIC8vIE9iamVjdChOYU4pIGlzIGVxdWl2YWxlbnQgdG8gTmFOXG4gICAgICAgIGlmICgrYSAhPT0gK2EpIHJldHVybiArYiAhPT0gK2I7XG4gICAgICAgIC8vIEFuIGBlZ2FsYCBjb21wYXJpc29uIGlzIHBlcmZvcm1lZCBmb3Igb3RoZXIgbnVtZXJpYyB2YWx1ZXMuXG4gICAgICAgIHJldHVybiArYSA9PT0gMCA/IDEgLyArYSA9PT0gMSAvIGIgOiArYSA9PT0gK2I7XG4gICAgICBjYXNlICdbb2JqZWN0IERhdGVdJzpcbiAgICAgIGNhc2UgJ1tvYmplY3QgQm9vbGVhbl0nOlxuICAgICAgICAvLyBDb2VyY2UgZGF0ZXMgYW5kIGJvb2xlYW5zIHRvIG51bWVyaWMgcHJpbWl0aXZlIHZhbHVlcy4gRGF0ZXMgYXJlIGNvbXBhcmVkIGJ5IHRoZWlyXG4gICAgICAgIC8vIG1pbGxpc2Vjb25kIHJlcHJlc2VudGF0aW9ucy4gTm90ZSB0aGF0IGludmFsaWQgZGF0ZXMgd2l0aCBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnNcbiAgICAgICAgLy8gb2YgYE5hTmAgYXJlIG5vdCBlcXVpdmFsZW50LlxuICAgICAgICByZXR1cm4gK2EgPT09ICtiO1xuICAgIH1cblxuICAgIHZhciBhcmVBcnJheXMgPSBjbGFzc05hbWUgPT09ICdbb2JqZWN0IEFycmF5XSc7XG4gICAgaWYgKCFhcmVBcnJheXMpIHtcbiAgICAgIGlmICh0eXBlb2YgYSAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYiAhPSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAvLyBPYmplY3RzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWl2YWxlbnQsIGJ1dCBgT2JqZWN0YHMgb3IgYEFycmF5YHNcbiAgICAgIC8vIGZyb20gZGlmZmVyZW50IGZyYW1lcyBhcmUuXG4gICAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7XG4gICAgICBpZiAoYUN0b3IgIT09IGJDdG9yICYmICEoXy5pc0Z1bmN0aW9uKGFDdG9yKSAmJiBhQ3RvciBpbnN0YW5jZW9mIGFDdG9yICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5pc0Z1bmN0aW9uKGJDdG9yKSAmJiBiQ3RvciBpbnN0YW5jZW9mIGJDdG9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAoJ2NvbnN0cnVjdG9yJyBpbiBhICYmICdjb25zdHJ1Y3RvcicgaW4gYikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBBc3N1bWUgZXF1YWxpdHkgZm9yIGN5Y2xpYyBzdHJ1Y3R1cmVzLiBUaGUgYWxnb3JpdGhtIGZvciBkZXRlY3RpbmcgY3ljbGljXG4gICAgLy8gc3RydWN0dXJlcyBpcyBhZGFwdGVkIGZyb20gRVMgNS4xIHNlY3Rpb24gMTUuMTIuMywgYWJzdHJhY3Qgb3BlcmF0aW9uIGBKT2AuXG5cbiAgICAvLyBJbml0aWFsaXppbmcgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuXG4gICAgLy8gSXQncyBkb25lIGhlcmUgc2luY2Ugd2Ugb25seSBuZWVkIHRoZW0gZm9yIG9iamVjdHMgYW5kIGFycmF5cyBjb21wYXJpc29uLlxuICAgIGFTdGFjayA9IGFTdGFjayB8fCBbXTtcbiAgICBiU3RhY2sgPSBiU3RhY2sgfHwgW107XG4gICAgdmFyIGxlbmd0aCA9IGFTdGFjay5sZW5ndGg7XG4gICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICAvLyBMaW5lYXIgc2VhcmNoLiBQZXJmb3JtYW5jZSBpcyBpbnZlcnNlbHkgcHJvcG9ydGlvbmFsIHRvIHRoZSBudW1iZXIgb2ZcbiAgICAgIC8vIHVuaXF1ZSBuZXN0ZWQgc3RydWN0dXJlcy5cbiAgICAgIGlmIChhU3RhY2tbbGVuZ3RoXSA9PT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09PSBiO1xuICAgIH1cblxuICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy5cbiAgICBhU3RhY2sucHVzaChhKTtcbiAgICBiU3RhY2sucHVzaChiKTtcblxuICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgb2JqZWN0cyBhbmQgYXJyYXlzLlxuICAgIGlmIChhcmVBcnJheXMpIHtcbiAgICAgIC8vIENvbXBhcmUgYXJyYXkgbGVuZ3RocyB0byBkZXRlcm1pbmUgaWYgYSBkZWVwIGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5LlxuICAgICAgbGVuZ3RoID0gYS5sZW5ndGg7XG4gICAgICBpZiAobGVuZ3RoICE9PSBiLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy5cbiAgICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgICBpZiAoIWVxKGFbbGVuZ3RoXSwgYltsZW5ndGhdLCBhU3RhY2ssIGJTdGFjaykpIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRGVlcCBjb21wYXJlIG9iamVjdHMuXG4gICAgICB2YXIga2V5cyA9IF8ua2V5cyhhKSwga2V5O1xuICAgICAgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gICAgICAvLyBFbnN1cmUgdGhhdCBib3RoIG9iamVjdHMgY29udGFpbiB0aGUgc2FtZSBudW1iZXIgb2YgcHJvcGVydGllcyBiZWZvcmUgY29tcGFyaW5nIGRlZXAgZXF1YWxpdHkuXG4gICAgICBpZiAoXy5rZXlzKGIpLmxlbmd0aCAhPT0gbGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgICAgLy8gRGVlcCBjb21wYXJlIGVhY2ggbWVtYmVyXG4gICAgICAgIGtleSA9IGtleXNbbGVuZ3RoXTtcbiAgICAgICAgaWYgKCEoXy5oYXMoYiwga2V5KSAmJiBlcShhW2tleV0sIGJba2V5XSwgYVN0YWNrLCBiU3RhY2spKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBSZW1vdmUgdGhlIGZpcnN0IG9iamVjdCBmcm9tIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy5cbiAgICBhU3RhY2sucG9wKCk7XG4gICAgYlN0YWNrLnBvcCgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLlxuICBfLmlzRXF1YWwgPSBmdW5jdGlvbihhLCBiKSB7XG4gICAgcmV0dXJuIGVxKGEsIGIpO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5P1xuICAvLyBBbiBcImVtcHR5XCIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLlxuICBfLmlzRW1wdHkgPSBmdW5jdGlvbihvYmopIHtcbiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiB0cnVlO1xuICAgIGlmIChpc0FycmF5TGlrZShvYmopICYmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikgfHwgXy5pc0FyZ3VtZW50cyhvYmopKSkgcmV0dXJuIG9iai5sZW5ndGggPT09IDA7XG4gICAgcmV0dXJuIF8ua2V5cyhvYmopLmxlbmd0aCA9PT0gMDtcbiAgfTtcblxuICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgRE9NIGVsZW1lbnQ/XG4gIF8uaXNFbGVtZW50ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuICEhKG9iaiAmJiBvYmoubm9kZVR5cGUgPT09IDEpO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYW4gYXJyYXk/XG4gIC8vIERlbGVnYXRlcyB0byBFQ01BNSdzIG5hdGl2ZSBBcnJheS5pc0FycmF5XG4gIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgfTtcblxuICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIGFuIG9iamVjdD9cbiAgXy5pc09iamVjdCA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciB0eXBlID0gdHlwZW9mIG9iajtcbiAgICByZXR1cm4gdHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlID09PSAnb2JqZWN0JyAmJiAhIW9iajtcbiAgfTtcblxuICAvLyBBZGQgc29tZSBpc1R5cGUgbWV0aG9kczogaXNBcmd1bWVudHMsIGlzRnVuY3Rpb24sIGlzU3RyaW5nLCBpc051bWJlciwgaXNEYXRlLCBpc1JlZ0V4cCwgaXNFcnJvci5cbiAgXy5lYWNoKFsnQXJndW1lbnRzJywgJ0Z1bmN0aW9uJywgJ1N0cmluZycsICdOdW1iZXInLCAnRGF0ZScsICdSZWdFeHAnLCAnRXJyb3InXSwgZnVuY3Rpb24obmFtZSkge1xuICAgIF9bJ2lzJyArIG5hbWVdID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCAnICsgbmFtZSArICddJztcbiAgICB9O1xuICB9KTtcblxuXG4gIC8vIE9wdGltaXplIGBpc0Z1bmN0aW9uYCBpZiBhcHByb3ByaWF0ZS4gV29yayBhcm91bmQgc29tZSB0eXBlb2YgYnVncyBpbiBvbGQgdjgsXG4gIC8vIElFIDExICgjMTYyMSksIGFuZCBpbiBTYWZhcmkgOCAoIzE5MjkpLlxuICBpZiAodHlwZW9mIC8uLyAhPSAnZnVuY3Rpb24nICYmIHR5cGVvZiBJbnQ4QXJyYXkgIT0gJ29iamVjdCcpIHtcbiAgICBfLmlzRnVuY3Rpb24gPSBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09ICdmdW5jdGlvbicgfHwgZmFsc2U7XG4gICAgfTtcbiAgfVxuXG4gIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj9cbiAgXy5pc0Zpbml0ZSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBpc0Zpbml0ZShvYmopICYmICFpc05hTihwYXJzZUZsb2F0KG9iaikpO1xuICB9O1xuXG4gIC8vIElzIHRoZSBnaXZlbiB2YWx1ZSBgTmFOYD8gKE5hTiBpcyB0aGUgb25seSBudW1iZXIgd2hpY2ggZG9lcyBub3QgZXF1YWwgaXRzZWxmKS5cbiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBfLmlzTnVtYmVyKG9iaikgJiYgb2JqICE9PSArb2JqO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBib29sZWFuP1xuICBfLmlzQm9vbGVhbiA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBvYmogPT09IHRydWUgfHwgb2JqID09PSBmYWxzZSB8fCB0b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEJvb2xlYW5dJztcbiAgfTtcblxuICAvLyBJcyBhIGdpdmVuIHZhbHVlIGVxdWFsIHRvIG51bGw/XG4gIF8uaXNOdWxsID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIG9iaiA9PT0gbnVsbDtcbiAgfTtcblxuICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIHVuZGVmaW5lZD9cbiAgXy5pc1VuZGVmaW5lZCA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBvYmogPT09IHZvaWQgMDtcbiAgfTtcblxuICAvLyBTaG9ydGN1dCBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHByb3BlcnR5IGRpcmVjdGx5XG4gIC8vIG9uIGl0c2VsZiAoaW4gb3RoZXIgd29yZHMsIG5vdCBvbiBhIHByb3RvdHlwZSkuXG4gIF8uaGFzID0gZnVuY3Rpb24ob2JqLCBrZXkpIHtcbiAgICByZXR1cm4gb2JqICE9IG51bGwgJiYgaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7XG4gIH07XG5cbiAgLy8gS2VlcCB0aGUgaWRlbnRpdHkgZnVuY3Rpb24gYXJvdW5kIGZvciBkZWZhdWx0IGl0ZXJhdGVlcy5cbiAgXy5pZGVudGl0eSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9O1xuXG4gIC8vIFByZWRpY2F0ZS1nZW5lcmF0aW5nIGZ1bmN0aW9ucy4gT2Z0ZW4gdXNlZnVsIG91dHNpZGUgb2YgVW5kZXJzY29yZS5cbiAgXy5jb25zdGFudCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH07XG4gIH07XG5cbiAgXy5ub29wID0gZnVuY3Rpb24oKXt9O1xuXG4gIF8ucHJvcGVydHkgPSBwcm9wZXJ0eTtcblxuICAvLyBHZW5lcmF0ZXMgYSBmdW5jdGlvbiBmb3IgYSBnaXZlbiBvYmplY3QgdGhhdCByZXR1cm5zIGEgZ2l2ZW4gcHJvcGVydHkuXG4gIF8ucHJvcGVydHlPZiA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiBvYmogPT0gbnVsbCA/IGZ1bmN0aW9uKCl7fSA6IGZ1bmN0aW9uKGtleSkge1xuICAgICAgcmV0dXJuIG9ialtrZXldO1xuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIHByZWRpY2F0ZSBmb3IgY2hlY2tpbmcgd2hldGhlciBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gc2V0IG9mXG4gIC8vIGBrZXk6dmFsdWVgIHBhaXJzLlxuICBfLm1hdGNoZXIgPSBfLm1hdGNoZXMgPSBmdW5jdGlvbihhdHRycykge1xuICAgIGF0dHJzID0gXy5leHRlbmRPd24oe30sIGF0dHJzKTtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7XG4gICAgICByZXR1cm4gXy5pc01hdGNoKG9iaiwgYXR0cnMpO1xuICAgIH07XG4gIH07XG5cbiAgLy8gUnVuIGEgZnVuY3Rpb24gKipuKiogdGltZXMuXG4gIF8udGltZXMgPSBmdW5jdGlvbihuLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIHZhciBhY2N1bSA9IEFycmF5KE1hdGgubWF4KDAsIG4pKTtcbiAgICBpdGVyYXRlZSA9IG9wdGltaXplQ2IoaXRlcmF0ZWUsIGNvbnRleHQsIDEpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSBhY2N1bVtpXSA9IGl0ZXJhdGVlKGkpO1xuICAgIHJldHVybiBhY2N1bTtcbiAgfTtcblxuICAvLyBSZXR1cm4gYSByYW5kb20gaW50ZWdlciBiZXR3ZWVuIG1pbiBhbmQgbWF4IChpbmNsdXNpdmUpLlxuICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7XG4gICAgaWYgKG1heCA9PSBudWxsKSB7XG4gICAgICBtYXggPSBtaW47XG4gICAgICBtaW4gPSAwO1xuICAgIH1cbiAgICByZXR1cm4gbWluICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKTtcbiAgfTtcblxuICAvLyBBIChwb3NzaWJseSBmYXN0ZXIpIHdheSB0byBnZXQgdGhlIGN1cnJlbnQgdGltZXN0YW1wIGFzIGFuIGludGVnZXIuXG4gIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICB9O1xuXG4gICAvLyBMaXN0IG9mIEhUTUwgZW50aXRpZXMgZm9yIGVzY2FwaW5nLlxuICB2YXIgZXNjYXBlTWFwID0ge1xuICAgICcmJzogJyZhbXA7JyxcbiAgICAnPCc6ICcmbHQ7JyxcbiAgICAnPic6ICcmZ3Q7JyxcbiAgICAnXCInOiAnJnF1b3Q7JyxcbiAgICBcIidcIjogJyYjeDI3OycsXG4gICAgJ2AnOiAnJiN4NjA7J1xuICB9O1xuICB2YXIgdW5lc2NhcGVNYXAgPSBfLmludmVydChlc2NhcGVNYXApO1xuXG4gIC8vIEZ1bmN0aW9ucyBmb3IgZXNjYXBpbmcgYW5kIHVuZXNjYXBpbmcgc3RyaW5ncyB0by9mcm9tIEhUTUwgaW50ZXJwb2xhdGlvbi5cbiAgdmFyIGNyZWF0ZUVzY2FwZXIgPSBmdW5jdGlvbihtYXApIHtcbiAgICB2YXIgZXNjYXBlciA9IGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgICByZXR1cm4gbWFwW21hdGNoXTtcbiAgICB9O1xuICAgIC8vIFJlZ2V4ZXMgZm9yIGlkZW50aWZ5aW5nIGEga2V5IHRoYXQgbmVlZHMgdG8gYmUgZXNjYXBlZFxuICAgIHZhciBzb3VyY2UgPSAnKD86JyArIF8ua2V5cyhtYXApLmpvaW4oJ3wnKSArICcpJztcbiAgICB2YXIgdGVzdFJlZ2V4cCA9IFJlZ0V4cChzb3VyY2UpO1xuICAgIHZhciByZXBsYWNlUmVnZXhwID0gUmVnRXhwKHNvdXJjZSwgJ2cnKTtcbiAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICBzdHJpbmcgPSBzdHJpbmcgPT0gbnVsbCA/ICcnIDogJycgKyBzdHJpbmc7XG4gICAgICByZXR1cm4gdGVzdFJlZ2V4cC50ZXN0KHN0cmluZykgPyBzdHJpbmcucmVwbGFjZShyZXBsYWNlUmVnZXhwLCBlc2NhcGVyKSA6IHN0cmluZztcbiAgICB9O1xuICB9O1xuICBfLmVzY2FwZSA9IGNyZWF0ZUVzY2FwZXIoZXNjYXBlTWFwKTtcbiAgXy51bmVzY2FwZSA9IGNyZWF0ZUVzY2FwZXIodW5lc2NhcGVNYXApO1xuXG4gIC8vIElmIHRoZSB2YWx1ZSBvZiB0aGUgbmFtZWQgYHByb3BlcnR5YCBpcyBhIGZ1bmN0aW9uIHRoZW4gaW52b2tlIGl0IHdpdGggdGhlXG4gIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LlxuICBfLnJlc3VsdCA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHksIGZhbGxiYWNrKSB7XG4gICAgdmFyIHZhbHVlID0gb2JqZWN0ID09IG51bGwgPyB2b2lkIDAgOiBvYmplY3RbcHJvcGVydHldO1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICB2YWx1ZSA9IGZhbGxiYWNrO1xuICAgIH1cbiAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlLmNhbGwob2JqZWN0KSA6IHZhbHVlO1xuICB9O1xuXG4gIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuXG4gIC8vIFVzZWZ1bCBmb3IgdGVtcG9yYXJ5IERPTSBpZHMuXG4gIHZhciBpZENvdW50ZXIgPSAwO1xuICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7XG4gICAgdmFyIGlkID0gKytpZENvdW50ZXIgKyAnJztcbiAgICByZXR1cm4gcHJlZml4ID8gcHJlZml4ICsgaWQgOiBpZDtcbiAgfTtcblxuICAvLyBCeSBkZWZhdWx0LCBVbmRlcnNjb3JlIHVzZXMgRVJCLXN0eWxlIHRlbXBsYXRlIGRlbGltaXRlcnMsIGNoYW5nZSB0aGVcbiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLlxuICBfLnRlbXBsYXRlU2V0dGluZ3MgPSB7XG4gICAgZXZhbHVhdGUgICAgOiAvPCUoW1xcc1xcU10rPyklPi9nLFxuICAgIGludGVycG9sYXRlIDogLzwlPShbXFxzXFxTXSs/KSU+L2csXG4gICAgZXNjYXBlICAgICAgOiAvPCUtKFtcXHNcXFNdKz8pJT4vZ1xuICB9O1xuXG4gIC8vIFdoZW4gY3VzdG9taXppbmcgYHRlbXBsYXRlU2V0dGluZ3NgLCBpZiB5b3UgZG9uJ3Qgd2FudCB0byBkZWZpbmUgYW5cbiAgLy8gaW50ZXJwb2xhdGlvbiwgZXZhbHVhdGlvbiBvciBlc2NhcGluZyByZWdleCwgd2UgbmVlZCBvbmUgdGhhdCBpc1xuICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC5cbiAgdmFyIG5vTWF0Y2ggPSAvKC4pXi87XG5cbiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGFcbiAgLy8gc3RyaW5nIGxpdGVyYWwuXG4gIHZhciBlc2NhcGVzID0ge1xuICAgIFwiJ1wiOiAgICAgIFwiJ1wiLFxuICAgICdcXFxcJzogICAgICdcXFxcJyxcbiAgICAnXFxyJzogICAgICdyJyxcbiAgICAnXFxuJzogICAgICduJyxcbiAgICAnXFx1MjAyOCc6ICd1MjAyOCcsXG4gICAgJ1xcdTIwMjknOiAndTIwMjknXG4gIH07XG5cbiAgdmFyIGVzY2FwZXIgPSAvXFxcXHwnfFxccnxcXG58XFx1MjAyOHxcXHUyMDI5L2c7XG5cbiAgdmFyIGVzY2FwZUNoYXIgPSBmdW5jdGlvbihtYXRjaCkge1xuICAgIHJldHVybiAnXFxcXCcgKyBlc2NhcGVzW21hdGNoXTtcbiAgfTtcblxuICAvLyBKYXZhU2NyaXB0IG1pY3JvLXRlbXBsYXRpbmcsIHNpbWlsYXIgdG8gSm9obiBSZXNpZydzIGltcGxlbWVudGF0aW9uLlxuICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsXG4gIC8vIGFuZCBjb3JyZWN0bHkgZXNjYXBlcyBxdW90ZXMgd2l0aGluIGludGVycG9sYXRlZCBjb2RlLlxuICAvLyBOQjogYG9sZFNldHRpbmdzYCBvbmx5IGV4aXN0cyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuXG4gIF8udGVtcGxhdGUgPSBmdW5jdGlvbih0ZXh0LCBzZXR0aW5ncywgb2xkU2V0dGluZ3MpIHtcbiAgICBpZiAoIXNldHRpbmdzICYmIG9sZFNldHRpbmdzKSBzZXR0aW5ncyA9IG9sZFNldHRpbmdzO1xuICAgIHNldHRpbmdzID0gXy5kZWZhdWx0cyh7fSwgc2V0dGluZ3MsIF8udGVtcGxhdGVTZXR0aW5ncyk7XG5cbiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi5cbiAgICB2YXIgbWF0Y2hlciA9IFJlZ0V4cChbXG4gICAgICAoc2V0dGluZ3MuZXNjYXBlIHx8IG5vTWF0Y2gpLnNvdXJjZSxcbiAgICAgIChzZXR0aW5ncy5pbnRlcnBvbGF0ZSB8fCBub01hdGNoKS5zb3VyY2UsXG4gICAgICAoc2V0dGluZ3MuZXZhbHVhdGUgfHwgbm9NYXRjaCkuc291cmNlXG4gICAgXS5qb2luKCd8JykgKyAnfCQnLCAnZycpO1xuXG4gICAgLy8gQ29tcGlsZSB0aGUgdGVtcGxhdGUgc291cmNlLCBlc2NhcGluZyBzdHJpbmcgbGl0ZXJhbHMgYXBwcm9wcmlhdGVseS5cbiAgICB2YXIgaW5kZXggPSAwO1xuICAgIHZhciBzb3VyY2UgPSBcIl9fcCs9J1wiO1xuICAgIHRleHQucmVwbGFjZShtYXRjaGVyLCBmdW5jdGlvbihtYXRjaCwgZXNjYXBlLCBpbnRlcnBvbGF0ZSwgZXZhbHVhdGUsIG9mZnNldCkge1xuICAgICAgc291cmNlICs9IHRleHQuc2xpY2UoaW5kZXgsIG9mZnNldCkucmVwbGFjZShlc2NhcGVyLCBlc2NhcGVDaGFyKTtcbiAgICAgIGluZGV4ID0gb2Zmc2V0ICsgbWF0Y2gubGVuZ3RoO1xuXG4gICAgICBpZiAoZXNjYXBlKSB7XG4gICAgICAgIHNvdXJjZSArPSBcIicrXFxuKChfX3Q9KFwiICsgZXNjYXBlICsgXCIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcXG4nXCI7XG4gICAgICB9IGVsc2UgaWYgKGludGVycG9sYXRlKSB7XG4gICAgICAgIHNvdXJjZSArPSBcIicrXFxuKChfX3Q9KFwiICsgaW50ZXJwb2xhdGUgKyBcIikpPT1udWxsPycnOl9fdCkrXFxuJ1wiO1xuICAgICAgfSBlbHNlIGlmIChldmFsdWF0ZSkge1xuICAgICAgICBzb3VyY2UgKz0gXCInO1xcblwiICsgZXZhbHVhdGUgKyBcIlxcbl9fcCs9J1wiO1xuICAgICAgfVxuXG4gICAgICAvLyBBZG9iZSBWTXMgbmVlZCB0aGUgbWF0Y2ggcmV0dXJuZWQgdG8gcHJvZHVjZSB0aGUgY29ycmVjdCBvZmZlc3QuXG4gICAgICByZXR1cm4gbWF0Y2g7XG4gICAgfSk7XG4gICAgc291cmNlICs9IFwiJztcXG5cIjtcblxuICAgIC8vIElmIGEgdmFyaWFibGUgaXMgbm90IHNwZWNpZmllZCwgcGxhY2UgZGF0YSB2YWx1ZXMgaW4gbG9jYWwgc2NvcGUuXG4gICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XFxuJyArIHNvdXJjZSArICd9XFxuJztcblxuICAgIHNvdXJjZSA9IFwidmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLFwiICtcbiAgICAgIFwicHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTtcXG5cIiArXG4gICAgICBzb3VyY2UgKyAncmV0dXJuIF9fcDtcXG4nO1xuXG4gICAgdHJ5IHtcbiAgICAgIHZhciByZW5kZXIgPSBuZXcgRnVuY3Rpb24oc2V0dGluZ3MudmFyaWFibGUgfHwgJ29iaicsICdfJywgc291cmNlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBlLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuXG4gICAgdmFyIHRlbXBsYXRlID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgcmV0dXJuIHJlbmRlci5jYWxsKHRoaXMsIGRhdGEsIF8pO1xuICAgIH07XG5cbiAgICAvLyBQcm92aWRlIHRoZSBjb21waWxlZCBzb3VyY2UgYXMgYSBjb252ZW5pZW5jZSBmb3IgcHJlY29tcGlsYXRpb24uXG4gICAgdmFyIGFyZ3VtZW50ID0gc2V0dGluZ3MudmFyaWFibGUgfHwgJ29iaic7XG4gICAgdGVtcGxhdGUuc291cmNlID0gJ2Z1bmN0aW9uKCcgKyBhcmd1bWVudCArICcpe1xcbicgKyBzb3VyY2UgKyAnfSc7XG5cbiAgICByZXR1cm4gdGVtcGxhdGU7XG4gIH07XG5cbiAgLy8gQWRkIGEgXCJjaGFpblwiIGZ1bmN0aW9uLiBTdGFydCBjaGFpbmluZyBhIHdyYXBwZWQgVW5kZXJzY29yZSBvYmplY3QuXG4gIF8uY2hhaW4gPSBmdW5jdGlvbihvYmopIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBfKG9iaik7XG4gICAgaW5zdGFuY2UuX2NoYWluID0gdHJ1ZTtcbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH07XG5cbiAgLy8gT09QXG4gIC8vIC0tLS0tLS0tLS0tLS0tLVxuICAvLyBJZiBVbmRlcnNjb3JlIGlzIGNhbGxlZCBhcyBhIGZ1bmN0aW9uLCBpdCByZXR1cm5zIGEgd3JhcHBlZCBvYmplY3QgdGhhdFxuICAvLyBjYW4gYmUgdXNlZCBPTy1zdHlsZS4gVGhpcyB3cmFwcGVyIGhvbGRzIGFsdGVyZWQgdmVyc2lvbnMgb2YgYWxsIHRoZVxuICAvLyB1bmRlcnNjb3JlIGZ1bmN0aW9ucy4gV3JhcHBlZCBvYmplY3RzIG1heSBiZSBjaGFpbmVkLlxuXG4gIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb250aW51ZSBjaGFpbmluZyBpbnRlcm1lZGlhdGUgcmVzdWx0cy5cbiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uKGluc3RhbmNlLCBvYmopIHtcbiAgICByZXR1cm4gaW5zdGFuY2UuX2NoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7XG4gIH07XG5cbiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LlxuICBfLm1peGluID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgXy5lYWNoKF8uZnVuY3Rpb25zKG9iaiksIGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHZhciBmdW5jID0gX1tuYW1lXSA9IG9ialtuYW1lXTtcbiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBhcmdzID0gW3RoaXMuX3dyYXBwZWRdO1xuICAgICAgICBwdXNoLmFwcGx5KGFyZ3MsIGFyZ3VtZW50cyk7XG4gICAgICAgIHJldHVybiByZXN1bHQodGhpcywgZnVuYy5hcHBseShfLCBhcmdzKSk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIEFkZCBhbGwgb2YgdGhlIFVuZGVyc2NvcmUgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyIG9iamVjdC5cbiAgXy5taXhpbihfKTtcblxuICAvLyBBZGQgYWxsIG11dGF0b3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLlxuICBfLmVhY2goWydwb3AnLCAncHVzaCcsICdyZXZlcnNlJywgJ3NoaWZ0JywgJ3NvcnQnLCAnc3BsaWNlJywgJ3Vuc2hpZnQnXSwgZnVuY3Rpb24obmFtZSkge1xuICAgIHZhciBtZXRob2QgPSBBcnJheVByb3RvW25hbWVdO1xuICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgb2JqID0gdGhpcy5fd3JhcHBlZDtcbiAgICAgIG1ldGhvZC5hcHBseShvYmosIGFyZ3VtZW50cyk7XG4gICAgICBpZiAoKG5hbWUgPT09ICdzaGlmdCcgfHwgbmFtZSA9PT0gJ3NwbGljZScpICYmIG9iai5sZW5ndGggPT09IDApIGRlbGV0ZSBvYmpbMF07XG4gICAgICByZXR1cm4gcmVzdWx0KHRoaXMsIG9iaik7XG4gICAgfTtcbiAgfSk7XG5cbiAgLy8gQWRkIGFsbCBhY2Nlc3NvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuXG4gIF8uZWFjaChbJ2NvbmNhdCcsICdqb2luJywgJ3NsaWNlJ10sIGZ1bmN0aW9uKG5hbWUpIHtcbiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTtcbiAgICBfLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHJlc3VsdCh0aGlzLCBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuXG4gIF8ucHJvdG90eXBlLnZhbHVlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dyYXBwZWQ7XG4gIH07XG5cbiAgLy8gUHJvdmlkZSB1bndyYXBwaW5nIHByb3h5IGZvciBzb21lIG1ldGhvZHMgdXNlZCBpbiBlbmdpbmUgb3BlcmF0aW9uc1xuICAvLyBzdWNoIGFzIGFyaXRobWV0aWMgYW5kIEpTT04gc3RyaW5naWZpY2F0aW9uLlxuICBfLnByb3RvdHlwZS52YWx1ZU9mID0gXy5wcm90b3R5cGUudG9KU09OID0gXy5wcm90b3R5cGUudmFsdWU7XG5cbiAgXy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gJycgKyB0aGlzLl93cmFwcGVkO1xuICB9O1xuXG4gIGlmKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIpe1xuICAgIG1vZHVsZS5leHBvcnRzID0gXztcbiAgfVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHBsdWdpbnMvdW5kZXJzY29yZS5qcyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImZzXCIpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiZnNcIlxuLy8gbW9kdWxlIGlkID0gMTJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gIGxvYWRTY3JpcHQ6IGZ1bmN0aW9uIChyZXF1aXJlbWVudCwgaGVscGVyLCBlcnJvcikge1xuICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcbiAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JztcbiAgICBzY3JpcHQub25lcnJvciA9IGVycm9yO1xuICAgIHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgaGVscGVyKHNjcmlwdCwgX19zcmMpO1xuICAgICAgfVxuICAgIH07XG4gICAgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGhlbHBlciwgdHJ1ZSk7XG4gICAgc2NyaXB0LnNyYyA9IHJlcXVpcmVtZW50O1xuICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbiAgfSxcbiAgc2NyaXB0VVJMOiBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdCkge1xuICAgICAgcmV0dXJuIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjO1xuICAgIH1cbiAgICB2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKTtcbiAgICBmb3IgKHZhciBpID0gc2NyaXB0cy5sZW5ndGggLSAxOyBpLS07KSB7XG4gICAgICBpZiAoc2NyaXB0c1tpXS5zcmMpIHtcbiAgICAgICAgcmV0dXJuIHNjcmlwdHNbaV0uc3JjO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvbG9hZGVyLmpzIiwiXG52YXIgZGVlcERpZmZNYXBwZXIgPSB7XG4gIFZBTFVFX0NSRUFURUQ6ICdjcmVhdGVkJyxcbiAgVkFMVUVfVVBEQVRFRDogJ3VwZGF0ZWQnLFxuICBWQUxVRV9ERUxFVEVEOiAnZGVsZXRlZCcsXG4gIFZBTFVFX1VOQ0hBTkdFRDogJ3VuY2hhbmdlZCcsXG4gIG1hcDogZnVuY3Rpb24ob2JqMSwgb2JqMikge1xuICAgIGlmICh0aGlzLmlzRnVuY3Rpb24ob2JqMSkgfHwgdGhpcy5pc0Z1bmN0aW9uKG9iajIpKSB7XG4gICAgICB0aHJvdyAnSW52YWxpZCBhcmd1bWVudC4gRnVuY3Rpb24gZ2l2ZW4sIG9iamVjdCBleHBlY3RlZC4nO1xuICAgIH1cbiAgICBpZiAodGhpcy5pc1ZhbHVlKG9iajEpIHx8IHRoaXMuaXNWYWx1ZShvYmoyKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJ19tYXBfdHlwZSc6IHRoaXMuY29tcGFyZVZhbHVlcyhvYmoxLCBvYmoyKSxcbiAgICAgICAgJ19tYXBfZGF0YSc6IChvYmoyID09PSB1bmRlZmluZWQpID8gb2JqMSA6IG9iajJcbiAgICAgIH07XG4gICAgfVxuXG5cbiAgICBpZihfLmlzQXJyYXkob2JqMikpe1xuICAgICAgdmFyIF9hcnJheSA9IHRydWU7XG4gICAgICB2YXIgZGlmZiA9IFtdO1xuICAgIH1lbHNle1xuICAgICAgdmFyIGRpZmYgPSB7fTtcbiAgICB9XG5cblxuICAgIGZvciAodmFyIGtleSBpbiBvYmoxKSB7XG4gICAgICBpZiAodGhpcy5pc0Z1bmN0aW9uKG9iajFba2V5XSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciB2YWx1ZTIgPSB1bmRlZmluZWQ7XG4gICAgICBpZiAoJ3VuZGVmaW5lZCcgIT0gdHlwZW9mKG9iajJba2V5XSkpIHtcbiAgICAgICAgdmFsdWUyID0gb2JqMltrZXldO1xuICAgICAgfVxuXG4gICAgICBkaWZmW2tleV0gPSB0aGlzLm1hcChvYmoxW2tleV0sIHZhbHVlMik7XG4gICAgfVxuICAgIGZvciAodmFyIGtleSBpbiBvYmoyKSB7XG4gICAgICBpZiAodGhpcy5pc0Z1bmN0aW9uKG9iajJba2V5XSkgfHwgKCd1bmRlZmluZWQnICE9IHR5cGVvZihkaWZmW2tleV0pKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdmFyIF92YWwgPSB0aGlzLm1hcCh1bmRlZmluZWQsIG9iajJba2V5XSk7XG4gICAgICBpZihfYXJyYXkpe1xuICAgICAgICBkaWZmLnB1c2goX3ZhbCk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgZGlmZltrZXldID0gX3ZhbFxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAnX21hcF90eXBlJzogJycsXG4gICAgICAnX21hcF9kYXRhJzogZGlmZlxuICAgIH07XG5cbiAgfSxcbiAgY29tcGFyZVZhbHVlczogZnVuY3Rpb24odmFsdWUxLCB2YWx1ZTIpIHtcbiAgICBpZiAodmFsdWUxID09PSB2YWx1ZTIpIHtcbiAgICAgIHJldHVybiB0aGlzLlZBTFVFX1VOQ0hBTkdFRDtcbiAgICB9XG4gICAgaWYgKCd1bmRlZmluZWQnID09IHR5cGVvZih2YWx1ZTEpKSB7XG4gICAgICByZXR1cm4gdGhpcy5WQUxVRV9DUkVBVEVEO1xuICAgIH1cbiAgICBpZiAoJ3VuZGVmaW5lZCcgPT0gdHlwZW9mKHZhbHVlMikpIHtcbiAgICAgIHJldHVybiB0aGlzLlZBTFVFX0RFTEVURUQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuVkFMVUVfVVBEQVRFRDtcbiAgfSxcbiAgaXNGdW5jdGlvbjogZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIHt9LnRvU3RyaW5nLmFwcGx5KG9iaikgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSc7XG4gIH0sXG4gIGlzQXJyYXk6IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB7fS50b1N0cmluZy5hcHBseShvYmopID09PSAnW29iamVjdCBBcnJheV0nO1xuICB9LFxuICBpc09iamVjdDogZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIHt9LnRvU3RyaW5nLmFwcGx5KG9iaikgPT09ICdbb2JqZWN0IE9iamVjdF0nO1xuICB9LFxuICBpc1ZhbHVlOiBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gIXRoaXMuaXNPYmplY3Qob2JqKSAmJiAhdGhpcy5pc0FycmF5KG9iaik7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBkaWZmZXJlbmNlTWFwOiBkZWVwRGlmZk1hcHBlci5tYXAuYmluZChkZWVwRGlmZk1hcHBlciksXG4gIHN5bnRheEhpZ2hsaWdodDogZnVuY3Rpb24gKGpzb24pIHtcbiAgICBpZiAodHlwZW9mIGpzb24gIT0gJ3N0cmluZycpIHtcbiAgICAgIGpzb24gPSBKU09OLnN0cmluZ2lmeShqc29uLCBudWxsLCAyKTtcbiAgICB9XG4gICAganNvbiA9IGpzb24ucmVwbGFjZSgvJi9nLCAnJmFtcDsnKS5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpO1xuXG4gICAganNvbiA9IGpzb24ucmVwbGFjZSgvKFwiKFxcXFx1W2EtekEtWjAtOV17NH18XFxcXFtedV18W15cXFxcXCJdKSpcIihcXHMqOik/fFxcYih0cnVlfGZhbHNlfG51bGwpXFxifC0/XFxkKyg/OlxcLlxcZCopPyg/OltlRV1bK1xcLV0/XFxkKyk/KS9nLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgIHZhciBjbHMgPSAnbnVtYmVyJztcbiAgICAgIGlmICgvXlwiLy50ZXN0KG1hdGNoKSkge1xuICAgICAgICBpZiAoLzokLy50ZXN0KG1hdGNoKSkge1xuICAgICAgICAgIGNscyA9ICdrZXknO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNscyA9ICdzdHJpbmcnO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKC90cnVlfGZhbHNlLy50ZXN0KG1hdGNoKSkge1xuICAgICAgICBjbHMgPSAnYm9vbGVhbic7XG4gICAgICB9IGVsc2UgaWYgKC9udWxsLy50ZXN0KG1hdGNoKSkge1xuICAgICAgICBjbHMgPSAnbnVsbCc7XG4gICAgICB9XG4gICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPVwiJyArIGNscyArICdcIj4nICsgbWF0Y2ggKyAnPC9zcGFuPic7XG4gICAgfSk7XG4gICAgcmV0dXJuIGpzb24gPSBqc29uLnJlcGxhY2UoL1teLFxcbl1bXlxcbl0qL2csIGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgcmV0dXJuICc8c3Bhbj4nICsgbWF0Y2ggKyAnPC9zcGFuPic7XG4gICAgfSk7XG4gIH0sXG4gIGRpZmZlcmVuY2VIaWdobGlnaHQ6IGZ1bmN0aW9uICAoanNvbixvdXRwdXQpe1xuXG4gICAgaWYob3V0cHV0KXtcbiAgICAgIG91dHB1dC5lbXB0eSgpO1xuICAgIH1lbHNle1xuICAgICAgb3V0cHV0ID0gJChcIjxwcmU+XCIpO1xuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gcHJpbnRPYmplY3QoanNvbixsZXZlbCxvdXRwdXQsY29tbWEsb2JqZWN0SW5kZXgpe1xuICAgICAgdmFyIF9lbCA9ICQoXCI8cD5cIik7XG5cbiAgICAgIF9lbC5hcHBlbmQoJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcIm9iamVjdC1rZXlcIikuYXBwZW5kKFxuICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQobmV3IEFycmF5KGxldmVsKS5qb2luKCcgJykgKVxuICAgICAgKSk7XG4gICAgICBpZihvYmplY3RJbmRleCl7XG4gICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KCdcIicpLmFkZENsYXNzKFwiaW52aXNpYmxlXCIpLFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJrZXlcIikudGV4dChvYmplY3RJbmRleCksXG4gICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KCdcIicpLmFkZENsYXNzKFwiaW52aXNpYmxlXCIpLFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnOiAnKVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZihqc29uICYmIGpzb24uX21hcF90eXBlICE9PSB1bmRlZmluZWQpe1xuICAgICAgICBfZWwuYWRkQ2xhc3MoanNvbi5fbWFwX3R5cGUpO1xuXG4gICAgICAgIGlmKF8uaXNBcnJheShqc29uLl9tYXBfZGF0YSkpe1xuICAgICAgICAgIF9lbC5hcHBlbmQoJChcIjxzcGFuPlwiKS50ZXh0KFwiW1wiKSk7XG4gICAgICAgICAgdmFyIF9sYXN0X2tleSA9IGpzb24uX21hcF9kYXRhLmxlbmd0aCAtIDE7XG4gICAgICAgICAgZm9yKHZhciBpIGluIGpzb24uX21hcF9kYXRhKXtcbiAgICAgICAgICAgIHByaW50T2JqZWN0KGpzb24uX21hcF9kYXRhW2ldLGxldmVsICsgMSxfZWwsaSAhPSBfbGFzdF9rZXkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8cD5cIikudGV4dChuZXcgQXJyYXkobGV2ZWwgKS5qb2luKCcgJykgKyBcIl1cIiArIChjb21tYSA/IFwiLFwiIDogXCJcIikpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKF8uaXNPYmplY3QoanNvbi5fbWFwX2RhdGEpKXtcbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8c3Bhbj5cIikudGV4dChcIntcIikpO1xuICAgICAgICAgIHZhciBfbGFzdF9rZXkgPSBPYmplY3Qua2V5cyhqc29uLl9tYXBfZGF0YSkucG9wKCk7XG4gICAgICAgICAgZm9yKHZhciBpIGluIGpzb24uX21hcF9kYXRhKXtcbiAgICAgICAgICAgIHByaW50T2JqZWN0KGpzb24uX21hcF9kYXRhW2ldLGxldmVsICsgMSxfZWwsaSAhPSBfbGFzdF9rZXksaSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIF9lbC5hcHBlbmQoJChcIjxwPlwiKS50ZXh0KG5ldyBBcnJheShsZXZlbCApLmpvaW4oJyAnKSArIFwifVwiICsgKGNvbW1hID8gXCIsXCIgOiBcIlwiKSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG5cbiAgICAgICAgICBpZihfLmlzTnVsbChqc29uLl9tYXBfZGF0YSkpe1xuICAgICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KEpTT04uc3RyaW5naWZ5KGpzb24uX21hcF9kYXRhLCBudWxsLCAyKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoanNvbi5fbWFwX2RhdGEuY29uc3RydWN0b3IgPT09IFN0cmluZyApe1xuICAgICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KCdcIicpLFxuICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKCdzdHJpbmcnKS50ZXh0KGpzb24uX21hcF9kYXRhKSxcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KCdcIicpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGpzb24uX21hcF9kYXRhLmNvbnN0cnVjdG9yID09PSBOdW1iZXIgfHwganNvbi5fbWFwX2RhdGEuY29uc3RydWN0b3IgPT09IEJvb2xlYW4pe1xuICAgICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcygnbnVtYmVyJykudGV4dChqc29uLl9tYXBfZGF0YSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoSlNPTi5zdHJpbmdpZnkoanNvbi5fbWFwX2RhdGEsIG51bGwsIDIpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoY29tbWEpe1xuICAgICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KFwiLFwiKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG5cblxuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoSlNPTi5zdHJpbmdpZnkoanNvbiwgbnVsbCwgMikpXG4gICAgICAgIClcblxuICAgICAgICBpZihjb21tYSl7XG4gICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChcIixcIilcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgIH1cblxuICAgICAgb3V0cHV0LmFwcGVuZChfZWwpO1xuXG4gICAgfVxuICAgIHByaW50T2JqZWN0KGpzb24sMSxvdXRwdXQpO1xuICAgIHJldHVybiBvdXRwdXQ7XG4gIH1cbn07XG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvdXRpbC9zeW50YXguanMiLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgbWFwOiBmdW5jdGlvbiAoZGF0YSwgZm9vKSB7XG5cbiAgICBpZihkYXRhLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChkYXRhLm1hcChmb28pKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKTtcbiAgICB2YXIgdXJscyA9IE9iamVjdC52YWx1ZXMoZGF0YSk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHVybHMubWFwKGZvbykpXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX21hcCA9IHt9O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgX21hcFtrZXlzW2ldXSA9IHJlc3VsdHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShfbWFwKTtcbiAgICAgIH0pXG4gIH0sXG4gIHdyYXA6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHdyYXAoZm9vKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb3B0aW9ucyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtcbiAgICAgICAgaWYgKCFmb28ubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCBmYWlsKSB7XG4gICAgICAgICAgICB2YXIgX3Jlc3VsdCA9IGZvby5jYWxsKGNvbnRleHQpO1xuICAgICAgICAgICAgKF9yZXN1bHQgfHwgX3Jlc3VsdCA9PT0gdW5kZWZpbmVkKSA/IHJlc29sdmUoKSA6IGZhaWwoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZm9vLmJpbmQoY29udGV4dCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL3Byb21pc2UuanMiLCJcbmlmICghU3RyaW5nLnByb3RvdHlwZS5zcGxpY2UpIHtcbiAgLyoqXG4gICAqIHtKU0RvY31cbiAgICpcbiAgICogVGhlIHNwbGljZSgpIG1ldGhvZCBjaGFuZ2VzIHRoZSBjb250ZW50IG9mIGEgc3RyaW5nIGJ5IHJlbW92aW5nIGEgcmFuZ2Ugb2ZcbiAgICogY2hhcmFjdGVycyBhbmQvb3IgYWRkaW5nIG5ldyBjaGFyYWN0ZXJzLlxuICAgKlxuICAgKiBAdGhpcyB7U3RyaW5nfVxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgSW5kZXggYXQgd2hpY2ggdG8gc3RhcnQgY2hhbmdpbmcgdGhlIHN0cmluZy5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGRlbENvdW50IEFuIGludGVnZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9mIG9sZCBjaGFycyB0byByZW1vdmUuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdTdWJTdHIgVGhlIFN0cmluZyB0aGF0IGlzIHNwbGljZWQgaW4uXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQSBuZXcgc3RyaW5nIHdpdGggdGhlIHNwbGljZWQgc3Vic3RyaW5nLlxuICAgKi9cbiAgU3RyaW5nLnByb3RvdHlwZS5zcGxpY2UgPSBmdW5jdGlvbihzdGFydCwgZGVsQ291bnQsIG5ld1N1YlN0cikge1xuICAgIHJldHVybiB0aGlzLnNsaWNlKDAsIHN0YXJ0KSArIG5ld1N1YlN0ciArIHRoaXMuc2xpY2Uoc3RhcnQgKyBNYXRoLmFicyhkZWxDb3VudCkpO1xuICB9O1xufVxuXG5cblxuZmFicmljLnV0aWwuc3RyaW5nLnRvRGFzaGVkID0gZnVuY3Rpb24gKHN0cikge1xuICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbYS16XSkoW0EtWl0pL2csICckMS0kMicpLnRvTG93ZXJDYXNlKCk7XG59O1xuXG5mYWJyaWMudXRpbC5zdHJpbmcudW5jYXBpdGFsaXplID0gZnVuY3Rpb24oc3RyaW5nKXtcbiAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArXG4gICAgKHN0cmluZy5zbGljZSgxKSk7XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL3N0cmluZy5qcyIsIlxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMudXRpbC5vYmplY3QscmVxdWlyZSgnLi9vYmplY3QnKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvZmFicmljLnV0aWwub2JqZWN0LmpzIiwiXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwsIHtcbiAgaWRDb3VudGVyIDogMSxcbiAgY3JlYXRlT2JqZWN0OiBmdW5jdGlvbiAodHlwZSwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBpZih0eXBlb2YgdHlwZSAhPT0gXCJzdHJpbmdcIil7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0gdHlwZTtcbiAgICAgIHR5cGUgPSBudWxsO1xuICAgIH1lbHNle1xuICAgICAgb3B0aW9ucy50eXBlID0gdHlwZTtcbiAgICB9XG4gICAgdmFyIGFwcCA9IG9wdGlvbnMuYXBwbGljYXRpb247XG4gICAgYXBwICYmIGFwcC5maXJlKFwiZW50aXR5OmxvYWRcIix7b3B0aW9uczogb3B0aW9uc30pO1xuXG4gICAgdmFyIF9rbGFzc05hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUodHlwZSB8fCBvcHRpb25zLnR5cGUgfHwgYXBwLnByb3RvdHlwZXMuT2JqZWN0LnR5cGUsdHJ1ZSkpO1xuICAgIHZhciBfa2xhc3MgPSBvcHRpb25zLmFwcGxpY2F0aW9uLmtsYXNzZXNbX2tsYXNzTmFtZV0gfHwgZmFicmljW19rbGFzc05hbWVdO1xuXG5cbiAgICBpZighX2tsYXNzKXtcbiAgICAgIGNvbnNvbGUud2Fybihfa2xhc3NOYW1lICsgXCIgaXMgdW5kZWZpbmVkXCIpO1xuXG4gICAgICB2YXIgX3RleHQgPSBvcHRpb25zLnRleHQgJiYgb3B0aW9ucy50ZXh0LmNvbnN0cnVjdG9yID09IFN0cmluZyA/IG9wdGlvbnMudGV4dCA6IF9rbGFzc05hbWU7XG4gICAgICBkZWxldGUgb3B0aW9ucy50ZXh0O1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBmYWJyaWMuVGV4dChfdGV4dCxvcHRpb25zKSlcbiAgICB9XG5cbiAgICB2YXIgZWwgPSBfa2xhc3MuZnJvbU9iamVjdChvcHRpb25zLCBmdW5jdGlvbiAoZWwpIHtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICAgIGNhbGxiYWNrID0gbnVsbDtcbiAgICB9KTtcbiAgICBpZiAoZWwpIHtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICAgIGNhbGxiYWNrID0gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGVsO1xuICB9LFxuICBnZXRQcm9wb3J0aW9uczogZnVuY3Rpb24gKHBob3RvLCBjb250YWluZXIsIG1vZGUpIHtcbiAgICBtb2RlID0gbW9kZSB8fCAnZml0JztcbiAgICB2YXIgX3cgPSBwaG90by5uYXR1cmFsV2lkdGggfHwgcGhvdG8ud2lkdGg7XG4gICAgdmFyIF9oID0gcGhvdG8ubmF0dXJhbEhlaWdodCB8fCBwaG90by5oZWlnaHQ7XG4gICAgaWYgKCFjb250YWluZXIuaGVpZ2h0ICYmICFjb250YWluZXIud2lkdGgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNjYWxlOiAxLFxuICAgICAgICB3aWR0aDogX3csXG4gICAgICAgIGhlaWdodDogX2hcbiAgICAgIH07XG4gICAgfVxuICAgIGlmICghcGhvdG8uaGVpZ2h0ICYmICFwaG90by53aWR0aCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2NhbGU6IDAuMDAxLFxuICAgICAgICB3aWR0aDogY29udGFpbmVyLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IGNvbnRhaW5lci5oZWlnaHRcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gdmFyIF9hc3AgPSBfdyAvIF9oLCBfY19hc3AgPSBjb250YWluZXIud2lkdGggLyBjb250YWluZXIuaGVpZ2h0O1xuXG4gICAgLy8gaWYgKF9hc3AgPiBfY19hc3ApIHtcbiAgICAvLyAgIF9oID0gY29udGFpbmVyLmhlaWdodDtcbiAgICAvLyAgIF93ID0gX2ggKiBfYXNwO1xuICAgIC8vXG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIF93ID0gY29udGFpbmVyLndpZHRoO1xuICAgIC8vICAgX2ggPSBfdyAvIF9hc3A7XG4gICAgLy8gfVxuICAgIC8vIHZhciBzY2FsZVggPSBjb250YWluZXIud2lkdGggLyBfdztcbiAgICAvLyB2YXIgc2NhbGVZID0gY29udGFpbmVyLmhlaWdodCAvIF9oO1xuICAgIHZhciBzY2FsZVggPSBjb250YWluZXIud2lkdGggJiYgY29udGFpbmVyLndpZHRoIC8gX3cgfHwgOTk5O1xuICAgIHZhciBzY2FsZVkgPSBjb250YWluZXIuaGVpZ2h0ICYmIGNvbnRhaW5lci5oZWlnaHQgLyBfaCB8fCA5OTk7XG5cbiAgICB2YXIgc2NhbGU7XG4gICAgaWYgKG1vZGUgPT09ICdjb3ZlcicpIHtcbiAgICAgIHNjYWxlID0gTWF0aC5tYXgoc2NhbGVYLCBzY2FsZVkpO1xuICAgIH1cbiAgICBpZiAobW9kZSA9PT0gJ2ZpdCcpIHtcbiAgICAgIHNjYWxlID0gTWF0aC5taW4oc2NhbGVYLCBzY2FsZVkpO1xuICAgIH1cbiAgICBpZiAobW9kZSA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHNjYWxlID0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjYWxlOiBzY2FsZSxcbiAgICAgIHdpZHRoOiBNYXRoLmZsb29yKF93ICogc2NhbGUpLFxuICAgICAgaGVpZ2h0OiBNYXRoLmZsb29yKF9oICogc2NhbGUpXG4gICAgfTtcbiAgfSxcblxuICBjcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemU6IGZ1bmN0aW9uIChzaXplKSB7XG4gICAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICBjYW52YXMud2lkdGggPSBzaXplLndpZHRoO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBzaXplLmhlaWdodDtcbiAgICByZXR1cm4gY2FudmFzO1xuICB9LFxuXG4gIGdldFJlY3Q6IGZ1bmN0aW9uICh3aWR0aCxoZWlnaHQsb3B0aW9ucykge1xuICAgIHZhciByZWN0ID0ge307XG5cbiAgICB2YXIgX2ZsZXhBcnJheSA9IGZhYnJpYy51dGlsLmZsZXgod2lkdGggLCBbe3ZhbHVlOiBvcHRpb25zLmxlZnQsIGZsZXg6IDB9LHt2YWx1ZTogb3B0aW9ucy53aWR0aCwgZmxleDogMX0se3ZhbHVlOiBvcHRpb25zLnJpZ2h0LCBmbGV4OiAwfV0gKTtcbiAgICByZWN0LmxlZnQgPSBfZmxleEFycmF5WzBdO1xuICAgIHJlY3Qud2lkdGggPSBfZmxleEFycmF5WzFdO1xuICAgIHJlY3QucmlnaHQgPSBfZmxleEFycmF5WzJdO1xuXG4gICAgdmFyIF9mbGV4QXJyYXkgPSBmYWJyaWMudXRpbC5mbGV4KGhlaWdodCAsIFt7dmFsdWU6IG9wdGlvbnMudG9wLCBmbGV4OiAwfSx7dmFsdWU6IG9wdGlvbnMuaGVpZ2h0LCBmbGV4OiAxfSx7dmFsdWU6IG9wdGlvbnMuYm90dG9tLCBmbGV4OiAwfV0gKTtcbiAgICByZWN0LnRvcCA9IF9mbGV4QXJyYXlbMF07XG4gICAgcmVjdC5oZWlnaHQgPSBfZmxleEFycmF5WzFdO1xuICAgIHJlY3QuYm90dG9tID0gX2ZsZXhBcnJheVsyXTtcblxuICAgIHJldHVybiByZWN0O1xuICB9LFxuICAvKipcbiAgICogd2lsbCBkaXZpZGUgdG90YWwgd2lkdGggZm9yIGV2ZXJ5IG9iamVjdCBpbiBjb2x1bW50cyBhcnJheVxuICAgKlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgICAgdmFyIF9mbGV4QXJyYXkgPSBmYWJyaWMudXRpbC5mbGV4KDIwMCAsIFt7ZmxleDogMH0se3ZhbHVlOiAxMDAsIGZsZXg6IDF9LHtmbGV4OiAwfV0gKTtcbiAgICogQHBhcmFtIHRvdGFsXG4gICAqIEBwYXJhbSBjb2x1bW5zXG4gICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICogQGV4YW1wbGUgWzUwLDEwMCw1MF1cbiAgICovXG4gIGZsZXg6IGZ1bmN0aW9uICh0b3RhbCxjb2x1bW5zKXtcbiAgICB2YXIgX3JldHVybiA9IFtdO1xuICAgIHZhciBzcGxpdCA9IDA7XG4gICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbiwgaW5kZXgpe1xuICAgICAgaWYoY29sdW1uLnZhbHVlID09PSB1bmRlZmluZWQpe1xuICAgICAgICBzcGxpdCsrO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRvdGFsIC09IGNvbHVtbi52YWx1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgX3cgPSB0b3RhbCAvIHNwbGl0O1xuICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuICAgICAgX3JldHVybi5wdXNoKGNvbHVtbi52YWx1ZSA9PT0gdW5kZWZpbmVkID8gX3cgOiAgY29sdW1uLnZhbHVlICk7XG4gICAgfSk7XG4gICAgcmV0dXJuIF9yZXR1cm47XG4gIH0sXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9mYWJyaWMudXRpbC5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG4vKipcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge1N0cmluZ30gZXZlbnROYW1lXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyXG4gKi9cbmZ1bmN0aW9uIF9yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBldmVudExpc3RlbmVyID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV07XG4gIGlmIChoYW5kbGVyKSB7XG4gICAgZXZlbnRMaXN0ZW5lci5zcGxpY2UoZXZlbnRMaXN0ZW5lci5pbmRleE9mKGhhbmRsZXIpLCAxKVxuICB9XG4gIGVsc2Uge1xuICAgIGV2ZW50TGlzdGVuZXIubGVuZ3RoID0gMDtcbiAgfVxufVxuXG5mYWJyaWMuT2JzZXJ2YWJsZS5zdG9wT2JzZXJ2aW5nID0gZnVuY3Rpb24gc3RvcE9ic2VydmluZyhldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyByZW1vdmUgYWxsIGtleS92YWx1ZSBwYWlycyAoZXZlbnQgbmFtZSAtPiBldmVudCBoYW5kbGVyKVxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgIGZvciAoZXZlbnROYW1lIGluIHRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudE5hbWUpO1xuICAgIH1cbiAgfVxuICAvLyBvbmUgb2JqZWN0IHdpdGgga2V5L3ZhbHVlIHBhaXJzIHdhcyBwYXNzZWRcbiAgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuICAgIGZvciAodmFyIHByb3AgaW4gZXZlbnROYW1lKSB7XG4gICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIHByb3AsIGV2ZW50TmFtZVtwcm9wXSk7XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn1cblxuZmFicmljLk9ic2VydmFibGUub24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyLHByaW9yaXR5KSB7XG4gIGlmIChldmVudE5hbWUuY29uc3RydWN0b3IgPT0gT2JqZWN0KSB7XG4gICAgZm9yICh2YXIgaSBpbiBldmVudE5hbWUpIHtcbiAgICAgIHRoaXMub24oaSwgZXZlbnROYW1lW2ldLHByaW9yaXR5KVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICB2YXIgZXZlbnRzID0gZXZlbnROYW1lLnNwbGl0KFwiIFwiKTtcbiAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICBldmVudE5hbWUgPSBldmVudHNbaV07XG4gICAgdGhpcy5vYnNlcnZlKGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gICAgaWYocHJpb3JpdHkpe1xuICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0udW5zaGlmdCh0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5wb3AoKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuZmFicmljLk9ic2VydmFibGUub2ZmID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICB2YXIgZXZlbnRzID0gZXZlbnROYW1lLnNwbGl0KFwiIFwiKTtcbiAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICB0aGlzLnN0b3BPYnNlcnZpbmcoZXZlbnRzW2ldLCBoYW5kbGVyKVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuZmFicmljLk9ic2VydmFibGUuZmlyZSA9IGZ1bmN0aW9uIGZpcmUoZXZlbnROYW1lLCBvcHRpb25zKSB7XG4gIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV07XG4gIGlmIChsaXN0ZW5lcnNGb3JFdmVudCkge1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgbGlzdGVuZXJzRm9yRXZlbnRbaV0uY2FsbCh0aGlzLCBvcHRpb25zIHx8IHt9KTtcbiAgICB9XG4gIH1cblxuICB2YXIgbGlzdGVuZXJzRm9yRXZlbnRBbGwgPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbJyonXTtcbiAgaWYgKGxpc3RlbmVyc0ZvckV2ZW50QWxsKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgb3B0aW9ucy5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgb3B0aW9ucy5saXN0ZW5lcnMgPSBsaXN0ZW5lcnNGb3JFdmVudDtcbiAgICBmb3IgKGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudEFsbC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgbGlzdGVuZXJzRm9yRXZlbnRBbGxbaV0uY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIGZhYnJpYy5PYnNlcnZhYmxlKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLklUZXh0LnByb3RvdHlwZSwgZmFicmljLk9ic2VydmFibGUpO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGV4dGJveC5wcm90b3R5cGUsIGZhYnJpYy5PYnNlcnZhYmxlKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkltYWdlLnByb3RvdHlwZSwgZmFicmljLk9ic2VydmFibGUpO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwgZmFicmljLk9ic2VydmFibGUpO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMsIGZhYnJpYy5PYnNlcnZhYmxlKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9vYnNlcnZhYmxlLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaXNWTUwgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHR5cGVvZiBHX3ZtbENhbnZhc01hbmFnZXIgIT09ICd1bmRlZmluZWQnOyB9XG5cbi8vd2VpcmQgc3R1ZmZcbi8vIGRlbGV0ZSBmYWJyaWMuUmVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG4vLyBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RvcmVQcm9wZXJ0aWVzID0gW1wiKlwiLFwicnhcIixcInJ5XCJdO1xuXG5cblxuZmFicmljLk9iamVjdC5fZnJvbU9iamVjdCA9IGZ1bmN0aW9uKGNsYXNzTmFtZSwgb2JqZWN0LCBjYWxsYmFjaywgZm9yY2VBc3luYywgZXh0cmFQYXJhbSkge1xuICB2YXIga2xhc3MgPSBmYWJyaWNbY2xhc3NOYW1lXTtcbiAgdmFyIF9hcHAgPSBvYmplY3QuYXBwbGljYXRpb247XG4gIGRlbGV0ZSBvYmplY3QuYXBwbGljYXRpb247XG4gIG9iamVjdCA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShvYmplY3QsIHRydWUpO1xuICBvYmplY3QuYXBwbGljYXRpb24gPSBfYXBwO1xuICBpZiAoZm9yY2VBc3luYykge1xuICAgIGZhYnJpYy51dGlsLmVubGl2ZW5QYXR0ZXJucyhbb2JqZWN0LmZpbGwsIG9iamVjdC5zdHJva2VdLCBmdW5jdGlvbihwYXR0ZXJucykge1xuICAgICAgaWYgKHR5cGVvZiBwYXR0ZXJuc1swXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgb2JqZWN0LmZpbGwgPSBwYXR0ZXJuc1swXTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgcGF0dGVybnNbMV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIG9iamVjdC5zdHJva2UgPSBwYXR0ZXJuc1sxXTtcbiAgICAgIH1cbiAgICAgIHZhciBpbnN0YW5jZSA9IGV4dHJhUGFyYW0gPyBuZXcga2xhc3Mob2JqZWN0W2V4dHJhUGFyYW1dLCBvYmplY3QpIDogbmV3IGtsYXNzKG9iamVjdCk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhpbnN0YW5jZSk7XG4gICAgfSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdmFyIGluc3RhbmNlID0gZXh0cmFQYXJhbSA/IG5ldyBrbGFzcyhvYmplY3RbZXh0cmFQYXJhbV0sIG9iamVjdCkgOiBuZXcga2xhc3Mob2JqZWN0KTtcbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhpbnN0YW5jZSk7XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG59O1xuXG5cblxuXG5cbmZhYnJpYy5JTkNMVURFX0FMTCA9IFwiKlwiO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHN0b3JlUHJvcGVydGllczogW1widHlwZVwiXSxcbiAgZXZlbnRMaXN0ZW5lcnM6IHt9LFxuICBvcHRpb25zT3JkZXI6IFtcIipcIl0sXG4gIHNldEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMub24odmFsKTtcbiAgfSxcbiAgc2V0OiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgICAgdGhpcy5fc2V0T2JqZWN0KGtleSwgdmFsdWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmIChrZXlbMF0gPT09IFwiJlwiKSB7XG4gICAgICAgIGtleSA9IGtleS5zdWJzdHIoMSk7XG4gICAgICAgIHRoaXMuX3NldChrZXksIHZhbHVlKHRoaXMuZ2V0KGtleSkpKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBfc2V0T2JqZWN0OiBmdW5jdGlvbihvcHRpb25zLGNhbGxiYWNrKSB7XG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgICBpZih0aGlzLm9wdGlvbnNPcmRlcil7XG4gICAgICB2YXIgbWlkZGxlSW5kZXggPSB0aGlzLm9wdGlvbnNPcmRlci5pbmRleE9mKFwiKlwiKSB8fCAtMTtcblxuICAgICAgdmFyIGkgPSBtaWRkbGVJbmRleCwgcHJvcCAsIGtleUluZGV4O1xuXG4gICAgICB3aGlsZSgocHJvcCA9IHRoaXMub3B0aW9uc09yZGVyWy0taV0pKXtcbiAgICAgICAgaWYoKGtleUluZGV4ID0ga2V5cy5pbmRleE9mKHByb3ApKSAhPT0gLTEpe1xuICAgICAgICAgIGtleXMuc3BsaWNlKGtleUluZGV4LCAxKTtcbiAgICAgICAgICBrZXlzLnVuc2hpZnQocHJvcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGkgPSBtaWRkbGVJbmRleDtcbiAgICAgIHdoaWxlKHByb3AgPSB0aGlzLm9wdGlvbnNPcmRlclsrK2ldKXtcbiAgICAgICAgaWYoKGtleUluZGV4ID0ga2V5cy5pbmRleE9mKHByb3ApKSAhPT0gLTEpe1xuICAgICAgICAgIGtleXMuc3BsaWNlKGtleUluZGV4LCAxKTtcbiAgICAgICAgICBrZXlzLnB1c2gocHJvcCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH1cbiAgICAvKiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBwcm9wID0ga2V5c1tpXTtcbiAgICAgICAgaWYodHlwZW9mIG9wdGlvbnNbcHJvcF0gPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgICAgICBrZXlzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBrZXlzLnVuc2hpZnQocHJvcCk7XG4gICAgICAgIH1cbiAgICAgIH0qL1xuICAgIHZhciBxdWV1ZTtcbiAgICBmb3IgKHZhciBpIGluIGtleXMpIHtcbiAgICAgIHZhciBfa2V5ID0ga2V5c1tpXTtcbiAgICAgIGlmKG9wdGlvbnNbX2tleV0gPT09IHVuZGVmaW5lZCApY29udGludWU7XG5cbiAgICAgIHZhciBfZm9vTmFtZSA9IFwic2V0XCIgKyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShfa2V5LCB0cnVlKTtcbiAgICAgIGlmKHRoaXNbX2Zvb05hbWVdICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgJiYgdGhpc1tfZm9vTmFtZV0ubmFtZSAhPSBcImFub255bW91c1wiKXtcbiAgICAgICAgaWYodGhpc1tfZm9vTmFtZV0ubGVuZ3RoID09IDIpe1xuICAgICAgICAgIGlmKCFxdWV1ZSl7XG4gICAgICAgICAgICBxdWV1ZSA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZCgyLGNhbGxiYWNrKTtcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHF1ZXVlLnRvdGFsICsrO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzW19mb29OYW1lXShvcHRpb25zW19rZXldLGZ1bmN0aW9uKF9rZXkpe1xuICAgICAgICAgICAgcXVldWUoKTtcbiAgICAgICAgICB9LmJpbmQodGhpcyxfa2V5KSk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXNbX2Zvb05hbWVdKG9wdGlvbnNbX2tleV0pXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX19zZXQoX2tleSwgb3B0aW9uc1tfa2V5XSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHF1ZXVlKXtcbiAgICAgIHF1ZXVlKClcbiAgICB9ZWxzZSBpZihjYWxsYmFjayApe1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gIH0sXG4gIF9fc2V0IDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldCxcbiAgX3NldDogZnVuY3Rpb24gKGtleSwgdmFsdWUgLGNhbGxiYWNrKSB7XG4gICAgdmFyIF9mb29OYW1lID0gXCJzZXRcIiArIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGtleSwgdHJ1ZSk7XG4gICAgaWYodGhpc1tfZm9vTmFtZV0gICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgJiYgdGhpc1tfZm9vTmFtZV0ubmFtZSAhPSBcImFub255bW91c1wiKXtcbiAgICAgIC8vIGlmICh0aGlzLnNwZWNpYWxQcm9wZXJ0aWVzLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgIC8vIGlmKHRoaXNbX2Zvb05hbWVdKXtcbiAgICAgIHRoaXNbX2Zvb05hbWVdKHZhbHVlLGNhbGxiYWNrKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX19zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBzZXRBbmdsZTogZnVuY3Rpb24oYW5nbGUpIHtcbiAgICB0aGlzLmFuZ2xlID0gYW5nbGU7XG4gIH0sXG4gIHNldFNoYWRvdzogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnNoYWRvdyA9IG9wdGlvbnMgPyBuZXcgZmFicmljLlNoYWRvdyhvcHRpb25zKSA6IG51bGw7XG4gIH0sXG4gIGRpc2FibGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNldCh7XG4gICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgaGFzQ29udHJvbHM6IGZhbHNlLFxuICAgICAgbG9ja01vdmVtZW50WDogdHJ1ZSxcbiAgICAgIGxvY2tNb3ZlbWVudFk6IHRydWVcbiAgICB9KTtcbiAgfSxcbiAgc3RvcmVkOiB0cnVlLFxuICBzdG9yZV9sZWZ0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5sZWZ0LCBmYWJyaWMuT2JqZWN0Lk5VTV9GUkFDVElPTl9ESUdJVFMpO1xuICB9LFxuICBzdG9yZV90b3A6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwudG9GaXhlZCh0aGlzLnRvcCwgZmFicmljLk9iamVjdC5OVU1fRlJBQ1RJT05fRElHSVRTKTtcbiAgfSxcbiAgc3RvcmVfd2lkdGg6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwudG9GaXhlZCh0aGlzLndpZHRoLCBmYWJyaWMuT2JqZWN0Lk5VTV9GUkFDVElPTl9ESUdJVFMpO1xuICB9LFxuICBzdG9yZV9oZWlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwudG9GaXhlZCh0aGlzLmhlaWdodCwgZmFicmljLk9iamVjdC5OVU1fRlJBQ1RJT05fRElHSVRTKTtcbiAgfSxcbiAgc3RvcmVfZmlsbDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAodGhpcy5maWxsICYmIHRoaXMuZmlsbC50b09iamVjdCkgPyB0aGlzLmZpbGwudG9PYmplY3QoKSA6IHRoaXMuZmlsbDtcbiAgfSxcbiAgc3RvcmVfc3Ryb2tlOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICh0aGlzLnN0cm9rZSAmJiB0aGlzLnN0cm9rZS50b09iamVjdCkgPyB0aGlzLnN0cm9rZS50b09iamVjdCgpIDogdGhpcy5zdHJva2U7XG4gIH0sXG4gIHN0b3JlX3N0cm9rZVdpZHRoOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5zdHJva2VXaWR0aCwgZmFicmljLk9iamVjdC5OVU1fRlJBQ1RJT05fRElHSVRTKVxuICB9LFxuICBzdG9yZV9zdHJva2VEYXNoQXJyYXk6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5zdHJva2VEYXNoQXJyYXkgPyB0aGlzLnN0cm9rZURhc2hBcnJheS5jb25jYXQoKSA6IHRoaXMuc3Ryb2tlRGFzaEFycmF5XG4gIH0sXG4gIHN0b3JlX3N0cm9rZU1pdGVyTGltaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwudG9GaXhlZCh0aGlzLnN0cm9rZU1pdGVyTGltaXQsIGZhYnJpYy5PYmplY3QuTlVNX0ZSQUNUSU9OX0RJR0lUUylcbiAgfSxcbiAgc3RvcmVfc2NhbGVYOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5zY2FsZVgsIGZhYnJpYy5PYmplY3QuTlVNX0ZSQUNUSU9OX0RJR0lUUylcbiAgfSxcbiAgc3RvcmVfc2NhbGVZOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5zY2FsZVksIGZhYnJpYy5PYmplY3QuTlVNX0ZSQUNUSU9OX0RJR0lUUylcbiAgfSxcbiAgc3RvcmVfYW5nbGU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwudG9GaXhlZCh0aGlzLmdldEFuZ2xlKCksIGZhYnJpYy5PYmplY3QuTlVNX0ZSQUNUSU9OX0RJR0lUUylcbiAgfSxcbiAgc3RvcmVfb3BhY2l0eTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBmYWJyaWMudXRpbC50b0ZpeGVkKHRoaXMub3BhY2l0eSwgZmFicmljLk9iamVjdC5OVU1fRlJBQ1RJT05fRElHSVRTKVxuICB9LFxuICBzdG9yZV9zaGFkb3c6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gKHRoaXMuc2hhZG93ICYmIHRoaXMuc2hhZG93LnRvT2JqZWN0KSA/IHRoaXMuc2hhZG93LnRvT2JqZWN0KCkgOiB0aGlzLnNoYWRvd1xuICB9LFxuICBzdG9yZV9jbGlwVG86IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5jbGlwVG8gJiYgKHRoaXMuY2xpcFRvLmlkICYmICcjJyArIHRoaXMuY2xpcFRvLmlkIHx8IHRoaXMuY2xpcFRvKSB8fCBudWxsO1xuICB9LFxuICBzdG9yZV90cmFuc2Zvcm1NYXRyaXg6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2Zvcm1NYXRyaXggPyB0aGlzLnRyYW5zZm9ybU1hdHJpeC5jb25jYXQoKSA6IG51bGxcbiAgfSxcbiAgc3RvcmVfc2tld1g6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwudG9GaXhlZCh0aGlzLnNrZXdYLCBmYWJyaWMuT2JqZWN0Lk5VTV9GUkFDVElPTl9ESUdJVFMpXG4gIH0sXG4gIHN0b3JlX3NrZXdZOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5za2V3WSwgZmFicmljLk9iamVjdC5OVU1fRlJBQ1RJT05fRElHSVRTKVxuICB9LFxuXG4gIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSAocHJvcGVydGllc1RvSW5jbHVkZSB8fCBbXSkuY29uY2F0KHRoaXMuc3RvcmVQcm9wZXJ0aWVzKS5jb25jYXQodGhpcy5zdGF0ZVByb3BlcnRpZXMpO1xuICAgIGxldCBvYmplY3QgPSB0aGlzLmdldFByb3BlcnRpZXMocHJvcGVydGllc1RvSW5jbHVkZSk7XG4gICAgaWYgKCF0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzKSB7XG4gICAgICBvYmplY3QgPSB0aGlzLl9yZW1vdmVEZWZhdWx0VmFsdWVzKG9iamVjdCx0aGlzLnR5cGUpO1xuICAgIH1cbiAgICB0aGlzLmZpcmUoXCJiZWZvcmU6b2JqZWN0XCIsIHtvYmplY3Q6IG9iamVjdH0pO1xuICAgIHJldHVybiBvYmplY3Q7XG4gIH0sXG4gIC8qKlxuICAgKiBTZXRzIG9iamVjdCdzIHByb3BlcnRpZXMgZnJvbSBvcHRpb25zXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3RcbiAgICovXG4gIHNldE9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdGhpcy5fc2V0T2JqZWN0KG9wdGlvbnMpO1xuICAgIC8vIHRoaXMuX2luaXRHcmFkaWVudChvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0UGF0dGVybihvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0Q2xpcHBpbmcob3B0aW9ucyk7XG4gIH0sXG4gIF9pbml0RW50aXR5OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIGlmKG9wdGlvbnMuY2FudmFzICYmICFvcHRpb25zLmFwcGxpY2F0aW9uKXtcbiAgICAgIG9wdGlvbnMuYXBwbGljYXRpb24gPSBvcHRpb25zLmNhbnZhcy5hcHBsaWNhdGlvbjtcbiAgICB9XG4gICAgb3B0aW9ucy5hcHBsaWNhdGlvbiAmJiBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoXCJlbnRpdHk6Y3JlYXRlZFwiLCB7dGFyZ2V0OiB0aGlzLCBvcHRpb25zOiBvcHRpb25zfSk7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHRoaXMuX2luaXRFbnRpdHkob3B0aW9ucyk7XG4gICAgLy8gaWYob3B0aW9ucy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAvLyAgIHZhciBjb29yZGluYXRlcyA9IFtcImxlZnRcIixcInRvcFwiLFwid2lkdGhcIixcImhlaWdodFwiXTtcbiAgICAvLyAgIGZvcih2YXIgaSBpbiBjb29yZGluYXRlcyl7XG4gICAgLy8gICAgIGlmKG9wdGlvbnNbY29vcmRpbmF0ZXNbaV1dKXtcbiAgICAvLyAgICAgICBvcHRpb25zW2Nvb3JkaW5hdGVzW2ldXSA9IE1hdGgucm91bmQob3B0aW9uc1tjb29yZGluYXRlc1tpXV0pO1xuICAgIC8vICAgICB9XG4gICAgLy8gICB9XG4gICAgLy8gfVxuICAgIHZhciBfc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5fc2V0T2JqZWN0KG9wdGlvbnMsIGZ1bmN0aW9uICgpIHtcbiAgICAgIF9zZWxmLmxvYWRlZCA9IHRydWU7XG4gICAgICBfc2VsZi5maXJlKFwibG9hZGVkXCIpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soX3NlbGYpO1xuICAgIH0pO1xuICB9LFxuICBhZGQ6IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICBjYW52YXMuYWRkKHRoaXMpO1xuICB9LFxuICBoYXNCb3VuZHNDb250cm9sczogdHJ1ZSxcbiAgc3Ryb2tlOiBcInRyYW5zcGFyZW50XCIsXG4gIHN0ZXBSb3RhdGluZzogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGIgPSB0aGlzLmdldEFuZ2xlKCksIGEgPSA0NSAqIHBhcnNlSW50KGIgLyA0NSk7XG4gICAgNSA+IGIgLSBhID8gdGhpcy5zZXRBbmdsZShhKSA6IDQwIDwgYiAtIGEgJiYgdGhpcy5zZXRBbmdsZShhICsgNDUpO1xuICB9LFxuICBvblRvcDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09IHRoaXMuY2FudmFzLl9vYmplY3RzLmxlbmd0aCAtIDE7XG4gIH0sXG4gIG9uQm90dG9tOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FudmFzLl9vYmplY3RzLmluZGV4T2YodGhpcykgPT0gMDtcbiAgfSxcbiAgZmxvcDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmxpcFkgPSAhdGhpcy5mbGlwWTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgZmxpcDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmxpcFggPSAhdGhpcy5mbGlwWDtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgZHVwbGljYXRlOiBmdW5jdGlvbigpIHtcbiAgICAvLyB2YXIgX2luY2x1ZGVEZWZhdWx0VmFsdWVzID0gdGhpcy5pbmNsdWRlRGVmYXVsdFZhbHVlcztcbiAgICAvLyB0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzID0gdHJ1ZTtcbiAgICB2YXIgX29iamVjdCA9IHRoaXMudG9PYmplY3QoKTtcbiAgICAvLyB0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzID0gX2luY2x1ZGVEZWZhdWx0VmFsdWVzO1xuICAgIF9vYmplY3QuYWN0aXZlID0gdHJ1ZTtcbiAgICBfb2JqZWN0LmxlZnQrPTEwO1xuICAgIF9vYmplY3QudG9wKz0xMDtcbiAgICB2YXIgX2Nsb25lID0gLyp0aGlzLmNsb25lU3luYyAmJiB0aGlzLmNsb25lU3luYygpIHx8ICovdGhpcy5jYW52YXMuY3JlYXRlT2JqZWN0KF9vYmplY3QpO1xuICAgIHJldHVybiBfY2xvbmU7XG4gIH0sXG4gIF9ub3JtYWxpemVBbmdsZTpmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuYW5nbGUgPCAwKXtcbiAgICAgIHRoaXMuYW5nbGUgKz0gMzYwO1xuICAgIH1lbHNlIGlmKHRoaXMuYW5nbGUgPiAzNjApe1xuICAgICAgdGhpcy5hbmdsZSAlPSAzNjA7XG4gICAgfVxuICB9LFxuICBtaW5TdHJva2VXaWR0aDogMCxcbiAgbWF4U3Ryb2tlV2lkdGg6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIE1hdGgubWluKHRoaXMud2lkdGgsdGhpcy5oZWlnaHQpIC8gMjtcbiAgfSxcbiAgbW92ZW1lbnREZWx0YTogMSxcbiAgbW92ZVVwOiBmdW5jdGlvbigpe1xuICAgIHRoaXMudG9wIC09IHRoaXMubW92ZW1lbnREZWx0YTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgbW92ZURvd246IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy50b3AgKz0gdGhpcy5tb3ZlbWVudERlbHRhO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBtb3ZlTGVmdDogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmxlZnQgLT0gdGhpcy5tb3ZlbWVudERlbHRhO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBtb3ZlUmlnaHQ6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5sZWZ0ICs9IHRoaXMubW92ZW1lbnREZWx0YTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL29iamVjdC5leHQuanMiLCJcbnJlcXVpcmUoXCIuLi9taXhpbnMvaW1hZ2VNaXhpblwiKTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLGZhYnJpYy5JbWFnZU1peGluLCB7XG4gIGZpbHRlcnM6IG51bGwsXG4gIHJlc2l6ZUZpbHRlcnM6IG51bGwsXG4gIG9yaWdpbmFsU3JjOiBudWxsLFxuICBzdG9yZVByb3BlcnRpZXM6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0b3JlUHJvcGVydGllcy5jb25jYXQoW1wiZmlsdGVyc1wiLFwicmVzaXplRmlsdGVyc1wiLFwib3JpZ2luYWxTcmNcIixcInNyY1wiLFwiY29udGVudE9mZnNldHNcIl0pLFxuICBzdG9yZV9vcmlnaW5hbFNyYzogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLl9lZGl0ZWQgPyAodGhpcy5fb3JpZ2luYWxfc3JjIHx8IHRoaXMuX29yaWdpbmFsRWxlbWVudC5zcmMgfHwgdGhpcy5fZWxlbWVudC5zcmMpIDogbnVsbDtcbiAgfSxcbiAgc3RvcmVfc3JjOiBmdW5jdGlvbigpe1xuICAgIGxldCBzcmM7XG4gICAgaWYgKHRoaXMuX2VkaXRlZCkge1xuICAgICAgc3JjID0gdGhpcy5fZWxlbWVudC5zcmM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNyYyA9IHRoaXMuX29yaWdpbmFsX3NyYyB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQuc3JjIHx8IHRoaXMuX2VsZW1lbnQuc3JjO1xuICAgIH1cbiAgICBpZihzcmMuaW5kZXhPZihmYWJyaWMudXRpbC5tZWRpYVJvb3QpID09PSAwKXtcbiAgICAgIHNyYyA9IHNyYy5yZXBsYWNlKGZhYnJpYy51dGlsLm1lZGlhUm9vdCxcIlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHNyYztcbiAgfSxcbiAgc3RvcmVfZmlsdGVyczogZnVuY3Rpb24oKXtcbiAgICB2YXIgZmlsdGVycyA9IFtdO1xuICAgIHZhciBzY2FsZVggPSAxLCBzY2FsZVkgPSAxO1xuICAgIHRoaXMuZmlsdGVycy5mb3JFYWNoKGZ1bmN0aW9uKGZpbHRlck9iaikge1xuICAgICAgaWYgKGZpbHRlck9iaikge1xuICAgICAgICBpZiAoZmlsdGVyT2JqLnR5cGUgPT09ICdSZXNpemUnKSB7XG4gICAgICAgICAgc2NhbGVYICo9IGZpbHRlck9iai5zY2FsZVg7XG4gICAgICAgICAgc2NhbGVZICo9IGZpbHRlck9iai5zY2FsZVk7XG4gICAgICAgIH1cbiAgICAgICAgZmlsdGVycy5wdXNoKGZpbHRlck9iai50b09iamVjdCgpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gZmlsdGVycy5sZW5ndGggJiYgZmlsdGVycyB8fCBudWxsO1xuICB9LFxuICBzdG9yZV9yZXNpemVGaWx0ZXJzOiBmdW5jdGlvbigpe1xuICAgIHZhciByZXNpemVGaWx0ZXJzID0gW107XG4gICAgdGhpcy5yZXNpemVGaWx0ZXJzLmZvckVhY2goZnVuY3Rpb24oZmlsdGVyT2JqKSB7XG4gICAgICBmaWx0ZXJPYmogJiYgcmVzaXplRmlsdGVycy5wdXNoKGZpbHRlck9iai50b09iamVjdCgpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzaXplRmlsdGVycy5sZW5ndGggJiYgcmVzaXplRmlsdGVycyB8fCBudWxsO1xuICB9LFxuICBzZXRTcmM6IGZ1bmN0aW9uIChvcHQpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhvcHQpO1xuICB9LFxuICB0b09iamVjdDogZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3QsXG4gIC8vICAgdmFyIG9iaiA9IHRoaXMuX3RvT2JqZWN0TmF0aXZlLmNhbGwodGhpcywgdG9JbmNsdWRlKTtcbiAgLy9cbiAgLy9cbiAgLy8gICAvLyBpZiAodGhpcy5jb250ZW50T2Zmc2V0cykge1xuICAvLyAgIC8vICAgb2JqLmNvbnRlbnRPZmZzZXRzID0gdGhpcy5jb250ZW50T2Zmc2V0cztcbiAgLy8gICAvLyB9XG4gIC8vICAgLy8gLy9cbiAgLy8gICAvLyBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgLy8gICAvLyAgIGlmICghb2JqLmZpbHRlcnMubGVuZ3RoKSBkZWxldGUgb2JqLmZpbHRlcnM7XG4gIC8vICAgLy8gICBpZiAoIW9iai5yZXNpemVGaWx0ZXJzLmxlbmd0aCkgZGVsZXRlIG9iai5yZXNpemVGaWx0ZXJzO1xuICAvLyAgIC8vIH1cbiAgLy8gICAvL2lmKHRoaXMuX29yaWdpbmFsRWxlbWVudCl7XG4gIC8vICAgLy8gICAgb2JqLnRodW1iID0gdGhpcy5fZWxlbWVudC5zcmM7XG4gIC8vICAgLy99XG4gIC8vXG4gIC8vICAgdGhpcy5fYmVmb3JlT2JqZWN0KG9iaix0b0luY2x1ZGUpO1xuICAvLyAgIHJldHVybiBvYmo7XG4gIC8vIH0sXG4gIGFzeW5jOiB0cnVlLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuICAgIHRoaXMuZmlsdGVycyA9IFtdO1xuICAgIHRoaXMucmVzaXplRmlsdGVycyA9IFtdO1xuXG4gICAgaWYgKG9wdGlvbnMub3JpZ2luYWxTcmMpIHtcbiAgICAgIHRoaXMuX2VkaXRlZCA9IHRydWU7XG4gICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2Uob3B0aW9ucy5vcmlnaW5hbFNyYywgZnVuY3Rpb24gKGltZykge1xuICAgICAgICB0aGlzLl9vcmlnaW5hbEVsZW1lbnQgPSBpbWc7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIHRoaXMuX2luaXRFbGVtZW50KGVsZW1lbnQsIG9wdGlvbnMsIGNhbGxiYWNrICYmIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZmFicmljLk9iamVjdC5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7Ly9hZGRpbmcgY2FsbGJhY2tcbiAgfSxcblxuICBfaW5pdEVsZW1lbnQ6IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHRoaXMuc2V0RWxlbWVudChmYWJyaWMudXRpbC5nZXRCeUlkKGVsZW1lbnQpLCBjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgZmFicmljLnV0aWwuYWRkQ2xhc3ModGhpcy5nZXRFbGVtZW50KCksIGZhYnJpYy5JbWFnZS5DU1NfQ0FOVkFTKTtcbiAgfSxcbiAgLyoqXG4gICAqIFNldHMgY3Jvc3NPcmlnaW4gdmFsdWUgKG9uIGFuIGluc3RhbmNlIGFuZCBjb3JyZXNwb25kaW5nIGltYWdlIGVsZW1lbnQpXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5JbWFnZX0gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICBzZXRDcm9zc09yaWdpbjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5jcm9zc09yaWdpbiA9IHZhbHVlO1xuICAgIGlmICh0aGlzLl9lbGVtZW50KSB7XG4gICAgICB0aGlzLl9lbGVtZW50LmNyb3NzT3JpZ2luID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBzZXRFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgY2FsbGJhY2ssIG9wdGlvbnMpIHtcblxuICAgIHZhciBfY2FsbGJhY2ssIF90aGlzO1xuXG4gICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLl9pbml0Q29uZmlnKG9wdGlvbnMpO1xuICAgIC8vIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zICk7XG4gICAgLy8gdGhpcy5fc2V0V2lkdGhIZWlnaHQodGhpcyk7XG4gICAgLy8gaWYgKHRoaXMuX2VsZW1lbnQgJiYgdGhpcy5jcm9zc09yaWdpbikge1xuICAgIC8vICAgdGhpcy5fZWxlbWVudC5jcm9zc09yaWdpbiA9IHRoaXMuY3Jvc3NPcmlnaW47XG4gICAgLy8gfVxuXG5cbiAgICBpZiAodGhpcy5yZXNpemVGaWx0ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgX2NhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgX3RoaXMgPSB0aGlzO1xuICAgICAgX2NhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5hcHBseUZpbHRlcnMoY2FsbGJhY2ssIF90aGlzLnJlc2l6ZUZpbHRlcnMsIF90aGlzLl9maWx0ZXJlZEVsIHx8IF90aGlzLl9vcmlnaW5hbEVsZW1lbnQsIHRydWUpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5maWx0ZXJzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgdGhpcy5hcHBseUZpbHRlcnMoX2NhbGxiYWNrKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoX2NhbGxiYWNrKSB7XG4gICAgICBfY2FsbGJhY2sodGhpcyk7XG4gICAgfVxuICAgIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgY2xvbmVTeW5jOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlKHRoaXMuX2VsZW1lbnQsIHRoaXMpXG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5pbml0RmlsdGVycyA9IGZ1bmN0aW9uIChpbWcsIG9iamVjdCwgY2FsbGJhY2spIHtcblxuICAvLyBpZiAoZmFicmljLnZlcnNpb24gPj0gMS42KSB7XG5cblxuICBmb3IodmFyIGkgaW4gb2JqZWN0LmZpbHRlcnMpe1xuICAgIG9iamVjdC5maWx0ZXJzW2ldLnR5cGUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUob2JqZWN0LmZpbHRlcnNbaV0udHlwZSksdHJ1ZSk7XG4gIH1cblxuICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9pbml0RmlsdGVycy5jYWxsKG9iamVjdCwgb2JqZWN0LmZpbHRlcnMsIGZ1bmN0aW9uIChmaWx0ZXJzKSB7XG4gICAgb2JqZWN0LmZpbHRlcnMgPSBmaWx0ZXJzIHx8IFtdO1xuICAgIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX2luaXRGaWx0ZXJzLmNhbGwob2JqZWN0LCBvYmplY3QucmVzaXplRmlsdGVycywgZnVuY3Rpb24gKHJlc2l6ZUZpbHRlcnMpIHtcbiAgICAgIG9iamVjdC5yZXNpemVGaWx0ZXJzID0gcmVzaXplRmlsdGVycyB8fCBbXTtcbiAgICAgIGNhbGxiYWNrKGltZywgb2JqZWN0KTtcbiAgICB9KTtcbiAgfSk7XG4gIC8vIH0gZWxzZSB7XG4gIC8vICAgZmFicmljLkltYWdlLnByb3RvdHlwZS5faW5pdEZpbHRlcnMuY2FsbChvYmplY3QsIG9iamVjdCwgZnVuY3Rpb24gKGZpbHRlcnMpIHtcbiAgLy8gICAgIG9iamVjdC5maWx0ZXJzID0gZmlsdGVycyB8fCBbXTtcbiAgLy8gICAgIGNhbGxiYWNrKGltZywgb2JqZWN0KTtcbiAgLy8gICB9KTtcbiAgLy8gfVxufTtcblxuZmFicmljLnV0aWwuaW5pdEltYWdlQW5kRmlsdGVycyA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gIGlmIChvYmplY3QuaW1hZ2UpIHtcbiAgICB2YXIgaW1nID0gb2JqZWN0LmltYWdlO1xuICAgIGRlbGV0ZSBvYmplY3Quc3JjO1xuICAgIGRlbGV0ZSBvYmplY3QuaW1hZ2U7XG4gICAgZmFicmljLnV0aWwuaW5pdEZpbHRlcnMoaW1nLCBvYmplY3QsIGNhbGxiYWNrKTtcbiAgfWVsc2UgaWYgKG9iamVjdC5zcmMpIHtcbiAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2Uob2JqZWN0LnNyYywgZnVuY3Rpb24gKGltZykge1xuICAgICAgLy9kZWxldGUgb2JqZWN0LnNyYztcbiAgICAgIGZhYnJpYy51dGlsLmluaXRGaWx0ZXJzKGltZywgb2JqZWN0LCBjYWxsYmFjayk7XG4gICAgfSwgbnVsbCwgb2JqZWN0LmNyb3NzT3JpZ2luKTtcbiAgfSBlbHNlIHtcbiAgICBmYWJyaWMudXRpbC5pbml0RmlsdGVycyhudWxsLCBvYmplY3QsIGNhbGxiYWNrKTtcbiAgfVxufTtcblxuZmFicmljLkltYWdlLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICBmYWJyaWMudXRpbC5pbml0SW1hZ2VBbmRGaWx0ZXJzKG9iamVjdCwgZnVuY3Rpb24gKGltZywgb2JqZWN0KSB7XG4gICAgbmV3IGZhYnJpYy5JbWFnZShpbWcsIG9iamVjdCwgY2FsbGJhY2spO1xuICB9KVxufTtcblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL2ltYWdlLmV4dC5qcyIsImZhYnJpYy5JbWFnZU1peGluID0ge1xuICBzZXRFbGVtZW50RnJvbU1lbnUgOiBmdW5jdGlvbihkYXRhKXtcbiAgICB0aGlzLnNldEVsZW1lbnQoZGF0YS5pbWFnZSlcbiAgfSxcbiAgaW5pdFByb3BvcnRpbmFsU2l6ZSA6IHRydWUsXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9iamVjdCB3aXRoIHdpZHRoL2hlaWdodCBwcm9wZXJ0aWVzXG4gICAqL1xuICBfc2V0V2lkdGhIZWlnaHQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICBpZih0aGlzLmVsZW1lbnQgfHwgdGhpcy5fZWxlbWVudCl7XG4gICAgICB2YXIgX3NpemUgPSB0aGlzLmdldE9yaWdpbmFsU2l6ZSgpO1xuICAgIH1lbHNle1xuICAgICAgX3NpemUgPSB7fTtcbiAgICB9XG4gICAgaWYoJ3dpZHRoJyBpbiBvcHRpb25zKXtcbiAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgIH1lbHNle1xuICAgICAgaWYoIV9zaXplLndpZHRoKXtcbiAgICAgICAgdGhpcy53aWR0aCA9IDEwMDtcbiAgICAgIH1lbHNle1xuICAgICAgICBpZih0aGlzLmluaXRQcm9wb3J0aW5hbFNpemUgJiYgJ2hlaWdodCcgaW4gb3B0aW9ucyl7XG4gICAgICAgICAgdGhpcy53aWR0aCA9IChvcHRpb25zLmhlaWdodCAgLyBfc2l6ZS5oZWlnaHQgKSAqIF9zaXplLndpZHRoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMud2lkdGggPSBfc2l6ZS53aWR0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmKCdoZWlnaHQnIGluIG9wdGlvbnMpe1xuICAgICAgdGhpcy5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICB9ZWxzZXtcbiAgICAgIGlmKCFfc2l6ZS5oZWlnaHQpe1xuICAgICAgICB0aGlzLmhlaWdodCA9IDEwMDtcbiAgICAgIH1lbHNle1xuICAgICAgICBpZih0aGlzLmluaXRQcm9wb3J0aW5hbFNpemUgJiYgJ3dpZHRoJyBpbiBvcHRpb25zKXtcbiAgICAgICAgICB0aGlzLmhlaWdodCA9IChvcHRpb25zLndpZHRoICAvIF9zaXplLndpZHRoICkgKiBfc2l6ZS5oZWlnaHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5oZWlnaHQgPSBfc2l6ZS5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21peGlucy9pbWFnZU1peGluLmpzIiwiXG52YXIgX3NldF9kaW1lbnNpb25zX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc2V0RGltZW5zaW9ucztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBvcHRpb25zT3JkZXI6IFtdLFxuICBfX3NldCA6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9fc2V0LFxuICBfc2V0IDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldCxcbiAgX3NldE9iamVjdDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldE9iamVjdCxcbiAgZ2V0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5nZXQsXG4gIHNldDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICBsYXllcjogXCJvYmplY3RzXCJcbn0pO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuLy8gIG9wdGlvbnNPcmRlcjogW1wiKlwiXSxcbiAgb3JpZ2luYWxTdGF0ZToge30sXG4gIHN0YXRlUHJvcGVydGllczogW10sXG4gIGVkaXRpbmdPYmplY3Q6IG51bGwsXG4gIC8qKlxuICAgKiBTZWxlY3Qgb2JqZWN0IHdoaWNoIGlzIG92ZXIgdGhlIHNlbGVjdGVkIG9uZVxuICAgKi9cbiAgZnJvbnRPYmplY3RzU2VsZWN0aW9uUHJpb3JpdHk6IGZhbHNlLFxuICAvKipcbiAgICogTWV0aG9kIHRoYXQgZGV0ZXJtaW5lcyB3aGF0IG9iamVjdCB3ZSBhcmUgY2xpY2tpbmcgb25cbiAgICogdGhlIHNraXBHcm91cCBwYXJhbWV0ZXIgaXMgZm9yIGludGVybmFsIHVzZSwgaXMgbmVlZGVkIGZvciBzaGlmdCtjbGljayBhY3Rpb25cbiAgICogQHBhcmFtIHtFdmVudH0gZSBtb3VzZSBldmVudFxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IHNraXBHcm91cCB3aGVuIHRydWUsIGFjdGl2ZUdyb3VwIGlzIHNraXBwZWQgYW5kIG9ubHkgb2JqZWN0cyBhcmUgdHJhdmVyc2VkIHRocm91Z2hcbiAgICovXG4gIGZpbmRUYXJnZXQ6IGZ1bmN0aW9uIChlLCBza2lwR3JvdXApIHtcbiAgICBpZiAodGhpcy5za2lwVGFyZ2V0RmluZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgaWdub3JlWm9vbSA9IHRydWUsXG4gICAgICBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUsIGlnbm9yZVpvb20pLFxuICAgICAgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZU9iamVjdCgpLFxuICAgICAgYWN0aXZlVGFyZ2V0LCBhY3RpdmVUYXJnZXRTdWJzO1xuICAgIC8vIGZpcnN0IGNoZWNrIGN1cnJlbnQgZ3JvdXAgKGlmIG9uZSBleGlzdHMpXG4gICAgLy8gYWN0aXZlIGdyb3VwIGRvZXMgbm90IGNoZWNrIHN1YiB0YXJnZXRzIGxpa2Ugbm9ybWFsIGdyb3Vwcy5cbiAgICAvLyBpZiBhY3RpdmUgZ3JvdXAganVzdCBleGl0cy5cbiAgICB0aGlzLnRhcmdldHMgPSBbXTtcbiAgICBpZiAoYWN0aXZlR3JvdXAgJiYgIXNraXBHcm91cCAmJiBhY3RpdmVHcm91cCA9PT0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKFthY3RpdmVHcm91cF0sIHBvaW50ZXIpKSB7XG4gICAgICB0aGlzLl9maXJlT3Zlck91dEV2ZW50cyhhY3RpdmVHcm91cCwgZSk7XG4gICAgICByZXR1cm4gYWN0aXZlR3JvdXA7XG4gICAgfVxuICAgIC8vIGlmIHdlIGhpdCB0aGUgY29ybmVyIG9mIGFuIGFjdGl2ZU9iamVjdCwgbGV0J3MgcmV0dXJuIHRoYXQuXG4gICAgaWYgKGFjdGl2ZU9iamVjdCAmJiBhY3RpdmVPYmplY3QuX2ZpbmRUYXJnZXRDb3JuZXIocG9pbnRlcikpIHtcbiAgICAgIHRoaXMuX2ZpcmVPdmVyT3V0RXZlbnRzKGFjdGl2ZU9iamVjdCwgZSk7XG4gICAgICByZXR1cm4gYWN0aXZlT2JqZWN0O1xuICAgIH1cblxuICAgIGlmICghdGhpcy5mcm9udE9iamVjdHNTZWxlY3Rpb25Qcmlvcml0eSAmJiBhY3RpdmVPYmplY3QgJiYgYWN0aXZlT2JqZWN0ID09PSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHMoW2FjdGl2ZU9iamVjdF0sIHBvaW50ZXIpKSB7XG4gICAgICBpZiAoIXRoaXMucHJlc2VydmVPYmplY3RTdGFja2luZykge1xuICAgICAgICB0aGlzLl9maXJlT3Zlck91dEV2ZW50cyhhY3RpdmVPYmplY3QsIGUpO1xuICAgICAgICByZXR1cm4gYWN0aXZlT2JqZWN0O1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGFjdGl2ZVRhcmdldCA9IGFjdGl2ZU9iamVjdDtcbiAgICAgICAgYWN0aXZlVGFyZ2V0U3VicyA9IHRoaXMudGFyZ2V0cztcbiAgICAgICAgdGhpcy50YXJnZXRzID0gW107XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHRhcmdldCA9IHRoaXMuX3NlYXJjaFBvc3NpYmxlVGFyZ2V0cyh0aGlzLl9vYmplY3RzLCBwb2ludGVyKTtcbiAgICBpZiAoZVt0aGlzLmFsdFNlbGVjdGlvbktleV0gJiYgdGFyZ2V0ICYmIGFjdGl2ZVRhcmdldCAmJiB0YXJnZXQgIT09IGFjdGl2ZVRhcmdldCkge1xuICAgICAgdGFyZ2V0ID0gYWN0aXZlVGFyZ2V0O1xuICAgICAgdGhpcy50YXJnZXRzID0gYWN0aXZlVGFyZ2V0U3VicztcbiAgICB9XG4gICAgdGhpcy5fZmlyZU92ZXJPdXRFdmVudHModGFyZ2V0LCBlKTtcbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9LFxuICBzZXREaW1lbnNpb25zOiBmdW5jdGlvbiAoZGltZW5zaW9ucywgb3B0aW9ucykge1xuICAgIF9zZXRfZGltZW5zaW9uc19vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGRpbWVuc2lvbnMsIG9wdGlvbnMpO1xuXG4gICAgaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2UgJiYgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuY29uc3RydWN0b3IgIT09IFN0cmluZyl7XG4gICAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9vdmVybGF5X2ltYWdlKFwiYmFja2dyb3VuZFwiKTtcbiAgICB9XG4gICAgaWYodGhpcy5vdmVybGF5SW1hZ2UgJiYgdGhpcy5vdmVybGF5SW1hZ2UuY29uc3RydWN0b3IgIT09IFN0cmluZyl7XG4gICAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9vdmVybGF5X2ltYWdlKFwib3ZlcmxheVwiKTtcbiAgICB9XG4gICAgLy90aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG4gICAgdGhpcy5maXJlKFwiZGltZW5zaW9uczptb2RpZmllZFwiKTtcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9XG59KTtcblxudmFyIEV4dENhbnZhc01peGluID0ge1xuICBvYmplY3RzOiBudWxsLFxuICAvLyBkZWZhdWx0T3B0aW9uczoge30sXG4gIGFuaW1hdGVkOiBmYWxzZSxcbiAgZml0SW5kZXg6IDAuOCxcbiAgb3JpZ2luYWxXaWR0aDogMCxcbiAgb3JpZ2luYWxIZWlnaHQ6IDAsXG4gIC8qKlxuICAgKiByZXF1aXJlZCB0byBzaG93IHZpZGVvXG4gICAqL1xuICBzZXRBbmltYXRlZDogZnVuY3Rpb24gKHZhbCkge1xuICAgIGlmKCF2YWwpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZhYnJpYy51dGlsLnJlcXVlc3RBbmltRnJhbWUoZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgIGZhYnJpYy51dGlsLnJlcXVlc3RBbmltRnJhbWUocmVuZGVyKTtcbiAgICB9LmJpbmQodGhpcykpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEaXZpZGVzIG9iamVjdHMgaW4gdHdvIGdyb3Vwcywgb25lIHRvIHJlbmRlciBpbW1lZGlhdGVseVxuICAgKiBhbmQgb25lIHRvIHJlbmRlciBhcyBhY3RpdmVHcm91cC5cbiAgICogcmV0dXJuIG9iamVjdHMgdG8gcmVuZGVyIGltbWVkaWF0ZWx5IGFuZCBwdXNoZXMgdGhlIG90aGVyIGluIHRoZSBhY3RpdmVHcm91cC5cbiAgICovXG4gIF9jaG9vc2VPYmplY3RzVG9SZW5kZXI6IGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgaWYodGhpcy5pbnRlcmFjdGl2ZSl7XG4gICAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICAgIGFjdGl2ZU9iamVjdCA9IHRoaXMuZ2V0QWN0aXZlT2JqZWN0KCk7XG4gICAgfVxuICAgIHZhciBvYmplY3QsIG9ianNUb1JlbmRlciA9IFsgXSwgYWN0aXZlR3JvdXBPYmplY3RzID0gWyBdO1xuXG4gICAgaWYgKGFjdGl2ZUdyb3VwICYmICF0aGlzLnByZXNlcnZlT2JqZWN0U3RhY2tpbmcpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG9iamVjdCA9IHRoaXMuX29iamVjdHNbaV07XG4gICAgICAgIGlmKGxheWVyICYmIG9iamVjdC5sYXllciAhPT0gbGF5ZXIgKWNvbnRpbnVlO1xuICAgICAgICBpZiAoIWFjdGl2ZUdyb3VwLmNvbnRhaW5zKG9iamVjdCkpIHtcbiAgICAgICAgICBpZighb2JqZWN0LmhpZGRlbkFjdGl2ZSl7XG4gICAgICAgICAgICBvYmpzVG9SZW5kZXIucHVzaChvYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBhY3RpdmVHcm91cE9iamVjdHMucHVzaChvYmplY3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoYWN0aXZlR3JvdXApIHtcbiAgICAgICAgLy8gYWN0aXZlR3JvdXAuX3NldCgnX29iamVjdHMnLCBhY3RpdmVHcm91cE9iamVjdHMpO1xuICAgICAgICBvYmpzVG9SZW5kZXIucHVzaChhY3RpdmVHcm91cCk7XG4gICAgICB9XG4gICAgICBhY3RpdmVPYmplY3QgJiYgb2Jqc1RvUmVuZGVyLnB1c2goYWN0aXZlT2JqZWN0KTtcbiAgICAgIC8vIGFjdGl2ZUdyb3VwLl9zZXQoJ19vYmplY3RzJywgYWN0aXZlR3JvdXBPYmplY3RzKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZihsYXllcil7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgb2JqZWN0ID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgICAgICBpZihsYXllciAmJiBvYmplY3QubGF5ZXIgIT09IGxheWVyICljb250aW51ZTtcbiAgICAgICAgICBvYmpzVG9SZW5kZXIucHVzaChvYmplY3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNle1xuICAgICAgICBvYmpzVG9SZW5kZXIgPSB0aGlzLl9vYmplY3RzO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2Jqc1RvUmVuZGVyO1xuICB9LFxuXG4gIHNldEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMub24odmFsKTtcbiAgfSxcbiAgZmluZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwic3RyaW5nXCIpe1xuICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgdHlwZTogb3B0aW9uc1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LndoZXJlKHRoaXMuX29iamVjdHMsb3B0aW9ucyk7XG4gIH0sXG4gIF91cGRhdGVfYmFja2dyb3VuZF9vdmVybGF5X2ltYWdlOiBmdW5jdGlvbiAocHJvcGVydHkpIHtcblxuICAgIHZhciBwb3NpdGlvbiA9IHRoaXNbcHJvcGVydHkgKyBcIlBvc2l0aW9uXCJdO1xuICAgIHZhciBwaG90byA9IHRoaXNbcHJvcGVydHkgKyBcIkltYWdlXCJdO1xuICAgIGlmICghcGhvdG8gfHwgcGhvdG8uY29uc3RydWN0b3IgPT09IE9iamVjdCB8fCBwaG90by5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSByZXR1cm47XG5cbiAgICBpZiAocG9zaXRpb24gPT09ICdyZXNpemUnKSB7XG4gICAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSBwaG90by53aWR0aDtcbiAgICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSBwaG90by5oZWlnaHQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKHBvc2l0aW9uICE9PSAnbWFudWFsJykge1xuXG4gICAgICB2YXIgX3cgID0gIHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoLCAgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG5cbiAgICAgIGlmIChwb3NpdGlvbiA9PT0gJ2ZpdCcgfHwgIXBob3RvLl9vcmlnaW5hbEVsZW1lbnQpIHtcblxuICAgICAgICBzaXplID0ge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2V7XG4gICAgICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMocGhvdG8uX29yaWdpbmFsRWxlbWVudCwge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH0sIHBvc2l0aW9uKTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9sIDtcbiAgICAgIGlmKHBob3RvLm9yaWdpblggPT09ICdjZW50ZXInKXtcbiAgICAgICAgX2wgPSBfdyAvIDI7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgX2wgPSAoX3cgLSBzaXplLndpZHRoKSAvIDIgO1xuICAgICAgfVxuICAgICAgdmFyIF90IDtcbiAgICAgIGlmKHBob3RvLm9yaWdpblkgPT09ICdjZW50ZXInKXtcbiAgICAgICAgX3QgPSBfaCAvIDI7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3QgPSAoX2ggLSBzaXplLmhlaWdodCkgLyAyIDtcbiAgICAgIH1cblxuICAgICAgdmFyIF96ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICAgIHBob3RvLnNldCh7XG4gICAgICAgIGxlZnQ6IF9sLC8vKF9sIC8qKyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdKi8pKl96LFxuICAgICAgICB0b3A6ICBfdCwvLyAvKisgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSovKSpfeixcbiAgICAgICAgd2lkdGg6IHNpemUud2lkdGgsLy8qX3osXG4gICAgICAgIGhlaWdodDogc2l6ZS5oZWlnaHQsLy8qX3osXG4gICAgICAgIHNjYWxlWDogMSxcbiAgICAgICAgc2NhbGVZOiAxXG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyB2YXIgX29yaWcgPSBwaG90by5nZXRPcmlnaW5hbFNpemUoKTtcbiAgICAgIC8vIHBob3RvLnNldCh7XG4gICAgICAvLyAgIG9yaWdpblg6ICdsZWZ0JyxcbiAgICAgIC8vICAgb3JpZ2luWTogJ3RvcCcsXG4gICAgICAvLyAgIGxlZnQ6IDAsIC8vdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSxcbiAgICAgIC8vICAgdG9wOiAwLCAvL3RoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0sXG4gICAgICAvLyAgIHdpZHRoOiBfb3JpZy53aWR0aCxcbiAgICAgIC8vICAgaGVpZ2h0OiBfb3JpZy5oZWlnaHRcbiAgICAgIC8vIH0pO1xuICAgIH1cbiAgfSxcbiAgX3NldEJhY2tncm91bmRPdmVybGF5SW1hZ2U6IGZ1bmN0aW9uIChmYWJyaWNJbWFnZSx0eXBlKSB7XG4gICAgdmFyIHByb3BlcnR5ID0gdHlwZSArIFwiSW1hZ2VcIjtcbiAgICB2YXIgcG9zaXRpb25Qcm9wZXJ0eSA9IHR5cGUgKyBcIlBvc2l0aW9uXCI7XG5cbiAgICBpZih0aGlzLmxvYWRlZCkge1xuICAgICAgdmFyIG9yaWdpbmFsU3RhdGUgPXt9O1xuICAgICAgb3JpZ2luYWxTdGF0ZVtwcm9wZXJ0eV09IHRoaXNbcHJvcGVydHldO1xuICAgIH1cblxuICAgIHRoaXNbcHJvcGVydHldID0gZmFicmljSW1hZ2U7XG4gICAgdGhpc1twcm9wZXJ0eV0uY2FudmFzID0gdGhpcztcbiAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9vdmVybGF5X2ltYWdlKHR5cGUpO1xuICAgIGlmKHRoaXNbcG9zaXRpb25Qcm9wZXJ0eV0gPT09IFwicmVzaXplXCIpe1xuICAgICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gZmFicmljSW1hZ2Uud2lkdGg7XG4gICAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ID0gZmFicmljSW1hZ2UuaGVpZ2h0O1xuICAgIH1cblxuICAgIGlmKHRoaXMubG9hZGVkKXtcbiAgICAgIHZhciBtb2RpZmllZFN0YXRlID0ge307XG4gICAgICBtb2RpZmllZFN0YXRlW3Byb3BlcnR5XSA9ICB0aGlzW3Byb3BlcnR5XTtcbiAgICAgIHRoaXMuZmlyZSgnbW9kaWZpZWQnLHtzdGF0ZXM6IHtcbiAgICAgICAgICBvcmlnaW5hbDogb3JpZ2luYWxTdGF0ZSxcbiAgICAgICAgICBtb2RpZmllZDogbW9kaWZpZWRTdGF0ZVxuICAgICAgICB9fSk7XG4gICAgfVxuXG4gICAgdGhpcy5maXJlKFwiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIix7dGFyZ2V0OiBmYWJyaWNJbWFnZX0pO1xuICB9LFxuICBzZXRCYWNrZ3JvdW5kT3ZlcmxheUltYWdlOiBmdW5jdGlvbiAoYmcsIHR5cGUgLCBjYWxsYmFjaykge1xuICAgIHZhciBwcm9wZXJ0eSA9IHR5cGUgKyBcIkltYWdlXCI7XG4gICAgdmFyIHByb3RvdHlwZSA9ICB0aGlzLmFwcGxpY2F0aW9uLnByb3RvdHlwZXMgJiYgdGhpcy5hcHBsaWNhdGlvbi5wcm90b3R5cGVzW2ZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKHByb3BlcnR5KV07XG5cbiAgICBpZiAoIWJnKSB7XG4gICAgICB0aGlzW3Byb3BlcnR5XSA9IG51bGw7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYmcgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8IGJnIGluc3RhbmNlb2YgSW1hZ2Upe1xuICAgICAgdmFyIGVsID0gbmV3IGZhYnJpYy5JbWFnZShiZyx7XG4gICAgICAgIHdpZHRoOiBiZy5uYXR1cmFsV2lkdGgsXG4gICAgICAgIGhlaWdodDogYmcubmF0dXJhbEhlaWdodFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX3NldEJhY2tncm91bmRPdmVybGF5SW1hZ2UoZWwsdHlwZSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYmcuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG4gICAgICBiZyA9IHtcbiAgICAgICAgc3JjOiBiZ1xuICAgICAgfVxuICAgIH1cblxuICAgIHByb3RvdHlwZSAmJiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGJnLHByb3RvdHlwZSk7XG4gICAgYmcuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgIGJnLmRpc2FibGVEZWZhdWx0UHJvcGVydGllcyA9IHRydWU7XG4gICAgYmcudHlwZSA9IGJnLnR5cGUgfHwgXCJpbWFnZVwiO1xuXG4gICAgZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KGJnLGVsID0+IHtcbiAgICAgIHRoaXMuX3NldEJhY2tncm91bmRPdmVybGF5SW1hZ2UoZWwsdHlwZSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuICBzZXRPdmVybGF5SW1hZ2U6IGZ1bmN0aW9uIChiZywgY2FsbGJhY2spIHtcbiAgICB0aGlzLnNldEJhY2tncm91bmRPdmVybGF5SW1hZ2UoYmcsXCJvdmVybGF5XCIsY2FsbGJhY2spO1xuICB9LFxuICBzZXRCYWNrZ3JvdW5kSW1hZ2U6IGZ1bmN0aW9uIChiZywgY2FsbGJhY2spIHtcbiAgICB0aGlzLnNldEJhY2tncm91bmRPdmVybGF5SW1hZ2UoYmcsXCJiYWNrZ3JvdW5kXCIsY2FsbGJhY2spO1xuICB9LFxuICBjcmVhdGVPYmplY3RzOiBmdW5jdGlvbihvYmplY3RzLGNhbGxiYWNrKXtcblxuICAgIGlmKHRoaXMuYXBwbGljYXRpb24pe1xuICAgICAgZm9yKHZhciBpIGluIG9iamVjdHMpe1xuICAgICAgICBpZihvYmplY3RzW2ldLmNvbnN0cnVjdG9yID09IFN0cmluZyl7XG4gICAgICAgICAgb2JqZWN0c1tpXSA9IHRoaXMuYXBwbGljYXRpb24ub2JqZWN0c1tvYmplY3RzW2ldXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBfY2FudmFzID0gdGhpcztcblxuICAgIGZ1bmN0aW9uIHN1Y2Nlc3MoX29iamVjdHMpIHtcbiAgICAgIF9jYW52YXMuZmlyZShcInByb2dyZXNzOmNvbXBsZXRlXCIsIHtvYmplY3RzOiBvYmplY3RzfSk7XG4gICAgICBmb3IgKHZhciBpIGluIF9vYmplY3RzKSB7XG4gICAgICAgIF9jYW52YXMuYWRkKF9vYmplY3RzW2ldKTtcbiAgICAgIH1cbiAgICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKF9jYW52YXMpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcHJvZ3Jlc3MobCwgdCkge1xuICAgICAgX2NhbnZhcy5maXJlKFwicHJvZ3Jlc3NcIiwgeyBsb2FkZWQgOiBsLCB0b3RhbCA6IHQgfSk7XG4gICAgICBpZiAoZmFicmljLnV0aWwubG9hZGVyRGVidWcpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJsb2FkZWQgXCIgKyBsICsgXCIgLyBcIiArIHQpO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgdmFyIF9vYmplY3RzID0gW107XG4gICAgaWYgKCFvYmplY3RzIHx8ICFvYmplY3RzLmxlbmd0aCkge1xuICAgICAgc3VjY2Vzcyhfb2JqZWN0cyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYob2JqZWN0c1swXS5jb25zdHJ1Y3Rvci5uYW1lID09PSBcImtsYXNzXCIpe1xuICAgICAgc3VjY2VzcyhvYmplY3RzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cblxuICAgIHZhciBxdWV1ZUxvYWRDYWxsYmFjayA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChvYmplY3RzLmxlbmd0aCwgZnVuY3Rpb24oKXtcbiAgICAgIHN1Y2Nlc3MoZmFicmljLnV0aWwub2JqZWN0LnBsdWNrKF9vYmplY3RzLFwib2JqZWN0XCIpKTtcbiAgICB9LCBwcm9ncmVzcyk7XG5cbiAgICBxdWV1ZUxvYWRDYWxsYmFjay5kYXRhID0gKHRoaXMudGl0bGUgfHwgXCJcIikgKyBcIm9iamVjdHNcIjtcblxuXG4gICAgZm9yICh2YXIgaSBpbiBvYmplY3RzKSB7XG4gICAgICAoZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIF9vYmplY3Rfc2xvdCA9IHtvYmplY3Q6IG51bGwsIG9wdGlvbnM6IG9wdGlvbnN9O1xuICAgICAgICBfb2JqZWN0cy5wdXNoKF9vYmplY3Rfc2xvdCk7XG5cbiAgICAgICAgb3B0aW9ucy5hcHBsaWNhdGlvbiA9IF9jYW52YXMuYXBwbGljYXRpb247XG4gICAgICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvcHRpb25zLCBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgICBfb2JqZWN0X3Nsb3Qub2JqZWN0ID0gZWw7XG4gICAgICAgICAgcXVldWVMb2FkQ2FsbGJhY2soKTtcbiAgICAgICAgfSk7XG4gICAgICB9KS5jYWxsKHRoaXMsIG9iamVjdHNbaV0pO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqIGFwcGx5IG9wdGlvbnMgZm9yIGdyb3VwIG9mIGZpbHRlcmVkIG9iamVjdHNcbiAgICogQHBhcmFtIGZpbHRlclxuICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgKi9cbiAgYXBwbHlPcHRpb25zOiBmdW5jdGlvbihmaWx0ZXIsb3B0aW9ucyl7XG4gICAgdGhpcy5fb2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKF9vYmope1xuICAgICAgZm9yKHZhciBwcm9wIGluIGZpbHRlcil7XG4gICAgICAgIGlmKF9vYmpbcHJvcF0gIT09ICBmaWx0ZXJbcHJvcF0pcmV0dXJuO1xuICAgICAgfVxuICAgICAgX29iai5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICAgIH0pXG4gIH0sXG5cbiAgLypcbiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9vYmplY3RzID0gdGhpcy5nZXRPYmplY3RzKCksXG4gICAgICBpbmRleDtcbiAgICB2YXIgb2JqZWN0cztcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoYXJndW1lbnRzW2ldLmxheWVyKSB7XG4gICAgICAgIG9iamVjdHMgPSBhcmd1bWVudHNbaV0ubGF5ZXI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmplY3RzID0gX29iamVjdHM7XG4gICAgICB9XG5cbiAgICAgIGluZGV4ID0gb2JqZWN0cy5pbmRleE9mKGFyZ3VtZW50c1tpXSk7XG4gICAgICAvLyBvbmx5IGNhbGwgb25PYmplY3RSZW1vdmVkIGlmIGFuIG9iamVjdCB3YXMgYWN0dWFsbHkgcmVtb3ZlZFxuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICBvYmplY3RzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMuX29uT2JqZWN0UmVtb3ZlZChhcmd1bWVudHNbaV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMucmVuZGVyT25BZGRSZW1vdmUgJiYgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSwqL1xuICAvKipcbiAgICogQ3JlYXRlIE9iamVjdCBieSB0eXBlIGFuZCBvcHRpb25zXG4gICAqIEBwYXJhbSB0eXBlXG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqIEBwYXJhbSBjYWxsYmFja1xuICAgKi9cbiAgY3JlYXRlT2JqZWN0OiBmdW5jdGlvbiAodHlwZSwgb3B0aW9ucyxjYWxsYmFjaykge1xuICAgIGlmKHR5cGVvZiB0eXBlICE9PSBcInN0cmluZ1wiKXtcbiAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUodHlwZSk7XG4gICAgICB0eXBlID0gbnVsbDtcbiAgICB9ZWxzZXtcbiAgICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUob3B0aW9ucyk7XG4gICAgICBvcHRpb25zLnR5cGUgPSB0eXBlO1xuICAgIH1cblxuICAgIHZhciBfc2VsZiA9IHRoaXM7XG5cbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSx0aGlzLmFwcGxpY2F0aW9uLmdldERlZmF1bHRQcm9wZXJ0aWVzKG9wdGlvbnMudHlwZSksb3B0aW9ucylcblxuXG5cbiAgICBvcHRpb25zLmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbjtcbiAgIC8vIHZhciBfYWN0aXZlID0gb3B0aW9ucy5hY3RpdmU7XG4gICAvLyB2YXIgX3Bvc2l0aW9uID0gb3B0aW9ucy5wb3NpdGlvbjtcbi8vICAgIGRlbGV0ZSBvcHRpb25zLmFjdGl2ZTtcbiAgLy8gIGRlbGV0ZSBvcHRpb25zLnBvc2l0aW9uO1xuXG5cbiAgICBmdW5jdGlvbiBfYWRkKGVsKSB7XG4gICAgICBpZihlbC5jYW52YXMpcmV0dXJuO1xuICAgICAgLy8gZWwuYXBwbGljYXRpb24gPSBfc2VsZi5hcHBsaWNhdGlvbjtcbiAgICAgIF9zZWxmLmFkZChlbCk7XG4vKlxuICAgICAgaWYoX2FjdGl2ZSl7XG4gICAgICBpZihfYWN0aXZlKXtcbiAgICAgICAgX3NlbGYuc2V0QWN0aXZlT2JqZWN0KGVsKTtcbiAgICAgIH0qL1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZWwpO1xuICAgIH1cblxuXG5cblxuICAgIHZhciBlbCA9IGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvcHRpb25zLCBfYWRkICk7XG4gICAgZWwgJiYgX2FkZChlbCk7XG4gICAgcmV0dXJuIGVsO1xuICB9LFxuICBvbkxvYWQ6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt0eXBlOiBcInNsaWRlXCIsIHRhcmdldDogdGhpc30pO1xuICAgIHRoaXMuYXBwbGljYXRpb24uZmlyZShcInNsaWRlOmxvYWRpbmc6ZW5kXCIse3RhcmdldDogdGhpcyx0eXBlOiBcInNsaWRlXCJ9KTtcbiAgICB0aGlzLmludGVyYWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwodGhpcyk7XG4gIH0sXG4gIGxvYWQ6IGZ1bmN0aW9uIChvcHRpb25zLGNhbGxiYWNrKSB7XG4gICAgaWYgKCFvcHRpb25zKXJldHVybjtcbiAgICB0aGlzLmFwcGxpY2F0aW9uLl9wb3B1bGF0ZVdpdGhEZWZhdWx0UHJvcGVydGllcyh0aGlzLG9wdGlvbnMpO1xuICAgIGlmKG9wdGlvbnMud2lkdGgpe1xuICAgICAgb3B0aW9ucy5vcmlnaW5hbFdpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgIG9wdGlvbnMub3JpZ2luYWxIZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICB9XG5cbiAgICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgIHRoaXMuaW50ZXJhY3RpdmUgPSBmYWxzZTtcblxuICAgIHRoaXMuY2xlYXIoKTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmJlZ2luXCIse3R5cGU6IFwic2xpZGVcIiwgb3B0aW9uczogb3B0aW9uc30pO1xuICAgIHRoaXMuYXBwbGljYXRpb24uZmlyZShcInNsaWRlOmxvYWRpbmc6YmVnaW5cIix7dGFyZ2V0OiB0aGlzLHR5cGU6IFwic2xpZGVcIiwgb3B0aW9uczogb3B0aW9uc30pO1xuXG4gICAgdGhpcy5zZXQob3B0aW9ucyx0aGlzLm9uTG9hZC5iaW5kKHRoaXMsY2FsbGJhY2spKTtcblxuICB9LFxuICBzZXRPYmplY3RzOiBmdW5jdGlvbihvYmplY3RzLGNhbGxiYWNrKXtcblxuICAgIHRoaXMuX29iamVjdHMubGVuZ3RoID0gMDtcbiAgICBpZiAodGhpcy5faGFzSVRleHRIYW5kbGVycykge1xuICAgICAgdGhpcy5vZmYoJ21vdXNlOnVwJywgdGhpcy5fbW91c2VVcElUZXh0SGFuZGxlcik7XG4gICAgICB0aGlzLl9pVGV4dEluc3RhbmNlcyA9IG51bGw7XG4gICAgICB0aGlzLl9oYXNJVGV4dEhhbmRsZXJzID0gZmFsc2U7XG4gICAgfVxuICAgIGlmKHRoaXMuaW50ZXJhY3RpdmUpe1xuICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICAgIHRoaXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgdGhpcy5jbGVhckNvbnRleHQodGhpcy5jb250ZXh0VG9wKTtcbiAgICB9XG5cbiAgICB0aGlzLmNyZWF0ZU9iamVjdHMob2JqZWN0cyxmdW5jdGlvbigpe1xuICAgICAgZm9yKHZhciBpIGluIHRoaXMuX29iamVjdHMpe1xuICAgICAgICB0aGlzLl9vYmplY3RzW2ldLnNldENvb3JkcygpO1xuICAgICAgfVxuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfSxcbiAgb25SZXNpemU6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIF9zY2FsZSA9IE1hdGgubWluKDEsODAwIC90aGlzLndpZHRoICk7XG4gICAgLy8gdGhpcy5zZXRab29tKF9zY2FsZSk7XG4gICAgdGhpcy5zZXREaW1lbnNpb25zKHt3aWR0aDogdGhpcy53aWR0aCxoZWlnaHQ6IHRoaXMuaGVpZ2h0fSk7XG4gIH0sXG4gIGdldENlbnRlcjogZnVuY3Rpb24gKGVsKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcDogKHRoaXMub3JpZ2luYWxIZWlnaHQgIHx8IHRoaXMuZ2V0SGVpZ2h0KCkpIC8gMixcbiAgICAgIGxlZnQ6ICh0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy5nZXRXaWR0aCgpKSAvIDJcbiAgICB9O1xuICB9LFxuICBzZXRPcmlnaW5hbFNpemU6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gaCA/IHcgOiAody5uYXR1cmFsV2lkdGggfHwgdy53aWR0aCk7XG4gICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IGggPyBoIDogKHcubmF0dXJhbEhlaWdodCB8fCB3LmhlaWdodCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn07XG5cbnZhciBfZ2V0X3BvaW50ZXJfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5nZXRQb2ludGVyO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSxFeHRDYW52YXNNaXhpbix7XG4gIHR5cGU6IFwiY2FudmFzXCIsXG4gIGNhY2hlUHJvcGVydGllczogW10sXG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAgIG9vLnVuc2hpZnQoXCJvcmlnaW5hbFdpZHRoXCIsXCJvcmlnaW5hbEhlaWdodFwiLFwid2lkdGhcIixcImhlaWdodFwiLFwiKlwiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIF9pbml0RW50aXR5OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gJiYgb3B0aW9ucy5hcHBsaWNhdGlvbi5maXJlKFwiZW50aXR5OmNyZWF0ZWRcIiwge3RhcmdldDogdGhpcywgb3B0aW9uczogb3B0aW9uc30pO1xuICB9LFxuICBfbGF5ZXJzOiBbXCJiYWNrZ3JvdW5kXCIsXCJvYmplY3RzXCIsXCJhcmVhc1wiLFwib3ZlcmxheUltYWdlXCIsXCJvdmVybGF5XCIsXCJjb250cm9sc1wiXSxcbiAgLy8gX292ZXJsYXlPYmplY3RzOiBbXSxcbiAgbGF5ZXJzOiB7XG4gICAgYmFja2dyb3VuZDoge1xuICAgICAgcmVuZGVyOiAgZnVuY3Rpb24oY2FudmFzLGN0eCl7XG4gICAgICAgIGNhbnZhcy5fcmVuZGVyQmFja2dyb3VuZChjdHgpO1xuICAgICAgfSxcbiAgICAgIHN2ZzogZnVuY3Rpb24oY2FudmFzLG1hcmt1cCxyZXZpdmVyKXtcbiAgICAgICAgY2FudmFzLl9zZXRTVkdCZ092ZXJsYXlDb2xvcihtYXJrdXAsICdiYWNrZ3JvdW5kQ29sb3InKTtcbiAgICAgICAgY2FudmFzLl9zZXRTVkdCZ092ZXJsYXlJbWFnZShtYXJrdXAsICdiYWNrZ3JvdW5kSW1hZ2UnLCByZXZpdmVyKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGFyZWFzOiB7XG4gICAgICByZW5kZXI6IGZ1bmN0aW9uKGNhbnZhcyxjdHgpe1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICBpZiAoY2FudmFzLmNsaXBUbykge1xuICAgICAgICAgIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KGNhbnZhcywgY3R4KTtcbiAgICAgICAgfVxuICAgICAgICAvL2FwcGx5IHZpZXdwb3J0IHRyYW5zZm9ybSBvbmNlIGZvciBhbGwgcmVuZGVyaW5nIHByb2Nlc3NcbiAgICAgICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIGNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybSk7XG5cbiAgICAgICAgaWYoY2FudmFzLl9vZmZzZXRzT2JqZWN0KXtcbiAgICAgICAgICBjYW52YXMuX29mZnNldHNPYmplY3QucmVuZGVyKGN0eCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY2FudmFzLl9hcmVhc09iamVjdHMpe1xuICAgICAgICAgIGNhbnZhcy5fcmVuZGVyT2JqZWN0cyhjdHgsIGNhbnZhcy5fYXJlYXNPYmplY3RzKTtcbiAgICAgICAgfVxuICAgICAgICBpZihjYW52YXMuX2hlbHBlcnNPYmplY3RzKXtcbiAgICAgICAgICBjYW52YXMuX3JlbmRlck9iamVjdHMoY3R4LCBjYW52YXMuX2hlbHBlcnNPYmplY3RzKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjYW52YXMuX3JlbmRlck9iamVjdHMoY3R4LCBjYW52YXMuX2Nob29zZU9iamVjdHNUb1JlbmRlcihcImFyZWFzXCIpKTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgIH0sXG4gICAgICBvYmplY3RzOiBmdW5jdGlvbihjYW52YXMpe1xuICAgICAgICByZXR1cm4gY2FudmFzLl9hcmVhc09iamVjdHMgfHwgY2FudmFzLl9vZmZzZXRzT2JqZWN0ICYmIFtjYW52YXMuX29mZnNldHNPYmplY3RdIHx8IFtdO1xuICAgICAgfVxuICAgIH0sXG4gICAgb2JqZWN0czoge1xuICAgICAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsY3R4KXtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgaWYgKGNhbnZhcy5jbGlwVG8pIHtcbiAgICAgICAgICBmYWJyaWMudXRpbC5jbGlwQ29udGV4dChjYW52YXMsIGN0eCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9hcHBseSB2aWV3cG9ydCB0cmFuc2Zvcm0gb25jZSBmb3IgYWxsIHJlbmRlcmluZyBwcm9jZXNzXG4gICAgICAgIGN0eC50cmFuc2Zvcm0uYXBwbHkoY3R4LCBjYW52YXMudmlld3BvcnRUcmFuc2Zvcm0pO1xuICAgICAgICBjYW52YXMuX3JlbmRlck9iamVjdHMoY3R4LCBjYW52YXMuX2Nob29zZU9iamVjdHNUb1JlbmRlcihcIm9iamVjdHNcIikpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgfSxcbiAgICAgIG9iamVjdHM6IGZ1bmN0aW9uKGNhbnZhcyl7XG4gICAgICAgIHJldHVybiBjYW52YXMuX29iamVjdHM7XG4gICAgICB9LFxuICAgICAgc3ZnOiBmdW5jdGlvbihjYW52YXMsbWFya3VwLHJldml2ZXIpe1xuICAgICAgICBsZXQgb2JqZWN0cyA9IGNhbnZhcy5fY2hvb3NlT2JqZWN0c1RvUmVuZGVyKFwib2JqZWN0c1wiKTtcbiAgICAgICAgZm9yIChsZXQgaW5zdGFuY2Ugb2Ygb2JqZWN0cykge1xuICAgICAgICAgIGlmIChpbnN0YW5jZS5leGNsdWRlRnJvbUV4cG9ydCljb250aW51ZTtcbiAgICAgICAgICBjYW52YXMuX3NldFNWR09iamVjdChtYXJrdXAsIGluc3RhbmNlLCByZXZpdmVyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgb3ZlcmxheToge1xuICAgICAgcmVuZGVyOiBmdW5jdGlvbihjYW52YXMsY3R4KXtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgaWYgKGNhbnZhcy5jbGlwVG8pIHtcbiAgICAgICAgICBmYWJyaWMudXRpbC5jbGlwQ29udGV4dChjYW52YXMsIGN0eCk7XG4gICAgICAgIH1cbiAgICAgICAgLy9hcHBseSB2aWV3cG9ydCB0cmFuc2Zvcm0gb25jZSBmb3IgYWxsIHJlbmRlcmluZyBwcm9jZXNzXG4gICAgICAgIGN0eC50cmFuc2Zvcm0uYXBwbHkoY3R4LCBjYW52YXMudmlld3BvcnRUcmFuc2Zvcm0pO1xuICAgICAgICBjYW52YXMuX3JlbmRlck9iamVjdHMoY3R4LCBjYW52YXMuX2Nob29zZU9iamVjdHNUb1JlbmRlcihcIm92ZXJsYXlcIikpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgfSxcbiAgICAgIHN2ZzogZnVuY3Rpb24oY2FudmFzLG1hcmt1cCxyZXZpdmVyKXtcbiAgICAgICAgbGV0IG9iamVjdHMgPSBjYW52YXMuX2Nob29zZU9iamVjdHNUb1JlbmRlcihcIm92ZXJsYXlcIik7XG4gICAgICAgIGZvciAobGV0IGluc3RhbmNlIG9mIG9iamVjdHMpIHtcbiAgICAgICAgICBpZiAoaW5zdGFuY2UuZXhjbHVkZUZyb21FeHBvcnQpY29udGludWU7XG4gICAgICAgICAgY2FudmFzLl9zZXRTVkdPYmplY3QobWFya3VwLCBpbnN0YW5jZSwgcmV2aXZlcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIG9iamVjdHM6IGZ1bmN0aW9uKGNhbnZhcyl7XG4gICAgICAvLyAgIHJldHVybiBjYW52YXMuX292ZXJsYXlPYmplY3RzO1xuICAgICAgLy8gfVxuICAgIH0sXG4gICAgY29udHJvbHM6IHtcbiAgICAgIHJlbmRlcjogIGZ1bmN0aW9uKGNhbnZhcyxjdHgpe1xuICAgICAgICAvLyB0aGlzLmNvbnRyb2xzQWJvdmVPdmVybGF5ICYmXG4gICAgICAgIGlmIChjYW52YXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgICAgICBjYW52YXMuZHJhd0NvbnRyb2xzKGN0eCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIG92ZXJsYXlJbWFnZToge1xuICAgICAgcmVuZGVyOiAgZnVuY3Rpb24oY2FudmFzLGN0eCl7XG4gICAgICAgIGNhbnZhcy5fcmVuZGVyT3ZlcmxheShjdHgpO1xuICAgICAgfSxcbiAgICAgIHN2ZzogZnVuY3Rpb24oY2FudmFzLG1hcmt1cCxyZXZpdmVyKXtcbiAgICAgICAgY2FudmFzLl9zZXRTVkdCZ092ZXJsYXlDb2xvcihtYXJrdXAsICdvdmVybGF5Q29sb3InKTtcbiAgICAgICAgY2FudmFzLl9zZXRTVkdCZ092ZXJsYXlJbWFnZShtYXJrdXAsICdvdmVybGF5SW1hZ2UnLCByZXZpdmVyKTtcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuICAvKipcbiAgICogUmVuZGVycyBiYWNrZ3JvdW5kLCBvYmplY3RzLCBvdmVybGF5IGFuZCBjb250cm9scy5cbiAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eFxuICAgKiBAcGFyYW0ge0FycmF5fSBvYmplY3RzIHRvIHJlbmRlclxuICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSBpbnN0YW5jZVxuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICByZW5kZXJDYW52YXM6IGZ1bmN0aW9uKGN0eCwgb2JqZWN0cykge1xuICAgIC8vZG8gbm90IHJlZHJhdyB3aGlsZSB3b3JraW5nIG9uICBzb21ldGhpbmdcbiAgICAvLyBpZih0aGlzLnByb2Nlc3NpbmcpcmV0dXJuIGZhbHNlO1xuICAgIC8vIGlmICh0aGlzLnNlbGVjdGlvbiAmJiAhdGhpcy5fZ3JvdXBTZWxlY3RvciAmJiAhdGhpcy5pc0RyYXdpbmdNb2RlKSB7XG4gICAgLy8gICB0aGlzLmNsZWFyQ29udGV4dCh0aGlzLmNvbnRleHRUb3ApO1xuICAgIC8vIH1cblxuICAgIHRoaXMuY2xlYXJDb250ZXh0KGN0eCk7XG5cbiAgICB0aGlzLmZpcmUoJ2JlZm9yZTpyZW5kZXInKTtcblxuICAgIGZvcih2YXIgaSBvZiB0aGlzLl9sYXllcnMpe1xuICAgICAgdGhpcy5sYXllcnNbaV0ucmVuZGVyKHRoaXMsIGN0eCk7XG4gICAgICAvLyBpZih0aGlzLl9jaG9vc2VPYmplY3RzVG9SZW5kZXIgJiYgIGkgPT09IFwib2JqZWN0c1wiKXtcbiAgICAgIC8vICAgdGhpcy5fcmVuZGVyT2JqZWN0cyhjdHgsIHRoaXMuX2Nob29zZU9iamVjdHNUb1JlbmRlcigpKTtcbiAgICAgIC8vIH1lbHNle1xuICAgICAgLy8gICB0aGlzLl9yZW5kZXJPYmplY3RzKGN0eCwgdGhpcy5sYXllcnNbaV0ub2JqZWN0cyk7XG4gICAgICAvLyB9XG4gICAgfVxuXG4gICAgLy8gdGhpcy5fcmVuZGVyQmFja2dyb3VuZE9iamVjdHMoY3R4KTtcbiAgICAvLyB0aGlzLl9yZW5kZXJPYmplY3RzKGN0eCwgb2JqZWN0cyk7XG4gICAgLy8gdGhpcy5fcmVuZGVyT3ZlcmxheU9iamVjdHMoY3R4KTtcbiAgICAvLyBpZiAodGhpcy5jb250cm9sc0Fib3ZlT3ZlcmxheSAmJiB0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgLy8gICB0aGlzLmRyYXdDb250cm9scyhjdHgpO1xuICAgIC8vIH1cbiAgICB0aGlzLmZpcmUoJ2FmdGVyOnJlbmRlcicpO1xuICB9LFxuICBfcmVuZGVyT3ZlcmxheU9iamVjdHM6IGZ1bmN0aW9uKCl7fSxcbiAgX3JlbmRlckJhY2tncm91bmRPYmplY3RzOiBmdW5jdGlvbigpe30sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50IHwgU3RyaW5nfSBlbCAmbHQ7Y2FudmFzPiBlbGVtZW50IHRvIGluaXRpYWxpemUgaW5zdGFuY2Ugb25cbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdFxuICAgKi9cbiAgX2luaXRTdGF0aWM6IGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XG4gICAgdGhpcy5fb2JqZWN0cyA9IFtdO1xuICAgIHRoaXMuX2hlbHBlcnNPYmplY3RzID0gW107XG4gICAgdGhpcy5fY3JlYXRlTG93ZXJDYW52YXMoZWwpO1xuICAgIHRoaXMuX2luaXRTaXplKG9wdGlvbnMpO1xuICAgIHRoaXMuc2V0KG9wdGlvbnMpO1xuICAgIHRoaXMuX3NldEltYWdlU21vb3RoaW5nKCk7XG5cbiAgICAvLyBvbmx5IGluaXRpYWxpemUgcmV0aW5hIHNjYWxpbmcgb25jZVxuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgdGhpcy5faW5pdFJldGluYVNjYWxpbmcoKTtcbiAgICB9XG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG4gICAgdGhpcy5iYWNrZ3JvdW5kUmVjdCA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICBiYWNrZ3JvdW5kOiBcIiNmZmZcIixcbiAgICAgIHNoYWRvdzoge1xuICAgICAgICBjb2xvcjogJ3JnYmEoMCwwLDAsMC4zKSdcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgfSxcbiAgX2luaXRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy53aWR0aCA9IHRoaXMud2lkdGggfHwgcGFyc2VJbnQodGhpcy5sb3dlckNhbnZhc0VsLndpZHRoLCAxMCkgfHwgMDtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuaGVpZ2h0IHx8IHBhcnNlSW50KHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHQsIDEwKSB8fCAwO1xuXG4gICAgaWYgKCF0aGlzLmxvd2VyQ2FudmFzRWwuc3R5bGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmxvd2VyQ2FudmFzRWwud2lkdGggPSB0aGlzLndpZHRoO1xuICAgIHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHQgPSB0aGlzLmhlaWdodDtcblxuICAgIHRoaXMubG93ZXJDYW52YXNFbC5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnO1xuICAgIHRoaXMubG93ZXJDYW52YXNFbC5zdHlsZS5oZWlnaHQgPSB0aGlzLmhlaWdodCArICdweCc7XG5cbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybS5zbGljZSgpO1xuICB9LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihlbCwgb3B0aW9ucykge1xuICAgIGlmKGVsICYmIGVsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICAvLyBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0gZWw7XG4gICAgICBlbCA9IG51bGw7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgaWYob3B0aW9ucy5hcHBsaWNhdGlvbil7XG4gICAgICBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoXCJlbnRpdHk6Y3JlYXRlZFwiLHt0YXJnZXQgOiB0aGlzICwgb3B0aW9ucyA6IG9wdGlvbnN9KTtcbiAgICB9XG5cblxuICAgIC8vIG9wdGlvbnMgPSAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKG9wdGlvbnMgfHwge30pLHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgIHRoaXMuX2luaXRFbnRpdHkob3B0aW9ucyk7XG4gICAgdGhpcy5faW5pdFN0YXRpYyhlbCwgb3B0aW9ucyk7XG5cbiAgICB0aGlzLnVwZGF0ZUZvbnRzKCk7XG4gIH0sXG4gIHVwZGF0ZUZvbnRzOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgIGZhYnJpYy5vbihcImZvbnRzOmxvYWRlZFwiLCgpID0+IHtcbiAgICAgIHZhciBlbHMgPSB0aGlzLmZpbmQoe3R5cGU6IFwidGV4dFwifSk7XG4gICAgICBmb3IodmFyIGVsIG9mIGVscyl7XG4gICAgICAgIGVsLmRpcnR5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHZhciBlbHMgPSB0aGlzLmZpbmQoe3R5cGU6IFwidGV4dGJveFwifSk7XG4gICAgICBmb3IodmFyIGVsIG9mIGVscyl7XG4gICAgICAgIGVsLmRpcnR5ID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgdmFyIGVscyA9IHRoaXMuZmluZCh7dHlwZTogXCJpLXRleHRcIn0pO1xuICAgICAgZm9yKHZhciBlbCBvZiBlbHMpe1xuICAgICAgICBlbC5kaXJ0eSA9IHRydWU7XG4gICAgICB9XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIH0pXG4gIH0sXG4gIHNldERhdGE6IGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICBpZiAoZGF0YS5yb2xlID09PSBcImJhY2tncm91bmRcIikge1xuICAgICAgdGhpcy5zZXRCYWNrZ3JvdW5kSW1hZ2UoZGF0YSwgdGhpcy5yZW5kZXJBbGwuYmluZCh0aGlzKSlcbiAgICB9XG4gICAgZWxzZSB7XG5cblxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIHBvc2l0aW9uOiBkYXRhLmxlZnQgPT09IHVuZGVmaW5lZCAmJiBkYXRhLnRvcCA9PT0gdW5kZWZpbmVkID8gXCJjZW50ZXJcIiA6IFwibWFudWFsXCIsXG4gICAgICAgIGFjdGl2ZTogdHJ1ZVxuICAgICAgfVxuXG4gICAgICB2YXIgaWQgPSB0aGlzLmFjdGl2ZUFyZWEgJiYgdGhpcy5hY3RpdmVBcmVhLmlkICYmIFwiI1wiK3RoaXMuYWN0aXZlQXJlYS5pZDtcbiAgICAgIGlmKGlkKXtcbiAgICAgICAgb3B0aW9ucy5tb3ZlbWVudExpbWl0cyA9IGlkO1xuICAgICAgICBvcHRpb25zLmNsaXBUbyA9IGlkO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmNyZWF0ZU9iamVjdChmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZChvcHRpb25zLCBkYXRhKSk7XG4gICAgfVxuICB9LFxuICBzZXRPcmlnaW5hbFdpZHRoOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSB2YWx1ZTtcbiAgICBpZighdGhpcy5zdHJldGNoYWJsZSl7XG4gICAgICB0aGlzLnNldFdpZHRoKHZhbHVlKTtcbiAgICB9XG4gIH0sXG4gIHNldE9yaWdpbmFsSGVpZ2h0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ID0gdmFsdWU7XG4gICAgaWYoIXRoaXMuc3RyZXRjaGFibGUpe1xuICAgICAgdGhpcy5zZXRIZWlnaHQodmFsdWUpO1xuICAgIH1cbiAgfSxcbiAgc2V0V2lkdGg6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnNldERpbWVuc2lvbnMoeyB3aWR0aDogdmFsdWUgfSwge30pO1xuICB9LFxuICBzZXRIZWlnaHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnNldERpbWVuc2lvbnMoeyBoZWlnaHQ6IHZhbHVlIH0sIHt9KTtcbiAgfSxcblxuICAvKipcbiAgICogYmFja2dyb3VuZFBvc2l0aW9uXG4gICAqIEB2YWx1ZXMgbWFudWFsIHwgY292ZXIgfCBmaXRcbiAgICovXG4gIGJhY2tncm91bmRQb3NpdGlvbjogJ21hbnVhbCcsXG4gIHNldEJhY2tncm91bmRQb3NpdGlvbjogZnVuY3Rpb24gKHNyYykge1xuICAgIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uID0gc3JjO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX292ZXJsYXlfaW1hZ2UoXCJiYWNrZ3JvdW5kXCIpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBzdG9yZV9vZmZzZXRzOmZ1bmN0aW9uKCl7XG4gICAgaWYoIXRoaXMub2Zmc2V0cylyZXR1cm4gMDtcbiAgICBpZih0aGlzLm9mZnNldHMubGVmdCA9PSB0aGlzLm9mZnNldHMucmlnaHQgJiYgdGhpcy5vZmZzZXRzLnJpZ2h0ID09IHRoaXMub2Zmc2V0cy50b3AgJiYgdGhpcy5vZmZzZXRzLnRvcCA9PSB0aGlzLm9mZnNldHMuYm90dG9tKXtcbiAgICAgIHJldHVybiB0aGlzLm9mZnNldHMubGVmdDtcbiAgICB9XG4gICAgZWxzZXtcbiAgICAgIHJldHVybiB0aGlzLm9mZnNldHM7XG4gICAgfVxuICB9LFxuICBvZmZzZXRzOiAwLFxuICBmaWxsQmFja2dyb3VuZENvbG9yT3ZlckNhbnZhczogZmFsc2UsXG4gIF9yZW5kZXJCYWNrZ3JvdW5kT3JPdmVybGF5OiBmdW5jdGlvbihjdHgsIHByb3BlcnR5KSB7XG4gICAgdmFyIG9iamVjdCA9IHRoaXNbcHJvcGVydHkgKyAnQ29sb3InXTtcblxuICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoO1xuICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG5cblxuICAgIHZhciAgX3JlY3QgPSB0aGlzLmJhY2tncm91bmRSZWN0XG4gICAgaWYocHJvcGVydHkgPT09IFwiYmFja2dyb3VuZFwiICYmIF9yZWN0KXtcbiAgICAgICAgX3JlY3QubGVmdCA9ICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdO1xuICAgICAgICBfcmVjdC50b3AgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdO1xuICAgICAgICBfcmVjdC53aWR0aCA9IHRoaXMub3JpZ2luYWxXaWR0aCAqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgICAgIF9yZWN0LmhlaWdodCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgICogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICAgICAgX3JlY3QuZmlsbCA9IG9iamVjdCB8fCBcIiNmZmZmZmZcIjtcbiAgICAgICAgX3JlY3QuZGlydHkgPSB0cnVlO1xuICAgICAgICBfcmVjdC5yZW5kZXIoY3R4KTtcbiAgICB9ZWxzZSBpZiAoIG9iamVjdCkge1xuXG4gICAgICBjdHguZmlsbFN0eWxlID0gb2JqZWN0LnRvTGl2ZVxuICAgICAgICA/IG9iamVjdC50b0xpdmUoY3R4KVxuICAgICAgICA6IG9iamVjdDtcblxuICAgICAgaWYoIXRoaXMuZmlsbEJhY2tncm91bmRDb2xvck92ZXJDYW52YXMpe1xuICAgICAgICAvL3RvZG8gZG8hISFcbiAgICAgICAgY3R4LmZpbGxSZWN0KFxuICAgICAgICAgIG9iamVjdC5vZmZzZXRYfHwgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0sLy8gKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgICAgIG9iamVjdC5vZmZzZXRZfHwgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0sLy8gKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgICAgIF93ICp0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgICAgIF9oICogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY3R4LmZpbGxSZWN0KFxuXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFggfHwgMCxcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WSB8fCAwLFxuICAgICAgICAgIHRoaXMud2lkdGggLFxuICAgICAgICAgIHRoaXMuaGVpZ2h0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgb2JqZWN0ID0gdGhpc1twcm9wZXJ0eSArICdJbWFnZSddO1xuICAgIGlmKG9iamVjdCAmJiBvYmplY3QuY29uc3RydWN0b3IgIT09IFN0cmluZyAmJiAgb2JqZWN0LmNvbnN0cnVjdG9yICE9PSBPYmplY3Qpe1xuXG5cbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgdGhpcy52aWV3cG9ydFRyYW5zZm9ybSk7XG5cbiAgICAgIG9iamVjdC5yZW5kZXIoY3R4KTtcblxuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9XG4gIH0sXG4gIGdldEltYWdlRGF0YTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICBjbGlwcGVkX2FyZWE6IGZhbHNlLFxuICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlLFxuICAgICAgZm9ybWF0OiAncG5nJyxcbiAgICAgIHF1YWxpdHk6IDAuOFxuICAgIH0sIG9wdGlvbnMgfHwge30pO1xuXG4gICAgdmFyIHNpemU7XG4gICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICBzaXplID0gb3B0aW9ucy5jbGlwcGVkX2FyZWEuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgICB2YXIgX3pvb20gPSB0aGlzLmdldFpvb20oKTtcbiAgICAgIHNpemUubGVmdCAgIC89IF96b29tO1xuICAgICAgc2l6ZS50b3AgICAgLz0gX3pvb207XG4gICAgICBzaXplLndpZHRoICAvPSBfem9vbTtcbiAgICAgIHNpemUuaGVpZ2h0IC89IF96b29tO1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvcHRpb25zLCBzaXplKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2l6ZSA9IHtcbiAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGggfHwgdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogb3B0aW9ucy5oZWlnaHQgfHwgdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodCxcbiAgICAgIH07XG5cbiAgICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5KSB7XG4gICAgICAgIHNpemUud2lkdGggLT0gdGhpcy5vZmZzZXRzLmxlZnQgKyB0aGlzLm9mZnNldHMucmlnaHQ7XG4gICAgICAgIHNpemUuaGVpZ2h0IC09IHRoaXMub2Zmc2V0cy50b3AgKyB0aGlzLm9mZnNldHMuYm90dG9tO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgICBzaXplLndpZHRoICo9IG9wdGlvbnMuem9vbTtcbiAgICAgIHNpemUuaGVpZ2h0ICo9IG9wdGlvbnMuem9vbTtcbiAgICB9XG5cbiAgICB2YXIgY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIGNhbnZhcy53aWR0aCA9IHNpemUud2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuXG4gICAgb3B0aW9ucy5sZWZ0ID0gTWF0aC5mbG9vcihvcHRpb25zLmxlZnQpO1xuICAgIG9wdGlvbnMudG9wID0gTWF0aC5mbG9vcihvcHRpb25zLnRvcCk7XG4gICAgb3B0aW9ucy5oZWlnaHQgPSBNYXRoLmNlaWwob3B0aW9ucy5oZWlnaHQpO1xuICAgIG9wdGlvbnMud2lkdGggPSBNYXRoLmNlaWwob3B0aW9ucy53aWR0aCk7XG5cbiAgICB0aGlzLnJlbmRlclRodW1iKGNhbnZhcywgb3B0aW9ucyk7XG5cbiAgICB2YXIgc3JjID0gY2FudmFzLnRvRGF0YVVSTChvcHRpb25zKTtcblxuICAgIHZhciBibG9iID0gZmFicmljLnV0aWwuZGF0YVVSSXRvQmxvYihzcmMsICdpbWFnZS8nICsgb3B0aW9ucy5mb3JtYXQpO1xuICAgIHZhciBvYmplY3RVUkwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgIHJldHVybiB7XG4gICAgICBkYXRhVVJMOiBzcmMsXG4gICAgICBibG9iOiBibG9iLFxuICAgICAgdXJsOiBvYmplY3RVUkwsXG4gICAgICBjYW52YXM6IGNhbnZhc1xuICAgIH07XG4gIH0sXG4gIGdldE9yaWdpbmFsU2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0XG4gICAgfVxuICB9LFxuXG5cblxuXG5cblxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cblxuICBnZXRPYmplY3RCeUlEOiBmdW5jdGlvbihfaWQpe1xuICAgIGZvciAodmFyIGxpZCBpbiB0aGlzLmxheWVycykge1xuICAgICAgaWYodGhpcy5sYXllcnNbbGlkXS5vYmplY3RzKXtcbiAgICAgICAgZm9yICh2YXIgbyBvZiB0aGlzLmxheWVyc1tsaWRdLm9iamVjdHModGhpcykpIHtcbiAgICAgICAgICBpZiAoby5pZCA9PT0gX2lkKSB7XG4gICAgICAgICAgICByZXR1cm4gbztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIC8qXG4gICBBZGQgQ3VzdG9tIE9iamVjdCBUcmFuZm9ybWF0aW9uc1xuICAgKi9cbiAgZ2V0UG9pbnRlcjogZnVuY3Rpb24gKGUsIGlnbm9yZVpvb20sIHVwcGVyQ2FudmFzRWwpIHtcbiAgICB2YXIgcG9pbnRlciA9IF9nZXRfcG9pbnRlcl9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUsIGlnbm9yZVpvb20sIHVwcGVyQ2FudmFzRWwpO1xuICAgIGlmIChlLl9ncm91cCkge1xuICAgICAgcmV0dXJuIHRoaXMuX25vcm1hbGl6ZVBvaW50ZXIoZS5fZ3JvdXAsIHBvaW50ZXIpO1xuICAgIH1cbiAgICByZXR1cm4gcG9pbnRlcjtcbiAgfSxcblxuICBoYXNTdGF0ZUNoYW5nZWQ6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmhhc1N0YXRlQ2hhbmdlZCxcbiAgLyoqIENyZWF0ZXMgYSBib3R0b20gY2FudmFzXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IFtjYW52YXNFbF1cbiAgICovXG4gIF9jcmVhdGVMb3dlckNhbnZhczogZnVuY3Rpb24gKGNhbnZhc0VsKSB7XG4gICAgaWYgKHR5cGVvZiBjYW52YXNFbCA9PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aGlzLmxvd2VyQ2FudmFzRWwgPSBmYWJyaWMudXRpbC5nZXRCeUlkKGNhbnZhc0VsKTtcbiAgICB9IGVsc2UgaWYgKGNhbnZhc0VsKSB7XG4gICAgICB0aGlzLmxvd2VyQ2FudmFzRWwgPSAgdGhpcy5fY3JlYXRlQ2FudmFzRWxlbWVudChjYW52YXNFbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vZWRpdGVkIGFsbG93IHZpcnR1bCBjYW52YXNcbiAgICAgIC8vIHRoaXMudmlydHVhbCA9IHRydWU7XG4gICAgICB0aGlzLmxvd2VyQ2FudmFzRWwgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgfVxuICAgIGZhYnJpYy51dGlsLmFkZENsYXNzKHRoaXMubG93ZXJDYW52YXNFbCwgJ2xvd2VyLWNhbnZhcycpO1xuXG4gICAgaWYgKHRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHRoaXMuX2FwcGx5Q2FudmFzU3R5bGUodGhpcy5sb3dlckNhbnZhc0VsKTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbnRleHRDb250YWluZXIgPSB0aGlzLmxvd2VyQ2FudmFzRWwuZ2V0Q29udGV4dCgnMmQnKTtcbiAgfSxcbiAgZmluZFRhcmdldDogZnVuY3Rpb24gKGUsIHNraXBHcm91cCkge1xuICAgIGlmICh0aGlzLnNraXBUYXJnZXRGaW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGlnbm9yZVpvb20gPSB0cnVlLFxuICAgICAgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlLCBpZ25vcmVab29tKSxcbiAgICAgIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpLFxuICAgICAgYWN0aXZlT2JqZWN0ID0gdGhpcy5nZXRBY3RpdmVPYmplY3QoKTtcbiAgICBpZiAoYWN0aXZlR3JvdXAgJiYgIXNraXBHcm91cCAmJiB0aGlzLl9jaGVja1RhcmdldChwb2ludGVyLCBhY3RpdmVHcm91cCkpIHtcbiAgICAgIHJldHVybiBhY3RpdmVHcm91cDtcbiAgICB9XG5cbiAgICBpZiAoYWN0aXZlT2JqZWN0ICYmIHRoaXMuX2NoZWNrVGFyZ2V0KHBvaW50ZXIsIGFjdGl2ZU9iamVjdCkpIHtcbiAgICAgIC8vYWRkZWQgdmlzY2Vyb2lkXG4gICAgICB0aGlzLl9maXJlT3Zlck91dEV2ZW50cyhhY3RpdmVPYmplY3QsIGUpO1xuICAgICAgcmV0dXJuIGFjdGl2ZU9iamVjdDtcbiAgICB9XG5cbiAgICB0aGlzLnRhcmdldHMgPSBbIF07XG5cbiAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKHRoaXMuX29iamVjdHMsIHBvaW50ZXIpO1xuICAgIHRoaXMuX2ZpcmVPdmVyT3V0RXZlbnRzKHRhcmdldCwgZSk7XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsRXh0Q2FudmFzTWl4aW4se1xuICB0eXBlOiBcInNsaWRlXCJcbn0pO1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9jYW52YXMuZXh0LmpzIiwidmFyIF9faW5pdGlhbGl6ZU92ZXJyaWRlbiA9IGZhYnJpYy5UZXh0LnByb3RvdHlwZS5pbml0aWFsaXplO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5UZXh0LnByb3RvdHlwZSwge1xuICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5UZXh0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcInRleHRcIl0pLFxuICBpbml0aWFsaXplT3ZlcnJpZGVuOiBfX2luaXRpYWxpemVPdmVycmlkZW4sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uICh0ZXh0LCBvcHRpb25zKSB7XG4gICAgdGhpcy5faW5pdEVudGl0eShvcHRpb25zKTtcbiAgICB0aGlzLmluaXRpYWxpemVPdmVycmlkZW4odGV4dCwgb3B0aW9ucyk7XG4gICAgLy8gdGhpcy51cGRhdGVDYWNoZSgpO1xuICB9LFxuICBhY2NlcHRzOiB7XG4gICAgcm9sZTogXCJmb250RmFtaWx5XCJcbiAgfSxcbiAgc2V0RGF0YTogZnVuY3Rpb24oZGF0YSl7XG4gICAgaWYoZGF0YS5yb2xlID09IFwiZm9udEZhbWlseVwiKXtcbiAgICAgIHRoaXMuc2V0Rm9udEZhbWlseShkYXRhLmZvbnRGYW1pbHkpXG4gICAgfVxuICB9LFxuICBnZXRTdHlsZTogZnVuY3Rpb24gKHN0eWxlTmFtZSkge1xuICAgIHZhciBvYmplY3QgPSB0aGlzO1xuICAgIHJldHVybiAob2JqZWN0LmdldFNlbGVjdGlvblN0eWxlcyAmJiBvYmplY3QuaXNFZGl0aW5nKVxuICAgICAgPyAob2JqZWN0LmdldFNlbGVjdGlvblN0eWxlcygpW3N0eWxlTmFtZV0gfHwgb2JqZWN0W3N0eWxlTmFtZV0pXG4gICAgICA6IChvYmplY3Rbc3R5bGVOYW1lXSB8fCBvYmplY3RbJ19fJyArIHN0eWxlTmFtZV0gfHwgJycpO1xuICB9LFxuICBnZXRQYXR0ZXJuOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgdmFyIF9maWxsID0gdGhpcy5nZXRTdHlsZSgnZmlsbCAnKTtcbiAgICByZXR1cm4gX2ZpbGwgJiYgX2ZpbGwuc291cmNlO1xuICB9LFxuICBzZXRTdHlsZXM6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5zdHlsZXMgPSB2YWwgfHwge307XG4gIH0sXG4gIHNldFBhdHRlcm46IGZ1bmN0aW9uICh1cmwpIHtcbiAgICBpZiAoIXVybCkge1xuICAgICAgdGhpcy5zZXRTdHlsZSgnZmlsbCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB2YXIgX3RleHR1cmUgPSBfLmZpbmRXaGVyZSh0aGlzLnByb2plY3QudGV4dHVyZXMsIHtpZDogdXJsfSk7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKHVybCwgZnVuY3Rpb24oaW1nKSB7XG4gICAgICAgIF90aGlzLnNldFN0eWxlKCdmaWxsJywgbmV3IGZhYnJpYy5QYXR0ZXJuKHtcbiAgICAgICAgICBzb3VyY2U6IGltZyxcbiAgICAgICAgICByZXBlYXQ6ICdyZXBlYXQnXG4gICAgICAgIH0pKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgLyogZ2V0T3BhY2l0eTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdvcGFjaXR5JykgKiAxMDA7XG4gIH0sXG4gIHNldE9wYWNpdHk6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ29wYWNpdHknLCBwYXJzZUludCh2YWx1ZSwgMTApIC8gMTAwKTtcbiAgfSwqL1xuICBnZXRSYWRpdXM6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3JhZGl1cycpO1xuICB9LFxuICBzZXRTaGFkb3c6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5zZXRQcm9wZXJ0eSgnc2hhZG93Jywgb3B0aW9ucyA/IG5ldyBmYWJyaWMuU2hhZG93KG9wdGlvbnMpIDogbnVsbCk7XG4gIH0sXG4gIHNldFJhZGl1czogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgncmFkaXVzJywgdmFsdWUpO1xuICB9LFxuICBnZXRTcGFjaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdzcGFjaW5nJyk7XG4gIH0sXG4gIHNldFNwYWNpbmc6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0UHJvcGVydHkoJ3NwYWNpbmcnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFJldmVydGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdyZXZlcnRlZCcpO1xuICB9LFxuICBzZXRSZXZlcnRlZDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgncmV2ZXJ0ZWQnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldEZpbGw6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnZmlsbCcpO1xuICB9LFxuICBzZXRGaWxsOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmaWxsJywgdmFsdWUpO1xuICB9LFxuICBnZXRUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd0ZXh0Jyk7XG4gIH0sXG4gIHNldFRleHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0UHJvcGVydHkoJ3RleHQnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFRleHRBbGlnbjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgndGV4dEFsaWduJyk7XG4gIH0sXG4gIHNldFRleHRBbGlnbjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgndGV4dEFsaWduJywgdmFsdWUudG9Mb3dlckNhc2UoKSk7XG4gIH0sXG4gIGdldEZvbnRGYW1pbHk6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2ZvbnRGYW1pbHknKTtcbiAgfSxcbiAgc2V0Rm9udEZhbWlseTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udEZhbWlseScsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0U3R5bGVzOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB7XG4gICAgICBmaWxsIDogICAgICAgICAgICAgICAgdGhpcy5maWxsLFxuICAgICAgZm9udFNpemUgOiAgICAgICAgICAgIHRoaXMuZm9udFNpemUsXG4gICAgICB0ZXh0QmFja2dyb3VuZENvbG9yIDogdGhpcy50ZXh0QmFja2dyb3VuZENvbG9yLFxuICAgICAgdGV4dERlY29yYXRpb24gOiAgICAgIHRoaXMudGV4dERlY29yYXRpb24sXG4gICAgICBmb250RmFtaWx5IDogICAgICAgICAgdGhpcy5mb250RmFtaWx5LFxuICAgICAgZm9udFdlaWdodCA6ICAgICAgICAgIHRoaXMuZm9udFdlaWdodCxcbiAgICAgIGZvbnRTdHlsZSA6ICAgICAgICAgICB0aGlzLmZvbnRTdHlsZSxcbiAgICAgIHN0cm9rZSA6ICAgICAgICAgICAgICB0aGlzLnN0cm9rZSxcbiAgICAgIHN0cm9rZVdpZHRoIDogICAgICAgICB0aGlzLnN0cm9rZVdpZHRoXG4gICAgfTtcbiAgfSxcbiAgZ2V0QmdDb2xvcjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnYmFja2dyb3VuZENvbG9yJyk7XG4gIH0sXG4gIHNldEJnQ29sb3I6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0UHJvcGVydHkoJ2JhY2tncm91bmRDb2xvcicsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0VGV4dEJnQ29sb3I6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3RleHRCYWNrZ3JvdW5kQ29sb3InKTtcbiAgfSxcbiAgc2V0VGV4dEJnQ29sb3I6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0UHJvcGVydHkoJ3RleHRCYWNrZ3JvdW5kQ29sb3InLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFN0cm9rZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdzdHJva2UnKTtcbiAgfSxcbiAgc2V0U3Ryb2tlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdzdHJva2UnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFN0cm9rZVdpZHRoOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ3N0cm9rZVdpZHRoJyk7XG4gIH0sXG4gIHNldFN0cm9rZVdpZHRoOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdzdHJva2VXaWR0aCcsIHBhcnNlSW50KHZhbHVlLCAxMCkpO1xuICB9LFxuICBkZWNyZWFzZUZvbnRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udFNpemUnLCBwYXJzZUludCh0aGlzLmdldFN0eWxlKCdmb250U2l6ZScpKSAtIDEpO1xuICB9LFxuICBpbmNyZWFzZUZvbnRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udFNpemUnLCBwYXJzZUludCh0aGlzLmdldFN0eWxlKCdmb250U2l6ZScpKSArIDEpO1xuICB9LFxuICBnZXRGb250U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250U2l6ZScpO1xuICB9LFxuICBzZXRGb250U2l6ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udFNpemUnLCBwYXJzZUludCh2YWx1ZSwgMTApKTtcbiAgfSxcbiAgZ2V0TGluZUhlaWdodDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdsaW5lSGVpZ2h0Jyk7XG4gIH0sXG4gIHNldExpbmVIZWlnaHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2xpbmVIZWlnaHQnLCBwYXJzZUZsb2F0KHZhbHVlLCAxMCkpO1xuICB9LFxuICBhZGRUZXh0OiBmdW5jdGlvbiAodGV4dCxvcHRpb25zKSB7XG5cbiAgICB2YXIgX21hdGNoID0gdGhpcy50ZXh0Lm1hdGNoKC9cXG4vZyk7XG4gICAgdmFyIF9saW5lSW5kZXggPSBfbWF0Y2ggJiYgX21hdGNoLmxlbmd0aCB8fCAwO1xuICAgIHZhciBjaGFySW5kZXggPSB0aGlzLnRleHQubGVuZ3RoIC0gdGhpcy50ZXh0Lmxhc3RJbmRleE9mKFwiXFxuXCIpIC0gMTtcblxuICAgIGlmKCF0aGlzLnN0eWxlc1tfbGluZUluZGV4XSl7XG4gICAgICB0aGlzLnN0eWxlc1tfbGluZUluZGV4XSA9IHt9XG4gICAgfVxuXG4gICAgaWYoIXRoaXMuc3R5bGVzW19saW5lSW5kZXhdW2NoYXJJbmRleF0pe1xuICAgICAgdGhpcy5zdHlsZXNbX2xpbmVJbmRleF1bY2hhckluZGV4XSA9IHt9XG4gICAgfVxuICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy5zdHlsZXNbX2xpbmVJbmRleF1bY2hhckluZGV4XSxvcHRpb25zKTtcbiAgICB0aGlzLnRleHQgKz10ZXh0O1xuICAgIC8vIHRoaXMuc3R5bGVzO1xuICB9LFxuICBnZXRCb2xkOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ2ZvbnRXZWlnaHQnKSA9PT0gXCJib2xkXCI7XG4gIH0sXG4gIHNldEJvbGQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRXZWlnaHQnLCB2YWx1ZSA/ICdib2xkJyA6ICcnKTtcbiAgfSxcbiAgZ2V0SXRhbGljOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ2ZvbnRTdHlsZScpID09PSAnaXRhbGljJztcbiAgfSxcbiAgc2V0SXRhbGljOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250U3R5bGUnLCB2YWx1ZSA/ICdpdGFsaWMnIDogJycgKTtcbiAgfSxcbiAgZ2V0VW5kZXJsaW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykuaW5kZXhPZigndW5kZXJsaW5lJykgPiAtMTtcbiAgfSxcbiAgc2V0VW5kZXJsaW5lOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB2YWx1ZSA9IHZhbHVlID8gKHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykgKyAnIHVuZGVybGluZScpXG4gICAgICA6IHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykucmVwbGFjZSgndW5kZXJsaW5lJywgJycpO1xuXG4gICAgdGhpcy5zZXRTdHlsZSgndGV4dERlY29yYXRpb24nLCB2YWx1ZSk7XG4gIH0sXG4gIGdldExpbmV0aHJvdWdoOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykuaW5kZXhPZignbGluZS10aHJvdWdoJykgPiAtMTtcbiAgfSxcbiAgc2V0TGluZXRocm91Z2g6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHZhbHVlID0gdmFsdWUgPyAodGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKSArICcgbGluZS10aHJvdWdoJylcbiAgICAgIDogdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5yZXBsYWNlKCdsaW5lLXRocm91Z2gnLCAnJyk7XG5cbiAgICB0aGlzLnNldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0T3ZlcmxpbmU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5pbmRleE9mKCdvdmVybGluZScpID4gLTE7XG4gIH0sXG4gIHNldE92ZXJsaW5lOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB2YWx1ZSA9IHZhbHVlID8gKHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykgKyAnIG92ZXJsaW5lJylcbiAgICAgIDogdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5yZXBsYWNlKCdvdmVybGluJywgJycpO1xuXG4gICAgdGhpcy5zZXRTdHlsZSgndGV4dERlY29yYXRpb24nLCB2YWx1ZSk7XG4gIH0sXG4gIF9jaGVja01vZGlmaWVkVGV4dCA6IGZ1bmN0aW9uIChwcm9wLCB2YWx1ZSkge1xuICAgIGlmKHRoaXMuaXNFZGl0aW5nKXtcbiAgICAgIHZhciBpc1RleHRDaGFuZ2VkID0gKHRoaXMuX3RleHRCZWZvcmVFZGl0ICE9PSB0aGlzLnRleHQpO1xuICAgICAgaWYoaXNUZXh0Q2hhbmdlZCl7XG4gICAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJvYmplY3Q6bW9kaWZpZWRcIix7dGFyZ2V0OiB0aGlzfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRQcm9wZXJ0eTogZnVuY3Rpb24gKHByb3AsIHZhbHVlKSB7XG4gICAgdGhpcy5fY2hlY2tNb2RpZmllZFRleHQoKTtcbiAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgIHRoaXNbcHJvcF0gPSB2YWx1ZTtcblxuICAgIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIse30pO1xuICAgIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJvYmplY3Q6bW9kaWZpZWRcIix7dGFyZ2V0OiB0aGlzfSk7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9XG4gICAgdGhpcy5fdGV4dEJlZm9yZUVkaXQgPSB0aGlzLnRleHQ7XG4gIH0sXG5cbiAgc2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZU5hbWUsIHZhbHVlKSB7XG4gICAgdGhpcy5fY2hlY2tNb2RpZmllZFRleHQoKTtcbiAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuXG4gICAgbGV0IF9vbGQgPSB0aGlzLmdldFN0eWxlcygpO1xuICAgICAgICBfb2xkLnN0eWxlcyA9IHRoaXMuc3R5bGVzO1xuXG4gICAgaWYgKHRoaXMuc2V0U2VsZWN0aW9uU3R5bGVzICYmIHRoaXMuaXNFZGl0aW5nICYmIHRoaXMuc2VsZWN0aW9uU3RhcnQgIT09IHRoaXMuc2VsZWN0aW9uRW5kKSB7XG4gICAgICBsZXQgc3R5bGUgPSB7fTtcbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHN0eWxlW3N0eWxlTmFtZV0gPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSBzdHlsZVtzdHlsZU5hbWVdO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRTZWxlY3Rpb25TdHlsZXMoc3R5bGUpO1xuICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzW3N0eWxlTmFtZV0gPSB2YWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzW3N0eWxlTmFtZV07XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBpIGluIHRoaXMuc3R5bGVzKSB7XG4gICAgICAgIGZvciAobGV0IGogaW4gdGhpcy5zdHlsZXNbaV0pIHtcbiAgICAgICAgICBpZiAodGhpcy5zdHlsZXNbaV1bal1bc3R5bGVOYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5zdHlsZXNbaV1bal1bc3R5bGVOYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNldENvb3JkcygpO1xuXG4gICAgaWYodGhpcy5jYWNoaW5nKXtcbiAgICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIGlmKCF0aGlzLmlzRWRpdGluZyl7XG4gICAgdGhpcy5maXJlKFwibW9kaWZpZWRcIix7fSk7XG5cbiAgICBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIse3RhcmdldDogdGhpc30pO1xuICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfVxuICAgIC8vIH1cbiAgfSxcbiAgZ2VuZXJhdGVUZXh0U3R5bGU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgJ2ZvbnQtc3R5bGUnOiB0aGlzLmlzSXRhbGljKCkgPyAnaXRhbGljJyA6ICdub3JtYWwnLFxuICAgICAgJ2ZvbnQtd2VpZ2h0JzogdGhpcy5pc0JvbGQoKSA/IDcwMCA6IDQwMCxcbiAgICAgICd0ZXh0LWRlY29yYXRpb24nOiAodGhpcy5pc0xpbmV0aHJvdWdoKCkgPyAnbGluZS10aHJvdWdoICcgOiAnJyApICtcbiAgICAgICh0aGlzLmlzT3ZlcmxpbmUoKSA/ICdvdmVybGluZSAnIDogJycgKSArXG4gICAgICAodGhpcy5pc1VuZGVybGluZSgpID8gJ3VuZGVybGluZSAnIDogJycpXG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGV4dGJveC5wcm90b3R5cGUsIHtcbiAgdG9PYmplY3Q6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRvT2JqZWN0XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSVRleHQucHJvdG90eXBlLCB7XG4gIHN0YXRlUHJvcGVydGllczogZmFicmljLklUZXh0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcInN0eWxlc1wiXSksXG4gIHN0b3JlX3N0eWxlczogZnVuY3Rpb24oKXtcbiAgICBpZighT2JqZWN0LmtleXModGhpcy5zdHlsZXMpLmxlbmd0aClyZXR1cm4gbnVsbDtcbiAgICBsZXQgX3N0eWxlcyA9IHt9O1xuICAgIGxldCBfaXNfbm90X2VtcHR5ID0gZmFsc2U7XG4gICAgZm9yKGxldCByb3cgaW4gdGhpcy5zdHlsZXMpe1xuICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5zdHlsZXNbcm93XSkubGVuZ3RoKXtcbiAgICAgICAgdmFyIF9yb3dfZW1wdHkgPSB0cnVlO1xuICAgICAgICBmb3IobGV0IGNoYXIgaW4gdGhpcy5zdHlsZXNbcm93XSl7XG4gICAgICAgICAgaWYoT2JqZWN0LmtleXModGhpcy5zdHlsZXNbcm93XVtjaGFyXSkubGVuZ3RoKXtcbiAgICAgICAgICAgIGlmKF9yb3dfZW1wdHkpe1xuICAgICAgICAgICAgICBfc3R5bGVzW3Jvd10gPSB7fTsgX3Jvd19lbXB0eSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX3N0eWxlc1tyb3ddW2NoYXJdID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKHRoaXMuc3R5bGVzW3Jvd11bY2hhcl0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZighX3Jvd19lbXB0eSl7XG4gICAgICAgICAgX2lzX25vdF9lbXB0eSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9pc19ub3RfZW1wdHkgJiYgX3N0eWxlcyB8fCBudWxsO1xuICB9LFxuICB0b09iamVjdDogZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3QsXG4gIGluaXRIaWRkZW5UZXh0YXJlYV9uYXRpdmU6IGZhYnJpYy5JVGV4dC5wcm90b3R5cGUuaW5pdEhpZGRlblRleHRhcmVhLFxuICBpbml0SGlkZGVuVGV4dGFyZWE6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5pbml0SGlkZGVuVGV4dGFyZWFfbmF0aXZlKCk7XG4gICAgdGhpcy5oaWRkZW5UZXh0YXJlYS5zdHlsZS53aWR0aCA9IFwiOTk5OXB4XCI7XG4gICAgdGhpcy5oaWRkZW5UZXh0YXJlYS5zdHlsZVtcIm1hcmdpbi1sZWZ0XCJdID0gXCItOTk5OXB4XCI7XG4gIH0sXG4gIC8qKlxuICAgKiBFeGl0cyBmcm9tIGVkaXRpbmcgc3RhdGVcbiAgICogQHJldHVybiB7ZmFicmljLklUZXh0fSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gLyogZXhpdEVkaXRpbmc6IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIGlzVGV4dENoYW5nZWQgPSAodGhpcy5fdGV4dEJlZm9yZUVkaXQgIT09IHRoaXMudGV4dCk7XG4gICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuaXNFZGl0aW5nID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3RhYmxlID0gdHJ1ZTtcblxuICAgIHRoaXMuc2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcblxuICAgIGlmICh0aGlzLmhpZGRlblRleHRhcmVhKSB7XG4gICAgICB0aGlzLmhpZGRlblRleHRhcmVhLmJsdXIgJiYgdGhpcy5oaWRkZW5UZXh0YXJlYS5ibHVyKCk7XG4gICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmhpZGRlblRleHRhcmVhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5oaWRkZW5UZXh0YXJlYSk7XG4gICAgICB0aGlzLmhpZGRlblRleHRhcmVhID0gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLmFib3J0Q3Vyc29yQW5pbWF0aW9uKCk7XG4gICAgdGhpcy5fcmVzdG9yZUVkaXRpbmdQcm9wcygpO1xuICAgIHRoaXMuX2N1cnJlbnRDdXJzb3JPcGFjaXR5ID0gMDtcblxuICAgIHRoaXMuZmlyZSgnZWRpdGluZzpleGl0ZWQnKTtcbiAgICBpc1RleHRDaGFuZ2VkICYmIHRoaXMuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICBpZiAodGhpcy5jYW52YXMpIHtcbiAgICAgIHRoaXMuY2FudmFzLm9mZignbW91c2U6bW92ZScsIHRoaXMubW91c2VNb3ZlSGFuZGxlcik7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKCd0ZXh0OmVkaXRpbmc6ZXhpdGVkJywgeyB0YXJnZXQ6IHRoaXMgfSk7XG4gICAgICBpc1RleHRDaGFuZ2VkICYmIHRoaXMuY2FudmFzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHsgdGFyZ2V0OiB0aGlzIH0pO1xuICAgICAgLy8gdGhpcy5jYW52YXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSwqL1xuICBtYXhTdHJva2VXaWR0aDogZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gTWF0aC5jZWlsKCB0aGlzLmdldEZvbnRTaXplKCkgLyAxMCk7XG4gIH1cbn0pO1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS90ZXh0LmV4dC5qcyIsIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiAjIEFwcGxpY2F0aW9uXG4gKlxuICogZmFyYmljLmFwcCBmdW5jdGlvbiBpcyB0aGUgZW50cnkgcG9pbnQgb2YgRmFicmljSlMgYXBwbGljYXRpb24uXG4gKiBBcHBsaWNhdGlvbiBjb3VsZCBiZSBpbml0aWFsaXNlZCB3aXRoIGNvbmZpZ3VyYXRpb24gb2JqZWN0LiBEaWZmZXJlbnQgZXh0ZW5zaW9ucyBhbGxvd3MgdG8gaW5pdGlhbGl6ZSBzcGVjaWFsIGFwcGxpY2F0aW9uIGF0dHJpYnV0ZXMgc3VjaCBhcyAqb2JqZWN0IHByb3RvdHlwZXMqLCAqcmVzaXphYmxlIGNhbnZhcyosICphdmFpbGFibGUgZm9udHMqLCBldGMuXG4gKlxuICogIyMjIG9wdGlvbjogdXRpbFxuICogbWVkaWFSb290IC0gcm9vdCBkaXJlY3RvcnkgZm9yIGFsbCBtZWRpYSBmaWxlcyBpbiBmYWJyaWMgYXBwbGljYXRpb25cbiAqXG4gKiAjIyMgb3B0aW9uOiByZXNpemFibGVcbiAqIG1ha2VzIGNhbnZhcyByZXNwb25zaWJsZS4gQ2FudmFzIHdpbGwgYmUgc2NhbGVkIHRvIDEwMCUgb2YgaXRzIGNvbnRhaW5lciBzaXplXG4gKlxuICogIyMjIG9wdGlvbjogb25SZXNpemVcbiAqIGZ1bmN0aW9uIHdoaWNoIG92ZXJyaWRlIGRlYWZ1bHQgY2FudmFzIHJlc2l6ZSBiZWhhdmlvci5cbiAqXG4gKiAjIyMgb3B0aW9uOiBjYWxsYmFja1xuICogZnVuY3Rpb24gY2FsbHMgYWZ0ZXIgY2FudmFzIGluaXRpYWxpemVkXG4gKlxuICogIyMjIG9wdGlvbjogaW5pdGlhbGl6ZVxuICogZnVuY3Rpb24gY2FsbHMgYmVmb3JlIGNhbnZhcyBpbml0aWFsaXplXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBuZXcgZmFicmljLkVkaXRvcih7XG4gKiAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAqICAgICAgb25SZXNpemU6IGZ1bmN0aW9uKCl7fSxcbiAqICAgICAgdXRpbDoge1xuICogICAgICAgIG1lZGlhUm9vdDogJy4uLy4uL21lZGlhLydcbiAqICAgICAgfSxcbiAqICAgICAgY2FudmFzQ29udGFpbmVyOiBcImZpZXJhLWNhbnZhc1wiLFxuICogICAgICBwcm90b3R5cGVzOiB7fSxcbiAqICAgICAgb2JqZWN0czoge30sXG4gKiAgICAgIGV2ZW50TGlzdGVuZXJzOiB7fSxcbiAqICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCl7fSxcbiAqICAgICAgaW5pdGlhbGl6ZTogIGZ1bmN0aW9uKCl7fVxuICogICAgICBjdXN0b21QdWJsaWNBcHBsaWNhdGlvbkZ1bmN0aW9uOiBmdW5jdGlvbigpe30sXG4gKiAgICAgIGN1c3RvbVB1YmxpY0FwcGxpY2F0aW9uQXR0cmlidXRlOiB2YWx1ZVxuICogIH0pXG4gKlxuICovXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLHtcbiAgZXJyb3JzOiBbXVxufSk7XG5cbmZhYnJpYy5FZGl0b3IgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gIGlmKG9wdGlvbnMuaWQpe1xuICAgIHRoaXMuaWQgPSBvcHRpb25zLmlkO1xuICAgIGRlbGV0ZSBvcHRpb25zLmlkO1xuICB9XG5cbiAgdGhpcy5pbml0RXZlbnRMaXN0ZW5lcnMoKTtcblxuICB0aGlzLmZpcmUoXCJjcmVhdGVkXCIse29wdGlvbnM6IG9wdGlvbnN9KTtcblxuICBvcHRpb25zID0gIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LHRoaXMuZGVmYXVsdE9wdGlvbnMgLG9wdGlvbnMgfHwge30pO1xuICB0aGlzLmluaXQob3B0aW9ucyk7XG59O1xuXG5cbmZhYnJpYy5FZGl0b3IucHJvdG90eXBlID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxmYWJyaWMuT2JzZXJ2YWJsZSx7XG4gIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgLyoqXG4gICAgICogaWQgb2YgdGFyZ2V0IGNhbnZhcyBlbGVtZW50XG4gICAgICovXG4gICAgLy8gY2FudmFzQ29udGFpbmVyOiBudWxsXG4gIH0sXG4gIGNyZWRlbnRpYWxzOiBmYWxzZSxcbiAgcmVhZHkgOiBmYWxzZSxcbiAgb3B0aW9uc09yZGVyOiBbXG4gICAgXCJjYW52YXNDb250YWluZXJcIixcbiAgICBcIipcIixcbiAgICBcIm9iamVjdHNcIixcbiAgICBcInNsaWRlXCJcbiAgXSxcbiAgcGx1Z2luczoge1xuICAgIGNvbmZpZ3VyYXRpb246IFtdLFxuICAgIGNhbnZhczogW11cbiAgfSxcbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgRXZlbnQgTGlzdGVuZXJzIGNvdWxkYmUgdXNlZCB0byBkZXRlY3QgYWN0aXZlb2JqZWN0IGNoYW5nZXNcbiAgICogIC0gY2FudmFzOmNyZWF0ZWRcbiAgICogIC0gZW50aXR5OmxvYWQgLSBFdmVudCBmaXJlZCBvbiBjcmVhdGlvbiBvZiBldmVyeSBuZXcgZmFicmljIGluc3RhbmNlKGNhbnZhcyxicnVzaCxvYmplY3QpXG4gICAqXG4gICAqICBAZXhhbXBsZVxuICAgKiAgJ2VudGl0eTpsb2FkJyA6IGZ1bmN0aW9uKGUpe1xuICAgKiAgICAgaWYoZS5vcHRpb25zLmJveFR5cGUgPT0gJ21hY2hpbmUnKSB7XG4gICAqICAgICAgIGUub3B0aW9ucy50eXBlID0gXCJtYWNoaW5lLW1hc2stcmVjdGFuZ2xlXCI7XG4gICAqICAgICB9XG4gICAqICAgfVxuICAgKi9cbiAgZXZlbnRMaXN0ZW5lcnM6IHtcbiAgICBcImNhbnZhczpjcmVhdGVkXCI6IFtdLFxuICAgIFwiZW50aXR5OmNyZWF0ZWRcIjogW1xuICAgICAgZnVuY3Rpb24oZSl7XG4gICAgICAgIGlmKCFlLm9wdGlvbnMuaWQpe1xuICAgICAgICAgIGUub3B0aW9ucy5pZCA9IGZhYnJpYy51dGlsLmlkQ291bnRlcisrO1xuICAgICAgICB9XG4gICAgICAgIGlmKGUudGFyZ2V0LmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gZS50YXJnZXQuZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIHZhciBfbGlzdGVuZXJzID0gZS50YXJnZXQuZXZlbnRMaXN0ZW5lcnNbaV07XG4gICAgICAgICAgICBpZihfbGlzdGVuZXJzLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBfbGlzdGVuZXJzKSB7XG4gICAgICAgICAgICAgICAgZS50YXJnZXQub24oaSwgX2xpc3RlbmVyc1tqXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICBlLnRhcmdldC5vbihpLCBfbGlzdGVuZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZS5vcHRpb25zLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gZS5vcHRpb25zLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgICAgIGUudGFyZ2V0Lm9uKGksZS5vcHRpb25zLmV2ZW50TGlzdGVuZXJzW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlIGUub3B0aW9ucy5ldmVudExpc3RlbmVycztcbiAgICAgICAgaWYoZS50YXJnZXQuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gZS50YXJnZXQuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzKXtcbiAgICAgICAgICAgIGUudGFyZ2V0Lm9uKGksZS50YXJnZXQuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBdXG4gIH0sXG4gIG9uU2xpZGVMb2FkZWQ6IGZ1bmN0aW9uICgpIHt9LFxuICBjYWxsYmFjazogZnVuY3Rpb24gKCkge30sXG4gIGluaXQ6IGZ1bmN0aW9uIChvcHRpb25zKXtcbiAgICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcblxuICAgIHRoaXMuX2xvYWRpbmcgPSB0cnVlO1xuICAgIHRoaXMuZmlyZShcImxvYWRpbmc6YmVnaW5cIix7b3B0aW9ucyA6IHRoaXMuX29wdGlvbnN9KTtcblxuXG4gICAgLy8gbmV3IFByb21pc2UoKCkgPT4ge1xuICAgIC8vICAgcmV0dXJuIHRoaXM7XG4gICAgLy8gfSlcbiAgICAvLyAudGhlbih0aGlzLnByZWxvYWRlci5iaW5kKHRoaXMpKVxuICAgIC8vIC50aGVuKHRoaXMubG9hZENvbmZpZ3VyYXRpb24uYmluZCh0aGlzKSlcbiAgICAvLyAudGhlbih0aGlzLmluaXRPcHRpb25zLmJpbmQodGhpcykpXG4gICAgLy8gLnRoZW4odGhpcy5pbml0aWFsaXplLmJpbmQodGhpcykpXG4gICAgLy8gLnRoZW4odGhpcy5vbkFwcGxpY2F0aW9uQ3JlYXRlZC5iaW5kKHRoaXMpKVxuICAgIC8vIC50aGVuKHRoaXMucG9zdGxvYWRlci5iaW5kKHRoaXMpKVxuICAgIC8vIC50aGVuKHRoaXMuY2FsbGJhY2sgJiYgZnVuY3Rpb24oYXBwKXtcbiAgICAvLyAgIHNldFRpbWVvdXQodGhpcy5jYWxsYmFjay5iaW5kKHRoaXMpLDApO1xuICAgIC8vIH0pXG4gICAgLy8gLnRoZW4oICBmdW5jdGlvbigpe1xuICAgIC8vICAgdGhpcy5maXJlKFwicmVhZHlcIik7XG4gICAgLy8gfS5iaW5kKHRoaXMpKVxuXG5cbiAgICAvLyBpZihvcHRpb25zLmxvYWRlcil7XG4gICAgLy8gICB0aGlzLnNldExvYWRlcihvcHRpb25zLmxvYWRlcik7XG4gICAgLy8gICBkZWxldGUgb3B0aW9ucy5sb2FkZXI7XG4gICAgLy8gfVxuICAgIC8vIGlmKG9wdGlvbnMucHJvdG90eXBlcyl7XG4gICAgLy8gICB0aGlzLnNldFByb3RvdHlwZXMob3B0aW9ucy5wcm90b3R5cGVzKTtcbiAgICAvLyAgIGRlbGV0ZSBvcHRpb25zLnByb3RvdHlwZXM7XG4gICAgLy8gfVxuICAgIC8vXG4gICAgLy8gaWYob3B0aW9ucy5hY3Rpb25zKXtcbiAgICAvLyAgIHRoaXMuc2V0QWN0aW9ucyhvcHRpb25zLmFjdGlvbnMpO1xuICAgIC8vICAgZGVsZXRlIG9wdGlvbnMuYWN0aW9ucztcbiAgICAvLyB9XG4gICAgLy8gaWYob3B0aW9ucy5oaXN0b3J5KXtcbiAgICAvLyAgIHRoaXMuc2V0SGlzdG9yeShvcHRpb25zLmhpc3RvcnkpO1xuICAgIC8vICAgZGVsZXRlIG9wdGlvbnMuaGlzdG9yeTtcbiAgICAvLyB9XG4gICAgLy9cbiAgICAvLyBpZihvcHRpb25zLnRvb2xiYXJzKXtcbiAgICAvLyAgIHRoaXMuc2V0VG9vbGJhcnMob3B0aW9ucy50b29sYmFycyk7XG4gICAgLy8gICBkZWxldGUgb3B0aW9ucy50b29sYmFycztcbiAgICAvLyB9XG4gICAgLy9cbiAgICAvLyBpZihvcHRpb25zLnByZXZpZXdNb2RlKXtcbiAgICAvLyAgIHRoaXMucHJldmlld01vZGUgPSBvcHRpb25zLnByZXZpZXdNb2RlO1xuICAgIC8vICAgZGVsZXRlIG9wdGlvbnMucHJldmlld01vZGU7XG4gICAgLy8gfVxuICAgIC8vXG4gICAgLy8gaWYob3B0aW9ucy5zbGlkZSl7XG4gICAgLy8gICB0aGlzLnNsaWRlID0gb3B0aW9ucy5zbGlkZTtcbiAgICAvLyB9XG4gICAgLy8gdGhpcy5zZXRDYW52YXNDb250YWluZXIob3B0aW9ucy5jYW52YXNDb250YWluZXIpO1xuICAgIC8vIGRlbGV0ZSB0aGlzLnNsaWRlO1xuICAgIC8vIGRlbGV0ZSBvcHRpb25zLmNhbnZhc0NvbnRhaW5lcjtcblxuXG5cblxuICAgIGZhYnJpYy51dGlsLm9yZGVyKFtcbiAgICAgICAgLy8gZnVuY3Rpb24oY2Ipe1xuICAgICAgICAvLyAgIHRoaXMuc2V0V2ViZm9udHMob3B0aW9ucy53ZWJmb250cyxjYik7XG4gICAgICAgIC8vICAgZGVsZXRlIG9wdGlvbnMud2ViZm9udHM7XG4gICAgICAgIC8vIH0sXG4gICAgICAgIHRoaXMucHJlbG9hZGVyLFxuICAgICAgICB0aGlzLmxvYWRDb25maWd1cmF0aW9uLFxuICAgICAgICB0aGlzLmluaXRPcHRpb25zLFxuICAgICAgICB0aGlzLmluaXRpYWxpemUsXG4gICAgICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgLy8gdGhpcy5fbG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIC8vIHRoaXMuZmlyZShcImxvYWRpbmc6ZW5kXCIse30pO1xuICAgICAgICB9LFxuICAgICAgICB0aGlzLnBvc3Rsb2FkZXIsXG4gICAgICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2V0VGltZW91dCh0aGlzLmNhbGxiYWNrLmJpbmQodGhpcyksMCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gICAgICAgICAgdGhpcy5maXJlKFwicmVhZHlcIik7XG4gICAgICAgIH1cbiAgICBdLHRoaXMpXG4gIH0sXG4gIHNldENyZWRlbnRpYWxzOiBmdW5jdGlvbihjcmVkZW50aWFscyl7XG4gICAgaWYoY3JlZGVudGlhbHMpe1xuICAgICAgY29uc29sZS5pbmZvKFwiJWNGaWVyYSBDYW52YXMgRWRpdG9yJWMgYnkgJWNEZW5pcyBQb25vbWFyZXYlYyAlYyU2JHMlYyAvICVjJTkkcyVjXCIsIFwiY29sb3I6ICNmZmE1MDBcIiwgXCJjb2xvcjogIzIwMjAyMFwiLCBcImNvbG9yOiAjMkVDMDZDXCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzMzN2FiN1wiLCBcInd3dy5ob21ldGx0LnJ1XCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzMzN2FiN1wiLCBcInBvbm9tYXJldnRsdEBnbWFpbC5jb21cIiwgXCJjb2xvcjogIzIwMjAyMFwiKTtcbiAgICB9XG4gIH0sXG4gIGluaXRPcHRpb25zOiBmdW5jdGlvbiAocmVzb2x2ZSxlcnJvcikge1xuICAgIHRoaXMuc2V0KHRoaXMuX29wdGlvbnMsZnVuY3Rpb24oKXtcbiAgICAgIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSxcbiAgY29uZmlndXJhdGlvblByb3BlcnRpZXM6IFtdLFxuICBsb2FkQ29uZmlndXJhdGlvbjogZnVuY3Rpb24gKHJlc29sdmUsZXJyb3IpIHtcblxuICAgIGlmKHRoaXMuY29uZmlndXJhdGlvblByb3BlcnRpZXMpe1xuICAgICAgZm9yKGxldCBwcm9wIG9mIHRoaXMuY29uZmlndXJhdGlvblByb3BlcnRpZXMpe1xuXG4gICAgICAgIGlmKHRoaXMuX29wdGlvbnNbcHJvcF0pe1xuICAgICAgICAgIGlmKCF0aGlzLl9vcHRpb25zLmNvbmZpZ3VyYXRpb24pe1xuICAgICAgICAgICAgdGhpcy5fb3B0aW9ucy5jb25maWd1cmF0aW9uID0ge307XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuX29wdGlvbnMuY29uZmlndXJhdGlvbltwcm9wXSA9IHRoaXMuX29wdGlvbnNbcHJvcF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZighdGhpcy5fb3B0aW9ucy5jb25maWd1cmF0aW9uKXtcbiAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgfVxuICAgIHZhciBfYXBwID0gdGhpcztcbiAgICBmYWJyaWMudXRpbC5wcm9taXNlLm1hcCh0aGlzLl9vcHRpb25zLmNvbmZpZ3VyYXRpb24sIHZhbHVlID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLGZhaWwpID0+IHtcbiAgICAgICAgaWYodmFsdWUuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKXtcbiAgICAgICAgICBpZih2YWx1ZS5sZW5ndGgpe1xuICAgICAgICAgICAgdmFsdWUocmVzb2x2ZSxmYWlsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIHJlc29sdmUodmFsdWUoKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgZmFicmljLnV0aWwuZGF0YS5sb2FkSnNvbih2YWx1ZSxyZXNvbHZlLGZhaWwpO1xuICAgICAgICB9XG4gICAgICB9KSlcbiAgICAgIC50aGVuKHJlc3VsdHMgPT4ge1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKF9hcHAuX29wdGlvbnMscmVzdWx0cylcbiAgICAgICAgZGVsZXRlIHRoaXMuX29wdGlvbnMuY29uZmlndXJhdGlvbjtcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXNvbHZlLGVycm9yKTtcbiAgfSxcbiAgY3JlYXRlQ2FudmFzOiBmdW5jdGlvbihkYXRhKXtcblxuICAgIHZhciBmYWJyaWNDYW52YXM7XG4gICAgaWYoZmFicmljLmlzTGlrZWx5Tm9kZSl7XG4gICAgICAvLyBmYWJyaWMuQ2FudmFzID0gZmFicmljLkNhbnZhcztcbiAgICAgIHZhciB3ID0gZGF0YS5zbGlkZVdpZHRoOyAvL3RvZG98fCBzbGlkZS50ZW1wbGF0ZS53aWR0aDtcbiAgICAgIHZhciBoID0gZGF0YS5zbGlkZUhlaWdodDsvL3RvZG8gfHwgc2xpZGUudGVtcGxhdGUuaGVpZ2h0O1xuICAgICAgdmFyIHpvb20gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS56b29tIHx8IDE7XG4gICAgICBmYWJyaWNDYW52YXMgPSBmYWJyaWMuY3JlYXRlQ2FudmFzRm9yTm9kZSh3ICogem9vbSxoICogem9vbSk7XG4gICAgfWVsc2V7XG4gICAgICBmYWJyaWNDYW52YXMgPSBuZXcgZmFicmljLkNhbnZhcygge2FwcGxpY2F0aW9uOiB0aGlzLCB3aWR0aDogZGF0YS53aWR0aCwgaGVpZ2h0OmRhdGEuaGVpZ2h0fSk7XG4gICAgICAvLyB0aGlzLmNhbnZhcyA9ICBuZXcgZmFicmljLlN0YXRpY0NhbnZhcygkY2FudmFzLCB7YXBwbGljYXRpb246IGFwcGxpY2F0aW9uLCBpbnRlcmFjdGl2ZTogZmFsc2V9KTtcbiAgICB9XG5cbiAgICBkZWxldGUgZGF0YS53aWR0aDtcbiAgICBkZWxldGUgZGF0YS5oZWlnaHQ7XG5cblxuICAgIC8vIHZhciBmYWJyaWNDYW52YXMgPSBuZXcgZmFicmljW3RoaXMuY2FudmFzQ2xhc3NdKCB7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICB0aGlzLmZpcmUoXCJjYW52YXM6Y3JlYXRlZFwiKTtcblxuICAgIC8qaWYodGhpcy5jYW52YXNDb250YWluZXIpe1xuICAgICAgdGhpcy5jYW52YXNDb250YWluZXIuYXBwZW5kKGZhYnJpY0NhbnZhcy53cmFwcGVyRWwpXG4gICAgfSovXG4gICAgLy9cbiAgICAvLyBpZiAoZmFicmljQ2FudmFzLmxvYWQpIHtcbiAgICAvLyAgIGZhYnJpY0NhbnZhcy5sb2FkKGRhdGEsIGNhbGxiYWNrKTtcbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgZmFicmljQ2FudmFzLmNyZWF0ZU9iamVjdHMoZGF0YSwgY2FsbGJhY2spO1xuICAgIC8vIH1cbiAgICByZXR1cm4gZmFicmljQ2FudmFzO1xuICB9LFxuICBnZXRMaWJyYXJ5RWxlbWVudHM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIHJldHVybiBbXTtcbiAgfSxcbiAgX3NldENhbnZhc0NvbnRhaW5lcjogZnVuY3Rpb24gKGVsLGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jYW52YXNDb250YWluZXIgPSBlbDtcbiAgICAvL3RlbXBvcmFyeSBzbGlkZTtcbiAgICBpZih0aGlzLl9vcHRpb25zLnNsaWRlKXtcbiAgICAgIHRoaXMuY2FudmFzID0gdGhpcy5jcmVhdGVDYW52YXModGhpcy5fb3B0aW9ucy5zbGlkZSk7XG4gICAgICB0aGlzLmNhbnZhc0NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmNhbnZhcy53cmFwcGVyRWwpO1xuICAgICAgdGhpcy5zbGlkZXMgPSBbdGhpcy5jYW52YXNdO1xuICAgIH1cbiAgICAvLyB0aGlzLmNhbnZhcy5sb2FkKHt9KTtcbiAgfSxcbiAgc2V0Q2FudmFzQ29udGFpbmVyOiBmdW5jdGlvbiAoY2FudmFzQ29udGFpbmVyLGNhbGxiYWNrKSB7XG4gICAgLy93YWl0aW5nIHdoaWxlIGRvdW1lbnQgaXMgcmVhZHlcbiAgICBpZiAoY2FudmFzQ29udGFpbmVyLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNhbnZhc0NvbnRhaW5lcik7XG4gICAgICBpZihlbCl7Ly99IHx8IGZhYnJpYy5pc0xpa2VseU5vZGUpIHtcbiAgICAgICAgdGhpcy5fc2V0Q2FudmFzQ29udGFpbmVyKGVsKTtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1lbHNle1xuICAgICAgICAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5fc2V0Q2FudmFzQ29udGFpbmVyKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNhbnZhc0NvbnRhaW5lcikpO1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NldENhbnZhc0NvbnRhaW5lcihjYW52YXNDb250YWluZXIpO1xuICAgIH1cbiAgfSxcbiAgZGlzcG9zZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmNhbnZhcy5kaXNwb3NlKCk7XG4gIH0sXG5cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBFdmVudCBMaXN0ZW5lcnNcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMub24odmFsKTtcbiAgfSxcbiAgaW5pdEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbigpe1xuICAgIGlmKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzID0ge307XG4gICAgfVxuICAgIGZvciAodmFyIGV2ZW50IGluIHRoaXMuZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgIGlmKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdKXtcbiAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50XSA9IFtdXG4gICAgICB9XG4gICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50XS5jb25jYXQgKHRoaXMuZXZlbnRMaXN0ZW5lcnNbZXZlbnRdKTtcbiAgICB9XG4gIH0sXG4gIGNhY2hlUHJvcGVydGllczogW10sXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy9cbiAgdG9PYmplY3Q6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGRhdGEgPSB7fTtcbiAgICBpZih0aGlzLnNsaWRlKXtcbiAgICAgIHJldHVybiB0aGlzLnNsaWRlLnRvT2JqZWN0KCk7XG4gICAgfVxuICAgIGlmKHRoaXMuc2xpZGVzKXtcbiAgICAgIGRhdGEuc2xpZGVzID0gW107XG4gICAgICBmb3IodmFyIGkgaW4gdGhpcy5zbGlkZXMpe1xuICAgICAgICBkYXRhLnNsaWRlcy5wdXNoKHRoaXMuc2xpZGVzW2ldLnRvT2JqZWN0KCkpXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xuICB9LFxuICBfX3NldCA6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9fc2V0LFxuICBfc2V0T2JqZWN0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0T2JqZWN0LFxuICBzZXQ6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnNldCxcbiAgc2V0T3B0aW9uczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0T3B0aW9uc1xufSk7XG5cbi8vIGZhYnJpYy5FZGl0b3IuYWRkUGx1Z2luID0gZmFicmljLlBsdWdpbnNNaXhpbi5hZGRQbHVnaW4uYmluZChmYWJyaWMuRWRpdG9yKTtcblxuZmFicmljLmFwcCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gbmV3IGZhYnJpYy5FZGl0b3Iob3B0aW9ucyk7XG59O1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9hcHBsaWNhdGlvbi5qcyIsIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiAjIENhbnZhc1xuICogSW5oZXJpdGVkIGZyb20gZmFicmljLkNhbnZhc1xuICpcbiAqXG5cbiAjIyBtZXRob2Q6IGxvYWRcblxuTWF0aG9kIGFsbG93cyB0byBhZGQgbmV3IG9iamVjdHMgYW5kIHNldCBuZXcgYXR0cmlidXRlcyBvZiBjYW52YXMuXG5cbiBgYGBqYXZhc2NyaXB0XG4gbG9hZCA6ICh7XG4gICAgYmFja2dyb3VuZEltYWdlOiBzdHJpbmcsXG4gICAgb2JqZWN0czogW0ZhYnJpY1NoYXBlT3B0aW9uc10sXG4gICAgY3VzdG9tU3luY09wdGlvbjogYW55LFxuICAgIGN1c3RvbUFzeW5jT3B0aW9uOiBhbnlcbiAgfSxjYWxsYmFjaykgOiB2b2lkXG4gYGBgXG5cbiBUbyBleHRlbmQgbG9hZGluZyBiZWhhdmlvciBhbmQgdXNlIGN1c3RvbSBvcHRpb25zIGl0IGlzIHBvc3NpYmxlIHRvIGRlZmluZSAqKnNldCBmdWNudGlvbnMqKiBpbiBDYW52YXMgcHJvdG90eXBlLlxuXG4gYGBgamF2YXNjcmlwdFxuIC8vIENhbnZhcyBQcm90b3R5cGVcbiBzZXRDdXN0b21Bc3luY09wdGlvbjogZnVuY3Rpb24odmFsLGNhbGxiYWNrKXtcbiAgdGhpcy5kb0FzeW5jTWV0aG9kKHZhbCxjYWxsYmFjaylcbn1cbiBzZXRDdXN0b21TeW5jT3B0aW9uOiBmdW5jdGlvbih2YWwpe1xuICB0aGlzLmN1c3RvbVN5bmNPdGlvbiA9IHZhbDtcbn1cbiBgYGBcblxuICMjIyBhdHRyaWJ1dGU6IGJhY2tncm91bmRJbWFnZVByb3BlcnRpZXNcblxuIGRlZmF1bHQgYXR0cmlidXRlcyBmb3IgYmFja2dyb3VuZCBpbWFnZVxuXG4gIyMjIGZyZWVEcmF3aW5nQnJ1c2hcblxuIGRlZmF1bHQgYWN0aXZlIGRyYXdpbmcgYnJ1c2hcblxuIGBgYFxuIGZyZWVEcmF3aW5nQnJ1c2g6IFwiUGFpbnRCdWNrZXRCcnVzaFwiIHwgXCJQYWludFBlbkJydXNoXCIgfCBcIlBlbmNpbEJydXNoXCJcbiBgYGBcblxuICMjIyBhdHRyaWJ1dGU6IG9uU2xpZGVMb2FkZWRcblxuIG9uU2xpZGVMb2FkZWQgY2FsbHMgYXMgYSBjYWxsYmFjayBmb3IgbG9hZCBmdWNudGlvblxuXG4gIyMjIGF0dHJpYnV0ZTogYmFja2dyb3VuZFBvc2l0aW9uXG5cbiBvblNsaWRlTG9hZGVkIGNhbGxzIGFzIGEgY2FsbGJhY2sgZm9yIGxvYWQgZnVjbnRpb25cblxuIGBgYFxuIGJhY2tncm91bmRQb3NpdGlvbjogJ21hbnVhbCcgfCAncmVzaXplJyB8ICdmaXQnIHwgJ2NvdmVyJyB8ICdjZW50ZXInXG4gYGBgXG5cbiAtIG1hbnVhbCAtIGJhY2tncm91bmQgd2lsbCBuZSBub3Qgc2NhbGVkIGFuZCBwdXQgYXQgbGVmdCB0b3AgY29ybmVyXG4gLSByZXNpemUgLSBjYW52YXMgd2lsbCBiZSByZXNpemVkIGFjY29yZGluZyB0byBpbWFnZSBzaXplXG4gLSBmaXQgLSB3aWxsIGJlIHNjYWxlZCB0byBmaXQgY2FudmFzIHNpemVcbiAtIGNvdmVyIC0gd2lsbCBiZSBzY2FsZWQgdG8gY292ZXIgYWxsIGNhbnZhcyBzaXplXG4gLSBjZW50ZXIgLSBiYWNrb2dydW5kIHdpbGwgYmUgbm90IHNjYWxlZCBidXQgcHV0IGluIHRoZSBtaWRkbGVcblxuICMjIyBtZXRob2Q6IHNldEludGVyYWN0aXZlTW9kZVxuXG4gc3dpdGNoIGJldHdlZW4gZHJhd2luZyBhbmQgaGFuZCggbW92aW5nIGN1bnZhcyBieSBtb3VzZSkgbW9kZXNcblxuIGBgYGphdmFzY3JpcHRcbiBjYW52YXMuc2V0SW50ZXJhY3RpdmVNb2RlKCBtb2RlIDogXCJoYW5kXCIgfCBcIm1peGVkXCIpIDogdm9pZFxuIGBgYFxuXG4gIyMjIGRyYXdpbmdDb2xvclxuXG4gZHJhd2luZyBjb2xvciB1c2luZyBieSBicnVzaGVzXG5cbiAqL1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuXG4gIHNldEJhY2tncm91bmRDb2xvcjogZnVuY3Rpb24oYmFja2dyb3VuZENvbG9yLCBjYWxsYmFjaykge1xuXG4gICAgaWYodGhpcy5sb2FkZWQpIHtcbiAgICAgIHRoaXMuc2F2ZVN0YXRlKFtcImJhY2tncm91bmRDb2xvclwiXSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuX19zZXRCZ092ZXJsYXlDb2xvcignYmFja2dyb3VuZENvbG9yJywgYmFja2dyb3VuZENvbG9yLCAoKSA9PiB7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuXG4gICAgICBpZih0aGlzLmxvYWRlZCl7XG4gICAgICAgIHRoaXMuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKClcbiAgICB9KTtcbiAgfSxcbiAgc3RvcmVQcm9wZXJ0aWVzOiBbJ29iamVjdHMnLCdiYWNrZ3JvdW5kQ29sb3InLCdvdmVybGF5Q29sb3InLCdiYWNrZ3JvdW5kSW1hZ2UnLCdvdmVybGF5SW1hZ2UnLCd3aWR0aCcsJ2hlaWdodCddLFxuICB0b09iamVjdFN5bmM6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IChwcm9wZXJ0aWVzVG9JbmNsdWRlIHx8IFtdKS5jb25jYXQodGhpcy5zdG9yZVByb3BlcnRpZXMpO1xuXG4gICAgbGV0IF9kYXRhID0ge1xuICAgICAgb2JqZWN0czogdGhpcy5nZXRPYmplY3RzKCksXG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQsXG4gICAgfTtcbiAgICBmYWJyaWMudXRpbC5wb3B1bGF0ZVdpdGhQcm9wZXJ0aWVzKHRoaXMsIF9kYXRhLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcblxuXG4gICAgdGhpcy5maXJlKFwiYmVmb3JlOm9iamVjdFwiLHtvYmplY3Q6IF9kYXRhfSk7XG5cbiAgICByZXR1cm4gX2RhdGE7XG4gIH0sXG4gIC8qc3RvcmVfdGh1bWI6IGZ1bmN0aW9uICgpe1xuICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnModGhpcy5nZXRPcmlnaW5hbFNpemUoKSwgdGhpcy50aHVtYlNpemUsICdmaXQnKTtcbiAgICB2YXIgY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIGNhbnZhcy53aWR0aCA9IHNpemUud2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuICAgIHRoaXMucmVuZGVyVGh1bWIoY2FudmFzKTtcbiAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCgpO1xuICB9LFxuICBzdG9yZV90ZW1wbGF0ZTogZnVuY3Rpb24ocHJvcGVydGllc1RvSW5jbHVkZSwgX2RhdGEpIHtcbiAgICBpZiAodGhpcy50ZW1wbGF0ZSkge1xuICAgICAgZm9yICh2YXIgaSBpbiBfZGF0YS50ZW1wbGF0ZSkge1xuICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkoX2RhdGFbaV0pID09IEpTT04uc3RyaW5naWZ5KF9kYXRhLnRlbXBsYXRlW2ldKSkge1xuICAgICAgICAgIGRlbGV0ZSBfZGF0YVtpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMudGVtcGxhdGUuaWQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9LCovXG4gIHN0b3JlX2JhY2tncm91bmRJbWFnZTogZnVuY3Rpb24oKXtcbiAgICBpZiAodGhpcy5iYWNrZ3JvdW5kSW1hZ2UgJiYgIXRoaXMuYmFja2dyb3VuZEltYWdlLmV4Y2x1ZGVGcm9tRXhwb3J0KSB7XG4gICAgICByZXR1cm4gdGhpcy5iYWNrZ3JvdW5kSW1hZ2UudG9PYmplY3QoKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIHN0b3JlX292ZXJsYXlJbWFnZTogZnVuY3Rpb24oKXtcbiAgICBpZiAodGhpcy5vdmVybGF5SW1hZ2UgJiYgIXRoaXMub3ZlcmxheUltYWdlLmV4Y2x1ZGVGcm9tRXhwb3J0KSB7XG4gICAgICByZXR1cm4gdGhpcy5vdmVybGF5SW1hZ2UudG9PYmplY3QoKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIHN0b3JlX2JhY2tncm91bmRDb2xvcjogZnVuY3Rpb24oKXtcbiAgICBpZighdGhpcy5iYWNrZ3JvdW5kQ29sb3IpcmV0dXJuIFwiXCI7XG4gICAgcmV0dXJuIHRoaXMuYmFja2dyb3VuZENvbG9yLnRvT2JqZWN0XG4gICAgICA/IHRoaXMuYmFja2dyb3VuZENvbG9yLnRvT2JqZWN0KClcbiAgICAgIDogdGhpcy5iYWNrZ3JvdW5kQ29sb3I7XG4gIH0sXG4gIHN0b3JlX3dpZHRoOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgfSxcbiAgc3RvcmVfaGVpZ2h0OiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICB9LFxuICBzdG9yZV9vdmVybGF5Q29sb3I6IGZ1bmN0aW9uKCl7XG4gICAgaWYoIXRoaXMub3ZlcmxheUNvbG9yKXJldHVybiBcIlwiO1xuICAgIHJldHVybiB0aGlzLm92ZXJsYXlDb2xvci50b09iamVjdFxuICAgICAgPyB0aGlzLm92ZXJsYXlDb2xvci50b09iamVjdCgpXG4gICAgICA6IHRoaXMub3ZlcmxheUNvbG9yO1xuICB9LFxuICBzdG9yZV9vYmplY3RzOiBmdW5jdGlvbigpe1xuICAgIGxldCBfb2JqcyA9IGZhYnJpYy51dGlsLm9iamVjdC5maWx0ZXIodGhpcy5nZXRPYmplY3RzKCkse3N0b3JlZDogdHJ1ZX0pO1xuICAgIGlmKCFfb2Jqcy5sZW5ndGgpcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIF9vYmpzLm1hcChpbnN0YW5jZSA9PiB7XG4gICAgICByZXR1cm4gaW5zdGFuY2UudG9PYmplY3QodGhpcy5vYmplY3RzUHJvcGVydGllc1RvSW5jbHVkZSk7XG4gICAgfSk7XG4gIH0sXG4gIHRvT2JqZWN0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS50b09iamVjdCxcblxuICBhZGRUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jcmVhdGVPYmplY3Qoe1xuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgICAgcG9zaXRpb246IFwiY2VudGVyXCIsXG4gICAgICB0eXBlOiAgIHRoaXMuZGVmYXVsdFRleHRUeXBlLFxuICAgICAgY2xpcFRvOiB0aGlzLmFjdGl2ZUFyZWEsXG4gICAgICB0ZXh0OiB0aGlzLmRlYWZ1bHRUZXh0LFxuICAgICAgbW92ZW1lbnRMaW1pdHMgOiB0aGlzLmFjdGl2ZUFyZWFcbiAgICB9KTtcbiAgfVxufSk7XG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLFxuICAvLyBmYWJyaWMuUGx1Z2luc01peGluLFxuICB7XG4gIHR5cGU6ICdjYW52YXMnLFxuICAvKipcbiAgICogaW5pdGlhbGl6ZWQgd2lkdGggb2YgdGhlIGNhbnZhc1xuICAgKi9cbiAgd2lkdGg6IDE2MCAsXG4gIC8qKlxuICAgKiBpbml0aWFsaXplZCBoZWlnaHQgb2YgdGhlIGNhbnZhc1xuICAgKi9cbiAgaGVpZ2h0OiA5MCxcbiAgLyoqXG4gICAqIG91dHB1dCBxdWFsaXR5XG4gICAqL1xuICBkb3RzUGVyVW5pdDogMSxcbiAgc2NhbGU6IDEsXG4gIGxvYWRlZDogZmFsc2UsXG4gIC8qKlxuICAgKiBhbGxvdyB1c2VyIHRvIGludGVyYWN0IHdpdGggY2FudmFzXG4gICAqL1xuICBpbnRlcmFjdGl2ZTogdHJ1ZSxcbiAgLyoqXG4gICAqIGZpbGwgbm90IHRoZSBzbGlkZSBhcmVhLCBidXQgd2hvbGUgY2FudmFzIHdpdGggYmFja2dyb3VuZCBjb2xvclxuICAgKi9cbiAgZGVmYXVsdFRleHRUeXBlOiBcInRleHRcIixcblxuICB0aHVtYlNpemU6IHtcbiAgICB3aWR0aDogNTAsXG4gICAgaGVpZ2h0OiAxMDBcbiAgfSxcbiAgY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDogdHJ1ZSxcbiAgc2V0SW50ZXJhY3RpdmUgKHZhbHVlKSB7XG4gICAgdGhpcy5pbnRlcmFjdGl2ZSA9IHZhbHVlO1xuICB9LFxuICBzZXRDb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkICgpIHtcbiAgICBsZXQgY3R4ID0gdGhpcy5jb250ZXh0VG9wO1xuICAgIGlmKGN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQpe1xuICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY3R4LndlYmtpdEltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICBjdHgubW96SW1hZ2VTbW9vdGhpbmdFbmFibGVkICAgID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgIGN0eC5tc0ltYWdlU21vb3RoaW5nRW5hYmxlZCAgICAgPSB0aGlzLmNvbnRleHRUb3BJbWFnZVNtb290aGluZ0VuYWJsZWQ7XG4gICAgY3R4Lm9JbWFnZVNtb290aGluZ0VuYWJsZWQgICAgICA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgfSxcbiAgX29uTW91c2VVcEluRHJhd2luZ01vZGU6IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLl9pc0N1cnJlbnRseURyYXdpbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIHRoaXMuY29udGV4dFRvcC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIGxldCBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUpO1xuICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaC5vbk1vdXNlVXAocG9pbnRlcik7XG4gICAgdGhpcy5faGFuZGxlRXZlbnQoZSwgJ3VwJyk7XG4gIH0sXG4gIF9jbGVhck9iamVjdHM6IGZ1bmN0aW9uKCl7XG4gICAgbGV0IF9vbGRPYmplY3RzID0gdGhpcy5fb2JqZWN0cy5zcGxpY2UoMCk7XG5cbiAgICBpZiAodGhpcy5faGFzSVRleHRIYW5kbGVycykge1xuICAgICAgdGhpcy5vZmYoJ21vdXNlOnVwJywgdGhpcy5fbW91c2VVcElUZXh0SGFuZGxlcik7XG4gICAgICB0aGlzLl9pVGV4dEluc3RhbmNlcyA9IG51bGw7XG4gICAgICB0aGlzLl9oYXNJVGV4dEhhbmRsZXJzID0gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBfb2xkT2JqZWN0cztcbiAgfSxcbiAgY2xlYXJPYmplY3RzOiBmdW5jdGlvbigpe1xuXG4gICAgdmFyIF9vbGRPYmplY3RzID0gdGhpcy5fY2xlYXJPYmplY3RzKCk7XG4gICAgdGhpcy5jbGVhckNvbnRleHQodGhpcy5jb250ZXh0Q29udGFpbmVyKTtcbiAgICB0aGlzLmZpcmUoJ2NhbnZhczpjbGVhcmVkJyx7b2JqZWN0czogX29sZE9iamVjdHN9KTtcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICByZW5kZXJQYWdlQmFja2dyb3VuZDogZmFsc2UsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChlbCwgb3B0aW9ucyxjYWxsYmFjaykge1xuICAgIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgaWYoZWwgJiYgZWwuY29uc3RydWN0b3IgPT0gT2JqZWN0KXtcbiAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSBlbDtcbiAgICAgIGVsID0gbnVsbDtcbiAgICB9XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICBpZihvcHRpb25zLmFwcGxpY2F0aW9uKXtcbiAgICAgIG9wdGlvbnMuYXBwbGljYXRpb24uZmlyZShcImVudGl0eTpjcmVhdGVkXCIse3RhcmdldCA6IHRoaXMgLCBvcHRpb25zIDogb3B0aW9uc30pO1xuICAgIH1cblxuICAgIHRoaXMuZmlyZShcImJlZm9yZTpjcmVhdGVkXCIse29wdGlvbnM6IG9wdGlvbnN9KTtcblxuICAgIHRoaXMuX29iamVjdHMgPSBbXTtcbiAgICB0aGlzLl9oZWxwZXJzT2JqZWN0cyA9IFtdO1xuICAgIHRoaXMuX2NyZWF0ZUxvd2VyQ2FudmFzKGVsKTtcblxuICAgIHRoaXMuY3JlYXRlZCA9IHRydWU7XG4gICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybSA9IG51bGw7XG4gICAgdGhpcy5fZ3JvdXBTZWxlY3RvciA9IG51bGw7XG4gICAgdGhpcy5faW5pdFdyYXBwZXJFbGVtZW50KCk7XG4gICAgdGhpcy5fY3JlYXRlVXBwZXJDYW52YXMoKTtcbiAgICB0aGlzLl9pbml0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLmNhbGNPZmZzZXQoKTtcblxuICAgIHRoaXMud3JhcHBlckVsLmFwcGVuZENoaWxkKHRoaXMudXBwZXJDYW52YXNFbCk7XG5cbiAgICB0aGlzLl9jcmVhdGVDYWNoZUNhbnZhcygpO1xuICAgIHRoaXMuX3NldEltYWdlU21vb3RoaW5nKCk7XG4gICAgdGhpcy5faW5pdFJldGluYVNjYWxpbmcoKTtcblxuICAgIHRoaXMuX2luaXRTaXplKCk7XG4gICAgdGhpcy5zZXQob3B0aW9ucyk7XG5cbiAgICBpZih0aGlzLnJlbmRlclBhZ2VCYWNrZ3JvdW5kKXtcbiAgICAgIHRoaXMuYmFja2dyb3VuZFJlY3QgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCxcbiAgICAgICAgc2hhZG93OiB7XG4gICAgICAgICAgb2Zmc2V0WDogIDEsXG4gICAgICAgICAgb2Zmc2V0WTogIDMsXG4gICAgICAgICAgYmx1cjogIDEwLFxuICAgICAgICAgIGNvbG9yOiAncmdiYSgwLDAsMCwwLjYpJ1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICB0aGlzLnVwZGF0ZUZvbnRzKCk7XG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG5cblxuICAgIHRoaXMub24oe1xuICAgICAgJ2NhbnZhczpjbGVhcmVkJzogZnVuY3Rpb24gY2FudmFzQ2xlYXJlZCgpIHtcbiAgICAgICAgdmFyIGV2ZW50ID0ge307XG4gICAgICAgIGV2ZW50LnByZXZpb3VzID0gdGhpcy5hcHBsaWNhdGlvbi50YXJnZXQ7XG4gICAgICAgIGlmKGV2ZW50LnByZXZpb3VzKXtcbiAgICAgICAgICBldmVudC5wcmV2aW91cy5maXJlKCdkZXNlbGVjdGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi50YXJnZXQgPSBudWxsO1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLmZpcmUoJ3RhcmdldDpjbGVhcmVkJyxldmVudCk7XG4gICAgICB9LFxuICAgICAgJ29iamVjdDptb2RpZmllZCc6IGZ1bmN0aW9uIHRhcmdldE1vZGlmZWQoZSkge1xuICAgICAgICBpZih0aGlzLmFwcGxpY2F0aW9uLnRhcmdldCA9PT0gZS50YXJnZXQpe1xuICAgICAgICAgIHRoaXMuYXBwbGljYXRpb24uZmlyZSgndGFyZ2V0Om1vZGlmaWVkJywge3RhcmdldDogZS50YXJnZXQsIGNhbnZhczogdGhpc30pXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAnc2VsZWN0aW9uOmNsZWFyZWQnOiBmdW5jdGlvbiB0YXJnZXRDbGVhcihldmVudCkge1xuICAgICAgICBpZighdGhpcy5hcHBsaWNhdGlvbi50YXJnZXQpcmV0dXJuO1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLnRhcmdldC5maXJlKCdkZXNlbGVjdGVkJywgZXZlbnQpO1xuXG4gICAgICAgIGlmKHRoaXMuYXBwbGljYXRpb24udGFyZ2V0LmNhbnZhcyA9PT0gdGhpcyl7XG4gICAgICAgICAgZXZlbnQucHJldmlvdXMgPSB0aGlzLmFwcGxpY2F0aW9uLnRhcmdldDtcbiAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLnRhcmdldCA9IG51bGw7XG4gICAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi5maXJlKCd0YXJnZXQ6Y2xlYXJlZCcsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICdvYmplY3Q6c2VsZWN0ZWQnOiBmdW5jdGlvbiB0YXJnZXRDaGFuZ2VkKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZpb3VzID0gdGhpcy5hcHBsaWNhdGlvbi50YXJnZXQ7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb24udGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBpZihldmVudC5wcmV2aW91cyl7XG4gICAgICAgICAgZXZlbnQucHJldmlvdXMuZmlyZSgnZGVzZWxlY3RlZCcsIGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLmZpcmUoJ3RhcmdldDpjaGFuZ2VkJywgZXZlbnQpO1xuICAgICAgfSxcbiAgICAgICdncm91cDpzZWxlY3RlZCc6IGZ1bmN0aW9uIHRhcmdldENoYW5nZWQoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmlvdXMgPSB0aGlzLmFwcGxpY2F0aW9uLnRhcmdldDtcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi50YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb24uZmlyZSgndGFyZ2V0OmNoYW5nZWQnLCBldmVudCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5maXJlKFwiY3JlYXRlZFwiKTtcbiAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuXG5cbiAgICAvLyBpZih0aGlzLmFwcGxpY2F0aW9uKXtcbiAgICAvLyAgIHRoaXMuYXBwbGljYXRpb24uZmlyZShcImNhbnZhczpjcmVhdGVkXCIse3RhcmdldCA6IHRoaXN9KTtcbiAgICAvLyB9XG4gIH0sXG4gIGFuaW1hdGVkOiBmYWxzZSxcbiAgc2V0QW5pbWF0ZWQ6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5hbmltYXRlZCA9IHZhbDtcbiAgICBpZih2YWwpe1xuICAgICAgZmFicmljLnV0aWwucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICAgIGZhYnJpYy51dGlsLnJlcXVlc3RBbmltRnJhbWUocmVuZGVyKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNyZWF0ZWQgPSB0cnVlO1xuICAgIHRoaXMuX2luaXRJbnRlcmFjdGl2ZSgpO1xuICAgIHRoaXMuX2NyZWF0ZUNhY2hlQ2FudmFzKCk7XG4gIH1cbn0pO1xuZmFicmljLkNhbnZhcy5mcm9tSnNvbiA9IGZ1bmN0aW9uKHVybCxjYWxsYmFjayAsIGVsZW1lbnQpe1xuICBmYWJyaWMudXRpbC5kYXRhLmxvYWRKc29uKHVybCxmdW5jdGlvbihkYXRhKXtcbiAgICBuZXcgZmFicmljLkNhbnZhcyhlbGVtZW50LGRhdGEsY2FsbGJhY2spXG4gIH0pXG59O1xuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvcmUvc2xpZGUuanMiLCJcblxuZmFicmljLlBSRVZJRVcgPSB7XG4gIE5PTkU6IDAsXG4gIFNJTkdMRTogMSxcbiAgQUxMOiAyXG59XG5cbmZhYnJpYy5FZGl0b3IucHJvdG90eXBlLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzLnB1c2goXCJzbGlkZXNcIik7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLCB7XG4gIGRlZmF1bHRPcHRpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLmRlZmF1bHRPcHRpb25zLHtcbiAgICBhY3RpdmVTbGlkZTogMFxuICB9KSxcbiAgcHJldmlld01vZGU6IGZhYnJpYy5QUkVWSUVXLlNJTkdMRSxcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuRWRpdG9yLnByb3RvdHlwZS5vcHRpb25zT3JkZXI7XG4gICAgb28ucHVzaChcInNsaWRlc1wiLFwiYWN0aXZlU2xpZGVcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpLFxuICBfc2V0U2xpZGVzRGF0YTogZnVuY3Rpb24gKHNsaWRlcykge1xuXG4gICAgaWYodGhpcy5zbGlkZXMpe1xuICAgICAgdGhpcy5zbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB7XG4gICAgICAgIHNsaWRlLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgICAgICBzbGlkZS5kaXNwb3NlKCk7XG4gICAgICAgIHNsaWRlLmxvd2VyQ2FudmFzRWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzbGlkZS5sb3dlckNhbnZhc0VsKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLnNsaWRlcyA9IFtdO1xuXG4gICAgaWYgKHRoaXMuY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbnZhcy5fb2JqZWN0cy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICBzbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB0aGlzLmFkZFNsaWRlKHNsaWRlKSk7XG5cbiAgICBmdW5jdGlvbiBvblNsaWRlTG9hZGVkKCkge1xuICAgICAgZm9yKGxldCBzbGlkZSBvZiB0aGlzLnNsaWRlcyl7XG4gICAgICAgIGlmKCFzbGlkZS5sb2FkZWQpcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5maXJlKFwibG9hZGluZzplbmRcIiwge30pO1xuICAgICAgdGhpcy5vZmYoXCJzbGlkZTpsb2FkaW5nOmVuZFwiLG9uU2xpZGVMb2FkZWQpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYoIW9uU2xpZGVMb2FkZWQuY2FsbCh0aGlzKSl7XG4gICAgICB0aGlzLm9uKFwic2xpZGU6bG9hZGluZzplbmRcIixvblNsaWRlTG9hZGVkKTtcbiAgICB9XG4gIH0sXG4gIF9wYXJzZV9mdW5jdGlvbl9qc29uOiBmdW5jdGlvbiAodmFsdWUsIGNhbGxiYWNrRm4sIGVycm9yRm4pIHtcbiAgICBpZih0eXBlb2YgdmFsdWUgPT09IFwiZnVuY3Rpb25cIil7XG4gICAgICBpZih2YWx1ZS5sZW5ndGgpe1xuICAgICAgICByZXR1cm4gdmFsdWUuY2FsbCh0aGlzLGNhbGxiYWNrRm4gLGVycm9yRm4pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHZhbHVlID0gdmFsdWUuY2FsbCh0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZmFicmljLnV0aWwuZGF0YS5sb2FkSnNvbih2YWx1ZSwgY2FsbGJhY2tGbixlcnJvckZuKTtcbiAgfSxcbiAgc2V0U2xpZGU6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2tGbikge1xuICAgIHRoaXMuX3BhcnNlX2Z1bmN0aW9uX2pzb24odmFsdWUsIHNsaWRlID0+IHtcbiAgICAgIHRoaXMuX3NldFNsaWRlc0RhdGEoW3NsaWRlXSk7XG4gICAgICB0aGlzLl9zZXRBY3RpdmVTbGlkZSh0aGlzLnNsaWRlc1swXSk7XG4gICAgICBjYWxsYmFja0ZuICYmIGNhbGxiYWNrRm4oKTtcbiAgICB9LCgpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJzbGlkZSBsb2FkaW5nIGZhaWxlZFwiKTtcbiAgICAgIGNhbGxiYWNrRm4gJiYgY2FsbGJhY2tGbigpO1xuICAgIH0pXG4gIH0sXG4gIHNldFNsaWRlczogZnVuY3Rpb24gKHZhbHVlLCBjYWxsYmFja0ZuKSB7XG4gICAgdGhpcy5fcGFyc2VfZnVuY3Rpb25fanNvbih2YWx1ZSwgc2xpZGUgPT4ge1xuICAgICAgdGhpcy5fc2V0U2xpZGVzRGF0YShzbGlkZSk7XG4gICAgICBjYWxsYmFja0ZuICYmIGNhbGxiYWNrRm4oKTtcbiAgICB9LCgpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJzbGlkZXMgbG9hZGluZyBmYWlsZWRcIilcbiAgICAgIGNhbGxiYWNrRm4gJiYgY2FsbGJhY2tGbigpO1xuICAgIH0pXG4gIH0sXG4gIF9zZXRBY3RpdmVTbGlkZShzbGlkZSl7XG5cbiAgICBpZih0aGlzLmNhbnZhcyA9PT0gc2xpZGUpIHJldHVybjtcbiAgICAvLyB0aGlzLmZpcmUoXCJzbGlkZTpjaGFuZ2U6YmVnaW5cIiwge2NhbnZhczogdGhpcy5jYW52YXN9KTtcbiAgICBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmUoZmFsc2UpO1xuICAgIH1cbiAgICB0aGlzLmNhbnZhcyA9IHNsaWRlO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZSh0cnVlKTtcbiAgICB0aGlzLmNhbnZhcy5fb25SZXNpemUoKTtcbiAgICB0aGlzLmZpcmUoXCJzbGlkZTpjaGFuZ2VkXCIsIHtjYW52YXM6IHRoaXMuY2FudmFzfSk7XG4gIH0sXG4gIHNldEFjdGl2ZVNsaWRlOiBmdW5jdGlvbihzbGlkZUlkKXtcblxuICAgIGxldCBzbGlkZTtcblxuICAgIGlmKCF0aGlzLnNsaWRlcyl7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmKHNsaWRlSWQuY29uc3RydWN0b3IgPT09IE51bWJlcil7XG4gICAgICBzbGlkZSA9IHRoaXMuc2xpZGVzW3NsaWRlSWRdO1xuICAgIH1cbiAgICBlbHNlIGlmKHNsaWRlSWQuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG5cbiAgICB9ZWxzZXtcbiAgICAgIHNsaWRlID0gc2xpZGVJZDtcbiAgICB9XG5cbiAgICBpZih0aGlzLmFjdGl2ZVNsaWRlID09PSBzbGlkZSlyZXR1cm47XG5cbiAgICBpZihzbGlkZS5sb2FkZWQpe1xuICAgICAgdGhpcy5fc2V0QWN0aXZlU2xpZGUoc2xpZGUpO1xuICAgIH1lbHNle1xuICAgICAgc2xpZGUub24oXCJsb2FkaW5nOmVuZFwiLCgpID0+IHtcbiAgICAgICAgdGhpcy5fc2V0QWN0aXZlU2xpZGUoc2xpZGUpO1xuICAgICAgfSlcbiAgICB9XG4gIH0sXG4gIHVubG9hZFVuYWN0aXZlU2xpZGVzOiBmYWxzZSxcbiAgLy8gbGF6eUxvYWRFbmFibGVkOiB0cnVlLFxuICAvLyBsYXp5TG9hZDogZnVuY3Rpb24oKXtcbiAgLy9cbiAgLy8gICB2YXIgYXBwID0gdGhpcztcbiAgLy8gICBpZih0aGlzLmxhenlMb2FkRW5hYmxlZCl7XG4gIC8vICAgICB0aGlzLnNsaWRlcy5mb3JFYWNoKGZ1bmN0aW9uKHNsaWRlKXtcbiAgLy8gICAgICAgaWYoIXNsaWRlLmxvYWRlZCAmJiAhc2xpZGUucHJvY2Vzc2luZyl7XG4gIC8vICAgICAgICAgc2xpZGUubG9hZChzbGlkZS5vYmplY3QsZnVuY3Rpb24oKXtcbiAgLy8gICAgICAgICAgIHNsaWRlLmZpcmUoXCJsb2FkZWRcIik7XG4gIC8vICAgICAgICAgICAvLyBpZihhcHAuYWN0aXZlU2xpZGUgPT09IHNsaWRlLmlkKXtcbiAgLy8gICAgICAgICAgIC8vICAgdGhpcy5zZXRBY3RpdmVTbGlkZShzbGlkZSk7XG4gIC8vICAgICAgICAgICAvLyB9XG4gIC8vXG4gIC8vICAgICAgICAgICAvLyBhcHAuZmlyZShcInNsaWRlOmxvYWRpbmc6ZW5kXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgLy9cbiAgLy8gICAgICAgICAgIGZvcih2YXIgX3MgaW4gYXBwLnNsaWRlcyl7XG4gIC8vICAgICAgICAgICAgIGlmKCFhcHAuc2xpZGVzW19zXS5sb2FkZWQpe1xuICAvLyAgICAgICAgICAgICAgIHJldHVybjtcbiAgLy8gICAgICAgICAgICAgfVxuICAvLyAgICAgICAgICAgfVxuICAvLyAgICAgICAgICAgYXBwLmZpcmUoXCJsb2FkaW5nOmVuZFwiLCB7fSk7XG4gIC8vICAgICAgICAgfS5iaW5kKHNsaWRlKSk7XG4gIC8vICAgICAgIH1cbiAgLy8gICAgIH0pO1xuICAvLyAgIH1lbHNle1xuICAvLyAgICAgYXBwLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt9KTtcbiAgLy8gICB9XG4gIC8vIH0sXG4gIGFkZFNsaWRlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIGxldCBzbGlkZSA9IHRoaXMuY3JlYXRlQ2FudmFzKG9wdGlvbnMpO1xuICAgIHNsaWRlLmxvYWQob3B0aW9ucyk7XG5cbiAgICB0aGlzLnNsaWRlcy5wdXNoKHNsaWRlKTtcbiAgICBpZiAodGhpcy5wcmV2aWV3TW9kZSA9PT0gZmFicmljLlBSRVZJRVcuQUxMKSB7XG4gICAgICBpZih0aGlzLmNhbnZhc0NvbnRhaW5lcikge1xuICAgICAgICB0aGlzLmNhbnZhc0NvbnRhaW5lci5hcHBlbmRDaGlsZChzbGlkZS53cmFwcGVyRWwpO1xuICAgICAgICBzbGlkZS5fb25SZXNpemUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzbGlkZS5vbihcIm1vdXNlOmRvd25cIixmdW5jdGlvbigpe1xuICAgICAgdGhpcy5hcHBsaWNhdGlvbi5zZXRBY3RpdmVTbGlkZSh0aGlzKTtcbiAgICB9LHRydWUpO1xuXG4gICAgdGhpcy5maXJlKFwic2xpZGU6Y3JlYXRlZFwiLHt0YXJnZXQ6c2xpZGV9KVxuICAgIHJldHVybiBzbGlkZTtcbiAgfSxcbiAgcmVtb3ZlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZSkge1xuICAgIHZhciBfcyA9IHRoaXMuc2xpZGVzO1xuICAgIHZhciBfY3VyUG9zID0gX3MuaW5kZXhPZihzbGlkZSk7XG4gICAgX3Muc3BsaWNlKF9jdXJQb3MsIDEpO1xuICAgIHNsaWRlLmZpcmUoXCJyZW1vdmVkXCIpO1xuXG4gICAgaWYoIHNsaWRlID09PSB0aGlzLmFjdGl2ZVNsaWRlICl7XG4gICAgICBkZWxldGUgdGhpcy5hY3RpdmVTbGlkZSA7XG4gICAgfVxuXG4gICAgaWYodGhpcy5zbGlkZXMubGVuZ3RoID09PSAwKXtcbiAgICAgIHZhciBzbGlkZURhdGEgPSB7fTtcbiAgICAgIHZhciBfc2xpZGUgPSB0aGlzLmFkZFNsaWRlKHNsaWRlRGF0YSk7XG4gICAgICBfc2xpZGUubG9hZChfc2xpZGUub2JqZWN0KTtcbiAgICAgIHRoaXMuc2V0QWN0aXZlU2xpZGUoMCk7XG4gICAgfWVsc2UgaWYodGhpcy5zbGlkZXMubGVuZ3RoID4gX2N1clBvcyl7XG4gICAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKF9jdXJQb3MpO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5zZXRBY3RpdmVTbGlkZShfY3VyUG9zIC0gMSk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICogbW92ZSBzbGlkZSB0byBhbm90aGVyIHBvc2l0aW9uXG4gICAqIEBwYXJhbSBzbGlkZVxuICAgKiBAcGFyYW0gbmV3UG9zaXRpb25cbiAgICovXG4gIG1vdmVTbGlkZTogZnVuY3Rpb24gKHNsaWRlLG5ld1Bvc2l0aW9uKSB7XG4gICAgdmFyIF9zID0gdGhpcy5zbGlkZXM7XG5cbiAgICB2YXIgX2N1clBvcyA9IF9zLmluZGV4T2Yoc2xpZGUpO1xuICAgIG5ld1Bvc2l0aW9uID0gcGFyc2VJbnQobmV3UG9zaXRpb24pO1xuXG4gICAgaWYgKF9jdXJQb3MgPCBuZXdQb3NpdGlvbikge1xuICAgICAgX3Muc3BsaWNlKF9jdXJQb3MsIDEpO1xuICAgICAgX3Muc3BsaWNlKG5ld1Bvc2l0aW9uLDAsIHNsaWRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX3Muc3BsaWNlKF9jdXJQb3MsIDEpO1xuICAgICAgX3Muc3BsaWNlKG5ld1Bvc2l0aW9uLCAwLCBzbGlkZSk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICogcmVwbGFjZSBzbGlkZVxuICAgKiBAcGFyYW0gc2xpZGVcbiAgICogQHBhcmFtIG5ld1Bvc2l0aW9uIC0gcG9zaXRpb24gb2YgdGhlIHNlY29uZCBzbGlkZVxuICAgKi9cbiAgcmVwbGFjZVNsaWRlOiBmdW5jdGlvbiAoc2xpZGUsbmV3UG9zaXRpb24pIHtcbiAgICB2YXIgX3MgPSB0aGlzLnNsaWRlcztcbiAgICB2YXIgX3JlcGxhY2VkU2xpZGUgPSBfc1tuZXdQb3NpdGlvbl07XG4gICAgdmFyIF9jdXJQb3MgPSBfcy5pbmRleE9mKHNsaWRlKTtcbiAgICBpZiAoX2N1clBvcyA8IG5ld1Bvc2l0aW9uKSB7XG4gICAgICBfcy5zcGxpY2UobmV3UG9zaXRpb24sIDEsIHNsaWRlKTtcbiAgICAgIF9zLnNwbGljZShfY3VyUG9zLCAxLCBfcmVwbGFjZWRTbGlkZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9zLnNwbGljZShfY3VyUG9zLCAxLCBfcmVwbGFjZWRTbGlkZSk7XG4gICAgICBfcy5zcGxpY2UobmV3UG9zaXRpb24sIDEsIHNsaWRlKTtcbiAgICB9XG4gIH0sXG4gIC8vIHByZWxvYWQ6IGZ1bmN0aW9uKCl7XG4gIC8vICAgZm9yKHZhciBpIGluIHRoaXMuc2xpZGVzKSB7XG4gIC8vICAgICB2YXIgX3NsaWRlID0gdGhpcy5zbGlkZXNbaV07XG4gIC8vICAgICAvLyBfc2xpZGUuY2FudmFzLnByZWxvYWQoX3NsaWRlLm9iamVjdCwgZnVuY3Rpb24gKCkge1xuICAvLyAgICAgLy8gICBfc2xpZGUuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAvLyAgICAgLy8gfSk7XG4gIC8vICAgfVxuICAvLyB9LFxuICBzZXRBY3RpdmVTbGlkZUJ5SW5kZXg6IGZ1bmN0aW9uKGluZGV4KXtcbiAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKHRoaXMuc2xpZGVzW2luZGV4XSlcbiAgfSxcbiAgc2V0QWN0aXZlU2xpZGVCeUlkOiBmdW5jdGlvbihpZCl7XG4gICAgdGhpcy5zZXRBY3RpdmVTbGlkZSggIGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5zbGlkZXMse2lkOiBpZH0pKTtcbiAgfSxcbiAgZHVwbGljYXRlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZURhdGEpIHtcbiAgICBzbGlkZURhdGEgPSBzbGlkZURhdGEudG9PYmplY3QoKTtcbiAgICB2YXIgX3NsaWRlID0gdGhpcy5hZGRTbGlkZShzbGlkZURhdGEpO1xuICAgIF9zbGlkZS5sb2FkKF9zbGlkZS5vYmplY3QpO1xuICB9LFxuICBuZXh0U2xpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaSA9IHRoaXMuc2xpZGVzLmluZGV4T2YodGhpcy5hY3RpdmVTbGlkZSk7XG4gICAgaWYgKGkgPCB0aGlzLnNsaWRlcy5sZW5ndGggLSAxKSB7XG4gICAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKGkgKyAxKTtcbiAgICB9XG4gIH0sXG4gIHByZXZTbGlkZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpID0gdGhpcy5zbGlkZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVNsaWRlKTtcbiAgICBpZiAoaSA+IDApIHtcbiAgICAgIHRoaXMuc2V0QWN0aXZlU2xpZGUoaSAtIDEpO1xuICAgIH1cbiAgfSxcbiAgZ290b1NsaWRlOiBmdW5jdGlvbiAoc2xpZGUpIHtcbiAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKHNsaWRlIC0gMSk7XG4gIH0sXG4gIG5leHRTbGlkZUF2YWlsYWJsZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpID0gdGhpcy5zbGlkZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVNsaWRlKTtcbiAgICByZXR1cm4gaSA8IHRoaXMuc2xpZGVzLmxlbmd0aCAtIDFcbiAgfSxcbiAgcHJldlNsaWRlQXZhaWxhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGkgPSB0aGlzLnNsaWRlcy5pbmRleE9mKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIHJldHVybiBpID4gMFxuICB9LFxuICBjcmVhdGVTbGlkZXNMaXN0RWxlbWVudDogZnVuY3Rpb24oc2xpZGUpe1xuICAgIGxldCAkZWxlbWVudCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICAkZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwxNDApO1xuICAgIGZhYnJpYy51dGlsLmNyZWF0ZVRodW1iKHNsaWRlLCRlbGVtZW50KTtcblxuICAgIHNsaWRlLiRzbGlkZUVsZW1lbnQgPSAkKFwiPGRpdj5cIilcbiAgICAgIC5hZGRDbGFzcyhcInNsaWRlXCIpXG4gICAgICAuY2xpY2soKCkgPT4gdGhpcy5zZXRBY3RpdmVTbGlkZShzbGlkZSkpXG4gICAgICAuYXBwZW5kKCRlbGVtZW50KVxuICAgICAgLmFwcGVuZCgkKFwiPHNwYW4+XCIpLmh0bWwoc2xpZGUudGl0bGUpKTtcblxuXG4gICAgaWYoc2xpZGUuZGVzY3JpcHRpb24pe1xuICAgICAgc2xpZGUuJHNsaWRlRWxlbWVudC5hdHRyKFwidGl0bGVcIixzbGlkZS5kZXNjcmlwdGlvbilcbiAgICB9XG5cbiAgICBzbGlkZS5vbih7XG4gICAgICBcIm1vZGlmaWVkXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgIH0sXG4gICAgICBcInJlbW92ZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICBzbGlkZS4kc2xpZGVFbGVtZW50LnJlbW92ZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuJHNsaWRlTGlzdElubmVyLmFwcGVuZChzbGlkZS4kc2xpZGVFbGVtZW50KTtcbiAgfSxcbiAgY3JlYXRlU2xpZGVzTGlzdDogZnVuY3Rpb24gKCRjb250YWluZXIpIHtcbiAgICB0aGlzLiRzbGlkZUxpc3QgPSB0aGlzLiRzbGlkZXNMaXN0ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVzLWxpc3RcIik7XG4gICAgdGhpcy4kc2xpZGVMaXN0SW5uZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzbGlkZXMtbGlzdC1pbm5lclwiKTtcbiAgICB0aGlzLiRzbGlkZUxpc3QuYXBwZW5kKHRoaXMuJHNsaWRlTGlzdElubmVyKTtcblxuICAgICRjb250YWluZXIuYXBwZW5kKHRoaXMuJHNsaWRlc0xpc3QpO1xuXG4gICAgdGhpcy5zbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB0aGlzLmNyZWF0ZVNsaWRlc0xpc3RFbGVtZW50KHNsaWRlKSk7XG5cbiAgICB0aGlzLm9uKFwic2xpZGU6Y3JlYXRlZFwiLGUgPT4ge1xuICAgICAgdGhpcy5jcmVhdGVTbGlkZXNMaXN0RWxlbWVudChlLnRhcmdldCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGlzdDogdGhpcy4kc2xpZGVMaXN0XG4gICAgfVxuXG4gICAgLy90aGlzLmNhbnZhcy5vbiggXCJkaW1lbnNpb25zOm1vZGlmaWVkXCIgLHRoaXMudXBkYXRlVGh1bWJzLmJpbmQodGhpcykpXG4gICAgLy90aGlzLnVwZGF0ZVRodW1icygpO1xuICB9LFxuICB1cGRhdGVUaHVtYnM6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5zbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB7XG4gICAgICBzbGlkZS5jYW52YXMuc2V0RGltZW5zaW9ucyh7d2lkdGg6IHRoaXMuY2FudmFzLndpZHRoLCBoZWlnaHQ6IHRoaXMuY2FudmFzLmhlaWdodH0pXG4gICAgfSlcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgdGl0bGU6IFwiTmV3IFNsaWRlXCIsXG4gIHNldEFjdGl2ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgbGV0ICRlbCA9ICQodGhpcy53cmFwcGVyRWwpO1xuICAgIGlmKHZhbHVlID09PSBmYWxzZSl7XG4gICAgICB0aGlzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuXG4gICAgICBpZih0aGlzLmFwcGxpY2F0aW9uLnByZXZpZXdNb2RlID09PSBmYWJyaWMuUFJFVklFVy5TSU5HTEUpe1xuICAgICAgICAkZWwucmVtb3ZlKCk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgJGVsLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNle1xuXG4gICAgICBpZih0aGlzLmFwcGxpY2F0aW9uLnByZXZpZXdNb2RlID09PSBmYWJyaWMuUFJFVklFVy5TSU5HTEUpe1xuXG4gICAgICAgIHRoaXMuYXBwbGljYXRpb24uY2FudmFzQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMud3JhcHBlckVsKTtcblxuICAgICAgICAvLyB0aGlzLmFwcGxpY2F0aW9uLmNhbnZhc0NvbnRhaW5lci5hcHBlbmQoJGVsKTtcbiAgICAgIH1lbHNle1xuICAgICAgICAkZWwuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB1bmlxdWU6IGZhbHNlLFxuICByZXF1aXJlZDogZmFsc2UsXG4gIC8vIHN0YXRlUHJvcGVydGllczogW1widW5pcXVlXCIsXCJyZXF1aXJlZFwiXSxcbiAgcmVtb3ZlU2xpZGU6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5hcHBsaWNhdGlvbi5yZW1vdmVTbGlkZSh0aGlzKVxuICB9LFxuICBkdXBsaWNhdGVTbGlkZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmFwcGxpY2F0aW9uLmR1cGxpY2F0ZVNsaWRlKHRoaXMpXG4gIH1cbiAgLy8gZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLkNhbnZhcy5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgLy8gICBcIm1vZGlmaWVkXCIgOiBmdW5jdGlvbihlKXtcbiAgLy8gICAgIGlmKHRoaXMuY2FudmFzKXtcbiAgLy8gICAgICAgdGhpcy5jYW52YXMuY2FudmFzLnNldChlLnN0YXRlcy5tb2RpZmllZCk7XG4gIC8vICAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgLy8gICAgIH1cbiAgLy8gICB9LFxuICAvLyAgIFwib2JqZWN0Om1vZGlmaWVkXCIgOiBmdW5jdGlvbigpe1xuICAvLyAgICAgaWYodGhpcy5jYW52YXMpe1xuICAvLyAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwibW9kaWZpZWRcIik7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9KVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvcmUvYXBwbGljYXRpb24uc2xpZGVzLmpzIiwiLyoqXG4gKiAjIFByb3RvdHlwZXNcblxuIFByb3RvdHlwZXMgYWxsb3dzIHRvIGRlZmluZSAqKnByb3RvdHlwZXMqKiBwcm9wZXJ0eSBpbiBBcHBsaWNhdGlvbiBjb25maWd1cmF0aW9uLlxuXG4gYGBgamF2YXNjcmlwdFxuIEFwcGxpY2F0aW9uICh7XG4gIHByb3RvdHlwZXM6IHtcbiAgICBDbGFzc05hbWU6IG9wdGlvbnNcbiAgfVxuIH0pXG4gYGBgXG5cbiBJZiBwcm90b3R5cGUgaXMgZGVmaW5lZCBldmVyeSBuZXcgT2JqZWN0IGNyZWF0ZWQgYnkgYXBwbGljYXRpb24gd2lsbCBoYXZlIHRoaXMgcHJvcGVydGllcyBieSBkZWZhdWx0LlxuXG4gYGBgamF2YXNjcmlwdFxuICAgTmV3Q2xhc3M6IHtcbiAgICAkc3VwZXI6IFwiUGFyZW50Q2xhc3NcIixcbiAgICB0eXBlOiBcIm5ldy1jbGFzc1wiLFxuICAgIFxcLypvdGhlciBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzKlxcL1xuICAgfVxuICBgYGBcblxuIGlmIHByb3BlcnR5ICoqdHlwZSoqIG9mIE9iamVjdCBjbGFzcyBpcyBkZWZpbmVkIHRoZW4gZXZlcnkgb2JqZWN0IGJlIGRlZmF1bHQgd2lsbCBoYXZlIHRoaXMgdHlwZS5cblxuIGBgYGphdmFzY3JpcHRcbiAgIE9iamVjdDoge1xuICAgIHR5cGU6IFwicmVjdGFuZ2xlXCJcbiAgIH1cbiAuLi5cbiAvL3JlY3RhbmdsZSB3aWxsIGJlIGNyZWF0ZWRcbiBmYWJyaWMuY3JlYXRlT2JqZWN0KHt3aWR0aDoxMDAsIGhlaWdodDogMTAwfSlcbiBgYGBcbiovXG5cblxuXG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0XG4gICAqL1xuICBfcmVtb3ZlRGVmYXVsdFZhbHVlczogZnVuY3Rpb24ob2JqZWN0LF90eXBlKSB7XG5cbiAgICB2YXIgcHJvdG90eXBlID0gdGhpcy5hcHBsaWNhdGlvbi5nZXRLbGFzcyhfdHlwZSB8fCBvYmplY3QudHlwZSkucHJvdG90eXBlO1xuICAgICAgLy8gc3RhdGVQcm9wZXJ0aWVzID0gcHJvdG90eXBlLnN0YXRlUHJvcGVydGllcztcbiAgICB2YXIgX3Byb3RvUHJvcGVydGllcyA9IHRoaXMuYXBwbGljYXRpb24gJiYgdGhpcy5hcHBsaWNhdGlvbi5nZXREZWZhdWx0UHJvcGVydGllcyhwcm90b3R5cGUpIHx8IHt9O1xuXG4gICAgZm9yICh2YXIgcHJvcCBpbiBvYmplY3Qpe1xuICAgICAgaWYocHJvcCA9PT0gXCJ0eXBlXCIpY29udGludWU7XG4gICAgICB2YXIgX3Byb3RvVmFsdWUgPSBfcHJvdG9Qcm9wZXJ0aWVzW3Byb3BdICE9PSB1bmRlZmluZWQgPyBfcHJvdG9Qcm9wZXJ0aWVzW3Byb3BdIDogcHJvdG90eXBlW3Byb3BdO1xuXG4gICAgICBpZiAob2JqZWN0W3Byb3BdID09PSBfcHJvdG9WYWx1ZSkge1xuICAgICAgICBkZWxldGUgb2JqZWN0W3Byb3BdO1xuICAgICAgfVxuICAgICAgdmFyIGlzQXJyYXkgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqZWN0W3Byb3BdKSA9PT0gJ1tvYmplY3QgQXJyYXldJyAmJlxuICAgICAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoX3Byb3RvVmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nO1xuXG4gICAgICAvLyBiYXNpY2FsbHkgYSBjaGVjayBmb3IgW10gPT09IFtdXG4gICAgICBpZiAoaXNBcnJheSAmJiBvYmplY3RbcHJvcF0ubGVuZ3RoID09PSAwICYmIF9wcm90b1ZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBkZWxldGUgb2JqZWN0W3Byb3BdO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBvYmplY3Q7XG4gIH0sXG59KTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIF9yZW1vdmVEZWZhdWx0VmFsdWVzOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fcmVtb3ZlRGVmYXVsdFZhbHVlc1xufSk7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuRWRpdG9yLnByb3RvdHlwZSwge1xuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciBvbyA9IGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcImNhbnZhc0NvbnRhaW5lclwiKSwwLFwicHJvdG90eXBlc1wiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIGdldERlZmF1bHRQcm9wZXJ0aWVzOiBmdW5jdGlvbihzdHJpbmdUeXBlT3JQcm90b3R5cGUpe1xuICAgIGlmKCF0aGlzLnByb3RvdHlwZXMpcmV0dXJuO1xuICAgIHZhciBrbGFzc25hbWUsIHByb3RvO1xuICAgIGlmKHN0cmluZ1R5cGVPclByb3RvdHlwZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIGtsYXNzbmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShzdHJpbmdUeXBlT3JQcm90b3R5cGUpLHRydWUpO1xuICAgICAgdmFyIF9rbGFzcyA9IHRoaXMuZ2V0S2xhc3Moa2xhc3NuYW1lKTtcbiAgICAgIHByb3RvID0gX2tsYXNzLnByb3RvdHlwZTtcbiAgICB9ZWxzZXtcbiAgICAgIHByb3RvID0gc3RyaW5nVHlwZU9yUHJvdG90eXBlO1xuICAgICAga2xhc3NuYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKHByb3RvLnR5cGUpLHRydWUpO1xuICAgIH1cbiAgICB2YXIgX3Byb3RvUHJvcGVydGllcyA9IHByb3RvICYmIHByb3RvLl9fcHJvdG9fXyAmJiBwcm90by5fX3Byb3RvX18udHlwZSAmJiB0aGlzLmdldERlZmF1bHRQcm9wZXJ0aWVzKHByb3RvLl9fcHJvdG9fXykgfHwge307XG4gICAgdmFyIF9kZWZhdWx0UHJvcGVydGllcyA9IGtsYXNzbmFtZSAmJiBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUodGhpcy5wcm90b3R5cGVzW2tsYXNzbmFtZV0pIHx8IHt9O1xuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChfcHJvdG9Qcm9wZXJ0aWVzLF9kZWZhdWx0UHJvcGVydGllcyk7XG5cbiAgICByZXR1cm4gX3Byb3RvUHJvcGVydGllcztcbiAgfSxcbiAgLyoqXG4gICAqIGRlZmF1bHQgcHJvdG90eXBlcyBwcm9wZXJ0ZXMgZm9yIG9iamVjdHNcbiAgICovXG4gIHByb3RvdHlwZXM6IHtcbiAgICBPYmplY3Q6IHtcbiAgICAgIGluY2x1ZGVEZWZhdWx0VmFsdWVzOiBmYWxzZVxuICAgIH0sXG4gICAgQ2FudmFzOiB7XG4gICAgICBpbmNsdWRlRGVmYXVsdFZhbHVlczogZmFsc2VcbiAgICB9XG4gIH0sXG4gIHNldFV0aWxzOiBmdW5jdGlvbiAodXRpbHNPcHRpb25zKSB7XG5cbiAgICBpZighdXRpbHNPcHRpb25zKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLnV0aWwgfHwge30sdXRpbHNPcHRpb25zKTtcblxuICAgIGlmICh0aGlzLm9wdGlvbnNbJ3V0aWwnXSkge1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMudXRpbCwgdGhpcy5vcHRpb25zWyd1dGlsJ10pO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25zWydmYWJyaWMnXSkge1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMsIHRoaXMub3B0aW9uc1snZmFicmljJ10pO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5vcHRpb25zWydmYWJyaWMnXTtcbiAgICBkZWxldGUgdGhpcy5vcHRpb25zWyd1dGlsJ107XG4gIH0sXG4gIGtsYXNzZXM6IFtdLFxuICBnZXRLbGFzczogZnVuY3Rpb24odHlwZSl7XG4gICAgLy8gY2FwaXRhbGl6ZSBmaXJzdCBsZXR0ZXIgb25seVxuICAgIHZhciBrbGFzc05hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUodHlwZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR5cGUuc2xpY2UoMSkpO1xuICAgIHJldHVybiB0aGlzLmtsYXNzZXNba2xhc3NOYW1lXSB8fCBmYWJyaWNba2xhc3NOYW1lXVxuICB9LFxuICBzZXRQcm90b3R5cGVzOiBmdW5jdGlvbiAocHJvdG90eXBlcykge1xuXG4gICAgdmFyIF9wcm90b3R5cGVzID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoe30sIHRoaXMucHJvdG90eXBlcyAscHJvdG90eXBlcyk7XG5cbiAgICB0aGlzLnByb3RvdHlwZXMgPSBfcHJvdG90eXBlcztcblxuICAgIGlmKF9wcm90b3R5cGVzLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgIF9wcm90b3R5cGVzLmV2ZW50TGlzdGVuZXJzLiRleHRlbmQgPSAnYXJyYXknO1xuICAgIH1cblxuICAgIGZvciAodmFyIGtsYXNzTmFtZSBpbiBfcHJvdG90eXBlcykge1xuICAgICAgdmFyIF9wcm90byA9IF9wcm90b3R5cGVzW2tsYXNzTmFtZV07XG5cbiAgICAgIGZvciAodmFyIGogaW4gX3Byb3RvKSB7XG4gICAgICAgIGlmIChfcHJvdG9bal0gJiYgX3Byb3RvW2pdW1wiJGV4dGVuZFwiXSkge1xuICAgICAgICAgIHZhciBfZXh0ZW5kID0gX3Byb3RvW2pdW1wiJGV4dGVuZFwiXTtcbiAgICAgICAgICBpZiggX2V4dGVuZCA9PSBcImFycmF5XCIpe1xuICAgICAgICAgICAgX3Byb3RvW2pdID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGVbal0sX3Byb3RvW2pdKTtcbiAgICAgICAgICB9IGVsc2UgaWYoIF9leHRlbmQgPT0gXCJkZWVwXCIpe1xuICAgICAgICAgICAgX3Byb3RvW2pdID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlW2pdLF9wcm90b1tqXSk7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBfcHJvdG9bal0gPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZVtqXSxfcHJvdG9bal0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWxldGUgX3Byb3RvW2pdW1wiJGV4dGVuZFwiXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZihfcHJvdG9bXCIkc3VwZXJcIl0pe1xuICAgICAgICB2YXIgX3N1cGVya2xhc3MgPSBmYWJyaWNbX3Byb3RvW1wiJHN1cGVyXCJdXSA7XG4gICAgICAgIGlmKCFfc3VwZXJrbGFzcyl7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBjbGFzcyAke19wcm90b1tcIiRzdXBlclwiXX0gZG9lbnQgZXhpc3RzIGApXG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlIF9wcm90b1tcIiRzdXBlclwiXTtcbiAgICAgICAgX3Byb3RvLnR5cGUgPSBmYWJyaWMudXRpbC5zdHJpbmcudG9EYXNoZWQoa2xhc3NOYW1lKVxuXG4gICAgICAgIHZhciBfZnJvbU9iamVjdCA9IF9wcm90by5mcm9tT2JqZWN0IHx8IF9zdXBlcmtsYXNzLmZyb21PYmplY3QgO1xuICAgICAgICBkZWxldGUgX3Byb3RvLmZyb21PYmplY3Q7XG4gICAgICAgIHZhciBfa2xhc3MgPSB0aGlzLmtsYXNzZXNba2xhc3NOYW1lXSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKF9zdXBlcmtsYXNzLCBfcHJvdG8pO1xuICAgICAgICBfa2xhc3MuZnJvbU9iamVjdCA9IF9mcm9tT2JqZWN0LmJpbmQoX2tsYXNzKTtcbiAgICAgIH1cblxuICAgIC8vICAgaWYgKGtsYXNzTmFtZS5hY3Rpb25zICYmIF9wcm90by5hY3Rpb25zLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgLy8gICAgIGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zID0gX3Byb3RvLmFjdGlvbnMuY2FsbChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUpXG4gICAgLy8gICB9XG4gICAgfVxuXG4gICAgaWYgKF9wcm90b3R5cGVzLkVkaXRvcikge1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQodGhpcywgX3Byb3RvdHlwZXMuRWRpdG9yKTtcbiAgICB9XG5cbiAgICAvLyBkZWxldGUgdGhpcy5vcHRpb25zWydwcm90b3R5cGVzJ107XG5cbiAgICBpZiAodGhpcy5hY3Rpb25zICYmIHRoaXMuYWN0aW9ucy5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgdGhpcy5hY3Rpb25zID0gdGhpcy5hY3Rpb25zLmNhbGwodGhpcylcbiAgICB9XG4gIH0sXG4gIF9wb3B1bGF0ZVdpdGhEZWZhdWx0UHJvcGVydGllczogZnVuY3Rpb24odGFyZ2V0LG9wdGlvbnMpe1xuXG4gICAgaWYoIXRhcmdldC5kaXNhYmxlRGVmYXVsdFByb3BlcnRpZXMpe1xuXG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMob3B0aW9ucywgdGhpcy5nZXREZWZhdWx0UHJvcGVydGllcyh0YXJnZXQsIG9wdGlvbnMpKTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gb3B0aW9uc1trZXldO1xuICAgICAgICBpZiAoa2V5WzBdID09IFwiK1wiKSB7XG4gICAgICAgICAgdmFyIF9rZXkgPSBrZXkuc3Vic3RyKDEpO1xuICAgICAgICAgIHZhciBfYXJyID0gdGFyZ2V0LmdldChfa2V5KTtcbiAgICAgICAgICBpZiAoX2FyciBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICBfYXJyID0gX2Fyci5zbGljZSgpLmNvbmNhdCh2YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9hcnIgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBfYXJyLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wdGlvbnNbX2tleV0gPSBfYXJyO1xuICAgICAgICAgIGRlbGV0ZSBvcHRpb25zW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgXCJjcmVhdGVkXCI6IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZihlLm9wdGlvbnMucHJvdG90eXBlcyAmJiBlLm9wdGlvbnMucHJvdG90eXBlcy5FZGl0b3Ipe1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMoZS5vcHRpb25zLGUub3B0aW9ucy5wcm90b3R5cGVzLkVkaXRvcilcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiZW50aXR5OmNyZWF0ZWRcIjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUudGFyZ2V0LmFwcGxpY2F0aW9uID0gdGhpcztcbiAgICAgIHRoaXMuX3BvcHVsYXRlV2l0aERlZmF1bHRQcm9wZXJ0aWVzKGUudGFyZ2V0LGUub3B0aW9ucyk7XG4gICAgICBkZWxldGUgZS5vcHRpb25zLnR5cGU7XG4gICAgICBkZWxldGUgZS5vcHRpb25zLmFwcGxpY2F0aW9uO1xuICAgIH1cbiAgfSlcbn0pO1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9hcHBsaWNhdGlvbi5wcm90b3R5cGVzLmpzIiwiXG5mYWJyaWMuQWN0aW9uc01peGluID0ge1xuICBzZXRBY3Rpb25zOiBmdW5jdGlvbiAoYWN0aW9ucykge1xuICAgIGZvciAobGV0IGkgaW4gYWN0aW9ucykge1xuICAgICAgYWN0aW9uc1tpXS5pZCA9IGk7XG4gICAgfVxuICAgIHRoaXMuYWN0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LCB0aGlzLl9fcHJvdG9fXy5hY3Rpb25zLCBhY3Rpb25zKTtcbiAgfSxcbiAgX2dldEFjdGlvblZhbHVlOiBmdW5jdGlvbiAocHJvcGVydHkpIHtcbiAgICBsZXQgb2JqZWN0ID0gdGhpcztcbiAgICBsZXQgZGVmYXVsdFByb3BlcnRpZXM7XG4gICAgZG8ge1xuICAgICAgaWYoIWRlZmF1bHRQcm9wZXJ0aWVzKXtcbiAgICAgICAgbGV0IGFjdGlvbnMgPSB0aGlzLmFwcGxpY2F0aW9uLmdldERlZmF1bHRQcm9wZXJ0aWVzKFwiT2JqZWN0XCIpLmFjdGlvbnM7XG4gICAgICAgIGRlZmF1bHRQcm9wZXJ0aWVzID0gYWN0aW9ucyAmJiBhY3Rpb25zW3Byb3BlcnR5XTtcbiAgICAgIH1cbiAgICAgIGlmIChvYmplY3QuYWN0aW9ucyAmJiBvYmplY3QuYWN0aW9uc1twcm9wZXJ0eV0pIHtcbiAgICAgICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sb2JqZWN0LmFjdGlvbnNbcHJvcGVydHldLGRlZmF1bHRQcm9wZXJ0aWVzKTtcbiAgICAgIH1cbiAgICB9IHdoaWxlIChvYmplY3QgPSBvYmplY3QuX19wcm90b19fKTtcbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxkZWZhdWx0UHJvcGVydGllcyk7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkVkaXRvci5wcm90b3R5cGUsIHtcbiAgX2dldEFjdGlvblZhbHVlOiBmdW5jdGlvbihwcm9wZXJ0eSkge1xuICAgIHJldHVybiB0aGlzLmFjdGlvbnNbcHJvcGVydHldO1xuICB9LFxuICBzZXRBY3Rpb25zOiBmdW5jdGlvbiAoYWN0aW9ucykge1xuICAgIGZvciAodmFyIGtsYXNzTmFtZSBpbiBhY3Rpb25zKSB7XG4gICAgICBmb3IgKHZhciBpIGluIGFjdGlvbnNba2xhc3NOYW1lXSkge1xuICAgICAgICBhY3Rpb25zW2tsYXNzTmFtZV1baV0uaWQgPSBpO1xuICAgICAgfVxuICAgICAgaWYoa2xhc3NOYW1lID09IFwiRWRpdG9yXCIpe1xuICAgICAgICB0aGlzLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh0aGlzLmFjdGlvbnMsIGFjdGlvbnNba2xhc3NOYW1lXSk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLnByb3RvdHlwZXNba2xhc3NOYW1lXSkge1xuICAgICAgICB0aGlzLnByb3RvdHlwZXNba2xhc3NOYW1lXSA9IHt9O1xuICAgICAgfVxuICAgICAgdmFyIHByb3RvID0gdGhpcy5nZXRLbGFzcyhrbGFzc05hbWUpO1xuICAgICAgdGhpcy5wcm90b3R5cGVzW2tsYXNzTmFtZV0uYWN0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LCBwcm90byAmJiBwcm90by5wcm90b3R5cGUuYWN0aW9ucywgYWN0aW9uc1trbGFzc05hbWVdKTtcbiAgICB9XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBzYXZlOiB7XG4gICAgICB0aXRsZTogXCJzYXZlIHByb2plY3RcIixcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZsb3BweS1vJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMudG9PYmplY3QoKTtcbiAgICAgICAgdGhpcy5zYXZlKGRhdGEpO1xuICAgICAgfVxuICAgIH0sXG4gICAgYWRkU2xpZGU6IHtcbiAgICAgIHRpdGxlOiBcImFkZCBzbGlkZVwiLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtcGx1cycsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBzbGlkZURhdGEgPSB7fTtcbiAgICAgICAgdmFyIF9zbGlkZSA9IHRoaXMuYWRkU2xpZGUoc2xpZGVEYXRhKTtcbiAgICAgICAgX3NsaWRlLmNhbnZhcy5sb2FkKF9zbGlkZS5vYmplY3QpO1xuICAgICAgICB0aGlzLl9zZXRBY3RpdmVTbGlkZShfc2xpZGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIGZhYnJpYy5BY3Rpb25zTWl4aW4se1xuICBhY3Rpb25zOiB7XG4gICAgY2xlYXI6IHtcbiAgICAgIHRpdGxlOiAnQ2xlYXInLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtdHJhc2gnLFxuICAgIH0sXG4gICAgY2xlYXJPYmplY3RzOiB7XG4gICAgICB0aXRsZTogJ0NsZWFyIEFsbCcsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS10cmFzaCdcbiAgICB9LFxuXG4gICAvKiBzZWxlY3RBbGw6IHtcbiAgICAgIGtleUNvZGU6ICdhJyxcbiAgICAgIGN0cmxLZXk6IHRydWUsXG4gICAgICB0aXRsZTogJ1NlbGVjdCBBbGwnLFxuICAgICAgdHlwZTogJ2tleSdcbiAgICB9LCovXG4gICAgYmFja2dyb3VuZENvbG9yOiB7XG4gICAgICB0aXRsZTogXCJTZXQgQmFja2dyb3VuZCBDb2xvdXJcIixcbiAgICAgIHR5cGU6IFwiY29sb3JcIlxuICAgIH0sXG4gICAgYWRkVGV4dDoge1xuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZm9udCcsXG4gICAgICB0aXRsZTogJ0FkZCBUZXh0JyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmFkZFRleHQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbW92ZVNsaWRlOiB7XG4gICAgICB0aXRsZTogXCJhZGQgc2xpZGVcIixcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXRyYXNoLW8nXG4gICAgfSxcbiAgICBkdXBsaWNhdGVTbGlkZToge1xuICAgICAgdGl0bGU6IFwiZHVwbGljYXRlIHNsaWRlXCIsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1jbG9uZSdcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCBmYWJyaWMuQWN0aW9uc01peGluLCB7XG4gIGFjdGlvbnM6IHtcbiAgICBtb3ZlbWVudDoge1xuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYXJyb3dzJyxcbiAgICAgIG1lbnU6IFtcbiAgICAgICAgXCJtb3ZlVXBcIixcbiAgICAgICAgXCJtb3ZlRG93blwiLFxuICAgICAgICBcIm1vdmVMZWZ0XCIsXG4gICAgICAgIFwibW92ZVJpZ2h0XCJcbiAgICAgIF1cbiAgICB9LFxuICAgIG1vdmVVcDoge1xuICAgICAgY2xhc3NOYW1lOiBcImZhIGZhLWFycm93LXVwXCIsXG4gICAgICB0eXBlOiBcImtleVwiLFxuICAgICAga2V5Q29kZTogMzgsXG4gICAgfSxcbiAgICBtb3ZlRG93bjoge1xuICAgICAgY2xhc3NOYW1lOiBcImZhIGZhLWFycm93LWRvd25cIixcbiAgICAgIHR5cGU6IFwia2V5XCIsXG4gICAgICBrZXlDb2RlOiA0MCxcbiAgICB9LFxuICAgIG1vdmVMZWZ0OiB7XG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtYXJyb3ctbGVmdFwiLFxuICAgICAgdHlwZTogXCJrZXlcIixcbiAgICAgIGtleUNvZGU6IDM3LFxuICAgIH0sXG4gICAgbW92ZVJpZ2h0OiB7XG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtYXJyb3ctcmlnaHRcIixcbiAgICAgIHR5cGU6IFwia2V5XCIsXG4gICAgICBrZXlDb2RlOiAzOSxcbiAgICB9LFxuICAgIGJvdW5kaW5nUmVjdDoge1xuICAgICAgdHlwZTogJ2xhYmVsJyxcbiAgICAgIHRlbXBsYXRlOiAnPGR0Pkw6PC9kdD48ZGQgY2xhc3M9XCJ7bGVmdENsYXNzfVwiIHRpdGxlPVwie2xlZnR9XCI+e3JvdW5kTGVmdH08L2RkPjxkdD5UOjwvZHQ+PGRkIGNsYXNzPVwie3RvcENsYXNzfVwiICB0aXRsZT1cInt0b3B9XCI+e3JvdW5kVG9wfTwvZGQ+PGR0PlI6PC9kdD48ZGQgY2xhc3M9XCJ7cmlnaHRDbGFzc31cIiB0aXRsZT1cIntyaWdodH1cIj57cm91bmRSaWdodH08L2RkPjxkdD5COjwvZHQ+PGRkIGNsYXNzPVwie2JvdHRvbUNsYXNzfVwiICB0aXRsZT1cIntib3R0b219XCI+e3JvdW5kQm90dG9tfTwvZGQ+JyxcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIG9ic2VydmU6IFwibW9kaWZpZWQgc2NhbGluZyBtb3Zpbmcgcm90YXRpbmdcIixcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIF9yZWN0ID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKTtcblxuICAgICAgICAgIGlmICh0aGlzLm1vdmVtZW50TGltaXRzKSB7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm1vdmVtZW50TGltaXRzID09IHRoaXMuY2FudmFzKSB7XG4gICAgICAgICAgICAgIHZhciBfdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgICAgICAgICAgICB2YXIgX21sciA9IHtcbiAgICAgICAgICAgICAgICBsZWZ0OiBfdls0XSxcbiAgICAgICAgICAgICAgICB0b3A6IF92WzVdLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAodGhpcy5jYW52YXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLmNhbnZhcy53aWR0aCkgKiBfdlswXSxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6ICh0aGlzLmNhbnZhcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmNhbnZhcy5oZWlnaHQpICogX3ZbM10sXG4gICAgICAgICAgICAgICAgcmlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgYm90dG9tOiAwXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIF9tbHIgPSB0aGlzLm1vdmVtZW50TGltaXRzLmdldEJvdW5kaW5nUmVjdCgpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIF9yZWN0LmJvdHRvbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMuaGVpZ2h0IC0gX3JlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgdmFyIF90ID0gX3JlY3QudG9wIC0gX21sci50b3A7XG4gICAgICAgICAgICB2YXIgX2wgPSBfcmVjdC5sZWZ0IC0gX21sci5sZWZ0O1xuICAgICAgICAgICAgdmFyIF9yID0gX21sci53aWR0aCAtIF9yZWN0LndpZHRoIC0gX2w7XG4gICAgICAgICAgICB2YXIgX2IgPSBfbWxyLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF90O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfdCA9IF9yZWN0LnRvcDtcbiAgICAgICAgICAgIF9sID0gX3JlY3QubGVmdDtcbiAgICAgICAgICAgIF9iID0gdGhpcy5jYW52YXMuaGVpZ2h0IC0gX3JlY3QuaGVpZ2h0IC0gX3JlY3QudG9wO1xuICAgICAgICAgICAgX3IgPSB0aGlzLmNhbnZhcy53aWR0aCAtIF9yZWN0LndpZHRoIC0gX3JlY3QubGVmdDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdG9wQ2xhc3M6IF90ID4gMCA/IFwicG9zaXRpdmVcIiA6IF90IDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiemVyb1wiLFxuICAgICAgICAgICAgYm90dG9tQ2xhc3M6IF9iID4gMCA/IFwicG9zaXRpdmVcIiA6IF9iIDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiemVyb1wiLFxuICAgICAgICAgICAgbGVmdENsYXNzOiBfbCA+IDAgPyBcInBvc2l0aXZlXCIgOiBfbCA8IDAgPyBcIm5lZ2F0aXZlXCIgOiBcInplcm9cIixcbiAgICAgICAgICAgIHJpZ2h0Q2xhc3M6IF9yID4gMCA/IFwicG9zaXRpdmVcIiA6IF9yIDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiemVyb1wiLFxuICAgICAgICAgICAgdG9wOiBfdCxcbiAgICAgICAgICAgIGxlZnQ6IF9sLFxuICAgICAgICAgICAgYm90dG9tOiBfYixcbiAgICAgICAgICAgIHJpZ2h0OiBfcixcbiAgICAgICAgICAgIHJvdW5kVG9wOiBNYXRoLnJvdW5kKF90KSxcbiAgICAgICAgICAgIHJvdW5kTGVmdDogTWF0aC5yb3VuZChfbCksXG4gICAgICAgICAgICByb3VuZEJvdHRvbTogTWF0aC5yb3VuZChfYiksXG4gICAgICAgICAgICByb3VuZFJpZ2h0OiBNYXRoLnJvdW5kKF9yKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgbGVmdDoge1xuICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICB0aXRsZTogJ2xlZnQnLFxuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgdGhpcy5sZWZ0ID0gdmFsO1xuICAgICAgICAgIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJvYmplY3Q6bW9kaWZpZWRcIiwge3RhcmdldDogdGhpc30pO1xuICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9LFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0O1xuICAgICAgICB9LFxuICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgIH1cbiAgICB9LFxuICAgIHRvcDoge1xuICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICB0aXRsZTogJ3RvcCcsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICB0aGlzLnRvcCA9IHZhbDtcbiAgICAgICAgICB0aGlzLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMudG9wO1xuICAgICAgICB9LFxuICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgIH1cbiAgICB9LFxuICAgIHBvc2l0aW9uOiB7XG4gICAgICB0aXRsZTogJ3Bvc2l0aW9uJyxcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIG1lbnU6IFtcImxlZnRcIixcInRvcFwiXVxuICAgIH0sXG4gICAgZGltZW5zaW9uczoge1xuICAgICAgdGl0bGU6ICdkaW1lbnNpb25zJyxcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIG1lbnU6IHtcbiAgICAgICAgb2JqZWN0V2lkdGg6IHtcbiAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICB0aXRsZTogJ3dpZHRoJyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgIHRoaXMuc2F2ZVN0YXRlKCk7XG4gICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uc1dpZHRoVmFsdWUgPSB2YWw7XG4gICAgICAgICAgICAgIHRoaXMuc2NhbGVUb1dpZHRoKHZhbCAqIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICAgICAgICAgIC8vIHRoaXMuY2FudmFzLmZpcmVNb2RpZmllZElmQ2hhbmdlZCh0aGlzKTtcbiAgICAgICAgICAgICAgdGhpcy5maXJlKFwibW9kaWZpZWRcIiwge30pO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAodGhpcy5kaW1lbnNpb25zV2lkdGhWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCkud2lkdGggLyB0aGlzLmNhbnZhcy5nZXRab29tKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9ic2VydmU6IFwibW9kaWZpZWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb2JqZWN0SGVpZ2h0OiB7XG4gICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgdGl0bGU6ICdoZWlnaHQnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy5zYXZlU3RhdGUoKTtcbiAgICAgICAgICAgICAgdGhpcy5zY2FsZVRvSGVpZ2h0KHZhbCAqIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmZpcmUoXCJtb2RpZmllZFwiLCB7fSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJvYmplY3Q6bW9kaWZpZWRcIiwge3RhcmdldDogdGhpc30pO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAodGhpcy5kaW1lbnNpb25zSGVpZ2h0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaW1lbnNpb25zSGVpZ2h0VmFsdWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodGhpcy5nZXRCb3VuZGluZ1JlY3QoKS5oZWlnaHQgLyB0aGlzLmNhbnZhcy5nZXRab29tKCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9ic2VydmU6IFwibW9kaWZpZWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgY2VudGVyOiB7XG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1idWxsc2V5ZScsXG4gICAgICB0aXRsZTogJ0NlbnRlcicsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jZW50ZXIoKTtcbiAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZsaXA6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFycm93cy1oJyxcbiAgICAgIHRpdGxlOiAnZmxpcCcsXG4gICAgICBhY3Rpb246ICdmbGlwJ1xuICAgIH0sXG4gICAgZmxvcDoge1xuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYXJyb3dzLXYnLFxuICAgICAgdGl0bGU6ICdmbG9wJ1xuICAgIH0sXG4gICAgb3JkZXI6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWV4Y2hhbmdlIGZhLXJvdGF0ZS05MCcsXG4gICAgICBtZW51OiBbXG4gICAgICAgIFwiYnJpbmdGb3J3YXJkXCIsXG4gICAgICAgIFwic2VuZEJhY2t3YXJkc1wiLFxuICAgICAgICBcImJyaW5nVG9Gcm9udFwiLFxuICAgICAgICBcInNlbmRUb0JhY2tcIlxuICAgICAgXVxuICAgIH0sXG4gICAgYnJpbmdGb3J3YXJkOiB7XG4gICAgICB0aXRsZTogJ2JyaW5nIGZvcndhcmQnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtbGV2ZWwtdXAnLFxuICAgICAgZW5hYmxlZDogJyFvblRvcCcsXG4gICAgICBvYnNlcnZlOiBmdW5jdGlvbihjYil7XG4gICAgICAgIHRoaXMuY2FudmFzLm9uKFwib2JqZWN0OmFkZGVkIG9iamVjdDpyZW1vdmVkIG9iamVjdDpyZXBsYWNlZFwiLGNiKTtcbiAgICAgIH0sXG4gICAgICBkZXN0cm95OiBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgdGhpcy5jYW52YXMub2ZmKFwib2JqZWN0OmFkZGVkIG9iamVjdDpyZW1vdmVkIG9iamVjdDpyZXBsYWNlZFwiLGRhdGEuZW5hYmxlQ2FsbGJhY2spO1xuICAgICAgfVxuICAgIH0sXG4gICAgc2VuZEJhY2t3YXJkczoge1xuICAgICAgdGl0bGU6ICdzZW5kIGJhY2t3YXJkcycsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1sZXZlbC1kb3duJyxcbiAgICAgIGVuYWJsZWQ6ICchb25Cb3R0b20nLFxuICAgICAgb2JzZXJ2ZTogZnVuY3Rpb24oY2Ipe1xuICAgICAgICB0aGlzLmNhbnZhcy5vbihcIm9iamVjdDphZGRlZCBvYmplY3Q6cmVtb3ZlZCBvYmplY3Q6cmVwbGFjZWRcIixjYik7XG4gICAgICB9LFxuICAgICAgZGVzdHJveTogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgIHRoaXMuY2FudmFzLm9mZihcIm9iamVjdDphZGRlZCBvYmplY3Q6cmVtb3ZlZCBvYmplY3Q6cmVwbGFjZWRcIixkYXRhLmVuYWJsZUNhbGxiYWNrKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGJyaW5nVG9Gcm9udDoge1xuICAgICAgdGl0bGU6ICdicmluZyB0byBmcm9udCcsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1sZXZlbC11cCcsXG4gICAgICBlbmFibGVkOiAnIW9uVG9wJyxcbiAgICAgIG9ic2VydmU6IGZ1bmN0aW9uKGNiKXtcbiAgICAgICAgdGhpcy5jYW52YXMub24oXCJvYmplY3Q6YWRkZWQgb2JqZWN0OnJlbW92ZWQgb2JqZWN0OnJlcGxhY2VkXCIsY2IpO1xuICAgICAgfSxcbiAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICB0aGlzLmNhbnZhcy5vZmYoXCJvYmplY3Q6YWRkZWQgb2JqZWN0OnJlbW92ZWQgb2JqZWN0OnJlcGxhY2VkXCIsZGF0YS5lbmFibGVDYWxsYmFjayk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzZW5kVG9CYWNrOiB7XG4gICAgICB0aXRsZTogJ3NlbmQgdG8gYmFjaycsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1sZXZlbC1kb3duJyxcbiAgICAgIGVuYWJsZWQ6ICchb25Cb3R0b20nLFxuICAgICAgb2JzZXJ2ZTogZnVuY3Rpb24oY2Ipe1xuICAgICAgICB0aGlzLmNhbnZhcy5vbihcIm9iamVjdDphZGRlZCBvYmplY3Q6cmVtb3ZlZCBvYmplY3Q6cmVwbGFjZWRcIixjYik7XG4gICAgICB9LFxuICAgICAgZGVzdHJveTogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgIHRoaXMuY2FudmFzLm9mZihcIm9iamVjdDphZGRlZCBvYmplY3Q6cmVtb3ZlZCBvYmplY3Q6cmVwbGFjZWRcIixkYXRhLmVuYWJsZUNhbGxiYWNrKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbW92ZToge1xuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtdHJhc2gnLFxuICAgICAgdGl0bGU6ICdyZW1vdmUnLFxuICAgICAga2V5OiBcIkRlbGV0ZVwiXG4gICAgfSxcbiAgICBkdXBsaWNhdGU6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWNsb25lJyxcbiAgICAgIHRpdGxlOiAnZHVwbGljYXRlJ1xuICAgIH0sXG4gICAgZmlsbDoge1xuICAgICAgdHlwZTogJ2NvbG9yJyxcbiAgICAgIHRpdGxlOiAnZmlsbCcsXG4gICAgICB2YWx1ZTogJ2ZpbGwnXG4gICAgfSxcbiAgICByb3RhdGVMZWZ0OiB7XG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1yb3RhdGUtbGVmdCcsXG4gICAgICB0aXRsZTogJ3JvdGF0ZSBMZWZ0JyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9ub3JtYWxpemVBbmdsZSgpO1xuICAgICAgICBsZXQgZGVzaXJlZEFuZ2xlID0gKE1hdGguZmxvb3IodGhpcy5hbmdsZSAvIDkwKSAtIDEpICogOTA7XG4gICAgICAgIHRoaXMucm90YXRlKGRlc2lyZWRBbmdsZSk7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcm90YXRlUmlnaHQ6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXJvdGF0ZS1yaWdodCcsXG4gICAgICB0aXRsZTogJ3JvdGF0ZSBSaWdodCcsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fbm9ybWFsaXplQW5nbGUoKTtcbiAgICAgICAgbGV0IGRlc2lyZWRBbmdsZSA9IChNYXRoLmZsb29yKHRoaXMuYW5nbGUgLyA5MCkgKyAxKSAqIDkwO1xuICAgICAgICB0aGlzLnJvdGF0ZShkZXNpcmVkQW5nbGUpO1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHN0cmV0Y2g6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFycm93cy1hbHQnLFxuICAgICAgdGl0bGU6ICdzdHJldGNoJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9ub3JtYWxpemVBbmdsZSgpO1xuICAgICAgICBsZXQgX2RldmlhdGlvbiA9IHRoaXMuYW5nbGUgJSA5MDtcbiAgICAgICAgdGhpcy5hbmdsZSA9IE1hdGguZmxvb3IodGhpcy5hbmdsZSAvIDkwKSAqIDkwO1xuXG4gICAgICAgIGlmIChfZGV2aWF0aW9uID4gNDUpIHtcbiAgICAgICAgICB0aGlzLmFuZ2xlICs9IDkwO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHNjYWxlWCwgc2NhbGVZO1xuXG4gICAgICAgIGlmICh0aGlzLmFuZ2xlID09PSA5MCB8fCB0aGlzLmFuZ2xlID09PSAyNzApIHtcbiAgICAgICAgICBzY2FsZVggPSB0aGlzLmNhbnZhcy53aWR0aCAvIHRoaXMuaGVpZ2h0O1xuICAgICAgICAgIHNjYWxlWSA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHRoaXMud2lkdGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2NhbGVYID0gdGhpcy5jYW52YXMud2lkdGggLyB0aGlzLndpZHRoO1xuICAgICAgICAgIHNjYWxlWSA9IHRoaXMuY2FudmFzLmhlaWdodCAvIHRoaXMuaGVpZ2h0O1xuICAgICAgICB9XG5cblxuICAgICAgICB0aGlzLl9zZXRPcmlnaW5Ub0NlbnRlcigpO1xuXG4gICAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgICBzY2FsZVg6IHNjYWxlWCxcbiAgICAgICAgICBzY2FsZVk6IHNjYWxlWSxcbiAgICAgICAgICBsZWZ0OiB0aGlzLmNhbnZhcy53aWR0aCAvIDIsXG4gICAgICAgICAgdG9wOiB0aGlzLmNhbnZhcy5oZWlnaHQgLyAyXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuY2FudmFzLl9yZXN0b3JlT3JpZ2luWFkodGhpcyk7XG4gICAgICAgIHRoaXMuc2V0Q29vcmRzKCk7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlRleHQucHJvdG90eXBlLCB7XG4gIGFjdGlvbnM6IHtcbiAgICBmaWxsOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICdmaWxsJyxcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIC8vdGV4dHVyZSBwYXR0ZXJuIGZpbGwgZml4XG4gICAgICAgICAgcmV0dXJuIHR5cGVvZiB0aGlzLmZpbGwgPT09IFwic3RyaW5nXCIgPyB0aGlzLmZpbGwgOiBcInRyYW5zcGFyZW50XCI7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5zZXRGaWxsKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgdGV4dEJnY29sb3I6IHtcbiAgICAgIHR5cGU6ICdjb2xvcicsXG4gICAgICB0aXRsZTogJ2JnQ29sb3InLFxuICAgICAgdmFsdWU6ICdiZ0NvbG9yJ1xuICAgIH0sXG4gICAgdGV4dFRleHRiZ2NvbG9yOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICd0ZXh0QmdDb2xvcicsXG4gICAgICB2YWx1ZTogJ3RleHRCZ0NvbG9yJ1xuICAgIH0sXG4gICAgdGV4dEJvbGQ6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIHRpdGxlOiAnYm9sZCcsXG4gICAgICB2YWx1ZTogJ2JvbGQnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYm9sZCdcbiAgICB9LFxuICAgIHRleHRJdGFsaWM6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIHRpdGxlOiAnaXRhbGljJyxcbiAgICAgIHZhbHVlOiAnaXRhbGljJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWl0YWxpYydcbiAgICB9LFxuICAgIHRleHRVbmRlcmxpbmU6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIHRpdGxlOiAnVW5kZXJsaW5lJyxcbiAgICAgIHZhbHVlOiAndW5kZXJsaW5lJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXVuZGVybGluZSdcbiAgICB9LFxuICAgIHRleHRMaW5ldGhyb3VnaDoge1xuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgaW5zZXJ0OiAnYWR2YW5jZWRUZXh0U3R5bGVUb29scycsXG4gICAgICB0aXRsZTogJ0xpbmV0aHJvdWdoJyxcbiAgICAgIHZhbHVlOiAnbGluZXRocm91Z2gnLFxuICAgICAgY2xhc3NOYW1lOiAndGV4dC1saW5ldGhyb3VnaCBmYSBmYS1zdHJpa2V0aHJvdWdoJ1xuICAgIH0sXG4gICAgdGV4dE92ZXJsaW5lOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBpbnNlcnQ6ICdhZHZhbmNlZFRleHRTdHlsZVRvb2xzJyxcbiAgICAgIHRpdGxlOiAnb3ZlcmxpbmUnLFxuICAgICAgdmFsdWU6ICdvdmVybGluZScsXG4gICAgICBjbGFzc05hbWU6ICd0ZXh0LW92ZXJsaW5lIGZhIGZhLW92ZXJsaW5lJ1xuICAgIH0sXG4gICAgdGV4dEFsaWduOiB7XG4gICAgICB0eXBlOiAnb3B0aW9ucycsXG4gICAgICB0aXRsZTogJ3RleHQgYWxpZ24nLFxuICAgICAgaW5zZXJ0OiAndGV4dEFsaWdtZW50VG9vbHMnLFxuICAgICAgdmFsdWU6IFwidGV4dEFsaWduXCIsXG4gICAgICBtZW51OiB7XG4gICAgICAgIHRleHRBbGlnbkNlbnRlcjoge1xuICAgICAgICAgIHRpdGxlOiAnYWxpZ24gY2VudGVyJyxcbiAgICAgICAgICBvcHRpb246ICdjZW50ZXInLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLWNlbnRlcidcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dEFsaWduTGVmdDoge1xuICAgICAgICAgIHRpdGxlOiAnYWxpZ24gbGVmdCcsXG4gICAgICAgICAgb3B0aW9uOiAnbGVmdCcsXG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYWxpZ24tbGVmdCdcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dEFsaWduUmlnaHQ6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIHJpZ2h0JyxcbiAgICAgICAgICBvcHRpb246ICdyaWdodCcsXG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYWxpZ24tcmlnaHQnXG4gICAgICAgIH0sXG4gICAgICAgIHRleHRBbGlnbkp1c3RpZnk6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIGp1c3RpZnknLFxuICAgICAgICAgIG9wdGlvbjogJ2p1c3RpZnknLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLWp1c3RpZnknXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGZvbnRGYW1pbHk6IHtcbiAgICAgIHR5cGU6ICdmb250RmFtaWx5JyxcbiAgICAgIHRpdGxlOiAnZm9udCBmYW1pbHknLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZm9udCcsXG4gICAgICB2YWx1ZTogJ2ZvbnRGYW1pbHknLFxuICAgICAgZGF0YTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hcHBsaWNhdGlvbi5mb250c1xuICAgICAgfVxuICAgIH0sXG4gICAgdGV4dEZvbnRTaXplOiB7XG4gICAgICBpbnNlcnQ6ICd0ZXh0Rm9udFNpemVUb29scycsXG4gICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgIHRpdGxlOiAnZm9udFNpemUnLFxuICAgICAgdmFsdWU6ICdmb250U2l6ZSdcbiAgICB9LFxuICAgIC8qdGV4dEZvbnQ6IHtcbiAgICAgaW5zZXJ0OiAndGV4dEZvbnRTaXplVG9vbHMnLFxuICAgICB0eXBlOiAnbWVudScsXG4gICAgIHRpdGxlOiAnZm9udCcsXG4gICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQnLFxuICAgICBtZW51OiB7XG4gICAgIHRleHRGb250U2l6ZURlY3JlYXNlOiB7XG4gICAgIHRpdGxlOiAnZGVjcmVhc2VGb250U2l6ZScsXG4gICAgIGFjdGlvbjogX1RFWC5kZWNyZWFzZUZvbnRTaXplLFxuICAgICBjbGFzc05hbWU6ICdmYSBmYS1mb250IGZvbnQtc2l6ZS1kZWNyZWFzZSdcbiAgICAgfSxcbiAgICAgdGV4dEZvbnRTaXplSW5jcmVhc2U6IHtcbiAgICAgdGl0bGU6ICdpbmNyZWFzZUZvbnRTaXplJyxcbiAgICAgYWN0aW9uOiBfVEVYLmluY3JlYXNlRm9udFNpemUsXG4gICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQgZm9udC1zaXplLWluY3JlYXNlJ1xuICAgICB9XG4gICAgIH1cbiAgICAgfSovXG4gICAgYWR2YW5jZWRDb2xvcnNUb29sczoge1xuICAgICAgY2xhc3NOYW1lOiAnY29sb3JzJyxcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIHRpdGxlOiAnY29sb3JzJyxcbiAgICAgIHRvZ2dsZWQ6IHRydWUsXG4gICAgICBtZW51OiBbXCJmaWxsXCIsIFwidGV4dEJnY29sb3JcIiwgXCJ0ZXh0VGV4dGJnY29sb3JcIiwgXCJmaWxsXCJdXG4gICAgfSxcbiAgICB0ZXh0U3R5bGU6IHtcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIHRpdGxlOiAndGV4dCBzdHlsZScsXG4gICAgICB0b2dnbGVkOiB0cnVlLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZm9udCcsXG4gICAgICBzdHlsZTogJ2dlbmVyYXRlVGV4dFN0eWxlJyxcbiAgICAgIG1lbnU6IFtcbiAgICAgICAgXCJ0ZXh0Qm9sZFwiLCBcInRleHRJdGFsaWNcIiwgXCJ0ZXh0VW5kZXJsaW5lXCIsIFwidGV4dExpbmV0aHJvdWdoXCIsXG4gICAgICAgIFwidGV4dE92ZXJsaW5lXCIsIFwidGV4dEFsaWduXCIsIFwiZm9udEZhbWlseVwiLCBcInRleHRGb250U2l6ZVwiXG4gICAgICBdXG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSVRleHQucHJvdG90eXBlLCB7XG4gIGFjdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgIGVudGVyRWRpdGluZzoge1xuICAgICAgaW5zZXJ0OiAnZWRpdFRvb2wnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtcGVuY2lsLXNxdWFyZS1vJyxcbiAgICAgIHRpdGxlOiAnZWRpdCdcbiAgICB9XG4gIH0sIGZhYnJpYy5UZXh0LnByb3RvdHlwZS5hY3Rpb25zKVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkltYWdlLnByb3RvdHlwZSwge1xuICBhY3Rpb25zOiB7XG4gICAgc291cmNlOiB7XG4gICAgICB0eXBlOiAnZWZmZWN0JyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZpbGUtaW1hZ2UtbycsXG4gICAgICB0aXRsZTogXCJzb3VyY2VcIixcbiAgICAgIGFjdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uICgkZWwsIGRhdGEpIHtcbiAgICAgICAgZGF0YS50YXJnZXQuYXBwbGljYXRpb24uY3JlYXRlR2FsbGVyeShkYXRhLnRhcmdldCwgJGVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL2FjdGlvbnMuanMiLCJcblxuXG5sZXQgU3RhdGVNaXhpbiA9IHtcbiAgX3NhdmVTdGF0ZU92ZXJ3cml0dGVuOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zYXZlU3RhdGUsXG4gIGdldFByb3BlcnRpZXM6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzKSB7XG4gICAgbGV0IG9iamVjdCA9IHt9O1xuICAgIGZvciAobGV0IHByb3Agb2YgcHJvcGVydGllcyl7XG4gICAgICBvYmplY3RbcHJvcF0gPSB0aGlzW1wic3RvcmVfXCIgKyBwcm9wXSA/IHRoaXNbXCJzdG9yZV9cIiArIHByb3BdKCkgOiB0aGlzW3Byb3BdO1xuICAgIH1cbiAgICByZXR1cm4gb2JqZWN0O1xuICB9LFxuICAvKipcbiAgICogU2F2ZXMgc3RhdGUgb2YgYW4gb2JqZWN0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT2JqZWN0IHdpdGggYWRkaXRpb25hbCBgc3RhdGVQcm9wZXJ0aWVzYCBhcnJheSB0byBpbmNsdWRlIHdoZW4gc2F2aW5nIHN0YXRlXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmdcbiAgICovXG4gIHNhdmVTdGF0ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBsZXQgX2luY2x1ZGVEZWZhdWx0VmFsdWVzID0gdGhpcy5pbmNsdWRlRGVmYXVsdFZhbHVlcztcbiAgICBpZighX2luY2x1ZGVEZWZhdWx0VmFsdWVzKXtcbiAgICAgIHRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMgPSB0cnVlO1xuICAgIH1cbiAgICBpZihmYWJyaWMudmVyc2lvbi5pbmRleE9mKFwiMS43XCIpID09PSAwKXtcbiAgICAgIGlmKCFvcHRpb25zKXtcbiAgICAgICAgdGhpcy5fc3RhdGVQcm9wZXJ0aWVzID0gdGhpcy50b09iamVjdCgpO1xuICAgICAgfWVsc2UgaWYob3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5fc3RhdGVQcm9wZXJ0aWVzID0gdGhpcy5nZXRQcm9wZXJ0aWVzKG9wdGlvbnMpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMuX3NhdmVTdGF0ZU92ZXJ3cml0dGVuKG9wdGlvbnMpO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5vcmlnaW5hbFN0YXRlID0gdGhpcy50b09iamVjdCgpO1xuICAgIH1cbiAgICBpZighX2luY2x1ZGVEZWZhdWx0VmFsdWVzKXtcbiAgICAgIHRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMgPSBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgZ2V0TW9kaWZpZWRTdGF0ZXM6IGZ1bmN0aW9uICgpIHtcblxuICAgIGxldCBfb3JpZ2luYWxTdGF0ZTtcbiAgICBpZihmYWJyaWMudmVyc2lvbi5pbmRleE9mKFwiMS43XCIpID09PSAwKXtcbiAgICAgIF9vcmlnaW5hbFN0YXRlID0gdGhpcy5fc3RhdGVQcm9wZXJ0aWVzO1xuICAgIH1lbHNle1xuICAgICAgX29yaWdpbmFsU3RhdGUgPSB0aGlzLm9yaWdpbmFsU3RhdGU7XG4gICAgfVxuXG4gICAgbGV0IF9jb3VudGVyID0gMDtcbiAgICBsZXQgc3RhdGVzID0ge1xuICAgICAgb3JpZ2luYWw6IHt9LFxuICAgICAgbW9kaWZpZWQ6IHt9XG4gICAgfTtcblxuICAgIGxldCBfaW5jbHVkZURlZmF1bHRWYWx1ZXMgPSB0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzO1xuICAgIGlmKCFfaW5jbHVkZURlZmF1bHRWYWx1ZXMpe1xuICAgICAgdGhpcy5pbmNsdWRlRGVmYXVsdFZhbHVlcyA9IHRydWU7XG4gICAgfVxuICAgIGxldCBzdGF0ZSA9IHRoaXMudG9PYmplY3QoKTtcbiAgICBpZighX2luY2x1ZGVEZWZhdWx0VmFsdWVzKSB7XG4gICAgICB0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzID0gZmFsc2U7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgcHJvcCBpbiBfb3JpZ2luYWxTdGF0ZSkge1xuICAgICAgaWYgKF9vcmlnaW5hbFN0YXRlW3Byb3BdICE9PSBzdGF0ZVtwcm9wXSkge1xuICAgICAgICBpZiAoX29yaWdpbmFsU3RhdGVbcHJvcF0gaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkoX29yaWdpbmFsU3RhdGVbcHJvcF0pID09PSBKU09OLnN0cmluZ2lmeShzdGF0ZVtwcm9wXSkpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzdGF0ZXMub3JpZ2luYWxbcHJvcF0gPSBfb3JpZ2luYWxTdGF0ZVtwcm9wXTtcbiAgICAgICAgc3RhdGVzLm1vZGlmaWVkW3Byb3BdID0gc3RhdGVbcHJvcF07XG4gICAgICAgIF9jb3VudGVyKys7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfY291bnRlciAmJiBzdGF0ZXM7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIFN0YXRlTWl4aW4pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCBTdGF0ZU1peGluLCB7XG4gIF9maW5hbGl6ZUN1cnJlbnRUcmFuc2Zvcm06IGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgdHJhbnNmb3JtID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSxcbiAgICAgIHRhcmdldCA9IHRyYW5zZm9ybS50YXJnZXQ7XG4gICAgaWYgKHRhcmdldC5fc2NhbGluZykge1xuICAgICAgdGFyZ2V0Ll9zY2FsaW5nID0gZmFsc2U7XG4gICAgfVxuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICB0aGlzLl9yZXN0b3JlT3JpZ2luWFkodGFyZ2V0KTtcbiAgICB0YXJnZXQuZmlyZShcIm1vZGlmaWVkXCIse30pO1xuICAgIHRoaXMuZmlyZShcIm9iamVjdDptb2RpZmllZFwiLHt0YXJnZXQ6IHRhcmdldH0pO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9mYWJyaWMuc3RhdGVzLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYyx7XG4gIGRlYnVnVGltZW91dDogMFxufSk7XG5cbmZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLmVuYWJsZUNvbnNvbGVEZWJ1Z2dpbmcgPSBmdW5jdGlvbigpe1xuICB3aW5kb3cuY2FudmFzID0gdGhpcztcbiAgdGhpcy5vbihcIm9iamVjdDpzZWxlY3RlZFwiLCBmdW5jdGlvbiAoZSkge1xuICAgIHdpbmRvdy50YXJnZXQgPSBlLnRhcmdldDtcbiAgfSk7XG4gIHRoaXMub24oXCJzZWxlY3Rpb246dXBkYXRlZFwiLCBmdW5jdGlvbiAoZSkge1xuICAgIHdpbmRvdy50YXJnZXQgPSBlLnRhcmdldDtcbiAgfSk7XG4gIHRoaXMub24oXCJzZWxlY3Rpb246Y2xlYXJlZFwiLCBmdW5jdGlvbiAoZSkge1xuICAgIHdpbmRvdy50YXJnZXQgPSBudWxsO1xuICB9KTtcbiAgdGhpcy5vbihcInNlbGVjdGlvbjpjcmVhdGVkXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgd2luZG93LnRhcmdldCA9IGUudGFyZ2V0O1xuICB9KTtcbn07XG5cbmZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnNldERlYnVnID0gZnVuY3Rpb24odmFsKXtcbiBpZih2YWwpe1xuICAgdGhpcy5lbmFibGVDb25zb2xlRGVidWdnaW5nKCk7XG4gfVxufTtcblxuZmFicmljLkVkaXRvciAmJiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLCB7XG4gIGxvZ0V2ZW50czogZmFicmljLk9iamVjdC5wcm90b3R5cGUubG9nRXZlbnRzID0gZnVuY3Rpb24gZXZlbnRzTG9nZ2VyKG9wdGlvbnMpe1xuICAgIHZhciBfY291bnRlciA9IHt9O1xuICAgIGZvcih2YXIgaSBpbiBvcHRpb25zKXtcbiAgICAgIF9jb3VudGVyW2ldID0gMDtcbiAgICAgIHRoaXMub24ob3B0aW9uc1tpXSxmdW5jdGlvbihpLCBldmVudCkge1xuICAgICAgICBjb25zb2xlLmxvZyhpICsgXCIgXCIgKyArK19jb3VudGVyW2ldLGV2ZW50KTtcbiAgICAgIH0uYmluZCh0aGlzLGkpKTtcbiAgICB9XG4gIH0sXG4gIHNldERlYnVnOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICBmYWJyaWMuZGVidWcgPSB2YWx1ZTtcbiAgICB0aGlzLm9uKFwicmVhZHlcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5lbmFibGVEZWJ1Z2dpbmcoKTtcbiAgICB9KVxuICB9LFxuXG4gIGVuYWJsZURlYnVnZ2luZzogZnVuY3Rpb24oKXtcbiAgICBpZihmYWJyaWMuZGVidWcpe1xuXG4gICAgICB2YXIgX29wZXJhbmQgPSBcImNvbG9yOiAjMkVDMDZDOyBmb250LXN0eWxlOiBpdGFsaWM7XCI7XG4gICAgICBjb25zb2xlLmluZm8oXCJkZWJ1ZyBlbmFibGVkLiAodXNlICVjYXBwJWMsICVjcHJvamVjdCVjLCAlY2NhbnZhcyVjLCAlY3RhcmdldCVjIGluIGNvbnNvbGUpXCIsXG4gICAgICAgIF9vcGVyYW5kLCBcImNvbG9yOiAjMjAyMDIwXCIsXG4gICAgICAgIF9vcGVyYW5kLCBcImNvbG9yOiAjMjAyMDIwXCIsXG4gICAgICAgIF9vcGVyYW5kLCBcImNvbG9yOiAjMjAyMDIwXCIsXG4gICAgICAgIF9vcGVyYW5kLCBcImNvbG9yOiAjMjAyMDIwXCIpO1xuXG4gICAgICB3aW5kb3dbZmFicmljLmRlYnVnXSA9IHRoaXM7XG4gICAgICB3aW5kb3cuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgICB3aW5kb3cudGFyZ2V0ID0gbnVsbDtcblxuICAgICAgdGhpcy5vbihcInRhcmdldDpjaGFuZ2VkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2luZG93LnRhcmdldCA9IHRoaXMudGFyZ2V0O1xuICAgICAgfSk7XG4gICAgICB0aGlzLm9uKFwic2xpZGU6Y2hhbmdlZFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB3aW5kb3cuY2FudmFzID0gZS5jYW52YXM7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5kZWJ1ZyA9IGZ1bmN0aW9uKG5vQm9yZGVycyl7XG4gIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBjYW52YXMud2lkdGggPSBub0JvcmRlcnMgP3RoaXMud2lkdGg6IHRoaXMud2lkdGggKyAyO1xuICBjYW52YXMuaGVpZ2h0ID0gbm9Cb3JkZXJzID90aGlzLmhlaWdodCA6IHRoaXMuaGVpZ2h0ICsgMjtcblxuICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gIGlmKCFub0JvcmRlcnMpe1xuICAgIGN0eC5saW5lV2lkdGg9MTtcbiAgICBjdHguc3Ryb2tlU3R5bGU9XCJ5ZWxsb3dcIjtcbiAgICBjdHguc3Ryb2tlUmVjdCgwLDAsdGhpcy53aWR0aCArIDIsdGhpcy5oZWlnaHQrIDIpO1xuICAgIGN0eC5zZXRMaW5lRGFzaChbNCw0XSk7XG4gICAgY3R4LnN0cm9rZVN0eWxlPVwiIzAwMDAwMFwiO1xuICAgIGN0eC5zdHJva2VSZWN0KDAsMCx0aGlzLndpZHRoICsgMix0aGlzLmhlaWdodCsgMik7XG4gIH1cbiAgY3R4LnRyYW5zbGF0ZSh0aGlzLndpZHRoLzIgICsgMSx0aGlzLmhlaWdodC8yICsgMSk7XG4gIHZhciBfY2xpcFRvID0gdGhpcy5jbGlwVG87XG4gIGRlbGV0ZSB0aGlzLmNsaXBUbztcbiAgdGhpcy5yZW5kZXIoY3R4LHRydWUpO1xuICB0aGlzLmNsaXBUbyA9IF9jbGlwVG87XG4gIHdpbmRvdy5vcGVuKGNhbnZhcy50b0RhdGFVUkwoKSxcIl9ibGFua1wiKTtcbn07XG5cblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2RlYnVnLmpzIiwiXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBtYWtlcyBjYW52YXMgcmVzcG9uc2libGUuIENhbnZhcyB3aWxsIGJlIHNjYWxlZCB0byAxMDAlIG9mIGl0cyBjb250YWluZXIgc2l6ZVxuICAgKi9cbiAgc3RyZXRjaGFibGU6IGZhbHNlLFxuICBfb25SZXNpemU6IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5zdHJldGNoYWJsZSl7XG4gICAgICBpZighdGhpcy53cmFwcGVyRWwucGFyZW50Tm9kZSlyZXR1cm47XG4gICAgICAvLyBpZiAoY2FudmFzLnZpcnR1YWwpIHJldHVybjtcbiAgICAgIHZhciBfcGFyZW50ID0gJCh0aGlzLndyYXBwZXJFbC5wYXJlbnROb2RlKTtcblxuICAgICAgdmFyIF9vZmZzZXQgPSAkKHRoaXMud3JhcHBlckVsKS5wb3NpdGlvbigpO1xuICAgICAgdmFyIF9tYXJnaW4gPSB0aGlzLmFwcGxpY2F0aW9uICYmIHRoaXMuYXBwbGljYXRpb24ud2lkdGhNYXJnaW4gfHwgMDtcbiAgICAgIHZhciBfdyA9IF9wYXJlbnQud2lkdGgoKSAtIF9tYXJnaW4sIF9oID0gX3BhcmVudC5oZWlnaHQoKTtcbiAgICAgIGlmICh0aGlzLmFwcGxpY2F0aW9uICYmIHRoaXMuYXBwbGljYXRpb24ub25SZXNpemUpIHtcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi5vblJlc2l6ZSh7XG4gICAgICAgICAgd2lkdGg6IF93LFxuICAgICAgICAgIGhlaWdodDogX2hcbiAgICAgICAgfSwge1xuICAgICAgICAgIHdpZHRoOiB0aGlzLm9yaWdpbmFsV2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNhbGNPZmZzZXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0RGltZW5zaW9ucyh7XG4gICAgICAgICAgd2lkdGg6IF93IC8qLSBfb2Zmc2V0LmxlZnQqLyAtIF9tYXJnaW4sXG4gICAgICAgICAgaGVpZ2h0OiBfaCAvKi0gX29mZnNldC50b3AqL1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuY2FsY09mZnNldCgpO1xuICAgIH1cbiAgfSxcbiAgc2V0U3RyZXRjaGFibGU6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICB0aGlzLnN0cmV0Y2hhYmxlID0gdmFsO1xuICAgIHRoaXMuX29uUmVzaXplKCk7XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3NsaWRlLnN0cmV0Y2hhYmxlLmpzIiwiY29uZmlndXJhdGlvblByb3BlcnRpZXM6IFtdXG5cbmZhYnJpYy5FZGl0b3IucHJvdG90eXBlLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzLnB1c2goXCJ0ZW1wbGF0ZXNcIik7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkVkaXRvci5wcm90b3R5cGUsIHtcbiAgc2V0VGVtcGxhdGVzOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICB0aGlzLnRlbXBsYXRlcyA9IHZhbHVlO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwibG9hZGluZzpiZWdpblwiOiBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLl9hcHBseVRlbXBsYXRlKGUub3B0aW9ucylcbiAgICB9XG4gIH0pXG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwibG9hZGluZzpiZWdpblwiOiBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLl9hcHBseVRlbXBsYXRlKGUub3B0aW9ucylcbiAgICB9XG4gIH0pLFxuXG4gIF9hcHBseVRlbXBsYXRlOiBmdW5jdGlvbihvcHRpb25zKXtcbiAgICBsZXQgdmFsID0gb3B0aW9ucy50ZW1wbGF0ZTtcbiAgICBpZih2YWwpe1xuICAgICAgbGV0IHRwbCA9IHRoaXMuZ2V0VGVtcGxhdGUodmFsKTtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob3B0aW9ucyx0cGwuZGF0YSk7XG4gICAgICBpZih0cGwuZGF0YS53aWR0aCl7XG4gICAgICAgIG9wdGlvbnMub3JpZ2luYWxXaWR0aCA9IHRwbC5kYXRhLndpZHRoO1xuICAgICAgfVxuICAgICAgaWYodHBsLmRhdGEuaGVpZ2h0KXtcbiAgICAgICAgb3B0aW9ucy5vcmlnaW5hbEhlaWdodCA9IHRwbC5kYXRhLmhlaWdodDtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIC8qdFRlbXBsYXRlOiBmdW5jdGlvbih0ZW1wbGF0ZSl7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGU7XG4gICAgaWYoIXRlbXBsYXRlKXJldHVybjtcblxuICAgIHRoaXMuc2V0V2lkdGgodGhpcy5zbGlkZVdpZHRoIHx8IHRlbXBsYXRlLndpZHRoKTtcbiAgICB0aGlzLnNldEhlaWdodCh0aGlzLnNsaWRlSGVpZ2h0IHx8IHRlbXBsYXRlLmhlaWdodCk7XG4gICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IHRoaXMud2lkdGg7XG5cbiAgICB0aGlzLnNldChmYWJyaWMudXRpbC5vYmplY3QucmVhcnJhbmdlKHRlbXBsYXRlLFtcImFyZWFzXCIsXCJoZWxwZXJzXCIsXCJvZmZzZXRzXCJdKSk7XG5cbiAgICB0aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG4gICAgdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfb3ZlcmxheV9pbWFnZShcImJhY2tncm91bmRcIik7XG4gICAgdGhpcy5maXJlKFwibW9kaWZpZWRcIix7dHlwZTogXCJ0ZW1wbGF0ZVwifSk7XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfSwqL1xuICAvLyBzZXRUZW1wbGF0ZTogZnVuY3Rpb24odmFsdWUpe1xuICAvLyAgIHRoaXMudGVtcGxhdGUgPSB2YWx1ZTtcbiAgLy8gfSxcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGdldFRlbXBsYXRlOiBmdW5jdGlvbihpZCl7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5hcHBsaWNhdGlvbi50ZW1wbGF0ZXMse2lkOiBpZH0pXG4gIH0sXG4gIHVwZGF0ZVNsaWRlVGVtcGxhdGU6IGZ1bmN0aW9uKHNsaWRlKSB7XG4gICAgc2xpZGUuY2FudmFzLnNldFRlbXBsYXRlKHNsaWRlLmNhbnZhcy50ZW1wbGF0ZSk7XG4gICAgdGhpcy5jYW52YXMudGVtcGxhdGUgPSBzbGlkZS5jYW52YXMudGVtcGxhdGU7XG4gICAgaWYodGhpcy5hY3RpdmVTbGlkZSAgPT0gc2xpZGUpe1xuICAgICAgdGhpcy5jYW52YXMuc2V0VGVtcGxhdGUoc2xpZGUuY2FudmFzLnRlbXBsYXRlKTtcbiAgICB9XG4gIH0sXG4gIHVwZGF0ZVRlbXBsYXRlOiBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLnNsaWRlcyl7XG4gICAgICBpZih0aGlzLnNsaWRlc1tpXS5jYW52YXMudGVtcGxhdGUgPT0gdGVtcGxhdGUpe1xuICAgICAgICB0aGlzLnVwZGF0ZVNsaWRlVGVtcGxhdGUodGhpcy5zbGlkZXNbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvc2xpZGUudGVtcGxhdGUuanMiLCIvKipcbiAqIHNwZWNpZmljIG9yZGVyIGZ1bmN0aW9ucy4gQWxsb3cgdG8gbW92ZSBvYmplY3Qgb25seSB3aXRoaW4gb2JqZWN0YHMgbGF5ZXJcbiAqL1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBfdG9Gcm9udChvYmope1xuICAgIGlmKG9iai5sYXllcikge1xuICAgICAgdmFyIGxheWVySW5kZXggPSB0aGlzLl9sYXllcnMuaW5kZXhPZihvYmoubGF5ZXIpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmICh0aGlzLl9vYmplY3RzW2ldLmxheWVyICYmIHRoaXMuX2xheWVycy5pbmRleE9mKHRoaXMuX29iamVjdHNbaV0ubGF5ZXIpID4gbGF5ZXJJbmRleCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9vYmplY3RzLnNwbGljZShpLCAwLCBvYmopO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuX29iamVjdHMucHVzaChvYmopO1xuICAgIH1cbiAgfSxcbiAgX3RvQmFjayhvYmope1xuICAgIGlmKG9iai5sYXllcikge1xuICAgICAgdmFyIGxheWVySW5kZXggPSB0aGlzLl9sYXllcnMuaW5kZXhPZihvYmoubGF5ZXIpO1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgIGlmICh0aGlzLl9vYmplY3RzW2ldLmxheWVyICYmIHRoaXMuX2xheWVycy5pbmRleE9mKHRoaXMuX29iamVjdHNbaV0ubGF5ZXIpIDwgbGF5ZXJJbmRleCkge1xuICAgICAgICAgIHRoaXMuX29iamVjdHMuc3BsaWNlKGkgKyAxLCAwLCBvYmopO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuX29iamVjdHMudW5zaGlmdChvYmopO1xuICB9LFxuICBhZGQgKCkge1xuICAgIGZvciAobGV0IG9iaiBvZiBhcmd1bWVudHMpIHtcbiAgICAgIHRoaXMuX3RvRnJvbnQob2JqKVxuXG4gICAgICBpZiAodGhpcy5fb25PYmplY3RBZGRlZCkge1xuICAgICAgICB0aGlzLl9vbk9iamVjdEFkZGVkKG9iaik7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMucmVuZGVyT25BZGRSZW1vdmUgJiYgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgLyoqXG4gICAqIE1vdmVzIGFuIG9iamVjdCBvciB0aGUgb2JqZWN0cyBvZiBhIG11bHRpcGxlIHNlbGVjdGlvblxuICAgKiB0byB0aGUgYm90dG9tIG9mIHRoZSBzdGFjayBvZiBkcmF3biBvYmplY3RzXG4gICAqIEBwYXJhbSB7ZmFicmljLk9iamVjdH0gb2JqZWN0IE9iamVjdCB0byBzZW5kIHRvIGJhY2tcbiAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICBzZW5kVG9CYWNrOiBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgaWYgKCFvYmplY3QpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLl9hY3RpdmVHcm91cCxcbiAgICAgIGksIG9iaiwgb2JqcztcbiAgICBpZiAob2JqZWN0ID09PSBhY3RpdmVHcm91cCkge1xuICAgICAgb2JqcyA9IGFjdGl2ZUdyb3VwLl9vYmplY3RzO1xuICAgICAgZm9yIChpID0gb2Jqcy5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgb2JqID0gb2Jqc1tpXTtcbiAgICAgICAgZmFicmljLnV0aWwucmVtb3ZlRnJvbUFycmF5KHRoaXMuX29iamVjdHMsIG9iaik7XG4gICAgICAgIHRoaXMuX29iamVjdHMudW5zaGlmdChvYmopO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGZhYnJpYy51dGlsLnJlbW92ZUZyb21BcnJheSh0aGlzLl9vYmplY3RzLCBvYmplY3QpO1xuICAgICAgdGhpcy5fdG9CYWNrKG9iamVjdCk7XG4gICAgICB0aGlzLmZpcmUoXCJvYmplY3Q6cmVwbGFjZWRcIix7dGFyZ2V0Om9iamVjdCB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyQWxsICYmIHRoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIE1vdmVzIGFuIG9iamVjdCBvciB0aGUgb2JqZWN0cyBvZiBhIG11bHRpcGxlIHNlbGVjdGlvblxuICAgKiB0byB0aGUgdG9wIG9mIHRoZSBzdGFjayBvZiBkcmF3biBvYmplY3RzXG4gICAqIEBwYXJhbSB7ZmFicmljLk9iamVjdH0gb2JqZWN0IE9iamVjdCB0byBzZW5kXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgYnJpbmdUb0Zyb250OiBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgaWYgKCFvYmplY3QpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLl9hY3RpdmVHcm91cCxcbiAgICAgIGksIG9iaiwgb2JqcztcbiAgICBpZiAob2JqZWN0ID09PSBhY3RpdmVHcm91cCkge1xuICAgICAgb2JqcyA9IGFjdGl2ZUdyb3VwLl9vYmplY3RzO1xuICAgICAgZm9yIChpID0gMDsgaSA8IG9ianMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgb2JqID0gb2Jqc1tpXTtcbiAgICAgICAgZmFicmljLnV0aWwucmVtb3ZlRnJvbUFycmF5KHRoaXMuX29iamVjdHMsIG9iaik7XG4gICAgICAgIHRoaXMuX29iamVjdHMucHVzaChvYmopO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGZhYnJpYy51dGlsLnJlbW92ZUZyb21BcnJheSh0aGlzLl9vYmplY3RzLCBvYmplY3QpO1xuXG4gICAgICB0aGlzLl90b0Zyb250KG9iamVjdCk7XG4gICAgICB0aGlzLmZpcmUoXCJvYmplY3Q6cmVwbGFjZWRcIix7dGFyZ2V0Om9iamVjdCB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyQWxsICYmIHRoaXMucmVuZGVyQWxsKCk7XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG5cbiAgb25Ub3AgKCkge1xuICAgIGxldCBvYmpzID0gdGhpcy5jYW52YXMuX29iamVjdHM7XG4gICAgbGV0IGluZGV4ID0gb2Jqcy5pbmRleE9mKHRoaXMpO1xuICAgIGlmKGluZGV4ID09PSBvYmpzLmxlbmd0aCAtIDEpe1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYodGhpcy5sYXllcil7XG4gICAgICAvLyBJZiBhYm92ZSBvYmplY3QgaXMgb24gYW5vdGhlciBsYXllciB3ZSBjb3VsZCBub3QgYnJpbmcgb3VyIG9iamVjdCBmb3J3YXJkXG4gICAgICBpZihvYmpzW2luZGV4ICsgMV0ubGF5ZXIgJiYgb2Jqc1tpbmRleCArIDFdLmxheWVyICE9IHRoaXMubGF5ZXIpe1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBvbkJvdHRvbSAoKSB7XG4gICAgbGV0IG9ianMgPSB0aGlzLmNhbnZhcy5fb2JqZWN0cztcbiAgICBsZXQgaW5kZXggPSBvYmpzLmluZGV4T2YodGhpcyk7XG4gICAgaWYoaW5kZXggPT09IDApe1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYodGhpcy5sYXllcil7XG4gICAgICAvLyBJZiBhYm92ZSBvYmplY3QgaXMgb24gYW5vdGhlciBsYXllciB3ZSBjb3VsZCBub3QgYnJpbmcgb3VyIG9iamVjdCBmb3J3YXJkXG4gICAgICBpZihvYmpzW2luZGV4IC0gMV0ubGF5ZXIgJiYgb2Jqc1tpbmRleCAtIDFdLmxheWVyICE9IHRoaXMubGF5ZXIpe1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICAvKipcbiAgICogTW92ZXMgYW4gb2JqZWN0IGRvd24gaW4gc3RhY2sgb2YgZHJhd24gb2JqZWN0c1xuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtpbnRlcnNlY3RpbmddIElmIGB0cnVlYCwgc2VuZCBvYmplY3QgYmVoaW5kIG5leHQgbG93ZXIgaW50ZXJzZWN0aW5nIG9iamVjdFxuICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIHNlbmRCYWNrd2FyZHMgKGludGVyc2VjdGluZykge1xuICAgIGlmICh0aGlzLmdyb3VwKSB7XG4gICAgICBmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5zZW5kQmFja3dhcmRzLmNhbGwodGhpcy5ncm91cCwgdGhpcywgaW50ZXJzZWN0aW5nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmNhbnZhcy5zZW5kQmFja3dhcmRzKHRoaXMsIGludGVyc2VjdGluZyk7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0OnJlcGxhY2VkXCIse3RhcmdldDp0aGlzIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICAvKipcbiAgICogTW92ZXMgYW4gb2JqZWN0IHVwIGluIHN0YWNrIG9mIGRyYXduIG9iamVjdHNcbiAgICogQHBhcmFtIHtCb29sZWFufSBbaW50ZXJzZWN0aW5nXSBJZiBgdHJ1ZWAsIHNlbmQgb2JqZWN0IGluIGZyb250IG9mIG5leHQgdXBwZXIgaW50ZXJzZWN0aW5nIG9iamVjdFxuICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIGJyaW5nRm9yd2FyZCAoaW50ZXJzZWN0aW5nKSB7XG4gICAgaWYgKHRoaXMuZ3JvdXApIHtcbiAgICAgIGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLmJyaW5nRm9yd2FyZC5jYWxsKHRoaXMuZ3JvdXAsIHRoaXMsIGludGVyc2VjdGluZyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5jYW52YXMuYnJpbmdGb3J3YXJkKHRoaXMsIGludGVyc2VjdGluZyk7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0OnJlcGxhY2VkXCIse3RhcmdldDp0aGlzIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvb2JqZWN0Lm9yZGVyLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG57XG5cbiAgLypcbiAgIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlZGlmeSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJhc2VGaWx0ZXIsIHtcbiAgIHR5cGU6ICdSZWRpZnknLFxuICAgYXBwbHlUbzogZnVuY3Rpb24gKGNhbnZhc0VsKSB7XG4gICB2YXIgY29udGV4dCA9IGNhbnZhc0VsLmdldENvbnRleHQoJzJkJyksXG4gICBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLFxuICAgY2FudmFzRWwud2lkdGgsIGNhbnZhc0VsLmhlaWdodCksXG4gICBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7XG4gICBmb3IgKHZhciBpID0gMCwgbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkgKz0gNCkge1xuICAgZGF0YVtpICsgMV0gPSAwO1xuICAgZGF0YVtpICsgMl0gPSAwO1xuICAgfVxuICAgY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTtcbiAgIH1cbiAgIH0pO1xuICAgZmFicmljLkltYWdlLmZpbHRlcnMuUmVkaWZ5LmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlZGlmeShvYmplY3QpO1xuICAgfTtcbiAgICovXG5cbiAgZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbiA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5JbWFnZS5maWx0ZXJzLkNvbnZvbHV0ZSwge1xuICAgIHR5cGU6ICdTaGFycGVuJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IH07XG5cbiAgICAgIHRoaXMub3BhcXVlID0gb3B0aW9ucy5vcGFxdWU7XG4gICAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgICAwLCAtMSwgMCxcbiAgICAgICAgICAtMSwgNSwgLTEsXG4gICAgICAgICAgMCwgLTEsIDBcbiAgICAgICAgXTtcbiAgICB9XG4gIH0pO1xuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5TaGFycGVuLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5TaGFycGVuKG9iamVjdCk7XG4gIH07XG5cbiAgZmFicmljLkltYWdlLmZpbHRlcnMuQmx1ciA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5JbWFnZS5maWx0ZXJzLkNvbnZvbHV0ZSwge1xuICAgIHR5cGU6ICdCbHVyJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IH07XG5cbiAgICAgIHZhciBfdiA9IDEgLyA5O1xuICAgICAgdGhpcy5vcGFxdWUgPSBvcHRpb25zLm9wYXF1ZTtcbiAgICAgIHRoaXMubWF0cml4ID0gb3B0aW9ucy5tYXRyaXggfHwgW1xuICAgICAgICAgIF92LCBfdiwgX3YsXG4gICAgICAgICAgX3YsIF92LCBfdixcbiAgICAgICAgICBfdiwgX3YsIF92XG4gICAgICAgIF07XG4gICAgfVxuICB9KTtcbiAgZmFicmljLkltYWdlLmZpbHRlcnMuQmx1ci5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuQmx1cihvYmplY3QpO1xuICB9O1xuXG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkVtYm9zcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5JbWFnZS5maWx0ZXJzLkNvbnZvbHV0ZSwge1xuICAgIHR5cGU6ICdFbWJvc3MnLFxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHsgfTtcblxuICAgICAgdGhpcy5vcGFxdWUgPSBvcHRpb25zLm9wYXF1ZTtcbiAgICAgIHRoaXMubWF0cml4ID0gb3B0aW9ucy5tYXRyaXggfHwgW1xuICAgICAgICAgIDEsICAgMSwgICAxLFxuICAgICAgICAgIDEsIDAuNywgIC0xLFxuICAgICAgICAgIC0xLCAgLTEsICAtMVxuICAgICAgICBdO1xuICAgIH1cbiAgfSk7XG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkVtYm9zcy5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuRW1ib3NzKG9iamVjdCk7XG4gIH07XG5cblxuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5NYXNrLnByb3RvdHlwZS5tYXNrRmlsdGVyID0gdHJ1ZTtcblxuICB2YXIgcHJvdG90eXBlT3B0aW9ucyA9IHtcbiAgICBCcmlnaHRuZXNzOiB7XG4gICAgICBcImJyaWdodG5lc3NcIjoge3ZhbHVlOiAxMDAsIG1pbjogMCwgbWF4OiAyNTV9XG4gICAgfSxcbiAgICBOb2lzZToge1xuICAgICAgXCJub2lzZVwiOiB7dmFsdWU6IDEwMCwgbWluOiAwLCBtYXg6IDEwMDB9XG4gICAgfSxcbiAgICBDb252b2x1dGU6IHtcbiAgICAgIFwib3BhcXVlXCI6IHt2YWx1ZTogdHJ1ZSwgdHlwZTogXCJib29sZWFuXCIgfSxcbiAgICAgIFwibWF0cml4XCI6IHt2YWx1ZTogWzEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdLCB0eXBlOiBcIm1hdHJpeFwiIH1cbiAgICB9LFxuICAgIEJsdXI6IHt9LFxuICAgIFNoYXJwZW46IHt9LFxuICAgIEVtYm9zczoge30sXG4gICAgTXVsdGlwbHk6IHtcbiAgICAgIFwiY29sb3JcIjoge3R5cGU6ICdjb2xvcicsIHZhbHVlOiBcIiNGMEZcIn1cbiAgICB9LFxuICAgIFBpeGVsYXRlOiB7XG4gICAgICBcImJsb2Nrc2l6ZVwiOiB7dmFsdWU6IDQsIG1pbjogMiwgbWF4OiAyMH1cbiAgICB9LFxuICAgIFRpbnQ6IHtcbiAgICAgIFwiY29sb3JcIjogIHt0eXBlOiAnY29sb3InLCB2YWx1ZTogXCIjMzUxM0IwXCJ9LFxuICAgICAgXCJvcGFjaXR5XCI6IHt2YWx1ZTogMSwgbWluOiAwLCBtYXg6IDEsIHN0ZXA6IDAuMX1cbiAgICB9LFxuICAgIE1hc2s6IHtcbiAgICAgIG1hc2s6IHtcbiAgICAgICAgdHlwZTogJ2ltYWdlJyxcbiAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICBzcmM6ICBcInBob3Rvcy9leHBsb3Npb24ucG5nXCJcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNoYW5uZWw6IHsgdmFsdWU6IDB9XG4gICAgfSxcbiAgICBCbGVuZDoge1xuICAgICAgXCJjb2xvclwiOiB7dHlwZTogJ2NvbG9yJywgdmFsdWU6IFwiIzM1MTNCMFwifSxcbiAgICAgIFwibW9kZVwiOiB7XG4gICAgICAgIHZhbHVlOiBcImFkZFwiLFxuICAgICAgICBvcHRpb25zOiBbXG4gICAgICAgICAge3ZhbHVlOiBcImFkZFwiLCB0aXRsZTogXCJBZGRcIn0sXG4gICAgICAgICAge3ZhbHVlOiBcImRpZmZcIiwgdGl0bGU6IFwiRGlmZlwifSxcbiAgICAgICAgICB7dmFsdWU6IFwic3VidHJhY3RcIiwgdGl0bGU6IFwiU3VidHJhY3RcIn0sXG4gICAgICAgICAge3ZhbHVlOiBcIm11bHRpcGx5XCIsIHRpdGxlOiBcIk11bHRpcGx5XCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJzY3JlZW5cIiwgdGl0bGU6IFwiU2NyZWVuXCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJsaWdodGVuXCIsIHRpdGxlOiBcIkxpZ2h0ZW5cIn0sXG4gICAgICAgICAge3ZhbHVlOiBcImRhcmtlblwiLCB0aXRsZTogXCJEYXJrZW5cIn1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuXG4gIGZvcih2YXIgaSBpbiBwcm90b3R5cGVPcHRpb25zKXtcbiAgICBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tpXS5wcm90b3R5cGUub3B0aW9ucyA9IHByb3RvdHlwZU9wdGlvbnNbaV07XG4gIH1cblxuXG5cbn1cblxuXG5cblxuZmFicmljLkltYWdlLmdldEZpbHRlcnNMaXN0ID0gZnVuY3Rpb24oZWwpe1xuXG4gIGVsID0gZWwgfHwgZmFicmljLkltYWdlLnByb3RvdHlwZTtcbiAgdmFyIGZpbHRlckxpc3QgPSBbXTtcbiAgZm9yKHZhciBpIGluIGVsLmF2YWlsYWJsZUZpbHRlcnMpe1xuICAgIHZhciBfZiA9IGZhYnJpYy5JbWFnZS5maWx0ZXJzW2VsLmF2YWlsYWJsZUZpbHRlcnNbaV1dO1xuXG4gICAgdmFyIF9kYXRhID0ge1xuICAgICAgdHlwZTogICAgIGVsLmF2YWlsYWJsZUZpbHRlcnNbaV1cbiAgICB9O1xuICAgIGlmKF9mLnByb3RvdHlwZS5jdXN0b20pe1xuICAgICAgaWYoIWVsLmN1c3RvbUZpbHRlcnMpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoX2YucHJvdG90eXBlLm1hc2tGaWx0ZXIpe1xuICAgICAgaWYoIWVsLm1hc2tGaWx0ZXIpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoX2YucHJvdG90eXBlLmNhbWFuKXtcbiAgICAgIGlmKCFlbC5jYW1hbkZpbHRlcnMpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIF9kYXRhLmNhbWFuID0gdHJ1ZTtcbiAgICB9ZWxzZXtcbiAgICAgIGlmKCFlbC5mYWJyaWNGaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5vcHRpb25zKXtcbiAgICAgIF9kYXRhLm9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoX2YucHJvdG90eXBlLm9wdGlvbnMpO1xuICAgIH1cbiAgICBfZGF0YS50ZXh0ID0gX2YucHJvdG90eXBlLnRpdGxlIHx8IGVsLmF2YWlsYWJsZUZpbHRlcnNbaV07XG5cbiAgICBmaWx0ZXJMaXN0LnB1c2goX2RhdGEpXG4gIH1cbiAgcmV0dXJuIGZpbHRlckxpc3Q7XG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUsIHtcbiAgY2FtYW5GaWx0ZXJzOiBmYWxzZSxcbiAgZmFicmljRmlsdGVyczogdHJ1ZSxcbiAgY3VzdG9tRmlsdGVyczogZmFsc2UsXG4gIG1hc2tGaWx0ZXI6IGZhbHNlLFxuICBnZXRGaWx0ZXJzRGF0YSA6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX2ZpbHRlcnMgPSBmYWJyaWMuSW1hZ2UuZ2V0RmlsdGVyc0xpc3QodGhpcyk7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLmZpbHRlcnMpIHtcbiAgICAgIHZhciBfZiA9IGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUoX2ZpbHRlcnMse3R5cGU6IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKHRoaXMuZmlsdGVyc1tpXS50eXBlKX0pXG4gICAgICBpZihfZil7XG4gICAgICAgIF9mLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX2ZpbHRlcnM7XG4gIH0sXG4gIGF2YWlsYWJsZUZpbHRlcnM6IFtcbiAgICAvL2ZhYnJpY0pTXG4gICAgXCJHcmF5c2NhbGVcIixcbiAgICBcIlNlcGlhXCIsXG4gICAgXCJTZXBpYTJcIixcbiAgICBcIkludmVydFwiLFxuICAgIFwiQmx1clwiLFxuICAgIFwiU2hhcnBlblwiLFxuICAgIFwiRW1ib3NzXCIsXG4gICAgXCJCbGVuZFwiLFxuICAgIFwiVGludFwiLFxuICAgIFwiTXVsdGlwbHlcIixcbiAgICAvL1wiQ29udm9sdXRlXCIsXG4gICAgXCJOb2lzZVwiLFxuICAgIFwiQnJpZ2h0bmVzc1wiLFxuICAgIFwiUGl4ZWxhdGVcIixcbiAgICBcIkdyYWRpZW50VHJhbnNwYXJlbmN5XCIsXG4gICAgXCJNYXNrXCJcbiAgXSxcbiAgZ2V0RmlsdGVyOiBmdW5jdGlvbiAoZmlsdGVyTmFtZSkge1xuICAgIGZpbHRlck5hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcudW5jYXBpdGFsaXplKGZpbHRlck5hbWUpO1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLmZpbHRlcnMpe1xuICAgICAgaWYoZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZSh0aGlzLmZpbHRlcnNbaV0udHlwZSkgPT09IGZpbHRlck5hbWUpe1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJzW2ldO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIHNldEZpbHRlcjogZnVuY3Rpb24gKGZpbHRlcikge1xuXG4gICAgdmFyIF9vbGRfZmlsdGVyID0gZmFsc2U7XG4gICAgaWYoZmlsdGVyLnJlcGxhY2Upe1xuICAgICAgdGhpcy5maWx0ZXJzID0gW107XG4gICAgfWVsc2V7XG4gICAgICBfb2xkX2ZpbHRlciA9IGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5maWx0ZXJzLCB7dHlwZTogZmlsdGVyLnR5cGV9KTtcbiAgICAgIF9vbGRfZmlsdGVyID0gX29sZF9maWx0ZXIgJiYgX29sZF9maWx0ZXIudG9PYmplY3QoKSB8fCBmYWxzZTtcbiAgICB9XG5cblxuICAgIGlmKGZpbHRlci50eXBlKXtcbiAgICAgIHZhciBfdHlwZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZpbHRlci50eXBlLHRydWUpO1xuICAgICAgdmFyIF9uZXdfZmlsdGVyID0gZmlsdGVyLm9wdGlvbnMgJiYgZmFicmljLnV0aWwub2JqZWN0LmNsb25lKGZpbHRlci5vcHRpb25zKTtcblxuXG4gICAgfWVsc2V7XG4gICAgICBfdHlwZSA9IGZhbHNlO1xuICAgICAgX25ld19maWx0ZXIgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvKiB0aGlzLnByb2plY3QuaGlzdG9yeS5hZGQoe1xuICAgICBkYXRhOiAgIFskLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5kYXRhKV0sXG4gICAgIHNsaWRlOiAgdGhpcy5zbGlkZSxcbiAgICAgb2JqZWN0OiB0aGlzLFxuICAgICByZWRvOiAgIGZpbHRlcixcbiAgICAgdW5kbzogICBfb2xkX2ZpbHRlciAsXG4gICAgIHR5cGU6ICAgXCJmaWx0ZXJcIixcbiAgICAgdW5kb0ZuOiBmdW5jdGlvbihhY3Rpb24pe1xuICAgICBhY3Rpb24ub2JqZWN0Ll9zZXRfZmlsdGVyKGFjdGlvbi51bmRvKTtcbiAgICAgfSxcbiAgICAgcmVkb0ZuOiAgZnVuY3Rpb24oYWN0aW9uKXtcbiAgICAgYWN0aW9uLm9iamVjdC5fc2V0X2ZpbHRlcihhY3Rpb24ucmVkbyk7XG4gICAgIH1cbiAgICAgfSk7XG4gICAgICovXG4gICAgdGhpcy5fc2V0X2ZpbHRlcihfdHlwZSwgX25ld19maWx0ZXIsIF9vbGRfZmlsdGVyKTtcblxuICB9LFxuXG4gIF9zZXRfZmlsdGVyOiBmdW5jdGlvbiAoX3R5cGUsIF9uZXdfZmlsdGVyKSB7XG5cbiAgICBpZihfdHlwZSl7XG4gICAgICB2YXIgX29sZF9maWx0ZXIgPSB0aGlzLmdldEZpbHRlcihfdHlwZSk7XG4gICAgfVxuXG4gICAgaWYgKF9vbGRfZmlsdGVyICYmIF9uZXdfZmlsdGVyKSB7XG4gICAgICBmb3IgKHZhciBpIGluIF9uZXdfZmlsdGVyKSB7XG4gICAgICAgIF9vbGRfZmlsdGVyW2ldID0gX25ld19maWx0ZXJbaV07XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChfb2xkX2ZpbHRlciAmJiAhX25ld19maWx0ZXIpIHtcbiAgICAgIHRoaXMuZmlsdGVycy5zcGxpY2UodGhpcy5maWx0ZXJzLmluZGV4T2YoX29sZF9maWx0ZXIpLCAxKTtcbiAgICB9XG4gICAgaWYgKCFfb2xkX2ZpbHRlciAmJiBfbmV3X2ZpbHRlcikge1xuICAgICAgdGhpcy5maWx0ZXJzLnB1c2gobmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzW190eXBlXShfbmV3X2ZpbHRlcikpO1xuICAgIH1cbiAgICB0aGlzLmFwcGx5RmlsdGVycyh0aGlzLmNhbnZhcy5yZW5kZXJBbGwuYmluZCh0aGlzLmNhbnZhcykpO1xuICB9LFxuXG5cblxuICAvKipcbiAgICogQG92ZXJyaWRlXG4gICAqIEFwcGxpZXMgZmlsdGVycyBhc3NpZ25lZCB0byB0aGlzIGltYWdlIChmcm9tIFwiZmlsdGVyc1wiIGFycmF5KVxuICAgKiBAbWV0aG9kIGFwcGx5RmlsdGVyc1xuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBpcyBpbnZva2VkIHdoZW4gYWxsIGZpbHRlcnMgaGF2ZSBiZWVuIGFwcGxpZWQgYW5kIG5ldyBpbWFnZSBpcyBnZW5lcmF0ZWRcbiAgICogQHBhcmFtIHtBcnJheX0gZmlsdGVycyB0byBiZSBhcHBsaWVkXG4gICAqIEBwYXJhbSB7ZmFicmljLkltYWdlfSBpbWdFbGVtZW50IGltYWdlIHRvIGZpbHRlciAoIGRlZmF1bHQgdG8gdGhpcy5fZWxlbWVudCApXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gZm9yUmVzaXppbmdcbiAgICogQHJldHVybiB7Q2FudmFzRWxlbWVudH0gY2FudmFzRWwgdG8gYmUgZHJhd24gaW1tZWRpYXRlbHlcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgYXBwbHlGaWx0ZXJzOiBmdW5jdGlvbihjYWxsYmFjaywgZmlsdGVycywgaW1nRWxlbWVudCwgZm9yUmVzaXppbmcpIHtcblxuICAgIGZpbHRlcnMgPSBmaWx0ZXJzIHx8IHRoaXMuZmlsdGVycztcbiAgICBpbWdFbGVtZW50ID0gaW1nRWxlbWVudCB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQ7XG5cbiAgICBpZiAoIWltZ0VsZW1lbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgcmVwbGFjZW1lbnQgPSBmYWJyaWMudXRpbC5jcmVhdGVJbWFnZSgpLFxuICAgICAgcmV0aW5hU2NhbGluZyA9IHRoaXMuY2FudmFzID8gdGhpcy5jYW52YXMuZ2V0UmV0aW5hU2NhbGluZygpIDogZmFicmljLmRldmljZVBpeGVsUmF0aW8sXG4gICAgICBtaW5pbXVtU2NhbGUgPSB0aGlzLm1pbmltdW1TY2FsZVRyaWdnZXIgLyByZXRpbmFTY2FsaW5nLFxuICAgICAgX3RoaXMgPSB0aGlzLCBzY2FsZVgsIHNjYWxlWTtcblxuICAgIGlmIChmaWx0ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5fZWxlbWVudCA9IGltZ0VsZW1lbnQ7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0aGlzKTtcbiAgICAgIHJldHVybiBpbWdFbGVtZW50O1xuICAgIH1cblxuICAgIHZhciBjYW52YXNFbCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICBjYW52YXNFbC53aWR0aCA9IGltZ0VsZW1lbnQubmF0dXJhbFdpZHRoOyAgLy9vdmVycmlkZGVuXG4gICAgY2FudmFzRWwuaGVpZ2h0ID0gaW1nRWxlbWVudC5uYXR1cmFsSGVpZ2h0OyAvL292ZXJyaWRkZW5cbiAgICBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShpbWdFbGVtZW50LCAwLCAwLCBpbWdFbGVtZW50Lm5hdHVyYWxXaWR0aCwgaW1nRWxlbWVudC5uYXR1cmFsSGVpZ2h0KTtcblxuICAgIGZpbHRlcnMuZm9yRWFjaChmdW5jdGlvbihmaWx0ZXIpIHtcbiAgICAgIGlmICghZmlsdGVyKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChmb3JSZXNpemluZykge1xuICAgICAgICBzY2FsZVggPSBfdGhpcy5zY2FsZVggPCBtaW5pbXVtU2NhbGUgPyBfdGhpcy5zY2FsZVggOiAxO1xuICAgICAgICBzY2FsZVkgPSBfdGhpcy5zY2FsZVkgPCBtaW5pbXVtU2NhbGUgPyBfdGhpcy5zY2FsZVkgOiAxO1xuICAgICAgICBpZiAoc2NhbGVYICogcmV0aW5hU2NhbGluZyA8IDEpIHtcbiAgICAgICAgICBzY2FsZVggKj0gcmV0aW5hU2NhbGluZztcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2NhbGVZICogcmV0aW5hU2NhbGluZyA8IDEpIHtcbiAgICAgICAgICBzY2FsZVkgKj0gcmV0aW5hU2NhbGluZztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHNjYWxlWCA9IGZpbHRlci5zY2FsZVg7XG4gICAgICAgIHNjYWxlWSA9IGZpbHRlci5zY2FsZVk7XG4gICAgICB9XG4gICAgICBmaWx0ZXIuYXBwbHlUbyhjYW52YXNFbCwgc2NhbGVYLCBzY2FsZVkpO1xuICAgICAgaWYgKCFmb3JSZXNpemluZyAmJiBmaWx0ZXIudHlwZSA9PT0gJ1Jlc2l6ZScpIHtcbiAgICAgICAgX3RoaXMud2lkdGggKj0gZmlsdGVyLnNjYWxlWDtcbiAgICAgICAgX3RoaXMuaGVpZ2h0ICo9IGZpbHRlci5zY2FsZVk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIHJlcGxhY2VtZW50LndpZHRoID0gY2FudmFzRWwud2lkdGg7XG4gICAgcmVwbGFjZW1lbnQuaGVpZ2h0ID0gY2FudmFzRWwuaGVpZ2h0O1xuICAgIGlmIChmYWJyaWMuaXNMaWtlbHlOb2RlKSB7XG4gICAgICByZXBsYWNlbWVudC5zcmMgPSBjYW52YXNFbC50b0J1ZmZlcih1bmRlZmluZWQsIGZhYnJpYy5JbWFnZS5wbmdDb21wcmVzc2lvbik7XG4gICAgICAvLyBvbmxvYWQgZG9lc24ndCBmaXJlIGluIHNvbWUgbm9kZSB2ZXJzaW9ucywgc28gd2UgaW52b2tlIGNhbGxiYWNrIG1hbnVhbGx5XG4gICAgICBfdGhpcy5fZWxlbWVudCA9IHJlcGxhY2VtZW50O1xuICAgICAgIWZvclJlc2l6aW5nICYmIChfdGhpcy5fZmlsdGVyZWRFbCA9IHJlcGxhY2VtZW50KTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKF90aGlzKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXBsYWNlbWVudC5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgX3RoaXMuX2VsZW1lbnQgPSByZXBsYWNlbWVudDtcbiAgICAgICAgIWZvclJlc2l6aW5nICYmIChfdGhpcy5fZmlsdGVyZWRFbCA9IHJlcGxhY2VtZW50KTtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soX3RoaXMpO1xuICAgICAgICByZXBsYWNlbWVudC5vbmxvYWQgPSBjYW52YXNFbCA9IG51bGw7XG4gICAgICB9O1xuICAgICAgcmVwbGFjZW1lbnQuc3JjID0gY2FudmFzRWwudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhbnZhc0VsO1xuICB9LFxuXG5cblxuICBhY3Rpb25zIDogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgICBmaWx0ZXJzOiB7XG4gICAgICB0aXRsZTogXCLRhNC40LvRjNGC0YBcIixcbiAgICAgIGl0ZW1DbGFzc05hbWU6IFwiZmlsdGVycy1zZWxlY3RvclwiLFxuICAgICAgY2xhc3NOYW1lOiBcImZhIGZhLWZpbHRlclwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGRyb3Bkb3duOiB7XG4gICAgICAgIHRoZW1lOiBcInRvb2xiYXItZmlsdGVycy1zZWxlY3RvclwiLFxuICAgICAgICBwcmV2aWV3V2lkdGg6IDAsXG4gICAgICAgIHByZXZpZXdIZWlnaHQ6IDIyLFxuICAgICAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24gKHN0YXRlLCBjb250YWluZXIpIHtcbiAgICAgICAgICBpZiAoc3RhdGUuYW55KSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGUudGV4dDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuICQoJzxzcGFuPjxzcGFuIGNsYXNzPVwiY29sb3Itc3BhblwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjonICsgc3RhdGUudGV4dCArICdcIj48L3NwYW4+JyArIHN0YXRlLnRleHQgKyAnPC9zcGFuPicpO1xuICAgICAgICB9LFxuICAgICAgICB0ZW1wbGF0ZVJlc3VsdDogZnVuY3Rpb24gKHN0YXRlLCBjb250YWluZXIsIGRhdGEpIHtcbiAgICAgICAgICBsZXQgJGVsID0gJCgnPHNwYW4+JyArIHN0YXRlLnRleHQgKyAnPC9zcGFuPicpO1xuICAgICAgICAgIGxldCAkY2FudmFzID0gJCgnPGNhbnZhcz4nKTtcbiAgICAgICAgICBmYWJyaWMudXRpbC5kcmF3RmlsdGVyKCRjYW52YXNbMF0sIGRhdGEudGFyZ2V0Ll9vcmlnaW5hbEVsZW1lbnQgfHwgZGF0YS50YXJnZXQuX2VsZW1lbnQsIHN0YXRlLmlkLCB7XG4gICAgICAgICAgICB3aWR0aDogZGF0YS5kcm9wZG93bi5wcmV2aWV3V2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IGRhdGEuZHJvcGRvd24ucHJldmlld0hlaWdodFxuICAgICAgICAgIH0pO1xuICAgICAgICAgICRlbC5wcmVwZW5kKCRjYW52YXMpO1xuICAgICAgICAgIHJldHVybiAkZWw7XG4gICAgICAgIH0sXG4gICAgICB9LFxuXG4gICAgICB2YWx1ZToge1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwsIGZpbHRlcnNEYXRhKSB7XG4gICAgICAgICAgdmFyIG9wdGlvbnMgPSBmYWxzZTtcbiAgICAgICAgICBpZiAodmFsID09PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBfZiA9IGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUoZmlsdGVyc0RhdGEsIHtpZDogdmFsfSk7XG4gICAgICAgICAgICBfZi5lbmFibGVkID0gIV9mLmVuYWJsZWQ7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIF9mLm9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgaWYgKCQuaXNOdW1lcmljKF9mLm9wdGlvbnNbaV0pKSB7XG4gICAgICAgICAgICAgICAgX2Yub3B0aW9uc1tpXSA9IHBhcnNlRmxvYXQoX2Yub3B0aW9uc1tpXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfZi5lbmFibGVkKSB7XG4gICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfZi5vcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1tpXSA9IF9mLm9wdGlvbnNbaV0udmFsdWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zZXRGaWx0ZXIoe1xuICAgICAgICAgICAgdHlwZTogdmFsLFxuICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVycy5sZW5ndGggPyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLmZpbHRlcnNbMF0udHlwZSwgdHJ1ZSkgOiBcIm5vbmVcIlxuICAgICAgICB9LFxuICAgICAgICBvcHRpb25zOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICB2YXIgX2ZpbHRlcnMgPSB0aGlzLmdldEZpbHRlcnNEYXRhKCk7XG4gICAgICAgICAgZm9yICh2YXIgaSBpbiBfZmlsdGVycykge1xuICAgICAgICAgICAgX2ZpbHRlcnNbaV0uaWQgPSBfZmlsdGVyc1tpXS50eXBlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICAgIGlkOiAnbm9uZScsXG4gICAgICAgICAgICB0ZXh0OiAnb3JpZ2luYWwnLFxuICAgICAgICAgICAgZW5hYmxlZDogIXRoaXMuZmlsdGVycyB8fCAhdGhpcy5maWx0ZXJzLmxlbmd0aFxuICAgICAgICAgIH1dLmNvbmNhdChfZmlsdGVycyk7XG5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSlcbn0pO1xuXG4vL1xuLy8gZmFicmljLkltYWdlLmZpbHRlck1hbmFnZXIgPSB7XG4vL1xuLy8gICAvL2hpZGU6IGZ1bmN0aW9uKG9iamVjdCl7XG4vLyAgIC8vXG4vLyAgIC8vfSxcbi8vICAgc2hvdzogZnVuY3Rpb24gKG9iamVjdCkge1xuLy8gICAgIHRoaXMuYWN0aXZlT2JqZWN0ID0gb2JqZWN0O1xuLy8gICAgIHRoaXMuZmlyZSgnc2hvdycsIG9iamVjdCk7XG4vLyAgICAgdGhpcy5vbigndGFyZ2V0OmNoYW5nZWQnLCBvYmplY3QpXG4vLyAgIH1cbi8vIC8vIH07XG5cblxuXG4vLyBmYWJyaWMudXRpbC5vYnNlcnZhYmxlKGZhYnJpYy5JbWFnZS5maWx0ZXJNYW5hZ2VyKTtcblxuZmFicmljLnV0aWwuZHJhd0ZpbHRlciA9IGZ1bmN0aW9uKGVsZW1lbnQsc3JjLCBmaWx0ZXJOYW1lICxvcHRpb25zKXtcbiAgaWYoc3JjLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShzcmMsZnVuY3Rpb24oZWwpe1xuICAgICAgZmFicmljLnV0aWwuX2RyYXdGaWx0ZXIoZWxlbWVudCwgZWwsIGZpbHRlck5hbWUgLG9wdGlvbnMpO1xuICAgIH0pXG4gIH1lbHNle1xuICAgIGZhYnJpYy51dGlsLl9kcmF3RmlsdGVyKGVsZW1lbnQsc3JjLCBmaWx0ZXJOYW1lICxvcHRpb25zKTtcbiAgfVxufTtcblxuZmFicmljLnV0aWwuX2RyYXdGaWx0ZXIgPSBmdW5jdGlvbihlbGVtZW50LCBlbCwgZmlsdGVyTmFtZSAsb3B0aW9ucyl7XG5cbiAgdmFyIGN0eCA9ZWxlbWVudC5nZXRDb250ZXh0KFwiMmRcIik7XG4gIGlmKG9wdGlvbnMpe1xuICAgIGlmKG9wdGlvbnMud2lkdGggJiYgb3B0aW9ucy5oZWlnaHQpe1xuICAgICAgZWxlbWVudC53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICBlbGVtZW50LmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuICAgIH1lbHNlIGlmKG9wdGlvbnMud2lkdGgpe1xuICAgICAgZWxlbWVudC53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICBlbGVtZW50LmhlaWdodCA9IG9wdGlvbnMud2lkdGggKiAoZWwuaGVpZ2h0IC8gZWwud2lkdGgpO1xuICAgIH1lbHNlIGlmKG9wdGlvbnMuaGVpZ2h0KXtcbiAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgICBlbGVtZW50LndpZHRoID0gb3B0aW9ucy5oZWlnaHQgKiAoZWwud2lkdGggLyBlbC5oZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIGN0eC5kcmF3SW1hZ2UoZWwsMCwwLGVsZW1lbnQud2lkdGgsZWxlbWVudC5oZWlnaHQpO1xuXG4gIGlmKCFmaWx0ZXJOYW1lIHx8IGZpbHRlck5hbWUgPT0gXCJub25lXCIpcmV0dXJuO1xuICBmaWx0ZXJOYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmlsdGVyTmFtZSx0cnVlKTtcblxuICBpZihmYWJyaWMuSW1hZ2UuZmlsdGVyc1tmaWx0ZXJOYW1lXSl7XG4gICAgdmFyIF9maWx0ZXIgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0oKVxuICB9ZWxzZXtcbiAgICB2YXIgX2ZpbHRlciA9ZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0uY3JlYXRlKHt9KTtcbiAgfVxuXG4gIC8vdmFyIF9maWx0ZXIgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV07XG4gIGlmKF9maWx0ZXIpe1xuICAgIHZhciBfZm8gPSBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tmaWx0ZXJOYW1lXS5wcm90b3R5cGUub3B0aW9ucztcbiAgICB2YXIgZmlsdGVyT3B0aW9ucyA9IHt9O1xuICAgIGZvcih2YXIgaSBpbiBfZm8pe1xuICAgICAgZmlsdGVyT3B0aW9uc1tpXSA9IF9mb1tpXS52YWx1ZTtcblxuICAgIH1cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKF9maWx0ZXIsZmlsdGVyT3B0aW9ucyk7XG4gICAgX2ZpbHRlci5pbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsMCxlbGVtZW50LndpZHRoLGVsZW1lbnQuaGVpZ2h0KTtcbiAgICBfZmlsdGVyLmFwcGx5VG8oZWxlbWVudCk7XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvaW1hZ2UuZmlsdGVycy5qcyIsIlxuLypcbmV4cG9ydCBpbnRlcmZhY2UgR2FsbGVyeURhdGEgOiB7XG4gdGFyZ2V0OiBmYWJyaWNqcyBvYmplY3Rcbn1cbiovXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuRWRpdG9yLnByb3RvdHlwZSwge1xuICBnYWxsZXJpZXM6IG51bGwsXG4gIC8qKlxuICAgKlxuICAgKlxuXG4gICBkcmFnZ2FibGVBcmVhOiBcIi5tYWluX2NvbnRhaW5lclwiLFxuICAgcGhvdG86IGNvbmZpZy5jYXJkVHlwZSA9PT0gQ0FSRF9UWVBFUy5QSE9UTyB8fCBjb25maWcuY2FyZFR5cGUgPT09IENBUkRfVFlQRVMuQkxBTksgJiYge1xuICAgICAgICBjb250YWluZXI6IFwicGhvdG9zLWdhbGxlcnlcIixcbiAgICAgICAgZWxlbWVudHM6IGNvbmZpZy5waG90b3NHYWxsZXJ5LFxuICAgICAgICBtYXBwZXI6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcHJldmlldzogXCJpbWFnZVwiLFxuICAgICAgICAgICAgdHlwZTogXCJwaG90b1wiLFxuICAgICAgICAgICAgc3JjOiBjb25maWcucGhvdG9zUGF0aCArIHZhbFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGl0ZW1DbGFzczogXCJwcmV2Q2xvc2VcIixcbiAgICAgICAgICByZW1vdmVCdXR0b25UZW1wbGF0ZTogJzxzcGFuIGNsYXNzPVwiZmEgZmEtY2xvc2UgY2xvc2VJTUdcIj4nLFxuICAgICAgICAgIHJlbW92YWJsZTogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAqIEBwYXJhbSBzZWxlY3RlZERhdGFcbiAgICovXG4gIHNldEdhbGxlcmllczogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZihvcHRpb25zLmRyYWdnYWJsZUFyZWEpe1xuICAgICAgdGhpcy5kcmFnZ2FibGVBcmVhID0gb3B0aW9ucy5kcmFnZ2FibGVBcmVhO1xuICAgICAgZGVsZXRlIG9wdGlvbnMuZHJhZ2dhYmxlQXJlYTtcbiAgICB9XG4gICAgdGhpcy5nYWxsZXJpZXMgPSBbXTtcbiAgICBmb3IobGV0IGkgaW4gb3B0aW9ucyl7XG4gICAgICBsZXQgZ28gPSBvcHRpb25zW2ldO1xuICAgICAgaWYoIWdvKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0aGlzLmdhbGxlcmllc1tpXSA9IHRoaXMuY3JlYXRlR2FsbGVyeShcbiAgICAgICAgZ28uY29udGFpbmVyLFxuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QubWFwKGdvLmVsZW1lbnRzLCBnby5tYXBwZXIpLFxuICAgICAgICBnby5vcHRpb25zKVxuICAgIH1cblxuICB9LFxuXG4vLyBzZXRFbGVtZW50RnJvbU1lbnU6IGZ1bmN0aW9uIChzZWxlY3RlZERhdGEpIHtcbi8vICAgdGhpcy5jYW52YXMuY3JlYXRlSW1hZ2VPYmplY3Qoc2VsZWN0ZWREYXRhLmltYWdlLCB0aGlzLnVwbG9hZENsYXNzKTtcbi8vIH07XG4gIC8qY3JlYXRlR2FsbGVyeTogZnVuY3Rpb24gKHRhcmdldCwgJGVsLCBvcHRpb25zKSB7XG4gICAgaWYgKCRlbC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgICAkZWwgPSAkKFwiI1wiICsgJGVsKTtcbiAgICB9XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICBpZiAodGFyZ2V0LmdhbGxlcnlDYXRlZ29yeSkge1xuICAgICAgb3B0aW9ucy5jYXRlZ29yeSA9IHRhcmdldC5nYWxsZXJ5Q2F0ZWdvcnk7XG4gICAgfVxuXG4gICAgJGVsLmVtcHR5KCk7XG4gICAgdmFyIGxpYnJhcnkgPSB0aGlzLmdldExpYnJhcnlFbGVtZW50cyhvcHRpb25zKTtcblxuXG4gICAgdGhpcy5jcmVhdGVFbGVtZW50c0xpc3QoJGVsLCBsaWJyYXJ5KTtcblxuICAgIF8uZWFjaChsaWJyYXJ5LCBmdW5jdGlvbiAobGlicmFyeUl0ZW0pIHtcbiAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGltZy5zcmMgPSBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyBsaWJyYXJ5SXRlbS5zcmM7XG5cbiAgICAgIHZhciAkaW1nID0gJChpbWcpLndpZHRoKDEwMCkuaGVpZ2h0KDEwMClcbiAgICAgICAgLmNsaWNrKGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgIHZhciBzZWxlY3RlZERhdGEgPSB7XG4gICAgICAgICAgICBpbWFnZTogaW1nLFxuICAgICAgICAgICAgZGF0YTogbGlicmFyeUl0ZW0sXG4gICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zXG4gICAgICAgICAgfTtcbiAgICAgICAgICB0YXJnZXQuc2V0RWxlbWVudEZyb21NZW51KHNlbGVjdGVkRGF0YSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAkZWwuYXBwZW5kKCRpbWcpO1xuICAgIH0pO1xuICB9LCovXG4gIGdldEZvbnRzTGlicmFyeTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBfLm1hcCh0aGlzLmZvbnRzLGZ1bmN0aW9uKGZvbnROYW1lKXtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZvbnRGYW1pbHk6IGZvbnROYW1lLFxuICAgICAgICBmb250U2l6ZTogMjUsXG4gICAgICAgIGNhdGVnb3J5OiBcImZvbnRGYW1pbHlcIixcbiAgICAgICAgcm9sZTogXCJmb250RmFtaWx5XCIsXG4gICAgICAgIHRleHQ6IGZvbnROYW1lLFxuICAgICAgICB0eXBlOiBcInRleHRcIlxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIGNyZWF0ZUdhbGxlcnk6ZnVuY3Rpb24oJGVsLGxpYnJhcnksb3B0aW9ucyl7XG4gICAgaWYoIW9wdGlvbnMpe1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICBvcHRpb25zLmFwcGxpY2F0aW9uID0gdGhpcztcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5HYWxsZXJ5KCRlbCxvcHRpb25zLGxpYnJhcnkpO1xuICB9XG59KTtcblxuXG5mYWJyaWMuR2FsbGVyeSA9IGZ1bmN0aW9uKCRlbCxvcHRpb25zLGxpYnJhcnkpe1xuICBpZihvcHRpb25zLmFwcGxpY2F0aW9uKXtcbiAgICB0aGlzLmFwcGxpY2F0aW9uID0gb3B0aW9ucy5hcHBsaWNhdGlvbjtcbiAgfVxuICBpZigkZWwuY29uc3RydWN0b3IgPT09IFN0cmluZyApe1xuICAgICRlbCA9ICQoXCIjXCIgKyAkZWwpO1xuICB9XG4gIHRoaXMuZWxlbWVudCA9ICRlbDtcbiAgdGhpcy5lbGVtZW50cyA9IFtdO1xuICB0aGlzLm9wdGlvbnMgPSAgdGhpcy5fZ2V0RWxlbWVudHNMaXN0T3B0aW9ucyhvcHRpb25zKTtcbiAgdGhpcy5hZGRFbGVtZW50cyhsaWJyYXJ5KTtcbn07XG5cbmZhYnJpYy5HYWxsZXJ5LnByb3RvdHlwZSA9IHtcbiAgLy8gZHJhZ2dhYmxlQXJlYTogXCIuZmYtY29udGFpbmVyXCIsXG4gIGRyYWdnYWJsZUFyZWE6IFwiYm9keVwiLFxuICBpbWFnZVdpZHRoOiAzMDAsXG4gIGltYWdlSGVpZ2h0OiAxNTAsXG4gIF9hZGRDYW52YXNFbDogZnVuY3Rpb24gKGVsLCBlbGVtZW50LCBpbm5lckVsKXtcbiAgICAvLyBlbGVtZW50ID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChlbGVtZW50KTtcblxuICAgIHZhciBjYW52YXNFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgaW5uZXJFbC53aWR0aCA9IGNhbnZhc0VsLndpZHRoID0gdGhpcy5pbWFnZVdpZHRoO1xuICAgIGlubmVyRWwuaGVpZ2h0ID0gY2FudmFzRWwuaGVpZ2h0ID0gdGhpcy5pbWFnZUhlaWdodDtcblxuXG5cbiAgICB2YXIgX2Zha2VfY2FudmFzID0gbmV3IGZhYnJpYy5TdGF0aWNDYW52YXMoY2FudmFzRWwse2FwcGxpY2F0aW9uOiB0aGlzLmFwcGxpY2F0aW9ufSk7XG4gICAgX2Zha2VfY2FudmFzLmNsZWFyKCk7XG5cbiAgICBlbGVtZW50LnBvc2l0aW9uID0gXCJjZW50ZXJcIjtcblxuICAgIF9mYWtlX2NhbnZhcy5jcmVhdGVPYmplY3QoZWxlbWVudCxmdW5jdGlvbihfb2JqZWN0KXtcbiAgICAgIHZhciBiID0gX29iamVjdC5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICAgIC8qIF9vYmplY3Quc2V0KHtcbiAgICAgICAgIGxlZnQgOiA4MCAtIGIud2lkdGgvMiAtIF9vYmplY3Quc3Ryb2tlV2lkdGggKiAyLFxuICAgICAgICAgdG9wIDogNDUgLSBiLmhlaWdodC8yIC0gX29iamVjdC5zdHJva2VXaWR0aCAqIDJcbiAgICAgICB9KTsqL1xuXG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsZW1lbnQse1xuICAgICAgICBzY2FsZVg6IF9vYmplY3Quc2NhbGVYLFxuICAgICAgICBzY2FsZVk6IF9vYmplY3Quc2NhbGVZLFxuICAgICAgICB3aWR0aDogX29iamVjdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBfb2JqZWN0LmZoZWlnaHQsXG4gICAgICAgIGxlZnQ6IF9vYmplY3QubGVmdCxcbiAgICAgICAgdG9wOiBfb2JqZWN0LnRvcCxcbiAgICAgICAgc3Ryb2tlV2lkdGg6IF9vYmplY3Quc3Ryb2tlV2lkdGhcbiAgICAgIH0pO1xuXG4gICAgICBkZWxldGUgZWxlbWVudC5wb3NpdGlvbjtcblxuICAgICAgX2Zha2VfY2FudmFzLmFkZChfb2JqZWN0KTtcbiAgICAgIF9mYWtlX2NhbnZhcy5yZW5kZXJBbGwoKTtcblxuICAgICAgaW5uZXJFbC5zcmMgPSBjYW52YXNFbC50b0RhdGFVUkwoKTtcblxuICAgICAgZGVsZXRlIF9vYmplY3QuY2FudmFzO1xuICAgICAgZWxbMF0uZGF0YSA9IGVsZW1lbnQ7XG4gICAgICBlbFswXS5lbGVtZW50ID0gX29iamVjdDtcbiAgICB9KTtcbiAgfSxcbiAgcmVtb3ZlRWxlbWVudCA6IGZ1bmN0aW9uKGVsZW1lbnQpe1xuICAgIGVsZW1lbnQuZWxlbWVudC5yZW1vdmUoKTtcbiAgICB2YXIgaW5kZXggPSB0aGlzLmVsZW1lbnRzLmluZGV4T2YoZWxlbWVudCk7XG4gICAgdGhpcy5lbGVtZW50cy5zcGxpY2UoaW5kZXgsMSk7XG4gICAgdGhpcy5maXJlKFwicmVtb3ZlZFwiLHtpdGVtOiBlbGVtZW50LCB0YXJnZXQ6IHRoaXMsaW5kZXg6IGluZGV4fSk7XG4gICAgdGhpcy5hcHBsaWNhdGlvbiAmJiB0aGlzLmFwcGxpY2F0aW9uLmZpcmUoXCJnYWxsZXJ5OnJlbW92ZWRcIix7aXRlbTogZWxlbWVudCwgdGFyZ2V0OiB0aGlzLGluZGV4OiBpbmRleH0pXG4gIH0sXG4gIGFkZEVsZW1lbnRzIDogZnVuY3Rpb24oZWxlbWVudHMpe1xuICAgIGVsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB0aGlzLmFkZChlbGVtZW50KSlcbiAgfSxcbiAgX2dldEVsZW1lbnRzTGlzdE9wdGlvbnM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuXG5cbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMgfHwge30sIHtcbiAgICAgIHJlbW92YWJsZTogZmFsc2UsXG4gICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICBpdGVtQ2xhc3M6IFwibGlzdC1pdGVtXCIsXG4gICAgICByZW1vdmVCdXR0b25UZW1wbGF0ZTogJzxzcGFuIGNsYXNzPVwiZmEgZmEtY2xvc2VcIj4nLFxuICAgICAgYWN0aXZhdGU6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBkYXRhID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKGRhdGEpO1xuICAgICAgICBpZihvcHRpb25zLmFjdGl2YXRlT3B0aW9ucyAmJiAob3B0aW9ucy5hY3RpdmF0ZU9wdGlvbnMud2lkdGggfHwgb3B0aW9ucy5hY3RpdmF0ZU9wdGlvbnMuaGVpZ2h0KSl7XG4gICAgICAgICAgZGVsZXRlIGRhdGEud2lkdGg7XG4gICAgICAgICAgZGVsZXRlIGRhdGEuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgZGF0YS53aWR0aCA9ICQoZGF0YS5hY3RpdmVFbGVtZW50KS53aWR0aCgpO1xuICAgICAgICAgIGRhdGEuaGVpZ2h0ID0gJChkYXRhLmFjdGl2ZUVsZW1lbnQpLmhlaWdodCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChkYXRhLG9wdGlvbnMuYWN0aXZhdGVPcHRpb25zKTtcbiAgICAgICAgZGVsZXRlIGRhdGEubGVmdDtcbiAgICAgICAgZGVsZXRlIGRhdGEudG9wO1xuICAgICAgICB2YXIgX2NhbnZhcyA9IHRoaXMuY2FudmFzO1xuXG4gICAgICAgIGlmIChfY2FudmFzLnRhcmdldCAmJiAgX2NhbnZhcy5pc0FjY2VwdHMoX2NhbnZhcy50YXJnZXQuYWNjZXB0cywgZGF0YSkgKSB7XG4gICAgICAgICAgX2NhbnZhcy50YXJnZXQuc2V0RGF0YShkYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfY2FudmFzLnNldERhdGEoZGF0YSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgYWRkOiBmdW5jdGlvbihlbGVtZW50KXtcblxuXG4gICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cbiAgICB2YXIgZWwgPSAkKFwiPGxpPlwiKVxuICAgICAgLmFkZENsYXNzKG9wdGlvbnMuaXRlbUNsYXNzKTtcblxuXG5cbiAgICB2YXIgaW5zZXJ0ZWRFbGVtZW50ID0ge1xuICAgICAgZGF0YTogZWxlbWVudCxcbiAgICAgIGVsZW1lbnQ6IGVsXG4gICAgfTtcblxuXG5cbiAgICBlbFswXS5kYXRhID0gZWxlbWVudDtcblxuICAgIGlmIChvcHRpb25zLmVsZW1lbnQpIHtcbiAgICAgIGVsZW1lbnQgPSBvcHRpb25zLmVsZW1lbnQoZWxlbWVudCk7XG4gICAgfVxuXG4gICAgaWYgKGVsZW1lbnQudGl0bGUpIHtcbiAgICAgIHZhciAkc3BhbiA9ICQoXCI8c3Bhbj5cIikudGV4dChlbGVtZW50LnRpdGxlKS5hZGRDbGFzcyhcImVsZW1lbnQtdGl0bGVcIik7XG4gICAgICBlbC5hcHBlbmQoJHNwYW4pO1xuICAgIH1cbiAgICB2YXIgJGlubmVyRWwgPSBudWxsO1xuXG4gICAgaWYgKG9wdGlvbnMucmVuZGVyKSB7XG4gICAgICAkaW5uZXJFbCA9IG9wdGlvbnMucmVuZGVyKGVsZW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZihlbGVtZW50LnJvbGUgPT09IFwiZm9udEZhbWlseVwiKXtcbiAgICAgICAgZWxlbWVudC5wcmV2aWV3ID0gXCJmb250RmFtaWx5XCI7XG4gICAgICB9XG4gICAgICBpZihlbGVtZW50LnR5cGUgPT09IFwiaW1hZ2VcIiB8fCBlbGVtZW50LnR5cGUgPT09IFwidmlkZW9cIil7XG4gICAgICAgIGlmKCFlbGVtZW50LnByZXZpZXcpe1xuICAgICAgICAgIGVsZW1lbnQucHJldmlldyA9IGVsZW1lbnQudHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZighZWxlbWVudC5yb2xlKXtcbiAgICAgICAgICBlbGVtZW50LnJvbGUgPSBlbGVtZW50LnR5cGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICBzd2l0Y2ggKGVsZW1lbnQucHJldmlldykge1xuICAgICAgICBjYXNlIFwiZm9udEZhbWlseVwiOlxuICAgICAgICAgICRpbm5lckVsID0gJChcIjxzcGFuPlwiKS5jc3Moe1xuICAgICAgICAgICAgXCJjb2xvclwiOiBlbGVtZW50LmZpbGwgfHwgZmFicmljLlRleHQucHJvdG90eXBlLmZpbGwsXG4gICAgICAgICAgICBcImZvbnQtZmFtaWx5XCI6IGVsZW1lbnQuZm9udEZhbWlseSxcbiAgICAgICAgICAgIFwiZm9udC1zaXplXCI6IGVsZW1lbnQuZm9udFNpemVcbiAgICAgICAgICB9KS50ZXh0KGVsZW1lbnQudGV4dCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJpbWFnZVwiOlxuICAgICAgICAgIHZhciBpbWcgPSBlbGVtZW50LmltYWdlO1xuXG4gICAgICAgICAgaWYoIWltZyl7XG4gICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgZWxlbWVudC53aWR0aCA9IGltZy53aWR0aDtcbiAgICAgICAgICAgICAgZWxlbWVudC5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgICAgICAgICBlbGVtZW50LmltYWdlID0gaW1nO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnO1xuICAgICAgICAgICAgaW1nLnNyYyA9IGZhYnJpYy51dGlsLmdldFVSTChlbGVtZW50LnNyYyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGVsWzBdLmVsZW1lbnQgPSBpbWc7XG4gICAgICAgICAgZWxbMF0uZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICAgICAgJGlubmVyRWwgPSAkKGltZyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ2aWRlb1wiOlxuICAgICAgICAgICRpbm5lckVsID0gJChcIjx2aWRlbz5cIik7XG4gICAgICAgICAgJGlubmVyRWxbMF0uY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJztcbiAgICAgICAgICBmb3IgKHZhciB0eXBlIGluIGVsZW1lbnQuc3JjKSB7XG4gICAgICAgICAgICAkaW5uZXJFbC5hcHBlbmQoJChcIjxzb3VyY2U+XCIpLmF0dHIoe1xuICAgICAgICAgICAgICBzcmM6IGZhYnJpYy51dGlsLm1lZGlhUm9vdCArIGVsZW1lbnQuc3JjW3R5cGVdLFxuICAgICAgICAgICAgICB0eXBlOiB0eXBlXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsWzBdLmVsZW1lbnQgPSAkaW5uZXJFbFswXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8aW1nPlwiKTtcbiAgICAgICAgICB0aGlzLl9hZGRDYW52YXNFbChlbCwgZWxlbWVudCwgJGlubmVyRWxbMF0pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoJGlubmVyRWwuY29uc3RydWN0b3IgPT0gQXJyYXkpIHtcbiAgICAgIHZhciBfc3BhbiA9ICQoXCI8c3Bhbj5cIik7XG4gICAgICBfc3Bhbi5hcHBlbmQoJGlubmVyRWwpO1xuICAgICAgJGlubmVyRWwgPSBfc3BhbjtcbiAgICB9XG4gICAgZWwuYXBwZW5kKCRpbm5lckVsKTtcblxuICAgIGlmIChvcHRpb25zLnJlbW92YWJsZSkge1xuICAgICAgdmFyIF9zcGFuID0gJCh0aGlzLm9wdGlvbnMucmVtb3ZlQnV0dG9uVGVtcGxhdGUpO1xuICAgICAgX3NwYW4uY2xpY2sodGhpcy5yZW1vdmVFbGVtZW50LmJpbmQodGhpcyxpbnNlcnRlZEVsZW1lbnQpKVxuICAgICAgZWwuYXBwZW5kKF9zcGFuKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5kcmFnZ2FibGUpIHtcbiAgICAgICRpbm5lckVsLmRyYWdnYWJsZSh7XG4gICAgICAgIGRyYWdnYWJsZTogXCJoZWxwZXJcIixcbiAgICAgICAgZHJvcHBhYmxlOiBcIi5jYW52YXMtY29udGFpbmVyXCIsXG4gICAgICAgIG5nTW9kZWw6IGVsZW1lbnQsXG4gICAgICAgIG9uTW92ZTogZGF0YSA9PiB7XG4gICAgICAgICAgLy90b2RvINC80L7QttC10YIg0LHRi9GC0Ywg0L3QtdGB0LrQvtC70YzQutC+INC60LDQvdCy0LDRgdC+0LJcbiAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLmNhbnZhcy5fb25EcmFnTW92ZSAmJiB0aGlzLmFwcGxpY2F0aW9uLmNhbnZhcy5fb25EcmFnTW92ZShkYXRhLiRldmVudClcbiAgICAgICAgfSxcbiAgICAgICAgb25Ecm9wOiBkYXRhID0+IHtcbiAgICAgICAgICAvL3RvZG8g0LzQvtC20LXRgiDQsdGL0YLRjCDQvdC10YHQutC+0LvRjNC60L4g0LrQsNC90LLQsNGB0L7QslxuICAgICAgICAgIHRoaXMuYXBwbGljYXRpb24uY2FudmFzLl9vbkRyb3AoZGF0YS4kZXZlbnQpXG4gICAgICAgIH0sXG4gICAgICAgIGRyYWdnYWJsZUFyZWE6IHRoaXMuZHJhZ2dhYmxlQXJlYVxuICAgICAgfSlcbiAgICB9XG4gICAgZWxlbWVudC5hY3RpdmVFbGVtZW50ID0gJGlubmVyRWw7XG4gICAgJGlubmVyRWwuY2xpY2sob3B0aW9ucy5hY3RpdmF0ZS5iaW5kKHRoaXMuYXBwbGljYXRpb24sIGVsZW1lbnQpKTtcbiAgICB0aGlzLmVsZW1lbnQuYXBwZW5kKGVsKTtcblxuICAgIHRoaXMuZWxlbWVudHMucHVzaChpbnNlcnRlZEVsZW1lbnQpXG4gIH1cbn07XG5mYWJyaWMudXRpbC5vYnNlcnZhYmxlKGZhYnJpYy5HYWxsZXJ5LnByb3RvdHlwZSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZ2FsbGVyeS5qcyIsIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiBBbGlnbWVudCBsaWJyYXJ5IGZvciBGYWJyaWNKU1xuICpcbiAqXG4gKlxuICogQGF1dGhvciBEZW5pcyBQb25vbWFyZXZcbiAqIEBlbWFpbCBkZW4ucG9ub21hcmV2QGdtYWlsLmNvbVxuICovXG5mYWJyaWMuR3JpZFNuYXBwZXIgPSBmdW5jdGlvbiAoY2FudmFzLG9wdGlvbnMpe1xuICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcblxuICB0aGlzLnJlY3QgPSBmYWJyaWMudXRpbC5nZXRSZWN0KGNhbnZhcy53aWR0aCxjYW52YXMuaGVpZ2h0LGNhbnZhcy5vZmZzZXRzKTtcblxuICBmb3IobGV0IHByb3AgaW4gb3B0aW9ucyl7XG4gICAgdGhpc1twcm9wXSA9IG9wdGlvbnNbcHJvcF07XG4gIH1cblxuICB0aGlzLmNyZWF0ZUFsaWdtZW50TGluZXMoY2FudmFzKTtcblxuICAvLyBmb3IobGV0IGkgaW4gdGhpcy5jYW52YXMuX29iamVjdHMpe1xuICAvLyAgIHRoaXMuYXBwbHlTbmFwKHRoaXMuY2FudmFzLl9vYmplY3RzW2ldKTtcbiAgLy8gfVxuXG4gIGxldCBfZ3MgPSB0aGlzO1xuXG4gICh0aGlzLmNhbnZhcy53cmFwcGVyRWwgfHwgdGhpcy5jYW52YXMubG93ZXJDYW52YXNFbCkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLGZ1bmN0aW9uKCl7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsX2dzLl93aW5kb3dfbW91c2VfdXAuYmluZChfZ3MpKTtcbiAgfSk7XG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIGdyaWRkYWJsZTogdHJ1ZSxcbiAgc25hcENvcm5lcnM6IHtcbiAgICB0bDogW1widGxcIixcImJsXCIsXCJiclwiLFwidHJcIl0sXG4gICAgYmw6IFtcInRsXCIsXCJibFwiLFwiYnJcIixcInRyXCJdLFxuICAgIHRyOiBbXCJ0bFwiLFwiYmxcIixcImJyXCIsXCJ0clwiXSxcbiAgICBicjogW1widGxcIixcImJsXCIsXCJiclwiLFwidHJcIl0sXG4gICAgYyA6IFtcImNcIl1cbiAgfSxcbn0pO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICBncmlkU2l6ZTogMjUsXG4gIGdyaWRDb2xvcjogMjUsXG4gIGdyaWQ6IGZhbHNlLFxuICBzbmFwQXJlYTogMyxcbiAgc25hcHBpbmc6IGZhbHNlLFxuICBzZXRTbmFwcGluZyh2YWwpe1xuICAgIGlmKHZhbCl7XG4gICAgICB0aGlzLm9uKFwib2JqZWN0Om1vdmluZ1wiLHRoaXMuZ3JpZFNuYXBNb3ZlICk7XG4gICAgICB0aGlzLm9uKCdtb3VzZTp1cCcsdGhpcy5jbGVhclNuYXBwaW5nKTtcbiAgICAgIGlmKHRoaXMuZHJhd1NuYXBwaW5nKXtcbiAgICAgICAgdGhpcy5vbignYWZ0ZXI6cmVuZGVyJywgdGhpcy5fZHJhd1NuYXBwaW5nICk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLm9mZihcIm9iamVjdDptb3ZpbmdcIix0aGlzLmdyaWRTbmFwTW92ZSApO1xuICAgICAgdGhpcy5vZmYoJ21vdXNlOnVwJyx0aGlzLmNsZWFyU25hcHBpbmcpO1xuICAgICAgaWYodGhpcy5kcmF3U25hcHBpbmcpIHtcbiAgICAgICAgdGhpcy5vZmYoJ2FmdGVyOnJlbmRlcicsIHRoaXMuX2RyYXdTbmFwcGluZyk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc25hcHBpbmcgPSB2YWw7XG4gIH0sXG4gIHNldEdyaWQodmFsKXtcbiAgICBpZih2YWwpe1xuICAgICAgdGhpcy5ncmlkID0gbmV3IGZhYnJpYy5HcmlkU25hcHBlcih0aGlzKTtcbiAgICAgIHRoaXMuZ3JpZC5jcmVhdGVHcmlkKCk7XG4gICAgICB0aGlzLmdyaWQuY3JlYXRlR3JpZEZyYW1lKCk7XG4gICAgfVxuICAgIGVsc2UgaWYodGhpcy5ncmlkKXtcbiAgICAgIHRoaXMuZ3JpZC5yZW1vdmVHcmlkKCk7XG4gICAgICB0aGlzLmdyaWQucmVtb3ZlR3JpZEZyYW1lKCk7XG4gICAgICB0aGlzLmdyaWQgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBjbGVhclNuYXBwaW5nICgpIHtcbiAgICB0aGlzLmNsZWFyQ29udGV4dCh0aGlzLmNvbnRleHRUb3ApO1xuICAgIHRoaXMuc25hcFRvID0gbnVsbDtcbiAgfSxcblxuICAvKipcbiAgICogQHBhcmFtIG9iamVjdFxuICAgKiBAcmV0dXJucyB7e3g6IChmYWxzZXx7dmFsdWUsIGNvcm5lcn18e3ZhbHVlLCBjb3JuZXIsIG9iamVjdDIsIGNvcm5lcjJ9KSwgeTogKGZhbHNlfHt2YWx1ZSwgY29ybmVyfXx7dmFsdWUsIGNvcm5lciwgb2JqZWN0MiwgY29ybmVyMn0pfX1cbiAgICovXG4gIGdyaWRTbmFwTW92ZShvcHRpb25zKSB7XG5cbiAgICBpZihvcHRpb25zLmUuc2hpZnRLZXkgfHwgIW9wdGlvbnMudGFyZ2V0LmdyaWRkYWJsZSl7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG5cbiAgICBvcHRpb25zLnRhcmdldC5zZXRDb29yZHMoKTtcblxuICAgIGxldCB4ID0gdGhpcy5ncmlkU25hcE1vdmVCeUF4ZShvcHRpb25zLnRhcmdldCxcInhcIiksXG4gICAgICB5ID0gdGhpcy5ncmlkU25hcE1vdmVCeUF4ZShvcHRpb25zLnRhcmdldCxcInlcIik7XG5cbiAgICB0aGlzLnNuYXBUbyA9IHt4OiB4LCB5IDogeX07XG4gICAgdGhpcy5zbmFwQ2FsbGJhY2sgJiYgdGhpcy5zbmFwQ2FsbGJhY2sodGhpcy5zbmFwVG8pO1xuXG4gICAgcmV0dXJuIHRoaXMuc25hcFRvO1xuICB9LFxuICBfZ2V0X2Nvcm5lciAob2JqZWN0LGNvcm5lcl9uYW1lKSB7XG5cbiAgICBpZihjb3JuZXJfbmFtZSA9PSBcImNcIil7XG4gICAgICBsZXQgcCA9IG9iamVjdC5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgbGV0IF9zY2FsZSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgICAgcC54ICo9IF9zY2FsZTtcbiAgICAgIHAueSAqPSBfc2NhbGU7XG4gICAgICByZXR1cm4gcDtcbiAgICB9XG4gICAgcmV0dXJuIG9iamVjdC5vQ29vcmRzW2Nvcm5lcl9uYW1lXTtcbiAgfSxcbiAgZ3JpZFNuYXBNb3ZlQnlBeGUgKG9iamVjdCxheGUpIHtcblxuICAgIGxldCBfc2NhbGUgPSB0aGlzLmdldFpvb20oKTtcbiAgICBsZXQgX2wsIF93LCBfYywgX3A7XG5cbiAgICBpZiggYXhlID09IFwieFwiICl7XG4gICAgICBfbCA9IHRoaXMub2Zmc2V0cy5sZWZ0O1xuICAgICAgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggLSB0aGlzLm9mZnNldHMucmlnaHQgIC0gX2w7XG4gICAgICBfYyA9IG9iamVjdC5sZWZ0O1xuICAgICAgX3AgPSBcImxlZnRcIjtcbiAgICB9ZWxzZXtcbiAgICAgIF9sID0gdGhpcy5vZmZzZXRzLnRvcDtcbiAgICAgIF93ID0gdGhpcy5vcmlnaW5hbEhlaWdodCAtIHRoaXMub2Zmc2V0cy5ib3R0b20gIC0gX2w7XG4gICAgICBfYyA9IG9iamVjdC50b3A7XG4gICAgICBfcCA9IFwidG9wXCI7XG4gICAgfVxuICAgIGxldCBzYyA9IG9iamVjdC5zbmFwQ29ybmVycztcblxuICAgIC8vc3VwcG9ydGxpbmVzXG4gICAgZm9yKGxldCBjb3JuZXJfbmFtZSBpbiBzYykge1xuICAgICAgbGV0IGNvcm5lciA9IHRoaXMuX2dldF9jb3JuZXIob2JqZWN0LGNvcm5lcl9uYW1lKTtcbiAgICAgIGZvciAobGV0IGkgaW4gdGhpcy5zdXBwb3J0TGluZXMpIHtcbiAgICAgICAgbGV0IGwgPSB0aGlzLnN1cHBvcnRMaW5lc1tpXTtcbiAgICAgICAgbGV0IF92YWwgPSBsW2F4ZV0gKyB0aGlzLnJlY3RbX3BdO1xuICAgICAgICBpZiAobFtheGVdICYmIE1hdGguYWJzKF92YWwgLSBjb3JuZXJbYXhlXSkgPCB0aGlzLnNuYXBBcmVhKSB7XG4gICAgICAgICAgb2JqZWN0W19wXSA9IChfdmFsIC0gKGNvcm5lcltheGVdIC0gb2JqZWN0Lm9Db29yZHMudGxbYXhlXSkpIC8gKG9iamVjdC5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pIDtcbiAgICAgICAgICByZXR1cm4ge3ZhbHVlOiBfdmFsLCBjb3JuZXI6IGNvcm5lcl9uYW1lLCBvYmplY3QyIDogbCwgbGluZTogdHJ1ZX07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2d1aWRsaW5lc1xuICAgIGZvcihsZXQgY29ybmVyX25hbWUgaW4gc2MpIHtcbiAgICAgIGxldCBjb3JuZXIgPSB0aGlzLl9nZXRfY29ybmVyKG9iamVjdCxjb3JuZXJfbmFtZSk7XG4gICAgICBmb3IgKGxldCBpIGluIHRoaXMuZ3VpZGxpbmVzKSB7XG4gICAgICAgIGxldCBsID0gdGhpcy5ndWlkbGluZXNbaV07XG4gICAgICAgIGxldCBfdmFsID0gbFtheGVdICogX3NjYWxlO1xuICAgICAgICBpZiAobFtheGVdICYmIE1hdGguYWJzKF92YWwgLSBjb3JuZXJbYXhlXSkgPCB0aGlzLnNuYXBBcmVhKSB7XG4gICAgICAgICAgb2JqZWN0W19wXSA9IChfdmFsIC0gKGNvcm5lcltheGVdIC0gb2JqZWN0Lm9Db29yZHMudGxbYXhlXSkpIC8gKG9iamVjdC5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pIDtcbiAgICAgICAgICByZXR1cm4ge3ZhbHVlOiBfdmFsLCBjb3JuZXI6IGNvcm5lcl9uYW1lLCBvYmplY3QyIDogbCwgbGluZTogdHJ1ZX07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2dyaWRcblxuICAgIGZvcihsZXQgY29ybmVyX25hbWUgaW4gc2MpIHtcbiAgICAgIGxldCBjb3JuZXIgPSB0aGlzLl9nZXRfY29ybmVyKG9iamVjdCxjb3JuZXJfbmFtZSk7XG5cbiAgICAgIGlmICh0aGlzLmdyaWQuZ3JpZEVuYWJsZWQpIHtcbiAgICAgICAgbGV0IHggPSAoY29ybmVyW2F4ZV0gLSBfbCArIHRoaXMuc25hcEFyZWEgKyB0aGlzLmdyaWQuX2dyaWRPZmZzZXRbYXhlXSkgJSB0aGlzLmdyaWRTaXplO1xuICAgICAgICBpZiAoeCA8IC10aGlzLmdyaWRTaXplKXJldHVybiBmYWxzZTtcbiAgICAgICAgaWYgKHggPCB0aGlzLnNuYXBBcmVhICogMikge1xuICAgICAgICAgIC8vbGV0IF94eHggPSBfYyArIChjb3JuZXJbYXhlXSAtIG9iamVjdC5vQ29vcmRzLnRsW2F4ZV0pO1xuICAgICAgICAgIC8vIGlmIChfeHh4ID4gX2wgJiYgX3h4eCA8IF93ICsgX2wpIHtcbiAgICAgICAgICBvYmplY3RbX3BdIC09IHggLSB0aGlzLnNuYXBBcmVhO1xuICAgICAgICAgIHJldHVybiB7dmFsdWU6IGNvcm5lcltheGVdIC0geCArIHRoaXMuc25hcEFyZWEsIGNvcm5lcjogY29ybmVyX25hbWUsIGdyaWQ6IHRydWV9O1xuICAgICAgICB9XG5cbiAgICAgIH1cblxuXG4gICAgICBpZiAodGhpcy5ib3JkZXJFbmFibGVkKSB7XG4gICAgICAgIC8vZ3JpZCB3aWR0aC9oZWlnaHRcbiAgICAgICAgbGV0IHZhbFggPSAoX3cgKyB0aGlzLm9mZnNldHNbX3BdKSAqIF9zY2FsZTtcbiAgICAgICAgaWYgKE1hdGguYWJzKHZhbFggLSBjb3JuZXJbYXhlXSkgPCB0aGlzLnNuYXBBcmVhKSB7XG4gICAgICAgICAgb2JqZWN0W19wXSA9ICh2YWxYIC0gKGNvcm5lcltheGVdIC0gb2JqZWN0Lm9Db29yZHMudGxbYXhlXSkpIC8gX3NjYWxlO1xuICAgICAgICAgIHJldHVybiB7dmFsdWU6IHZhbFgsIGNvcm5lcjogY29ybmVyX25hbWUsIGdyaWQ6IHRydWUsIGNvcm5lcjI6IGF4ZSA9PSBcInhcIiA/IFwid2lkdGhcIiA6IFwiaGVpZ2h0XCJ9O1xuICAgICAgICB9XG4gICAgICAgIC8vZ3JpZCB0b3AvbGVmdFxuICAgICAgICBsZXQgdmFsWSA9IHRoaXMub2Zmc2V0c1tfcF0gKiB0aGlzLmdldFpvb20oKTtcbiAgICAgICAgaWYgKE1hdGguYWJzKHZhbFkgLSBjb3JuZXJbYXhlXSkgPCB0aGlzLnNuYXBBcmVhKSB7XG4gICAgICAgICAgb2JqZWN0W19wXSA9ICh2YWxZIC0gKGNvcm5lcltheGVdIC0gb2JqZWN0Lm9Db29yZHMudGxbYXhlXSkgKSAvIChvYmplY3QuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKSA7XG4gICAgICAgICAgcmV0dXJuIHt2YWx1ZTogdmFsWSwgY29ybmVyOiBjb3JuZXJfbmFtZSwgZ3JpZDogdHJ1ZSwgY29ybmVyMjogX3B9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICAvL290aGVyIG9iamVjdHNcbiAgICBmb3IgKGxldCBfb2JqX2luZGV4IGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgIGxldCBfb2JqID0gdGhpcy5fb2JqZWN0c1tfb2JqX2luZGV4XTtcbiAgICAgIGlmKCFfb2JqLmdyaWRkYWJsZSB8fCBfb2JqID09IG9iamVjdCB8fCAhX29iai52aXNpYmxlIHx8IF9vYmouaGlkZGVuQWN0aXZlKWNvbnRpbnVlO1xuXG4gICAgICBmb3IobGV0IGNvcm5lcl9uYW1lIGluIHNjKSB7XG4gICAgICAgIGxldCBjb3JuZXIgPSB0aGlzLl9nZXRfY29ybmVyKG9iamVjdCxjb3JuZXJfbmFtZSk7XG5cbiAgICAgICAgZm9yIChsZXQgaiBpbiBzY1tjb3JuZXJfbmFtZV0pIHtcbiAgICAgICAgICBsZXQgY29ybmVyX25hbWVfMiA9ICBzY1tjb3JuZXJfbmFtZV1bal07XG4gICAgICAgICAgbGV0IGNvcm5lcl8yID0gdGhpcy5fZ2V0X2Nvcm5lcihfb2JqLGNvcm5lcl9uYW1lXzIpO1xuXG4gICAgICAgICAgaWYoTWF0aC5hYnMoIGNvcm5lcltheGVdIC0gY29ybmVyXzJbYXhlXSkgPCB0aGlzLnNuYXBBcmVhKXtcbiAgICAgICAgICAgIG9iamVjdFtfcF0gPSAoY29ybmVyXzJbYXhlXSAtICAoY29ybmVyW2F4ZV0gLSBvYmplY3Qub0Nvb3Jkcy50bFtheGVdKSkgLyAob2JqZWN0LmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSkgO1xuICAgICAgICAgICAgcmV0dXJuIHt2YWx1ZTogY29ybmVyXzJbYXhlXSxjb3JuZXI6IGNvcm5lcl9uYW1lLCBvYmplY3QyOiBfb2JqLCBjb3JuZXIyOiBjb3JuZXJfbmFtZV8yfTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBfZHJhd1NuYXBwaW5nKCl7XG4gICAgbGV0IGN0eCA9IHRoaXMuY29udGV4dFRvcCxcbiAgICAgICAgc25hcFRvID0gdGhpcy5zbmFwVG87XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjZmZhYWFhXCI7XG5cbiAgICBpZih0aGlzLl9jdXJyZW50VHJhbnNmb3JtICYmIHNuYXBUbyl7XG4gICAgICB0aGlzLmNsZWFyQ29udGV4dChjdHgpO1xuICAgIH1cblxuICAgIGlmKCFzbmFwVG8pcmV0dXJuO1xuICAgIGlmKHNuYXBUby54KSB7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBpZihzbmFwVG8ueC5vYmplY3QyKXtcbiAgICAgICAgbGV0IF9pYyAsIF9jIDtcbiAgICAgICAgX2MgPSBzbmFwVG8ueC5vYmplY3QyLm9Db29yZHM7XG4gICAgICAgIGlmKHNuYXBUby54LmxpbmUpe1xuICAgICAgICAgIGN0eC5tb3ZlVG8oX2MubXQueCwgMClcbiAgICAgICAgICBjdHgubGluZVRvKF9jLm10LngsIHRoaXMuaGVpZ2h0KVxuICAgICAgICB9ZWxzZXtcblxuICAgICAgICAgIGN0eC5tb3ZlVG8oX2MudGwueCwgX2MudGwueSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhfYy50ci54LCBfYy50ci55KTtcbiAgICAgICAgICBjdHgubGluZVRvKF9jLmJyLngsIF9jLmJyLnkpO1xuICAgICAgICAgIGN0eC5saW5lVG8oX2MuYmwueCwgX2MuYmwueSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhfYy50bC54LCBfYy50bC55KTtcblxuICAgICAgICAgIGlmKHNuYXBUby54LmNvcm5lcjIgPT0gXCJjXCIpe1xuICAgICAgICAgICAgX2ljID0gc25hcFRvLngub2JqZWN0Mi5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX2ljID0gX2Nbc25hcFRvLnguY29ybmVyMl07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKF9pYyl7XG4gICAgICAgICAgICBjdHgubW92ZVRvKF9pYy54LCBfaWMueSlcbiAgICAgICAgICAgIGN0eC5hcmMoX2ljLngsIF9pYy55LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuXG4gICAgICAgIGxldCBfYWN0aXZlID0gdGhpcy5fYWN0aXZlT2JqZWN0IHx8IHRoaXMuX2FjdGl2ZUdyb3VwO1xuICAgICAgICBfYyA9IF9hY3RpdmUub0Nvb3JkcztcbiAgICAgICAgaWYoc25hcFRvLnguY29ybmVyID09IFwiY1wiKXtcbiAgICAgICAgICBfaWMgPSBzbmFwVG8ueC5vYmplY3QyLmdldENlbnRlclBvaW50KCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIF9pYyA9IF9jW3NuYXBUby54LmNvcm5lcl07XG4gICAgICAgIH1cbiAgICAgICAgY3R4Lm1vdmVUbyhfaWMueCwgX2ljLnkpXG4gICAgICAgIGN0eC5hcmMoX2ljLngsIF9pYy55LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgICB9XG4gICAgICBjdHgubW92ZVRvKHNuYXBUby54LnZhbHVlLDApO1xuICAgICAgY3R4LmxpbmVUbyhzbmFwVG8ueC52YWx1ZSx0aGlzLmhlaWdodCk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgfVxuICAgIGlmKHNuYXBUby55KSB7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgICAgIGlmKHNuYXBUby55Lm9iamVjdDIpe1xuICAgICAgICBsZXQgX2ljICwgX2MgO1xuICAgICAgICBfYyA9IHNuYXBUby55Lm9iamVjdDIub0Nvb3JkcztcbiAgICAgICAgaWYoc25hcFRvLnkubGluZSl7XG4gICAgICAgICAgY3R4Lm1vdmVUbygwLF9jLm1sLnkpXG4gICAgICAgICAgY3R4LmxpbmVUbyh0aGlzLndpZHRoLF9jLm1sLnkpXG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICBjdHgubW92ZVRvKF9jLnRsLngsIF9jLnRsLnkpO1xuICAgICAgICAgIGN0eC5saW5lVG8oX2MudHIueCwgX2MudHIueSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhfYy5ici54LCBfYy5ici55KTtcbiAgICAgICAgICBjdHgubGluZVRvKF9jLmJsLngsIF9jLmJsLnkpO1xuICAgICAgICAgIGN0eC5saW5lVG8oX2MudGwueCwgX2MudGwueSk7XG4gICAgICAgICAgaWYgKHNuYXBUby55LmNvcm5lcjIgPT0gXCJjXCIpIHtcbiAgICAgICAgICAgIF9pYyA9IHNuYXBUby55Lm9iamVjdDIuZ2V0Q2VudGVyUG9pbnQoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX2ljID0gX2Nbc25hcFRvLnkuY29ybmVyMl07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKF9pYykge1xuICAgICAgICAgICAgY3R4Lm1vdmVUbyhfaWMueCwgX2ljLnkpXG4gICAgICAgICAgICBjdHguYXJjKF9pYy54LCBfaWMueSwgMiwgMCwgMiAqIE1hdGguUEkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBfYWN0aXZlID0gdGhpcy5fYWN0aXZlT2JqZWN0IHx8IHRoaXMuX2FjdGl2ZUdyb3VwO1xuICAgICAgICAgIF9jID0gX2FjdGl2ZS5vQ29vcmRzO1xuICAgICAgICAgIGlmIChzbmFwVG8ueS5jb3JuZXIgPT0gXCJjXCIpIHtcbiAgICAgICAgICAgIF9pYyA9IHNuYXBUby55Lm9iamVjdDIuZ2V0Q2VudGVyUG9pbnQoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgX2ljID0gX2Nbc25hcFRvLnkuY29ybmVyXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY3R4Lm1vdmVUbyhfaWMueCwgX2ljLnkpXG4gICAgICAgICAgY3R4LmFyYyhfaWMueCwgX2ljLnksIDIsIDAsIDIgKiBNYXRoLlBJKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjdHgubW92ZVRvKDAsc25hcFRvLnkudmFsdWUpO1xuICAgICAgY3R4LmxpbmVUbyh0aGlzLndpZHRoLHNuYXBUby55LnZhbHVlKTtcbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICB9XG4gIH0sXG4gIHRvZ2dsZUdyaWQoKXtcbiAgICBsZXQgdmFsID0gIXRoaXMuZ3JpZDtcbiAgICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgIHRoaXMuc2V0R3JpZCh2YWwpO1xuICAgIHRoaXMuc2V0U25hcHBpbmcodmFsKTtcbiAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgfSxcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gICAgdG9nZ2xlR3JpZDoge1xuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtdGgnLFxuICAgICAga2V5OiAnaScsXG4gICAgICB0aXRsZTogJ0dyaWQnXG4gICAgfVxuICB9KVxufSk7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLCB7XG4gIGFjdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkVkaXRvci5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgIHRvZ2dsZUdyaWQ6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXRoJyxcbiAgICAgIGtleTogJ2knLFxuICAgICAgdGl0bGU6ICdHcmlkJyxcbiAgICAgIGFjdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLnRvZ2dsZUdyaWQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59KTtcblxuZmFicmljLkdyaWRTbmFwcGVyLnByb3RvdHlwZSA9IHtcbiAgLy9vZmZzZXRzIGFuZCBzaXplIG9mIHRoZSBncmlkXG4gIHJlY3Q6IG51bGwsXG4gIC8vICAge1xuICAvLyAgIHRvcDogNTAsXG4gIC8vICAgbGVmdDogNTAsXG4gIC8vICAgd2lkdGg6IDYwMCxcbiAgLy8gICBoZWlnaHQ6IDYwMFxuICAvLyB9LFxuICAvKipcbiAgICogc3VwcG9ydCBsaW5lc1xuICAgKiBAdmFsdWUgW3tcbiAgICAgKiAgW3g6IGludGVnZXJdLFxuICAgICAqICBbeTogaW50ZWdlcl1cbiAgICAgKiB9XVxuICAgKi9cbiAgc3VwcG9ydExpbmVzOiBbXSxcbiAgLyoqXG4gICAqIGZhYnJjIG9iamVjdHMuXG4gICAqIEB2YWx1ZSBba2xhc3NdXG4gICAqL1xuICBvYmplY3RzIDogW10sXG4gIC8vdGhlIGFyZWEgaW4gcGl4ZWxzLCB3aGVyZSBvYmplY3Qgd2lsbCBiZSBzbmFwcGVkIHRvIHRoZSBncmlkXG4gIC8vZmxhZ1xuICBlbmFibGVkOiB0cnVlLFxuICAvL1xuICBncmlkRW5hYmxlZDogdHJ1ZSxcbiAgYm9yZGVyRW5hYmxlZDogdHJ1ZSxcbiAgZ3JpZEJvcmRlciA6IGZhbHNlLFxuICAvL3NpemUgb2YgdGhlIGdyaWRcbiAgZ3JpZFNpemU6IDI1LFxuICAvKipcbiAgICogY29ybmVycyB0aGF0IHdpbGwgYmUgc25hcHBlZCB0byB0aGUgZ3JpZC4gVGhpcyBpcyB0aGUgbmFtZSBmcm9tIGZhYnJpYyBvYmplY3Qgb0Nvb3JkcyBwcm9wZXJ0eS4gKCBpdCBpcyBwb3NzaWJsZSB0byBtb3JlIG9yIGxlc3MgcG9pbnRzIClcbiAgICovXG5cbiAgX3dpbmRvd19tb3VzZV91cCAgKCl7XG4gICAgdGhpcy5oaWRlQWxpZ21lbnRMaW5lcygpO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fd2luZG93X21vdXNlX3VwKTtcbiAgfSxcbiAgLy8gYXBwbHlTbmFwIChvYmope1xuICAvLyAgIGxldCBfZ3MgPSB0aGlzO1xuICAvLyAgIC8vXG4gIC8vICAgLy8gdGhpcy5jYW52YXMub24oXCJvYmplY3Q6cmVtb3ZlZFwiLGZ1bmN0aW9uKGUpe1xuICAvLyAgIC8vICAgbGV0IGkgPSBfZ3MuY2FudmFzLl9vYmplY3RzLmluZGV4T2YoZS50YXJnZXQpO1xuICAvLyAgIC8vICAgaWYoaSA9PSAtMSlyZXR1cm47XG4gIC8vICAgLy8gICBfZ3MuY2FudmFzLl9vYmplY3RzLnNwbGljZShpLDEpO1xuICAvLyAgIC8vIH0pO1xuICAvL1xuICAvLyAgIC8vIG9iai5vbihcIm1vdmluZ1wiLGZ1bmN0aW9uKCl7XG4gIC8vICAgLy8gICBpZihfZ3MuZW5hYmxlZCl7XG4gIC8vICAgLy8gICAgIF9ncy5ncmlkU25hcE1vdmUodGhpcyk7XG4gIC8vICAgLy8gICB9XG4gIC8vICAgLy8gfSk7XG4gIC8vIH0sXG5cbiAgY3JldGVTdXBwb3J0TGluZXMgKCl7XG4gICAgbGV0IHJlY3QgPSB0aGlzLnJlY3Q7XG5cbiAgICBsZXQgb2JqcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zdXBwb3J0TGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBsID0gdGhpcy5zdXBwb3J0TGluZXNbaV07XG4gICAgICBvYmpzLnB1c2gobmV3IGZhYnJpYy5MaW5lKFxuICAgICAgICAobC54ID8gW2wueCwgMCwgbC54LCByZWN0LmhlaWdodF0gOiBbMCwgbC55LCByZWN0LndpZHRoLCBsLnldKSxcbiAgICAgICAgeyBzdHJva2U6ICdyZWQnIH0pKTtcbiAgICB9XG5cbiAgICBsZXQgc3VwcG9ydCA9IG5ldyBmYWJyaWMuR3JvdXAob2Jqcyx7XG4gICAgICBsZWZ0OiByZWN0LmxlZnQsXG4gICAgICB0b3A6IHJlY3QudG9wLFxuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBldmVudGVkOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuY2FudmFzLl9oZWxwZXJzT2JqZWN0cy5wdXNoKHN1cHBvcnQpO1xuICAgIHJldHVybiBzdXBwb3J0O1xuICB9LFxuICByZW1vdmVHcmlkRnJhbWUoKXtcbiAgICB0aGlzLmNhbnZhcy5faGVscGVyc09iamVjdHMuc3BsaWNlKHRoaXMuY2FudmFzLl9oZWxwZXJzT2JqZWN0cy5pbmRleE9mKHRoaXMuZ3JpZEZyYW1lKSwxKTtcbiAgICBkZWxldGUgdGhpcy5ncmlkRnJhbWU7XG4gIH0sXG4gIHJlbW92ZUdyaWQoKXtcblxuICAgIHRoaXMuY2FudmFzLl9oZWxwZXJzT2JqZWN0cy5zcGxpY2UodGhpcy5jYW52YXMuX2hlbHBlcnNPYmplY3RzLmluZGV4T2YodGhpcy5fZ3JpZE9iamVjdCksMSk7XG4gICAgZGVsZXRlIHRoaXMuX2dyaWRPYmplY3Q7XG5cbiAgfSxcbiAgdXBkYXRlR3JpZFNpemUoKXtcblxuICAgIHRoaXMucmVtb3ZlR3JpZEZyYW1lKCk7XG4gICAgdGhpcy5jcmVhdGVHcmlkRnJhbWUoKTtcblxuICAgIGlmKHRoaXMuX2dyaWRPYmplY3Qpe1xuICAgICAgdGhpcy5yZW1vdmVHcmlkKCk7XG4gICAgICB0aGlzLmNyZWF0ZUdyaWQoKTtcbiAgICB9XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGNyZWF0ZUdyaWRGcmFtZSgpe1xuICAgIGxldCBvYmpzID0gW107XG5cbiAgICBvYmpzLnB1c2gobmV3IGZhYnJpYy5MaW5lKFswLCB0aGlzLnJlY3QudG9wLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5yZWN0LnRvcF0sIHtcbiAgICAgIHN0cm9rZTogdGhpcy5jYW52YXMuZ3JpZENvbG9yXG4gICAgfSkpO1xuICAgIG9ianMucHVzaChuZXcgZmFicmljLkxpbmUoWzAsIHRoaXMucmVjdC50b3AgKyB0aGlzLnJlY3QuaGVpZ2h0LCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5yZWN0LnRvcCArIHRoaXMucmVjdC5oZWlnaHRdLCB7XG4gICAgICBzdHJva2U6IHRoaXMuY2FudmFzLmdyaWRDb2xvclxuICAgIH0pKTtcbiAgICBvYmpzLnB1c2gobmV3IGZhYnJpYy5MaW5lKFt0aGlzLnJlY3QubGVmdCwgMCwgdGhpcy5yZWN0LmxlZnQsIHRoaXMuY2FudmFzLmhlaWdodF0sIHtcbiAgICAgIHN0cm9rZTogdGhpcy5jYW52YXMuZ3JpZENvbG9yXG4gICAgfSkpO1xuICAgIG9ianMucHVzaChuZXcgZmFicmljLkxpbmUoW3RoaXMucmVjdC5sZWZ0ICsgdGhpcy5yZWN0LndpZHRoLCAwLCB0aGlzLnJlY3QubGVmdCsgdGhpcy5yZWN0LndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHRdLCB7XG4gICAgICBzdHJva2U6IHRoaXMuY2FudmFzLmdyaWRDb2xvclxuICAgIH0pKTtcblxuICAgIHRoaXMuZ3JpZEZyYW1lID0gbmV3IGZhYnJpYy5Hcm91cChvYmpzLHtcbiAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgZXZlbnRlZDogZmFsc2VcbiAgICB9KTtcbiAgICB0aGlzLmNhbnZhcy5faGVscGVyc09iamVjdHMucHVzaCh0aGlzLmdyaWRGcmFtZSk7XG4gICAgcmV0dXJuIHRoaXMuZ3JpZEZyYW1lO1xuXG4gIH0sXG4gIC8qKlxuICAgKiBjcmVhdGUgYSBzZXQgb2YgbGluZXMgb24gdGhlIGNhbnZhc1xuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIGNyZWF0ZUdyaWQoKXtcbiAgICBsZXQgcmVjdCA9IHRoaXMucmVjdCxcbiAgICAgIHNpemUgPSB0aGlzLmNhbnZhcy5ncmlkU2l6ZSxcbiAgICAgIG9ianMgPSBbXTtcbiAgICB0aGlzLl9ncmlkT2Zmc2V0ID0ge1xuICAgICAgeTogKHNpemUgLSByZWN0LmhlaWdodCAlIHNpemUpIC8gMixcbiAgICAgIHg6IChzaXplIC0gcmVjdC53aWR0aCAlIHNpemUpIC8gMlxuICAgIH07XG5cbiAgICBmb3IgKGxldCB5ID0gc2l6ZSAtIHRoaXMuX2dyaWRPZmZzZXQueTsgeSAgPD0gcmVjdC5oZWlnaHQgLSAxOyB5ICs9IHNpemUpIHtcbiAgICAgIG9ianMucHVzaChuZXcgZmFicmljLkxpbmUoWzAsIHksIHJlY3Qud2lkdGgsIHldLCB7XG4gICAgICAgIHN0cm9rZTogdGhpcy5jYW52YXMuZ3JpZENvbG9yXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgeCA9IHNpemUgLSB0aGlzLl9ncmlkT2Zmc2V0Lng7IHggPD0gcmVjdC53aWR0aCAtIDE7IHggKz0gc2l6ZSkge1xuICAgICAgb2Jqcy5wdXNoKG5ldyBmYWJyaWMuTGluZShbeCwgMCwgeCwgcmVjdC5oZWlnaHRdLCB7XG4gICAgICAgIHN0cm9rZTogdGhpcy5jYW52YXMuZ3JpZENvbG9yXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgdGhpcy5fZ3JpZE9iamVjdCA9IG5ldyBmYWJyaWMuR3JvdXAob2Jqcyx7XG4gICAgICBsZWZ0OiByZWN0LmxlZnQsXG4gICAgICB0b3A6IHJlY3QudG9wLFxuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBldmVudGVkOiBmYWxzZVxuICAgIH0pO1xuXG5cbiAgICB0aGlzLmNhbnZhcy5faGVscGVyc09iamVjdHMucHVzaCh0aGlzLl9ncmlkT2JqZWN0KTtcbiAgICByZXR1cm4gdGhpcy5fZ3JpZE9iamVjdDtcblxuICB9LFxuICBzbmFwQ2FsbGJhY2sgOmZ1bmN0aW9uKHNuYXBUbyl7XG4gICAgdGhpcy5zbmFwVG8gPSBzbmFwVG87XG4gIH0sXG4gIGhpZGVBbGlnbWVudExpbmVzKGNhbnZhcykge1xuXG4gICAgaWYodGhpcy54TGluZSl7XG4gICAgICB0aGlzLnhMaW5lLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgdGhpcy54TGluZS5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfVxuICAgIGlmKHRoaXMueUxpbmUpIHtcbiAgICAgIHRoaXMueUxpbmUuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICB0aGlzLnhMaW5lLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9XG4gIH0sXG4gIGNyZWF0ZUFsaWdtZW50TGluZXMoKSB7XG4gICAgLy90aGlzLnhMaW5lID0gbmV3IGZhYnJpYy5MaW5lKFsxLCAwLCAxLCB0aGlzLmNhbnZhcy5oZWlnaHRdLCB7XG4gICAgLy8gICAgbGVmdDowLFxuICAgIC8vICAgIHN0cm9rZTogJyM0MEQwRkYnLFxuICAgIC8vICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgIC8vICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgIC8vICAgIHZpc2libGU6IGZhbHNlXG4gICAgLy99KTtcbiAgICAvL3RoaXMueUxpbmUgPSBuZXcgZmFicmljLkxpbmUoWzAsIDEsIHRoaXMuY2FudmFzLndpZHRoLCAxXSwge1xuICAgIC8vICAgIHRvcDowLFxuICAgIC8vICAgIHN0cm9rZTogJyM0MEQwRkYnLFxuICAgIC8vICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgIC8vICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgIC8vICAgIHZpc2libGU6IGZhbHNlXG4gICAgLy99KTtcbiAgICAvL1xuICAgIC8vdGhpcy5jYW52YXMuYWRkKHRoaXMueExpbmUpO1xuICAgIC8vdGhpcy5jYW52YXMuYWRkKHRoaXMueUxpbmUpO1xuXG4gIH0sXG5cblxuICAvL3NuYXAgdG8gZ3JpZCBieSB4IGNvb3JkaW5hdGVzXG4gIGdyaWRTbmFwUmVzaXplKG9iamVjdCkge1xuXG4gICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICBsZXQgeCA9IHRoaXMuZ3JpZFNuYXBYUmVzaXplKG9iamVjdCksXG4gICAgICB5ID0gdGhpcy5ncmlkU25hcFlSZXNpemUob2JqZWN0KTtcbiAgICB0aGlzLnNuYXBUbyA9IHt4OiB4LCB5IDogeX07XG4gICAgdGhpcy5zbmFwQ2FsbGJhY2sgJiYgdGhpcy5zbmFwQ2FsbGJhY2sodGhpcy5zbmFwVG8pO1xuICAgIHJldHVybiB0aGlzLnNuYXBUbztcbiAgfSxcblxuICBncmlkU25hcFhSZXNpemUob2JqZWN0KSB7XG5cbiAgICBsZXQgc2VsZiA9IHRoaXM7XG5cbiAgICBsZXQgX2wgPSBzZWxmLnJlY3QubGVmdCxcbiAgICAgIF93ID0gc2VsZi5yZWN0LndpZHRoO1xuXG4gICAgbGV0IGFjdGl2ZV9jb3JuZXIgPSBjYW52YXMuX2N1cnJlbnRUcmFuc2Zvcm0uY29ybmVyO1xuXG4gICAgbGV0IGNvb3JkcyA9IFtdO1xuICAgIGxldCBpc19yaWdodCA9IGZhbHNlO1xuICAgIHN3aXRjaChhY3RpdmVfY29ybmVyKXtcbiAgICAgIGNhc2UgXCJ0clwiOlxuICAgICAgY2FzZSBcImJyXCI6XG4gICAgICBjYXNlIFwibXJcIjpcbiAgICAgICAgaXNfcmlnaHQgPSB0cnVlO1xuICAgICAgICBjb29yZHMgPSBbXCJ0clwiLFwiYnJcIl07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInRsXCI6XG4gICAgICBjYXNlIFwiYmxcIjpcbiAgICAgIGNhc2UgXCJtbFwiOlxuICAgICAgICBjb29yZHMgPSBbXCJibFwiLFwidGxcIl07XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGxldCB0b19yYWRpYW5zID0gTWF0aC5QSSAvIDE4MDtcbiAgICBmb3IobGV0IGkgaW4gdGhpcy5zbmFwQ29ybmVycykge1xuICAgICAgbGV0IF9jb3JuZXJfbmFtZSA9IHRoaXMuc25hcENvcm5lcnNbaV07XG4gICAgICBpZihjb29yZHMuaW5kZXhPZihfY29ybmVyX25hbWUpPT0gLTEpY29udGludWU7XG4gICAgICBsZXQgY29ybmVyID0gb2JqZWN0Lm9Db29yZHNbdGhpcy5zbmFwQ29ybmVyc1tpXV07XG5cbiAgICAgIGxldCB4ID0gKGNvcm5lci54IC0gX2wgKyBzZWxmLmFyZWEpJXNlbGYuZ3JpZFNpemU7XG4gICAgICBsZXQgX2xpbmUgPSAgTWF0aC5mbG9vcigoY29ybmVyLnggLSBfbCArIHNlbGYuYXJlYSkvIHNlbGYuZ3JpZFNpemUpICsgMTtcbiAgICAgIGlmKHggPCAtc2VsZi5ncmlkU2l6ZSApcmV0dXJuIGZhbHNlO1xuICAgICAgaWYoeCA8IHNlbGYuYXJlYSAqIDIpe1xuICAgICAgICBpZihjb3JuZXIueCA+IF9sICYmIGNvcm5lci54IDwgX3cgKyBfbCApe1xuXG4gICAgICAgICAgaWYoaXNfcmlnaHQpe1xuICAgICAgICAgICAgaWYoX2Nvcm5lcl9uYW1lID09IFwidHJcIil7XG4gICAgICAgICAgICAgIGxldCBvcHQgPSB7XG4gICAgICAgICAgICAgICAgc2NhbGVYOiBvYmplY3Quc2NhbGVYICogIChfbGluZSAqIHNlbGYuZ3JpZFNpemUgLSBvYmplY3Qub0Nvb3Jkcy50bC54IC0gX2wpLyhjb3JuZXIueCAtIG9iamVjdC5vQ29vcmRzLnRsLngpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihfY29ybmVyX25hbWUgPT0gXCJiclwiKXtcbiAgICAgICAgICAgICAgbGV0IG9wdCA9IHtcbiAgICAgICAgICAgICAgICBzY2FsZVg6IG9iamVjdC5zY2FsZVggKiAgKF9saW5lICogc2VsZi5ncmlkU2l6ZSAtIG9iamVjdC5vQ29vcmRzLmJsLnggLSBfbCkvKGNvcm5lci54IC0gb2JqZWN0Lm9Db29yZHMuYmwueClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vaWYoX2Nvcm5lcl9uYW1lID09IFwibXJcIil7XG4gICAgICAgICAgICAvLyAgICBsZXQgb3B0ID0ge1xuICAgICAgICAgICAgLy8gICAgICAgIHNjYWxlWDogb2JqZWN0LnNjYWxlWCAqICAoX2xpbmUgKiBzZWxmLmdyaWRTaXplIC0gb2JqZWN0Lm9Db29yZHMubWwueCAtIF9sKS8oY29ybmVyLnggLSBvYmplY3Qub0Nvb3Jkcy5tbC54KVxuICAgICAgICAgICAgLy8gICAgfTtcbiAgICAgICAgICAgIC8vfVxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbGV0IHNjYWxlMiA9ICggY29ybmVyLnggKyBvYmplY3Qud2lkdGggKiBvYmplY3Quc2NhbGVYIC0gKChfbGluZSAtIDEpICogc2VsZi5ncmlkU2l6ZSArIF9sKSkgLyBvYmplY3Qud2lkdGg7XG4gICAgICAgICAgICAvL2lmKF9jb3JuZXJfbmFtZSA9PSBcInRsXCIpe1xuICAgICAgICAgICAgLy8gICAgbGV0IF9sID0gKF9saW5lIC0gMSkgKiBzZWxmLmdyaWRTaXplICsgX2w7XG4gICAgICAgICAgICAvLyAgICBsZXQgX3IgPSBvYmplY3Qub0Nvb3Jkcy50ci54O1xuICAgICAgICAgICAgLy8gICAgbGV0IF93ID0gX3IgLSBfbDtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyAgIGxldCBfc2NhbGUgICA9IF93IC8gKG9iamVjdC53aWR0aCAqTWF0aC5zaW4ob2JqZWN0LmFuZ2xlICogIHRvX3JhZGlhbnMgKSk7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gICAgb3B0ID0ge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vICAgICAgICBzY2FsZVg6IHNjYWxlMlxuICAgICAgICAgICAgLy8gICAgfTtcbiAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgLy9lbHNle1xuXG4gICAgICAgICAgICBsZXQgb3B0ID0ge1xuICAgICAgICAgICAgICBsZWZ0OiAgb2JqZWN0Lm9Db29yZHMudHIueCAtIChvYmplY3Qub0Nvb3Jkcy50ci54IC0gb2JqZWN0LmxlZnQpL29iamVjdC5zY2FsZVggKiBzY2FsZTIsXG4gICAgICAgICAgICAgIHNjYWxlWDogc2NhbGUyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYoX2Nvcm5lcl9uYW1lICE9IFwibWxcIil7XG4gICAgICAgICAgICAgIG9wdC50b3AgPSBvYmplY3Qub0Nvb3Jkcy50ci55IC0gKG9iamVjdC5vQ29vcmRzLnRyLnkgLSBvYmplY3QudG9wKS9vYmplY3Quc2NhbGVYICogc2NhbGUyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy99XG5cblxuXG4gICAgICAgICAgfVxuICAgICAgICAgIG9iamVjdC5zZXQob3B0KTtcbiAgICAgICAgICByZXR1cm4ge3ZhbHVlOiBvYmplY3QubGVmdCArIChjb3JuZXIueCAtIG9iamVjdC5vQ29vcmRzLnRsLngpLCBjb3JuZXI6IF9jb3JuZXJfbmFtZX07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG5cbiAgLy9zbmFwIHRvIGdyaWQgYnkgeCBjb29yZGluYXRlc1xuICBncmlkU25hcFlSZXNpemUob2JqZWN0KSB7XG5cbiAgICBsZXQgc2VsZiA9IHRoaXM7XG5cbiAgICBsZXQgX2wgPSBzZWxmLnJlY3QudG9wLFxuICAgICAgX3cgPSBzZWxmLnJlY3QuaGVpZ2h0O1xuXG4gICAgbGV0IGFjdGl2ZV9jb3JuZXIgPSBjYW52YXMuX2N1cnJlbnRUcmFuc2Zvcm0uY29ybmVyO1xuXG4gICAgbGV0IGNvb3JkcyA9IFtdO1xuICAgIGxldCBpc19yaWdodCA9IGZhbHNlO1xuICAgIHN3aXRjaChhY3RpdmVfY29ybmVyKXtcbi8vICAgICAgICAgICAgIGNhc2UgXCJtbFwiOlxuLy8gICAgICAgICAgICAgICAgIGNvb3JkcyA9IFtcInRsXCIsXCJibFwiXTtcbi8vICAgICAgICAgICAgICAgICBicmVhaztcbi8vICAgICAgICAgICAgIGNhc2UgXCJtclwiOlxuLy8gICAgICAgICAgICAgICAgIGlzX3JpZ2h0ID0gdHJ1ZTtcbi8vICAgICAgICAgICAgICAgICBjb29yZHMgPSBbXCJ0clwiLFwiYnJcIl07XG4vLyAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwidHJcIjpcbiAgICAgIGNhc2UgXCJ0bFwiOlxuICAgICAgY2FzZSBcIm10XCI6XG4gICAgICAgIGNvb3JkcyA9IFtcInRsXCIsXCJ0clwiXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYmxcIjpcbiAgICAgIGNhc2UgXCJtYlwiOlxuICAgICAgY2FzZSBcImJyXCI6XG4gICAgICAgIGlzX3JpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgY29vcmRzID0gW1wiYmxcIixcImJyXCJdO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICBmb3IobGV0IGkgaW4gdGhpcy5zbmFwQ29ybmVycykge1xuICAgICAgbGV0IF9jb3JuZXJfbmFtZSA9IHRoaXMuc25hcENvcm5lcnNbaV07XG4gICAgICBpZihjb29yZHMuaW5kZXhPZihfY29ybmVyX25hbWUpPT0gLTEpY29udGludWU7XG4gICAgICBsZXQgY29ybmVyID0gb2JqZWN0Lm9Db29yZHNbdGhpcy5zbmFwQ29ybmVyc1tpXV07XG5cbiAgICAgIGxldCB5ID0gKGNvcm5lci55IC0gX2wgKyBzZWxmLmFyZWEpJXNlbGYuZ3JpZFNpemU7XG4gICAgICBsZXQgX2xpbmUgPSAgTWF0aC5mbG9vcigoY29ybmVyLnkgLSBfbCArIHNlbGYuYXJlYSkvIHNlbGYuZ3JpZFNpemUpICsgMTtcbiAgICAgIGlmKHkgPCAtc2VsZi5ncmlkU2l6ZSApcmV0dXJuIGZhbHNlO1xuICAgICAgaWYoeSA8IHNlbGYuYXJlYSAqIDIpe1xuICAgICAgICBpZihjb3JuZXIueSA+IF9sICYmIGNvcm5lci55IDwgX3cgKyBfbCApe1xuXG4gICAgICAgICAgaWYoaXNfcmlnaHQpe1xuICAgICAgICAgICAgaWYoX2Nvcm5lcl9uYW1lID09IFwiYmxcIil7XG4gICAgICAgICAgICAgIGxldCBvcHQgPSB7XG4gICAgICAgICAgICAgICAgc2NhbGVZOiBvYmplY3Quc2NhbGVZICogIChfbGluZSAqIHNlbGYuZ3JpZFNpemUgLSBvYmplY3Qub0Nvb3Jkcy50bC55IC0gX2wpLyhjb3JuZXIueSAtIG9iamVjdC5vQ29vcmRzLnRsLnkpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihfY29ybmVyX25hbWUgPT0gXCJiclwiKXtcbiAgICAgICAgICAgICAgbGV0IG9wdCA9IHtcbiAgICAgICAgICAgICAgICBzY2FsZVk6IG9iamVjdC5zY2FsZVkgKiAgKF9saW5lICogc2VsZi5ncmlkU2l6ZSAtIG9iamVjdC5vQ29vcmRzLnRyLnkgLSBfbCkvKGNvcm5lci55IC0gb2JqZWN0Lm9Db29yZHMudHIueSlcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vaWYoX2Nvcm5lcl9uYW1lID09IFwibWJcIil7XG4gICAgICAgICAgICAvLyAgICBsZXQgb3B0ID0ge1xuICAgICAgICAgICAgLy8gICAgICAgIHNjYWxlWTogb2JqZWN0LnNjYWxlWSAqICAoX2xpbmUgKiBzZWxmLmdyaWRTaXplIC0gb2JqZWN0Lm9Db29yZHMudHIueSAtIF9sKS8oY29ybmVyLnkgLSBvYmplY3Qub0Nvb3Jkcy5tdC55KVxuICAgICAgICAgICAgLy8gICAgfTtcbiAgICAgICAgICAgIC8vfVxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgbGV0IHNjYWxlMiA9ICggY29ybmVyLnkgKyBvYmplY3Qud2lkdGggKiBvYmplY3Quc2NhbGVZIC0gKChfbGluZSAtIDEpICogc2VsZi5ncmlkU2l6ZSArIF9sKSkgLyBvYmplY3Qud2lkdGg7XG4gICAgICAgICAgICBsZXQgb3B0ID0ge1xuICAgICAgICAgICAgICB0b3A6ICAgb2JqZWN0Lm9Db29yZHMuYmwueSAtIChvYmplY3Qub0Nvb3Jkcy5ibC55IC0gb2JqZWN0LnRvcCkvb2JqZWN0LnNjYWxlWSAqIHNjYWxlMixcbiAgICAgICAgICAgICAgc2NhbGVZOiBzY2FsZTJcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvL2lmKF9jb3JuZXJfbmFtZSAhPSBcIm10XCIpe1xuICAgICAgICAgICAgLy8gICAgb3B0LmxlZnQgPSAgb2JqZWN0Lm9Db29yZHMuYmwueSAtIChvYmplY3Qub0Nvb3Jkcy5ibC55IC0gb2JqZWN0LmxlZnQpL29iamVjdC5zY2FsZVkgKiBzY2FsZTI7XG4gICAgICAgICAgICAvL31cbiAgICAgICAgICB9XG4gICAgICAgICAgb2JqZWN0LnNldChvcHQpO1xuICAgICAgICAgIHJldHVybiB7dmFsdWU6IG9iamVjdC5sZWZ0ICsgKGNvcm5lci55IC0gb2JqZWN0Lm9Db29yZHMudGwueSksIGNvcm5lcjogX2Nvcm5lcl9uYW1lfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9ncmlkLmpzXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZ3JpZC5qcyIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLm9iamVjdHNMaWJyYXJ5ID0ge1xuICB0ZXh0OiB7XG4gICAgICB0aXRsZTogXCJUZXh0XCIsXG4gICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgIHRleHQ6IFwi0KLQtdC60YHRglwiXG4gIH0sXG4gIGlUZXh0OiB7XG4gICAgdGl0bGU6IFwiSVRleHRcIixcbiAgICB0eXBlOiBcImktdGV4dFwiLFxuICAgIHRleHQ6IFwi0KLQtdC60YHRglwiXG4gIH0sXG4gIHRleHRib3g6IHtcbiAgICB0aXRsZTogXCJUZXh0Ym94XCIsXG4gICAgdHlwZTogXCJ0ZXh0Ym94XCIsXG4gICAgdGV4dDogXCLQotC10LrRgdGCXCIsXG4gICAgd2lkdGg6IDEwMFxuICB9LFxuICBsaW5lOiB7XG4gICAgdHlwZTogXCJsaW5lXCIsXG4gICAgc3Ryb2tlV2lkdGg6IDUsXG4gICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgc2NhbGVYOiAxLFxuICAgIHNjYWxlWTogMSxcbiAgICB4MTogMCxcbiAgICB4MjogMTAwLFxuICAgIHkxOiAwLFxuICAgIHkyOiA1MFxuICB9LFxuICB0cmlhbmdsZToge1xuICAgIHR5cGU6IFwidHJpYW5nbGVcIixcbiAgICB3aWR0aDogZnVuY3Rpb24odyxoKXsgcmV0dXJuIE1hdGgubWluKHcsaCkgLSA0fSxcbiAgICBoZWlnaHQ6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH1cbiAgfSxcbiAgcmVjdGFuZ2xlOiB7XG4gICAgdHlwZTogXCJyZWN0XCIsXG4gICAgd2lkdGg6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH0sXG4gICAgaGVpZ2h0OiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKSAtIDR9XG4gIH0sXG4gIHBvbHlnb246IHtcbiAgICBzY2FsZVg6IDEsXG4gICAgc2NhbGVZOiAxLFxuICAgIHR5cGU6IFwicG9seWdvblwiLFxuICAgIHBvaW50czogZnVuY3Rpb24odyxoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7eDogMjUsIHk6IDF9LFxuICAgICAgICB7eDogMzEsIHk6IDE4fSxcbiAgICAgICAge3g6IDQ5LCB5OiAxOH0sXG4gICAgICAgIHt4OiAzNSwgeTogMjl9LFxuICAgICAgICB7eDogNDAsIHk6IDQ2fSxcbiAgICAgICAge3g6IDI1LCB5OiAzNn0sXG4gICAgICAgIHt4OiAxMCwgeTogNDZ9LFxuICAgICAgICB7eDogMTUsIHk6IDI5fSxcbiAgICAgICAge3g6ICAxLCB5OiAxOH0sXG4gICAgICAgIHt4OiAxOSwgeTogMTh9XG4gICAgICBdO1xuICAgIH1cbiAgfSxcbiAgcGF0aDoge1xuICAgIFwidHlwZVwiOiBcInBhdGhcIixcbiAgICBcInBhdGhcIjogIFwibTU4MS4wNzc5NDIsMi41MzczNTljLTIuMDUzMjIzLDAuMDQ3MDcxIC00LjA0MDcxLDAuMTg4MzQ4IC02LjEwODA5MywwLjM1MjkwN2MtMzMuMDU1NDIsMi42NjM5MTggLTYyLjIzNTkwMSwxOS42NDA1NDEgLTc3LjA1NzY3OCw0NC45MjU5NTNsLTcuODU3MywxOS4xMzUzMTljMS42OTg4MjIsLTYuNjMzMTQ0IDQuMzAyOTc5LC0xMy4wNjUzODQgNy44NTczLC0xOS4xMzUzMTljLTI2LjQzMDY5NSwtMjIuMTYyOTMgLTYzLjUzMTY3NywtMzIuMzg4NDQ1IC0xMDAuMTkyMzgzLC0yNy41NzQzNzNjLTM2LjY2MTQ2OSw0Ljc4ODM1MyAtNjguNTAzMDgyLDI0LjA0MTc1OCAtODUuOTAxOTc4LDUxLjkzNTIyNWMtNDkuMTE2NDg2LC0yNC40OTAwMTMgLTExMC4zNDI4OCwtMjIuOTk5NDU0IC0xNTcuNzExODA3LDMuODYwMDkyYy00Ny4zNjkxNjQsMjYuODYwNjggLTcyLjYxNjczLDc0LjQwNTUxIC02NC45NDExNjIsMTIyLjM4MzA4bDUuMDIxMzU1LDE5LjQ5OTY4Yy0yLjI2MzMyOSwtNi4zODUwMSAtMy45NjA3OTMsLTEyLjg4NzY5NSAtNS4wMjEzNTUsLTE5LjQ5OTY4bC0wLjc2MTk0OCwxLjc5ODU2OWMtNDEuMTc5MTY1LDMuNjI1MjQ0IC03NC45NDUzNzUsMjkuNDY1MTM0IC04My43MTYzOTgsNjQuMDU5MjM1Yy04Ljc3MTgwNSwzNC41OTc3NDggOS40NjcwMSw3MC4wODU4NzYgNDUuMTg1NjIxLDg3Ljk2NzAxbDU1Ljc3NjU1OCwxMC45NzMxMTRjLTE5LjQ4MDIxNywxLjI5MTk2MiAtMzguOTE1NTQzLC0yLjUzNDUxNSAtNTUuNzc2NTU4LC0xMC45NzMxMTRjLTI3LjU0NzgsMjQuOTY4MTcgLTMzLjg4ODUxNiw2MS45MzUzMDMgLTE1LjcxNDkyLDkyLjQ2NzgzNGMxOC4xNzM3MzMsMzAuNTI0NzE5IDU2Ljk4ODg5OSw0OC4xMTA2ODcgOTcuMDMwNDU3LDQ0LjExNzM0bDI0LjMzOTcyMiwtNS4yMTEwOWMtNy44Mjc0OTksMi42NTE2MTEgLTE1Ljk2MDk4Myw0LjM3OTA1OSAtMjQuMzM5NzIyLDUuMjExMDljMjIuNzMwMDQyLDMzLjg1NzI2OSA2MC40MjgxOTIsNTguNTU2MjQ0IDEwNC42Njg5Myw2OC4zODM1MTRjNDQuMjQ5MSw5LjgxMzY2IDkxLjI0MDk1Miw0LjAxNDc3MSAxMzAuNDI1OTQ5LC0xNi4wOTQ2MDRjMzEuOTY3MDEsNDAuNzkzODIzIDg4LjcwNzY0Miw2Mi4yMTc0NjggMTQ1LjU5NjMxMyw1NC45OTcwN2M1Ni45MDI0NjYsLTcuMjE5NjY2IDEwMy44MzM5ODQsLTQxLjgxNDI3IDEyMC41MDEzNDMsLTg4Ljc3MDk5Nmw1Ljc4MTQzMywtMjYuMjM5NTMyYy0wLjg2MzcwOCw4LjkwOTU0NiAtMi43NDIyNDksMTcuNjgxMzY2IC01Ljc4MTQzMywyNi4yMzk1MzJjMzkuMTMzMzAxLDIwLjc1MzY2MiA4OC4zNTMzMzMsMjEuOTI3MzA3IDEyOC43ODUwOTUsMy4wNDkzMTZjNDAuNDM5ODE5LC0xOC44NzQwODQgNjUuNjY1NzcxLC01NC44NjkwNDkgNjYuMDM2MTMzLC05NC4wNzgyNDdsLTE0LjQ5NTYwNSwtNTguNTgwNTk3bC01Ny4xMDU3MTMsLTM5LjYzMDc2OGM0NC4xNjM0NTIsMjIuMzc0NTczIDcxLjk5MjYxNSw1Ni40NjcyNTUgNzEuNjAxMzE4LDk4LjIxMTM2NWM1Mi40OTcwNywwLjQ0ODE4MSA5Ny4xMDMzOTQsLTM1Ljk1NjU3MyAxMTcuMTEyNDI3LC03Ny43MjYyODhjMjAuMDExNTk3LC00MS43Njk4MzYgMTIuNDQzNjA0LC04OS4zOTY3NTkgLTE5Ljg2NDkyOSwtMTI1LjE2NDY0MmMxMy40MDExODQsLTI2LjYzNzY5NSAxMi42MDk5ODUsLTU2LjkzNzMzMiAtMi4xODM0NzIsLTgzLjAzNDA4OGMtMTQuNzg2MTk0LC0yNi4wOTc4OTMgLTQyLjA2NTQ5MSwtNDUuNDc2ODkxIC03NC44NzMwNDcsLTUzLjA5ODMzNWMtNy4zNDE0MzEsLTM0LjU4MDkyOSAtMzcuNjAyNjYxLC02Mi40MDQ0ODIgLTc3LjYwMDcwOCwtNzEuNTI2MjkzYy0zOS45OTg0NzQsLTkuMTIxMzY4IC04Mi41ODQ4MzksMi4xMjM5OTIgLTEwOS4zNjQ4MDcsMjguOTI2MTIzbC0xNi4yNTgxNzksMjIuMTk4MTdjNC4xNTc5NTksLTguMDE4NjEyIDkuNTgzOTIzLC0xNS40OTUyMTMgMTYuMjU4MTc5LC0yMi4xOTgxN2MtMTguODc2OTUzLC0yMS4wNjA3MTMgLTQ4LjQ4NjAyMywtMzIuOTU0MDYxIC03OS4zNDg5MzgsLTMyLjE1NTQwMWwwLDB6XCIsXG4gICAgXCJ3aWR0aFwiOiBmdW5jdGlvbih3LGgpe3JldHVybiB3IC0gNCB9LFxuICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uKHcsaCl7cmV0dXJuIGggLSA0fVxuICB9LFxuICBlbGxpcHNlOiB7XG4gICAgXCJ0eXBlXCI6IFwiZWxsaXBzZVwiLFxuICAgIFwicnhcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gdyAvMiAtIDR9LFxuICAgIFwicnlcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gaC8gMiAtIDR9XG4gIH0sXG4gIGNpcmNsZToge1xuICAgIHR5cGU6IFwiY2lyY2xlXCIsXG4gICAgcmFkaXVzOiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKS8yIC0gNH1cbiAgfVxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuRWRpdG9yLnByb3RvdHlwZSwge1xuICBnZXRMaWJyYXJ5RWxlbWVudHM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZSh0aGlzLmxpYnJhcnkse2lkOiBvcHRpb25zLmNhdGVnb3J5fSk7XG5cbiAgICB2YXIgY2F0ZWdvcnlfaXRlbXMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKGNhdGVnb3J5Lml0ZW1zKTtcblxuICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3QubWFwKGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAoY2F0ZWdvcnkuaXRlbXMpLGVsID0+IGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhlbCxjYXRlZ29yeS50ZW1wbGF0ZSkpXG4gIH0sXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdmFsdWVcbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICBbe1xuICAgIFwiaWRcIjogNSxcbiAgICBcInRpdGxlXCI6IFwidmlkZW9cIixcbiAgICBcInRlbXBsYXRlXCI6IHtcbiAgICAgIFwidHlwZVwiOiBcInZpZGVvXCJcbiAgICB9LFxuICAgIFwiaXRlbXNcIjogW1xuICAgICAge1xuICAgICAgICBcInNyY1wiOiBcInZpZGVvLm1wZ1wiXG4gICAgICAgIFwiaGVpZ2h0XCI6IDM2MCxcbiAgICAgICAgXCJ3aWR0aFwiOiA0ODBcbiAgICAgIH1dXG4gICAgfV1cbiAgICovXG4gIHNldExpYnJhcnk6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2spIHtcbiAgICBmYWJyaWMudXRpbC5kYXRhLmxvYWRKc29uKHZhbHVlLCBkYXRhID0+IHtcbiAgICAgIGRhdGEuZm9yRWFjaChjYXRlZ29yeSA9PiB7XG4gICAgICAgIGlmKCFjYXRlZ29yeS5pZCl7XG4gICAgICAgICAgY2F0ZWdvcnkuaWQgPSArK2ZhYnJpYy51dGlsLl9pZENvdW50ZXJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLmxpYnJhcnkgPSBkYXRhO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfSxcbiAgZ2V0T2JqZWN0c0xpc3Q6IGZ1bmN0aW9uKHcsaCl7XG4gICAgdmFyIF9saWIgPSBbXTtcbiAgICBmb3IodmFyIGkgaW4gZmFicmljLm9iamVjdHNMaWJyYXJ5KSB7XG4gICAgICBjb25zb2xlLmxvZyhpKTtcbiAgICAgIHZhciBvID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChmYWJyaWMub2JqZWN0c0xpYnJhcnlbaV0pO1xuICAgICAgby5pZCA9IGk7XG4gICAgICBfbGliLnB1c2gobyk7XG4gICAgICBvLnRpdGxlID0gby50aXRsZSB8fCBvLnR5cGU7XG4gICAgICBpZihvLndpZHRoID09PSAwICkgby53aWR0aCA9IHc7XG4gICAgICBpZihvLmhlaWdodCA9PT0gMCApIG8uaGVpZ2h0ID0gaDtcbiAgICAgIGZvcih2YXIgaiBpbiBvKXtcbiAgICAgICAgaWYob1tqXS5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pe1xuICAgICAgICAgIG9bal0gPSBvW2pdLmNhbGwobyx3LGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfbGliO1xuICB9XG59KTtcbmZhYnJpYy5FZGl0b3IucHJvdG90eXBlLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzLnB1c2goXCJsaWJyYXJ5XCIpO1xuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvbGlicmFyeS5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMudXRpbC5tZWRpYVJvb3QgPSBcIlwiO1xuZmFicmljLnV0aWwuYWRkTm9DYWNoZSA9IGZhbHNlO1xuXG5mYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuID0gZmFicmljLnV0aWwubG9hZEltYWdlO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkVkaXRvci5wcm90b3R5cGUsIHtcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuRWRpdG9yLnByb3RvdHlwZS5vcHRpb25zT3JkZXI7XG4gICAgb28uc3BsaWNlKG9vLmluZGV4T2YoXCJjYW52YXNDb250YWluZXJcIiksMCxcIm1lZGlhUm9vdFwiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIHNldE1lZGlhUm9vdDogZnVuY3Rpb24gKHZhbCkge1xuICAgIGlmICh2YWwpIHtcbiAgICAgIGlmKHZhbC5pbmRleE9mKFwiOi8vXCIgIT0gLTEpKXtcbiAgICAgICAgZmFicmljLnV0aWwubWVkaWFSb290ID0gdmFsO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgX2Rpcm5hbWU7XG4gICAgICBpZiAoZmFicmljLmlzTGlrZWx5Tm9kZSkge1xuICAgICAgICBfZGlybmFtZSA9IF9fZGlybmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9kaXJuYW1lID0gZmFicmljLnV0aWwucGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwod2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgICAgfVxuICAgICAgdmFyIF9sYXN0ID0gdmFsW3ZhbC5sZW5ndGggLSAxXTtcbiAgICAgIGlmIChfbGFzdCAhPSBcIi9cIiAmJiBfbGFzdCAhPSBcIlxcXFxcIikge1xuICAgICAgICB2YWwgKz0gXCIvXCJcbiAgICAgIH1cbiAgICAgIHZhbCA9IGZhYnJpYy51dGlsLnBhdGgucmVzb2x2ZShfZGlybmFtZSArIHZhbCk7XG4gICAgICBmYWJyaWMudXRpbC5tZWRpYVJvb3QgPSB2YWw7XG4gICAgfVxuICB9XG59KTtcblxuXG5cblxuLy8gaWYoIWZhYnJpYy5pc0xpa2VseU5vZGUpe1xuLy9cbi8vICAgdmFyIFVSTCA9IHJlcXVpcmUoJ3VybCcpLFxuLy8gICAgIEhUVFAgPSByZXF1aXJlKCdodHRwJyksXG4vLyAgICAgSFRUUFMgPSByZXF1aXJlKCdodHRwcycpLFxuLy8gICAgIEltYWdlID0gcmVxdWlyZSgnY2FudmFzJykuSW1hZ2U7XG4vL1xuLy8gICAvKiogQHByaXZhdGUgKi9cbi8vICAgdmFyIHJlcXVlc3QgPSBmdW5jdGlvbiAodXJsLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbi8vICAgICB2YXIgb1VSTCA9IFVSTC5wYXJzZSh1cmwpO1xuLy9cbi8vICAgICAvLyBkZXRlY3QgaWYgaHR0cCBvciBodHRwcyBpcyB1c2VkXG4vLyAgICAgaWYgKCAhb1VSTC5wb3J0ICkge1xuLy8gICAgICAgb1VSTC5wb3J0ID0gKCBvVVJMLnByb3RvY29sLmluZGV4T2YoJ2h0dHBzOicpID09PSAwICkgPyA0NDMgOiA4MDtcbi8vICAgICB9XG4vL1xuLy8gICAgIC8vIGFzc2lnbiByZXF1ZXN0IGhhbmRsZXIgYmFzZWQgb24gcHJvdG9jb2xcbi8vICAgICB2YXIgcmVxSGFuZGxlciA9IChvVVJMLnByb3RvY29sLmluZGV4T2YoJ2h0dHBzOicpID09PSAwICkgPyBIVFRQUyA6IEhUVFAsXG4vLyAgICAgICByZXEgPSByZXFIYW5kbGVyLnJlcXVlc3Qoe1xuLy8gICAgICAgICBob3N0bmFtZTogb1VSTC5ob3N0bmFtZSxcbi8vICAgICAgICAgcG9ydDogb1VSTC5wb3J0LFxuLy8gICAgICAgICBwYXRoOiBvVVJMLnBhdGgsXG4vLyAgICAgICAgIG1ldGhvZDogJ0dFVCdcbi8vICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4vLyAgICAgICAgIHZhciBib2R5ID0gJyc7XG4vLyAgICAgICAgIGlmIChlbmNvZGluZykge1xuLy8gICAgICAgICAgIHJlc3BvbnNlLnNldEVuY29kaW5nKGVuY29kaW5nKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICByZXNwb25zZS5vbignZW5kJywgZnVuY3Rpb24gKCkge1xuLy8gICAgICAgICAgIGNhbGxiYWNrKGJvZHkpO1xuLy8gICAgICAgICB9KTtcbi8vICAgICAgICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHtcbi8vICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4vLyAgICAgICAgICAgICBib2R5ICs9IGNodW5rO1xuLy8gICAgICAgICAgIH1cbi8vICAgICAgICAgfSk7XG4vLyAgICAgICB9KTtcbi8vXG4vLyAgICAgcmVxLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikge1xuLy8gICAgICAgaWYgKGVyci5lcnJubyA9PT0gcHJvY2Vzcy5FQ09OTlJFRlVTRUQpIHtcbi8vICAgICAgICAgZmFicmljLmxvZygnRUNPTk5SRUZVU0VEOiBjb25uZWN0aW9uIHJlZnVzZWQgdG8gJyArIG9VUkwuaG9zdG5hbWUgKyAnOicgKyBvVVJMLnBvcnQpO1xuLy8gICAgICAgfVxuLy8gICAgICAgZWxzZSB7XG4vLyAgICAgICAgIGZhYnJpYy5sb2coZXJyLm1lc3NhZ2UpO1xuLy8gICAgICAgfVxuLy8gICAgICAgY2FsbGJhY2sobnVsbCk7XG4vLyAgICAgfSk7XG4vL1xuLy8gICAgIHJlcS5lbmQoKTtcbi8vICAgfVxuLy9cbi8vICAgLyoqIEBwcml2YXRlICovXG4vLyAgIHZhciByZXF1ZXN0RnMgPSBmdW5jdGlvbiAocGF0aCwgY2FsbGJhY2spIHtcbi8vICAgICB2YXIgZnMgPSByZXF1aXJlKCdmcycpO1xuLy8gICAgIGZzLnJlYWRGaWxlKHBhdGgsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbi8vICAgICAgIGlmIChlcnIpIHtcbi8vICAgICAgICAgZmFicmljLmxvZyhlcnIpO1xuLy8gICAgICAgICB0aHJvdyBlcnI7XG4vLyAgICAgICB9XG4vLyAgICAgICBlbHNlIHtcbi8vICAgICAgICAgY2FsbGJhY2soZGF0YSk7XG4vLyAgICAgICB9XG4vLyAgICAgfSk7XG4vLyAgIH07XG4vL1xuLy8gICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UgPSBmdW5jdGlvbih1cmwsIGNhbGxiYWNrLCBjb250ZXh0KSB7XG4vL1xuLy9cbi8vICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4vLyAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbigpe1xuLy8gICAgICAgY29uc29sZS5sb2coXCJlcnJvclwiKTtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgbnVsbCwgdHJ1ZSk7XG4vLyAgICAgfTtcbi8vICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKXtcbi8vICAgICAgIGNvbnNvbGUubG9nKFwic3VjY2Vzc1wiKTtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgaW1nKTtcbi8vICAgICB9O1xuLy9cbi8vICAgICBmdW5jdGlvbiBjcmVhdGVJbWFnZUFuZENhbGxCYWNrKGRhdGEpIHtcbi8vICAgICAgIGlmIChkYXRhKSB7XG4vLyAgICAgICAgIGltZy5zcmMgPSBkYXRhO1xuLy8gICAgICAgICAvLyBwcmVzZXJ2aW5nIG9yaWdpbmFsIHVybCwgd2hpY2ggc2VlbXMgdG8gYmUgbG9zdCBpbiBub2RlLWNhbnZhc1xuLy8gICAgICAgICBpbWcuX3NyYyA9IHVybDtcbi8vICAgICAgIH1cbi8vICAgICAgIGVsc2Uge1xuLy8gICAgICAgICBpbWcgPSBudWxsO1xuLy8gICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKGNvbnRleHQsIG51bGwsIHRydWUpO1xuLy8gICAgICAgfVxuLy8gICAgIH1cbi8vXG4vLyAgICAgaWYgKHVybCAmJiAodXJsIGluc3RhbmNlb2YgQnVmZmVyIHx8IHVybC5pbmRleE9mKCdkYXRhJykgPT09IDApKSB7XG4vLyAgICAgICBpbWcuc3JjID0gaW1nLl9zcmMgPSB1cmw7XG4vLyAgICAgfVxuLy8gICAgIGVsc2UgaWYgKHVybCAmJiB1cmwuaW5kZXhPZignaHR0cCcpICE9PSAwKSB7XG4vLyAgICAgICB2YXIgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuLy8gICAgICAgdXJsID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4vLyAgICAgICB1cmwgPSAgIHBhdGgucmVzb2x2ZShmYWJyaWMudXRpbC5tZWRpYVJvb3QsIHVybCk7XG4vLyAgICAgICBpbWcuc3JjID0gIHVybDtcbi8vICAgICAgIC8vIHJlcXVlc3RGcyh1cmwsIGNyZWF0ZUltYWdlQW5kQ2FsbEJhY2spO1xuLy8gICAgIH1cbi8vICAgICBlbHNlIGlmICh1cmwpIHtcbi8vICAgICAgIHJlcXVlc3QodXJsLCAnYmluYXJ5JywgY3JlYXRlSW1hZ2VBbmRDYWxsQmFjayk7XG4vLyAgICAgfVxuLy8gICAgIGVsc2Uge1xuLy8gICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChjb250ZXh0LCB1cmwpO1xuLy8gICAgIH1cbi8vICAgfTtcbi8vIH1lbHNle1xuICBmYWJyaWMudXRpbC5sb2FkUmVzb3VyY2VzID0gZnVuY3Rpb24gKHJlc291cmNlcywgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG5cbiAgICB2YXIgbG9hZGVkUmVzb3VyY2VzID0ge307XG4gICAgdmFyIGxvYWRlciA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChPYmplY3Qua2V5cyhyZXNvdXJjZXMpLmxlbmd0aCxmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sobG9hZGVkUmVzb3VyY2VzKTtcbiAgICB9KTtcbiAgICBmb3IodmFyIGkgaW4gcmVzb3VyY2VzKXtcbiAgICAgIChmdW5jdGlvbihpKXtcbiAgICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKHJlc291cmNlc1tpXSwgZnVuY3Rpb24oaW1hZ2Upe1xuICAgICAgICAgIGxvYWRlZFJlc291cmNlc1tpXSA9IGltYWdlO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBjb250ZXh0LCBjcm9zc09yaWdpbik7XG4gICAgICB9KGkpKTtcbiAgICB9XG4gIH07XG5cbiAgZmFicmljLnV0aWwubG9hZEltYWdlID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG4gICAgdXJsID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4gICAgZnVuY3Rpb24gX2NoZWNrX2Vycm9ycyhpbWcpe1xuICAgICAgLy/QuNC30L7QsdGA0LDQttC10L3QuNC1INC90LUg0LHRi9C70L4g0LfQsNCz0YDRg9C20LXQvdC+XG4gICAgICBpZiAoaW1nKSB7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcyxpbWcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmFicmljLmVycm9ycy5wdXNoKHt0eXBlOiBcImltYWdlXCIsIG1lc3NhZ2U6IFwiSW1hZ2Ugd2FzIG5vdCBsb2FkZWRcIn0pO1xuICAgICAgICBmYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuKGZhYnJpYy5tZWRpYS5lcnJvciwgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZihmYWJyaWMuZGVidWdUaW1lb3V0KXtcbiAgICAgIHNldFRpbWVvdXQoZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbi5iaW5kKHRoaXMsdXJsLCBfY2hlY2tfZXJyb3JzICwgY29udGV4dCwgY3Jvc3NPcmlnaW4gfHwgJ0Fub255bW91cycpLGZhYnJpYy5kZWJ1Z1RpbWVvdXQpXG4gICAgfWVsc2V7XG4gICAgICBmYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuKHVybCwgX2NoZWNrX2Vycm9ycyAsIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKTtcbiAgICB9XG4gIH07XG5cblxuZmFicmljLnV0aWwuZ2V0VVJMID0gZnVuY3Rpb24odXJsKXtcbiAgaWYgKHVybC5pbmRleE9mKCdibG9iJykgIT09IDAgJiYgdXJsLmluZGV4T2YoJ2RhdGEnKSAhPT0gMCAmJiB1cmwuaW5kZXhPZignOi8vJykgPT0gLTEgJiYgIXVybC5zdGFydHNXaXRoKCcuLycpKSB7XG4gICAgdXJsID0gZmFicmljLnV0aWwubWVkaWFSb290ICsgdXJsO1xuICB9XG4gIGlmIChmYWJyaWMudXRpbC5hZGROb0NhY2hlICYmIC9eKGh0dHB8aHR0cHMpXFw6XFwvXFwvLy50ZXN0KHVybCkpIHtcbiAgICB1cmwgKz0gJz9uby1jYWNoZT0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgfVxuICByZXR1cm4gdXJsO1xufTtcblxuXG5mYWJyaWMudXRpbC5sb2FkVmlkZW8gPSBmdW5jdGlvbiAoc291cmNlcywgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG5cbiAgZnVuY3Rpb24gbG9hZEl0KHVybCl7XG4gICAgdmlkZW8uc3JjID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24oKXtcbiAgICAgIGNhbGxiYWNrKHZpZGVvKTtcbiAgICB9LCB0cnVlKTtcbiAgICB2aWRlby5sb2FkKCk7XG4gIH1cblxuXG5cblxuICB2YXIgdmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpO1xuXG5cbiAgLy90cnlpbmcgdG8gZmluZCB0aGUgbW9zdCBzdWl0YWJsZSBzb3VyY2UgZm9yIGN1cnJlbnQgYnJvd3NlclxuICBmb3IgKHZhciB0eXBlIGluIHNvdXJjZXMpIHtcbiAgICBpZih2aWRlby5jYW5QbGF5VHlwZSh0eXBlKSA9PSBcInllc1wiKXtcbiAgICAgIHRoaXMubWVkaWFUeXBlID0gdHlwZTtcbiAgICAgIGxvYWRJdChzb3VyY2VzW3R5cGVdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgdHlwZSBpbiBzb3VyY2VzKSB7XG4gICAgaWYodmlkZW8uY2FuUGxheVR5cGUodHlwZSkgPT0gXCJtYXliZVwiKXtcbiAgICAgIHRoaXMubWVkaWFUeXBlID0gdHlwZTtcbiAgICAgIGxvYWRJdChzb3VyY2VzW3R5cGVdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgY29uc29sZS53YXJuKFwidmlkZW8gc291cmNlcyBmb3JtYXRzIGlzIG5vdCBzdXBwb3J0ZWRcIilcblxuXG59O1xuXG5mYWJyaWMudXRpbC5fbG9hZFNWR0Zyb21VUkxfb3ZlcndyaXR0ZW4gPSBmYWJyaWMubG9hZFNWR0Zyb21VUkw7XG5mYWJyaWMubG9hZFNWR0Zyb21VUkwgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgcmV2aXZlcikge1xuICBpZiAodXJsLmluZGV4T2YoJ2RhdGEnKSAhPT0gMCAmJiB1cmwuaW5kZXhPZignOi8vJykgPT0gLTEpIHtcbiAgICB1cmwgPSBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyB1cmw7XG4gIH1cbiAgaWYgKGZhYnJpYy51dGlsLmFkZE5vQ2FjaGUgJiYgL14oaHR0cHxodHRwcylcXDpcXC9cXC8vLnRlc3QodXJsKSkge1xuICAgIHVybCArPSAnP25vLWNhY2hlPScgKyBtb21lbnQoKS5mb3JtYXQoJ3gnKTtcbiAgfVxuICBmYWJyaWMudXRpbC5fbG9hZFNWR0Zyb21VUkxfb3ZlcndyaXR0ZW4odXJsLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgaWYoZGF0YSl7XG4gICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICB9XG5cbiAgICB2YXIgeG1sID0galF1ZXJ5LnBhcnNlWE1MKGF0b2IoZmFicmljLm1lZGlhLmVycm9yLnN1YnN0cigyNikpKTtcblxuICAgIGZhYnJpYy5wYXJzZVNWR0RvY3VtZW50KHhtbC5kb2N1bWVudEVsZW1lbnQsIGZ1bmN0aW9uIChyZXN1bHRzLCBvcHRpb25zKSB7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhyZXN1bHRzLCBvcHRpb25zKTtcbiAgICB9LCByZXZpdmVyKTtcblxuICB9LCByZXZpdmVyKTtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZnJvbVVSTC5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUgPSB7XG4gIHdpZHRoOiA0MDAsXG4gIGhlaWdodDogNDAwXG59O1xuXG5mYWJyaWMudXRpbC51cGxvYWRJbWFnZU1pblNpemUgPSB7XG4gIHdpZHRoOiAxMDAsXG4gIGhlaWdodDogMTAwXG59O1xuLy9cbi8vIGZhYnJpYy51dGlsLm9uSW1hZ2VVcGxvYWQgPSBmdW5jdGlvbihpbWcsY2FsbGJhY2ssb3B0aW9ucyl7XG4vL1xuLy8gICBpZighb3B0aW9ucy5tdWx0aXBsZSl7XG4vLyAgICAgaWYgKG9wdGlvbnMuYXBpQWZ0ZXJVcGxvYWQpIHtcbi8vICAgICAgIG9wdGlvbnMuYXBpQWZ0ZXJVcGxvYWQoW3RoaXNdLCBmdW5jdGlvbiAodmFsKSB7XG4vLyAgICAgICAgIGNhbGxiYWNrKHZhbCk7XG4vLyAgICAgICB9LG9wdGlvbnMpXG4vLyAgICAgfSBlbHNlIHtcbi8vICAgICAgIGNhbGxiYWNrKHRoaXMpO1xuLy8gICAgIH1cbi8vICAgfWVsc2V7XG4vLyAgICAgY2FsbGJhY2soKTtcbi8vICAgfVxuLy8gfTtcblxuXG5mYWJyaWMudXRpbC5yZWFkSW1hZ2VGaWxlID0gZnVuY3Rpb24oZmlsZSxjYWxsYmFjayl7XG5cbiAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgIHZhciByZXN1bHQgPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgdmFyIHR5cGUgPSByZXN1bHQuc3Vic3RyKDExLCByZXN1bHQuaW5kZXhPZihcIjtcIikgLSAxMSk7XG4gICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgIGltZy50eXBlID0gdHlwZTtcbiAgICBpbWcubmFtZSA9IGZpbGUubmFtZTtcbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgY2FsbGJhY2soaW1nLGUpXG4gICAgfTtcbiAgICBpbWcuc3JjID0gcmVzdWx0O1xuICB9O1xuICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlICk7XG59O1xuXG5cbmZhYnJpYy51dGlsLmNyZWF0ZVVwbG9hZElucHV0ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNvbXBsZXRlLCBwcm9ncmVzcykge1xuXG4gIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImZpbGVcIik7XG4gIGlmKG9wdGlvbnMubXVsdGlwbGUpe1xuICAgIGlucHV0LnNldEF0dHJpYnV0ZShcIm11bHRpcGxlXCIsIG9wdGlvbnMubXVsdGlwbGUpO1xuICB9XG4gIGlucHV0LmNsYXNzTmFtZSA9IFwiaGlkZGVuXCI7XG5cbiAgJChpbnB1dCkuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICBpZihpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlcy5sZW5ndGgpe1xuICAgICAgaWYoaW5wdXQuZmlsZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGlmKCBvcHRpb25zLnVwbG9hZCl7XG4gICAgICAgICAgb3B0aW9ucy51cGxvYWQoaW5wdXQuZmlsZXNbMF0sY29tcGxldGUpXG4gICAgICAgIH1lbHNlIGlmKCBvcHRpb25zLm11bHRpVXBsb2FkICl7XG4gICAgICAgICAgb3B0aW9ucy5tdWx0aVVwbG9hZChpbnB1dC5maWxlcyxjb21wbGV0ZSk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICBpZiggb3B0aW9ucy5tdWx0aVVwbG9hZCApe1xuICAgICAgICAgIG9wdGlvbnMubXVsdGlVcGxvYWQoaW5wdXQuZmlsZXMsIGNvbXBsZXRlKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdmFyIF9sb2FkZXIgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoaW5wdXQuZmlsZXMubGVuZ3RoLGZ1bmN0aW9uKGxvYWRlZCl7XG4gICAgICAgICAgICBjb21wbGV0ZShsb2FkZWQpO1xuICAgICAgICAgIH0sZnVuY3Rpb24odG90YWwsIGN1cnJlbnQsIGltYWdlKXtcbiAgICAgICAgICAgIHByb2dyZXNzICYmIHByb2dyZXNzKHRvdGFsLCBjdXJyZW50LCBpbWFnZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZm9yKHZhciBpPSAwIDtpIDwgaW5wdXQuZmlsZXMubGVuZ3RoOyBpKysgKXtcbiAgICAgICAgICAgIG9wdGlvbnMudXBsb2FkKGlucHV0LmZpbGVzW2ldLF9sb2FkZXIpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gIH0pO1xuXG4gIGZhYnJpYy51dGlsLnVwbG9hZElucHV0ID0gaW5wdXQ7XG59O1xuXG5cbi8vZmFicmljLnV0aWwucmVzaXplSW1hZ2UoaW1nLCBjYWxsYmFjayk7XG4vLyBmYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IgPSBmdW5jdGlvbihpbWcsIGNhbGxiYWNrKSB7XG4vLyAgIGFwcC5hcGkudXBsb2FkKHtcbi8vICAgICBpbWFnZTogaW1nXG4vLyAgIH0sIGNhbGxiYWNrKVxuLy8gfVxuXG5cbmZhYnJpYy51dGlsLnVwbG9hZEltYWdlID0gZnVuY3Rpb24gKG9wdGlvbnMsY2IscHJvZ3Jlc3MpIHtcbiAgZmFicmljLnV0aWwuY3JlYXRlVXBsb2FkSW5wdXQob3B0aW9ucyxjYixwcm9ncmVzcyk7XG4gICQoZmFicmljLnV0aWwudXBsb2FkSW5wdXQpLnRyaWdnZXIoJ2NsaWNrJyk7XG59O1xuXG5cbmZhYnJpYy51dGlsLnJlc2l6ZVVwbG9hZGVkSW1hZ2UgPSBmdW5jdGlvbiAoaW1nLCBjYWxsYmFjaykge1xuXG4gIGlmIChpbWcudHlwZSA9PT0gXCJzdmcreG1sXCIpIHtcbiAgICBjYWxsYmFjayhpbWcpO1xuICAgIHJldHVybjtcbiAgfVxuICAvL0hlcmUgd2UgY2FuIHB1dCBhIHJlc3RyaWN0aW9uIHRvIHVwbG9hZCBhIG1pbmltIHNpemVkIGxvZ29cbiAgaWYgKGltZy53aWR0aCA8IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS53aWR0aCB8fCBpbWcuaGVpZ2h0IDwgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLmhlaWdodCkge1xuICAgIGFsZXJ0KFwiTG9nbyBpcyB0b28gc21hbGwuIE1JbmltdW0gc2l6ZSBpcyBcIiArIGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS53aWR0aCArIFwieFwiICsgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLmhlaWdodCk7XG4gICAgY2FsbGJhY2soZmFsc2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChpbWcud2lkdGggPiBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUud2lkdGggfHwgaW1nLmhlaWdodCA+IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWF4U2l6ZS5oZWlnaHQpIHtcblxuICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoaW1nLCBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUsIFwiZml0XCIpO1xuXG4gICAgdmFyIGZpbHRlciA9IG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZXNpemVEUCgpO1xuXG4gICAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZShpbWcpO1xuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgICBmaWx0ZXIuYXBwbHlUbyhjYW52YXMsIHNpemUud2lkdGgsIHNpemUuaGVpZ2h0KTtcbiAgICBjYWxsYmFjayhjYW52YXMpO1xuICB9IGVsc2Uge1xuICAgIGNhbGxiYWNrKGltZyk7XG4gIH1cbn07XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSx7XG4gIHVwbG9hZENsYXNzOiAnaW1hZ2UnLFxuICBtdWx0aXBsZVVwbG9hZDogZmFsc2UsXG4gIHVwbG9hZEltYWdlOiBmdW5jdGlvbiAob3B0aW9ucyl7XG5cbiAgICBsZXQgX2FwaSA9IHRoaXMuYXBwbGljYXRpb24udXBsb2FkZXIgfHwge307XG5cbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICB1cGxvYWQ6IF9hcGkudXBsb2FkLFxuICAgICAgYWZ0ZXJVcGxvYWQ6IF9hcGkuY2FsbGJhY2ssXG4gICAgICB2YWxpZGF0aW9uOiBfYXBpLnZhbGlkYXRpb24sXG4gICAgICBkYXRhOiBmYWxzZSxcbiAgICAgIG11bHRpcGxlOiBfYXBpLm11bHRpcGxlLFxuICAgICAgbXVsdGlVcGxvYWQ6IF9hcGkubXVsdGlwbGVVcGxvYWRcbiAgICB9LG9wdGlvbnMpO1xuXG4gICAgb3B0aW9ucy5hZnRlclVwbG9hZCA9IG9wdGlvbnMuYWZ0ZXJVcGxvYWQgJiYgb3B0aW9ucy5hZnRlclVwbG9hZC5iaW5kKHRoaXMuYXBwbGljYXRpb24sIHRoaXMsIG9wdGlvbnMuZGF0YSkgfHwgZnVuY3Rpb24gKGNhbnZhcywgZGF0YSwgaW1hZ2UsIGV2ZW50KSB7XG4gICAgICAvLyB0aGlzLmFwcGxpY2F0aW9uLmZpcmUoXCJpbWFnZTp1cGxvYWRcIix7aW1hZ2U6IGltZywgY2FudmFzOiB0aGlzfSk7XG4gICAgICAvLyBfYXBpLmFmdGVyVXBsb2FkICYmIF9hcGkuYWZ0ZXJVcGxvYWQoe2ltYWdlOiBpbWcsIGNhbnZhczogdGhpcyxldmVudDp9KTtcbiAgICAgIHRoaXMuY3JlYXRlSW1hZ2VPYmplY3QoaW1hZ2UpO1xuICAgIH0uYmluZCh0aGlzKTtcblxuICAgIG9wdGlvbnMudXBsb2FkID0gb3B0aW9ucy51cGxvYWQgJiYgb3B0aW9ucy51cGxvYWQuYmluZCh0aGlzLmFwcGxpY2F0aW9uKSB8fCBmdW5jdGlvbiAoZmlsZSwgY2FsbGJhY2spIHtcbiAgICAgIGlmIChvcHRpb25zLnZhbGlkYXRpb24gJiYgb3B0aW9ucy52YWxpZGF0aW9uLmNhbGwodGhpcywgZmlsZSwgb3B0aW9ucy5kYXRhKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKClcbiAgICAgIH1cbiAgICAgIGZhYnJpYy51dGlsLnJlYWRJbWFnZUZpbGUoZmlsZSwgKGltZywgZXZlbnQpID0+IHtcbiAgICAgICAgb3B0aW9ucy5hZnRlclVwbG9hZCggaW1nLCBldmVudCk7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9KTtcbiAgICB9LmJpbmQodGhpcy5hcHBsaWNhdGlvbik7XG5cbiAgICBmYWJyaWMudXRpbC51cGxvYWRJbWFnZSh7XG4gICAgICBtdWx0aXBsZTogX2FwaS5tdWx0aXBsZSxcbiAgICAgIGFwaUFmdGVyVXBsb2FkOiBvcHRpb25zLmFmdGVyVXBsb2FkLFxuICAgICAgbXVsdGlVcGxvYWQ6IG9wdGlvbnMubXVsdGlVcGxvYWQgJiYgb3B0aW9ucy5tdWx0aVVwbG9hZC5iaW5kKHRoaXMuYXBwbGljYXRpb24pLFxuICAgICAgdXBsb2FkOiBvcHRpb25zLnVwbG9hZFxuICAgIH0sIGZ1bmN0aW9uICgpIHtcblxuICAgIH0pXG4gIH0sXG4gIGNyZWF0ZUltYWdlT2JqZWN0OiBmdW5jdGlvbiAoaW1nICkge1xuICAgIGlmICghaW1nKXJldHVybjtcblxuICAgIHRoaXMuY3JlYXRlT2JqZWN0KHtcbiAgICAgIHBvc2l0aW9uOiBcImNlbnRlclwiLFxuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgICAgdHlwZTogdGhpcy51cGxvYWRDbGFzcyxcbiAgICAgIGltYWdlOiBpbWcsXG4gICAgICB3aWR0aDogaW1nLndpZHRoLFxuICAgICAgaGVpZ2h0OiBpbWcuaGVpZ2h0LFxuICAgICAgY2xpcFRvOiB0aGlzLmFjdGl2ZUFyZWEsXG4gICAgICBtb3ZlbWVudExpbWl0czogdGhpcy5hY3RpdmVBcmVhXG4gICAgfSxlbCA9PiB0aGlzLmZpdE9iamVjdChlbCkpO1xuXG4gIH0sXG4gIGFjdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucyx7XG4gICAgdXBsb2FkSW1hZ2U6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS11cGxvYWQnLFxuICAgICAga2V5OiAndScsXG4gICAgICB0aXRsZTogJ3VwbG9hZCBpbWFnZScsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy51cGxvYWRJbWFnZSh7ZGF0YTogXCJkZWZhdWx0XCJ9KTtcbiAgICAgICAgICAvLyB0aGlzLmFwcGxpY2F0aW9uLmFwaS51cGxvYWQsXG4gICAgICAgICAgLy8gdGhpcy5hcHBsaWNhdGlvbi5hcGkuYWZ0ZXJVcGxvYWQsXG4gICAgICAgICAgLy8gdGhpcy5hcHBsaWNhdGlvbi5hcGkudXBsb2FkVmFsaWRhdGlvbilcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy91cGxvYWQuanMiLCJcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuRWRpdG9yLnByb3RvdHlwZSx7XG4gIHNldEluc3RhZ3JhbTogZnVuY3Rpb24oZGF0YSl7XG4gICAgdGhpcy5pbnN0YWdyYW0gPSBkYXRhO1xuICAgIHRoaXMuaW5zdGFncmFtLmFwaSA9IG5ldyBJbnN0YWdyYW1BcGkodGhpcy5pbnN0YWdyYW0uY2xpZW50SUQsIHRoaXMuaW5zdGFncmFtLnJlZGlyZWN0VVJJKTtcbiAgfSxcbiAgaW5zdGFncmFtQXV0aDogZnVuY3Rpb24oY2Ipe1xuICAgIGlmKHRoaXMuaW5zdGFncmFtLmFjY2Vzc1Rva2VuKXtcbiAgICAgIHJldHVybiBjYi5jYWxsKHRoaXMpXG4gICAgfVxuXG4gICAgdmFyIGF1dGhVcmwgPSB0aGlzLmluc3RhZ3JhbS5hcGkuZ2V0QXV0aFVybCgpO1xuICAgIC8vdGhlIHBvcC11cCB3aW5kb3cgc2l6ZSwgY2hhbmdlIGlmIHlvdSB3YW50XG4gICAgdmFyIHBvcHVwV2lkdGggPSA3MDAsXG4gICAgICBwb3B1cEhlaWdodCA9IDUwMCxcbiAgICAgIHBvcHVwTGVmdCA9ICh3aW5kb3cuc2NyZWVuLndpZHRoIC0gcG9wdXBXaWR0aCkgLyAyLFxuICAgICAgcG9wdXBUb3AgPSAod2luZG93LnNjcmVlbi5oZWlnaHQgLSBwb3B1cEhlaWdodCkgLyAyO1xuXG4gICAgLy90aGUgdXJsIG5lZWRzIHRvIHBvaW50IHRvIGluc3RhZ3JhbV9hdXRoLnBocFxuICAgIHZhciBwb3B1cCA9IHdpbmRvdy5vcGVuKGF1dGhVcmwsICcnLCAnd2lkdGg9Jytwb3B1cFdpZHRoKycsaGVpZ2h0PScrcG9wdXBIZWlnaHQrJyxsZWZ0PScrcG9wdXBMZWZ0KycsdG9wPScrcG9wdXBUb3ArJycpO1xuXG4gICAgcG9wdXAub25sb2FkID0gKCkgPT4ge1xuLy9hbiBpbnRlcnZhbCBydW5zIHRvIGdldCB0aGUgYWNjZXNzIHRva2VuIGZyb20gdGhlIHBvcC11cFxuICAgICAgdmFyIGludGVydmFsID0gc2V0SW50ZXJ2YWwoICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvL2NoZWNrIGlmIGhhc2ggZXhpc3RzXG4gICAgICAgICAgaWYgKHBvcHVwLmxvY2F0aW9uLmhhc2gubGVuZ3RoKSB7XG4gICAgICAgICAgICAvL2hhc2ggZm91bmQsIHRoYXQgaW5jbHVkZXMgdGhlIGFjY2VzcyB0b2tlblxuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgICAgICB0aGlzLmluc3RhZ3JhbS5hY2Nlc3NUb2tlbiA9IHBvcHVwLmxvY2F0aW9uLmhhc2guc2xpY2UoMTQpOyAvL3NsaWNlICNhY2Nlc3NfdG9rZW49IGZyb20gc3RyaW5nXG4gICAgICAgICAgICBwb3B1cC5jbG9zZSgpO1xuICAgICAgICAgICAgY2IodGhpcy5pbnN0YWdyYW0uYWNjZXNzVG9rZW4pXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChldnQpIHtcbiAgICAgICAgICAvL3Blcm1pc3Npb24gZGVuaWVkXG4gICAgICAgIH1cbiAgICAgIH0sIDEwMCk7XG4gICAgfVxuICB9LFxuICBnZXRJbnN0YWdyYW1NZWRpYTogZnVuY3Rpb24oY2FsbGJhY2spe1xuICAgIHRoaXMuaW5zdGFncmFtQXV0aCgoKSA9PiB7XG4gICAgICB0aGlzLmluc3RhZ3JhbS5hcGkudXNlci5tZWRpYSgnc2VsZicsIHRoaXMuaW5zdGFncmFtLmFjY2Vzc1Rva2VuLCBkYXRhID0+IHtcbiAgICAgICAgY2FsbGJhY2soZGF0YS5kYXRhKTtcbiAgICAgICAgLy8gdmFyIGltYWdlcyA9IF8ucGx1Y2soZGF0YS5kYXRhLFwiaW1hZ2VzXCIpO1xuICAgICAgICAvLyB2YXIgdGh1bWJuYWlscyA9IF8ucGx1Y2soaW1hZ2VzLFwidGh1bWJuYWlsXCIpO1xuICAgICAgICAvLyB2YXIgdGh1bWJuYWlsc191cmxzID0gXy5wbHVjayh0aHVtYm5haWxzLFwidXJsXCIpO1xuICAgICAgICAvL1xuICAgICAgICAvLyBjb25zb2xlLmxvZyh0aHVtYm5haWxzX3VybHMpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLHtcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5hY3Rpb25zLHtcbiAgICBpbnN0YWdyYW06IHtcbiAgICAgIGNsYXNzTmFtZTogXCJmYSBmYS1pbnN0YWdyYW1cIixcbiAgICAgIHR5cGU6ICdlZmZlY3QnLFxuICAgICAgdGl0bGU6IFwiaW5zdGFncmFtXCIsXG4gICAgICBlZmZlY3RDbGFzc05hbWU6IFwiaW5zdGFncmFtLWNvbnRhaW5lclwiLFxuICAgICAgYWN0aW9uUGFyYW1ldGVyczogZnVuY3Rpb24gKCRlbCwgZGF0YSkge1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLmdldEluc3RhZ3JhbU1lZGlhKGRhdGEgPT4ge1xuXG5cbiAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLmNyZWF0ZUdhbGxlcnkoJGVsLGZhYnJpYy51dGlsLm9iamVjdC5tYXAoZGF0YSxlbCA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB0eXBlOiBcImltYWdlXCIsXG4gICAgICAgICAgICAgIHNyYzogZWwuaW1hZ2VzLnRodW1ibmFpbC51cmwsXG4gICAgICAgICAgICAgIHRpdGxlOiBlbC5jYXB0aW9uICYmIGVsLmNhcHRpb24udGV4dFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKVxuXG5cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9KVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvaW5zdGFncmFtLmpzIiwiXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkVkaXRvci5wcm90b3R5cGUse1xuICBzZXRGYWNlYm9vazogZnVuY3Rpb24oZGF0YSl7XG4gICAgdGhpcy5mYWNlYm9vayA9IGRhdGE7XG5cbiAgICAoZnVuY3Rpb24oZCwgcywgaWQpe1xuICAgICAgdmFyIGpzLCBmanMgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKHMpWzBdO1xuICAgICAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7cmV0dXJuO31cbiAgICAgIGpzID0gZC5jcmVhdGVFbGVtZW50KHMpOyBqcy5pZCA9IGlkO1xuICAgICAganMuc3JjID0gXCJodHRwczovL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL3Nkay5qc1wiO1xuICAgICAgZmpzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGpzLCBmanMpO1xuXG5cbiAgICB9KGRvY3VtZW50LCAnc2NyaXB0JywgJ2ZhY2Vib29rLWpzc2RrJykpO1xuXG5cbiAgfSxcbiAgZmFjZWJvb2tBdXRoOiBmdW5jdGlvbihjYil7XG5cblxuICAgIEZCLmluaXQoe1xuICAgICAgYXBwSWQgICAgICA6IHRoaXMuZmFjZWJvb2suYXBwSWQsXG4gICAgICBjb29raWUgICAgIDogdHJ1ZSwgIC8vIGVuYWJsZSBjb29raWVzIHRvIGFsbG93IHRoZSBzZXJ2ZXIgdG8gYWNjZXNzIHRoZSBzZXNzaW9uXG4gICAgICB4ZmJtbCAgICAgIDogdHJ1ZSwgIC8vIHBhcnNlIHNvY2lhbCBwbHVnaW5zIG9uIHRoaXMgcGFnZVxuICAgICAgdmVyc2lvbiAgICA6ICd2Mi45JyAvLyB1c2UgZ3JhcGggYXBpIHZlcnNpb24gMi44XG4gICAgfSk7XG4gICAgRkIuQXBwRXZlbnRzLmxvZ1BhZ2VWaWV3KCk7XG5cblxuICAgIEZCLmdldExvZ2luU3RhdHVzKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgIC8qKlxuICAgICAgICoge1xuICAgIHN0YXR1czogJ2Nvbm5lY3RlZCcsXG4gICAgYXV0aFJlc3BvbnNlOiB7XG4gICAgICAgIGFjY2Vzc1Rva2VuOiAnLi4uJyxcbiAgICAgICAgZXhwaXJlc0luOicuLi4nLFxuICAgICAgICBzaWduZWRSZXF1ZXN0OicuLi4nLFxuICAgICAgICB1c2VySUQ6Jy4uLidcbiAgICB9XG59XG4gICAgICAgKi9cbiAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgIC8vIHN0YXR1c0NoYW5nZUNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICB9KTtcbiAgICAvL1xuICAgIC8vIGlmKHRoaXMuZmFjZWJvb2suYWNjZXNzVG9rZW4pe1xuICAgIC8vICAgcmV0dXJuIGNiLmNhbGwodGhpcylcbiAgICAvLyB9XG4gIH0sXG4gIGdldEZhY2Vib29rTWVkaWE6IGZ1bmN0aW9uKGNhbGxiYWNrKXtcbiAgICB0aGlzLmZhY2Vib29rQXV0aCgoKSA9PiB7XG4gICAgICB0aGlzLmZhY2Vib29rLmFwaS51c2VyLm1lZGlhKCdzZWxmJywgdGhpcy5mYWNlYm9vay5hY2Nlc3NUb2tlbiwgZGF0YSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKGRhdGEuZGF0YSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUse1xuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLmFjdGlvbnMse1xuICAgIGZhY2Vib29rOiB7XG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtZmFjZWJvb2tcIixcbiAgICAgIHR5cGU6ICdlZmZlY3QnLFxuICAgICAgdGl0bGU6IFwiZmFjZWJvb2tcIixcbiAgICAgIGVmZmVjdENsYXNzTmFtZTogXCJmYWNlYm9vay1jb250YWluZXJcIixcbiAgICAgIGFjdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uICgkZWwsIGRhdGEpIHtcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi5nZXRGYWNlYm9va01lZGlhKGRhdGEgPT4ge1xuXG4gICAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi5jcmVhdGVFbGVtZW50c0xpc3QoJGVsLGZhYnJpYy51dGlsLm9iamVjdC5tYXAoZGF0YSxlbCA9PiB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICB0eXBlOiBcImltYWdlXCIsXG4gICAgICAgICAgICAgIHNyYzogZWwuaW1hZ2VzLnRodW1ibmFpbC51cmwsXG4gICAgICAgICAgICAgIHRpdGxlOiBlbC5jYXB0aW9uICYmIGVsLmNhcHRpb24udGV4dFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9mYWNlYm9vay5qcyIsIid1c2Ugc3RyaWN0JztcbnJlcXVpcmUoJy4vLi4vbW9kdWxlcy9jYW52YXMuZXZlbnRzJyk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgc2V0RHJvcHBhYmxlOiBmdW5jdGlvbih2YWwpe1xuICAgIGlmKCF0aGlzLmRyb3BwYWJsZSAmJiB2YWwpe1xuICAgICAgdGhpcy5kcm9wcGFibGUgPSB0cnVlO1xuICAgICAgdGhpcy5pbml0RHJhZ0FuZERyb3AoKTtcbiAgICB9XG4gIH0sXG4gIGFjY2VwdHM6IHt9LFxuICBkcm9wcGFibGU6IGZhbHNlLCAvL3t9XG4gIGlzQWNjZXB0czogZnVuY3Rpb24gKGFjY2VwdHMsIGRhdGEpIHtcblxuICAgIGZvciAodmFyIGkgaW4gYWNjZXB0cykge1xuICAgICAgaWYgKGFjY2VwdHNbaV0uY29uc3RydWN0b3IgPT0gQXJyYXkpIHtcbiAgICAgICAgaWYgKGFjY2VwdHNbaV0uaW5kZXhPZihkYXRhW2ldKSA9PSAtMSlyZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZihhY2NlcHRzW2ldID09IFwiKlwiKWNvbnRpbnVlO1xuICAgICAgICBpZiAoYWNjZXB0c1tpXSAhPSBkYXRhW2ldKSByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICAgIC8vcmV0dXJuICh0aGlzLnN1cHBvcnRlZFR5cGVzID09IFwiKlwiIHx8IHRoaXMuc3VwcG9ydGVkVHlwZXMuaW5kZXhPZih0eXBlKSE9IC0xKVxuICB9LFxuICBkcm9wOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcblxuICB9LFxuICBpbml0RHJhZ0FuZERyb3A6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm9uKFwibW91c2U6ZHJvcFwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgbGV0IF94ID0gKGUueCAtIGUub2Zmc2V0WCksXG4gICAgICAgIF95ID0gKGUueSAtIGUub2Zmc2V0WSksXG4gICAgICAgIF93ID0gZS53aWR0aCwgIC8vIChlLmRhdGEud2lkdGggfHwgZS53aWR0aCAgKTtcbiAgICAgICAgX2ggPSBlLmhlaWdodDsgLy8oZS5kYXRhLmhlaWdodCB8fCBlLmhlaWdodCApO1xuXG4gICAgICBpZiAoZS5kYXRhLnNjYWxlWCkge1xuICAgICAgICB2YXIgX3NjYWxlWCA9IGUuZGF0YS5zY2FsZVggLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfc2NhbGVYID0gMTtcbiAgICAgICAgX3cgLz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXVxuICAgICAgfVxuXG4gICAgICBpZiAoZS5kYXRhLnNjYWxlWSkge1xuICAgICAgICB2YXIgX3NjYWxlWSA9IGUuZGF0YS5zY2FsZVkgLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3NjYWxlWSA9IDE7XG4gICAgICAgIF9oIC89IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM11cbiAgICAgIH1cblxuICAgICAgdmFyIF9zdHJva2UgPSBlLmRhdGEuc3Ryb2tlV2lkdGggfHwgMDtcbiAgICAgIGlmIChlLmRhdGEubGVmdCkge1xuICAgICAgICBfeCArPSAoZS5kYXRhLmxlZnQgKyBfc3Ryb2tlKSAvIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgICB9XG4gICAgICBpZiAoZS5kYXRhLnRvcCkge1xuICAgICAgICBfeSArPSAoZS5kYXRhLnRvcCArIF9zdHJva2UpIC8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVszXTtcbiAgICAgIH1cblxuXG4gICAgICBlLmRhdGEgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBlLmRhdGEsIHtcbiAgICAgICAgc2NhbGVYOiBfc2NhbGVYLFxuICAgICAgICBzY2FsZVk6IF9zY2FsZVksXG4gICAgICAgIGxlZnQ6IF94LFxuICAgICAgICB0b3A6IF95LFxuICAgICAgICB3aWR0aDogX3csXG4gICAgICAgIGhlaWdodDogX2gsXG4gICAgICAgIG9yaWdpbmFsV2lkdGg6IGUuZGF0YS53aWR0aCxcbiAgICAgICAgb3JpZ2luYWxIZWlnaHQ6IGUuZGF0YS5oZWlnaHRcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLmZpcmUoXCJiZWZvcmU6ZHJvcFwiLGUpO1xuXG4gICAgICBlLnRhcmdldCA9IHRoaXMuZmluZFRhcmdldChlLm9yaWdpbmFsRXZlbnQpO1xuICAgICAgaWYgKGUudGFyZ2V0ICYmICF0aGlzLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIGNsaWNrIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgICBlLnRhcmdldC5maXJlKCdvYmplY3Q6ZHJvcCcsIGUpO1xuICAgICAgfVxuXG5cbiAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5hY2NlcHRzKSB7XG4gICAgICAgIGlmICh0aGlzLmlzQWNjZXB0cyhlLnRhcmdldC5hY2NlcHRzLCBlLmRhdGEpKSB7XG4gICAgICAgICAgZS50YXJnZXQuZGVhY3RpdmF0ZSgpO1xuICAgICAgICAgIGUudGFyZ2V0LnNldERhdGEoZS5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuaXNBY2NlcHRzKHRoaXMuYWNjZXB0cywgZS5kYXRhKSkge1xuICAgICAgICAgIHRoaXMuc2V0RGF0YShlLmRhdGEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5vbihcIm1vdXNlOmRyYWdlbnRlclwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmFjY2VwdHMpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNBY2NlcHRzKGUudGFyZ2V0LmFjY2VwdHMsIGUuZGF0YSkpIHtcbiAgICAgICAgICBlLnRhcmdldC5hY3RpdmF0ZSgpO1xuICAgICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwiYWxpYXNcIik7XG4gICAgICAgICAgdGhpcy5zZXRDdXJzb3IoXCJhbGlhc1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlLmUuaGVscGVyLmNzcyhcImN1cnNvclwiLCBcIm5vdC1hbGxvd2VkXCIpO1xuICAgICAgICAgIHRoaXMuc2V0Q3Vyc29yKFwibm90LWFsbG93ZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm9uKFwibW91c2U6ZHJhZ2xlYXZlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuYWNjZXB0cykge1xuICAgICAgICBpZiAodGhpcy5pc0FjY2VwdHMoZS50YXJnZXQuYWNjZXB0cywgZS5kYXRhKSkge1xuICAgICAgICAgIHRoaXMuX2FjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICAgIGUudGFyZ2V0LmRlYWN0aXZhdGUoKVxuICAgICAgICB9XG4gICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZHJvcHBhYmxlLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbnZhciBfYmluZEV2ZW50cyA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9iaW5kRXZlbnRzO1xudmFyIF9vbk1vdXNlRG93bl9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9vbk1vdXNlRG93bjtcbnZhciBfb25Nb3VzZVVwX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VVcDtcbnZhciBfaW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2luaXRFdmVudExpc3RlbmVycztcbnZhciByZW1vdmVMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcnM7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgdGFwaG9sZFRocmVzaG9sZDogMjAwMCxcbiAgX2JpbmRFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICBfYmluZEV2ZW50cy5jYWxsKHRoaXMpO1xuICAgIHRoaXMuX29uQ2xpY2sgPSB0aGlzLl9vbkNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25Eb3VibGVDbGljayA9IHRoaXMuX29uRG91YmxlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vblRhcEhvbGQgPSB0aGlzLl9vblRhcEhvbGQuYmluZCh0aGlzKTtcbiAgfSxcblxuICBfb25Eb3VibGVDbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgnbW91c2U6ZGJsY2xpY2snLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIGNsaWNrIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgdGFyZ2V0LmZpcmUoJ2RibGNsaWNrJywge1xuICAgICAgICBlOiBlXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX29uRHJvcDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgX3pvb20gPSB0aGlzLmdldFpvb20oKTtcbiAgICBlLnggLz0gX3pvb207XG4gICAgZS55IC89IF96b29tO1xuICAgIGUub2Zmc2V0WCAvPSBfem9vbTtcbiAgICBlLm9mZnNldFkgLz0gX3pvb207XG4gICAgZS53aWR0aCA9IGUuaGVscGVyLndpZHRoKCkgLyBfem9vbTtcbiAgICBlLmhlaWdodCA9IGUuaGVscGVyLmhlaWdodCgpIC8gX3pvb207XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdGhpcy5maXJlKCdtb3VzZTpkcm9wJywgZSk7XG5cbiAgfSxcblxuICBfb25EcmFnTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUub3JpZ2luYWxFdmVudCk7XG4gICAgc2VsZi5maXJlKCdtb3VzZTpkcmFnbW92ZScsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZSxcbiAgICAgIGRhdGE6IGUuZGF0YVxuICAgIH0pO1xuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIGNsaWNrIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpkcmFnbW92ZScsIHtcbiAgICAgICAgZTogZSxcbiAgICAgICAgZGF0YTogZS5kYXRhXG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX2xhc3RfdGFyZ2V0ID09IHRhcmdldClyZXR1cm47XG4gICAgaWYgKHRoaXMuX2xhc3RfdGFyZ2V0KSB7XG4gICAgICBzZWxmLmZpcmUoJ21vdXNlOmRyYWdsZWF2ZScsIHtcbiAgICAgICAgdGFyZ2V0OiB0aGlzLl9sYXN0X3RhcmdldCxcbiAgICAgICAgZTogZSxcbiAgICAgICAgZGF0YTogZS5kYXRhXG4gICAgICB9KTtcbiAgICAgIHRoaXMuX2xhc3RfdGFyZ2V0LmZpcmUoJ29iamVjdDpkcmFnbGVhdmUnLCB7XG4gICAgICAgIGU6IGUsXG4gICAgICAgIGRhdGE6IGUuZGF0YVxuICAgICAgfSk7XG4gICAgICB0aGlzLl9sYXN0X3RhcmdldCA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAodGFyZ2V0KSB7XG5cbiAgICAgIHNlbGYuZmlyZSgnbW91c2U6ZHJhZ2VudGVyJywge1xuICAgICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgICAgZTogZSxcbiAgICAgICAgZGF0YTogZS5kYXRhXG4gICAgICB9KTtcbiAgICAgIHRhcmdldC5maXJlKCdvYmplY3Q6ZHJhZ2VudGVyJywge1xuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9sYXN0X3RhcmdldCA9IHRhcmdldDtcbiAgICB9XG5cbiAgfSxcblxuICBfb25DbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgnbW91c2U6Y2xpY2snLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIHZhciBlMSA9IHRoaXMuX21vdXNlRG93bkNvb3JkaW5hdGVzRXZlbnQ7XG4gICAgZGVsZXRlIHRoaXMuX21vdXNlRG93bkNvb3JkaW5hdGVzRXZlbnQ7XG5cbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIC8vZmFicmljMi4xLjAgfHwgZmFicmljIDEuNi40XG4gICAgICAvLyB2YXIgc3RhdGVzID0gdGFyZ2V0Ll9zdGF0ZVByb3BlcnRpZXMgfHwgdGFyZ2V0Lm9yaWdpbmFsU3RhdGU7XG5cbiAgICAgIGlmKGUxICYmIGUxLnggPT09IGUueCAmJiBlMS55ID09PSBlLnkpe1xuICAgICAgICAvLyAvLyB0YXJnZXQuX3N0YXRlUHJvcGVydGllcy5hbmdsZSA9PSB0YXJnZXQuYW5nbGVcbiAgICAgICAgLy8gc3RhdGVzLmxlZnQgPT0gdGFyZ2V0LmxlZnQgJiZcbiAgICAgICAgLy8gc3RhdGVzLnRvcCA9PSB0YXJnZXQudG9wICYmXG4gICAgICAgIC8vIHN0YXRlcy5zY2FsZVggPT0gdGFyZ2V0LnNjYWxlWCAmJlxuICAgICAgICAvLyBzdGF0ZXMuc2NhbGVZID09IHRhcmdldC5zY2FsZVkgJiZcbiAgICAgICAgLy8gc3RhdGVzLmFuZ2xlID09IHRhcmdldC5hbmdsZVxuICAgICAgLy8gKSB7XG4gICAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIGRvdWJsZSBjbGljayBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpjbGljaycsIHtcbiAgICAgICAgICBlOiBlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBfb25UYXBIb2xkOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCd0b3VjaDp0YXBob2xkJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlXG4gICAgfSk7XG5cbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIHRhcCBob2xkIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgdGFyZ2V0LmZpcmUoJ3RhcGhvbGQnLCB7XG4gICAgICAgIGU6IGVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaGVuZCcgJiYgc2VsZi50b3VjaFN0YXJ0VGltZXIgIT0gbnVsbCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHNlbGYudG91Y2hTdGFydFRpbWVyKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uTW91c2VEb3duOiBmdW5jdGlvbiAoZSkge1xuICAgIF9vbk1vdXNlRG93bl9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG4gICAgdGhpcy5fbW91c2VEb3duQ29vcmRpbmF0ZXNFdmVudCA9IGU7XG5cblxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgdmFyIHRvdWNoU3RhcnRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLl9vblRhcEhvbGQoZSk7XG4gICAgICAgIHNlbGYuaXNMb25nVGFwID0gdHJ1ZTtcbiAgICAgIH0sIHNlbGYudGFwaG9sZFRocmVzaG9sZCk7XG4gICAgICBzZWxmLnRvdWNoU3RhcnRUaW1lciA9IHRvdWNoU3RhcnRUaW1lcjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBZGQgcmlnaHQgY2xpY2sgc3VwcG9ydFxuICAgIGlmIChlLndoaWNoID09PSAzKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpO1xuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkb3duJywge3RhcmdldDogdGFyZ2V0LCBlOiBlfSk7XG4gICAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgbW91c2UgZG93biBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgICAgdGFyZ2V0LmZpcmUoJ21vdXNlZG93bicsIHtcbiAgICAgICAgICBlOiBlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgX29uTW91c2VVcF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG5cbiAgICBpZiAoZS50eXBlID09PSAndG91Y2hlbmQnKSB7XG4gICAgICAvLyBQcm9jZXNzIHRhcCBob2xkLlxuICAgICAgaWYgKHRoaXMudG91Y2hTdGFydFRpbWVyICE9IG51bGwpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudG91Y2hTdGFydFRpbWVyKTtcbiAgICAgIH1cbiAgICAgIC8vIFByb2Nlc3MgbG9uZyB0YXAuXG4gICAgICBpZiAodGhpcy5pc0xvbmdUYXApIHtcbiAgICAgICAgdGhpcy5fb25Mb25nVGFwRW5kKGUpO1xuICAgICAgICB0aGlzLmlzTG9uZ1RhcCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgLy8gUHJvY2VzcyBkb3VibGUgY2xpY2tcbiAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgIHZhciBsYXN0VG91Y2ggPSB0aGlzLmxhc3RUb3VjaCB8fCBub3cgKyAxO1xuICAgICAgdmFyIGRlbHRhID0gbm93IC0gbGFzdFRvdWNoO1xuICAgICAgaWYgKGRlbHRhIDwgMzAwICYmIGRlbHRhID4gMCkge1xuICAgICAgICAvLyBBZnRlciB3ZSBkZXRjdCBhIGRvdWJsZXRhcCwgc3RhcnQgb3ZlclxuICAgICAgICB0aGlzLmxhc3RUb3VjaCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5fb25Eb3VibGVUYXAoZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxhc3RUb3VjaCA9IG5vdztcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX29uRG91YmxlVGFwOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCd0b3VjaDpkb3VibGV0YXAnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIHRhcCBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgIHRhcmdldC5maXJlKCdvYmplY3Q6ZG91YmxldGFwJywge1xuICAgICAgICBlOiBlXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX29uTG9uZ1RhcEVuZDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgndG91Y2g6bG9uZ3RhcGVuZCcsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBsb25nIHRhcCBlbmQgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0Omxvbmd0YXBlbmQnLCB7XG4gICAgICAgIGU6IGVcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfaW5pdEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIF9pbml0RXZlbnRMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4uY2FsbChzZWxmKTtcblxuICAgIGZhYnJpYy51dGlsLmFkZExpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2NsaWNrJywgc2VsZi5fb25DbGljayk7XG4gICAgZmFicmljLnV0aWwuYWRkTGlzdGVuZXIoc2VsZi51cHBlckNhbnZhc0VsLCAnZGJsY2xpY2snLCBzZWxmLl9vbkRvdWJsZUNsaWNrKTtcblxuICAgIHNlbGYub24oJ29iamVjdDpzY2FsaW5nJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5fc2NhbGluZ19ldmVudHNfZW5hYmxlZCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwic2NhbGluZ1wiLCBlLmUpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYub24oJ29iamVjdDpzZWxlY3RlZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQpIHtcbiAgICAgICAgZS50YXJnZXQuZmlyZShcIm9iamVjdDpzZWxlY3RlZFwiLCBlLmUpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYub24oJ21vdXNlOm92ZXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICAgIGUudGFyZ2V0LmZpcmUoXCJtb3VzZTpvdmVyXCIsIGUuZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzZWxmLm9uKCdtb3VzZTpvdXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICAgIGUudGFyZ2V0LmZpcmUoXCJtb3VzZTpvdXRcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9LFxuXG4gIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICByZW1vdmVMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4uY2FsbChzZWxmKTtcblxuXG4gICAgZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIoc2VsZi51cHBlckNhbnZhc0VsLCAnY2xpY2snLCBzZWxmLl9vbkNsaWNrKTtcbiAgICBmYWJyaWMudXRpbC5yZW1vdmVMaXN0ZW5lcihzZWxmLnVwcGVyQ2FudmFzRWwsICdkYmxjbGljaycsIHNlbGYuX29uRG91YmxlQ2xpY2spO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9jYW52YXMuZXZlbnRzLmpzIiwiXG5yZXF1aXJlKFwiLi9jbGlwVG9cIik7XG5cbi8qKlxuICogQ3JvcHBpbmcgZG8gbm90IHN1cHBvcnQgc2tld1ggYW5kIHNrZXdZXG4gKi9cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkltYWdlLnByb3RvdHlwZSwge1xuICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJjcm9wXCJdKSxcbiAgY3JvcDogbnVsbCxcbiAgc3RvcmVfY3JvcDogZnVuY3Rpb24oKXtcbiAgICBpZighdGhpcy5jcm9wKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBESUcgPSBmYWJyaWMuT2JqZWN0Lk5VTV9GUkFDVElPTl9ESUdJVFM7XG4gICAgbGV0IF9jcm9wID0ge307XG5cbiAgICBpZih0aGlzLmNyb3AubGVmdClfY3JvcC5sZWZ0ID0gZmFicmljLnV0aWwudG9GaXhlZCh0aGlzLmNyb3AubGVmdCwgRElHKTtcbiAgICBpZih0aGlzLmNyb3AudG9wKV9jcm9wLnRvcCA9IGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5jcm9wLnRvcCwgRElHKTtcbiAgICBpZih0aGlzLmNyb3Auc2NhbGVYKV9jcm9wLnNjYWxlWCA9IGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5jcm9wLnNjYWxlWCwgRElHKTtcbiAgICBpZih0aGlzLmNyb3Auc2NhbGVZKV9jcm9wLnNjYWxlWSA9IGZhYnJpYy51dGlsLnRvRml4ZWQodGhpcy5jcm9wLnNjYWxlWSwgRElHKTtcbiAgICBpZih0aGlzLmNyb3AuYW5nbGUpX2Nyb3AuYW5nbGUgPSBmYWJyaWMudXRpbC50b0ZpeGVkKHRoaXMuY3JvcC5hbmdsZSwgRElHKTtcbiAgICByZXR1cm4gX2Nyb3A7XG4gIH0sXG4gIHNldENyb3A6IGZ1bmN0aW9uKGNyb3Ape1xuICAgIHRoaXMuY3JvcCA9IGNyb3A7XG4gICAgaWYoIWNyb3Ape1xuICAgICAgZGVsZXRlIHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQ7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmKCF0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50KXtcbiAgICAgIHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQgPSBuZXcgZmFicmljLkltYWdlKHRoaXMuX2VsZW1lbnQse1xuICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICBvcmlnaW5ZOiBcImNlbnRlclwiXG4gICAgICB9KTtcbiAgICAgIHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQuZ3JvdXAgPSB0aGlzO1xuICAgIH1cbiAgICB0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50LnNldCh7XG4gICAgICBza2V3WDogY3JvcC5za2V3WCB8fCAwLFxuICAgICAgc2tld1k6IGNyb3Auc2tld1kgfHwgMCxcbiAgICAgIGFuZ2xlICAgOiBjcm9wLmFuZ2xlIHx8IDAgLFxuICAgICAgbGVmdCAgIDogY3JvcC5sZWZ0ICogdGhpcy53aWR0aCB8fCAwLFxuICAgICAgdG9wICAgIDogY3JvcC50b3AqIHRoaXMuaGVpZ2h0IHx8IDAsXG4gICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgICBzY2FsZVggOiBjcm9wLnNjYWxlWCB8fCAxICxcbiAgICAgIHNjYWxlWSA6IGNyb3Auc2NhbGVZIHx8IDEsXG4gICAgfSlcbiAgfSxcbiAgX3JlbmRlcjogZnVuY3Rpb24oY3R4LCBub1RyYW5zZm9ybSkge1xuICAgIHZhciB4LCB5LCBpbWFnZU1hcmdpbnMgPSB0aGlzLl9maW5kTWFyZ2lucygpLCBlbGVtZW50VG9EcmF3O1xuXG4gICAgeCA9IChub1RyYW5zZm9ybSA/IHRoaXMubGVmdCA6IC10aGlzLndpZHRoIC8gMik7XG4gICAgeSA9IChub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogLXRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICBpZiAodGhpcy5jcm9wIHx8IHRoaXMubWVldE9yU2xpY2UgPT09ICdzbGljZScpIHtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5yZWN0KHgsIHksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgIGN0eC5jbGlwKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNNb3ZpbmcgPT09IGZhbHNlICYmIHRoaXMucmVzaXplRmlsdGVycy5sZW5ndGggJiYgdGhpcy5fbmVlZHNSZXNpemUoKSkge1xuICAgICAgdGhpcy5fbGFzdFNjYWxlWCA9IHRoaXMuc2NhbGVYO1xuICAgICAgdGhpcy5fbGFzdFNjYWxlWSA9IHRoaXMuc2NhbGVZO1xuICAgICAgZWxlbWVudFRvRHJhdyA9IHRoaXMuYXBwbHlGaWx0ZXJzKG51bGwsIHRoaXMucmVzaXplRmlsdGVycywgdGhpcy5fZmlsdGVyZWRFbCB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQsIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGVsZW1lbnRUb0RyYXcgPSB0aGlzLl9lbGVtZW50O1xuICAgIH1cbiAgICBpZih0aGlzLmNyb3ApIHtcbiAgICAgIC8vIHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQuQ3JvcFRvID0gdGhpcztcbiAgICAgIHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgICAvLyB2YXIgX2VsID0gdGhpcy5fZHJhd190cmFuc2Zvcm1fZWxlbWVudDtcbiAgICAgIC8vIF9lbC50cmFuc2Zvcm0oY3R4KTtcbiAgICAgIC8vIF9lbC5fcmVuZGVyKGN0eCk7XG4gICAgICAvLyBpbWFnZU1hcmdpbnMgPSB0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50Ll9maW5kTWFyZ2lucygpO1xuICAgICAgLy8geCA9IChub1RyYW5zZm9ybSA/IHRoaXMubGVmdCA6IC10aGlzLndpZHRoIC8gMik7XG4gICAgICAvLyB5ID0gKG5vVHJhbnNmb3JtID8gdGhpcy50b3AgOiAtdGhpcy5oZWlnaHQgLyAyKTtcbiAgICAgIHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQucmVuZGVyKGN0eCk7XG4gICAgfWVsc2V7XG5cbiAgICAgIGVsZW1lbnRUb0RyYXcgJiYgY3R4LmRyYXdJbWFnZShlbGVtZW50VG9EcmF3LFxuICAgICAgICB4ICsgaW1hZ2VNYXJnaW5zLm1hcmdpblgsXG4gICAgICAgIHkgKyBpbWFnZU1hcmdpbnMubWFyZ2luWSxcbiAgICAgICAgaW1hZ2VNYXJnaW5zLndpZHRoLFxuICAgICAgICBpbWFnZU1hcmdpbnMuaGVpZ2h0XG4gICAgICApO1xuICAgIH1cblxuXG4gICAgdGhpcy5fc3Ryb2tlKGN0eCk7XG4gICAgdGhpcy5fcmVuZGVyU3Ryb2tlKGN0eCk7XG4gIH0sXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSBkcmF3aW5nIG9wZXJhdGlvbiBmb3IgYW4gb2JqZWN0IG9uIGEgc3BlY2lmaWVkIGNvbnRleHRcbiAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciBvblxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtub1RyYW5zZm9ybV0gV2hlbiB0cnVlLCBjb250ZXh0IGlzIG5vdCB0cmFuc2Zvcm1lZFxuICAgKi9cbiAgLy8gZHJhd09iamVjdDogZnVuY3Rpb24oY3R4LCBub1RyYW5zZm9ybSkge1xuICAvLyAgIHRoaXMuX3JlbmRlckJhY2tncm91bmQoY3R4KTtcbiAgLy8gICB0aGlzLl9zZXRTdHJva2VTdHlsZXMoY3R4KTtcbiAgLy8gICB0aGlzLl9zZXRGaWxsU3R5bGVzKGN0eCk7XG4gIC8vICAgaWYodGhpcy5jcm9wKXtcbiAgLy8gICAgIC8vIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50Lmdyb3VwID0gdGhpcztcbiAgLy8gICAgIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50LnJlbmRlcihjdHgpO1xuICAvLyAgICAgLy8gZGVsZXRlIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50Lmdyb3VwO1xuICAvLyAgICAgLy8gdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnRcbiAgLy8gICB9ZWxzZXtcbiAgLy8gICAgIHRoaXMuX3JlbmRlcihjdHgsIG5vVHJhbnNmb3JtKTtcbiAgLy8gICB9XG4gIC8vIH0sXG4gIC8qY3JvcDoge1xuICAgIGxlZnQ6IDAsXG4gICAgdG9wOiAwLFxuICAgIHNjYWxlWDogMSxcbiAgICBzY2FsZVk6IDFcbiAgfSwqL1xuICBjcm9wUGhvdG9FbmQ6ZnVuY3Rpb24oKXtcblxuICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLl90cmFuc2Zvcm1fZWxlbWVudCk7XG5cbiAgICB0aGlzLmNhbnZhcy5lZGl0aW5nT2JqZWN0ID0gbnVsbDtcbiAgICB0aGlzLmFwcGxpY2F0aW9uLm9mZihcInRhcmdldDpjaGFuZ2VkIHRhcmdldDpjbGVhcmVkXCIsdGhpcy5fZW5kRm9vKTtcblxuICAgIGlmKHRoaXMuY2FudmFzLl9ncmlkT2JqZWN0KXtcbiAgICAgIHRoaXMuY2FudmFzLl9ncmlkT2JqZWN0LmVuYWJsZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuc2V0KHtcbiAgICAgIGhhc0NvbnRyb2xzOiB0cnVlLFxuICAgICAgZXZlbnRlZDogdHJ1ZSxcbiAgICAgIGZsaXBYOiAgIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50LmZsaXBYLFxuICAgICAgZmxpcFk6ICAgdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQuZmxpcFlcbiAgICB9KTtcbiAgICB0aGlzLl9yZXNldE9yaWdpbigpO1xuXG4gICAgdGhpcy5fY3JvcG1vZGUgPWZhbHNlO1xuXG4gICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHRoaXMpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIHRoaXMuY2FudmFzLnN0YXRlZnVsID0gdHJ1ZTtcblxuICAgIC8vIGlmICh0aGlzLmhhc1N0YXRlQ2hhbmdlZCgpKSB7XG4gICAgdGhpcy5jYW52YXMuZmlyZSgnb2JqZWN0Om1vZGlmaWVkJywgeyB0YXJnZXQ6IHRoaXMgfSk7XG4gICAgdGhpcy5maXJlKCdtb2RpZmllZCcsIHt9KTtcbiAgICAvLyB9XG5cblxuICAgIC8vIHRoaXMuZmlyZShcImNyb3BwaW5nOmV4aXRlZFwiKTtcbiAgICAvLyB0aGlzLmNhbnZhcy5maXJlKCdmcmFtZTpjcm9wcGluZzpleGl0ZWQnLCB7IHRhcmdldDogdGhpcyB9KTtcbiAgfSxcbiAgdXBkYXRlQ3JvcDogZnVuY3Rpb24oKXtcblxuICAgIGxldCBJID0gdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQsXG4gICAgICBGID0gdGhpcyxcbiAgICAgIHRvX3JhZGlhbnMgPSBNYXRoLlBJIC8gMTgwLFxuICAgICAgY29zQSA9IE1hdGguY29zKEYuYW5nbGUgKiB0b19yYWRpYW5zKSxcbiAgICAgIHNpbkEgPSBNYXRoLnNpbihGLmFuZ2xlICogdG9fcmFkaWFucyksXG4gICAgICBsZWZ0ID0gKCAoSS5sZWZ0IC0gRi5sZWZ0ICkgKiBjb3NBICsgKEkudG9wIC0gRi50b3ApKiBzaW5BICAvKi0gRi53aWR0aC8gMiovKSAqIChJLmZsaXBYID8gLTEgOiAxKSxcbiAgICAgIHRvcCAgID0gKC0oSS5sZWZ0IC0gRi5sZWZ0ICkgKiBzaW5BICsgKEkudG9wIC0gRi50b3ApKiBjb3NBICAvKi0gRi5oZWlnaHQvIDIqLykqIChJLmZsaXBZID8gLTEgOiAxKTtcblxuICAgIEYuc2V0Q3JvcCh7XG4gICAgICBza2V3WCA6IEkuc2tld1gsXG4gICAgICBza2V3WSA6IEkuc2tld1ksXG4gICAgICBsZWZ0ICAgOiAobGVmdCkgLyBGLndpZHRoIC8gRi5zY2FsZVgsXG4gICAgICB0b3AgICAgOiAodG9wKSAvIEYuaGVpZ2h0IC8gRi5zY2FsZVksXG4gICAgICBzY2FsZVggOiBJLnNjYWxlWCAvIEYuc2NhbGVYLFxuICAgICAgc2NhbGVZIDogSS5zY2FsZVkgLyBGLnNjYWxlWSxcbiAgICAgIGFuZ2xlICA6IEkuYW5nbGUgLSBGLmFuZ2xlXG4gICAgfSk7XG4gIH0sXG4gIHRvU1ZHX292ZXJ3cml0dGVuOiBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnRvU1ZHLFxuICBnZXRTaGFwZTogZnVuY3Rpb24oKXtcbiAgICBjb25zdCBwYXRoID0gIGBNIDAgMCBMICR7dGhpcy53aWR0aH0gMCBMICR7dGhpcy53aWR0aH0gJHt0aGlzLmhlaWdodH0gTCAwICR7dGhpcy5oZWlnaHR9IHpgO1xuICAgIGNvbnN0IGVsZW1lbnQgPSBuZXcgZmFicmljLlBhdGgocGF0aCwge30pO1xuICAgIGVsZW1lbnQuZ3JvdXAgPSB0aGlzO1xuICAgIGVsZW1lbnQuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgZmFicmljLkdyb3VwLnByb3RvdHlwZS5yZWFsaXplVHJhbnNmb3JtLmNhbGwodGhpcyxlbGVtZW50KTtcbiAgICBkZWxldGUgZWxlbWVudC5ncm91cDtcbiAgICBlbGVtZW50LnNldCh7XG4gICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgb3JpZ2luWTogXCJjZW50ZXJcIlxuICAgIH0pO1xuICAgIHJldHVybiBlbGVtZW50O1xuICB9LFxuICB0b1NWRzogZnVuY3Rpb24ocmV2aXZlcil7XG4gICAgaWYodGhpcy5jcm9wKXtcblxuICAgICAgY29uc3QgY2xpcElkID0gYENsaXBwZWQke2ZhYnJpYy5PYmplY3QuX191aWQrK31gO1xuXG4gICAgICByZXR1cm4gYFxuICAgICAgICA8Y2xpcFBhdGggaWQ9XCIke2NsaXBJZH1cIj5cbiAgICAgICAgICAke3RoaXMuZ2V0U2hhcGUoKS50b1NWRyhyZXZpdmVyKX1cbiAgICAgICAgPC9jbGlwUGF0aD5cbiAgICAgICAgPGcgY2xpcC1wYXRoPVwidXJsKCMke2NsaXBJZH0pXCI+XG4gICAgICAgICAgJHt0aGlzLl9jcmVhdGVUcmFuc2Zvcm1lZEVsZW1lbnQoKS50b1NWR19vdmVyd3JpdHRlbihyZXZpdmVyKX1cbiAgICAgICAgPC9nPmA7XG4gICAgfWVsc2V7XG4gICAgICByZXR1cm4gdGhpcy50b1NWR19vdmVyd3JpdHRlbihyZXZpdmVyKTtcbiAgICB9XG4gIH0sXG4gIF9jcmVhdGVUcmFuc2Zvcm1lZEVsZW1lbnQ6ZnVuY3Rpb24oKXtcblxuICAgIHZhciBlbDtcbiAgICBpZih0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50KXtcbiAgICAgIHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQuZ3JvdXAgPSB0aGlzO1xuICAgICAgdGhpcy5zZXRDcm9wKHRoaXMuY3JvcCk7XG4gICAgICBmYWJyaWMuR3JvdXAucHJvdG90eXBlLnJlYWxpemVUcmFuc2Zvcm0uY2FsbCh0aGlzLHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQpO1xuXG4gICAgICBlbCA9ICBuZXcgZmFicmljLkltYWdlKHRoaXMuX2VsZW1lbnQse1xuICAgICAgICBhbmdsZTogdGhpcy5fZHJhd190cmFuc2Zvcm1fZWxlbWVudC5hbmdsZSxcbiAgICAgICAgbGVmdDogdGhpcy5fZHJhd190cmFuc2Zvcm1fZWxlbWVudC5sZWZ0LFxuICAgICAgICB0b3A6IHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQudG9wLFxuICAgICAgICB3aWR0aDogdGhpcy5fZHJhd190cmFuc2Zvcm1fZWxlbWVudC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50LmhlaWdodCxcbiAgICAgICAgc2NhbGVYOiB0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50LnNjYWxlWCxcbiAgICAgICAgc2NhbGVZOiB0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50LnNjYWxlWSxcbiAgICAgICAgc2tld1g6IHRoaXMuX2RyYXdfdHJhbnNmb3JtX2VsZW1lbnQuc2tld1gsXG4gICAgICAgIHNrZXdZOiB0aGlzLl9kcmF3X3RyYW5zZm9ybV9lbGVtZW50LnNrZXdZLFxuICAgICAgfSk7XG4gICAgICB0aGlzLnNldENyb3AodGhpcy5jcm9wKVxuICAgIH1lbHNle1xuICAgICAgZWwgPSBuZXcgZmFicmljLkltYWdlKHRoaXMuX2VsZW1lbnQse1xuICAgICAgICBhbmdsZTogdGhpcy5hbmdsZSxcbiAgICAgICAgbGVmdDogdGhpcy5sZWZ0LFxuICAgICAgICB0b3A6IHRoaXMudG9wLFxuICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCxcbiAgICAgICAgc2NhbGVYOiB0aGlzLnNjYWxlWCxcbiAgICAgICAgc2NhbGVZOiB0aGlzLnNjYWxlWSxcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbC5zZXQoe1xuICAgICAgb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAgIG9yaWdpblk6IFwiY2VudGVyXCIsXG4gICAgICBtb3ZlbWVudExpbWl0czogdGhpcyxcbiAgICAgIGNsaXBUbzogdGhpcyxcbiAgICAgIG1vdmVtZW50TGltaXRNb2RlOiBcImNvbnRlbnRcIixcbiAgICAgIGhhc0NvbnRyb2xzOiB0cnVlLFxuICAgICAgc2VsZWN0YWJsZTogdHJ1ZSxcbiAgICAgIHBlclBpeGVsVGFyZ2V0RmluZDogZmFsc2UsXG4gICAgfSk7XG4gICAgZWwuY2FudmFzID0gdGhpcy5jYW52YXM7XG5cbiAgICBlbC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgcmV0dXJuIGVsO1xuICB9LFxuICBjcm9wUGhvdG9TdGFydDpmdW5jdGlvbigpe1xuICAgIHRoaXMuX2Nyb3Btb2RlID0gdHJ1ZTtcblxuICAgIHRoaXMuY2FudmFzLnN0YXRlZnVsICYmIHRoaXMuc2F2ZVN0YXRlKCk7XG4gICAgdGhpcy5jYW52YXMuc3RhdGVmdWwgPSBmYWxzZTtcblxuXG4gICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgaWYodGhpcy5jYW52YXMuX2dyaWRPYmplY3Qpe1xuICAgICAgdGhpcy5jYW52YXMuX2dyaWRPYmplY3QuZW5hYmxlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuc2V0KHtcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoICAqIHRoaXMuc2NhbGVYLFxuICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCAgKiB0aGlzLnNjYWxlWSxcbiAgICAgIHNjYWxlWTogMSxcbiAgICAgIHNjYWxlWDogMVxuICAgIH0pO1xuICAgIHRoaXMuX3NldE9yaWdpblRvQ2VudGVyKCk7XG5cblxuICAgIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50ID0gdGhpcy5fY3JlYXRlVHJhbnNmb3JtZWRFbGVtZW50KCk7XG4gICAgdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQucGFyZW50ID0gdGhpcztcblxuICAgIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50Lm9uKFwicm90YXRpbmdcIiwgdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQuc3RlcFJvdGF0aW5nKTtcblxuICAgIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50LnNldCh7XG4gICAgICB0b29sczogW1wiY3JvcFpvb21JblwiLFwiY3JvcFpvb21PdXRcIixcImNyb3BFbmRcIl0sXG4gICAgICBhY3Rpb25zOiB7XG4gICAgICAgIGNyb3Bab29tSW46IHtcbiAgICAgICAgICBjbGFzc05hbWU6ICBcImZhIGZhLXNlYXJjaC1wbHVzIFwiLFxuICAgICAgICAgIHRpdGxlOiAgICAgIFwiem9vbSBpblwiLFxuICAgICAgICAgIGFjdGlvbjogICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnBhcmVudC5jcm9wWm9vbUluKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjcm9wWm9vbU91dDoge1xuICAgICAgICAgIGNsYXNzTmFtZTogIFwiZmEgZmEgZmEtc2VhcmNoLW1pbnVzXCIsXG4gICAgICAgICAgdGl0bGU6ICAgICAgXCJ6b29tIG91dFwiLFxuICAgICAgICAgIGFjdGlvbjogICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnBhcmVudC5jcm9wWm9vbU91dCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY3JvcEVuZDoge1xuICAgICAgICAgIGNsYXNzTmFtZTogIFwiZmEgZmEtY3JvcFwiLFxuICAgICAgICAgIHRpdGxlOiAgICAgIFwiY3JvcCBlbmRcIixcbiAgICAgICAgICBhY3Rpb246ICAgICBmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5wYXJlbnQuY3JvcFBob3RvRW5kKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb3BhY2l0eTogMC41LFxuICAgICAgZXZlbnRMaXN0ZW5lcnM6IHtcbiAgICAgICAgXCJyb3RhdGluZyBtb3Zpbmcgc2NhbGluZyBza2V3aW5nXCI6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdGhpcy5wYXJlbnQudXBkYXRlQ3JvcCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmNhbnZhcy5hZGQodGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQpO1xuXG4gICAgdGhpcy5jYW52YXMub24oXCJtb3VzZTp3aGVlbFwiLCBlID0+IHtcbiAgICAgIGlmKGUudGFyZ2V0ID09PSB0aGlzLl90cmFuc2Zvcm1fZWxlbWVudCl7XG4gICAgICAgIGlmKGUuZS5kZWx0YVkgPCAwKXtcbiAgICAgICAgICB0aGlzLmNyb3Bab29tSW4oKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5jcm9wWm9vbU91dCgpO1xuICAgICAgICB9XG4gICAgICAgIGUuZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5lLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9XG4gICAgfSk7XG5cblxuXG4gICAgLy/RgNCw0LzQutGDINC00LLQuNCz0LDRgtGMINC90LXQu9GM0LfRj1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlXG4gICAgfSk7XG5cbiAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QodGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQpO1xuICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB0aGlzLl9lbmRGb28gPSBmdW5jdGlvbigpe1xuICAgICAgX3RoaXMuY3JvcFBob3RvRW5kKCk7XG4gICAgfTtcbiAgICB0aGlzLmFwcGxpY2F0aW9uLm9uKFwidGFyZ2V0OmNoYW5nZWQgdGFyZ2V0OmNsZWFyZWRcIix0aGlzLl9lbmRGb28pO1xuXG4gICAgdGhpcy5maXJlKFwiY3JvcHBpbmc6ZW50ZXJlZFwiKTtcbiAgICB0aGlzLmNhbnZhcy5maXJlKCdmcmFtZTpjcm9wcGluZzplbnRlcmVkJywgeyB0YXJnZXQ6IHRoaXMgfSk7XG5cbiAgICB0aGlzLmNhbnZhcy5lZGl0aW5nT2JqZWN0ID0gdGhpcztcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgY3JvcFpvb21PdXQ6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQuc2V0KHtcbiAgICAgIHNjYWxlWDogTWF0aC5tYXgoIHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50LnNjYWxlWCAtIDAuMSwwLjEpLFxuICAgICAgc2NhbGVZOiBNYXRoLm1heCggdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQuc2NhbGVZIC0gMC4xLDAuMSksXG4gICAgfSk7XG4gICAgdGhpcy51cGRhdGVDcm9wKCk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGNyb3Bab29tSW46IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQuc2V0KHtcbiAgICAgIHNjYWxlWDogTWF0aC5tYXgodGhpcy5fdHJhbnNmb3JtX2VsZW1lbnQuc2NhbGVYICsgMC4xLDAuMSksXG4gICAgICBzY2FsZVk6IE1hdGgubWF4KHRoaXMuX3RyYW5zZm9ybV9lbGVtZW50LnNjYWxlWSArIDAuMSwwLjEpLFxuICAgIH0pO1xuICAgIHRoaXMudXBkYXRlQ3JvcCgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgIGNyb3A6IHtcbiAgICAgIHRpdGxlOiAgICAgIFwiY3JvcFwiLFxuICAgICAgY2xhc3NOYW1lOiAgXCJmYSBmYS1jcm9wXCIsXG4gICAgICBhY3Rpb246ICAgICBcImNyb3BQaG90b1N0YXJ0XCIsXG4gICAgICAvLyB2aXNpYmxlOiAgICBcImNyb3BwaW5nQXZhaWxhYmxlXCIsXG4gICAgICBvYnNlcnZlOiAgXCJjcm9wcGluZzplbnRlcmVkIGNyb3BwaW5nOmV4aXRlZCBlbGVtZW50Om1vZGlmaWVkXCJcbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9pbWFnZS5jcm9wLmpzIiwiZmFicmljLkVkaXRvci5wcm90b3R5cGUuY29uZmlndXJhdGlvblByb3BlcnRpZXMucHVzaChcImZyYW1lc1wiKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkVkaXRvci5wcm90b3R5cGUsIHtcbiAgc2V0RnJhbWVzOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMuZnJhbWVzID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh2YWwubWFwKGl0ZW0gPT4gZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKGl0ZW0se1xuICAgICAgZnJhbWU6IGZhbHNlLFxuICAgICAgc2hhcGU6IGZhbHNlLFxuICAgICAgdHlwZTogXCJwaG90b1wiLFxuICAgICAgcm9sZTogXCJmcmFtZVwiXG4gICAgfSkpKVxuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9pbWFnZS5mcmFtZS5qcyIsImZhYnJpYy51dGlsLmNyZWF0ZVRodW1iID0gZnVuY3Rpb24oc2xpZGUsICRjYW52YXNFbCl7XG5cbiAgdmFyIF9jYW52YXMgPSBzbGlkZSxcbiAgICAgIGZpcnN0RHJhdyA9IHRydWUsXG4gICAgICBtb2RpZmllZCxcbiAgICAgIF93ID0gKyRjYW52YXNFbC5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKSxcbiAgICAgIF9oID0gKyRjYW52YXNFbC5nZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIik7XG5cbiAgaWYgKF9oKSB7XG4gICAgJGNhbnZhc0VsLnN0eWxlLmhlaWdodCA9ICRjYW52YXNFbC5oZWlnaHQ7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJUaHVtYigpIHtcbiAgICBpZiAoX2NhbnZhcy5wcm9jZXNzaW5nIHx8ICFfY2FudmFzLmxvYWRlZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBfY2FudmFzLnJlbmRlclRodW1iKCRjYW52YXNFbCk7XG4gICAgbW9kaWZpZWQgPSBfY2FudmFzLm1vZGlmaWVkO1xuICB9XG5cbiAgZnVuY3Rpb24gZm9yY2VSZW5kZXJUaHVtYigpIHtcbiAgICBpZiAodGhpcy5sb2FkZWQpIHtcbiAgICAgIHRoaXMucmVuZGVyVGh1bWIoJGNhbnZhc0VsKTtcbiAgICB9ZWxzZSBpZih0aGlzLnRodW1iKXtcbiAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdHggPSAkY2FudmFzRWwuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsICRjYW52YXNFbC53aWR0aCwgJGNhbnZhc0VsLmhlaWdodCk7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCAkY2FudmFzRWwud2lkdGgsICRjYW52YXNFbC5oZWlnaHQpO1xuICAgICAgICBtb2RpZmllZCA9IHRoaXMubW9kaWZpZWQ7XG4gICAgICB9O1xuICAgICAgaW1nLnNyYyA9IHRoaXMudGh1bWI7XG4gICAgfVxuICAgIC8vIC8vaWYgKGF0dHJzLmZvcmNlICE9PSBcInRydWVcIikgcmV0dXJuO1xuICAgIC8vIHZhciBjYW52YXMgPSBuZXcgZmFicmljLkNhbnZhcyhudWxsLCB0aGlzLmRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgIGNhbnZhcy5yZW5kZXJUaHVtYigkY2FudmFzRWwpO1xuICAgIC8vICAgLy9tb2RpZmllZCA9IHNsaWRlLm1vZGlmaWVkO1xuICAgIC8vIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2NhbGVUaHVtYigpIHtcblxuICAgIHZhciBfZml0U2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKFxuICAgICAge1xuICAgICAgICB3aWR0aDogc2xpZGUub3JpZ2luYWxXaWR0aCB8fCBzbGlkZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBzbGlkZS5vcmlnaW5hbEhlaWdodCB8fCBzbGlkZS5oZWlnaHRcbiAgICAgIH0se1xuICAgICAgICB3aWR0aDogX3csXG4gICAgICAgIGhlaWdodDogX2hcbiAgICAgIH0sXCJmaXRcIik7XG5cbiAgICAkY2FudmFzRWwud2lkdGggPSBfZml0U2l6ZS53aWR0aDtcbiAgICAkY2FudmFzRWwuaGVpZ2h0ID0gX2ZpdFNpemUuaGVpZ2h0O1xuXG4gICAgJGNhbnZhc0VsLnN0eWxlLndpZHRoID0gX2ZpdFNpemUud2lkdGggKyAncHgnO1xuICAgICRjYW52YXNFbC5zdHlsZS5oZWlnaHQgPSBfZml0U2l6ZS5oZWlnaHQgICsgJ3B4JztcbiAgICByZW5kZXJUaHVtYigpO1xuICB9XG5cbiAgc2xpZGUub24oe1xuICAgICdhZnRlcjpyZW5kZXInOiByZW5kZXJUaHVtYixcbiAgICAnZGltZW5zaW9uczptb2RpZmllZCc6IHNjYWxlVGh1bWIsXG4gICAgJ2xvYWRpbmc6ZW5kJzogc2NhbGVUaHVtYixcbiAgICAnbW9kaWZpZWQnOiBmb3JjZVJlbmRlclRodW1iXG4gIH0pO1xuXG5cbiAgJGNhbnZhc0VsLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHNsaWRlLnRpdGxlKTtcblxuICBzY2FsZVRodW1iLmNhbGwoc2xpZGUpO1xuICBmb3JjZVJlbmRlclRodW1iLmNhbGwoc2xpZGUpO1xuXG59O1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICByZW5kZXJUaHVtYjogZnVuY3Rpb24gKGNhbnZhcywgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHtcbiAgICAgICAgb2JqZWN0czogdHJ1ZSxcbiAgICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWVcbiAgICAgIH07XG5cbiAgICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgICB2YXIgX3pvb20gPSBvcHRpb25zLnpvb207XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChjYW52YXMud2lkdGgpIHtcbiAgICAgICAgdmFyIF96b29tID0gY2FudmFzLndpZHRoIC8gKHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF96b29tID0gMTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIF9vbGRfU2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHZhciBvbGRfeCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF07XG4gICAgdmFyIG9sZF95ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XTtcbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IDA7XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSAxO1xuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSBfem9vbTtcbiAgICAvL3RoaXMuX3VwZGF0ZV9jbGlwX3JlY3QoKTtcblxuICAgIGlmICh0aGlzLmNsaXBSZWN0KSB7XG4gICAgICB0aGlzLmNsaXBSZWN0LnNldE9wYWNpdHkoMCk7XG4gICAgfVxuXG4gICAgdmFyIHNpemUgPSB7XG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHRcbiAgICB9O1xuICAgIHNpemUud2lkdGggPSBNYXRoLmNlaWwoc2l6ZS53aWR0aCAqIF96b29tKTtcbiAgICBzaXplLmhlaWdodCA9IE1hdGguY2VpbChzaXplLmhlaWdodCAqIF96b29tKTtcblxuICAgIHZhciBfY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIF9jYW52YXMud2lkdGggPSBzaXplLndpZHRoO1xuICAgIF9jYW52YXMuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7XG5cbiAgICB2YXIgY2FudmFzVG9EcmF3T24gPSBfY2FudmFzLmdldENvbnRleHQoJzJkJyksIG9ianNUb1JlbmRlcjtcblxuICAgIHRoaXMuY2xlYXJDb250ZXh0KGNhbnZhc1RvRHJhd09uKTtcbiAgICBjYW52YXNUb0RyYXdPbi5zYXZlKCk7XG4gICAgY2FudmFzVG9EcmF3T24udHJhbnNmb3JtLmFwcGx5KGNhbnZhc1RvRHJhd09uLCB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtKTtcblxuICAgIGlmIChvcHRpb25zLmRyYXdfYmFja2dyb3VuZCkge1xuICAgICAgdGhpcy5fcmVuZGVyQmFja2dyb3VuZChjYW52YXNUb0RyYXdPbik7XG4gICAgICAvL2lmICh0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpIHtcbiAgICAgIC8vICB0aGlzLl9yZW5kZXJPYmplY3RzKGNhbnZhc1RvRHJhd09uLCB0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpO1xuICAgICAgLy99XG4gICAgfVxuXG4gICAgaWYgKCFvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFRvKSB7XG4gICAgICBmYWJyaWMudXRpbC5jbGlwQ29udGV4dCh0aGlzLCBjYW52YXNUb0RyYXdPbik7XG4gICAgfVxuXG4gICAgdmFyIF9vYmplY3RzO1xuICAgIGlmIChvcHRpb25zLm9iamVjdHMgJiYgb3B0aW9ucy5vYmplY3RzLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgX29iamVjdHMgPSBvcHRpb25zLm9iamVjdHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9vYmplY3RzID0gb3B0aW9ucy5vYmplY3RzICE9PSBmYWxzZSA/IHRoaXMuX29iamVjdHMgOiBbXTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICBfb2JqZWN0cyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShfb2JqZWN0cyk7XG4gICAgICBmb3IgKHZhciBpID0gX29iamVjdHMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgIGlmIChfb2JqZWN0c1tpXS5jbGlwVG8gIT09IG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICAgICAgX29iamVjdHMuc3BsaWNlKGksIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8vIGlmIChmYWJyaWMudmVyc2lvbiA+PSAxLjYpIHtcbiAgICB0aGlzLl9yZW5kZXJPYmplY3RzKGNhbnZhc1RvRHJhd09uLCBfb2JqZWN0cyk7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBfb2JqZWN0cy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIC8vICAgICB0aGlzLl9kcmF3KGNhbnZhc1RvRHJhd09uLCBfb2JqZWN0c1tpXSk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG5cbiAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7XG4gICAgaWYgKCFvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFRvKSB7XG4gICAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHRoaXMuX3JlbmRlck92ZXJsYXkoY2FudmFzVG9EcmF3T24pO1xuICAgIGNhbnZhc1RvRHJhd09uLnJlc3RvcmUoKTtcbiAgICBpZiAodGhpcy5jbGlwUmVjdCkge1xuICAgICAgdGhpcy5jbGlwUmVjdC5zZXRPcGFjaXR5KDEpO1xuICAgIH1cbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFJlY3QpIHtcbiAgICAgIHZhciBfcmVjdCA9IHtcbiAgICAgICAgbGVmdDogdGhpcy5jbGlwUmVjdC5sZWZ0ICogX3pvb20sXG4gICAgICAgIHRvcDogdGhpcy5jbGlwUmVjdC50b3AgKiBfem9vbSxcbiAgICAgICAgd2lkdGg6IHRoaXMuY2xpcFJlY3Qud2lkdGggKiBfem9vbSxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmNsaXBSZWN0LmhlaWdodCAqIF96b29tXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX3JlY3QgPSB7XG4gICAgICAgIGxlZnQ6IG9wdGlvbnMubGVmdCAqIF96b29tIHx8IDAsXG4gICAgICAgIHRvcDogb3B0aW9ucy50b3AgKiBfem9vbSB8fCAwLFxuICAgICAgICB3aWR0aDogb3B0aW9ucy53aWR0aCAqIF96b29tIHx8IHNpemUud2lkdGgsXG4gICAgICAgIGhlaWdodDogb3B0aW9ucy5oZWlnaHQgKiBfem9vbSB8fCBzaXplLmhlaWdodFxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuYW5nbGUpIHtcbiAgICAgIGN0eC5yb3RhdGUoLW9wdGlvbnMuYW5nbGUgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UoX2NhbnZhcyxcbiAgICAgICAgMCwgMCwgX3JlY3Qud2lkdGggKyBfcmVjdC5sZWZ0ICsgX2NhbnZhcy53aWR0aCwgX3JlY3QuaGVpZ2h0ICsgX3JlY3QudG9wICsgX2NhbnZhcy5oZWlnaHQsXG4gICAgICAgIC1fcmVjdC5sZWZ0LCAtX3JlY3QudG9wLCBjYW52YXMud2lkdGggKyBfcmVjdC5sZWZ0ICsgX2NhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCArIF9yZWN0LnRvcCArIF9jYW52YXMuaGVpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3R4LmRyYXdJbWFnZShfY2FudmFzLCBfcmVjdC5sZWZ0LCBfcmVjdC50b3AsIF9yZWN0LndpZHRoLCBfcmVjdC5oZWlnaHQsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgfVxuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSBfb2xkX1NjYWxlO1xuICAgIC8vIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgLy90aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG5cbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gb2xkX3g7XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IG9sZF95O1xuXG5cbiAgICByZXR1cm4gY2FudmFzO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy90aHVtYi5qcyIsIlxucmVxdWlyZShcIi4vc2xpZGUuYXJlYXNcIik7XG5yZXF1aXJlKFwiLi9ncm91cHNcIik7XG5cbi8vIHRvZG8g0Y3RgtC+INGD0LHRgNCw0YLRjFxuLy9mYWJyaWMubW92ZW1lbnRzTGltaXRzRWFzeSA9IGZhbHNlO1xudmFyIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9zY2FsZU9iamVjdDtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHN0b3JlX21vdmVtZW50TGltaXRzOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLm1vdmVtZW50TGltaXRzID8gKHRoaXMubW92ZW1lbnRMaW1pdHMuaWQgPyAnIycgKyB0aGlzLm1vdmVtZW50TGltaXRzLmlkIDogdGhpcy5tb3ZlbWVudExpbWl0cykgOiBudWxsO1xuICB9LFxuICBzZXRXaG9sZUNvb3JkaW5hdGVzOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMud2hvbGVDb29yZGluYXRlcyA9IHZhbDtcbiAgICB0aGlzLm9uKFwiYWRkZWQgbW9kaWZpZWRcIixmdW5jdGlvbigpe1xuICAgICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAgICAgdGhpcy5zZXQoe1xuICAgICAgICAgIGxlZnQ6IE1hdGgucm91bmQodGhpcy5sZWZ0KSxcbiAgICAgICAgICB0b3A6IE1hdGgucm91bmQodGhpcy50b3ApLFxuICAgICAgICAgIHdpZHRoOiBNYXRoLnJvdW5kKHRoaXMud2lkdGgpLFxuICAgICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCh0aGlzLmhlaWdodClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9LHRydWUpXG4gIH0sXG4gIC8vIHNldFRvcDogZnVuY3Rpb24odmFsKXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdmFsID0gTWF0aC5yb3VuZCh2YWwpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLnRvcCA9IHZhbDtcbiAgLy8gfSxcbiAgLy8gc2V0TGVmdDogZnVuY3Rpb24odmFsKXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdmFsID0gTWF0aC5yb3VuZCh2YWwpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLmxlZnQgPSB2YWw7XG4gIC8vIH0sXG4gIC8vIHNldFdpZHRoOiBmdW5jdGlvbih3KXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdyA9IE1hdGgucm91bmQodyk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMud2lkdGggPSB3O1xuICAvLyB9LFxuICAvLyBzZXRIZWlnaHQ6IGZ1bmN0aW9uKGgpe1xuICAvLyAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gIC8vICAgICBoID0gTWF0aC5yb3VuZChoKTtcbiAgLy8gICB9XG4gIC8vICAgdGhpcy5oZWlnaHQgPSBoO1xuICAvLyB9LFxuICAvLyBzcGVjaWFsUHJvcGVydGllczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3BlY2lhbFByb3BlcnRpZXMuY29uY2F0KFtcIm1vdmVtZW50TGltaXRzXCJdKSxcblxuICBzZXRBY3RpdmU6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICBpZighdGhpcy5jYW52YXMpe1xuICAgICAgdGhpcy5vbihcImFkZGVkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5jYW52YXMuaW50ZXJhY3RpdmUpe1xuICAgICAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICB0aGlzLmFjdGl2ZSA9IHZhbHVlO1xuXG4gIH0sXG4gIHNldFBvc2l0aW9uOiBmdW5jdGlvbihfcG9zaXRpb24pe1xuICAgIGlmKF9wb3NpdGlvbiA9PT0gXCJjZW50ZXJcIikge1xuICAgICAgdGhpcy5vbihcImFkZGVkXCIsZnVuY3Rpb24gc2V0UG9zaXRpb24oKXtcbiAgICAgICAgdGhpcy5jZW50ZXIoKTtcbiAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgICAgLy8gdGhpcy5jYW52YXMuZml0T2JqZWN0KHRoaXMpO1xuICAgICAgfSx0cnVlKVxuICAgIH1cbiAgfSxcblxuICBzZXRNb3ZlbWVudExpbWl0czogZnVuY3Rpb24gKHZhbCkge1xuXG5cbiAgICBpZighdGhpcy5tb3ZlbWVudExpbWl0cyl7XG4gICAgICB0aGlzLm9uKHtcbiAgICAgICAgYWRkZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgaWYoIHRoaXMuY2FudmFzLmludGVyYWN0aXZlKXtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfcG9zaXRpb24odGhpcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByb3RhdGVkOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcztcblxuICAgICAgICAgIGlmICh0YXJnZXQucmVzaXphYmxlKSB7XG4gICAgICAgICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBpZiAodGFyZ2V0LmxlZnQgPCBwb3MubGVmdCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC53aWR0aCArPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICAgICAgICAgIHRhcmdldC5sZWZ0ID0gcG9zLmxlZnQ7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LndpZHRoIC09IHRhcmdldC5sZWZ0IC0gcG9zLmxlZnQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgaWYgKHRhcmdldC50b3AgPCBwb3MudG9wKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmhlaWdodCArPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgICB0YXJnZXQudG9wID0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQuaGVpZ2h0IC09IHRhcmdldC50b3AgLSBwb3MudG9wO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfcG9zaXRpb24odGhpcylcbiAgICAgICAgfSxcbiAgICAgICAgbW9kaWZpZWQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfYWZ0ZXJfbW9kaWZpZWQodGhpcylcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMubW92ZW1lbnRMaW1pdHMgPSB2YWw7XG5cbiAgIC8qIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuX3NldE1vdmVtZW50TGltaXRzU3RyaW5nKCk7XG4gICAgfSovXG5cbiAgfVxufSk7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBmaXRPYmplY3Q6IGZ1bmN0aW9uIChlbCkge1xuICAgIHZhciBfcmVjdCwgbWF4U2l6ZSwgbyA9IHRoaXMub2Zmc2V0cztcblxuICAgIGlmKCFlbC5tb3ZlbWVudExpbWl0cyB8fCBlbC5tb3ZlbWVudExpbWl0cyA9PSBcImNhbnZhc1wiKXtcbiAgICAgIHZhciBfem9vbSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGggLyBfem9vbTtcbiAgICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQgLyBfem9vbTtcbiAgICAgIF9yZWN0ID0ge1xuICAgICAgICB3aWR0aDogbyA/IChfdyAtIG8ubGVmdCAtIG8ucmlnaHQpIDogX3csXG4gICAgICAgIGhlaWdodDogbyA/KF9oIC0gby50b3AgLSBvLmJvdHRvbSkgOiBfaFxuICAgICAgfTtcbiAgICAgIC8qIG9mZnNldHMgPSB7XG4gICAgICAgbGVmdDogbyAmJiBvLnRvcCB8fDAgLFxuICAgICAgIHRvcDogIG8gJiYgIG8ubGVmdCB8fDBcbiAgICAgICB9Ki9cbiAgICB9ZWxzZSBpZihlbC5tb3ZlbWVudExpbWl0cy5jb25zdHJ1Y3RvciAhPT0gRnVuY3Rpb24pe1xuICAgICAgdmFyIGxpbSA9IGVsLm1vdmVtZW50TGltaXRzO1xuICAgICAgX3JlY3QgPSB7XG4gICAgICAgIGxlZnQ6ICAgbGltLmxlZnQgKiBsaW0uc2NhbGVYLFxuICAgICAgICB3aWR0aDogIGxpbS53aWR0aCAqIGxpbS5zY2FsZVggLFxuICAgICAgICB0b3A6ICAgIGxpbS50b3AgKiBsaW0uc2NhbGVZLFxuICAgICAgICBoZWlnaHQ6IGxpbS5oZWlnaHQgKiBsaW0uc2NhbGVZXG4gICAgICB9O1xuICAgICAgLy9tYXhTaXplID0gX3JlY3Q7XG4gICAgICAvLyBvZmZzZXRzID0gbGltO1xuICAgIH1cbiAgICBtYXhTaXplID0ge1xuICAgICAgd2lkdGg6IF9yZWN0LndpZHRoICogdGhpcy5maXRJbmRleCxcbiAgICAgIGhlaWdodDogX3JlY3QuaGVpZ2h0ICogdGhpcy5maXRJbmRleFxuICAgIH07XG4gICAgdmFyIHNpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyhlbCwgbWF4U2l6ZSwgJ2ZpdCcpO1xuXG4gICAgaWYoZWwucmVzaXphYmxlKXtcbiAgICAgIGVsLnNldE9wdGlvbnMoe1xuICAgICAgICB3aWR0aDogZWwud2lkdGggKiBzaXplLnNjYWxlLFxuICAgICAgICBoZWlnaHQ6IGVsLmhlaWdodCAqIHNpemUuc2NhbGVcbiAgICAgIH0pO1xuICAgICAgZWwudXBkYXRlRWxlbWVudCgpO1xuICAgIH1lbHNle1xuICAgICAgZWwuc2V0T3B0aW9ucyh7XG4gICAgICAgIHNjYWxlWDogc2l6ZS5zY2FsZSxcbiAgICAgICAgc2NhbGVZOiBzaXplLnNjYWxlXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5jZW50ZXJPYmplY3QoZWwpO1xuICAgIGVsLnNldENvb3JkcygpO1xuICAgIHRoaXMuZmlyZShcInNjYWxpbmdcIik7XG4gIH0sXG4gIC8vZml4IGdldGNlbnRlciBmdW5jdGlvblxuICBjZW50ZXJPYmplY3Q6IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICB2YXIgY2VudGVyO1xuICAgIGlmIChvYmplY3QubW92ZW1lbnRMaW1pdHMpIHtcblxuICAgICAgY2VudGVyID0gdGhpcy5fZ2V0TW92ZW1lbnRzTGltaXRzQ2VudGVyKG9iamVjdC5tb3ZlbWVudExpbWl0cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNlbnRlciA9IHRoaXMuZ2V0Q2VudGVyKCk7XG4gICAgfVxuICAgIHRoaXMuX2NlbnRlck9iamVjdChvYmplY3QsIG5ldyBmYWJyaWMuUG9pbnQoY2VudGVyLmxlZnQsIGNlbnRlci50b3ApKTtcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBnZXRDZW50ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0IC8gMiAvIHRoaXMuZ2V0Wm9vbSgpLFxuICAgICAgbGVmdDogdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGggLyAyIC8gdGhpcy5nZXRab29tKClcbiAgICB9O1xuICB9LFxuICBtb3ZlbWVudExpbWl0czoge1xuICAgIGxlZnQ6IGZhbHNlLFxuICAgIHRvcDogZmFsc2UsXG4gICAgcmlnaHQ6IGZhbHNlLFxuICAgIGJvdHRvbTogZmFsc2VcbiAgfSxcbiAgc2V0TW92ZW1lbnRMaW1pdHM6IGZ1bmN0aW9uIChfb2Zmc2V0cykge1xuICAgIHRoaXMubW92ZW1lbnRMaW1pdHMgPSBfb2Zmc2V0cztcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICAvL2NvbnRlbnQg0YXQvtGC0Y8g0LHRiyAg0L/QuNC60YHQtdC70Ywg0L7QsdGK0LXQutGC0LAg0LTQvtC70LbQtdC9INCx0YvRgtGMINCy0L3Rg9GC0YDQuCDQt9C+0L3Ri1xuICAvL2ZpdCDQt9C+0L3QsCDQtNC+0LvQttC90L4g0L/QvtC70L3QvtGB0YLRjNGOINC90LDRhdC+0LTQuNGC0YHRjyDQstC90YPRgtGA0Lgg0L7QsdGK0LXQutGC0LBcbiAgbW92ZW1lbnRMaW1pdE1vZGU6IFwiZml0XCIsXG4gIF9nZXRNb3ZlbWVudHNMaW1pdHNDZW50ZXI6IGZ1bmN0aW9uKG1vdmVtZW50TGltaXRzKXtcblxuICAgIGlmIChtb3ZlbWVudExpbWl0cyA9PT0gJ2NhbnZhcycpIHtcbiAgICAgIHZhciBvID0gdGhpcy5vZmZzZXRzO1xuICAgICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICAgICAgcmV0dXJuIHt0b3A6IG8udG9wICsgKF9oIC0gby50b3AgLSBvLmJvdHRvbSkgLzIgICwgbGVmdDogIG8ubGVmdCArIChfdyAtIG8ubGVmdCAtIG8ucmlnaHQpIC8yfTtcbiAgICB9XG5cbiAgICBpZih0eXBlb2YgbW92ZW1lbnRMaW1pdHMgPT0gXCJzdHJpbmdcIil7XG4gICAgICB2YXIgb2JqID0gdGhpcy5nZXRPYmplY3RCeUlEKG1vdmVtZW50TGltaXRzLnN1YnN0cigxKSk7XG4gICAgfWVsc2V7XG4gICAgICBvYmogPSBtb3ZlbWVudExpbWl0cztcbiAgICB9XG5cbiAgICB2YXIgX3h5ID0gb2JqLmdldENlbnRlclBvaW50KCk7XG4gICAgcmV0dXJuIHt0b3A6IF94eS55LCBsZWZ0OiBfeHkueH07XG4gIH0sXG4gIF9nZXRNb3ZlbWVudHNMaW1pdHNSZWN0OiBmdW5jdGlvbihtb3ZlbWVudExpbWl0cyl7XG5cbiAgICB2YXIgbyA9IHRoaXMub2Zmc2V0cztcbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG4gICAgaWYobW92ZW1lbnRMaW1pdHMuY29uc3RydWN0b3IgPT0gT2JqZWN0KXtcbiAgICAgIHJldHVybiBtb3ZlbWVudExpbWl0cztcbiAgICB9XG5cbiAgICB2YXIgc2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuXG4gICAgaWYgKG1vdmVtZW50TGltaXRzID09PSAnY2FudmFzJykge1xuXG4gICAgICB2YXIgcmVjdCA9IHtcbiAgICAgICAgbGVmdDogby5sZWZ0LFxuICAgICAgICB0b3A6IG8udG9wLFxuICAgICAgICB3aWR0aDogX3cgLSBvLmxlZnQgLSBvLnJpZ2h0LFxuICAgICAgICBoZWlnaHQ6IF9oIC0gby50b3AgLSBvLmJvdHRvbSxcbiAgICAgICAgcmlnaHQ6IG8ucmlnaHQsXG4gICAgICAgIGJvdHRvbTogby5ib3R0b21cbiAgICAgIH1cblxuICAgICAgcmVjdC53aWR0aCAqPSBzY2FsZTtcbiAgICAgIHJlY3QuaGVpZ2h0ICo9IHNjYWxlO1xuICAgICAgcmV0dXJuIHJlY3Q7XG4gICAgfVxuXG5cbiAgICBpZihtb3ZlbWVudExpbWl0cy5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLmdldE9iamVjdEJ5SUQobW92ZW1lbnRMaW1pdHMuc3Vic3RyKDEpKTtcbiAgICAgIGlmKCFvYmope1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfWVsc2Uge1xuICAgICAgb2JqID0gbW92ZW1lbnRMaW1pdHNcbiAgICB9XG5cbiAgICB2YXIgX3N0cm9rZV93aWR0aCA9IG9iai5zdHJva2VXaWR0aDtcbiAgICBvYmouc3Ryb2tlV2lkdGggPSAwO1xuXG4gICAgb2JqLnNldENvb3JkcygpO1xuICAgIHZhciByZWN0ID0gb2JqLmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgb2JqLnN0cm9rZVdpZHRoID0gX3N0cm9rZV93aWR0aDtcblxuICAgIHJlY3QubGVmdCAvPSBzY2FsZTtcbiAgICByZWN0LnRvcCAvPSBzY2FsZTtcbiAgICByZWN0LndpZHRoIC89IHNjYWxlO1xuICAgIHJlY3QuaGVpZ2h0IC89IHNjYWxlO1xuICAgIHJlY3QubGVmdCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIC8gc2NhbGU7XG4gICAgcmVjdC50b3AgLT0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSAvIHNjYWxlO1xuXG4gICAgLy9yZWN0LmxlZnQgICArPSBzdyAvMjtcbiAgICAvL3JlY3QudG9wICAgICs9IHN3IC8yO1xuICAgIC8vcmVjdC53aWR0aCAgLT0gc3c7XG4gICAgLy9yZWN0LmhlaWdodCAtPSBzdztcblxuICAgIHJlY3QucmlnaHQgPSBfdyAtIChyZWN0LmxlZnQgKyByZWN0LndpZHRoKTtcbiAgICByZWN0LmJvdHRvbSA9IF9oIC0gKHJlY3QudG9wICsgcmVjdC5oZWlnaHQpO1xuXG4gICAgcmV0dXJuIHJlY3Q7XG4gIH0sXG4gIGNvbnRlbnRPZmZzZXRzIDogNSxcblxuICBnZXRGaXhlZFBvc2l0aW9uOiBmdW5jdGlvbiAodGFyZ2V0LCB4LCB5KSB7XG5cblxuICAgIGxldCBfdHJhbnNsYXRlZFggPSAwLFxuICAgICAgX3RyYW5zbGF0ZWRZID0gMCxcbiAgICAgIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQsXG4gICAgICBzY2FsZSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG5cbiAgICBpZih0aGlzLl9jdXJyZW50VHJhbnNmb3JtKXtcbiAgICAgIF90cmFuc2xhdGVkWCA9IHggLSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLmxhc3RYO1xuICAgICAgX3RyYW5zbGF0ZWRZID0geSAtIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ubGFzdFk7XG4gICAgfVxuXG4gICAgLy8gY29uc29sZS5sb2coX3RyYW5zbGF0ZWRYLF90cmFuc2xhdGVkWSk7XG5cbiAgICBpZiAoeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB4ID0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHkgPSB0YXJnZXQudG9wO1xuICAgIH1cbiAgICAvLyB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgLy8gdmFyIGJvdW5kcyA9IHRhcmdldC5nZXRCb3VuZGluZ1JlY3QoKTtcblxuICAgIHZhciBicmVjdCA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0gJiYgdGhpcy5fY3VycmVudFRyYW5zZm9ybS5fYm91bmRpbmdfcmVjdCB8fCB0YXJnZXQuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgdmFyIGJvdW5kcyA9IHtcbiAgICAgIGxlZnQgOiAoYnJlY3QubGVmdCArIF90cmFuc2xhdGVkWCAtIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0pIC8gc2NhbGUsXG4gICAgICB0b3AgOiAoYnJlY3QudG9wICsgX3RyYW5zbGF0ZWRZIC0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSkgLyBzY2FsZSxcbiAgICAgIHdpZHRoOiBicmVjdC53aWR0aCAvIHNjYWxlLFxuICAgICAgaGVpZ2h0OiBicmVjdC5oZWlnaHQgLyBzY2FsZVxuICAgIH07XG5cbiAgICAvLyBib3VuZHMubGVmdCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIC8gc2NhbGU7XG4gICAgLy8gYm91bmRzLnRvcCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIC8gc2NhbGU7XG4gICAgYm91bmRzLnJpZ2h0ID0gX3cgLSAoYm91bmRzLmxlZnQgKyBib3VuZHMud2lkdGgpO1xuICAgIGJvdW5kcy5ib3R0b20gPSBfaCAtIChib3VuZHMudG9wICsgYm91bmRzLmhlaWdodCk7XG5cbiAgICB2YXIgbGltaXRzID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSAmJiB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm1vdmVtZW50TGltaXRzO1xuICAgIGlmKCFsaW1pdHMpe1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICAvLyB2YXIgbGltaXRzID0gcmVjdCB8fCB0aGlzLm1vdmVtZW50TGltaXRzO1xuXG4gICAgbGV0IG5ld1BvcyA9IHt9LFxuICAgICAgX2wgPSBsaW1pdHMubGVmdCxcbiAgICAgIF9yID0gbGltaXRzLnJpZ2h0LFxuICAgICAgX3QgPSBsaW1pdHMudG9wLFxuICAgICAgX2IgPSBsaW1pdHMuYm90dG9tO1xuXG4gICAgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSA9PT0gXCJjb250ZW50XCIpIHtcbiAgICAgIF9sIC09IGJvdW5kcy53aWR0aCAtIHRoaXMuY29udGVudE9mZnNldHNcbiAgICAgIF9yIC09IGJvdW5kcy53aWR0aCAtIHRoaXMuY29udGVudE9mZnNldHNcbiAgICAgIF90IC09IGJvdW5kcy5oZWlnaHQgLSB0aGlzLmNvbnRlbnRPZmZzZXRzXG4gICAgICBfYiAtPSBib3VuZHMuaGVpZ2h0IC0gdGhpcy5jb250ZW50T2Zmc2V0c1xuICAgIH1cblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgPT09IFwiZml0XCIgJiYgIXRhcmdldC5yZXNpemFibGUpIHtcbiAgICAgIGlmIChfbCAhPT0gZmFsc2UgJiYgX3IgIT09IGZhbHNlKSB7XG4gICAgICAgIF93ID0gX3cgLSBfbCAtIF9yO1xuICAgICAgICBpZiAoYm91bmRzLndpZHRoID4gX3cpIHtcbiAgICAgICAgICB2YXIgX2FzcCA9IF93IC8gYm91bmRzLndpZHRoO1xuICAgICAgICAgIG5ld1Bvcy5zY2FsZVggPSBfYXNwO1xuICAgICAgICAgIG5ld1Bvcy5zY2FsZVkgPSBfYXNwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChfdCAhPT0gZmFsc2UgJiYgX2IgIT09IGZhbHNlKSB7XG4gICAgICAgIF9oID0gX2ggLSBfdCAtIF9iO1xuICAgICAgICBpZiAoYm91bmRzLmhlaWdodCA+IF9oKSB7XG4gICAgICAgICAgdmFyIF9hc3AgPSBfaCAvIGJvdW5kcy5oZWlnaHQ7XG4gICAgICAgICAgdGFyZ2V0LnNjYWxlWCAqPSBfYXNwO1xuICAgICAgICAgIHRhcmdldC5zY2FsZVkgKj0gX2FzcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgPT09IFwiZml0XCIgfHwgdGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlID09PSBcImNvbnRlbnRcIikge1xuXG4gICAgICBpZiAoX2wgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfZGlmZiA9IF9sIC0gYm91bmRzLmxlZnQ7XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MubGVmdCA9IHggKyBfZGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIW5ld1Bvcy5sZWZ0ICYmIF9yICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfciAtIGJvdW5kcy5yaWdodDtcbiAgICAgICAgaWYgKF9kaWZmID4gMCkge1xuICAgICAgICAgIG5ld1Bvcy5sZWZ0ID0geCAtIF9kaWZmO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChfdCAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9kaWZmID0gX3QgLSBib3VuZHMudG9wO1xuICAgICAgICBpZiAoX2RpZmYgPiAwKSB7XG4gICAgICAgICAgbmV3UG9zLnRvcCA9IHkgKyBfZGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIW5ld1Bvcy50b3AgJiYgX2IgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfZGlmZiA9IF9iIC0gYm91bmRzLmJvdHRvbTtcbiAgICAgICAgaWYgKF9kaWZmID4gMCkge1xuICAgICAgICAgIG5ld1Bvcy50b3AgPSB5IC0gX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH1cblxuICAgIHJldHVybiBuZXdQb3M7XG4gIH0sXG5cblxuICAvLyBfcmVzdG9yZU9yaWdpblhZTmF0aXZlOiBfcmVzdG9yZU9yaWdpblhZTmF0aXZlLFxuICAvLyBfcmVzdG9yZU9yaWdpblhZOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gIC8vICAgdGhpcy5fcmVzdG9yZU9yaWdpblhZTmF0aXZlKHRhcmdldCk7XG4gIC8vXG4gIC8vICAgLy8gaWYgKHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKSB7XG4gIC8vICAgLy8gICB0YXJnZXQubGVmdCA9IE1hdGgucm91bmQodGFyZ2V0LmxlZnQpO1xuICAvLyAgIC8vICAgdGFyZ2V0LnRvcCA9IE1hdGgucm91bmQodGFyZ2V0LnRvcCk7XG4gIC8vICAgLy8gfVxuICAvLyB9LFxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwb3NpdGlvbiBvZiB0aGUgb2JqZWN0IHRha2luZyBpbnRvIGNvbnNpZGVyYXRpb24gdGhlIG9iamVjdCdzIG9yaWdpblxuICAgKiBAcGFyYW0ge2ZhYnJpYy5Qb2ludH0gcG9zIFRoZSBuZXcgcG9zaXRpb24gb2YgdGhlIG9iamVjdFxuICAgKiBAcGFyYW0ge1N0cmluZ30gb3JpZ2luWCBIb3Jpem9udGFsIG9yaWdpbjogJ2xlZnQnLCAnY2VudGVyJyBvciAncmlnaHQnXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBvcmlnaW5ZIFZlcnRpY2FsIG9yaWdpbjogJ3RvcCcsICdjZW50ZXInIG9yICdib3R0b20nXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBzZXRQb3NpdGlvbkJ5T3JpZ2luOiBmdW5jdGlvbiAocG9zLCBvcmlnaW5YLCBvcmlnaW5ZKSB7XG4gICAgdmFyIGNlbnRlciA9IHRoaXMudHJhbnNsYXRlVG9DZW50ZXJQb2ludChwb3MsIG9yaWdpblgsIG9yaWdpblkpLFxuICAgICAgcG9zaXRpb24gPSB0aGlzLnRyYW5zbGF0ZVRvT3JpZ2luUG9pbnQoY2VudGVyLCB0aGlzLm9yaWdpblgsIHRoaXMub3JpZ2luWSk7XG5cbiAgICAvLyBpZiAodGhpcy53aG9sZUNvb3JkaW5hdGVzKSB7XG4gICAgLy8gICBwb3NpdGlvbi54ID0gTWF0aC5yb3VuZChwb3NpdGlvbi54KTtcbiAgICAvLyAgIHBvc2l0aW9uLnkgPSBNYXRoLnJvdW5kKHBvc2l0aW9uLnkpO1xuICAgIC8vIH1cbiAgICB0aGlzLnNldCgnbGVmdCcsIHBvc2l0aW9uLngpO1xuICAgIHRoaXMuc2V0KCd0b3AnLCBwb3NpdGlvbi55KTtcbiAgfVxufSk7XG5cbnZhciBfdHJhbnNsYXRlT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3RyYW5zbGF0ZU9iamVjdDtcbnZhciBfYmVmb3JlU2NhbGVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fYmVmb3JlU2NhbGVUcmFuc2Zvcm07XG52YXIgX2JlZm9yZVRyYW5zZm9ybV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9iZWZvcmVUcmFuc2Zvcm07XG52YXIgX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZSA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9yZXN0b3JlT3JpZ2luWFk7XG52YXIgX3NldHVwQ3VycmVudFRyYW5zZm9ybU5hdGl2ZSA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9zZXR1cEN1cnJlbnRUcmFuc2Zvcm07XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIF9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbjogX2JlZm9yZVNjYWxlVHJhbnNmb3JtX292ZXJ3cml0dGVuLFxuICBfc2V0dXBDdXJyZW50VHJhbnNmb3JtX292ZXJ3cml0dGVuOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2V0dXBDdXJyZW50VHJhbnNmb3JtLFxuICBfYmVmb3JlU2NhbGVUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0pIHtcbiAgICB0aGlzLl9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbihlLCB0cmFuc2Zvcm0pO1xuICAgIGlmICghdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC5vQ29vcmRzKSB7XG4gICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9yaWdpbmFsLm9Db29yZHMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0Lm9Db29yZHMpO1xuICAgIH1cbiAgfSxcbiAgX3NldHVwQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIHRoaXMuX3NldHVwQ3VycmVudFRyYW5zZm9ybV9vdmVyd3JpdHRlbihlLHRhcmdldCk7XG4gICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybS5fYm91bmRpbmdfcmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm1vdmVtZW50TGltaXRzID0gdGhpcy5fZ2V0TW92ZW1lbnRzTGltaXRzUmVjdCh0YXJnZXQubW92ZW1lbnRMaW1pdHMgfHwgdGhpcy5tb3ZlbWVudExpbWl0cyk7XG4gIH0sXG4gIGdldEZpeGVkUG9zaXRpb25FYXN5OiBmdW5jdGlvbiAodGFyZ2V0LCB4LCB5KSB7XG4gICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcblxuICAgIGlmICh4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHggPSB0YXJnZXQubGVmdDtcbiAgICB9XG4gICAgaWYgKHkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgeSA9IHRhcmdldC50b3A7XG4gICAgfVxuICAgIHZhciBzY2FsZSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuICAgIHRhcmdldC5yaWdodCA9IF93IC0gKHRhcmdldC5sZWZ0ICsgdGFyZ2V0LndpZHRoKTtcbiAgICB0YXJnZXQuYm90dG9tID0gX2ggLSAodGFyZ2V0LnRvcCArIHRhcmdldC5oZWlnaHQpO1xuXG4gICAgdmFyIF9kaWZmLCBfYXNwLCByZWN0O1xuICAgIHZhciBuZXdQb3MgPSB7XG4gICAgICBsZWZ0OiB4LFxuICAgICAgdG9wOiB5LFxuICAgICAgd2lkdGg6IHRhcmdldC53aWR0aCxcbiAgICAgIGhlaWdodDogdGFyZ2V0LmhlaWdodFxuICAgIH07XG5cbiAgICBpZiAodGFyZ2V0LndpZHRoID4gX3cpIHtcbiAgICAgIG5ld1Bvcy53aWR0aCA9IF93O1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LmhlaWdodCA+IF9oKSB7XG4gICAgICBuZXdQb3MuaGVpZ2h0ID0gX2g7XG4gICAgfVxuICAgIGlmICh0YXJnZXQubGVmdCA8IDApIHtcbiAgICAgIG5ld1Bvcy53aWR0aCArPSB0YXJnZXQubGVmdDtcbiAgICAgIG5ld1Bvcy5sZWZ0IC09IHRhcmdldC5sZWZ0O1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LnJpZ2h0IDwgMCkge1xuICAgICAgbmV3UG9zLndpZHRoICs9IHRhcmdldC5yaWdodDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC50b3AgPCAwKSB7XG4gICAgICBuZXdQb3MuaGVpZ2h0ICs9IHRhcmdldC50b3A7XG4gICAgfVxuICAgIGlmICh0YXJnZXQuYm90dG9tIDwgMCkge1xuICAgICAgbmV3UG9zLmhlaWdodCArPSB0YXJnZXQuYm90dG9tO1xuICAgIH1cbiAgICByZXR1cm4gbmV3UG9zO1xuICB9LFxuICAvKipcbiAgICog0YTRg9C90LrRhtC40Y4g0LzQvtC20L3QviDQstGL0LfQstCw0YLRjCDRgSDQtdCy0LXQvdGC0L7QvCAgJ2FmdGVyOnJlbmRlcicuINCf0L7Qt9Cy0L7Qu9GP0LXRgiDQvtGC0L7QsdGA0LDQttCw0YLRjCDQstGL0YfQuNGB0LvQtdC90LjRjyDQv9C10YDQtdGB0LXRh9C10L3QuNC5INC40LfQvNC10L3Rj9C10LzQvtCz0L4g0L7QsdGK0LXQutGC0LAg0YEg0YDQsNC80LrQvtC5LiDQstGL0LTQtdC70Y/QtdGCINC60YDQsNGB0L3Ri9C80Lgg0LvQuNC40L3QuNGP0LhcbiAgICogQHByaXZhdGVcbiAgICogQGV4YW1wbGVcbiAgICogIGV2ZW50TGlzdGVuZXJzIDoge1xuICAgIENhbnZhczoge1xuICAgICAgJ2JlZm9yZTpyZW5kZXInOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmNsZWFyQ29udGV4dCh0aGlzLmNvbnRleHRUb3ApO1xuICAgICAgfSxcbiAgICAgICdhZnRlcjpyZW5kZXInOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLl9kZWJ1Z19pbnRlcnNlY3Rpb25zKClcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgICovXG4gIGRyYXdJbnRlcmVzdGlvbkxpbmVzOiBmdW5jdGlvbigpe1xuICAgIHZhciB0ciA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm07XG4gICAgaWYgKHRyICYmIHRyLl9pbnRlcnNlY3Rpb25zKSB7XG4gICAgICB2YXIgY3R4ID0gdGhpcy5jb250ZXh0VG9wO1xuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJyZWRcIjtcbiAgICAgIGZvcih2YXIgaSBpbiB0ci5faW50ZXJzZWN0aW9ucyl7XG4gICAgICAgIHZhciBfY29vcmQgPSB0ci5faW50ZXJzZWN0aW9uc1tpXTtcbiAgICAgICAgY3R4Lm1vdmVUbyhfY29vcmQueCArIDUsIF9jb29yZC55KTtcbiAgICAgICAgY3R4LmFyYyhfY29vcmQueCwgX2Nvb3JkLnksIDUsIDAsIDIgKiBNYXRoLlBJKTtcbiAgICAgIH1cbiAgICAgIGZvcih2YXIgaSBpbiB0ci5saW5lcyl7XG4gICAgICAgIHZhciBfbCA9IHRyLmxpbmVzW2ldO1xuICAgICAgICBjdHgubW92ZVRvKF9sWzBdLngsX2xbMF0ueSk7XG4gICAgICAgIGN0eC5saW5lVG8oX2xbMV0ueCxfbFsxXS55KTtcbiAgICAgIH1cbiAgICAgIGZvcih2YXIgaSBpbiB0ci5tbExpbmVzKXtcbiAgICAgICAgdmFyIF9sID0gdHIubWxMaW5lc1tpXTtcbiAgICAgICAgY3R4Lm1vdmVUbyhfbFswXS54LF9sWzBdLnkpO1xuICAgICAgICBjdHgubGluZVRvKF9sWzFdLngsX2xbMV0ueSk7XG4gICAgICB9XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgfVxuICB9LFxuICBfc2NhbGVPYmplY3RFYXN5OiBmdW5jdGlvbiAoeCwgeSwgYnkpIHtcbiAgICAvL19zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgICB2YXIgdHIgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLFxuICAgICAgdGFyZ2V0ID0gdHIudGFyZ2V0LFxuICAgICAgY29ybmVyID0gdHIuY29ybmVyO1xuICAgIGlmKCF0YXJnZXQubW92ZW1lbnRMaW1pdHMpe1xuICAgICAgcmV0dXJuIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgseSwgYnkpO1xuICAgIH1cblxuXG4gICAgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSAhPT0gJ2ZpdCcpcmV0dXJuO1xuICAgIHggPSBNYXRoLm1pbih0YXJnZXQubW92ZW1lbnRMaW1pdHMud2lkdGgsIE1hdGgubWF4KDAseCkpO1xuICAgIHkgPSBNYXRoLm1pbih0YXJnZXQubW92ZW1lbnRMaW1pdHMuaGVpZ2h0LCBNYXRoLm1heCgwLHkpKTtcbiAgICBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LHksIGJ5KTtcbiAgfSxcbiAgLyoqXG4gICAqIFNjYWxlcyBvYmplY3QgYnkgaW52b2tpbmcgaXRzIHNjYWxlWC9zY2FsZVkgbWV0aG9kc1xuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0geCBwb2ludGVyJ3MgeCBjb29yZGluYXRlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB5IHBvaW50ZXIncyB5IGNvb3JkaW5hdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGJ5IEVpdGhlciAneCcgb3IgJ3knIC0gc3BlY2lmaWVzIGRpbWVuc2lvbiBjb25zdHJhaW50IGJ5IHdoaWNoIHRvIHNjYWxlIGFuIG9iamVjdC5cbiAgICogICAgICAgICAgICAgICAgICAgIFdoZW4gbm90IHByb3ZpZGVkLCBhbiBvYmplY3QgaXMgc2NhbGVkIGJ5IGJvdGggZGltZW5zaW9ucyBlcXVhbGx5XG4gICAqL1xuICBfc2NhbGVPYmplY3Q6IGZ1bmN0aW9uICh4LCB5LCBieSkge1xuICAgIHZhciBfc2NhbGVkID0gX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuXG4gICAgdmFyIHRyID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSxcbiAgICAgIHRhcmdldCA9IHRyLnRhcmdldCxcbiAgICAgIGNvcm5lciA9IHRyLmNvcm5lcjtcbiAgICB2YXIgX3YgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtO1xuXG4gICAgaWYgKCF0YXJnZXQubW92ZW1lbnRMaW1pdHMgfHwgdGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlICE9PSBcImZpdFwiKXtcbiAgICAgIHJldHVybiBfc2NhbGVkO1xuICAgIH1cbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG5cbiAgICB2YXIgX3NjYWxlID0gdGhpcy5nZXRab29tKCk7XG5cbiAgICBpZih0YXJnZXQubW92ZW1lbnRMaW1pdHMgPT0gdGhpcyl7XG4gICAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG4gICAgICB2YXIgX2wgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIDtcbiAgICAgIHZhciBfdCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gO1xuICAgICAgX3cgKj0gX3NjYWxlO1xuICAgICAgX2ggKj0gX3NjYWxlO1xuICAgICAgdmFyIF9yYyA9IHtcbiAgICAgICAgdGw6IHt4OiBfbCwgeTogX3R9LFxuICAgICAgICB0cjoge3g6IF9sICsgX3csIHk6IF90fSxcbiAgICAgICAgYmw6IHt4OiBfbCwgeTogX3QgKyBfaH0sXG4gICAgICAgIGJyOiB7eDogX2wgKyBfdywgeTogX3QgKyBfaH1cbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHRhcmdldC5tb3ZlbWVudExpbWl0cy5zZXRDb29yZHMoKTtcbiAgICAgIHZhciBfcmMgPSB0YXJnZXQubW92ZW1lbnRMaW1pdHMub0Nvb3JkcztcbiAgICB9XG5cblxuICAgIGlmICghdHIucG9pbnRlck9mZnNldCkge1xuICAgICAgdHIucG9pbnRlck9mZnNldCA9IHtcbiAgICAgICAgeDogeCAqIF92WzBdIC0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyXS54LFxuICAgICAgICB5OiB5ICogX3ZbM10gLSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXJdLnlcbiAgICAgIH1cblxuICAgICAgdHIucG9pbnRDZW50ZXIgPSB0YXJnZXQuZ2V0Q2VudGVyUG9pbnQoKTtcbiAgICAgIHRyLnBvaW50Q2VudGVyLnggKj0gX3NjYWxlO1xuICAgICAgdHIucG9pbnRDZW50ZXIueSAqPSBfc2NhbGU7XG4gICAgICB0ci5wb2ludE9yaWdpbmFsID0gdHIub3JpZ2luYWwub0Nvb3Jkc1tjb3JuZXJdO1xuICAgIH1cblxuICAgIHRyLnBvaW50VHJhbmZvcm1lZCA9IHRhcmdldC5vQ29vcmRzW2Nvcm5lcl07XG5cbiAgICB0ci5tbExpbmVzID0gW107XG4gICAgdHIubGluZXMgPSBbXTtcbiAgICBmdW5jdGlvbiBfaW50ZXJzZWN0aW9uKGNvcm5lciwgY29vcmRpbmF0ZSkge1xuICAgICAgdmFyIF9vYztcbiAgICAgIGlmIChjb29yZGluYXRlID09IFwieFwiICYmIGNvcm5lclswXSAhPSBcIm1cIikge1xuICAgICAgICBfb2MgPSB0ci5vcmlnaW5hbC5vQ29vcmRzW1wibVwiICsgY29ybmVyWzBdXTtcbiAgICAgIH0gZWxzZSBpZiAoY29vcmRpbmF0ZSA9PSBcInlcIiAmJiBjb3JuZXJbMF0gIT0gXCJtXCIpIHtcbiAgICAgICAgX29jID0gdHIub3JpZ2luYWwub0Nvb3Jkc1tcIm1cIiArIGNvcm5lclsxXV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfb2MgPSB0ci5wb2ludENlbnRlcjtcbiAgICAgICAgX29jID0ge1xuICAgICAgICAgIHg6IF9vYy54ICsgX3ZbNF0sXG4gICAgICAgICAgeTogX29jLnkgKyBfdls1XVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdmFyIF90YyA9IHRhcmdldC5vQ29vcmRzW2Nvcm5lcl07XG5cbiAgICAgIHRyLmxpbmVzLnB1c2goW19vYywgX3RjXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy50bCwgX3JjLnRyXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy50ciwgX3JjLmJyXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy5iciwgX3JjLmJsXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy5ibCwgX3JjLnRsXSk7XG5cbiAgICAgIHZhciBpbnRlcnMgPSBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdExpbmVQb2x5Z29uKF9vYywgX3RjLCBbX3JjLnRsLCBfcmMudHIsIF9yYy5iciwgX3JjLmJsXSk7XG4gICAgICBpZiAoIWludGVycy5wb2ludHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGludGVycy5wb2ludHNbMF0uY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG4gICAgICB0ci5faW50ZXJzZWN0aW9ucy5wdXNoKGludGVycy5wb2ludHNbMF0pXG5cbi8vICAgICAgICAgaWYgKGNvb3JkaW5hdGUpIHtcbi8vICAgICAgICAgICB2YXIgcDEgPSBpbnRlcnMucG9pbnRzWzBdO1xuXG4vLyAgICAgICAgICAgdmFyIGNvcm5lcjI7XG4vLyAgICAgICAgICAgaWYgKGNvb3JkaW5hdGUgPT0gXCJ4XCIpIHtcbi8vICAgICAgICAgICAgIGNvcm5lcjIgPSAoY29ybmVyWzBdID09IFwidFwiID8gXCJiXCIgOiBcInRcIikgKyBjb3JuZXJbMV07XG4vLyAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgIGNvcm5lcjIgPSBjb3JuZXJbMF0gKyAoY29ybmVyWzFdID09IFwibFwiID8gXCJyXCIgOiBcImxcIik7XG4vLyAgICAgICAgICAgfVxuLy8gICAgICAgICAgIHZhciBfcDIgPSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXIyXTtcbi8vICAgICAgICAgICB2YXIgX2RpZmYgPSB7eDogX3RjLnggLSBwMS54LCB5OiBfdGMueSAtIHAxLnl9O1xuXG4vLyAgICAgICAgICAgdmFyIHAyID0ge1xuLy8gICAgICAgICAgICAgeDogX3AyLnggLSBfZGlmZi54LFxuLy8gICAgICAgICAgICAgeTogX3AyLnkgLSBfZGlmZi55XG4vLyAgICAgICAgICAgfTtcblxuLy8gICAgICAgICAgIHZhciBpdHMgPSBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdExpbmVMaW5lKHRyLnBvaW50Q2VudGVyLCB0ci5wb2ludFRyYW5mb3JtZWQsIHAxLCBwMik7XG4vLyAgICAgICAgICAgaWYgKCFpdHMucG9pbnRzWzBdKSB7XG4vLyAgICAgICAgICAgICByZXR1cm47XG4vLyAgICAgICAgICAgfVxuLy8gICAgICAgICAgIHRyLl9pbnRlcnNlY3Rpb25zLnB1c2goaXRzLnBvaW50c1swXSk7XG4vLyAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgdHIuX2ludGVyc2VjdGlvbnMucHVzaChpbnRlcnMucG9pbnRzWzBdKTtcbi8vICAgICAgICAgfVxuXG5cbiAgICAgIC8vXG4gICAgICAvL2lmKGludGVycy5wb2ludHMubGVuZ3RoKXtcbiAgICAgIC8vICBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBpbnRlcnMucG9pbnRzWzBdLngsICBpbnRlcnMucG9pbnRzWzBdLnksIGJ5KTtcbiAgICAgIC8vICB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgICAvL31lbHNle1xuICAgICAgLy8gIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgICAgIC8vfVxuICAgIH1cblxuXG4gICAgdHIuX2ludGVyc2VjdGlvbiA9IG51bGw7XG4gICAgdHIuX2ludGVyc2VjdGlvbnMgPSBbXTtcbiAgICBzd2l0Y2ggKGNvcm5lcikge1xuICAgICAgY2FzZSBcInRsXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwidHJcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ5XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIiwgXCJ4XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJiclwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0clwiLCBcInhcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImJsXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRsXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXRcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcIm10XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ5XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtYlwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwibWJcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiLCBcInlcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1yXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJtclwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIsIFwieFwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibWxcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcIm1sXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYmxcIiwgXCJ4XCIpO1xuICAgIH1cblxuICAgIGlmICghdHIuX2ludGVyc2VjdGlvbnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gX3NjYWxlZDtcbiAgICB9XG5cblxuICAgIHZhciBfbmV3WFkgPSB0ci5faW50ZXJzZWN0aW9uc1swXTtcbiAgICB2YXIgX2wgPSB0ci5faW50ZXJzZWN0aW9uc1swXS5kaXN0YW5jZUZyb20odHIucG9pbnRPcmlnaW5hbCk7XG5cbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRyLl9pbnRlcnNlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgX2wyID0gdHIuX2ludGVyc2VjdGlvbnNbaV0uZGlzdGFuY2VGcm9tKHRyLnBvaW50T3JpZ2luYWwpO1xuICAgICAgaWYgKF9sMiA8IF9sKSB7XG4gICAgICAgIF9uZXdYWSA9IHRyLl9pbnRlcnNlY3Rpb25zW2ldO1xuICAgICAgICBfbCA9IF9sMjtcbiAgICAgIH1cbiAgICB9XG4gICAgdHIuX2ludGVyc2VjdGlvbiA9IF9uZXdYWTtcblxuXG4gICAgaWYgKGJ5ID09IFwiZXF1YWxseVwiKSB7XG4gICAgICAvL2J5ID0gZmFsc2U7XG5cbiAgICAgIHZhciBfZGlmZjIgPSB7eDogX25ld1hZLnggLSB0ci5wb2ludENlbnRlci54LCB5OiBfbmV3WFkueSAtIHRyLnBvaW50Q2VudGVyLnl9O1xuICAgICAgdmFyIF9sID0gTWF0aC5zcXJ0KF9kaWZmMi54ICogX2RpZmYyLnggKyBfZGlmZjIueSAqIF9kaWZmMi55KTtcblxuICAgICAgX25ld1hZLnggLT0gX2RpZmYyLnggLyBfbCAqIHRhcmdldC5zdHJva2VXaWR0aDtcbiAgICAgIF9uZXdYWS55IC09IF9kaWZmMi55IC8gX2wgKiB0YXJnZXQuc3Ryb2tlV2lkdGg7XG4gICAgICAvLyBzY3J0KHgqeCArIHkqeSkgPSBhdHJva2V3aWR0aFxuICAgICAgdmFyIGEgPSAxO1xuICAgIH1cbiAgICAvL3JldHVybiBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG4gICAgdmFyIF9feCA9IChfbmV3WFkueCArIHRyLnBvaW50ZXJPZmZzZXQueCApIC8gX3ZbMF07XG4gICAgdmFyIF9feSA9IChfbmV3WFkueSArIHRyLnBvaW50ZXJPZmZzZXQueSApIC8gX3ZbM107XG4gICAgcmV0dXJuIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIF9feCwgX195LCBieSk7XG5cbiAgICAvL1xuICAgIC8vaWYgKGNvcm5lciA9PSBcImJyXCIgfHwgY29ybmVyID09IFwidHJcIiB8fCBjb3JuZXIgPT0gXCJtclwiKSB7XG4gICAgLy8gIGlmICh4IDwgdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0KSB7XG4gICAgLy8gICAgeCA9IHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vaWYgKGNvcm5lciA9PSBcImJsXCIgfHwgY29ybmVyID09IFwidGxcIiB8fCBjb3JuZXIgPT0gXCJtbFwiKSB7XG4gICAgLy8gIGlmICh4ID4gdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0KSB7XG4gICAgLy8gICAgeCA9IHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vaWYgKGNvcm5lciA9PSBcImJsXCIgfHwgY29ybmVyID09IFwiYnJcIiB8fCBjb3JuZXIgPT0gXCJtYlwiKSB7XG4gICAgLy8gIGlmICh5IDwgdGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0KSB7XG4gICAgLy8gICAgeSA9IHRhcmdldC5tb3ZlbWVudFlNYXhMaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vaWYgKGNvcm5lciA9PSBcInRsXCIgfHwgY29ybmVyID09IFwidHJcIiB8fCBjb3JuZXIgPT0gXCJtdFwiKSB7XG4gICAgLy8gIGlmICh5ID4gdGFyZ2V0Lm1vdmVtZW50WU1pbkxpbWl0KSB7XG4gICAgLy8gICAgeSA9IHRhcmdldC5tb3ZlbWVudFlNaW5MaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vXG4gICAgLy9fc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG4gIH0sXG4gIG1vdmVtZW50TGltaXRzT25BZGRBY3Rpb246ICd0cmFuc2xhdGUnLFxuICBfY2hlY2tfb2JqZWN0X2FmdGVyX21vZGlmaWVkOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgaWYgKCF0aGlzLl9jdXJyZW50VHJhbnNmb3JtKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBwb3MgPSB0aGlzLmdldEZpeGVkUG9zaXRpb24odGFyZ2V0LCB0YXJnZXQubGVmdCwgdGFyZ2V0LnRvcCk7XG5cbiAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0uY29ybmVyKSB7XG4gICAgICBjYXNlIFwibXRyXCI6XG4gICAgICAgIGlmIChwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGFyZ2V0LnNldCgnbGVmdCcsIHBvcy5sZWZ0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocG9zLnRvcCkge1xuICAgICAgICAgIHRhcmdldC5zZXQoJ3RvcCcsIHBvcy50b3ApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1yXCI6XG4gICAgICBjYXNlIFwiYnJcIjpcbiAgICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB2YXIgX2xkaWZmID0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcblxuICAgICAgICB9XG4gICAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB2YXIgX3RkaWZmID0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoX2xkaWZmICYmICghX3RkaWZmIHx8IE1hdGguYWJzKF9sZGlmZikgPiBNYXRoLmFicyhfdGRpZmYpKSkge1xuICAgICAgICAgIGlmIChfbGRpZmYgPCAwKSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggKz0gX2xkaWZmO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggLT0gX2xkaWZmO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChfdGRpZmYpIHtcbiAgICAgICAgICBpZiAoX3RkaWZmIDwgMCkge1xuICAgICAgICAgICAgdGFyZ2V0LndpZHRoICs9IF90ZGlmZjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0LndpZHRoIC09IF90ZGlmZjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIC8vY29uc29sZS5sb2cocG9zLF9sZGlmZixfdGRpZmYpXG4gICAgfVxuICAgIC8vIHRoaXMuX2NoZWNrX29iamVjdF9wb3NpdGlvbih0YXJnZXQpXG4gIH0sXG4gIF9jaGVja19vYmplY3RfcG9zaXRpb246IGZ1bmN0aW9uICh0YXJnZXQpIHtcblxuICAgIHZhciBwb3MgPSB0aGlzLmdldEZpeGVkUG9zaXRpb24odGFyZ2V0LCB0YXJnZXQubGVmdCwgdGFyZ2V0LnRvcCk7XG4gICAgaWYgKHRoaXMubW92ZW1lbnRMaW1pdHNPbkFkZEFjdGlvbiA9PSAndHJhbnNsYXRlJykge1xuICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGFyZ2V0LnNldCgnbGVmdCcsIHBvcy5sZWZ0KTtcbiAgICAgIH1cbiAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGFyZ2V0LnNldCgndG9wJywgcG9zLnRvcCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG5cbiAgICAgIGlmIChwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICh0YXJnZXQubGVmdCA8IHBvcy5sZWZ0KSB7XG4gICAgICAgICAgdGFyZ2V0LndpZHRoICs9IHRhcmdldC5sZWZ0IC0gcG9zLmxlZnQ7XG4gICAgICAgICAgdGFyZ2V0LmxlZnQgPSBwb3MubGVmdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0YXJnZXQud2lkdGggLT0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAodGFyZ2V0LnRvcCA8IHBvcy50b3ApIHtcbiAgICAgICAgICB0YXJnZXQuaGVpZ2h0ICs9IHRhcmdldC50b3AgLSBwb3MudG9wO1xuICAgICAgICAgIHRhcmdldC50b3AgPSBwb3MudG9wO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRhcmdldC5oZWlnaHQgLT0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cblxuICAgIGlmIChwb3Muc2NhbGVYKSB7XG4gICAgICB0YXJnZXQuc2NhbGVYID0gdGFyZ2V0LnNjYWxlWCAqPSBwb3Muc2NhbGVYO1xuICAgIH1cbiAgICBpZiAocG9zLnNjYWxlWSkge1xuICAgICAgdGFyZ2V0LnNjYWxlWSA9IHRhcmdldC5zY2FsZVkgKj0gcG9zLnNjYWxlWTtcbiAgICB9XG5cbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG5cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIC8vIGlmKHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAvLyAgIHRhcmdldC50b3AgPSBNYXRoLnJvdW5kKHRhcmdldC50b3ApO1xuICAgIC8vICAgdGFyZ2V0LmxlZnQgPSBNYXRoLnJvdW5kKHRhcmdldC5sZWZ0KTtcbiAgICAvLyAgIHRhcmdldC5oZWlnaHQgPSBNYXRoLnJvdW5kKHRhcmdldC5oZWlnaHQpO1xuICAgIC8vICAgdGFyZ2V0LndpZHRoID0gTWF0aC5yb3VuZCh0YXJnZXQud2lkdGgpO1xuICAgIC8vIH1cbiAgfSxcbiAgX3RyYW5zbGF0ZU9iamVjdDogZnVuY3Rpb24gKHgsIHksIGxpbWl0cykge1xuICAgIHZhciB0YXJnZXQgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnRhcmdldDtcbiAgICBpZih0YXJnZXQuYmVmb3JlVHJhbnNsYXRlKXtcbiAgICAgIHZhciBfcG9pbnQgPSB0YXJnZXQuYmVmb3JlVHJhbnNsYXRlKHgsIHkpO1xuICAgICAgaWYoIV9wb2ludClyZXR1cm4gZmFsc2U7XG4gICAgICB4ID0gX3BvaW50Lng7XG4gICAgICB5ID0gX3BvaW50Lnk7XG4gICAgfVxuICAgIHZhciBfdHJhbnNsYXRlZCA9IF90cmFuc2xhdGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBsaW1pdHMpO1xuXG4gICAgaWYodGhpcy5tb3ZlbWVudExpbWl0cyl7XG5cbiAgICAgIHZhciBwb3MgPSB0aGlzLmdldEZpeGVkUG9zaXRpb24odGFyZ2V0LCB4LCB5KTtcblxuICAgICAgaWYgKHBvcy5zY2FsZVgpIHtcbiAgICAgICAgdGFyZ2V0LnNjYWxlWCA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0uc2NhbGVYICo9IHBvcy5zY2FsZVg7XG4gICAgICB9XG4gICAgICBpZiAocG9zLnNjYWxlWSkge1xuICAgICAgICB0YXJnZXQuc2NhbGVZID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS5zY2FsZVkgKj0gcG9zLnNjYWxlWTtcbiAgICAgIH1cblxuICAgICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCB8fCBwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIF90cmFuc2xhdGVkID0gX3RyYW5zbGF0ZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsXG4gICAgICAgICAgcG9zLmxlZnQgIT09IHVuZGVmaW5lZCA/IHBvcy5sZWZ0IDogeCxcbiAgICAgICAgICBwb3MudG9wICE9PSB1bmRlZmluZWQgPyBwb3MudG9wIDogeSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfdHJhbnNsYXRlZCB8fCBwb3Muc2NhbGVYIHx8IHBvcy5zY2FsZVk7XG5cblxuXG4gICAgLyogaWYgKCF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRYJykpIHtcbiAgICAgdmFyIF92YWwgPSB4IC0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vZmZzZXRYO1xuXG4gICAgIC8vbGVmdCBvZmZzZXRcbiAgICAgdmFyIGxpbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMubWluWC5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgPyB0aGlzLm1vdmVtZW50TGltaXRzLm1pblggOiAtYm91bmRzLndpZHRoICsgMTtcbiAgICAgaWYodGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0ICYmIHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdC5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgJiYgdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0ID4gbGltICl7XG4gICAgIGxpbSA9IHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdCA7XG4gICAgIH1cblxuICAgICBfdmFsID0gTWF0aC5taW4obGltLCBfdmFsKTtcblxuICAgICAvL3JpZ2h0IG9mZnNldFxuICAgICB2YXIgbGltID0gdGhpcy5tb3ZlbWVudExpbWl0cy5tYXhYLmNvbnN0cnVjdG9yID09IE51bWJlciA/IHRoaXMubW92ZW1lbnRMaW1pdHMubWF4WCA6IHRoaXMud2lkdGggKyBib3VuZHMud2lkdGggLSAxO1xuICAgICBpZih0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQgJiYgdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0LmNvbnN0cnVjdG9yID09IE51bWJlciAmJiB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQgPiBsaW0gKXtcbiAgICAgbGltID0gdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0IDtcbiAgICAgfVxuICAgICBfdmFsID0gTWF0aC5tYXgobGltICAtIHRhcmdldC53aWR0aCAqIHRhcmdldC5zY2FsZVgsIF92YWwpO1xuICAgICB0YXJnZXQuc2V0KCdsZWZ0JywgX3ZhbCk7XG4gICAgIH1cbiAgICAgaWYgKCF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRZJykpIHtcbiAgICAgdmFyIF92YWwgPSB5IC0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vZmZzZXRZO1xuICAgICBpZih0YXJnZXQubW92ZW1lbnRZTWluTGltaXQgIT09IHVuZGVmaW5lZClcbiAgICAgX3ZhbCA9IE1hdGgubWluKHRhcmdldC5tb3ZlbWVudFlNaW5MaW1pdCwgX3ZhbCk7XG4gICAgIGlmKHRhcmdldC5tb3ZlbWVudFlNYXhMaW1pdCAhPT0gdW5kZWZpbmVkKVxuICAgICBfdmFsID0gTWF0aC5tYXgodGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0ICAtIHRhcmdldC5oZWlnaHQsIF92YWwpO1xuXG4gICAgIHRhcmdldC5zZXQoJ3RvcCcsIF92YWwpO1xuICAgICB9XG4gICAgICovXG4gICAgLy9tb3ZlbWVudExpbWl0cyA9e1xuICAgIC8vICAgIHhtaW46IDAsXG4gICAgLy8gICAgeG1heDogMCxcbiAgICAvLyAgICB5bWluOiAwLFxuICAgIC8vICAgIHltYXg6IDBcbiAgICAvL307XG5cbiAgfSxcblxuICBfYmVmb3JlVHJhbnNmb3JtOiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7XG4gICAgdGFyZ2V0ICYmIHRhcmdldC5fYmVmb3JlVHJhbnNmb3JtID9cbiAgICAgIHRhcmdldC5fYmVmb3JlVHJhbnNmb3JtKGUpIDpcbiAgICAgIF9iZWZvcmVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlLCB0YXJnZXQpO1xuICB9LFxuICBfYmVmb3JlVHJhbnNmb3JtTmF0aXZlOiBfYmVmb3JlVHJhbnNmb3JtX292ZXJ3cml0dGVuLFxuICAvKipcbiAgICogVHJhbnNsYXRlcyBvYmplY3QgYnkgXCJzZXR0aW5nXCIgaXRzIGxlZnQvdG9wXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB4IHBvaW50ZXIncyB4IGNvb3JkaW5hdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHkgcG9pbnRlcidzIHkgY29vcmRpbmF0ZVxuICAgKiBAcmV0dXJuIHtCb29sZWFufSB0cnVlIGlmIHRoZSB0cmFuc2xhdGlvbiBvY2N1cnJlZFxuICAgKi9cbiAvKiBfdHJhbnNsYXRlT2JqZWN0OiBmdW5jdGlvbiAoeCwgeSkge1xuICAgIHZhciB0cmFuc2Zvcm0gPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLFxuICAgICAgdGFyZ2V0ID0gdHJhbnNmb3JtLnRhcmdldCxcbiAgICAgIG5ld0xlZnQgPSB4IC0gdHJhbnNmb3JtLm9mZnNldFgsXG4gICAgICBuZXdUb3AgPSB5IC0gdHJhbnNmb3JtLm9mZnNldFksXG4gICAgICBtb3ZlWCA9ICF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRYJykgJiYgdGFyZ2V0LmxlZnQgIT09IG5ld0xlZnQsXG4gICAgICBtb3ZlWSA9ICF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRZJykgJiYgdGFyZ2V0LnRvcCAhPT0gbmV3VG9wO1xuXG5cbiAgICAvL3JvdW5kIGNvb3JkaW5hdGVzXG4gICAgLy8gaWYgKHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKSB7XG4gICAgLy8gICBuZXdMZWZ0ID0gTWF0aC5yb3VuZChuZXdMZWZ0KTtcbiAgICAvLyAgIG5ld1RvcCA9IE1hdGgucm91bmQobmV3VG9wKTtcbiAgICAvLyB9XG5cbiAgICBtb3ZlWCAmJiB0YXJnZXQuc2V0KCdsZWZ0JywgbmV3TGVmdCk7XG4gICAgbW92ZVkgJiYgdGFyZ2V0LnNldCgndG9wJywgbmV3VG9wKTtcbiAgICByZXR1cm4gbW92ZVggfHwgbW92ZVk7XG4gIH0qL1xufSk7XG5cbi8vZmFicmljLkNhbnZhcy5hZGRQbHVnaW4oXCJsb2FkZXJzXCIsZnVuY3Rpb24oKXtcbi8vICAgIHRoaXMuaW5pdE1vdmVtZW50TGltaXRzKCk7XG4vL30pO1xuXG4vL3RvZG9cbi8vIGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMgICA9IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcIm1vdmVtZW50TGltaXRzXCIsXCJjbGlwVG9cIl0pO1xuLy8gZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbi8vIGZhYnJpYy5JVGV4dC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICA9IGZhYnJpYy5JVGV4dC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbi8vIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcblxuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvbW92ZW1lbnRMaW1pdHMuanMiLCIndXNlIHN0cmljdCc7XG4vL3JlcXVpcmUoXCIuLy4uL2NvcmUvYmFzZS5qc1wiKTtcbi8vcmVxdWlyZShcIi4vLi4vY29yZS9zbGlkZS5qc1wiKTtcbnJlcXVpcmUoXCIuL2NsaXBUb1wiKTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBvcHRpb25zT3JkZXI6IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLm9wdGlvbnNPcmRlciAmJiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5vcHRpb25zT3JkZXI7XG4gICAgb28uc3BsaWNlKG9vLmluZGV4T2YoXCIqXCIpLDAsXCJhcmVhc1wiLFwib2Zmc2V0c1wiLFwiaGVscGVyc1wiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIF9oZWxwZXJzT2JqZWN0czogbnVsbCxcbiAgX2FyZWFzT2JqZWN0czogbnVsbCxcbiAgX3VwZGF0ZV9jbGlwX3JlY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAvL3RvZG9cbiAgICByZXR1cm47XG4gICAgaWYgKHRoaXMuYXJlYXMgfHwgIXRoaXMuX2FyZWFzT2JqZWN0c1swXSkgcmV0dXJuO1xuICAgIHZhciBnZW9tZXRyeSA9IGZhYnJpYy51dGlsLmdldFJlY3QodGhpcy53aWR0aCx0aGlzLmhlaWdodCx0aGlzLm9mZnNldHMpO1xuICAgIHRoaXMuX2FyZWFzT2JqZWN0c1swXS5zZXQoZ2VvbWV0cnkpO1xuICB9LFxuICAvL29mZnNldHM6IHtsZWZ0IDogMCx0YGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgb3AgOiAwLCByaWdodDogMCwgYm90dG9tOjB9LFxuICBzZXRIZWxwZXJzOiBmdW5jdGlvbiAoaGVscGVycywgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZmFsc2U7Ly90b2RvXG4gICAgdGhpcy5oZWxwZXJzID0gaGVscGVycztcbiAgICB0aGlzLl9oZWxwZXJzT2JqZWN0cyA9IFtdO1xuICAgIGlmKGhlbHBlcnMpe1xuICAgICAgZm9yIChsZXQgaCBvZiBoZWxwZXJzKXtcbiAgICAgICAgdGhpcy5jcmVhdGVPYmplY3QoaCxoZWxwZXIgPT4ge1xuICAgICAgICAgIHRoaXMuX2hlbHBlcnNPYmplY3RzLnB1c2goaGVscGVyKTtcbiAgICAgICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgfSxcbiAgc3RvcmVQcm9wZXJ0aWVzOiBmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5zdG9yZVByb3BlcnRpZXMgJiYgZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUuc3RvcmVQcm9wZXJ0aWVzLmNvbmNhdChbXCJvZmZzZXRzXCIsXCJoZWxwZXJzXCIsXCJhcmVhc1wiXSksXG4gIGFyZWFBY3RpdmF0aW5nOiBmYWxzZSxcbiAgYWRkRWxlbWVudHNJbnNpZGVBY3RpdmVBcmVhOiBmYWxzZSxcbiAgYXJlYVByb3BlcnRpZXM6IHtcbiAgICBvcmlnaW5YOiAnbGVmdCcsXG4gICAgb3JpZ2luWTogJ3RvcCcsXG4gICAgZmlsbDogJ3RyYW5zcGFyZW50JyxcbiAgICBzdHJva2VEYXNoQXJyYXk6IFs1LCA1XSxcbiAgICBzdHJva2VXaWR0aDogMSxcbiAgICBzdHJva2U6ICdibGFjaycsXG4gICAgcmVzaXphYmxlOiB0cnVlXG4gICAgLy9zZWxlY3RhYmxlOiBmYWxzZVxuICB9LFxuICBzZXRBcmVhUHJvcGVydHk6IGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUpIHtcbiAgICB0aGlzW1wiYXJlYV9cIiArIHByb3BlcnR5XSA9IHZhbHVlO1xuICAgIGlmKHRoaXMuX29mZnNldHNPYmplY3Qpe1xuICAgICAgdGhpcy5fb2Zmc2V0c09iamVjdFtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgZm9yIChsZXQgb2JqZWN0IG9mIHRoaXMuX2FyZWFzT2JqZWN0cykge1xuICAgICAgb2JqZWN0W3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBzZXRBY3RpdmVBcmVhOiBmdW5jdGlvbiAoYXJlYSkge1xuICAgIGlmICh0aGlzLmFjdGl2ZUFyZWEpIHtcbiAgICAgIHRoaXMuYWN0aXZlQXJlYS5zZXRTdHJva2UoXCIjMDAwXCIpO1xuICAgIH1cbiAgICB0aGlzLmFjdGl2ZUFyZWEgPSBhcmVhO1xuICAgIGlmIChhcmVhKSB7XG4gICAgICBhcmVhLnNldFN0cm9rZShcIiNCN0YxRURcIik7XG4gICAgfVxuICB9LFxuICBzZXRBcmVhQWN0aXZhdGluZzogZnVuY3Rpb24gKHZhbHVlLyosIGZvcmNlKi8pIHtcbiAgICAvL3RvZG8gZm9yY2VcbiAgICB2YXIgZm9yY2UgPSB0cnVlO1xuICAgIGlmIChmb3JjZSB8fCAodmFsdWUgJiYgIXRoaXMuYXJlYUFjdGl2YXRpbmcpKSB7XG4gICAgICB0aGlzLmFyZWFBY3RpdmF0aW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMub24oXCJvYmplY3Q6bW9kaWZpZWRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYoIXRoaXMuX2FyZWFzT2JqZWN0cylyZXR1cm47XG4gICAgICAgIGlmKHRoaXMuZWRpdGluZ09iamVjdCl7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vdG9kbyBldmVudCEg0L3QtSDRitC+0YLQtdC7INCx0Ysg0Y3RgtC+INGC0YPRgiDQuNGB0L/QvtC70YzQvtCy0LDRgtGMLNC90L4g0YDQsNCx0L7RgtCw0LXRglxuICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihldmVudCwgdHJ1ZSk7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fYXJlYXNPYmplY3RzLCBwb2ludGVyKTtcbiAgICAgICAgaWYodGhpcy5fY3VycmVudFRyYW5zZm9ybSAmJiB0YXJnZXQgJiYgdGhpcy5hcHBsaWNhdGlvbi50YXJnZXQubW92ZW1lbnRMaW1pdHMgIT0gdGFyZ2V0KXtcbiAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLnRhcmdldC5zZXQoe1xuICAgICAgICAgICAgbW92ZW1lbnRMaW1pdHM6IHRhcmdldCxcbiAgICAgICAgICAgIGNsaXBUbzogdGFyZ2V0XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5vbihcIm1vdXNlOmRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYoIXRoaXMuX2FyZWFzT2JqZWN0cylyZXR1cm47XG4gICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUuZSwgdHJ1ZSk7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fYXJlYXNPYmplY3RzLCBwb2ludGVyKTtcbiAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSxcbiAgX3VwZGF0ZV9hcmVhX2dlb21ldHJ5OiBmdW5jdGlvbihlbCxvcHRpb25zKXtcblxuXG4gICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcblxuICAgIGlmIChvcHRpb25zLnBhdGgpIHtcblxuICAgICAgb3B0aW9ucy53aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgZWwud2lkdGg7XG4gICAgICB2YXIgZ2VvbWV0cnkgPSBmYWJyaWMudXRpbC5nZXRSZWN0KF93LF9oLG9wdGlvbnMpO1xuICAgICAgdmFyIF9zY2FsZSA9IGVsLndpZHRoIC8gZ2VvbWV0cnkud2lkdGg7XG4gICAgICBlbC5zZXQoe1xuICAgICAgICBsZWZ0OiBnZW9tZXRyeS5sZWZ0ICwvLy8qIGVsLmxlZnQgKiBfc2NhbGUqLyxcbiAgICAgICAgdG9wOiBnZW9tZXRyeS50b3AgLC8vKyBlbC50b3AgKiBfc2NhbGUsXG4gICAgICAgIHNjYWxlWDogX3NjYWxlLFxuICAgICAgICBzY2FsZVk6IF9zY2FsZVxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG5cbiAgICB2YXIgZ2VvbWV0cnkgPSBmYWJyaWMudXRpbC5nZXRSZWN0KF93LF9oLG9wdGlvbnMpO1xuXG4gICAgaWYob3B0aW9ucy5zcmMpe1xuICAgICAgdmFyIF9zY2FsZSA9IGdlb21ldHJ5LndpZHRoIC8gaW1nLndpZHRoO1xuICAgICAgZWwuc2V0KHtcbiAgICAgICAgbGVmdDogZ2VvbWV0cnkubGVmdCwvLyArIGVsLmxlZnQgKiBfc2NhbGUsXG4gICAgICAgIHRvcDogZ2VvbWV0cnkudG9wICwvLysgZWwudG9wICogX3NjYWxlLFxuICAgICAgICBzdHJva2VXaWR0aDogdGhpcy5hcmVhUHJvcGVydGllcy5zdHJva2VXaWR0aCAvIF9zY2FsZSxcbiAgICAgICAgc2NhbGVYOiBfc2NhbGUsXG4gICAgICAgIHNjYWxlWTogX3NjYWxlXG4gICAgICB9KTtcbiAgICB9ZWxzZXtcbiAgICAgIC8vIGdlb21ldHJ5LndpZHRoIC09IGVsLnN0cm9rZVdpZHRoICogMjtcbiAgICAgIC8vIGdlb21ldHJ5LmhlaWdodCAtPSBlbC5zdHJva2VXaWR0aCAqIDI7XG4gICAgICBlbC5zZXQoZ2VvbWV0cnkpO1xuICAgIH1cbiAgfSxcbiAgX3JlbmRlck92ZXJsYXlPYmplY3RzOiBmdW5jdGlvbihjdHgpe1xuICAgIGlmKHRoaXMuX29mZnNldHNPYmplY3Qpe1xuICAgICAgdGhpcy5fb2Zmc2V0c09iamVjdC5yZW5kZXIoY3R4KTtcbiAgICB9XG4gICAgaWYodGhpcy5fYXJlYXNPYmplY3RzKXtcbiAgICAgIHRoaXMuX3JlbmRlck9iamVjdHMoY3R4LCB0aGlzLl9hcmVhc09iamVjdHMpO1xuICAgIH1cbiAgICBpZih0aGlzLl9oZWxwZXJzT2JqZWN0cyl7XG4gICAgICB0aGlzLl9yZW5kZXJPYmplY3RzKGN0eCwgdGhpcy5faGVscGVyc09iamVjdHMpO1xuICAgIH1cbiAgfSxcbiAgY3JlYXRlQXJlYTogZnVuY3Rpb24gKGFyZWEsIGNhbGxiYWNrKSB7XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdmFyIF9maW5hbGl6ZSA9IGZ1bmN0aW9uIChwYXRoLCBhcmVhKSB7XG4gICAgICBwYXRoLmlkID0gYXJlYS5pZDtcbiAgICAgIC8vXG4gICAgICAvLyBhcmVhLmluc3RhbmNlID0gcGF0aDtcbiAgICAgLy8gcGF0aC5sYXllciA9IFwiYmFja2dyb3VuZFwiO1xuICAgICAvLyB0aGlzLmFkZChwYXRoKTtcbiAgICAgIHRoaXMuX3VwZGF0ZV9hcmVhX2dlb21ldHJ5KHBhdGgsYXJlYSk7XG4gICAgICB0aGlzLl9hcmVhc09iamVjdHMucHVzaChwYXRoKTtcbiAgICAgIC8vIF90aGlzLl9iYWNrZ3JvdW5kTGF5ZXIucHVzaChwYXRoKTtcbiAgICAgIC8vIHBhdGguY2FudmFzID0gX3RoaXM7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0uYmluZCh0aGlzKTtcblxuXG4gICAgdmFyIHBhdGgsIHJlY3RhcmVhO1xuICAgIGlmIChhcmVhLnBhdGgpIHtcbiAgICAgIHBhdGggPSBuZXcgZmFicmljLlBhdGgoYXJlYS5wYXRoLCB0aGlzLmFyZWFQcm9wZXJ0aWVzKTtcbiAgICAgIGFyZWEudG9wID0gcGF0aC50b3A7XG4gICAgICBhcmVhLmxlZnQgPSBwYXRoLmxlZnQ7XG4gICAgICBhcmVhLndpZHRoID0gcGF0aC53aWR0aDtcbiAgICAgIGFyZWEuaGVpZ2h0ID0gcGF0aC5oZWlnaHQ7XG4gICAgICBfZmluYWxpemUocGF0aCwgYXJlYSk7XG4gICAgfSBlbHNlIGlmIChhcmVhLnNyYykge1xuICAgICAgdmFyIGNsaXBGaWxsZXIgPSBuZXcgZmFicmljLlBhdGhmaW5kZXIoe30pO1xuICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKGFyZWEuc3JjLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICAgIGNsaXBGaWxsZXIuc2V0SW1hZ2UoaW1nKTtcbiAgICAgICAgY2xpcEZpbGxlci5tYXNrID0gTWFnaWNXYW5kLnNlbGVjdEJhY2tncm91bmQoY2xpcEZpbGxlci5nZXRJbmZvKCksIG51bGwsIDE1KTtcblxuICAgICAgICB2YXIgY29udG91cnMgPSBjbGlwRmlsbGVyLmdldENvbnRvdXJzKCk7XG4gICAgICAgIHZhciBjbGlwUG9pbnRzID0gY29udG91cnNbMV0ucG9pbnRzO1xuICAgICAgICB2YXIgcGF0aERhdGEgPSBmYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLmNvbnZlcnRQb2ludHNUb1NWR1BhdGgoY2xpcFBvaW50cykuam9pbignJyk7Ly90b2RvXG4gICAgICAgIHBhdGggPSBuZXcgZmFicmljLlBhdGgocGF0aERhdGEsIF90aGlzLmFyZWFQcm9wZXJ0aWVzKTtcblxuICAgICAgICBfZmluYWxpemUocGF0aCwgYXJlYSk7XG4gICAgICB9KTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBwYXRoID0gbmV3IGZhYnJpYy5SZWN0KHRoaXMuYXJlYVByb3BlcnRpZXMpO1xuICAgICAgX2ZpbmFsaXplKHBhdGgsIGFyZWEpO1xuICAgIH1cblxuICAgIGlmKCggYXJlYS5yaWdodCB8fCBhcmVhLmJvdHRvbSB8fCBhcmVhLnBhdGggKSAmJiAoIXRoaXMub3JpZ2luYWxXaWR0aCAgfHwgIXRoaXMub3JpZ2luYWxIZWlnaHQpICl7XG4gICAgICB0aGlzLm9uKFwiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIixmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLl91cGRhdGVfYXJlYV9nZW9tZXRyeShwYXRoLGFyZWEpO1xuICAgICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKVxuXG4gICAgfVxuXG4gICAgLypcbiAgICAgYXBwLmNhbnZhcy5zZXRPZmZzZXRzKHtcbiAgICAgcmlnaHQ6ICAxLFxuICAgICBsZWZ0OiAgIDEsXG4gICAgIHRvcDogICAgMSxcbiAgICAgYm90dG9tOiAxXG4gICAgIH0pO1xuXG5cbiAgICAgYXBwLmNhbnZhcy5jbGlwVG8gPSBmdW5jdGlvbiAoY3R4KSB7XG4gICAgIHZhciB6b29tID0gYXBwLmNhbnZhc19jb25maWcud2lkdGggLyBhcHAuY2FudmFzLmJhY2tncm91bmRJbWFnZS5maWx0ZXJzWzBdLnBhdGhmaW5kZXIubWFzay53aWR0aDtcbiAgICAgY3R4LnNhdmUoKTtcbiAgICAgY3R4LnNjYWxlKHpvb20sIHpvb20pO1xuICAgICBhcHAuY2xpcEZpbGxlci50cmFjZUlubmVyKGN0eCk7XG4gICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgIH07Ki9cbiAgfSxcbiAgcmVtb3ZlQXJlYTogZnVuY3Rpb24gKGFyZWEpIHtcbi8qXG4gICAgdmFyIG9ianMgPSB0aGlzLmdldE9iamVjdHMoKTtcbiAgICBmb3IgKHZhciBpIGluIG9ianMpIHtcbiAgICAgIGlmIChvYmpzW2ldLm1vdmVtZW50TGltaXRzID09PSBhcmVhKSB7XG4gICAgICAgIGRlbGV0ZSBvYmpzW2ldLm1vdmVtZW50TGltaXRzO1xuICAgICAgfVxuICAgICAgaWYgKG9ianNbaV0uY2xpcFRvID09PSBhcmVhKSB7XG4gICAgICAgIC8vaWYob2Jqc1tpXS5vbGNDbGlwVG9JRCl7XG4gICAgICAgIC8vICAgIG9ianNbaV0uY2xpcFRvSUQgPSBvYmpzW2ldLm9sZENsaXBUb0lEO1xuICAgICAgICAvL31cbiAgICAgICAgZGVsZXRlIG9ianNbaV0uY2xpcFRvO1xuICAgICAgICAvL29ianNbaV0ub2xjQ2xpcFRvSUQgPSBhcmVhLmlkO1xuICAgICAgfVxuICAgIH1cbiAgICBhcmVhLnJlbW92ZSgpOyovXG4gIH0sXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gb2Zmc2V0cyA6IHt0b3A6IG51bWJlciwgcmlnaHQ6IG51bWJlciwgYm90dG9tOiBudW1iZXIsIGxlZnQ6IG51bWJlcn0gfCBudW1iZXIgfCBbP251bWJlciw/bnVtYmVyLD9udW1iZXIsP251bWJlcl1cbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqL1xuICBzZXRPZmZzZXRzOiBmdW5jdGlvbiAob2Zmc2V0cykge1xuICAgIGlmKG9mZnNldHMgPT09IG51bGwgKXtcbiAgICAgIHRoaXMub2Zmc2V0cyA9IHt0b3A6IDAsIHJpZ2h0OiAwLCBib3R0b206IDAsIGxlZnQ6IDB9O1xuICAgIH1lbHNlIGlmIChvZmZzZXRzLmNvbnN0cnVjdG9yID09PSBOdW1iZXIpIHtcbiAgICAgIHRoaXMub2Zmc2V0cyA9IHt0b3A6IG9mZnNldHMsIHJpZ2h0OiBvZmZzZXRzLCBib3R0b206IG9mZnNldHMsIGxlZnQ6IG9mZnNldHN9O1xuICAgIH1lbHNlIGlmIChvZmZzZXRzLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgc3dpdGNoKG9mZnNldHMubGVuZ3RoKXtcbiAgICAgICAgY2FzZSAwOiB0aGlzLm9mZnNldHMgPSB7dG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwLCBsZWZ0OiAwfTsgYnJlYWs7XG4gICAgICAgIGNhc2UgMTogdGhpcy5vZmZzZXRzID0ge3RvcDogb2Zmc2V0c1swXSwgcmlnaHQ6IG9mZnNldHNbMF0sIGJvdHRvbTogb2Zmc2V0c1swXSwgbGVmdDogb2Zmc2V0c1swXX07IGJyZWFrO1xuICAgICAgICBjYXNlIDI6IHRoaXMub2Zmc2V0cyA9IHt0b3A6IG9mZnNldHNbMF0sIHJpZ2h0OiBvZmZzZXRzWzFdLCBib3R0b206IG9mZnNldHNbMF0sIGxlZnQ6IG9mZnNldHNbMV19OyBicmVhaztcbiAgICAgICAgY2FzZSAzOiB0aGlzLm9mZnNldHMgPSB7dG9wOiBvZmZzZXRzWzBdLCByaWdodDogb2Zmc2V0c1sxXSwgYm90dG9tOiBvZmZzZXRzWzJdLCBsZWZ0OiBvZmZzZXRzWzFdfTsgYnJlYWs7XG4gICAgICAgIGNhc2UgNDogdGhpcy5vZmZzZXRzID0ge3RvcDogb2Zmc2V0c1swXSwgcmlnaHQ6IG9mZnNldHNbMV0sIGJvdHRvbTogb2Zmc2V0c1syXSwgbGVmdDogb2Zmc2V0c1szXX07IGJyZWFrO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5vZmZzZXRzID0gb2Zmc2V0cztcbiAgICB9XG5cblxuICAgIGlmKHRoaXMub2Zmc2V0cy50b3AgfHwgdGhpcy5vZmZzZXRzLmJvdHRvbSB8fCB0aGlzLm9mZnNldHMubGVmdCB8fCB0aGlzLm9mZnNldHMucmlnaHQpe1xuXG4gICAgICB0aGlzLl9vZmZzZXRzT2JqZWN0ID0gbmV3IGZhYnJpYy5SZWN0KHRoaXMub2Zmc2V0cyk7XG4gICAgICB0aGlzLl9vZmZzZXRzT2JqZWN0LnNldCh0aGlzLmFyZWFQcm9wZXJ0aWVzKTtcbiAgICAgIHRoaXMuX3VwZGF0ZV9hcmVhX2dlb21ldHJ5KHRoaXMuX29mZnNldHNPYmplY3QsdGhpcy5vZmZzZXRzKTtcblxuXG4gICAgICB0aGlzLm9uKFwidmlld3BvcnQ6c2NhbGVkXCIsKCkgPT4ge1xuICAgICAgICB0aGlzLl91cGRhdGVfYXJlYV9nZW9tZXRyeSh0aGlzLl9vZmZzZXRzT2JqZWN0LHRoaXMub2Zmc2V0cyk7XG4gICAgICB9KTtcblxuXG4gICAgICB0aGlzLm9uKFwiZGltZW5zaW9uczptb2RpZmllZFwiLCgpID0+IHtcbiAgICAgICAgdGhpcy5fdXBkYXRlX2FyZWFfZ2VvbWV0cnkodGhpcy5fb2Zmc2V0c09iamVjdCx0aGlzLm9mZnNldHMpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmICh0aGlzLmFyZWFBY3RpdmF0aW5nKSB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0aGlzLl9vZmZzZXRzT2JqZWN0IHx8IG51bGwpO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5fb2Zmc2V0c09iamVjdCA9IG51bGw7XG4gICAgfVxuXG5cblxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIHNldEFyZWFzOiBmdW5jdGlvbiAoYXJlYXMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fYXJlYXNPYmplY3RzID0gW107XG4gICAgYXJlYXMgPSBhcmVhcyB8fCBbXTtcbiAgICBpZiAodGhpcy5hcmVhcykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMuYXJlYXMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgIHRoaXMucmVtb3ZlQXJlYSh0aGlzLmFyZWFzW2ldLmluc3RhbmNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5hcmVhcyA9IGFyZWFzO1xuXG4gICAgdmFyIGNiID0gZmFicmljLnV0aWwucXVldWVMb2FkKGFyZWFzLmxlbmd0aCArIDEsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmFyZWFBY3RpdmF0aW5nKSB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0aGlzLl9hcmVhc09iamVjdHNbMF0gfHwgbnVsbCk7XG4gICAgICB9XG5cbiAgICAgLyogdmFyIG9ianMgPSB0aGlzLmdldE9iamVjdHMoKTtcbi8vd29yayB3aXRoIG9iamVjdFxuICAgICAgaWYgKCFhcmVhcy5sZW5ndGgpIHtcbiAgICAgICAgb2Jqcy5sZW5ndGggJiYgdGhpcy5jbGVhcigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLyogdG9kbyA6INC/0YDQuNC80LXQvdC40YLRjCDRgtC10LrRg9GJ0YPRjiDQt9C+0L3RgyDQutC+INCy0YHQtdC8INC+0LHRitC10LrRgtCw0LxcbiAgICAgICAgIHZhciBfYXJlYSA9IHRoaXMuYWN0aXZlQXJlYSB8fCB0aGlzLmxheWVycy5iYWNrZ3JvdW5kLm9iamVjdHNbMF07XG4gICAgICAgICBmb3IgKHZhciBpIGluIG9ianMpIHtcbiAgICAgICAgIHZhciBvYmogPSBvYmpzW2ldO1xuICAgICAgICAgb2JqLmNsaXBUbyA9IF9hcmVhO1xuICAgICAgICAgb2JqLnNldE1vdmVtZW50TGltaXRzKF9hcmVhKTtcbiAgICAgICAgIG9iai5zZXRDb29yZHMoKTtcbiAgICAgICAgIH0qL1xuICAgICAgLy99Ki9cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwodGhpcyk7XG4gICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIGZvciAodmFyIGkgaW4gYXJlYXMpIHtcbiAgICAgIGlmICghYXJlYXNbaV0uaWQpIHtcbiAgICAgICAgYXJlYXNbaV0uaWQgPSBcIl9fXCIgKyBpO1xuICAgICAgfVxuICAgICAgdGhpcy5jcmVhdGVBcmVhKGFyZWFzW2ldLCBjYik7XG4gICAgfVxuICAgIGNiKCk7XG5cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICBkZWZhdWx0T3B0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5kZWZhdWx0T3B0aW9ucyx7XG4gICAgLy9vZmZzZXRzOiB7bGVmdCA6IDAsdG9wIDogMCwgcmlnaHQ6IDAsIGJvdHRvbTowfVxuICB9KSxcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLkNhbnZhcy5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgICBcImJlZm9yZTpkcm9wXCI6IGZ1bmN0aW9uKGUpe1xuICAgICAgLy90b2RvO1xuICAgICAgaWYoIXRoaXMuX2JhY2tncm91bmRMYXllcil7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUub3JpZ2luYWxFdmVudCwgdHJ1ZSk7XG4gICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKHRoaXMuX2JhY2tncm91bmRMYXllciwgcG9pbnRlcik7XG4gICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0YXJnZXQpO1xuICAgICAgICBlLmRhdGEuY2xpcFRvID0gXCIjXCIgKyB0YXJnZXQuaWQ7XG4gICAgICAgIGUuZGF0YS5tb3ZlbWVudExpbWl0cyA9IFwiI1wiICsgdGFyZ2V0LmlkO1xuICAgICAgfVxuICAgIH1cbiAgfSlcbn0pXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvc2xpZGUuYXJlYXMuanMiLCJcbnZhciBfT0JKID0gZmFicmljLk9iamVjdC5wcm90b3R5cGU7XG52YXIgX2hhbmRsZUdyb3VwaW5nX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2hhbmRsZUdyb3VwaW5nO1xuZmFicmljLk9iamVjdC5wcm90b3R5cGUuZ3JvdXBhYmxlID0gdHJ1ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogRGVhY3RpdmF0ZXMgYWxsIG9iamVjdHMgYW5kIGRpc3BhdGNoZXMgYXBwcm9wcmlhdGUgZXZlbnRzXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgZGVhY3RpdmF0ZUFsbFdpdGhEaXNwYXRjaDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZU9iamVjdCgpO1xuICAgIHZhciBfdGFyZ2V0ID0gYWN0aXZlT2JqZWN0IHx8IGFjdGl2ZUdyb3VwO1xuICAgIGlmIChfdGFyZ2V0KSB7XG4gICAgICB0aGlzLmZpcmUoJ2JlZm9yZTpzZWxlY3Rpb246Y2xlYXJlZCcsIHsgdGFyZ2V0OiBfdGFyZ2V0LCBlOiBlIH0pO1xuICAgIH1cbiAgICB0aGlzLmRlYWN0aXZhdGVBbGwoKTtcbiAgICBpZiAoX3RhcmdldCkge1xuICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2xlYXJlZCcsIHsgZTogZSwgdGFyZ2V0OiBfdGFyZ2V0IH0pO1xuICAgICAgX3RhcmdldC5maXJlKCdkZXNlbGVjdGVkJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIC8qKlxuICAgKiBhZGRpbmcgYmVmb3JlOnNlbGVjdGlvbjpjcmVhdGVkIGV2ZW50XG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7RXZlbnR9IGUgRXZlbnQgb2JqZWN0XG4gICAqIEBwYXJhbSB7ZmFicmljLk9iamVjdH0gdGFyZ2V0XG4gICAqL1xuICBfaGFuZGxlR3JvdXBpbmc6IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICB0aGlzLmZpcmUoXCJiZWZvcmU6c2VsZWN0aW9uOmNyZWF0ZWRcIik7XG4gICAgX2hhbmRsZUdyb3VwaW5nX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSwgdGFyZ2V0KTtcbiAgfSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7RXZlbnR9IGUgbW91c2UgZXZlbnRcbiAgICovXG4gIF9ncm91cFNlbGVjdGVkT2JqZWN0czogZnVuY3Rpb24gKGUpIHtcblxuICAgIHZhciBncm91cCA9IHRoaXMuX2NvbGxlY3RPYmplY3RzKCk7XG5cbiAgICBncm91cCA9IGZhYnJpYy51dGlsLm9iamVjdC5maWx0ZXIoZ3JvdXAse2dyb3VwYWJsZTogdHJ1ZX0pO1xuXG4gICAgLy8gZG8gbm90IGNyZWF0ZSBncm91cCBmb3IgMSBlbGVtZW50IG9ubHlcbiAgICBpZiAoZ3JvdXAubGVuZ3RoID09PSAxKSB7XG4gICAgICB0aGlzLnNldEFjdGl2ZU9iamVjdChncm91cFswXSwgZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGdyb3VwLmxlbmd0aCA+IDEpIHtcbiAgICAgIGdyb3VwID0gbmV3IGZhYnJpYy5Hcm91cChncm91cC5yZXZlcnNlKCksIHtcbiAgICAgICAgY2FudmFzOiB0aGlzXG4gICAgICB9KTtcbiAgICAgIGdyb3VwLmFkZFdpdGhVcGRhdGUoKTtcbiAgICAgIHRoaXMuc2V0QWN0aXZlR3JvdXAoZ3JvdXAsIGUpO1xuICAgICAgZ3JvdXAuc2F2ZUNvb3JkcygpO1xuICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y3JlYXRlZCcsIHsgdGFyZ2V0OiBncm91cCB9KTtcbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgfVxuICB9XG59KTtcblxuX09CSi5jbG9uZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gIHZhciBfb2JqID0gdGhpcy50b09iamVjdChwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgX29iai5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gIGlmICh0aGlzLmNvbnN0cnVjdG9yLmZyb21PYmplY3QpIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5mcm9tT2JqZWN0KF9vYmosIGNhbGxiYWNrKTtcbiAgfVxuICByZXR1cm4gbmV3IGZhYnJpYy5PYmplY3QodGhpcy50b09iamVjdChwcm9wZXJ0aWVzVG9JbmNsdWRlKSk7XG59O1xuXG5fT0JKLmNsb25lU3luYyA9IGZ1bmN0aW9uKCl7XG4gIHZhciBfa2xhc3MgPSBmYWJyaWNbZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKHRoaXMudHlwZSkpXTtcbiAgaWYoX2tsYXNzLmFzeW5jKXtcbiAgICB2YXIgX29iaiA9IG5ldyBfa2xhc3MuZnJvbU9iamVjdCh0aGlzLGZ1bmN0aW9uKCl7XG5cbiAgICB9KTtcbiAgfWVsc2V7XG4gICAgdmFyIF9vYmogPSB0aGlzLmNsb25lKCk7XG4gIH1cbiAgX29iai5jYW52YXMgPSB0aGlzLmNhbnZhcztcbiAgcmV0dXJuIF9vYmo7XG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5Hcm91cC5wcm90b3R5cGUsIHtcbiAgaXNQb3NzaWJsZVRhcmdldDogZnVuY3Rpb24gKGUsIG9iamVjdCkge1xuICAgIHJldHVybiB0aGlzLnNlYXJjaFBvc3NpYmxlVGFyZ2V0cyhlLCBbb2JqZWN0XSkudGFyZ2V0ICE9PSBudWxsO1xuICB9LFxuICAvKipcbiAgICogcmV0dXJuIGlubmVyIHRhcmdldCBhbmQgZ3JvdXAgb2YgdGFyZ2V0cyB1bmRlciB0aGUgY3Vyc29yXG4gICAqIEBwYXJhbSBlXG4gICAqIEBwYXJhbSBvYmplY3RzXG4gICAqIEByZXR1cm5zIHt7dGFyZ2V0OiBudWxsLCBncm91cDogQXJyYXl9fVxuICAgKi9cbiAgc2VhcmNoUG9zc2libGVUYXJnZXRzOiBmdW5jdGlvbiAoZSwgb2JqZWN0cykge1xuXG4gICAgaWYgKCFvYmplY3RzKW9iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuICAgIHZhciBwb2ludGVyID0gdGhpcy5jYW52YXMuZ2V0UG9pbnRlcihlLCB0cnVlKTtcbiAgICB2YXIgaSA9IG9iamVjdHMubGVuZ3RoLFxuICAgICAgbm9ybWFsaXplZFBvaW50ZXIgPSB0aGlzLmNhbnZhcy5fbm9ybWFsaXplUG9pbnRlcih0aGlzLCBwb2ludGVyKTtcblxuICAgIHZhciB0YXJnZXRzID0ge1xuICAgICAgdGFyZ2V0OiBudWxsLFxuICAgICAgZ3JvdXA6IFtdXG4gICAgfTtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBpZiAodGhpcy5jYW52YXMuX2NoZWNrVGFyZ2V0KG5vcm1hbGl6ZWRQb2ludGVyLCBvYmplY3RzW2ldKSkge1xuICAgICAgICBpZiAoIXRhcmdldHMudGFyZ2V0KXRhcmdldHMudGFyZ2V0ID0gb2JqZWN0c1tpXTtcbiAgICAgICAgdGFyZ2V0cy5ncm91cC5wdXNoKG9iamVjdHNbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0cztcbiAgfSxcblxuICBncm91cFNlbGVjdGFibGU6IHRydWUsXG4gIGNsb25lU3luYzogZnVuY3Rpb24oKSB7XG4gICAgdmFyIF9jbG9uZWRPYmplY3RzID0gdGhpcy5fb2JqZWN0cy5tYXAoZnVuY3Rpb24ob2JqZWN0KXtcbiAgICAgIHJldHVybiBvYmplY3QuY2xvbmVTeW5jKCk7XG4gICAgfSk7XG5cblxuICAgIHZhciBvYmplY3QgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgZGVsZXRlIG9iamVjdC5vYmplY3RzO1xuXG4gICAgcmV0dXJuIG5ldyBmYWJyaWMuR3JvdXAoX2Nsb25lZE9iamVjdHMsIG9iamVjdCwgdHJ1ZSk7XG5cbiAgICAvLyBmYWJyaWMudXRpbC5lbmxpdmVuT2JqZWN0cyhvYmplY3Qub2JqZWN0cywgZnVuY3Rpb24gKGVubGl2ZW5lZE9iamVjdHMpIHtcbiAgICAvLyAgIGRlbGV0ZSBvYmplY3Qub2JqZWN0cztcbiAgICAvLyAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKG5ldyBmYWJyaWMuR3JvdXAoZW5saXZlbmVkT2JqZWN0cywgb2JqZWN0LCB0cnVlKSk7XG4gICAgLy8gfSk7XG4gIH0sXG4gIF9jYWxjQm91bmRzIDogZnVuY3Rpb24gKG9ubHlXaWR0aEhlaWdodCkge1xuICAgIHZhciBhWCA9IFtdLFxuICAgICAgYVkgPSBbXSxcbiAgICAgIG8sIHByb3AsXG4gICAgICBwcm9wcyA9IFsndHInLCAnYnInLCAnYmwnLCAndGwnXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICBvID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgIGlmIChvLm5vdFNlbGVjdGFibGVJblRoZUdyb3VwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgby5zZXRDb29yZHMoKTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcHJvcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgcHJvcCA9IHByb3BzW2pdO1xuICAgICAgICBhWC5wdXNoKG8ub0Nvb3Jkc1twcm9wXS54KTtcbiAgICAgICAgYVkucHVzaChvLm9Db29yZHNbcHJvcF0ueSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXQodGhpcy5fZ2V0Qm91bmRzKGFYLCBhWSwgb25seVdpZHRoSGVpZ2h0KSk7XG4gIH0sXG4gIGluaXRpYWxpemVfb3ZlcndyaXR0ZW46IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUuaW5pdGlhbGl6ZSxcbiAgaXNTZWxlY3Rpb25Hcm91cDogZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PT0gLTFcbiAgfSxcbiAgLy9jbG9uZTogZnVuY3Rpb24oY2FsbGJhY2spe1xuICAvLyAgaWYoY2FsbGJhY2sgPT09IHRydWUgfHwgY2FsbGJhY2suY29uc3RydWN0b3IgPT09IE9iamVjdCl7XG4gIC8vICAgIHZhciBfZnJhbWUgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMpO1xuICAvLyAgICBpZihjYWxsYmFjay5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KXtcbiAgLy8gICAgICBfZnJhbWUuc2V0KGNhbGxiYWNrKTtcbiAgLy8gICAgICByZXR1cm4gX2ZyYW1lO1xuICAvLyAgICB9XG4gIC8vICB9XG4gIC8vICByZXR1cm4gdGhpcy5jYWxsU3VwZXIoJ2Nsb25lJyxjYWxsYmFjayk7XG4gIC8vfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob2JqZWN0cyxvcHRpb25zKXtcbiAgICBpZihvYmplY3RzLmNvbnN0cnVjdG9yICE9IEFycmF5KXtcbiAgICAgIHZhciBlbCA9IG9iamVjdHM7XG4gICAgICBvcHRpb25zID0gZWwudG9PYmplY3QoKTtcbiAgICAgIG9iamVjdHMgPSBbXTtcbiAgICAgIGZvcih2YXIgaSBpbiBlbC5fb2JqZWN0cyl7XG4gICAgICAgIG9iamVjdHMucHVzaChlbC5fb2JqZWN0c1tpXS5jbG9uZVN5bmMoKSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmluaXRpYWxpemVfb3ZlcndyaXR0ZW4ob2JqZWN0cyxvcHRpb25zKTtcbiAgICBpZih0aGlzLnR5cGUgPT0gJ2dyb3VwJyl7XG4gICAgICB0aGlzLm9uKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PT0gLTEpe1xuICAgICAgICAgIHRoaXMuZ3JvdXBTZWxlY3RlZEVsZW1lbnRzKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMudW5ncm91cCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIHVuZ3JvdXAgOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX2NhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIF9jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgdGhpcy5fcmVzdG9yZU9iamVjdHNTdGF0ZSgpO1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgIF9jYW52YXMuYWRkKHRoaXMuX29iamVjdHNbaV0pO1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5jbGlwVG8gPSB0aGlzLmNsaXBUbztcbiAgICAgIC8vdGhpcy5fb2JqZWN0c1tpXS5hY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgICBfY2FudmFzLnJlbW92ZSh0aGlzKTtcbiAgICB2YXIgZ3JvdXAgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMuX29iamVjdHMsIHtcbiAgICAgIGNhbnZhczogX2NhbnZhc1xuICAgIH0pO1xuICAgIGdyb3VwLmFkZFdpdGhVcGRhdGUoKTtcbiAgICBfY2FudmFzLnNldEFjdGl2ZUdyb3VwKGdyb3VwKTtcbiAgICBncm91cC5zYXZlQ29vcmRzKCk7XG4gICAgX2NhbnZhcy5maXJlKCdzZWxlY3Rpb246Y3JlYXRlZCcsIHsgdGFyZ2V0OiBncm91cCB9KTtcbiAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuXG4gICAgLy92YXIgX2dyb3VwID0gbmV3IGZhYnJpYy5Hcm91cCh0aGlzLl9vYmplY3RzKTtcbiAgICAvL19ncm91cC5jYW52YXMgPSBfY2FudmFzO1xuICAgIC8vX2NhbnZhcy5zZXRBY3RpdmVPYmplY3QoX2dyb3VwKTtcbiAgfSxcblxuICBncm91cFNlbGVjdGVkRWxlbWVudHM6IGZ1bmN0aW9uKCl7XG5cblxuXG4gICAgdmFyIGVsID0gdGhpcy5jbG9uZVN5bmMoKTtcbiAgICB0aGlzLmNhbnZhcy5hZGQoZWwpO1xuICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChlbCk7XG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5fb2JqZWN0cyl7XG4gICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5fb2JqZWN0c1tpXS5vcmlnaW5hbE9iamVjdCk7XG4gICAgfVxuXG5cbiAgfSxcbiAgYWN0aW9uczoge1xuXG4gICAgcmVtb3ZlOiB7XG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtdHJhc2gnLFxuICAgICAgdGl0bGU6ICAgICAgJ0RlbGV0ZScsXG4gICAgICBrZXk6ICAgICAgICBcIkRlbGV0ZVwiLFxuICAgICAgYWN0aW9uOiAgICAgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5pc1NlbGVjdGlvbkdyb3VwKCkpe1xuICAgICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgICAgICAgIHZhciBfb2JqID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZShfb2JqLm9yaWdpbmFsT2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBkdXBsaWNhdGU6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1jbG9uZScsXG4gICAgICB0aXRsZTogICAgICAnRHVwbGljYXRlJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZih0aGlzLmlzU2VsZWN0aW9uR3JvdXAoKSl7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZmlyZSgnYmVmb3JlOnNlbGVjdGlvbjpjbGVhcmVkJywgeyB0YXJnZXQ6IHRoaXMsIGU6IG51bGwgfSk7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgICAgICAgdGhpcy5kdXBsaWNhdGUoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgZWwudW5ncm91cCgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMuZHVwbGljYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGdyb3VwU2VsZWN0ZWRFbGVtZW50czoge1xuICAgICAgdGl0bGU6ICfQs9GA0YPQv9C/0LAnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtb2JqZWN0LWdyb3VwJyxcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmlzU2VsZWN0aW9uR3JvdXAoKTtcbiAgICAgIH0sXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ncm91cFNlbGVjdGVkRWxlbWVudHMoKTtcbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgICAvL3Zpc2libGU6IElERS5ncm91cEF2YWlsYWJsZVxuICAgIH0sXG4gICAgdW5ncm91cDoge1xuICAgICAgdGl0bGU6ICfQs9GA0YPQv9C/0LAnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtb2JqZWN0LXVuZ3JvdXAnLFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZSA9PSBcImdyb3VwXCIgJiYgdGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSAhPT0gLTFcbiAgICAgIH0sXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy51bmdyb3VwKCk7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSx7XG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5DYW52YXMucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgJ3NlbGVjdGlvbjpjcmVhdGVkJzogZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgdGhpcy5fb25TZWxlY3Rpb25DcmVhdGVkKGV2ZW50KTtcbiAgICB9XG4gIH0pLFxuICBfb25TZWxlY3Rpb25Nb2RpZmllZDogZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuXG4gICAgICB2YXIgY29weSA9IHRoaXMuX29iamVjdHNbaV0uY2xvbmVTeW5jKCk7XG4gICAgICBjb3B5Lmdyb3VwID0gdGhpcztcbiAgICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RTdGF0ZShjb3B5KTtcblxuXG4gICAgICB0aGlzLl9vYmplY3RzW2ldLm9yaWdpbmFsT2JqZWN0LnNldCh7XG4gICAgICAgIGNsaXBUbzogdGhpcy5jbGlwVG8sXG4gICAgICAgIG1vdmVtZW50TGltaXRzOiB0aGlzLm1vdmVtZW50TGltaXRzLFxuICAgICAgICBsZWZ0OiBjb3B5LmxlZnQsXG4gICAgICAgIHRvcDogY29weS50b3AsXG4gICAgICAgIGFuZ2xlOiBjb3B5LmFuZ2xlLFxuICAgICAgICBzY2FsZVg6IGNvcHkuc2NhbGVYLFxuICAgICAgICBzY2FsZVk6IGNvcHkuc2NhbGVZLFxuICAgICAgICBza2V3WDogY29weS5za2V3WCxcbiAgICAgICAgc2tld1k6IGNvcHkuc2tld1ksXG4gICAgICAgIHdpZHRoOiBjb3B5LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IGNvcHkuaGVpZ2h0XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIF9vblNlbGVjdGlvbkRlc2VsZWN0ZWQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICB2YXIgX29iaiA9IHRoaXMuX29iamVjdHNbaV07XG4gICAgICBfb2JqLm9yaWdpbmFsT2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgX29iai5vcmlnaW5hbE9iamVjdC5ldmVudGVkID0gdHJ1ZTtcbiAgICAgIGRlbGV0ZSBfb2JqLm9yaWdpbmFsT2JqZWN0LmhpZGRlbkFjdGl2ZTtcbiAgICB9XG4gIH0sXG4gIF9vblNlbGVjdGlvbkNyZWF0ZWQ6IGZ1bmN0aW9uIChlbCkge1xuXG4gICAgdmFyIGdyb3VwICA9IGVsLnRhcmdldDtcblxuICAgIHZhciBvcmlnaW5hbE9iamVjdHMgPSBbXVxuICAgIGZvcih2YXIgaSBpbiBncm91cC5fb2JqZWN0cyl7XG4gICAgICB2YXIgX29iaiA9IGdyb3VwLl9vYmplY3RzW2ldO1xuICAgICAgb3JpZ2luYWxPYmplY3RzLnB1c2goX29iai5vcmlnaW5hbE9iamVjdCB8fCBfb2JqKVxuICAgIH1cblxuICAgIGdyb3VwLmRlc3Ryb3koKTtcbiAgICBncm91cC5fb2JqZWN0cyA9IFtdO1xuXG4gICAgdmFyIF9jbGlwVG8gPSBvcmlnaW5hbE9iamVjdHNbMF0uY2xpcFRvO1xuXG4gICAgZm9yICh2YXIgaSBpbiBvcmlnaW5hbE9iamVjdHMpIHtcbiAgICAgIHZhciBvcmlnaW5hbCA9IG9yaWdpbmFsT2JqZWN0c1tpXTtcblxuICAgICAgaWYgKF9jbGlwVG8gIT0gb3JpZ2luYWwuY2xpcFRvKSB7XG4gICAgICAgIF9jbGlwVG8gPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9vYmogPSBvcmlnaW5hbC5jbG9uZVN5bmMoKTtcblxuICAgICAgX29iai5zZXQoe1xuICAgICAgICBjbGlwVG86IG51bGwsXG4gICAgICAgIG9yaWdpbmFsT2JqZWN0OiBvcmlnaW5hbFxuICAgICAgfSk7XG4gICAgICBvcmlnaW5hbC5zZXQoe1xuICAgICAgICBhY3RpdmU6ZmFsc2UsXG4gICAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgICBoaWRkZW5BY3RpdmU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBncm91cC5hZGRXaXRoVXBkYXRlKF9vYmopO1xuICAgICAgZ3JvdXAuc2V0Q29vcmRzKCk7XG4gICAgfVxuXG4gICAgZ3JvdXAuY2xpcFRvID0gIF9jbGlwVG87XG5cbiAgICBncm91cC5vbih7XG4gICAgICBcIm1vZGlmaWVkXCI6IHRoaXMuX29uU2VsZWN0aW9uTW9kaWZpZWQsXG4gICAgICAnZGVzZWxlY3RlZCc6IHRoaXMuX29uU2VsZWN0aW9uRGVzZWxlY3RlZFxuICAgIH0pO1xuXG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2dyb3Vwcy5qcyIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLkhpc3RvcnkgPSByZXF1aXJlKCcuLy4uL3BsdWdpbnMvaGlzdG9yeScpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgdW5kbzoge1xuICAgIGtleTogJ3onLFxuICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICBjbGFzc05hbWU6ICdmYSBmYS0gIHVuZG8nLFxuICAgIHRpdGxlOiAnVW5kbycsXG4gICAgZW5hYmxlZDogJ2NhblVuZG8nLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy51bmRvKCk7XG4gICAgfSxcbiAgICB0YXJnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgfVxuICB9LFxuICByZWNvcmRzOiB7XG4gICAgdGl0bGU6IFwiUmVjb3Jkc1wiLFxuICAgIGl0ZW1DbGFzc05hbWU6IFwiZmlsdGVycy1zZWxlY3RvclwiLFxuICAgIGNsYXNzTmFtZTogXCJmYSBmYS1oaXN0b3J5XCIsXG4gICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICB0YXJnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgfSxcbiAgICBkcm9wZG93bjoge1xuICAgICAgd2lkdGg6IDMwMCxcbiAgICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmdW5jdGlvbiAoc3RhdGUsIGNvbnRhaW5lcikge1xuICAgICAgICBpZiAoc3RhdGUuYW55KSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLnRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICQoJzxzcGFuPicgKyBzdGF0ZS5pZCArIFwiOlwiICsgc3RhdGUudHlwZSArICc8L3NwYW4+Jyk7XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVSZXN1bHQ6IGZ1bmN0aW9uIChzdGF0ZSwgY29udGFpbmVyLCBkYXRhKSB7XG4gICAgICAgIGlmICghc3RhdGUudHlwZSlyZXR1cm47XG4gICAgICAgIGxldCBfa2V5cyA9IHN0YXRlLm9yaWdpbmFsU3RhdGUgJiYgT2JqZWN0LmtleXMoc3RhdGUub3JpZ2luYWxTdGF0ZSkuam9pbignLCcpIHx8ICcnO1xuICAgICAgICBsZXQgdHlwZSA9IHN0YXRlLm9iamVjdCAmJiBzdGF0ZS5vYmplY3QudHlwZSB8fCAnJztcbiAgICAgICAgcmV0dXJuICQoXCI8c3BhbiB0aXRsZT0ne2lkfTp7dHlwZX0oe290eXBlfSB7a2V5c30pJz57aWR9Ont0eXBlfSh7b3R5cGV9IHtrZXlzfSk8L3NwYW4+XCIuZm9ybWF0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgICAgIGtleXM6IF9rZXlzLFxuICAgICAgICAgIG90eXBlOiB0eXBlXG4gICAgICAgIH0sIHN0YXRlKSkpO1xuICAgICAgfSxcbiAgICB9LFxuICAgIHZhbHVlOiB7XG4gICAgICBvYnNlcnZlOiAnY2hhbmdlZCcsXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwsIGZpbHRlcnNEYXRhKSB7XG4gICAgICAgIHRoaXMuZ290byh2YWwpO1xuICAgICAgfSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF0uaWQ7XG4gICAgICB9LFxuICAgICAgb3B0aW9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWNvcmRzO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcmVkbzoge1xuICAgIGtleTogJ3knLFxuICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICBjbGFzc05hbWU6ICdmYSBmYS1yZXBlYXQnLFxuICAgIHRpdGxlOiAnUmVkbycsXG4gICAgZW5hYmxlZDogJ2NhblJlZG8nLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5yZWRvKCk7XG4gICAgfSxcbiAgICB0YXJnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgfVxuICB9LFxuICBoaXN0b3J5OiB7XG4gICAgdGl0bGU6ICdIaXN0b3J5JyxcbiAgICB0eXBlOiAnbWVudScsXG4gICAgbWVudTogW1wicmVkb1wiLCBcInVuZG9cIl1cbiAgfVxufSk7XG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIG9uQ2FudmFzTW9kaWZpZWQgKGUpIHtcbiAgICBpZiAoIXRoaXMuX2lzSGlzdG9yeUFjdGl2ZSgpKXJldHVybjtcblxuICAgIGxldCBzdGF0ZXMgPSB0aGlzLmdldE1vZGlmaWVkU3RhdGVzKCk7XG4gICAgaWYoIXN0YXRlcylyZXR1cm47XG5cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHtcbiAgICAgIGNhbnZhczogIHRoaXMsXG4gICAgICBvcmlnaW5hbFN0YXRlOiAgc3RhdGVzLm9yaWdpbmFsLFxuICAgICAgbW9kaWZpZWRTdGF0ZTogIHN0YXRlcy5tb2RpZmllZCxcbiAgICAgIHR5cGU6ICdjYW52YXM6bW9kaWZpZWQnLFxuICAgICAgdW5kbzogYSA9PiB7XG4gICAgICAgIHRoaXMuc2V0KGEub3JpZ2luYWxTdGF0ZSlcbiAgICAgICAgICAgIC5maXJlKCdtb2RpZmllZCcpXG4gICAgICAgICAgICAucmVuZGVyQWxsKCk7XG4gICAgICB9LFxuICAgICAgcmVkbzogYSA9PiB7XG4gICAgICAgIHRoaXMuc2V0KGEubW9kaWZpZWRTdGF0ZSlcbiAgICAgICAgICAgIC5maXJlKCdtb2RpZmllZCcpXG4gICAgICAgICAgICAucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIG9uQ2FudmFzQ2xlYXJlZCAoZSkge1xuICAgIGlmICghdGhpcy5faXNIaXN0b3J5QWN0aXZlKCkpcmV0dXJuO1xuXG4gICAgbGV0IHN0YXRlcyA9IHRoaXMuZ2V0TW9kaWZpZWRTdGF0ZXMoKTtcblxuICAgIGlmKCFlLm9iamVjdHMubGVuZ3RoICYmICEgc3RhdGVzKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHtcbiAgICAgIG9yaWdpbmFsU3RhdGU6ICBzdGF0ZXMgJiYgc3RhdGVzLm9yaWdpbmFsLFxuICAgICAgbW9kaWZpZWRTdGF0ZTogIHN0YXRlcyAmJiBzdGF0ZXMubW9kaWZpZWQsXG4gICAgICBvcmlnaW5hbE9iamVjdHM6IGUub2JqZWN0cyxcbiAgICAgIHR5cGU6ICdjYW52YXM6Y2xlYXJlZCcsXG4gICAgICByZWRvOiBhID0+IHtcbiAgICAgICAgdGhpcy5fY2xlYXJPYmplY3RzKCk7XG4gICAgICAgIGlmKGEub3JpZ2luYWxTdGF0ZSl7XG4gICAgICAgICAgdGhpcy5zZXQoYS5tb2RpZmllZFN0YXRlKVxuICAgICAgICAgICAgICAuZmlyZSgnbW9kaWZpZWQnKVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICB9LFxuICAgICAgdW5kbzogYSA9PiB7XG4gICAgICAgIHRoaXMuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzLmNvbmNhdChhLm9yaWdpbmFsT2JqZWN0cyk7XG4gICAgICAgIGlmKGEubW9kaWZpZWRTdGF0ZSl7XG4gICAgICAgICAgdGhpcy5zZXQoYS5vcmlnaW5hbFN0YXRlKVxuICAgICAgICAgICAgICAuZmlyZSgnbW9kaWZpZWQnKVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIG9uT2JqZWN0TW9kaWZpZWQgKGUpIHtcbiAgICBpZiAoIXRoaXMuX2lzSGlzdG9yeUFjdGl2ZSgpKXJldHVybjtcblxuICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldCwgc3RhdGVzID0gZS50YXJnZXQuZ2V0TW9kaWZpZWRTdGF0ZXMoKTtcblxuICAgIGlmKCFzdGF0ZXMpcmV0dXJuO1xuXG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6ICB0YXJnZXQuY2FudmFzLm9yaWdpbmFsU2xpZGUgfHwgdGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9yaWdpbmFsU3RhdGU6ICBzdGF0ZXMub3JpZ2luYWwsXG4gICAgICBtb2RpZmllZFN0YXRlOiAgc3RhdGVzLm1vZGlmaWVkLFxuICAgICAgb2JqZWN0OiB0YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0Om1vZGlmaWVkJyxcbiAgICAgIHVuZG86IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgIGEub2JqZWN0LnNldChhLm9yaWdpbmFsU3RhdGUpO1xuICAgICAgICBhLm9iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgICAgYS5vYmplY3QuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICAgICAgYS5jYW52YXMuZmlyZSgnb2JqZWN0Om1vZGlmaWVkJywgeyB0YXJnZXQ6IGEub2JqZWN0IH0pO1xuICAgICAgICBhLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH0sXG4gICAgICByZWRvOiBmdW5jdGlvbiAoYSkge1xuICAgICAgICBhLm9iamVjdC5zZXQoYS5tb2RpZmllZFN0YXRlKTtcbiAgICAgICAgYS5vYmplY3Quc2V0Q29vcmRzKCk7XG4gICAgICAgIGEuY2FudmFzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHsgdGFyZ2V0OiBhLm9iamVjdCB9KTtcbiAgICAgICAgYS5vYmplY3QuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICAgICAgYS5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIGNsZWFySGlzdG9yeSAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmNsZWFyKCk7XG4gIH0sXG4gIGRpc2FibGVIaXN0b3J5ICgpIHtcbiAgICB0aGlzLmhpc3RvcnkuZW5hYmxlZCA9IGZhbHNlO1xuICB9LFxuICBfYWRkX29iamVjdF9oaXN0b3J5YSAoYSkge1xuICAgIGxldCBfY2FudmFzID0gdGhpcy5jYW52YXMgfHwgdGhpcztcbiAgICAvLyBpZih0aGlzLmNhbnZhcyAmJiBhLmNhbnZhcy5taXJyb3JTbGlkZSA9PSB0aGlzLmNhbnZhcyl7XG4gICAgLy8gICBfY2FudmFzLmFkZChhLm9iamVjdCk7XG4gICAgLy8gICBfY2FudmFzLnNldEFjdGl2ZU9iamVjdChhLm9iamVjdCk7XG4gICAgLy8gICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIC8vIH1lbHNle1xuICAgICAgYS5jYW52YXMuYWRkKGEub2JqZWN0KTtcbiAgICAvLyB9XG4gICAgYS5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIF9yZW1vdmVfb2JqZWN0X2hpc3RvcnlhIChhKSB7XG4gICAgYS5jYW52YXMucmVtb3ZlKGEub2JqZWN0KTtcbiAgICBhLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAvLyBpZih0aGlzLmNhbnZhcyAmJiBhLmNhbnZhcy5taXJyb3JTbGlkZSA9PSB0aGlzLmNhbnZhcyl7XG4gICAgLy8gICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAvLyB9XG4gIH0sXG4gIF9pc0hpc3RvcnlBY3RpdmUoKXtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZWZ1bCAmJiB0aGlzLmhpc3RvcnkuZW5hYmxlZCAmJiAhdGhpcy5wcm9jZXNzaW5nICYmICF0aGlzLmhpc3RvcnkucHJvY2Vzc2luZztcbiAgfSxcbiAgb25PYmplY3RSZW1vdmVkIChlKSB7XG4gICAgaWYgKCF0aGlzLl9pc0hpc3RvcnlBY3RpdmUoKSlyZXR1cm47XG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6IGUudGFyZ2V0LmNhbnZhcy5vcmlnaW5hbFNsaWRlIHx8IGUudGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9iamVjdDogZS50YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0OnJlbW92ZWQnLFxuICAgICAgcmVkbzogdGhpcy5fcmVtb3ZlX29iamVjdF9oaXN0b3J5YSxcbiAgICAgIHVuZG86IHRoaXMuX2FkZF9vYmplY3RfaGlzdG9yeWFcbiAgICB9KTtcbiAgfSxcbiAgb25EcmF3QWZ0ZXIgKGV2ZW50KXtcbiAgICBpZiAoIWUudGFyZ2V0LmNhbnZhcy5zdGF0ZWZ1bCB8fCAhdGhpcy5oaXN0b3J5LmVuYWJsZWQgfHwgdGhpcy5wcm9jZXNzaW5nIHx8IHRoaXMuaGlzdG9yeS5wcm9jZXNzaW5nKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMuaGlzdG9yeS5hZGQodGhpcy5mcmVlRHJhd2luZ0JydXNoLmdldEhpc3RvcnlSZWNvcmQoZXZlbnQpKVxuICB9LFxuICBvbk9iamVjdEFkZGVkIChlKSB7XG4gICAgaWYgKCF0aGlzLl9pc0hpc3RvcnlBY3RpdmUoKSlyZXR1cm47XG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6ICBlLnRhcmdldC5jYW52YXMub3JpZ2luYWxTbGlkZSB8fCBlLnRhcmdldC5jYW52YXMsXG4gICAgICBvYmplY3Q6IGUudGFyZ2V0LFxuICAgICAgdHlwZTogJ29iamVjdDphZGRlZCcsXG4gICAgICB1bmRvOiB0aGlzLl9yZW1vdmVfb2JqZWN0X2hpc3RvcnlhLFxuICAgICAgcmVkbzogdGhpcy5fYWRkX29iamVjdF9oaXN0b3J5YVxuICAgIH0pO1xuICB9LFxuICBpbml0SGlzdG9yeSAoaGlzdG9yeSkge1xuICAgIGlmKCFoaXN0b3J5KXtcbiAgICAgIGhpc3RvcnkgPSBuZXcgZmFicmljLkhpc3RvcnkodGhpcyk7XG4gICAgICBoaXN0b3J5LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbjtcbiAgICB9XG4gICAgdGhpcy5zdGF0ZWZ1bCA9IHRydWU7XG4gICAgdGhpcy5oaXN0b3J5ID0gaGlzdG9yeTtcblxuICAgIHRoaXMub24oe1xuICAgICAgJ21vZGlmaWVkJzogICAgICAgICB0aGlzLm9uQ2FudmFzTW9kaWZpZWQsXG4gICAgICAnbG9hZGluZzpiZWdpbic6ICAgIHRoaXMuY2xlYXJIaXN0b3J5LFxuICAgICAgJ2RyYXc6YWZ0ZXInOiAgICAgICB0aGlzLm9uRHJhd0FmdGVyLFxuICAgICAgJ29iamVjdDptb2RpZmllZCc6ICB0aGlzLm9uT2JqZWN0TW9kaWZpZWQsXG4gICAgICAnY2FudmFzOmNsZWFyZWQnOiAgIHRoaXMub25DYW52YXNDbGVhcmVkLFxuICAgICAgJ29iamVjdDphZGRlZCc6ICAgICB0aGlzLm9uT2JqZWN0QWRkZWQsXG4gICAgICAnb2JqZWN0OnJlbW92ZWQnOiAgIHRoaXMub25PYmplY3RSZW1vdmVkXG4gICAgfSk7XG5cbiAgICAvLyBsZXQgX3RoaXMgPSB0aGlzO1xuICAgIC8vIHRoaXMuaGlzdG9yeS5vbignY2hhbmdlZCcsIGZ1bmN0aW9uKGUpe1xuICAgIC8vIH0pO1xuICAgIGxldCBwcm90byA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcy5IaXN0b3J5O1xuICAgIGlmKHByb3RvKXtcbiAgICAgIGlmKHByb3RvLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgaGlzdG9yeS5vbihwcm90by5ldmVudExpc3RlbmVycyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBlbmFibGVIaXN0b3J5ICgpIHtcbiAgICB0aGlzLmhpc3RvcnkuZW5hYmxlZCA9IHRydWU7XG4gIH1cbn0pO1xuXG5mYWJyaWMuSElTVE9SWV9NT0RFID0ge1xuICBJTkRJVklEVUFMOiBcInNsaWRlXCIsXG4gIFNIQVJFRDogXCJnbG9iYWxcIlxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuRWRpdG9yLnByb3RvdHlwZSwge1xuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIGxldCBvbyA9IGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcIipcIiksMCxcImhpc3RvcnlcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpLFxuICBoaXN0b3J5OiBudWxsLFxuICAvLyBfZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMgOiB7XG4gIC8vICAgXCJzbGlkZTpjaGFuZ2U6YmVnaW5cIiA6IGZ1bmN0aW9uKCl7XG4gIC8vICAgICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlIDtcbiAgLy8gICAgIGlmKHRoaXMuaGlzdG9yeSl7XG4gIC8vICAgICAgIHRoaXMuaGlzdG9yeS5wcm9jZXNzaW5nID0gdHJ1ZSA7XG4gIC8vICAgICB9XG4gIC8vICAgfSxcbiAgLy8gICBcInNsaWRlOmNoYW5nZWRcIiA6IGZ1bmN0aW9uKCl7XG4gIC8vICAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgLy8gICAgIGlmKHRoaXMuaGlzdG9yeSl7XG4gIC8vICAgICAgIHRoaXMuaGlzdG9yeS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9LFxuICBzZXRIaXN0b3J5IChoaXN0b3J5T3B0aW9uKXtcblxuICAgIGlmKGhpc3RvcnlPcHRpb24gPT09IGZhYnJpYy5ISVNUT1JZX01PREUuU0hBUkVEKXtcbiAgICAgIHRoaXMuaGlzdG9yeSA9IG5ldyBmYWJyaWMuSGlzdG9yeSh0aGlzKTtcbiAgICAgIHRoaXMuZW5hYmxlSGlzdG9yeSgpO1xuXG4gICAgICB0aGlzLm9uKFwic2xpZGU6Y3JlYXRlZFwiLChlKSA9PiB7XG4gICAgICAgIGUudGFyZ2V0LmluaXRIaXN0b3J5KHRoaXMuaGlzdG9yeSk7XG4gICAgICB9KTtcbiAgICAgIC8vIHRoaXMub24oXCJyZWFkeVwiLCgpID0+IHtcbiAgICAgIC8vICAgaWYgKHRoaXMuc2xpZGVzKSB7XG4gICAgICAvLyAgICAgdGhpcy5zbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB7XG4gICAgICAvLyAgICAgICBzbGlkZS5pbml0SGlzdG9yeSh0aGlzLmhpc3RvcnkpO1xuICAgICAgLy8gICAgIH0pXG4gICAgICAvLyAgIH1cbiAgICAgIC8vIH0pXG4gICAgfVxuICAgLyogaWYoaGlzdG9yeU9wdGlvbiA9PT0gZmFicmljLkhJU1RPUllfTU9ERS5JTkRJVklEVUFMKXtcbiAgICAgIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgICAgdGhpcy5oaXN0b3J5ID0gbmV3IGZhYnJpYy5IaXN0b3J5KHRoaXMpO1xuICAgICAgICB0aGlzLmVuYWJsZUhpc3RvcnkoKTtcbiAgICAgICAgdGhpcy5jYW52YXMuaW5pdEhpc3RvcnkodGhpcy5oaXN0b3J5KTtcbiAgICAgIH1cbiAgICAgIC8vdG9kbyB1bnN1cHBvcnRlZFxuICAgIH0qL1xuICB9LFxuICBlbmFibGVIaXN0b3J5ICgpIHtcbiAgICB0aGlzLmhpc3RvcnkuZW5hYmxlZCA9IHRydWU7XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2hpc3RvcnkuanMiLCJcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vLi4vdXRpbC91dGlsLmpzJyk7XG51dGlscy5vYmplY3QgPSByZXF1aXJlKCcuLy4uL3V0aWwvb2JqZWN0LmpzJyk7XG5cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiogRFBIaXN0b3J5XG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblxudmFyIERQSGlzdG9yeSA9IGZ1bmN0aW9uIChwYXJlbnQsIGluaXRBY3Rpb24pIHtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB0aGlzLmNsZWFyKGluaXRBY3Rpb24pO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5zZXRSZWNvcmRzID0gZnVuY3Rpb24gKHJlY29yZHMsY3VycmVudCkge1xuICB0aGlzLmNhblVuZG8gPSByZWNvcmRzLmxlbmd0aDtcbiAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG5cbiAgaWYoIXJlY29yZHMubGVuZ3RoKXtcbiAgICByZWNvcmRzID0gW3tcbiAgICAgIHR5cGU6ICdpbml0aWFsaXplZCcsXG4gICAgICBpZDogMCxcbiAgICAgIHRleHQgOiAnaW5pdGlhbGl6ZWQnXG4gICAgfV1cbiAgfVxuICB0aGlzLnJlY29yZHMgPSByZWNvcmRzO1xuICB0aGlzLmxlbmd0aCA9IHRoaXMucmVjb3Jkcy5sZW5ndGggO1xuICB0aGlzLmN1cnJlbnQgPSBjdXJyZW50ID09PSB1bmRlZmluZWQgPyByZWNvcmRzLmxlbmd0aCAtIDEgOiBjdXJyZW50O1xuICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogdGhpcy5hY3RpdmVBY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnJlc3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuc2V0UmVjb3Jkcyh0aGlzLnNhdmVkLnJlY29yZHMsdGhpcy5zYXZlZC5jdXJyZW50KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuc2F2ZWQgPSB7XG4gICAgY3VycmVudDogdGhpcy5jdXJyZW50LFxuICAgIHJlY29yZHM6IHV0aWxzLm9iamVjdC5jbG9uZURlZXAodGhpcy5yZWNvcmRzKVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIChpbml0QWN0aW9uKSB7XG4gICAgaWYgKGluaXRBY3Rpb24pIHtcbiAgICAgICAgaW5pdEFjdGlvbi5pZCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaW5pdEFjdGlvbiA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdpbml0aWFsaXplZCcsXG4gICAgICAgICAgICBpZDogMCxcbiAgICAgICAgICB0ZXh0IDogJ2luaXRpYWxpemVkJ1xuICAgICAgICB9XG4gICAgfVxuICAgIHRoaXMucmVjb3JkcyA9IFtpbml0QWN0aW9uXTtcbiAgICB0aGlzLmN1cnJlbnQgPSAwO1xuICAgIHRoaXMuY2FuVW5kbyA9IGZhbHNlO1xuICAgIHRoaXMuY2FuUmVkbyA9IGZhbHNlO1xuICAgIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiB0aGlzLmFjdGl2ZUFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cblxuRFBIaXN0b3J5LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihhY3Rpb24pe1xuXG5cbiAgICBpZiAoIXRoaXMuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBhY3Rpb24ubW9tZW50ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgdGhpcy5jYW5VbmRvID0gdHJ1ZTtcbiAgICB0aGlzLmNhblJlZG8gPSBmYWxzZTtcbiAgICB0aGlzLnJlY29yZHMuc3BsaWNlKHRoaXMuY3VycmVudCsgMSk7XG4gICAgdGhpcy5yZWNvcmRzLnB1c2goYWN0aW9uKTtcbiAgICB0aGlzLmxlbmd0aCA9IHRoaXMucmVjb3Jkcy5sZW5ndGg7XG4gICAgYWN0aW9uLmlkID0gdGhpcy5sZW5ndGggLSAxO1xuICAgIGFjdGlvbi50ZXh0ID0gYWN0aW9uLnR5cGUgfHwgYWN0aW9uLnRleHQ7XG4gICAgdGhpcy5jdXJyZW50ID0gdGhpcy5sZW5ndGggLSAxO1xuXG4gIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiBhY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuRFBIaXN0b3J5LnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG4gIHJldHVybiB0aGlzO1xufTtcbkRQSGlzdG9yeS5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuRFBIaXN0b3J5LnByb3RvdHlwZS51bmRvID0gZnVuY3Rpb24obm9GaXJlKXtcbiAgICB0aGlzLmNhblJlZG8gPSB0cnVlO1xuICAgIHZhciBfYWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gICAgdGhpcy5jdXJyZW50LS07XG4gIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgX2FjdGlvbi51bmRvLmNhbGwodGhpcy5wYXJlbnQsX2FjdGlvbik7XG4gIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgIGlmKHRoaXMuY3VycmVudCA9PSAwKXtcbiAgICAgICAgdGhpcy5jYW5VbmRvID0gZmFsc2U7XG4gICAgfVxuICAgIGlmKCFub0ZpcmUpe1xuICAgICAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgICAgIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiBfYWN0aW9ufSk7XG4gICAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUuZ290byA9IGZ1bmN0aW9uKGluZGV4KXtcbiAgICBpZihpbmRleCA9PSB0aGlzLmN1cnJlbnQpcmV0dXJuO1xuICAgIGlmKGluZGV4IDwgdGhpcy5jdXJyZW50KXtcbiAgICAgICAgZm9yKHZhciBpID0gdGhpcy5jdXJyZW50IC0gaW5kZXggO2ktLTsgKXtcbiAgICAgICAgICAgIHRoaXMudW5kbyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1pZihpbmRleCA+IHRoaXMuY3VycmVudCl7XG4gICAgICAgIGZvcih2YXIgaSA9IGluZGV4IC0gdGhpcy5jdXJyZW50IDtpLS07ICl7XG4gICAgICAgICAgICB0aGlzLnJlZG8odHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiB0aGlzLmFjdGl2ZUFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUucmVkbyA9IGZ1bmN0aW9uKG5vRmlyZSl7XG4gICAgaWYodGhpcy5jdXJyZW50ID09IHRoaXMubGVuZ3RoIC0gMSl7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgdGhpcy5jYW5VbmRvID0gdHJ1ZTtcbiAgICB0aGlzLmN1cnJlbnQrKztcbiAgICB2YXIgX2FjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuXG4gICAgX2FjdGlvbi5yZWRvLmNhbGwodGhpcy5wYXJlbnQsX2FjdGlvbik7XG5cbiAgICBpZih0aGlzLmN1cnJlbnQgPT0gdGhpcy5sZW5ndGggLSAxKXtcbiAgICAgICAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG4gICAgfVxuICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgaWYoIW5vRmlyZSkge1xuICAgIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gICAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IF9hY3Rpb259KTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG51dGlscy5vYnNlcnZhYmxlKERQSGlzdG9yeS5wcm90b3R5cGUpO1xubW9kdWxlLmV4cG9ydHMgPSBEUEhpc3Rvcnk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3BsdWdpbnMvaGlzdG9yeS5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vbW9kdWxlIHJlc3BvbnNpdmUgYm9yZGVycy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHJlc3BvbnNpdmVCb3JkZXJzOiBmYWxzZSxcbiAgY2VudGVyQW5kWm9vbU91dDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jYW52YXMuY2VudGVyT25PYmplY3QodGhpcyk7XG4gIH1cbn0pO1xuXG5pZighZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzKXtcbiAgZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzID0ge307XG59O1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS51cGRhdGVSZXNwb25zaXZlQm9yZGVyID0gZnVuY3Rpb24oKXtcbiAgaWYodGhpcy5yZXNwb25zaXZlQm9yZGVycyl7XG4gICAgaWYoIXRoaXMub3JpZ2luYWxTdHJva2VXaWR0aCl7XG4gICAgICB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggPSB0aGlzLnN0cm9rZVdpZHRoO1xuICAgIH1cbiAgICB0aGlzLnN0cm9rZVdpZHRoID0gdGhpcy5jYW52YXMgPyB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggLyB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSA6IDA7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzOiB7XG4gICAgXCJkaW1lbnNpb25zOm1vZGlmaWVkXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZCkge1xuICAgICAgICB0aGlzLmNlbnRlckFuZFpvb21PdXQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgICd2aWV3cG9ydDpzY2FsZWQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kSW1hZ2UpIHtcbiAgICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UudXBkYXRlUmVzcG9uc2l2ZUJvcmRlcigpO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICAgIHRoaXMuX29iamVjdHNbaV0udXBkYXRlUmVzcG9uc2l2ZUJvcmRlcigpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJiYWNrZ3JvdW5kLWltYWdlOmxvYWRlZFwiOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICh0aGlzLmF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZCkge1xuICAgICAgICB0aGlzLmNlbnRlckFuZFpvb21PdXQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwibG9hZGluZzplbmRcIjogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAodGhpcy5hdXRvQ2VudGVyQW5kWm9vbU91dEVuYWJsZWQgJiYgKHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5vcmlnaW5hbFdpZHRoKSkge1xuICAgICAgICB0aGlzLmNlbnRlckFuZFpvb21PdXQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwib2JqZWN0OmFkZGVkXCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZXZlbnQudGFyZ2V0LnVwZGF0ZVJlc3BvbnNpdmVCb3JkZXIoKVxuICAgIH1cbiAgfVxufSk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIHpvb21DdHJsS2V5OiB0cnVlLFxuICBtb3VzZVdoZWVsWm9vbSA6IGZhbHNlLFxuICBzZXRNb3VzZVdoZWVsWm9vbTogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLm1vdXNlV2hlZWxab29tID0gdmFsO1xuICAgIHRoaXMub24oXCJtb3VzZTp3aGVlbFwiLHRoaXMud2hlZWxab29tKTtcbiAgfSxcbiAgX3NldFpvb21OYXRpdmUgIDogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc2V0Wm9vbSxcbiAgX3pvb21Ub1BvaW50TmF0aXZlICA6IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnpvb21Ub1BvaW50LFxuICBjaGFuZ2VEaW1lbnNpb25Pblpvb206IGZhbHNlLFxuICBkcmF3Wm9vbUFyZWEgOiBmdW5jdGlvbihfY3R4LGxlZnQsIHRvcCAsd2lkdGgsIGhlaWdodCApe1xuICAgIF9jdHguc2F2ZSgpO1xuICAgIF9jdHgudHJhbnNsYXRlKGxlZnQgfHwgMCwgdG9wIHx8IDApO1xuICAgIHZhciBfc2NhbGUgPSB0aGlzLmdldFpvb20oKTtcbiAgICB2YXIgX3NpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyh0aGlzLmJhY2tncm91bmRJbWFnZSwge3dpZHRoOiB3aWR0aCB8fCAxMDAsIGhlaWdodDogaGVpZ2h0IHx8IDEwMH0pO1xuICAgIF9jdHguZ2xvYmFsQWxwaGEgPSAwLjU7XG4gICAgX2N0eC5maWxsUmVjdCgwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodCk7XG4gICAgX2N0eC5zdHJva2VTdHlsZSA9IFwicmVkXCI7XG5cbiAgICB2YXIgdiA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICB2YXIgeDEgPSAtdls0XSAqIF9zaXplLnNjYWxlIC8gX3NjYWxlO1xuICAgIHZhciB5MSA9IC12WzVdICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHgyID0geDEgKyB0aGlzLndpZHRoICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHkyID0geTEgKyB0aGlzLmhlaWdodCAqIF9zaXplLnNjYWxlIC8gX3NjYWxlO1xuXG4gICAgeDEgPSBNYXRoLm1heCh4MSwwKTtcbiAgICB5MSA9IE1hdGgubWF4KHkxLDApO1xuICAgIHgyID0gTWF0aC5taW4oeDIsX3NpemUud2lkdGgpO1xuICAgIHkyID0gTWF0aC5taW4oeTIsX3NpemUuaGVpZ2h0KTtcblxuICAgIF9jdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgIF9jdHguYmVnaW5QYXRoKCk7XG4gICAgX2N0eC5tb3ZlVG8oeDEseTEpO1xuICAgIF9jdHgubGluZVRvKHgyLHkxKTtcbiAgICBfY3R4LmxpbmVUbyh4Mix5Mik7XG4gICAgX2N0eC5saW5lVG8oeDEseTIpO1xuICAgIF9jdHgubGluZVRvKHgxLHkxKTtcblxuICAgIF9jdHguZmlsbCgpO1xuICAgIF9jdHguY2xpcCgpO1xuICAgIC8vIF9jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2UtaW5cIjtcbiAgICBfY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCwwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodClcbiAgICAvLyBfY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwic291cmNlLW92ZXJcIjtcbiAgICAvLyBfY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCwwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodClcbiAgICBfY3R4LnN0cm9rZSgpO1xuICAgIF9jdHguc3Ryb2tlUmVjdCgwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodCk7XG4gICAgX2N0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIHNldFpvb206IGZ1bmN0aW9uIChfc2NhbGUscG9pbnQgKXtcblxuICAgIGlmKCFwb2ludCl7XG4gICAgICBwb2ludCA9IG5ldyBmYWJyaWMuUG9pbnQoMCwgMCk7XG4gICAgfVxuXG4gICAgaWYodGhpcy5jaGFuZ2VEaW1lbnNpb25Pblpvb20pe1xuXG4gICAgICBpZighdGhpcy5vcmlnaW5hbFdpZHRoKXtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgIH1cbiAgICAgIGlmKCF0aGlzLm9yaWdpbmFsSGVpZ2h0KXtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgfVxuICAgICAgdGhpcy5zZXREaW1lbnNpb25zKHtcbiAgICAgICAgd2lkdGg6IE1hdGgucm91bmQodGhpcy5vcmlnaW5hbFdpZHRoICogX3NjYWxlKSxcbiAgICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKHRoaXMub3JpZ2luYWxIZWlnaHQgKiBfc2NhbGUpXG4gICAgICB9LHtcbiAgICAgICAgLy8gY3NzT25seTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuX3pvb21Ub1BvaW50TmF0aXZlKCBwb2ludCwgX3NjYWxlKTtcblxuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX292ZXJsYXlfaW1hZ2UoXCJiYWNrZ3JvdW5kXCIpO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX292ZXJsYXlfaW1hZ2UoXCJvdmVybGF5XCIpO1xuICAgIC8vICB0aGlzLl9zZXRab29tTmF0aXZlKF9zY2FsZSk7XG4gICAgdGhpcy5maXJlKCd2aWV3cG9ydDpzY2FsZWQnLCB7c2NhbGU6IF9zY2FsZX0pO1xuICB9LFxuICB6b29tVG9Qb2ludDogZnVuY3Rpb24ocG9pbnQsIG5ld1pvb20pe1xuICAgIHZhciBfbWF4ID0gIHRoaXMuZ2V0TWF4Wm9vbSgpO1xuICAgIHZhciBfbWluID0gIHRoaXMuZ2V0TWluWm9vbSgpLnNjYWxlO1xuICAgIGlmKG5ld1pvb20gPiBfbWF4KXtcbiAgICAgIG5ld1pvb20gPSBfbWF4O1xuICAgIH1cbiAgICBpZihuZXdab29tIDwgX21pbil7XG4gICAgICBuZXdab29tID0gX21pbjtcbiAgICB9XG4gICAgdGhpcy5zZXRab29tKG5ld1pvb20sIHBvaW50KTtcblxuICB9LFxuICByZXNldFZpZXdwb3J0OiBmdW5jdGlvbiAoKSB7XG4gICAgX2NhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IDE7XG4gICAgX2NhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVszXSA9IDE7XG4gICAgX2NhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVs0XSA9IDA7XG4gICAgX2NhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IDA7XG4gICAgX2NhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0uc2V0Q29vcmRzKCk7XG4gICAgfVxuICB9LFxuICB6b29tVG9Qb2ludEVuYWJsZWQ6IHRydWUsXG4gIG1pblpvb21GYWN0b3I6IDEsXG4gIG1heFpvb206IDIwLFxuICBhdXRvQ2VudGVyQW5kWm9vbU91dEVuYWJsZWQ6IGZhbHNlLFxuICBnZXRNYXhab29tOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMubWF4Wm9vbTtcbiAgfSxcbiAgZ2V0TWluWm9vbTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBfY29udGFpbmVyU2l6ZSA9IHtcbiAgICAgIHdpZHRoOiAkKHRoaXMud3JhcHBlckVsKS53aWR0aCgpLFxuICAgICAgaGVpZ2h0OiAkKHRoaXMud3JhcHBlckVsKS5oZWlnaHQoKVxuICAgIH07XG4gICAgdmFyIF9iZ1NpemUgPSB7XG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0XG4gICAgfTtcbiAgICB2YXIgX21heFNpemUgPSB7XG4gICAgICB3aWR0aDogX2NvbnRhaW5lclNpemUud2lkdGggKiB0aGlzLm1pblpvb21GYWN0b3IsXG4gICAgICBoZWlnaHQ6IF9jb250YWluZXJTaXplLmhlaWdodCAqIHRoaXMubWluWm9vbUZhY3RvclxuICAgIH07XG5cbiAgICByZXR1cm4gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoX2JnU2l6ZSwgX21heFNpemUsICdmaXQnKTtcbiAgfSxcbiAgY2VudGVyQW5kWm9vbU91dDogZnVuY3Rpb24gKCkge1xuXG4gICAgaWYodGhpcy52aXJ0dWFsKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIG9wdGlvbnMgPSB0aGlzLmdldE1pblpvb20oKTtcblxuICAgIHZhciBfY29udGFpbmVyU2l6ZSA9IHtcbiAgICAgIHdpZHRoOiAkKHRoaXMud3JhcHBlckVsKS53aWR0aCgpLFxuICAgICAgaGVpZ2h0OiAkKHRoaXMud3JhcHBlckVsKS5oZWlnaHQoKVxuICAgIH07XG5cbiAgICB2YXIgdnB0ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybS5zbGljZSgwKTtcbiAgICB2cHRbMF0gPSBvcHRpb25zLnNjYWxlO1xuICAgIHZwdFszXSA9IG9wdGlvbnMuc2NhbGU7XG4gICAgdnB0WzRdID0gKF9jb250YWluZXJTaXplLndpZHRoIC0gb3B0aW9ucy53aWR0aCApIC8gMjtcbiAgICB2cHRbNV0gPSAoX2NvbnRhaW5lclNpemUuaGVpZ2h0IC0gb3B0aW9ucy5oZWlnaHQpIC8gMjtcblxuICAgIHRoaXMuc2V0Vmlld3BvcnRUcmFuc2Zvcm0odnB0KTtcblxuXG4gICAgdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfb3ZlcmxheV9pbWFnZShcImJhY2tncm91bmRcIik7XG4gICAgdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfb3ZlcmxheV9pbWFnZShcIm92ZXJsYXlcIik7XG4gICAgLy8gdGhpcy5maXJlKFwidmlld3BvcnQ6c2NhbGVkXCIse3NjYWxlOiBvcHRpb25zLnNjYWxlfSlcbiAgICAvL3RoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGNlbnRlck9uT2JqZWN0OiBmdW5jdGlvbih0YWcpe1xuICAgIHZhciBiciA9IHRhZy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB2YXIgY3QgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgIGJyLndpZHRoIC89IGN0WzBdO1xuICAgIGJyLmhlaWdodCAvPSBjdFszXTtcbiAgICB2YXIgc2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBici53aWR0aCAqIDEuMSxcbiAgICAgIGhlaWdodDogYnIuaGVpZ2h0ICogMS4xXG4gICAgfTtcblxuICAgIHZhciBwcm9wID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoc2l6ZSx0aGlzKTtcbiAgICB2YXIgX3cgPSAodGhpcy53aWR0aCAvIHByb3Auc2NhbGUgLSBzaXplLndpZHRoICkgLyAyO1xuICAgIHZhciBfaCA9ICh0aGlzLmhlaWdodCAvIHByb3Auc2NhbGUgLSBzaXplLmhlaWdodCkgLyAyO1xuICAgIHZhciBfbCA9IChici5sZWZ0ICAtIGN0WzRdKSAvIGN0WzBdO1xuICAgIHZhciBfdCA9IChici50b3AgLSBjdFs1XSkgLyBjdFszXTtcblxuICAgIHZhciB4MSA9IFtcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAwLDAsXG4gICAgICBwcm9wLnNjYWxlLFxuICAgICAgLSB0YWcubGVmdCAqIHByb3Auc2NhbGUgKyAodGFnLndpZHRoICogMC4wNSArIF93KSAqIHByb3Auc2NhbGUsXG4gICAgICAtIHRhZy50b3AgKiBwcm9wLnNjYWxlICsgKHRhZy5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG4gICAgdmFyIHgyID0gW1xuICAgICAgcHJvcC5zY2FsZSxcbiAgICAgIDAsMCxcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAtIF9sICAqIHByb3Auc2NhbGUgKyAoYnIud2lkdGggKiAwLjA1ICsgX3cpICogcHJvcC5zY2FsZSxcbiAgICAgIC0gX3QgICogcHJvcC5zY2FsZSArIChici5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG5cbiAgICB0aGlzLnNldFZpZXdwb3J0VHJhbnNmb3JtKHgyKTtcbiAgICB0aGlzLmZpcmUoXCJ2aWV3cG9ydDpzY2FsZWRcIix7c2NhbGU6IHByb3Auc2NhbGV9KVxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG5cbiAgd2hlZWxab29tOiBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgIGlmKCF0aGlzLm1vdXNlV2hlZWxFbmFibGVkIHx8IHRoaXMuem9vbUN0cmxLZXkgJiYgIWV2ZW50LmN0cmxLZXkpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbi8vRmluZCBuZWFyZXN0IHBvaW50LCB0aGF0IGlzIGluc2lkZSBpbWFnZSBFTkRcbiAgICB2YXIgem9vbVN0ZXA7Ly8gPSAwLjEgKiBldmVudC5kZWx0YVk7XG4gICAgaWYgKGV2ZW50LmRlbHRhWSA8IDApIHtcbiAgICAgIHpvb21TdGVwID0gMS4xO1xuICAgIH0gZWxzZSB7XG4gICAgICB6b29tU3RlcCA9IDAuOTtcbiAgICB9XG5cbiAgICB2YXIgY1pvb20gPSB0aGlzLmdldFpvb20oKTtcbiAgICB2YXIgbmV3Wm9vbSA9IGNab29tICogem9vbVN0ZXA7XG4gICAgdmFyIG1pblpvb20gPSB0aGlzLmdldE1pblpvb20oKS5zY2FsZTtcblxuXG4gICAgaWYodGhpcy56b29tVG9Qb2ludEVuYWJsZWQpe1xuICAgICAgdmFyIHBvaW50ID0gbmV3IGZhYnJpYy5Qb2ludChldmVudC5vZmZzZXRYLCBldmVudC5vZmZzZXRZKTtcbiAgICAgIHZhciBfeCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF07XG4gICAgICB2YXIgX3kgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdO1xuXG4gICAgICAvLyBGaW5kIG5lYXJlc3QgcG9pbnQsIHRoYXQgaXMgaW5zaWRlIGltYWdlIEJFR0lOXG4gICAgICAvLyBJdCBpcyBuZWVkZWQgdG8gcHJldmVudCBjYW52YXMgdG8gem9vbSBvdXRzaWRlIGltYWdlXG4gICAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggKiB0aGlzLmdldFpvb20oKSArIF94O1xuICAgICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCAqIHRoaXMuZ2V0Wm9vbSgpICsgX3k7XG5cblxuICAgICAgaWYgKHBvaW50LnggPCBfeCkge1xuICAgICAgICBwb2ludC54ID0gX3g7XG4gICAgICB9XG4gICAgICBpZiAocG9pbnQueSA8IF95KSB7XG4gICAgICAgIHBvaW50LnkgPSBfeTtcbiAgICAgIH1cbiAgICAgIGlmIChwb2ludC54ID4gX3cpIHtcbiAgICAgICAgcG9pbnQueCA9IF93O1xuICAgICAgfVxuICAgICAgaWYgKHBvaW50LnkgPiBfaCkge1xuICAgICAgICBwb2ludC55ID0gX2g7XG4gICAgICB9XG4gICAgICBpZiAoICBtaW5ab29tID4gbmV3Wm9vbSkge1xuICAgICAgICBpZih0aGlzLmF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZCl7XG4gICAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihldmVudC5kZWx0YVkgPCAwICl7XG4gICAgICAgICAgdGhpcy56b29tVG9Qb2ludChwb2ludCwgbmV3Wm9vbSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuem9vbVRvUG9pbnQocG9pbnQsIG5ld1pvb20pO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5zZXRab29tKG5ld1pvb20pO1xuICAgIH1cblxuXG5cblxuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHJldHVybiBmYWxzZTsgLy9wcmV2ZW50aW5nIHNjcm9sbCBwYWdlXG4gIH0sXG4gIHNjYWxlRmFjdG9yOiAxLjEsXG4gIGdldE9yaWduYWxDZW50ZXIgOiBmdW5jdGlvbigpe1xuICAgIHZhciBwb2ludCA9IHRoaXMuZ2V0Q2VudGVyKCk7XG4gICAgcG9pbnQubGVmdCArPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIDtcbiAgICBwb2ludC50b3AgKz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XTtcbiAgICByZXR1cm4gcG9pbnQ7XG4gIH1cbn0pO1xuXG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgY2VudGVyQW5kWm9vbU91dDoge1xuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXNlYXJjaC1wbHVzJyxcbiAgICB0aXRsZTogJ2NlbnRlckFuZFpvb21PdXQnXG4gIH1cbn0pXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucywge1xuICB6b29tT3V0OiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtc2VhcmNoLW1pbnVzJyxcbiAgICB0aXRsZTogJ3pvb20tb3V0JyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBwb2ludCA9IHRoaXMuZ2V0T3JpZ25hbENlbnRlcigpO1xuICAgICAgdmFyIHNjYWxlVmFsdWUgPSB0aGlzLmdldFpvb20oKSAvIHRoaXMuc2NhbGVGYWN0b3I7XG4gICAgICB0aGlzLnpvb21Ub1BvaW50KHt4OiBwb2ludC5sZWZ0LCB5OiBwb2ludC50b3B9LHNjYWxlVmFsdWUpO1xuICAgIH1cbiAgfSxcbiAgem9vbU51bWJlcjoge1xuICAgIHR5cGU6ICdudW1iZXInLFxuICAgIHZhbHVlOiB7XG4gICAgICBtaW46ICBmdW5jdGlvbigpe3JldHVybiAwLjAxfSxcbiAgICAgIG1heDogIGZ1bmN0aW9uKCl7cmV0dXJuIDEwfSxcbiAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICB0aGlzLnNldFpvb20odmFsKVxuICAgICAgfSxcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRab29tKClcbiAgICAgIH0sXG4gICAgICBvYnNlcnZlOiBcInZpZXdwb3J0OnNjYWxlZFwiXG4gICAgfVxuICB9LFxuICB6b29tSW46IHtcbiAgICBjbGFzc05hbWU6ICdmYSBmYS1zZWFyY2gtcGx1cycsXG4gICAgdGl0bGU6ICd6b29tLWluJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBwb2ludCA9IHRoaXMuZ2V0T3JpZ25hbENlbnRlcigpO1xuICAgICAgdmFyIHNjYWxlVmFsdWUgPSB0aGlzLmdldFpvb20oKSAqIHRoaXMuc2NhbGVGYWN0b3I7XG4gICAgICB0aGlzLnpvb21Ub1BvaW50KHt4OiBwb2ludC5sZWZ0LCB5OiBwb2ludC50b3B9LHNjYWxlVmFsdWUpO1xuICAgIH1cbiAgfVxuICAvLyB6b29tOiB7XG4gIC8vICAgdGl0bGU6IFwiem9vbVwiLFxuICAvLyAgIG1lbnU6IHpvb21PdXRcbiAgLy8gfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvem9vbS5qcyIsIlxuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBfdG9TVkdfb3ZlcndyaXR0ZW46IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnRvU1ZHLFxuICB0b1NWRzogZnVuY3Rpb24ob3B0aW9ucywgcmV2aXZlcikge1xuXG4gICAgbGV0IF93ID0gdGhpcy53aWR0aCwgX2ggPSB0aGlzLmhlaWdodDtcbiAgICBpZih0aGlzLm9yaWdpbmFsV2lkdGgpe1xuICAgICAgdGhpcy5zdmdWaWV3cG9ydFRyYW5zZm9ybWF0aW9uID0gZmFsc2U7XG4gICAgICB0aGlzLndpZHRoID0gdGhpcy5vcmlnaW5hbFdpZHRoO1xuICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLm9yaWdpbmFsSGVpZ2h0O1xuICAgIH1cblxuICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7IH0pO1xuXG4gICAgbGV0IG1hcmt1cCA9IFtdO1xuXG4gICAgdGhpcy5fc2V0U1ZHUHJlYW1ibGUobWFya3VwLCBvcHRpb25zKTtcbiAgICB0aGlzLl9zZXRTVkdIZWFkZXIobWFya3VwLCBvcHRpb25zKTtcbiAgICB0aGlzLl9zZXRTVkdMYXllcnMobWFya3VwLCByZXZpdmVyKTtcblxuICAgIG1hcmt1cC5wdXNoKCc8L3N2Zz4nKTtcblxuICAgIGlmKHRoaXMub3JpZ2luYWxXaWR0aCl7XG4gICAgICB0aGlzLndpZHRoID0gX3c7XG4gICAgICB0aGlzLmhlaWdodCA9IF9oO1xuICAgIH1cbiAgICByZXR1cm4gbWFya3VwLmpvaW4oJycpO1xuICB9LFxuICBfc2V0U1ZHTGF5ZXJzKG1hcmt1cCwgcmV2aXZlcil7XG5cbiAgICBmb3IobGV0IGxheWVySWQgb2YgdGhpcy5fbGF5ZXJzKXtcbiAgICAgIGlmKHRoaXMubGF5ZXJzW2xheWVySWRdLnN2Zyl7XG4gICAgICAgIHRoaXMubGF5ZXJzW2xheWVySWRdLnN2Zyh0aGlzLCBtYXJrdXAsIHJldml2ZXIpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgZ2V0U1ZHQm9keShvcHRpb25zLHJldml2ZXIpe1xuXG4gICAgbGV0IF93ID0gdGhpcy53aWR0aCxcbiAgICAgICAgX2ggPSB0aGlzLmhlaWdodDtcblxuICAgIGlmKHRoaXMub3JpZ2luYWxXaWR0aCl7XG4gICAgICB0aGlzLndpZHRoID0gdGhpcy5vcmlnaW5hbFdpZHRoO1xuICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLm9yaWdpbmFsSGVpZ2h0O1xuICAgIH1cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIGxldCBzY2FsZVggPSBvcHRpb25zLnNjYWxlWCB8fCAob3B0aW9ucy53aWR0aCA/IG9wdGlvbnMud2lkdGggLyB0aGlzLndpZHRoIDogMSksXG4gICAgICAgIHNjYWxlWSA9IG9wdGlvbnMuc2NhbGVZIHx8IChvcHRpb25zLmhlaWdodCA/IG9wdGlvbnMuaGVpZ2h0IC8gdGhpcy5oZWlnaHQgOiAxKSxcbiAgICAgICAgX2wgPSAob3B0aW9ucy5sZWZ0IHx8IDApLFxuICAgICAgICBfdCA9IChvcHRpb25zLnRvcCB8fCAwKSAsXG4gICAgICAgIGFuZ2xlID0gKG9wdGlvbnMuYW5nbGUgfHwgMCkgLFxuICAgICAgICBjbGlwUGF0aCA9IFwiXCI7XG5cbiAgICBpZihvcHRpb25zLmNsaXBQYXRoKXtcbiAgICAgIGNsaXBQYXRoID0gYGNsaXAtcGF0aDogdXJsKCMke29wdGlvbnMuY2xpcFBhdGh9KTtgO1xuICAgIH1cblxuICAgIGxldCB0cmFuc2Zvcm0gPSBcIlwiO1xuICAgIGlmKGFuZ2xlICE9PSAwKXtcbiAgICAgIHRyYW5zZm9ybSArPSBgcm90YXRlKCR7YW5nbGV9KSBgO1xuICAgIH1cbiAgICBpZihfbCAhPT0gMCB8fCBfdCAhPT0gMCl7XG4gICAgICB0cmFuc2Zvcm0gKz0gYHRyYW5zbGF0ZSgke19sfSAke190fSkgYDtcbiAgICB9XG4gICAgaWYoc2NhbGVYICE9PTEgIHx8IHNjYWxlWSAhPT0gMSl7XG4gICAgICB0cmFuc2Zvcm0gKz0gYHNjYWxlKCR7c2NhbGVYfSAke3NjYWxlWX0pIGA7XG4gICAgfVxuXG4gICAgbGV0IG1hcmt1cCA9IFtgPGcgdHJhbnNmb3JtPVwiJHt0cmFuc2Zvcm19XCIgc3R5bGU9XCIke2NsaXBQYXRofVwiIGlkPVwiJHtvcHRpb25zLmNsaXBQYXRofVwiPmBdO1xuXG4gICAgdGhpcy5fc2V0U1ZHTGF5ZXJzKG1hcmt1cCwgcmV2aXZlcik7XG5cbiAgICBtYXJrdXAucHVzaCgnPC9nPicpO1xuXG4gICAgaWYodGhpcy5vcmlnaW5hbFdpZHRoKXtcbiAgICAgIHRoaXMud2lkdGggPSBfdztcbiAgICAgIHRoaXMuaGVpZ2h0ID0gX2g7XG4gICAgfVxuICAgIHJldHVybiBtYXJrdXA7XG4gIH1cbn0pO1xuXG5mYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5pbmxpbmVTVkcgPSBmYWxzZTtcblxuZmFicmljLkltYWdlLnByb3RvdHlwZS5nZXRTdmdTcmMgPSBmdW5jdGlvbihmaWx0ZXJlZCl7XG4gIHZhciBlbGVtZW50ID0gZmlsdGVyZWQgPyB0aGlzLl9lbGVtZW50IDogdGhpcy5fb3JpZ2luYWxFbGVtZW50O1xuICBpZiAoZWxlbWVudCkge1xuICAgIHZhciBfc3JjID0gZmFicmljLmlzTGlrZWx5Tm9kZSA/IGVsZW1lbnQuX3NyYyA6IGVsZW1lbnQuc3JjO1xuICAgIGlmKHRoaXMuY2FudmFzLmlubGluZVNWRyAmJiAhX3NyYy5zdGFydHNXaXRoKFwiZGF0YTppbWFnZVwiKSl7XG4gICAgICBpZihlbGVtZW50LnRvRGF0YVVSTCl7XG4gICAgICAgIHJldHVybiBlbGVtZW50LnRvRGF0YVVSTCgpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHZhciBjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgICAgIGNhbnZhcy53aWR0aCA9IGVsZW1lbnQud2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBlbGVtZW50LmhlaWdodDtcbiAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICBjdHguZHJhd0ltYWdlKGVsZW1lbnQsMCwwKTtcbiAgICAgICAgdmFyIGRhdGFVUkwgPSAgY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgICByZXR1cm4gZGF0YVVSTDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9zcmM7XG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIHRoaXMuc3JjIHx8ICcnO1xuICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3N2Zy5qcyIsIlxudmFyICQgPSB3aW5kb3cualF1ZXJ5IHx8IHdpbmRvdy4kO1xuJC5mb2N1c05leHRFbGVtZW50ID0gZnVuY3Rpb24gKHByZXZpb3MpIHtcbiAgLy9hZGQgYWxsIGVsZW1lbnRzIHdlIHdhbnQgdG8gaW5jbHVkZSBpbiBvdXIgc2VsZWN0aW9uXG4gIHZhciBmb2N1c3NhYmxlRWxlbWVudHMgPSAnYTpub3QoW2Rpc2FibGVkXSksIGJ1dHRvbjpub3QoW2Rpc2FibGVkXSksIGlucHV0W3R5cGU9dGV4dF06bm90KFtkaXNhYmxlZF0pLCB0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSksIFt0YWJpbmRleF06bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9XCItMVwiXSknO1xuICAvLyBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCApIHtcbiAgdmFyIGZvY3Vzc2FibGUgPSBBcnJheS5wcm90b3R5cGUuZmlsdGVyLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChmb2N1c3NhYmxlRWxlbWVudHMpLFxuICAgIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAvL2NoZWNrIGZvciB2aXNpYmlsaXR5IHdoaWxlIGFsd2F5cyBpbmNsdWRlIHRoZSBjdXJyZW50IGFjdGl2ZUVsZW1lbnRcbiAgICAgIHJldHVybiBlbGVtZW50Lm9mZnNldFdpZHRoID4gMCB8fCBlbGVtZW50Lm9mZnNldEhlaWdodCA+IDAgfHwgZWxlbWVudCA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudFxuICAgIH0pO1xuXG4gIHZhciBpbmRleCA9IGZvY3Vzc2FibGUuaW5kZXhPZihkb2N1bWVudC5hY3RpdmVFbGVtZW50KTtcbiAgdmFyIG5leHRFbGVtZW50O1xuICBpZihwcmV2aW9zKXtcbiAgICBuZXh0RWxlbWVudCA9IGZvY3Vzc2FibGVbaW5kZXggLSAxXSB8fCBmb2N1c3NhYmxlW2ZvY3Vzc2FibGUubGVuZ3RoIC0gMV07XG4gIH1lbHNle1xuICAgIG5leHRFbGVtZW50ID0gZm9jdXNzYWJsZVtpbmRleCArIDFdIHx8IGZvY3Vzc2FibGVbMF07XG4gIH1cbiAgbmV4dEVsZW1lbnQuZm9jdXMoKTtcbiAgLy8gfVxufTtcblxuXG5mYWJyaWMuSVRleHQucHJvdG90eXBlLmFjdGl2YXRlTmV4dE9iamVjdCA9IGZ1bmN0aW9uKGUpe1xuICB0aGlzLmV4aXRFZGl0aW5nKCk7XG4gIHZhciBfcHJldiA9IGUuc2hpZnRLZXk7XG4gIHRoaXMuY2FudmFzLmFjdGl2YXRlTmV4dE9iamVjdChfcHJldik7XG59O1xuXG5mYWJyaWMuSVRleHQucHJvdG90eXBlLmtleXNNYXBbOV0gPSBcImFjdGl2YXRlTmV4dE9iamVjdFwiO1xuXG5mYWJyaWMuZm9jdXNlZENhbnZhcyA9IG51bGw7XG5mYWJyaWMudXRpbC5hZGRMaXN0ZW5lcihmYWJyaWMud2luZG93LCAna2V5ZG93bicsIGZ1bmN0aW9uKGUpe1xuICBpZihlLmNvZGUgPT09IFwiVGFiXCIpe1xuICAgIGZhYnJpYy5fdGFiYmFibGVTZXRUb0xhc3QgPSBlLnNoaWZ0S2V5O1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSx7XG4gIHRhYmJhYmxlOiBmYWxzZSxcbiAgYWN0aXZhdGVGaXJzdE9iamVjdDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG4gICAgaWYodGhpcy5fb2JqZWN0cy5sZW5ndGggPiAwKXtcbiAgICAgIHRoaXMuc2V0QWN0aXZlT2JqZWN0KHRoaXMuX29iamVjdHNbMF0pO1xuICAgIH1cbiAgfSxcbiAgYWN0aXZhdGVMYXN0T2JqZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICB0aGlzLmRpc2NhcmRBY3RpdmVPYmplY3QoKTtcbiAgICBpZih0aGlzLl9vYmplY3RzLmxlbmd0aCA+IDApe1xuICAgICAgdGhpcy5zZXRBY3RpdmVPYmplY3QodGhpcy5fb2JqZWN0c1t0aGlzLl9vYmplY3RzLmxlbmd0aCAtIDFdKTtcbiAgICB9XG4gIH0sXG4gIGFjdGl2YXRlTmV4dE9iamVjdDogZnVuY3Rpb24gKHByZXZpb3MpIHtcbiAgICB2YXIgX2FjdGl2ZSA9ICB0aGlzLmdldEFjdGl2ZU9iamVjdCgpO1xuICAgIHZhciBfaW5kZXggPSB0aGlzLl9vYmplY3RzLmluZGV4T2YoX2FjdGl2ZSk7XG4gICAgdmFyIG5leHQgPSB0aGlzLl9vYmplY3RzW19pbmRleCArIChwcmV2aW9zID8gLSAxIDogMSldO1xuICAgIGlmKG5leHQpe1xuICAgICAgdGhpcy5zZXRBY3RpdmVPYmplY3QobmV4dCk7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG5cbiAgICAgIHRoaXMuX2lnbm9yZUZvY3VzRXZlbnQgPSB0cnVlO1xuICAgICAgJCh0aGlzLmlucHV0RWxlbWVudCkuZm9jdXMoKTtcbiAgICAgIGZhYnJpYy5fdGFiYmFibGVTZXRUb0xhc3QgPSBwcmV2aW9zO1xuICAgICAgJC5mb2N1c05leHRFbGVtZW50KHByZXZpb3MpO1xuICAgIH1cbiAgfSxcbiAgc2V0VGFiYmFibGU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgaWYodGhpcy50YWJiYWJsZSA9PT0gdmFsdWUpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnRhYmJhYmxlID0gdmFsdWU7XG4gICAgaWYoIXZhbHVlKXtcbiAgICAgICQodGhpcy5pbnB1dEVsZW1lbnQpLnJlbW92ZSgpO1xuICAgICAgZGVsZXRlIHRoaXMuaW5wdXRFbGVtZW50O1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdGhpcy5pbnB1dEVsZW1lbnQgPSBmYWJyaWMuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICB0aGlzLmlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsXCJ0ZXh0XCIpO1xuICAgIHRoaXMuaW5wdXRFbGVtZW50LnN0eWxlLmNzc1RleHQgPSAncG9zaXRpb246IGFic29sdXRlOyB6LWluZGV4OiAtOTk5OyBvcGFjaXR5OiAwOyB3aWR0aDogMXB4OyBoZWlnaHQ6IDFweDsgZm9udC1zaXplOiAxcHg7JztcbiAgICB0aGlzLndyYXBwZXJFbC5hcHBlbmRDaGlsZCh0aGlzLmlucHV0RWxlbWVudCk7XG4gICAgZmFicmljLnV0aWwuYWRkTGlzdGVuZXIodGhpcy5pbnB1dEVsZW1lbnQsICdmb2N1cycsIHRoaXMuZm9jdXMuYmluZCh0aGlzKSk7XG5cbiAgICAkKHRoaXMuaW5wdXRFbGVtZW50KS5iaW5kKHtcbiAgICAgIGZvY3VzIDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKF90aGlzLl9pZ25vcmVGb2N1c0V2ZW50KXtcbiAgICAgICAgICBkZWxldGUgX3RoaXMuX2lnbm9yZUZvY3VzRXZlbnQ7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIF90aGlzLmZvY3VzKCk7XG4gICAgICAgIC8vIGZhYnJpYy5mb2N1c2VkQ2FudmFzID0gX3RoaXM7XG4gICAgICAgIGZhYnJpYy5fdGFiYmFibGVTZXRUb0xhc3QgPyBfdGhpcy5hY3RpdmF0ZUxhc3RPYmplY3QoKSA6IF90aGlzLmFjdGl2YXRlRmlyc3RPYmplY3QoKTtcbiAgICAgICAgLy8gJChfdGhpcy53cmFwcGVyRWwpLmNzcygnYm9yZGVyJywnMXB4IGRvdHRlZCAjMDAwJyk7XG4gICAgICB9LFxuICAgICAgYmx1ciA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBmYWJyaWMuZm9jdXNlZENhbnZhcyA9IG51bGw7XG4gICAgICAgIC8vICQodGhpcy53cmFwcGVyRWwpLmNzcygnYm9yZGVyJywnbm9uZScpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMub24oXCJtb3VzZTpkb3duXCIsIHRoaXMuZm9jdXMuYmluZCh0aGlzKSlcblxuICB9LFxuICBvbmtleVVwOiBmdW5jdGlvbihlKXtcbiAgICBjb25zb2xlLmxvZyhlKTtcbiAgfSxcbiAgYmx1cjogZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLl9hY3RpdmVPYmplY3Qpe1xuICAgICAgaWYodGhpcy5fYWN0aXZlT2JqZWN0LmlzRWRpdGluZyl7XG4gICAgICAgIHRoaXMuX2FjdGl2ZU9iamVjdC5leGl0RWRpdGluZygpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIHRoaXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGZvY3VzOiBmdW5jdGlvbigpe1xuICAgIGlmKGZhYnJpYy5mb2N1c2VkQ2FudmFzID09IHRoaXMpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZihmYWJyaWMuZm9jdXNlZENhbnZhcyl7XG4gICAgICBmYWJyaWMuZm9jdXNlZENhbnZhcy5ibHVyKCk7XG4gICAgfVxuICAgIGZhYnJpYy5mb2N1c2VkQ2FudmFzID0gdGhpcztcbiAgICByZXR1cm4gdGhpcztcbiAgICAvLyB0aGlzLmFjdGl2YXRlTmV4dE9iamVjdCgpO1xuICAgIC8vICQodGhpcy53cmFwcGVyRWwpLmNzcygnYm9yZGVyJywnMXB4IGRvdHRlZCAjMDAwJyk7XG4gICAgLy8gJCh0aGlzLndyYXBwZXJFbCkuZm9jdXMoKTtcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZmFicmljLnRhYmJhYmxlLmpzIiwiXHJcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlRleHQucHJvdG90eXBlLHtcclxuICAgIHN0YXRpY0JvcmRlckNvbG9yOiBmYWxzZSxcclxuICAgIF9yZW5kZXJfc3RhdGljQm9yZGVyQ29sb3JPdmVyd3JpdHRlbjogZmFicmljLlRleHQucHJvdG90eXBlLnJlbmRlcixcclxuICAgIHJlbmRlcjogZnVuY3Rpb24oY3R4LCBub1RyYW5zZm9ybSl7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyX3N0YXRpY0JvcmRlckNvbG9yT3ZlcndyaXR0ZW4oY3R4KTtcclxuXHJcbiAgICAgICAgY3R4LnNhdmUoKTtcclxuICAgICAgICBpZiAoIW5vVHJhbnNmb3JtKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtKGN0eCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2RyYXdCb3JkZXJzKGN0eCk7XHJcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcclxuXHJcblxyXG4gICAgfSxcclxuICAgIF9zdGF0aWNCb3JkZXJDb2xvclJlbmRlcjogZmFicmljLklUZXh0LnByb3RvdHlwZS5fcmVuZGVyLFxyXG4gICAgX2RyYXdCb3JkZXJzOiBmdW5jdGlvbihjdHgpe1xyXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZSB8fCAhdGhpcy5zdGF0aWNCb3JkZXJDb2xvcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuc3RhdGljQm9yZGVyQ29sb3I7XHJcbiAgICAgICAgY3R4LnN0cm9rZVJlY3QoXHJcbiAgICAgICAgICAgIC10aGlzLndpZHRoIC8gMixcclxuICAgICAgICAgICAgLXRoaXMuaGVpZ2h0IC8gMixcclxuICAgICAgICAgICAgdGhpcy53aWR0aCxcclxuICAgICAgICAgICAgdGhpcy5oZWlnaHRcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59KTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvc3RhdGljQm9yZGVyQ29sb3IuanMiLCIvKipcbiogSW50ZXJhY3RpdmVNb2RlIG1peGluLiBBbGxvdyB0byBzd2l0Y2ggYmV0d2VlbiBwYW4vZWRpdC9kcmF3aW5nIGNhbnZhcyBtb2Rlcy5cbiovXG5cbid1c2Ugc3RyaWN0JztcblxuXG52YXIgX21vdXNlX2Rvd25fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZURvd247XG52YXIgX21vdXNlX3VwX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VVcDtcbnZhciBfbW91c2VfbW92ZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9vbk1vdXNlTW92ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICBfaW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5faW5pdEV2ZW50TGlzdGVuZXJzLFxuICBfaW5pdEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5faW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuKCk7XG4gICAgdGhpcy5fX19vbktleURvd24gPSB0aGlzLl9vbktleURvd24uYmluZCh0aGlzKTtcbiAgICBmYWJyaWMudXRpbC5hZGRMaXN0ZW5lcihmYWJyaWMud2luZG93LCAna2V5ZG93bicsIHRoaXMuX19fb25LZXlEb3duKTtcbiAgfSxcbiAgX3JlbW92ZUxpc3RlbmVyc19vdmVyd3JpdHRlbjogZmFicmljLkNhbnZhcy5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXJzLFxuICByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9yZW1vdmVMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4oKTtcbiAgICBmYWJyaWMudXRpbC5yZW1vdmVMaXN0ZW5lcihmYWJyaWMud2luZG93LCAna2V5ZG93bicsIHRoaXMuX19fb25LZXlEb3duKTtcbiAgfSxcbiAgX29uS2V5RG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gdGhpcy5fYXBwbHlNaXhlZE1vZGUoZSk7XG4gIH0sXG4gIGdldEludGVyYWN0aXZlTW9kZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmludGVyYWN0aXZlTW9kZTtcbiAgfSxcbiAgc2V0SW50ZXJhY3RpdmVNb2RlOiBmdW5jdGlvbiAodG9vbCkge1xuICAgIC8vdG9kbyBjaGVja3RoaXMgb3V0XG4gICAgLy8gaWYgKHRvb2wgPT09ICdoYW5kJykge1xuICAgIC8vICAgdGhpcy5zZXRDdXJzb3IoJ3BvaW50ZXInKTtcbiAgICAvLyB9XG4gICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gKHRvb2wgPT09ICdkcmF3Jyk7XG4gICAgdGhpcy5pc0hhbmRNb2RlID0gKHRvb2wgPT09ICdoYW5kJyk7XG4gICAgdGhpcy5pbnRlcmFjdGl2ZSA9ICh0b29sICE9PSAnZGlzYWJsZWQnKTtcbiAgICB0aGlzLmlzTWl4ZWRNb2RlID0gKHRvb2wgPT09ICdtaXhlZCcpO1xuXG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICB0aGlzLnVwcGVyQ2FudmFzRWwuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnO1xuICAgIH1cbiAgICB0aGlzLmludGVyYWN0aXZlTW9kZSA9IHRvb2w7XG4gIH0sXG5cbiAgLyoqXG4gICAqICBjdXJyZW50IG1vZGVcbiAgICogIEB2YWx1ZXMgZGVmYXVsdCB8IGhhbmQgfCBzZWxlY3Rpb25cbiAgICogIEBjb21tZW50XG4gICAqICAgICAgaGFuZCAgICAgIC0gbW92aW5nIGNhbnZhc1xuICAgKiAgICAgIGRyYXcgLSBkcmF3aW5nIHJlYWN0YW5nbGVzXG4gICAqICAgICAgc2VsZWN0aW9uIC0gZGVmYXVsdCBiZWhhdmlvclxuICAgKi9cbiAgaW50ZXJhY3RpdmVNb2RlOiAnZGVmYXVsdCcsXG5cbiAgaXNIYW5kTW9kZTogZmFsc2UsXG4gIF9oYW5kTW9kZUN1cnNvck1vdmU6IGZhbHNlLFxuICBfaGFuZE1vZGVDdXJzb3JEb3duOiBmYWxzZSxcbiAgX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb246IHt4OiAwLCB5OiAwfSxcbiAgX2hhbmRNb2RlTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICh0aGlzLl9oYW5kTW9kZUN1cnNvckRvd24gPT09IHRydWUpIHtcblxuICAgICAgaWYgKGUucGFnZVkgPT09IHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueSAmJiBlLnBhZ2VYID09PSB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLngpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9oYW5kTW9kZUN1cnNvck1vdmUgPSB0cnVlO1xuXG4gICAgICB2YXIgc2Nyb2xsID0ge3g6IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0sIHk6IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV19O1xuXG4gICAgICB2YXIgbmV3U2Nyb2xsID0ge1xuICAgICAgICB4OiBzY3JvbGwueCAtICh0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnggLSBlLnBhZ2VYKSxcbiAgICAgICAgeTogc2Nyb2xsLnkgLSAodGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi55IC0gZS5wYWdlWSlcbiAgICAgIH07XG5cbiAgICAgIHZhciBkaW1zID0ge1xuICAgICAgICB3aWR0aDogdGhpcy5zaXplLndpZHRoICogdGhpcy56b29tIC0gdGhpcy5sb3dlckNhbnZhc0VsLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuc2l6ZS5oZWlnaHQgKiB0aGlzLnpvb20gLSB0aGlzLmxvd2VyQ2FudmFzRWwuaGVpZ2h0XG4gICAgICB9O1xuICAgICAgLyogIHRvZG8gbmVlZCB0byBhZGQgc29tZSByZXN0cmljdGlvbnMgbGF0ZXJcbiAgICAgICAvL01hdGgubWF4KE1hdGgubWluKDAsbmV3U2Nyb2xsLngpLC1kaW1zLndpZHRoKTtcbiAgICAgICAvL01hdGgubWF4KE1hdGgubWluKDAsbmV3U2Nyb2xsLnkpLC1kaW1zLmhlaWdodCk7XG4gICAgICAgKi9cbiAgICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gPSBuZXdTY3JvbGwueDtcbiAgICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gPSBuZXdTY3JvbGwueTtcblxuICAgICAgdGhpcy5maXJlKCd2aWV3cG9ydDp0cmFuc2xhdGUnKTtcblxuICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHRoaXMuX29iamVjdHNbaV0uc2V0Q29vcmRzKCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueSA9IGUucGFnZVk7XG4gICAgICB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnggPSBlLnBhZ2VYO1xuICAgIH1cbiAgfSxcbiAgX2hhbmRNb2RlTW91c2VVcDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yRG93biA9IGZhbHNlO1xuICAgIGlmICghdGhpcy5faGFuZE1vZGVDdXJzb3JNb3ZlKSB7XG5cbiAgICB9XG4gIH0sXG4gIF9oYW5kTW9kZU1vdXNlRG93bjogZnVuY3Rpb24gKGUpIHtcblxuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yTW92ZSA9IGZhbHNlO1xuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yRG93biA9IHRydWU7XG4gICAgdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbiA9IHtcbiAgICAgIHk6IGUucGFnZVksXG4gICAgICB4OiBlLnBhZ2VYXG4gICAgfTtcbiAgfSxcbiAgaGFuZE1vZGVFbmFibGVkOiBmYWxzZSxcbiAgaGFuZE1vZGVLZXk6IFwiQWx0XCIsXG4gIF9hcHBseU1peGVkTW9kZTogZnVuY3Rpb24gKGUpIHtcblxuICAgIGlmICh0aGlzLmhhbmRNb2RlRW5hYmxlZCAmJiBlLmFsdEtleSB8fCBlLmtleSA9PT0gdGhpcy5oYW5kTW9kZUtleSkge1xuICAgICAgLy9pZiBzaGlmdCB1c2UgaGFuZCBtb2RlXG4gICAgICBpZiAoIXRoaXMuaXNIYW5kTW9kZSkge1xuICAgICAgICB0aGlzLmlzSGFuZE1vZGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZXRDdXJzb3IoJ3BvaW50ZXInKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNaXhlZE1vZGUgJiYgIXRoaXMuX2lzQ3VycmVudGx5RHJhd2luZyAmJiAhdGhpcy5fY3VycmVudFRyYW5zZm9ybSkge1xuXG4gICAgICB0aGlzLmlzSGFuZE1vZGUgPSBmYWxzZTtcblxuICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQgPSB0aGlzLmZpbmRUYXJnZXQoZSk7XG4gICAgICBpZiAodGhpcy5fY3VycmVudF90YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuZnJlZURyYXdpbmdCcnVzaCAmJiB0aGlzLl9jdXJyZW50X3RhcmdldC5hbGxvd0RyYXdpbmcpIHtcbiAgICAgICAgICB2YXIgY29ybmVyID0gdGhpcy5fY3VycmVudF90YXJnZXQuX2ZpbmRUYXJnZXRDb3JuZXIodGhpcy5nZXRQb2ludGVyKGUsIHRydWUpKTtcbiAgICAgICAgICBpZiAoIWNvcm5lcikge1xuICAgICAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gdHJ1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5mcmVlRHJhd2luZ0JydXNoICYmICF0aGlzLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgICB0aGlzLnNldEN1cnNvcih0aGlzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaXNIYW5kTW9kZSA9IGZhbHNlO1xuICAgIH1cblxuICB9LFxuICBfb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fYXBwbHlNaXhlZE1vZGUoZSk7XG5cbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlKSB7XG5cbiAgICAgIGlmICh0aGlzLl9jdXJyZW50X3RhcmdldCAmJiB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlX292ZXJ3cml0dGVuKSB7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGUgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5faGFuZE1vZGVBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRNb2RlTW91c2VNb3ZlKGUpO1xuICAgICAgfVxuICAgICAgdGhpcy5maXJlKCdtb3VzZTptb3ZlJywge3RhcmdldDogdGhpcy5fY3VycmVudF90YXJnZXQsIGU6IGV9KTtcbiAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0ICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LmZpcmUoJ21vdXNlbW92ZScsIHtlOiBlfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIF9tb3VzZV9tb3ZlX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG4gICAgfVxuICB9LCAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9vblNjYWxlOiBmdW5jdGlvbiAoZSwgdHJhbnNmb3JtLCB4LCB5KSB7XG5cbiAgICB2YXIgdXNlVW5pU2NhbGUgPSBlLnNoaWZ0S2V5IF4gdGhpcy5zaGlmdEludmVydGVkO1xuICAgIC8vIHJvdGF0ZSBvYmplY3Qgb25seSBpZiBzaGlmdCBrZXkgaXMgbm90IHByZXNzZWRcbiAgICAvLyBhbmQgaWYgaXQgaXMgbm90IGEgZ3JvdXAgd2UgYXJlIHRyYW5zZm9ybWluZ1xuICAgIGlmICgodXNlVW5pU2NhbGUgfHwgdGhpcy51bmlTY2FsZVRyYW5zZm9ybSkgJiYgIXRyYW5zZm9ybS50YXJnZXQuZ2V0KCdsb2NrVW5pU2NhbGluZycpKSB7XG4gICAgICB0cmFuc2Zvcm0uY3VycmVudEFjdGlvbiA9ICdzY2FsZSc7XG4gICAgICByZXR1cm4gdGhpcy5fc2NhbGVPYmplY3QoeCwgeSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gU3dpdGNoIGZyb20gYSBub3JtYWwgcmVzaXplIHRvIHByb3BvcnRpb25hbFxuICAgICAgaWYgKCF0cmFuc2Zvcm0ucmVzZXQgJiYgdHJhbnNmb3JtLmN1cnJlbnRBY3Rpb24gPT09ICdzY2FsZScpIHtcbiAgICAgICAgdGhpcy5fcmVzZXRDdXJyZW50VHJhbnNmb3JtKGUpO1xuICAgICAgfVxuXG4gICAgICB0cmFuc2Zvcm0uY3VycmVudEFjdGlvbiA9ICdzY2FsZUVxdWFsbHknO1xuICAgICAgcmV0dXJuIHRoaXMuX3NjYWxlT2JqZWN0KHgsIHksICdlcXVhbGx5Jyk7XG4gICAgfVxuICB9LFxuICBzaGlmdEludmVydGVkOiBmYWxzZSxcbiAgX3NldEN1cnNvckZyb21FdmVudF9vdmVyd3JpdHRlbjogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3NldEN1cnNvckZyb21FdmVudCxcbiAgX3NldEN1cnNvckZyb21FdmVudDogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUpIHtcbiAgICAgIHRoaXMuc2V0Q3Vyc29yKCdwb2ludGVyJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NldEN1cnNvckZyb21FdmVudF9vdmVyd3JpdHRlbihlLCB0YXJnZXQpO1xuICAgIH1cbiAgfSxcbiAgX29uTW91c2VEb3duOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgdGhpcy5fYXBwbHlNaXhlZE1vZGUoZSk7XG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSAmJiB0aGlzLl9jdXJyZW50X3RhcmdldCkge1xuICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZV9vdmVyd3JpdHRlbiA9IHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGU7XG4gICAgICB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgX21vdXNlX2Rvd25fb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlKTtcblxuXG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSkge1xuXG4gICAgICBpZiAodGhpcy5fY3VycmVudF90YXJnZXQgJiYgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZV9vdmVyd3JpdHRlbikge1xuICAgICAgICB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2hhbmRNb2RlQWN0aXZlID0gdHJ1ZTtcbiAgICAgIHRoaXMuX2hhbmRNb2RlTW91c2VEb3duKGUpO1xuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBfbW91c2VfdXBfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlKTtcblxuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUpIHtcbiAgICAgIHRoaXMuX2hhbmRNb2RlQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9pbnRlcmFjdGl2ZU1vZGUuanMiLCIndXNlIHN0cmljdCc7XG5cbmlmKCFmYWJyaWMuU3Ryb2tlTWl4aW4pe1xuICByZXF1aXJlKFwiLi8uLi9taXhpbnMvc3Ryb2tlTWl4aW5cIik7XG59XG5cbi8qKlxuICogQGF1dGhvciBEZW5pcyBQb25vbWFyZXZcbiAqIEBlbWFpbCBkZW4ucG9ub21hcmV2QGdtYWlsLmNvbVxuICovXG5mYWJyaWMuRnJhbWUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuR3JvdXAsIGZhYnJpYy5TdHJva2VNaXhpbiwge1xuICB0eXBlOiAnZnJhbWUnLFxuICAvL3N0cm9rZUFjdGl2ZTogICBcImxpZ2h0Z3JlZW5cIixcbiAgLy9zdHJva2U6IFwicmVkXCIsXG4gIG1pbldpZHRoOiAzNSxcbiAgbWluSGVpZ2h0OiAzNSxcbiAgZmlsbCA6IFwidHJhbnNwYXJlbnRcIixcbiAgcmVzaXphYmxlOiB0cnVlLFxuICBjb250ZW50VG9vbHM6IGZhbHNlLFxuICAvL3N0YXRlcyA6IEVtcHR5IC8gRnVsbCAvIEFjdGl2ZVxuICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJjbGlwXCJdKSxcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5vcHRpb25zT3JkZXIuc2xpY2UoKTtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcIipcIikrMSwwLFwiZWxlbWVudFwiLFwiY2xpcFwiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIGNsaXA6IHtcbiAgICBsZWZ0OiAwLFxuICAgIHRvcDogMCxcbiAgICBzY2FsZVg6IDEsXG4gICAgc2NhbGVZOiAxXG4gIH0sXG4gIGNsaXBwaW5nQXZhaWxhYmxlOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLmNsaXBFbmFibGVkICYmIHRoaXMuZWxlbWVudCAmJiAhdGhpcy5fY2xpcG1vZGU7XG4gIH0sXG4gIGNsaXBFbmFibGVkOiB0cnVlLFxuICAvKipcbiAgICogY3JlYXRlIGNsb25lIHdpdGggc2FtZSBpbWFnZSBhbmQgc2hhcGUgYXMgb3JpZ2luYWwgKHN5bmNyb25vdXMpXG4gICAqIEBwYXJhbSBjYWxsYmFja1xuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIGNsb25lU3luYzogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgdmFyIF9mcmFtZSA9IG5ldyBmYWJyaWMuRnJhbWUodGhpcyk7XG4gICAgb3B0aW9ucyAmJiBfZnJhbWUuc2V0KG9wdGlvbnMpO1xuICAgIHJldHVybiBfZnJhbWU7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG5cbiAgICBpZihvcHRpb25zLmNvbnN0cnVjdG9yICE9IE9iamVjdCl7XG5cbiAgICAgIHZhciBfb2JqID0gb3B0aW9ucy50b09iamVjdCgpO1xuICAgICAgaWYob3B0aW9ucy5lbGVtZW50KXtcbiAgICAgICAgX29iai5lbGVtZW50ID0gb3B0aW9ucy5lbGVtZW50LmNsb25lU3luYygpO1xuICAgICAgICBfb2JqLmVsZW1lbnQuY2xpcFRvID0gX29iai5fZmFicmljX3NoYXBlO1xuICAgICAgfVxuICAgICAgX29iai5zaGFwZSA9IG9wdGlvbnMuc2hhcGU7XG4gICAgICBvcHRpb25zID0gX29iajtcbiAgICB9XG5cbiAgICB0aGlzLm9uKHtcbiAgICAgIFwib2JqZWN0OmNsaWNrXCI6dGhpcy5fY2hlY2tfdGV4dF9hc190YXJnZXRfYW5kX2VkaXQsXG4gICAgICBcImRibGNsaWNrXCI6dGhpcy50b2dnbGVDbGlwTW9kZUJ5Q2xpY2ssXG4gICAgICBcInJlZHJhd1wiOiB0aGlzLl9hcHBseV9zaGFwZSxcbiAgICAgIFwiZWxlbWVudDptb2RpZmllZFwiOiBmdW5jdGlvbihldmVudCl7XG4gICAgICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgICAgIHRoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmluaXRTaGFwZShvcHRpb25zKTtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIFtcbiAgICAgIHRoaXMuX2ZhYnJpY19zaGFwZVxuICAgIF0sIG9wdGlvbnMpO1xuICAgIHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZSA9IFtdO1xuXG4gIH0sXG4gIHRvZ2dsZUNsaXBNb2RlQnlDbGljazogZnVuY3Rpb24oZSl7XG4gICAgaWYodGhpcy5faXNfY2xpcHBpbmdfYXZhaWxhYmxlKGUuZSkpe1xuICAgICAgaWYoIXRoaXMuX2NsaXBtb2RlKXtcbiAgICAgICAgdGhpcy5jbGlwUGhvdG9TdGFydCgpXG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5jbGlwUGhvdG9FbmQoKVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgX2NoZWNrX3RleHRfYXNfdGFyZ2V0X2FuZF9lZGl0OiBmdW5jdGlvbihlKXtcbiAgICBpZiggdGhpcy5pc1Bvc3NpYmxlVGFyZ2V0KGUuZSx0aGlzLnRleHQpKXtcbiAgICAgIHRoaXMudGV4dC5zZXRPcGFjaXR5KDEpO1xuICAgICAgdGhpcy5fb25fdGV4dF9lZGl0KGUpO1xuICAgIH1cbiAgfSxcbiAgY2xpcFBob3RvRW5kOmZ1bmN0aW9uKCl7XG4gICAgdGhpcy5jYW52YXMuZWRpdGluZ09iamVjdCA9IG51bGw7XG4gICAgdGhpcy5hcHBsaWNhdGlvbi5vZmYoXCJ0YXJnZXQ6Y2hhbmdlZCB0YXJnZXQ6Y2xlYXJlZFwiLHRoaXMuX2VuZEZvbyk7XG5cbiAgICBpZih0aGlzLmNhbnZhcy5fZ3JpZE9iamVjdCl7XG4gICAgICB0aGlzLmNhbnZhcy5fZ3JpZE9iamVjdC5lbmFibGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvL3RoaXMucHJvamVjdC5jbGlwTW9kZSA9IGZhbHNlO1xuXG5cbiAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5lbGVtZW50KTtcbiAgICB0aGlzLnNldCh7XG4gICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICBldmVudGVkOiB0cnVlLFxuICAgICAgZmxpcFg6ICAgdGhpcy5lbGVtZW50LmZsaXBYLFxuICAgICAgZmxpcFk6ICAgdGhpcy5lbGVtZW50LmZsaXBZXG4gICAgfSk7XG5cbiAgICB2YXIgdG9fcmFkaWFucyA9IE1hdGguUEkgLyAxODA7XG4gICAgdmFyIGNvc0EgPSBNYXRoLmNvcyh0aGlzLmFuZ2xlICogdG9fcmFkaWFucyk7XG4gICAgdmFyIHNpbkEgPSBNYXRoLnNpbih0aGlzLmFuZ2xlICogdG9fcmFkaWFucyk7XG4gICAgdmFyIEkgPSB0aGlzLmVsZW1lbnQsIEYgPSB0aGlzO1xuXG5cbiAgICB2YXIgX25ld0dlb21ldHJ5ID0ge1xuICAgICAgYW5nbGU6IHRoaXMuZWxlbWVudC5hbmdsZSAtIHRoaXMuYW5nbGUsXG4gICAgICBsZWZ0OiAoIChJLmxlZnQgLSBGLmxlZnQgKSAqIGNvc0EgKyAoSS50b3AgLSBGLnRvcCkqIHNpbkEgIC0gRi53aWR0aC8gMikgKiAoSS5mbGlwWCA/IC0xIDogMSksXG4gICAgICB0b3A6ICAoLShJLmxlZnQgLSBGLmxlZnQgKSAqIHNpbkEgKyAoSS50b3AgLSBGLnRvcCkqIGNvc0EgIC0gRi5oZWlnaHQvIDIpKiAoSS5mbGlwWSA/IC0xIDogMSksXG4gICAgICBmbGlwWDogZmFsc2UsXG4gICAgICBmbGlwWTogZmFsc2VcbiAgICB9O1xuXG4gICAgaWYodGhpcy5lbGVtZW50Lm9yaWdpblggPT09IFwiY2VudGVyXCIpe1xuICAgLy8gICBfbmV3R2VvbWV0cnkubGVmdCArPSB0aGlzLmVsZW1lbnQud2lkdGggLzI7XG4gICAgfVxuICAgIGlmKHRoaXMuZWxlbWVudC5vcmlnaW5ZID09PSBcImNlbnRlclwiKXtcbiAgICAgIC8vX25ld0dlb21ldHJ5LnRvcCArPSB0aGlzLmVsZW1lbnQuaGVpZ2h0IC8yO1xuICAgIH1cblxuICAgIHRoaXMuYWRkKHRoaXMuZWxlbWVudCk7XG4gICAgdGhpcy5lbGVtZW50LnNldChfbmV3R2VvbWV0cnkpO1xuICAgIC8vXG4gICAgLy9cbiAgICB0aGlzLl9jbGlwbW9kZSA9ZmFsc2U7XG4gICAgLy/RgNCw0LzQutGDINC00LLQuNCz0LDRgtGMINC90LXQu9GM0LfRj1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIGhhc0NvbnRyb2xzOiB0cnVlLFxuICAgICAgZXZlbnRlZDogdHJ1ZVxuICAgIH0pO1xuICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgIHRoaXMuYWRkKHRoaXMuX2ZhYnJpY19zaGFwZSk7XG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLl9hcHBseV9zaGFwZSgpO1xuXG4gICAgdGhpcy5lbGVtZW50LmFjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcblxuICAgIHZhciB3ID0gdGhpcy53aWR0aCwgIGggPSB0aGlzLmhlaWdodCwgZWwgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICB0aGlzLmNsaXAgPSB7XG4gICAgICBsZWZ0ICAgOiAoZWwubGVmdCkgLyB3ICxcbiAgICAgIHRvcCAgICA6IChlbC50b3ApIC8gaCAsXG4gICAgICBzY2FsZVggOiAoZWwud2lkdGggKSAvIHcsXG4gICAgICBzY2FsZVkgOiAoZWwuaGVpZ2h0KSAvIGhcbiAgICB9O1xuXG4gICAgdGhpcy5maXJlKFwiY2xpcHBpbmc6ZXhpdGVkXCIpO1xuICAgIHRoaXMuY2FudmFzLmZpcmUoJ2ZyYW1lOmNsaXBwaW5nOmV4aXRlZCcsIHsgdGFyZ2V0OiB0aGlzIH0pO1xuICB9LFxuICBjbGlwUGhvdG9TdGFydDpmdW5jdGlvbigpe1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5fY2xpcG1vZGUgPSB0cnVlO1xuICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgdGhpcy5fYXBwbHlfc2hhcGUoKTtcbiAgICB0aGlzLmNhbnZhcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICBpZih0aGlzLmNhbnZhcy5fZ3JpZE9iamVjdCl7XG4gICAgICB0aGlzLmNhbnZhcy5fZ3JpZE9iamVjdC5lbmFibGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyogdGhpcy5mYWJyaWMuc2V0KHtcbiAgICAgb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAgb3JpZ2luWTogIFwiY2VudGVyXCIsXG4gICAgIGxlZnQ6IHRoaXMuZmFicmljLmxlZnQgKyB0aGlzLmZhYnJpYy53aWR0aC8yLFxuICAgICB0b3A6IHRoaXMuZmFicmljLnRvcCArIHRoaXMuZmFicmljLmhlaWdodC8yLFxuICAgICB9KTsqL1xuXG4gICAgdGhpcy5lbGVtZW50LnNldCh7XG4gICAgICBtb3ZlbWVudExpbWl0czogdGhpcyxcbiAgICAgIG1vdmVtZW50TGltaXRNb2RlOiBcImNvbnRlbnRcIixcbiAgICAgIC8vY2xpcFRvOiAgICAgICAgIHRoaXMsXG4gICAgICBmbGlwWDogdGhpcy5mbGlwWCxcbiAgICAgIGZsaXBZOiB0aGlzLmZsaXBZLFxuICAgICAgLy9sZWZ0OiB0aGlzLmVsZW1lbnQubGVmdCogKHRoaXMuZmxpcFggPyAtMSA6IDEpLFxuICAgICAgLy90b3A6ICB0aGlzLmVsZW1lbnQudG9wKiAodGhpcy5mbGlwWSA/IC0xIDogMSlcbiAgICB9KTtcblxuICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RTdGF0ZSh0aGlzLmVsZW1lbnQpO1xuICAgIHRoaXMuZWxlbWVudC5zZXQoe1xuICAgICAgaGFzQ29udHJvbHM6IHRydWUsXG4gICAgICAvL3NlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgLy9wZXJQaXhlbFRhcmdldEZpbmQ6IHRydWUsXG4gICAgICBzZWxlY3RhYmxlOiB0cnVlLFxuICAgICAgcGVyUGl4ZWxUYXJnZXRGaW5kOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMucmVtb3ZlKHRoaXMuZWxlbWVudCk7XG4gICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuZWxlbWVudCk7XG5cbiAgICB0aGlzLl9yZXN0b3JlT2JqZWN0U3RhdGUodGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICB0aGlzLnJlbW92ZSh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuXG4vL9GA0LDQvNC60LAg0LTQvtC70LbQvdCwINGA0LjRgdC+0LLQsNGC0YzRgdGPINC90LDQtCDQutCw0YDRgtC40L3QutC+0LksINC40L3QsNGH0LUgINC90LXQutGA0LDRgdC40LLQvlxuLy8gICAgICB0aGlzLnNsaWRlLmNhbnZhcy5icmluZ1RvRnJvbnQodGhpcy5mYWJyaWMpO1xuXG4gICAgLy/RgNCw0LzQutGDINC00LLQuNCz0LDRgtGMINC90LXQu9GM0LfRj1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlXG4gICAgfSk7XG5cblxuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzLmVsZW1lbnQpO1xuICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuXG4gICAgdGhpcy5fZW5kRm9vID0gZnVuY3Rpb24oKXtcbiAgICAgIF90aGlzLmNsaXBQaG90b0VuZCgpO1xuICAgIH07XG4gICAgdGhpcy5hcHBsaWNhdGlvbi5vbihcInRhcmdldDpjaGFuZ2VkIHRhcmdldDpjbGVhcmVkXCIsdGhpcy5fZW5kRm9vKTtcblxuICAgIHRoaXMuZmlyZShcImNsaXBwaW5nOmVudGVyZWRcIik7XG4gICAgdGhpcy5jYW52YXMuZmlyZSgnZnJhbWU6Y2xpcHBpbmc6ZW50ZXJlZCcsIHsgdGFyZ2V0OiB0aGlzIH0pO1xuXG4gICAgdGhpcy5jYW52YXMuZWRpdGluZ09iamVjdCA9IHRoaXM7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24oY3R4LCBub1RyYW5zZm9ybSkge1xuXG4gICAgaWYodGhpcy5kaXJ0eSl7XG5cbiAgICAgIGlmKHRoaXMuZGlydHlIZWlnaHQpe1xuICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlKSB7XG4gICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9lbGVtZW50c190b191cGRhdGVbaV07XG4gICAgICAgICAgdGhpcy5fdXBkYXRlX2ludGVyZmFjZV9lbGVtZW50X3Bvc2l0aW9uKGRhdGEuZWxlbWVudCxkYXRhLFwiaGVpZ2h0XCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZV9lbGVtZW50X2hlaWdodCgpO1xuICAgICAgICB0aGlzLmRpcnR5SGVpZ2h0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZih0aGlzLmRpcnR5V2lkdGgpIHtcbiAgICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLl9lbGVtZW50c190b191cGRhdGUpIHtcbiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZVtpXTtcbiAgICAgICAgICB0aGlzLl91cGRhdGVfaW50ZXJmYWNlX2VsZW1lbnRfcG9zaXRpb24oZGF0YS5lbGVtZW50LCBkYXRhLCBcIndpZHRoXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZV9lbGVtZW50X3dpZHRoKCk7XG4gICAgICAgIHRoaXMuZGlydHlXaWR0aCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlO1xuICAgICAgdGhpcy5maXJlKFwicmVkcmF3XCIpO1xuICAgIH1cblxuICAgIGlmKHRoaXMuX2NsaXBtb2RlKXtcbiAgICAgIHZhciBfem9vbSA9IHRoaXMuY2FudmFzLmdldFpvb20oKTtcbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAvLyAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcbiAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDAuNTtcbiAgICAgIHZhciBfY2xpcF90byA9IHRoaXMuZWxlbWVudC5jbGlwVG87XG4gICAgICB0aGlzLmVsZW1lbnQuY2xpcFRvID0gbnVsbDtcbiAgICAgIHRoaXMuZWxlbWVudC5yZW5kZXIoY3R4KTtcbiAgICAgIGN0eC5zY2FsZShfem9vbSxfem9vbSk7XG4gICAgICB0aGlzLmVsZW1lbnQuY2xpcFRvID0gX2NsaXBfdG87XG4gICAgICB0aGlzLnRyYW5zZm9ybShjdHgpO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5ib3JkZXJDb2xvcjtcbiAgICAgIGN0eC5saW5lV2lkdGggPSAxIC8gdGhpcy5ib3JkZXJTY2FsZUZhY3RvcjtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHRoaXMuY2FsbFN1cGVyKCdyZW5kZXInLCBjdHgsIG5vVHJhbnNmb3JtKTtcbiAgfSxcbiAgLy9zdXBwb3J0ZWRUeXBlczogXCIqXCIsIC8vICogb3IgW1wiaW1hZ2VcIixcInZpZGVvXCIsLi4uXVxuICBjbGlwcGluZ1N1cHBvcnRlZFR5cGVzOiBcIipcIiwgLy8gKiBvciBbXCJpbWFnZVwiLFwidmlkZW9cIiwuLi5dXG4gIF9pc19jbGlwcGluZ19hdmFpbGFibGUgOiBmdW5jdGlvbihlKXtcbiAgICBpZighdGhpcy5jbGlwRW5hYmxlZClyZXR1cm4gZmFsc2U7XG4gICAgaWYoZSAmJiB0aGlzLmlzUG9zc2libGVUYXJnZXQoZSx0aGlzLmJ1dHRvbikpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5lbGVtZW50ICYmICh0aGlzLmNsaXBwaW5nU3VwcG9ydGVkVHlwZXMgPT0gXCIqXCIgfHwgdGhpcy5jbGlwcGluZ1N1cHBvcnRlZFR5cGVzLmluZGV4T2YodGhpcy5lbGVtZW50LnR5cGUpIT0gLTEpO1xuICB9LFxuICBfcmVtb3ZlX2VsZW1lbnQ6IGZ1bmN0aW9uKCl7fSxcbiAgc2V0RGF0YTogZnVuY3Rpb24oZGF0YSl7XG4gICAgaWYoZGF0YS5yb2xlID09IFwiZnJhbWVcIil7XG4gICAgICB0aGlzLnNldEZyYW1lKGRhdGEuZnJhbWUpO1xuICAgICAgdGhpcy5zZXRTaGFwZShkYXRhLnNoYXBlKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuc2V0RWxlbWVudE9iamVjdChkYXRhKTtcbiAgICB9XG4gIH0sXG4gIGFjY2VwdHM6IHtcbiAgICByb2xlOiBbXCJpbWFnZVwiLFwidmlkZW9cIixcImZyYW1lXCJdXG4gIH0sXG4gIHNldEVsZW1lbnRPYmplY3Q6IGZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spe1xuICAgIHZhciBuZXdPcHRpb25zID0ge1xuICAgICAgc3JjOiBvcHRpb25zLnNyY1xuICAgIH1cbiAgICBpZihvcHRpb25zLnJvbGUgPT0gXCJpbWFnZVwiKXtcbiAgICAgIG5ld09wdGlvbnMudHlwZSA9IFwiaW1hZ2VcIjtcbiAgICB9XG4gICAgaWYob3B0aW9ucy5yb2xlID09IFwidmlkZW9cIil7XG4gICAgICBuZXdPcHRpb25zLnR5cGUgPSBcInZpZGVvXCI7XG4gICAgfVxuICAgIHRoaXMuX3NldF9wZW5kaW5nKHRydWUpO1xuICAgIHRoaXMuZmlyZShcImVsZW1lbnQ6bG9hZGluZ1wiKTtcbiAgICBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3QobmV3T3B0aW9ucyxmdW5jdGlvbihlbCl7XG4gICAgICB0aGlzLl9zZXRfcGVuZGluZyhmYWxzZSk7XG4gICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcyhlbCk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlbCk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgc2V0RWxlbWVudDogZnVuY3Rpb24oZWwsY2Ipe1xuICAgIGlmKGVsKXtcbiAgICAgIGlmKGVsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICAgIHRoaXMuc2V0RWxlbWVudE9iamVjdChlbCxjYilcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcyhlbCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcygpO1xuICAgICAgY2IgJiYgY2IoKVxuICAgIH1cbiAgfSxcbiAgZHJvcEVsZW1lbnRNZXRob2Q6IFwiY292ZXJcIiwvL3Jlc2l6ZVxuICAvKipcbiAgICog0KHQvtC30LTQsNC90LjQtSDRjdC70LXQvNC10L3RgtCwINGE0L7RgtC+XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBzZXRFbGVtZW50S2xhc3M6IGZ1bmN0aW9uKGVsKXtcbiAgICBpZih0aGlzLmVsZW1lbnQgPT09IGVsKXJldHVybjtcblxuICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICB0aGlzLl9yZW1vdmVfZWxlbWVudCgpO1xuICAgICAgdGhpcy5lbGVtZW50LmRlc3RydWN0b3IgJiYgdGhpcy5lbGVtZW50LmRlc3RydWN0b3IoKTtcbiAgICAgIHRoaXMucmVtb3ZlKHRoaXMuZWxlbWVudCk7XG4gICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5lbGVtZW50KTtcbiAgICB9XG4gICAgdGhpcy5lbGVtZW50ID0gZWw7XG5cbiAgICBpZihlbCl7XG4gICAgICBlbC5vbihcImRibGNsaWNrXCIsZnVuY3Rpb24oZSl7XG4gICAgICAgIHRoaXMucGFyZW50LnRvZ2dsZUNsaXBNb2RlQnlDbGljayhlKTtcbiAgICAgIH0pO1xuICAgICAgZWwuc2V0dXBTdGF0ZSgpO1xuXG4gICAgICBpZih0aGlzLmRyb3BFbGVtZW50TWV0aG9kICA9PSBcInJlc2l6ZVwiKXtcbiAgICAgICAgdGhpcy5jbGlwID0ge1xuICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgIHNjYWxlWDogMSxcbiAgICAgICAgICBzY2FsZVk6IDFcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZih0aGlzLmRyb3BFbGVtZW50TWV0aG9kICA9PSBcImNvdmVyXCIpe1xuICAgICAgICB2YXIgc2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKGVsLHRoaXMsJ2NvdmVyJylcbiAgICAgICAgdGhpcy5jbGlwID0ge1xuICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgIHNjYWxlWDogc2l6ZS53aWR0aCAvdGhpcy53aWR0aCxcbiAgICAgICAgICBzY2FsZVk6IHNpemUuaGVpZ2h0IC90aGlzLmhlaWdodFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGVsLnNldCh7XG4gICAgICAgIHRvb2xzOiBbXCJjbGlwRW5kXCJdLFxuICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgY2xpcEVuZDoge1xuICAgICAgICAgICAgY2xhc3NOYW1lOiAgXCJmYSBmYS1jcm9wXCIsXG4gICAgICAgICAgICB0aXRsZTogICAgICBcImNsaXAgZW5kXCIsXG4gICAgICAgICAgICBhY3Rpb246ICAgICBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICB0aGlzLnBhcmVudC5jbGlwUGhvdG9FbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBhcmVudDogdGhpcyxcbiAgICAgICAgbm90U2VsZWN0YWJsZUluVGhlR3JvdXAgOiB0cnVlLFxuICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICBvcmlnaW5ZOiBcImNlbnRlclwiLFxuICAgICAgICB0cmFuc3BhcmVudENvcm5lcnMgOiBmYWxzZSxcbiAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICBjbGlwVG86IHRoaXMuX2ZhYnJpY19zaGFwZVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuYWRkKGVsKTtcblxuICAgICAgZm9yKHZhciBpIGluIHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZSl7XG4gICAgICAgIHRoaXMucmVtb3ZlKHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZVtpXS5lbGVtZW50KTtcbiAgICAgICAgdGhpcy5hZGQodGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlW2ldLmVsZW1lbnQpO1xuICAgICAgfVxuICAgICAgdGhpcy5fdXBkYXRlX2VsZW1lbnRfc2l6ZSgpO1xuICAgIH1cblxuICAgIHRoaXMuZmlyZShcImVsZW1lbnQ6bW9kaWZpZWRcIix7ZWxlbWVudDogZWx9KTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcblxuICAvKipcbiAgICog0L7Qs9GA0LDQvdC40YfQuNCy0LDQtdC8INC/0LXRgNC10LzQtdGJ0LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LLQvdGD0YLRgNC4INGA0LDQvNC60LhcbiAgICogQHBhcmFtIGVsXG4gICAqL1xuICBfbGltaXRfbW92aW5nOiBmdW5jdGlvbihkYXRhKXtcblxuICAgIHZhciByID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB2YXIgaSAgID0gdGhpcy5lbGVtZW50O1xuICAgIGkub24oXCJtb3ZpbmdcIiwgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYiA9IHtcbiAgICAgICAgbDogIHIubGVmdCAgKyBpLndpZHRoICogaS5zY2FsZVgvMixcbiAgICAgICAgcjogIHIubGVmdCArIHIud2lkdGggLSBpLndpZHRoICogaS5zY2FsZVgvMixcbiAgICAgICAgdDogIHIudG9wICArIGkuaGVpZ2h0ICogaS5zY2FsZVkvMixcbiAgICAgICAgYjogIHIudG9wICArIHIuaGVpZ2h0IC0gaS5oZWlnaHQgKiBpLnNjYWxlWS8yXG4gICAgICB9O1xuICAgICAgLy8gY2FwcGluZyBsb2dpYyBoZXJlXG4gICAgICBpLnNldExlZnQoTWF0aC5tYXgoTWF0aC5taW4oYi5sLCBpLmxlZnQpLGIucikpO1xuICAgICAgaS5zZXRUb3AoTWF0aC5tYXgoTWF0aC5taW4oYi50LCBpLnRvcCksYi5iKSk7XG4gICAgfSk7XG5cbiAgICBpLm9uKFwic2NhbGluZ1wiLCBmdW5jdGlvbigpIHtcbiAgICAgIGkuc2V0KHtcbiAgICAgICAgd2lkdGg6IE1hdGgubWF4KHIud2lkdGgsIGkud2lkdGggKiBpLnNjYWxlWCksXG4gICAgICAgIGhlaWdodDogTWF0aC5tYXgoci5oZWlnaHQsaS5oZWlnaHQqIGkuc2NhbGVZKSxcbiAgICAgICAgc2NhbGVYIDogMSxcbiAgICAgICAgc2NhbGVZOiAxXG4gICAgICB9KTtcblxuICAgICAgdmFyIGIgPSB7XG4gICAgICAgIGw6ICByLmxlZnQgICsgaS53aWR0aCAqIGkuc2NhbGVYLzIsXG4gICAgICAgIHI6ICByLmxlZnQgKyByLndpZHRoIC0gaS53aWR0aCAqIGkuc2NhbGVYLzIsXG4gICAgICAgIHQ6ICByLnRvcCAgKyBpLmhlaWdodCAqIGkuc2NhbGVZLzIsXG4gICAgICAgIGIgOiByLnRvcCAgKyByLmhlaWdodCAtIGkuaGVpZ2h0ICogaS5zY2FsZVkvMlxuICAgICAgfTtcbiAgICAgIC8vLy8gY2FwcGluZyBsb2dpYyBoZXJlXG4gICAgICAvL2kuc2V0TGVmdChNYXRoLm1pbihNYXRoLm1heChiLmwsIGkubGVmdCksYi5yKSk7XG4gICAgICAvL2kuc2V0VG9wKE1hdGgubWluKE1hdGgubWF4KGIudCwgaS50b3ApLGIuYikpO1xuICAgIH0pO1xuICB9LFxuXG4gIF9zZXRfcGVuZGluZzogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLl9wZW5kaW5nID0gdmFsO1xuICB9LFxuXG4gIC8qKlxuICAgKiDQodC+0LfQtNCw0L3QuNC1INGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9jcmVhdGVfcmVtb3ZlX2J1dHRvbjogZnVuY3Rpb24ob3B0aW9ucyl7XG5cbiAgICB0aGlzLmJ1dHRvbiA9IHRoaXMuX2NyZWF0ZV9idXR0b24oe1xuICAgICAgdGV4dDogXCLvgI1cIixcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjp7XG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgcmlnaHQ6IDBcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuYnV0dG9uLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgaWYoIXRoaXMuX3BlbmRpbmcpe1xuICAgICAgICB0aGlzLnNldEVsZW1lbnQoZmFsc2UpO1xuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgfSxcbiAgX2FkZF9lbGVtZW50X3RvX3VwZGF0ZTogZnVuY3Rpb24oZGF0YSl7XG4gICAgdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlLnB1c2goZGF0YSk7XG5cbiAgICBpZihkYXRhLnJpZ2h0ICE9PSB1bmRlZmluZWQpe1xuICAgICAgZGF0YS5lbGVtZW50LnNldE9yaWdpblgoXCJyaWdodFwiKTtcbiAgICB9XG4gICAgaWYoZGF0YS5sZWZ0ICE9PSB1bmRlZmluZWQpe1xuICAgICAgZGF0YS5lbGVtZW50LnNldE9yaWdpblgoXCJsZWZ0XCIpO1xuICAgIH1cbiAgICBpZihkYXRhLmJvdHRvbSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIGRhdGEuZWxlbWVudC5zZXRPcmlnaW5ZKFwiYm90dG9tXCIpO1xuICAgIH1cbiAgICBpZihkYXRhLnRvcCAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIGRhdGEuZWxlbWVudC5zZXRPcmlnaW5ZKFwidG9wXCIpO1xuICAgIH1cblxuICAgIHRoaXMuX3VwZGF0ZV9pbnRlcmZhY2VfZWxlbWVudF9wb3NpdGlvbihkYXRhLmVsZW1lbnQsZGF0YSk7XG5cbiAgfSxcbiAgc2V0Q2xpcDogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmNsaXAgPSB2YWw7XG4gICAgdGhpcy5fdXBkYXRlX2VsZW1lbnRfc2l6ZSgpO1xuICB9LFxuICBfdXBkYXRlX2VsZW1lbnRfc2l6ZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLl91cGRhdGVfZWxlbWVudF93aWR0aCgpO1xuICAgIHRoaXMuX3VwZGF0ZV9lbGVtZW50X2hlaWdodCgpO1xuICB9LFxuXG4gIF91cGRhdGVfZWxlbWVudF93aWR0aDogZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgaWYodGhpcy5lbGVtZW50LnR5cGUgPT0gXCJlbGxpcHNlXCIpe1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0KHtcbiAgICAgICAgICByeDogdGhpcy53aWR0aC8yICogdGhpcy5jbGlwLnNjYWxlWFxuICAgICAgICB9KTtcbiAgICAgIH1lbHNlIGlmKCB0aGlzLmVsZW1lbnQudHlwZSA9PVwidmlkZW9cIiB8fCB0aGlzLmVsZW1lbnQudHlwZSA9PSBcInBhdGhcIil7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnNldCh7XG4gICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICBzY2FsZVg6IHRoaXMud2lkdGggLyB0aGlzLmVsZW1lbnQud2lkdGhcbiAgICAgICAgfSk7XG4gICAgICB9ZWxzZSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRXaWR0aCh0aGlzLndpZHRoICogdGhpcy5jbGlwLnNjYWxlWClcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldExlZnQodGhpcy53aWR0aCAqIHRoaXMuY2xpcC5sZWZ0KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIF91cGRhdGVfZWxlbWVudF9oZWlnaHQ6IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5lbGVtZW50KXtcblxuICAgICAgaWYodGhpcy5lbGVtZW50LnR5cGUgPT0gXCJlbGxpcHNlXCIpe1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0KHtcbiAgICAgICAgICByeTogICAgIHRoaXMuaGVpZ2h0LzIgKiB0aGlzLmNsaXAuc2NhbGVZXG4gICAgICAgIH0pO1xuICAgICAgfWVsc2UgaWYoIHRoaXMuZWxlbWVudC50eXBlID09XCJ2aWRlb1wiIHx8IHRoaXMuZWxlbWVudC50eXBlID09IFwicGF0aFwiKXtcblxuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0KHtcbiAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgc2NhbGVZOiB0aGlzLmhlaWdodCAvIHRoaXMuZWxlbWVudC5oZWlnaHRcbiAgICAgICAgfSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldEhlaWdodCh0aGlzLmhlaWdodCAqIHRoaXMuY2xpcC5zY2FsZVkpXG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRUb3AoIHRoaXMuaGVpZ2h0ICogdGhpcy5jbGlwLnRvcCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBfdXBkYXRlX2ludGVyZmFjZV9lbGVtZW50X3Bvc2l0aW9uOiBmdW5jdGlvbihlbCxkYXRhLCBwcm9wKXtcbiAgICBpZighcHJvcCB8fCBwcm9wID09IFwiaGVpZ2h0XCIpe1xuICAgICAgaWYgKGRhdGEudG9wICE9PSB1bmRlZmluZWQgJiYgZGF0YS5ib3R0b20gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBlbC5zZXRUb3AoLXRoaXMuaGVpZ2h0IC8gMiArIGRhdGEudG9wKTtcbiAgICAgICAgZWwuc2V0SGVpZ2h0KHRoaXMuaGVpZ2h0IC0gZGF0YS50b3AgLSBkYXRhLmJvdHRvbSk7XG4gICAgICB9aWYgKGRhdGEudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZWwuc2V0VG9wKC10aGlzLmhlaWdodCAvIDIgKyBkYXRhLnRvcCk7XG4gICAgICB9IGVsc2UgaWYgKGRhdGEuYm90dG9tICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZWwuc2V0VG9wKHRoaXMuaGVpZ2h0IC8gMiAtIGRhdGEuYm90dG9tKTtcbiAgICAgIH1lbHNlIGlmIChkYXRhLmhlaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldEhlaWdodChkYXRhLmhlaWdodCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKCFwcm9wIHx8IHByb3AgPT0gXCJ3aWR0aFwiKSB7XG4gICAgICBpZiAoZGF0YS5yaWdodCAhPT0gdW5kZWZpbmVkICYmIGRhdGEubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldExlZnQoLXRoaXMud2lkdGggLyAyICsgZGF0YS5sZWZ0KTtcbiAgICAgICAgZWwuc2V0V2lkdGgodGhpcy53aWR0aCAtIGRhdGEubGVmdCAtIGRhdGEucmlnaHQpO1xuXG4gICAgICB9ZWxzZSBpZiAoZGF0YS5yaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldExlZnQodGhpcy53aWR0aCAvIDIgLSBkYXRhLnJpZ2h0KTtcbiAgICAgIH1lbHNlIGlmIChkYXRhLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBlbC5zZXRMZWZ0KC10aGlzLndpZHRoIC8gMiArIGRhdGEubGVmdCk7XG4gICAgICB9ZWxzZSBpZiAoZGF0YS53aWR0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldFdpZHRoKGRhdGEud2lkdGgpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbC5zZXRDb29yZHMoKTtcbiAgfSxcbiAgZGlydHk6IGZhbHNlLFxuICBkaXJ0eUhlaWdodDogZmFsc2UsXG4gIGRpcnR5V2lkdGg6IGZhbHNlLFxuICBzZXRIZWlnaHQ6IGZ1bmN0aW9uKGgpe1xuICAgIHRoaXMuaGVpZ2h0ID0gaDtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICB0aGlzLmRpcnR5SGVpZ2h0ID0gdHJ1ZTtcbiAgfSxcbiAgc2V0V2lkdGg6IGZ1bmN0aW9uKHcpe1xuICAgIHRoaXMud2lkdGggPSB3O1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIHRoaXMuZGlydHlXaWR0aCA9IHRydWU7XG4gIH0sXG4gIHRvT2JqZWN0OiBmdW5jdGlvbihwcm9wZXJ0aWVzVG9JbmNsdWRlKXtcbiAgICBwcm9wZXJ0aWVzVG9JbmNsdWRlID0gW1wiY2xpcFwiLFwiZGF0YVwiXS5jb25jYXQocHJvcGVydGllc1RvSW5jbHVkZSk7XG5cbiAgICAvLyB2YXIgb2JqZWN0ID0gdGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JywgcHJvcGVydGllc1RvSW5jbHVkZSk7XG4gICAgdmFyIG9iamVjdCA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRvT2JqZWN0LmNhbGwodGhpcywgcHJvcGVydGllc1RvSW5jbHVkZSk7XG5cblxuICAgIGlmKHRoaXMuc2hhcGUpe1xuICAgICAgb2JqZWN0LnNoYXBlID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKHRoaXMuc2hhcGUpO1xuICAgICAgaWYob2JqZWN0LnNoYXBlLnNyYyl7XG4gICAgICAgIGRlbGV0ZSBvYmplY3Quc2hhcGUucGF0aHM7XG4gICAgICAgIGRlbGV0ZSBvYmplY3Quc2hhcGUuaGVpZ2h0O1xuICAgICAgICBkZWxldGUgb2JqZWN0LnNoYXBlLndpZHRoO1xuICAgICAgICBkZWxldGUgb2JqZWN0LnNoYXBlLnN2Z1VpZDtcbiAgICAgICAgZGVsZXRlIG9iamVjdC5zaGFwZS50b0JlUGFyc2VkO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRlbGV0ZSBvYmplY3Qub2JqZWN0cztcblxuICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICB2YXIgX29iajIgPSB0aGlzLmVsZW1lbnQudG9PYmplY3QoKTtcbiAgICAgIG9iamVjdC5lbGVtZW50ID0ge1xuICAgICAgICB0eXBlOiBfb2JqMi50eXBlLFxuICAgICAgICBzcmM6IF9vYmoyLnNyY1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2JqZWN0O1xuICB9XG59KTtcblxudmFyIF9GUkEgPSBmYWJyaWMuRnJhbWUucHJvdG90eXBlO1xuZmFicmljLkZyYW1lLnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZmFicmljLk9iamVjdC5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgIGNsZWFyOiB7XG4gICAgICB0aXRsZTogICAgICBcIlJlbW92ZSBjb250ZW50XCIsXG4gICAgICBjbGFzc05hbWU6ICBcImZhIGZhLXRpbWVzXCIsXG4gICAgICBhY3Rpb246ICAgICBfRlJBLnNldEVsZW1lbnQsXG4gICAgICB2aXNpYmxlOiAgICBcImVsZW1lbnRcIixcbiAgICAgIG9ic2VydmU6ICAgIFwiZWxlbWVudDptb2RpZmllZFwiXG4gICAgfSxcbiAgICBjcm9wOiB7XG4gICAgICB0aXRsZTogICAgICBcImNyb3BcIixcbiAgICAgIGNsYXNzTmFtZTogIFwiZmEgZmEtY3JvcFwiLFxuICAgICAgYWN0aW9uOiAgICAgX0ZSQS5jbGlwUGhvdG9TdGFydCxcbiAgICAgIHZpc2libGU6ICAgIF9GUkEuY2xpcHBpbmdBdmFpbGFibGUsXG4gICAgICBvYnNlcnZlOiAgXCJjbGlwcGluZzplbnRlcmVkIGNsaXBwaW5nOmV4aXRlZCBlbGVtZW50Om1vZGlmaWVkXCJcbiAgICB9XG4gIH1cbik7XG5cblxuZmFicmljLkZyYW1lLmZyb21PYmplY3QgPSBmdW5jdGlvbihvYmplY3QsY2FsbGJhY2spIHtcbiAgdmFyIF9hcHAgPSBvYmplY3QuYXBwbGljYXRpb247XG4gIGRlbGV0ZSBvYmplY3QuYXBwbGljYXRpb247XG4gIG9iamVjdCA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAob2JqZWN0KTtcbiAgb2JqZWN0LmFwcGxpY2F0aW9uID0gX2FwcDtcblxuICB2YXIgY2IgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoMixmdW5jdGlvbigpe1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKG5ldyBmYWJyaWMuRnJhbWUob2JqZWN0KSk7XG4gIH0pO1xuXG4gIGlmKG9iamVjdC5pbWFnZSl7XG5cblxuICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdCh7XG4gICAgICB0eXBlOiBcImltYWdlXCIsXG4gICAgICBpbWFnZTogb2JqZWN0LmltYWdlLFxuICAgICAgd2lkdGg6IG9iamVjdC5pbWFnZS53aWR0aCxcbiAgICAgIGhlaWdodDogb2JqZWN0LmltYWdlLmhlaWdodCxcbiAgICB9LGVsID0+IHtcbiAgICAgIG9iamVjdC5lbGVtZW50ID0gZWw7XG4gICAgICBjYigpO1xuICAgIH0pO1xuICB9XG4gIGVsc2UgaWYob2JqZWN0LmVsZW1lbnQpe1xuICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvYmplY3QuZWxlbWVudCxmdW5jdGlvbihlbCl7XG4gICAgICBvYmplY3QuZWxlbWVudCA9IGVsO1xuICAgICAgY2IoKTtcbiAgICB9KTtcbiAgfWVsc2V7XG4gICAgY2IoKTtcbiAgfVxuXG4gIGlmKG9iamVjdC5zaGFwZSAmJiBvYmplY3Quc2hhcGUuc3JjKXtcbiAgICBmYWJyaWMubG9hZFNWR0Zyb21VUkwob2JqZWN0LnNoYXBlLnNyYyxmdW5jdGlvbihwYXRocyxvcHRpb25zKSB7XG4gICAgICBvYmplY3Quc2hhcGUucGF0aHMgID0gcGF0aHM7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9iamVjdC5zaGFwZSxvcHRpb25zKTtcbiAgICAgIGNiKCk7XG4gICAgfSlcbiAgfWVsc2Uge1xuICAgIGNiKCk7XG4gIH1cbn07XG5mYWJyaWMuRnJhbWUuYXN5bmMgPSB0cnVlO1xuXG5mYWJyaWMudXRpbC5jcmVhdGVBY2Nlc3NvcnMoZmFicmljLkZyYW1lKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvc2hhcGVzL2ZyYW1lLmpzIiwiZmFicmljLlN0cm9rZU1peGluID0ge1xuICBzaGFwZToge1xuICAgIHN0cm9rZVdpZHRoRnVsbDogMCxcbiAgICBzdHJva2VXaWR0aEVtcHR5OiAyLFxuICAgIHN0cm9rZVdpZHRoQWN0aXZlOiAyLFxuICAgIHN0cm9rZURhc2hBcnJheSA6IFs1LDVdLFxuICAgIGZpbGw6IFwidHJhbnNwYXJlbnRcIixcbiAgICBzdHJva2VFbXB0eTogIFwicmVkXCIsXG4gICAgc3Ryb2tlRnVsbDogICBcInJlZFwiLFxuICAgIHN0cm9rZUFjdGl2ZTogXCJncmVlblwiXG4gIH0sXG4gIHNldFNoYXBlOiBmdW5jdGlvbihlbCxjYil7XG5cbiAgICBlbCA9ICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIHN0cm9rZVdpZHRoRnVsbDogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGwsXG4gICAgICBzdHJva2VXaWR0aEVtcHR5OiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRW1wdHksXG4gICAgICBzdHJva2VXaWR0aEFjdGl2ZTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSxcbiAgICAgIGRhc2hBcnJheSA6IHRoaXMuc2hhcGUuZGFzaEFycmF5LFxuICAgICAgc3Ryb2tlRW1wdHk6ICB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5LFxuICAgICAgc3Ryb2tlRnVsbDogIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCxcbiAgICAgIHN0cm9rZUFjdGl2ZTp0aGlzLnNoYXBlLnN0cm9rZUFjdGl2ZVxuICAgIH0sZWwpO1xuXG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGlmKGVsICYmIGVsLnNyYyAmJiAhZWwucGF0aHMpe1xuICAgICAgZmFicmljLmxvYWRTVkdGcm9tVVJMKGVsLnNyYyxmdW5jdGlvbihwYXRocyxvcHRpb25zKSB7XG4gICAgICAgIGVsLnBhdGhzICA9IHBhdGhzO1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsLG9wdGlvbnMpO1xuICAgICAgICBfdGhpcy5fc2V0X3NoYXBlKGVsKTtcbiAgICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpXG4gICAgICAgIF90aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgICBfdGhpcy5fZmFicmljX3NoYXBlLnNlbmRUb0JhY2soKTtcbiAgICAgICAgY2IgJiYgY2IoKTtcbiAgICAgIH0pXG4gICAgfWVsc2V7XG4gICAgICBfdGhpcy5fc2V0X3NoYXBlKGVsKTtcbiAgICAgIF90aGlzLmFkZChfdGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICAgIF90aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgX3RoaXMuX2ZhYnJpY19zaGFwZS5zZW5kVG9CYWNrKCk7XG4gICAgICBjYiAmJiBjYigpO1xuICAgIH1cbiAgfSxcbiAgaW5pdFNoYXBlOiBmdW5jdGlvbihvcHRpb25zKXtcblxuICAgIHZhciBfc2hhcGVPcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvcHRpb25zLnNoYXBlIHx8IHt9ICwgdGhpcy5zaGFwZSk7XG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUgPSAgbmV3IGZhYnJpYy5SZWN0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sX3NoYXBlT3B0aW9ucyx7XG4gICAgICB3aWR0aDogICAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgaGVpZ2h0OiAgICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICBzdHJva2U6ICAgICAgICAgICBfc2hhcGVPcHRpb25zLnN0cm9rZUVtcHR5LFxuICAgICAgc3Ryb2tlV2lkdGg6ICAgICAgX3NoYXBlT3B0aW9ucy5zdHJva2VXaWR0aEVtcHR5XG4gICAgfSkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiDvv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+9IO+/ve+/vSDvv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+977+977+9IO+/ve+/ve+/ve+/vVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX2FwcGx5X3NoYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNoYXBlID0gdGhpcy5zaGFwZTtcblxuICAgIHZhciBfb2ZmID0gc2hhcGUgJiYgc2hhcGUub2Zmc2V0cztcblxuICAgIGlmICghX29mZikge1xuICAgICAgX29mZiA9IFswLCAwLCAwLCAwXTtcbiAgICB9XG5cbiAgICB2YXIgX29mZl91bml0cyA9IHNoYXBlICYmIHNoYXBlLm9mZnNldHNfdW5pdHM7XG5cbiAgICBpZiAoIV9vZmZfdW5pdHMpIHtcbiAgICAgIC8vaWYgKGZyYW1lLmJvcmRlcl9pbWFnZSkge3RvZG9cbiAgICAgIC8vICAgIF9vZmZfdW5pdHMgPSBmcmFtZS5ib3JkZXJfaW1hZ2Uud2lkdGhfdW5pdHMgfHwgWzAsIDAsIDAsIDBdO1xuICAgICAgLy99IGVsc2Uge1xuICAgICAgX29mZl91bml0cyA9IFsxLCAxLCAxLCAxXTtcbiAgICAgIC8vfVxuICAgIH1cblxuICAgIC8qZWxzZSBpZihzaGFwZS5vZmZzZXRzICYmIHNoYXBlLm9mZnNldHNfdW5pdHMpe1xuICAgICB2YXIgcyA9IHRoaXMuc2xpZGUuc2NhbGVWYWx1ZTtcbiAgICAgdGhpcy5fZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5SZWN0KHtcbiAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgIG9yaWdpblk6ICdjZW50ZXInLFxuICAgICB3aWR0aDogICh0aGlzLmRhdGEuZ2VvbWV0cnkud2lkdGggLSBzaGFwZS5vZmZzZXRzWzNdIC0gc2hhcGUub2Zmc2V0c1sxXSkgKiBzLFxuICAgICBoZWlnaHQ6ICh0aGlzLmRhdGEuZ2VvbWV0cnkuaGVpZ2h0IC1zaGFwZS5vZmZzZXRzWzBdIC0gc2hhcGUub2Zmc2V0c1syXSkgKiBzXG4gICAgIH0pOyovXG5cbiAgICBfb2ZmID0ge1xuICAgICAgdG9wOiAgIF9vZmZbMF0gKiAoX29mZl91bml0c1swXSA/IHRoaXMuaGVpZ2h0IC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIHJpZ2h0OiBfb2ZmWzFdICogKF9vZmZfdW5pdHNbMV0gPyB0aGlzLndpZHRoIC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIGJvdHRvbTpfb2ZmWzJdICogKF9vZmZfdW5pdHNbMl0gPyB0aGlzLmhlaWdodCAvIDEwMCA6IDEpIHx8IDAsXG4gICAgICBsZWZ0OiAgX29mZlszXSAqIChfb2ZmX3VuaXRzWzNdID8gdGhpcy53aWR0aCAvIDEwMCA6IDEpIHx8IDBcbiAgICB9O1xuXG5cbiAgICB2YXIgX3cgPSAodGhpcy53aWR0aCAtIF9vZmYubGVmdCAtIF9vZmYucmlnaHQgKTsvLyAqdGhpcy5zbGlkZS5zY2FsZVZhbHVlO1xuICAgIHZhciBfaCA9ICh0aGlzLmhlaWdodCAtIF9vZmYudG9wIC0gX29mZi5ib3R0b20pOy8vICp0aGlzLnNsaWRlLnNjYWxlVmFsdWU7XG5cblxuICAgIC8vaWYodGhpcy5yZXNvdXJjZXMuZnJhbWUuZGF0YS5zaGFwZSAmJiB0aGlzLnJlc291cmNlcy5mcmFtZS5kYXRhLnNoYXBlLnJhZGl1cyl7XG4gICAgLy9cbiAgICAvLyAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAvLyAgICAgICAgbGVmdDogLXRoaXMud2lkdGgvMiAgKyBfb2ZmLmxlZnQgLFxuICAgIC8vICAgICAgICB0b3A6ICAtdGhpcy5oZWlnaHQvMiArIF9vZmYudG9wICxcbiAgICAvLyAgICAgICAgd2lkdGg6IF93IC0gX29mZi5sZWZ0IC1fb2ZmLnJpZ2h0LFxuICAgIC8vICAgICAgICBoZWlnaHQ6ICBfaCAtIF9vZmYudG9wIC1fb2ZmLmJvdHRvbSxcbiAgICAvLyAgICAgICAgc2NhbGVYOiAgMSxcbiAgICAvLyAgICAgICAgc2NhbGVZOiAgMVxuICAgIC8vICAgIH0pO1xuICAgIC8vfWVsc2V7XG5cblxuICAgIC8vaWYodGhpcy5zaGFwZS5wYXRoIHx8IHRoaXMuc2hhcGUucGF0aHMgfHwgdGhpcy5zaGFwZS5vZmZzZXRzKXtcbiAgICAgIHZhciBfc3cgPSB0aGlzLnNoYXBlLndpZHRoIHx8IHRoaXMuX2ZhYnJpY19zaGFwZS53aWR0aDtcbiAgICAgIHZhciBfc2ggPSB0aGlzLnNoYXBlLmhlaWdodCB8fCB0aGlzLl9mYWJyaWNfc2hhcGUuaGVpZ2h0O1xuXG4gICAgICAvLyBpZih0aGlzLl9mYWJyaWNfc2hhcGUuc3Ryb2tlV2lkdGgpe1xuICAgICAgLy8gICBfc3cgKz0gdGhpcy5fZmFicmljX3NoYXBlLnN0cm9rZVdpZHRoIDtcbiAgICAgIC8vICAgX3NoICs9IHRoaXMuX2ZhYnJpY19zaGFwZS5zdHJva2VXaWR0aCA7XG4gICAgICAvLyB9XG5cbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBsZWZ0OiAgIC10aGlzLndpZHRoIC8gMiArIF9vZmYubGVmdCxcbiAgICAgICAgdG9wOiAgICAtdGhpcy5oZWlnaHQgLyAyICsgX29mZi50b3AsXG4gICAgICAgIHNjYWxlWDogX3cgLyAxMDAgLyAoX3N3IC8gMTAwKSwvLyAqIChzaGFwZS5zY2FsZVggfHwgMSksXG4gICAgICAgIHNjYWxlWTogX2ggLyAxMDAgLyAoX3NoIC8gMTAwKSwvLyAqIChzaGFwZS5zY2FsZVkgfHwgMSlcbiAgICAgICAgYW5nbGU6IDBcbiAgICAgIH07XG4gICAgLyp9ZWxzZXtcbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBsZWZ0OiAgIC10aGlzLndpZHRoIC8gMiArIF9vZmYubGVmdCxcbiAgICAgICAgdG9wOiAgICAtdGhpcy5oZWlnaHQgLyAyICsgX29mZi50b3AsXG4gICAgICAgIHdpZHRoOiAgICBfdywvLyAqIChzaGFwZS5zY2FsZVggfHwgMSksXG4gICAgICAgIGhlaWdodDogICBfaCwvLyAqIChzaGFwZS5zY2FsZVkgfHwgMSlcbiAgICAgICAgYW5nbGU6IDBcbiAgICAgIH07XG4gICAgfSovXG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KG9wdGlvbnMpO1xuXG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgX3NldF9zaGFwZTogZnVuY3Rpb24gKHNoYXBlKSB7XG5cbiAgICBpZih0aGlzLl9mYWJyaWNfc2hhcGUpe1xuICAgICAgdGhpcy5yZW1vdmUodGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICAgIGRlbGV0ZSB0aGlzLl9mYWJyaWNfc2hhcGU7XG4gICAgfVxuICAgIHZhciBfZmFicmljX3NoYXBlO1xuICAgIHZhciBfb3B0aW9ucyA9IHtcbiAgICAgIGZpbGw6ICAgICAgICAgICAgIFwidHJhbnNwYXJlbnRcIixcbiAgICAgIHN0cm9rZURhc2hBcnJheSA6IHRoaXMuc2hhcGUuZGFzaEFycmF5LFxuICAgIH07XG5cbiAgICBpZighc2hhcGUpe1xuICAgICAgc2hhcGUgPSB7fTtcbiAgICB9XG5cbiAgICB0aGlzLnNoYXBlID0gc2hhcGU7XG5cblxuICAgIGlmIChzaGFwZS5wYXRocykge1xuXG4gICAgICBmb3IodmFyIGkgaW4gc2hhcGUucGF0aHMpe1xuICAgICAgICBzaGFwZS5wYXRoc1tpXS5zZXQoX29wdGlvbnMpXG4gICAgICB9XG5cbiAgICAgIF9mYWJyaWNfc2hhcGUgPSBmYWJyaWMudXRpbC5ncm91cFNWR0VsZW1lbnRzKHNoYXBlLnBhdGhzLCBzaGFwZSk7XG4gICAgICAvL1xuICAgICAgLy8gX2ZhYnJpY19zaGFwZS5zZXQoe1xuICAgICAgLy8gICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgIC8vICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxuICAgICAgLy8gfSk7XG5cbiAgICAgIC8vdGhpcy5fb2JqZWN0cy51bnNoaWZ0KHRoaXMuX29iamVjdHMucG9wKCkpO1xuICAgIH1lbHNlIHtcbiAgICAgIHZhciBwYXRoO1xuXG4gICAgICBpZiAoc2hhcGUucmFkaXVzKSB7XG4gICAgICAgIHBhdGggPSBmYWJyaWMudXRpbC5nZXRSYWRpdXNDbGlwUGF0aChzaGFwZS5yYWRpdXMsIHNoYXBlLnJhZGl1c191bml0cywgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5QYXRoKHBhdGgsIF9vcHRpb25zKTtcbiAgICAgIH0gZWxzZSBpZiAoc2hhcGUucGF0aCkge1xuICAgICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5QYXRoKHNoYXBlLnBhdGgsIF9vcHRpb25zKTtcbiAgICAgICAgLy99IGVsc2UgaWYoc2hhcGUub2Zmc2V0cyl7XG4gICAgICAgIC8vICBwYXRoID0gZmFicmljLnV0aWwuZ2V0T2Zmc2V0c0NsaXBQYXRoKHNoYXBlLm9mZnNldHMsIHNoYXBlLm9mZnNldHNfdW5pdHMpXG4gICAgICB9ZWxzZXtcblxuICAgICAgICBpZighc2hhcGUud2lkdGgpe1xuICAgICAgICAgIHNoYXBlLndpZHRoID0gMTAwO1xuICAgICAgICB9XG4gICAgICAgIGlmKCFzaGFwZS5oZWlnaHQpe1xuICAgICAgICAgIHNoYXBlLmhlaWdodCA9IDEwMDtcbiAgICAgICAgfVxuICAgICAgICBwYXRoID0gIGBNIDAgMCBMICR7c2hhcGUud2lkdGh9IDAgTCAke3NoYXBlLndpZHRofSAke3NoYXBlLmhlaWdodH0gTCAwICR7c2hhcGUuaGVpZ2h0fSB6YDtcblxuICAgICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5QYXRoKHBhdGgsIF9vcHRpb25zKTtcbiAgICAgICAgLy9cbiAgICAgICAgLy9fZmFicmljX3NoYXBlID0gIG5ldyBmYWJyaWMuUmVjdChmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgICAgLy8gIHdpZHRoOiAgICAgICAgICAgIDEwMCxcbiAgICAgICAgLy8gIGhlaWdodDogICAgICAgICAgIDEwMFxuICAgICAgICAvL30sc2hhcGUpKTtcblxuICAgICAgfVxuICAgIH1cblxuICAgIF9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAgIHNjYWxlWDogdGhpcy53aWR0aCAgLyBfZmFicmljX3NoYXBlLndpZHRoLFxuICAgICAgc2NhbGVZOiB0aGlzLmhlaWdodCAvIF9mYWJyaWNfc2hhcGUuaGVpZ2h0LFxuICAgICAgcGVyUGl4ZWxUYXJnZXRGaW5kOiB0cnVlLFxuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgIG9yaWdpblk6IFwidG9wXCJcbiAgICB9KTtcblxuICAgIHRoaXMuX2ZhYnJpY19zaGFwZSA9ICBfZmFicmljX3NoYXBlO1xuXG5cbiAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgdGhpcy5lbGVtZW50LnNldENsaXBUbyh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgIH1cblxuXG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcblxuICB9LFxuXG4gIHVwZGF0ZVN0cm9rZTogZnVuY3Rpb24oKXtcblxuICAgIHZhciBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2U7XG4gICAgdmFyIF9zdyA9IDA7XG4gICAgaWYoKHRoaXMuX2FjdGl2YXRlZCB8fCB0aGlzLl9jbGlwbW9kZSApJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSl7XG4gICAgICBfc3cgPSB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlXG4gICAgfWVsc2UgaWYodGhpcy5lbGVtZW50ICYmIHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhGdWxsKXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhGdWxsO1xuICAgIH1lbHNlIGlmKCF0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEVtcHR5KXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhFbXB0eTtcbiAgICB9XG4gICAgaWYoKHRoaXMuX2FjdGl2YXRlZCB8fCB0aGlzLl9jbGlwbW9kZSkgJiYgdGhpcy5zaGFwZS5zdHJva2VBY3RpdmUpe1xuICAgICAgX3N0cm9rZSA9IHRoaXMuc2hhcGUuc3Ryb2tlQWN0aXZlXG4gICAgfWVsc2UgaWYodGhpcy5lbGVtZW50ICYmIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VGdWxsO1xuICAgIH1lbHNlIGlmKCF0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VFbXB0eSl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VFbXB0eTtcbiAgICB9XG5cblxuICAgIHZhciBfc3Ryb2tlV2lkdGggPSBfc3cgLyBNYXRoLm1heCh0aGlzLl9mYWJyaWNfc2hhcGUuc2NhbGVYLHRoaXMuX2ZhYnJpY19zaGFwZS5zY2FsZVkpO1xuXG4gICAgaWYodGhpcy5zaGFwZSl7XG4gICAgICBpZih0aGlzLnNoYXBlLnBhdGhzICl7XG4gICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9mYWJyaWNfc2hhcGUucGF0aHMpe1xuICAgICAgICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5wYXRoc1tpXS5zZXRTdHJva2VXaWR0aChfc3Ryb2tlV2lkdGgpXG4gICAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnBhdGhzW2ldLnNldFN0cm9rZShfc3Ryb2tlKVxuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldFN0cm9rZVdpZHRoKF9zdHJva2VXaWR0aClcbiAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldFN0cm9rZShfc3Ryb2tlKVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqINC60L7QsdGK0LXQutGCINCz0L7RgtC+0LLQuNGC0YHRjyDQuiDQt9Cw0LzQtdC90YMg0YTQvtGC0L5cbiAgICovXG4gIGFjdGl2YXRlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuX2FjdGl2YXRlZCA9IHRydWU7XG4gICAgdGhpcy5fZmFicmljX3NoYXBlLnNldE9wYWNpdHkoMSk7XG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgLyoqXG4gICAqINC60L7QsdGK0LXQutGCINC90LUg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgKi9cbiAgZGVhY3RpdmF0ZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9taXhpbnMvc3Ryb2tlTWl4aW4uanMiLCJyZXF1aXJlKCcuLi8uLi9wbHVnaW5zL3FyY29kZScpO1xuXG5cbmZhYnJpYy5CYXJjb2RlID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkltYWdlLCB7XG4gIHR5cGU6ICdiYXJjb2RlJyxcbiAgc3RvcmVQcm9wZXJ0aWVzOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zdG9yZVByb3BlcnRpZXMsXG4gIHN0YXRlUHJvcGVydGllczogZmFicmljLkltYWdlLnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcInRleHRcIl0pLFxuICBjb3JyZWN0TGV2ZWw6IFFSQ29kZS5Db3JyZWN0TGV2ZWwuTCxcbiAgc2V0VGV4dDogZnVuY3Rpb24odGV4dCl7XG4gICAgdGhpcy50ZXh0ID0gdGV4dDtcbiAgICB0aGlzLnFyY29kZSA9IG5ldyBRUkNvZGUoe2NvcnJlY3RMZXZlbDogdGhpcy5jb3JyZWN0TGV2ZWx9KTtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5xcmNvZGUubWFrZUNvZGUodGV4dCk7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIHNldENvcnJlY3RMZXZlbDogZnVuY3Rpb24oKXtcbiAgICB0aGlzLnFyY29kZSA9IG5ldyBRUkNvZGUoe2NvcnJlY3RMZXZlbDogdGhpcy5jb3JyZWN0TGV2ZWx9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB0aGlzLnNldENvcnJlY3RMZXZlbChuZXcgUVJDb2RlKHtjb3JyZWN0TGV2ZWw6IHRoaXMuY29ycmVjdExldmVsIHx8IG9wdGlvbnMuY29ycmVjdExldmVsfSkpO1xuICAgIHZhciBpbWFnZSA9IHRoaXMucXJjb2RlLm1ha2VDb2RlKG9wdGlvbnMudGV4dCk7XG4gICAgdGhpcy50ZXh0ID0gb3B0aW9ucy50ZXh0O1xuICAgIGRlbGV0ZSBvcHRpb25zLnRleHQ7XG5cbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGltYWdlLCBvcHRpb25zKTtcbiAgfVxufSk7XG5mYWJyaWMuQmFyY29kZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24ob2JqZWN0KSB7XG4gIHJldHVybiBuZXcgZmFicmljLkJhcmNvZGUob2JqZWN0KTtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy9iYXJjb2RlLmpzIiwiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3XG4gKiAtIFVzaW5nIHRoZSAnUVJDb2RlIGZvciBKYXZhc2NyaXB0IGxpYnJhcnknXG4gKiAtIEZpeGVkIGRhdGFzZXQgb2YgJ1FSQ29kZSBmb3IgSmF2YXNjcmlwdCBsaWJyYXJ5JyBmb3Igc3VwcG9ydCBmdWxsLXNwZWMuXG4gKiAtIHRoaXMgbGlicmFyeSBoYXMgbm8gZGVwZW5kZW5jaWVzLlxuICpcbiAqIEBhdXRob3IgZGF2aWRzaGltanNcbiAqIEBzZWUgPGEgaHJlZj1cImh0dHA6Ly93d3cuZC1wcm9qZWN0LmNvbS9cIiB0YXJnZXQ9XCJfYmxhbmtcIj5odHRwOi8vd3d3LmQtcHJvamVjdC5jb20vPC9hPlxuICogQHNlZSA8YSBocmVmPVwiaHR0cDovL2plcm9tZWV0aWVubmUuZ2l0aHViLmNvbS9qcXVlcnktcXJjb2RlL1wiIHRhcmdldD1cIl9ibGFua1wiPmh0dHA6Ly9qZXJvbWVldGllbm5lLmdpdGh1Yi5jb20vanF1ZXJ5LXFyY29kZS88L2E+XG4gKi9cbndpbmRvdy5RUkNvZGUgPSAoZnVuY3Rpb24gKCkge1xuICB2YXIgUVJDb2RlO1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBRUkNvZGUgZm9yIEphdmFTY3JpcHRcbiAgLy9cbiAgLy8gQ29weXJpZ2h0IChjKSAyMDA5IEthenVoaWtvIEFyYXNlXG4gIC8vXG4gIC8vIFVSTDogaHR0cDovL3d3dy5kLXByb2plY3QuY29tL1xuICAvL1xuICAvLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2U6XG4gIC8vICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcbiAgLy9cbiAgLy8gVGhlIHdvcmQgXCJRUiBDb2RlXCIgaXMgcmVnaXN0ZXJlZCB0cmFkZW1hcmsgb2ZcbiAgLy8gREVOU08gV0FWRSBJTkNPUlBPUkFURURcbiAgLy8gICBodHRwOi8vd3d3LmRlbnNvLXdhdmUuY29tL3FyY29kZS9mYXFwYXRlbnQtZS5odG1sXG4gIC8vXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGZ1bmN0aW9uIFFSOGJpdEJ5dGUoZGF0YSkge1xuICAgIHRoaXMubW9kZSA9IFFSTW9kZS5NT0RFXzhCSVRfQllURTtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMucGFyc2VkRGF0YSA9IFtdO1xuXG4gICAgLy8gQWRkZWQgdG8gc3VwcG9ydCBVVEYtOCBDaGFyYWN0ZXJzXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmRhdGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICB2YXIgYnl0ZUFycmF5ID0gW107XG4gICAgICB2YXIgY29kZSA9IHRoaXMuZGF0YS5jaGFyQ29kZUF0KGkpO1xuXG4gICAgICBpZiAoY29kZSA+IDB4MTAwMDApIHtcbiAgICAgICAgYnl0ZUFycmF5WzBdID0gMHhGMCB8ICgoY29kZSAmIDB4MUMwMDAwKSA+Pj4gMTgpO1xuICAgICAgICBieXRlQXJyYXlbMV0gPSAweDgwIHwgKChjb2RlICYgMHgzRjAwMCkgPj4+IDEyKTtcbiAgICAgICAgYnl0ZUFycmF5WzJdID0gMHg4MCB8ICgoY29kZSAmIDB4RkMwKSA+Pj4gNik7XG4gICAgICAgIGJ5dGVBcnJheVszXSA9IDB4ODAgfCAoY29kZSAmIDB4M0YpO1xuICAgICAgfSBlbHNlIGlmIChjb2RlID4gMHg4MDApIHtcbiAgICAgICAgYnl0ZUFycmF5WzBdID0gMHhFMCB8ICgoY29kZSAmIDB4RjAwMCkgPj4+IDEyKTtcbiAgICAgICAgYnl0ZUFycmF5WzFdID0gMHg4MCB8ICgoY29kZSAmIDB4RkMwKSA+Pj4gNik7XG4gICAgICAgIGJ5dGVBcnJheVsyXSA9IDB4ODAgfCAoY29kZSAmIDB4M0YpO1xuICAgICAgfSBlbHNlIGlmIChjb2RlID4gMHg4MCkge1xuICAgICAgICBieXRlQXJyYXlbMF0gPSAweEMwIHwgKChjb2RlICYgMHg3QzApID4+PiA2KTtcbiAgICAgICAgYnl0ZUFycmF5WzFdID0gMHg4MCB8IChjb2RlICYgMHgzRik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBieXRlQXJyYXlbMF0gPSBjb2RlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnBhcnNlZERhdGEucHVzaChieXRlQXJyYXkpO1xuICAgIH1cblxuICAgIHRoaXMucGFyc2VkRGF0YSA9IEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIHRoaXMucGFyc2VkRGF0YSk7XG5cbiAgICBpZiAodGhpcy5wYXJzZWREYXRhLmxlbmd0aCAhPSB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICB0aGlzLnBhcnNlZERhdGEudW5zaGlmdCgxOTEpO1xuICAgICAgdGhpcy5wYXJzZWREYXRhLnVuc2hpZnQoMTg3KTtcbiAgICAgIHRoaXMucGFyc2VkRGF0YS51bnNoaWZ0KDIzOSk7XG4gICAgfVxuICB9XG5cbiAgUVI4Yml0Qnl0ZS5wcm90b3R5cGUgPSB7XG4gICAgZ2V0TGVuZ3RoOiBmdW5jdGlvbiAoYnVmZmVyKSB7XG4gICAgICByZXR1cm4gdGhpcy5wYXJzZWREYXRhLmxlbmd0aDtcbiAgICB9LFxuICAgIHdyaXRlOiBmdW5jdGlvbiAoYnVmZmVyKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMucGFyc2VkRGF0YS5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgYnVmZmVyLnB1dCh0aGlzLnBhcnNlZERhdGFbaV0sIDgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiBRUkNvZGVNb2RlbCh0eXBlTnVtYmVyLCBlcnJvckNvcnJlY3RMZXZlbCkge1xuICAgIHRoaXMudHlwZU51bWJlciA9IHR5cGVOdW1iZXI7XG4gICAgdGhpcy5lcnJvckNvcnJlY3RMZXZlbCA9IGVycm9yQ29ycmVjdExldmVsO1xuICAgIHRoaXMubW9kdWxlcyA9IG51bGw7XG4gICAgdGhpcy5tb2R1bGVDb3VudCA9IDA7XG4gICAgdGhpcy5kYXRhQ2FjaGUgPSBudWxsO1xuICAgIHRoaXMuZGF0YUxpc3QgPSBbXTtcbiAgfVxuXG4gIFFSQ29kZU1vZGVsLnByb3RvdHlwZSA9IHtcbiAgICBhZGREYXRhOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgdmFyIG5ld0RhdGEgPSBuZXcgUVI4Yml0Qnl0ZShkYXRhKTtcbiAgICAgIHRoaXMuZGF0YUxpc3QucHVzaChuZXdEYXRhKTtcbiAgICAgIHRoaXMuZGF0YUNhY2hlID0gbnVsbDtcbiAgICB9LCBpc0Rhcms6IGZ1bmN0aW9uIChyb3csIGNvbCkge1xuICAgICAgaWYgKHJvdyA8IDAgfHwgdGhpcy5tb2R1bGVDb3VudCA8PSByb3cgfHwgY29sIDwgMCB8fCB0aGlzLm1vZHVsZUNvdW50IDw9IGNvbCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3Iocm93ICsgXCIsXCIgKyBjb2wpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMubW9kdWxlc1tyb3ddW2NvbF07XG4gICAgfSwgZ2V0TW9kdWxlQ291bnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLm1vZHVsZUNvdW50O1xuICAgIH0sIG1ha2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMubWFrZUltcGwoZmFsc2UsIHRoaXMuZ2V0QmVzdE1hc2tQYXR0ZXJuKCkpO1xuICAgIH0sIG1ha2VJbXBsOiBmdW5jdGlvbiAodGVzdCwgbWFza1BhdHRlcm4pIHtcbiAgICAgIHRoaXMubW9kdWxlQ291bnQgPSB0aGlzLnR5cGVOdW1iZXIgKiA0ICsgMTc7XG4gICAgICB0aGlzLm1vZHVsZXMgPSBuZXcgQXJyYXkodGhpcy5tb2R1bGVDb3VudCk7XG4gICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCB0aGlzLm1vZHVsZUNvdW50OyByb3crKykge1xuICAgICAgICB0aGlzLm1vZHVsZXNbcm93XSA9IG5ldyBBcnJheSh0aGlzLm1vZHVsZUNvdW50KTtcbiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgdGhpcy5tb2R1bGVDb3VudDsgY29sKyspIHtcbiAgICAgICAgICB0aGlzLm1vZHVsZXNbcm93XVtjb2xdID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5zZXR1cFBvc2l0aW9uUHJvYmVQYXR0ZXJuKDAsIDApO1xuICAgICAgdGhpcy5zZXR1cFBvc2l0aW9uUHJvYmVQYXR0ZXJuKHRoaXMubW9kdWxlQ291bnQgLSA3LCAwKTtcbiAgICAgIHRoaXMuc2V0dXBQb3NpdGlvblByb2JlUGF0dGVybigwLCB0aGlzLm1vZHVsZUNvdW50IC0gNyk7XG4gICAgICB0aGlzLnNldHVwUG9zaXRpb25BZGp1c3RQYXR0ZXJuKCk7XG4gICAgICB0aGlzLnNldHVwVGltaW5nUGF0dGVybigpO1xuICAgICAgdGhpcy5zZXR1cFR5cGVJbmZvKHRlc3QsIG1hc2tQYXR0ZXJuKTtcbiAgICAgIGlmICh0aGlzLnR5cGVOdW1iZXIgPj0gNykge1xuICAgICAgICB0aGlzLnNldHVwVHlwZU51bWJlcih0ZXN0KTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmRhdGFDYWNoZSA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMuZGF0YUNhY2hlID0gUVJDb2RlTW9kZWwuY3JlYXRlRGF0YSh0aGlzLnR5cGVOdW1iZXIsIHRoaXMuZXJyb3JDb3JyZWN0TGV2ZWwsIHRoaXMuZGF0YUxpc3QpO1xuICAgICAgfVxuICAgICAgdGhpcy5tYXBEYXRhKHRoaXMuZGF0YUNhY2hlLCBtYXNrUGF0dGVybik7XG4gICAgfSwgc2V0dXBQb3NpdGlvblByb2JlUGF0dGVybjogZnVuY3Rpb24gKHJvdywgY29sKSB7XG4gICAgICBmb3IgKHZhciByID0gLTE7IHIgPD0gNzsgcisrKSB7XG4gICAgICAgIGlmIChyb3cgKyByIDw9IC0xIHx8IHRoaXMubW9kdWxlQ291bnQgPD0gcm93ICsgcikgY29udGludWU7XG4gICAgICAgIGZvciAodmFyIGMgPSAtMTsgYyA8PSA3OyBjKyspIHtcbiAgICAgICAgICBpZiAoY29sICsgYyA8PSAtMSB8fCB0aGlzLm1vZHVsZUNvdW50IDw9IGNvbCArIGMpIGNvbnRpbnVlO1xuICAgICAgICAgIGlmICgoMCA8PSByICYmIHIgPD0gNiAmJiAoYyA9PSAwIHx8IGMgPT0gNikpIHx8ICgwIDw9IGMgJiYgYyA8PSA2ICYmIChyID09IDAgfHwgciA9PSA2KSkgfHwgKDIgPD0gciAmJiByIDw9IDQgJiYgMiA8PSBjICYmIGMgPD0gNCkpIHtcbiAgICAgICAgICAgIHRoaXMubW9kdWxlc1tyb3cgKyByXVtjb2wgKyBjXSA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubW9kdWxlc1tyb3cgKyByXVtjb2wgKyBjXSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIGdldEJlc3RNYXNrUGF0dGVybjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG1pbkxvc3RQb2ludCA9IDA7XG4gICAgICB2YXIgcGF0dGVybiA9IDA7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDg7IGkrKykge1xuICAgICAgICB0aGlzLm1ha2VJbXBsKHRydWUsIGkpO1xuICAgICAgICB2YXIgbG9zdFBvaW50ID0gUVJVdGlsLmdldExvc3RQb2ludCh0aGlzKTtcbiAgICAgICAgaWYgKGkgPT0gMCB8fCBtaW5Mb3N0UG9pbnQgPiBsb3N0UG9pbnQpIHtcbiAgICAgICAgICBtaW5Mb3N0UG9pbnQgPSBsb3N0UG9pbnQ7XG4gICAgICAgICAgcGF0dGVybiA9IGk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXR0ZXJuO1xuICAgIH0sIGNyZWF0ZU1vdmllQ2xpcDogZnVuY3Rpb24gKHRhcmdldF9tYywgaW5zdGFuY2VfbmFtZSwgZGVwdGgpIHtcbiAgICAgIHZhciBxcl9tYyA9IHRhcmdldF9tYy5jcmVhdGVFbXB0eU1vdmllQ2xpcChpbnN0YW5jZV9uYW1lLCBkZXB0aCk7XG4gICAgICB2YXIgY3MgPSAxO1xuICAgICAgdGhpcy5tYWtlKCk7XG4gICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCB0aGlzLm1vZHVsZXMubGVuZ3RoOyByb3crKykge1xuICAgICAgICB2YXIgeSA9IHJvdyAqIGNzO1xuICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCB0aGlzLm1vZHVsZXNbcm93XS5sZW5ndGg7IGNvbCsrKSB7XG4gICAgICAgICAgdmFyIHggPSBjb2wgKiBjcztcbiAgICAgICAgICB2YXIgZGFyayA9IHRoaXMubW9kdWxlc1tyb3ddW2NvbF07XG4gICAgICAgICAgaWYgKGRhcmspIHtcbiAgICAgICAgICAgIHFyX21jLmJlZ2luRmlsbCgwLCAxMDApO1xuICAgICAgICAgICAgcXJfbWMubW92ZVRvKHgsIHkpO1xuICAgICAgICAgICAgcXJfbWMubGluZVRvKHggKyBjcywgeSk7XG4gICAgICAgICAgICBxcl9tYy5saW5lVG8oeCArIGNzLCB5ICsgY3MpO1xuICAgICAgICAgICAgcXJfbWMubGluZVRvKHgsIHkgKyBjcyk7XG4gICAgICAgICAgICBxcl9tYy5lbmRGaWxsKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcXJfbWM7XG4gICAgfSwgc2V0dXBUaW1pbmdQYXR0ZXJuOiBmdW5jdGlvbiAoKSB7XG4gICAgICBmb3IgKHZhciByID0gODsgciA8IHRoaXMubW9kdWxlQ291bnQgLSA4OyByKyspIHtcbiAgICAgICAgaWYgKHRoaXMubW9kdWxlc1tyXVs2XSAhPSBudWxsKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tb2R1bGVzW3JdWzZdID0gKHIgJSAyID09IDApO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgYyA9IDg7IGMgPCB0aGlzLm1vZHVsZUNvdW50IC0gODsgYysrKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZHVsZXNbNl1bY10gIT0gbnVsbCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubW9kdWxlc1s2XVtjXSA9IChjICUgMiA9PSAwKTtcbiAgICAgIH1cbiAgICB9LCBzZXR1cFBvc2l0aW9uQWRqdXN0UGF0dGVybjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHBvcyA9IFFSVXRpbC5nZXRQYXR0ZXJuUG9zaXRpb24odGhpcy50eXBlTnVtYmVyKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcG9zLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgdmFyIHJvdyA9IHBvc1tpXTtcbiAgICAgICAgICB2YXIgY29sID0gcG9zW2pdO1xuICAgICAgICAgIGlmICh0aGlzLm1vZHVsZXNbcm93XVtjb2xdICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKHZhciByID0gLTI7IHIgPD0gMjsgcisrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBjID0gLTI7IGMgPD0gMjsgYysrKSB7XG4gICAgICAgICAgICAgIGlmIChyID09IC0yIHx8IHIgPT0gMiB8fCBjID09IC0yIHx8IGMgPT0gMiB8fCAociA9PSAwICYmIGMgPT0gMCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vZHVsZXNbcm93ICsgcl1bY29sICsgY10gPSB0cnVlO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kdWxlc1tyb3cgKyByXVtjb2wgKyBjXSA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgc2V0dXBUeXBlTnVtYmVyOiBmdW5jdGlvbiAodGVzdCkge1xuICAgICAgdmFyIGJpdHMgPSBRUlV0aWwuZ2V0QkNIVHlwZU51bWJlcih0aGlzLnR5cGVOdW1iZXIpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAxODsgaSsrKSB7XG4gICAgICAgIHZhciBtb2QgPSAoIXRlc3QgJiYgKChiaXRzID4+IGkpICYgMSkgPT0gMSk7XG4gICAgICAgIHRoaXMubW9kdWxlc1tNYXRoLmZsb29yKGkgLyAzKV1baSAlIDMgKyB0aGlzLm1vZHVsZUNvdW50IC0gOCAtIDNdID0gbW9kO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAxODsgaSsrKSB7XG4gICAgICAgIHZhciBtb2QgPSAoIXRlc3QgJiYgKChiaXRzID4+IGkpICYgMSkgPT0gMSk7XG4gICAgICAgIHRoaXMubW9kdWxlc1tpICUgMyArIHRoaXMubW9kdWxlQ291bnQgLSA4IC0gM11bTWF0aC5mbG9vcihpIC8gMyldID0gbW9kO1xuICAgICAgfVxuICAgIH0sIHNldHVwVHlwZUluZm86IGZ1bmN0aW9uICh0ZXN0LCBtYXNrUGF0dGVybikge1xuICAgICAgdmFyIGRhdGEgPSAodGhpcy5lcnJvckNvcnJlY3RMZXZlbCA8PCAzKSB8IG1hc2tQYXR0ZXJuO1xuICAgICAgdmFyIGJpdHMgPSBRUlV0aWwuZ2V0QkNIVHlwZUluZm8oZGF0YSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE1OyBpKyspIHtcbiAgICAgICAgdmFyIG1vZCA9ICghdGVzdCAmJiAoKGJpdHMgPj4gaSkgJiAxKSA9PSAxKTtcbiAgICAgICAgaWYgKGkgPCA2KSB7XG4gICAgICAgICAgdGhpcy5tb2R1bGVzW2ldWzhdID0gbW9kO1xuICAgICAgICB9IGVsc2UgaWYgKGkgPCA4KSB7XG4gICAgICAgICAgdGhpcy5tb2R1bGVzW2kgKyAxXVs4XSA9IG1vZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm1vZHVsZXNbdGhpcy5tb2R1bGVDb3VudCAtIDE1ICsgaV1bOF0gPSBtb2Q7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTU7IGkrKykge1xuICAgICAgICB2YXIgbW9kID0gKCF0ZXN0ICYmICgoYml0cyA+PiBpKSAmIDEpID09IDEpO1xuICAgICAgICBpZiAoaSA8IDgpIHtcbiAgICAgICAgICB0aGlzLm1vZHVsZXNbOF1bdGhpcy5tb2R1bGVDb3VudCAtIGkgLSAxXSA9IG1vZDtcbiAgICAgICAgfSBlbHNlIGlmIChpIDwgOSkge1xuICAgICAgICAgIHRoaXMubW9kdWxlc1s4XVsxNSAtIGkgLSAxICsgMV0gPSBtb2Q7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5tb2R1bGVzWzhdWzE1IC0gaSAtIDFdID0gbW9kO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLm1vZHVsZXNbdGhpcy5tb2R1bGVDb3VudCAtIDhdWzhdID0gKCF0ZXN0KTtcbiAgICB9LCBtYXBEYXRhOiBmdW5jdGlvbiAoZGF0YSwgbWFza1BhdHRlcm4pIHtcbiAgICAgIHZhciBpbmMgPSAtMTtcbiAgICAgIHZhciByb3cgPSB0aGlzLm1vZHVsZUNvdW50IC0gMTtcbiAgICAgIHZhciBiaXRJbmRleCA9IDc7XG4gICAgICB2YXIgYnl0ZUluZGV4ID0gMDtcbiAgICAgIGZvciAodmFyIGNvbCA9IHRoaXMubW9kdWxlQ291bnQgLSAxOyBjb2wgPiAwOyBjb2wgLT0gMikge1xuICAgICAgICBpZiAoY29sID09IDYpIGNvbC0tO1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgMjsgYysrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5tb2R1bGVzW3Jvd11bY29sIC0gY10gPT0gbnVsbCkge1xuICAgICAgICAgICAgICB2YXIgZGFyayA9IGZhbHNlO1xuICAgICAgICAgICAgICBpZiAoYnl0ZUluZGV4IDwgZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBkYXJrID0gKCgoZGF0YVtieXRlSW5kZXhdID4+PiBiaXRJbmRleCkgJiAxKSA9PSAxKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB2YXIgbWFzayA9IFFSVXRpbC5nZXRNYXNrKG1hc2tQYXR0ZXJuLCByb3csIGNvbCAtIGMpO1xuICAgICAgICAgICAgICBpZiAobWFzaykge1xuICAgICAgICAgICAgICAgIGRhcmsgPSAhZGFyaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0aGlzLm1vZHVsZXNbcm93XVtjb2wgLSBjXSA9IGRhcms7XG4gICAgICAgICAgICAgIGJpdEluZGV4LS07XG4gICAgICAgICAgICAgIGlmIChiaXRJbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgICAgIGJ5dGVJbmRleCsrO1xuICAgICAgICAgICAgICAgIGJpdEluZGV4ID0gNztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByb3cgKz0gaW5jO1xuICAgICAgICAgIGlmIChyb3cgPCAwIHx8IHRoaXMubW9kdWxlQ291bnQgPD0gcm93KSB7XG4gICAgICAgICAgICByb3cgLT0gaW5jO1xuICAgICAgICAgICAgaW5jID0gLWluYztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgUVJDb2RlTW9kZWwuUEFEMCA9IDB4RUM7XG4gIFFSQ29kZU1vZGVsLlBBRDEgPSAweDExO1xuICBRUkNvZGVNb2RlbC5jcmVhdGVEYXRhID0gZnVuY3Rpb24gKHR5cGVOdW1iZXIsIGVycm9yQ29ycmVjdExldmVsLCBkYXRhTGlzdCkge1xuICAgIHZhciByc0Jsb2NrcyA9IFFSUlNCbG9jay5nZXRSU0Jsb2Nrcyh0eXBlTnVtYmVyLCBlcnJvckNvcnJlY3RMZXZlbCk7XG4gICAgdmFyIGJ1ZmZlciA9IG5ldyBRUkJpdEJ1ZmZlcigpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBkYXRhID0gZGF0YUxpc3RbaV07XG4gICAgICBidWZmZXIucHV0KGRhdGEubW9kZSwgNCk7XG4gICAgICBidWZmZXIucHV0KGRhdGEuZ2V0TGVuZ3RoKCksIFFSVXRpbC5nZXRMZW5ndGhJbkJpdHMoZGF0YS5tb2RlLCB0eXBlTnVtYmVyKSk7XG4gICAgICBkYXRhLndyaXRlKGJ1ZmZlcik7XG4gICAgfVxuICAgIHZhciB0b3RhbERhdGFDb3VudCA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByc0Jsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdG90YWxEYXRhQ291bnQgKz0gcnNCbG9ja3NbaV0uZGF0YUNvdW50O1xuICAgIH1cbiAgICBpZiAoYnVmZmVyLmdldExlbmd0aEluQml0cygpID4gdG90YWxEYXRhQ291bnQgKiA4KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjb2RlIGxlbmd0aCBvdmVyZmxvdy4gKFwiXG4gICAgICAgICsgYnVmZmVyLmdldExlbmd0aEluQml0cygpXG4gICAgICAgICsgXCI+XCJcbiAgICAgICAgKyB0b3RhbERhdGFDb3VudCAqIDhcbiAgICAgICAgKyBcIilcIik7XG4gICAgfVxuICAgIGlmIChidWZmZXIuZ2V0TGVuZ3RoSW5CaXRzKCkgKyA0IDw9IHRvdGFsRGF0YUNvdW50ICogOCkge1xuICAgICAgYnVmZmVyLnB1dCgwLCA0KTtcbiAgICB9XG4gICAgd2hpbGUgKGJ1ZmZlci5nZXRMZW5ndGhJbkJpdHMoKSAlIDggIT0gMCkge1xuICAgICAgYnVmZmVyLnB1dEJpdChmYWxzZSk7XG4gICAgfVxuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBpZiAoYnVmZmVyLmdldExlbmd0aEluQml0cygpID49IHRvdGFsRGF0YUNvdW50ICogOCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGJ1ZmZlci5wdXQoUVJDb2RlTW9kZWwuUEFEMCwgOCk7XG4gICAgICBpZiAoYnVmZmVyLmdldExlbmd0aEluQml0cygpID49IHRvdGFsRGF0YUNvdW50ICogOCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGJ1ZmZlci5wdXQoUVJDb2RlTW9kZWwuUEFEMSwgOCk7XG4gICAgfVxuICAgIHJldHVybiBRUkNvZGVNb2RlbC5jcmVhdGVCeXRlcyhidWZmZXIsIHJzQmxvY2tzKTtcbiAgfTtcbiAgUVJDb2RlTW9kZWwuY3JlYXRlQnl0ZXMgPSBmdW5jdGlvbiAoYnVmZmVyLCByc0Jsb2Nrcykge1xuICAgIHZhciBvZmZzZXQgPSAwO1xuICAgIHZhciBtYXhEY0NvdW50ID0gMDtcbiAgICB2YXIgbWF4RWNDb3VudCA9IDA7XG4gICAgdmFyIGRjZGF0YSA9IG5ldyBBcnJheShyc0Jsb2Nrcy5sZW5ndGgpO1xuICAgIHZhciBlY2RhdGEgPSBuZXcgQXJyYXkocnNCbG9ja3MubGVuZ3RoKTtcbiAgICBmb3IgKHZhciByID0gMDsgciA8IHJzQmxvY2tzLmxlbmd0aDsgcisrKSB7XG4gICAgICB2YXIgZGNDb3VudCA9IHJzQmxvY2tzW3JdLmRhdGFDb3VudDtcbiAgICAgIHZhciBlY0NvdW50ID0gcnNCbG9ja3Nbcl0udG90YWxDb3VudCAtIGRjQ291bnQ7XG4gICAgICBtYXhEY0NvdW50ID0gTWF0aC5tYXgobWF4RGNDb3VudCwgZGNDb3VudCk7XG4gICAgICBtYXhFY0NvdW50ID0gTWF0aC5tYXgobWF4RWNDb3VudCwgZWNDb3VudCk7XG4gICAgICBkY2RhdGFbcl0gPSBuZXcgQXJyYXkoZGNDb3VudCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRjZGF0YVtyXS5sZW5ndGg7IGkrKykge1xuICAgICAgICBkY2RhdGFbcl1baV0gPSAweGZmICYgYnVmZmVyLmJ1ZmZlcltpICsgb2Zmc2V0XTtcbiAgICAgIH1cbiAgICAgIG9mZnNldCArPSBkY0NvdW50O1xuICAgICAgdmFyIHJzUG9seSA9IFFSVXRpbC5nZXRFcnJvckNvcnJlY3RQb2x5bm9taWFsKGVjQ291bnQpO1xuICAgICAgdmFyIHJhd1BvbHkgPSBuZXcgUVJQb2x5bm9taWFsKGRjZGF0YVtyXSwgcnNQb2x5LmdldExlbmd0aCgpIC0gMSk7XG4gICAgICB2YXIgbW9kUG9seSA9IHJhd1BvbHkubW9kKHJzUG9seSk7XG4gICAgICBlY2RhdGFbcl0gPSBuZXcgQXJyYXkocnNQb2x5LmdldExlbmd0aCgpIC0gMSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVjZGF0YVtyXS5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbW9kSW5kZXggPSBpICsgbW9kUG9seS5nZXRMZW5ndGgoKSAtIGVjZGF0YVtyXS5sZW5ndGg7XG4gICAgICAgIGVjZGF0YVtyXVtpXSA9IChtb2RJbmRleCA+PSAwKSA/IG1vZFBvbHkuZ2V0KG1vZEluZGV4KSA6IDA7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciB0b3RhbENvZGVDb3VudCA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCByc0Jsb2Nrcy5sZW5ndGg7IGkrKykge1xuICAgICAgdG90YWxDb2RlQ291bnQgKz0gcnNCbG9ja3NbaV0udG90YWxDb3VudDtcbiAgICB9XG4gICAgdmFyIGRhdGEgPSBuZXcgQXJyYXkodG90YWxDb2RlQ291bnQpO1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXhEY0NvdW50OyBpKyspIHtcbiAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgcnNCbG9ja3MubGVuZ3RoOyByKyspIHtcbiAgICAgICAgaWYgKGkgPCBkY2RhdGFbcl0ubGVuZ3RoKSB7XG4gICAgICAgICAgZGF0YVtpbmRleCsrXSA9IGRjZGF0YVtyXVtpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1heEVjQ291bnQ7IGkrKykge1xuICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCByc0Jsb2Nrcy5sZW5ndGg7IHIrKykge1xuICAgICAgICBpZiAoaSA8IGVjZGF0YVtyXS5sZW5ndGgpIHtcbiAgICAgICAgICBkYXRhW2luZGV4KytdID0gZWNkYXRhW3JdW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICB2YXIgUVJNb2RlID0ge01PREVfTlVNQkVSOiAxIDw8IDAsIE1PREVfQUxQSEFfTlVNOiAxIDw8IDEsIE1PREVfOEJJVF9CWVRFOiAxIDw8IDIsIE1PREVfS0FOSkk6IDEgPDwgM307XG4gIHZhciBRUkVycm9yQ29ycmVjdExldmVsID0ge0w6IDEsIE06IDAsIFE6IDMsIEg6IDJ9O1xuICB2YXIgUVJNYXNrUGF0dGVybiA9IHtcbiAgICBQQVRURVJOMDAwOiAwLFxuICAgIFBBVFRFUk4wMDE6IDEsXG4gICAgUEFUVEVSTjAxMDogMixcbiAgICBQQVRURVJOMDExOiAzLFxuICAgIFBBVFRFUk4xMDA6IDQsXG4gICAgUEFUVEVSTjEwMTogNSxcbiAgICBQQVRURVJOMTEwOiA2LFxuICAgIFBBVFRFUk4xMTE6IDdcbiAgfTtcbiAgdmFyIFFSVXRpbCA9IHtcbiAgICBQQVRURVJOX1BPU0lUSU9OX1RBQkxFOiBbW10sIFs2LCAxOF0sIFs2LCAyMl0sIFs2LCAyNl0sIFs2LCAzMF0sIFs2LCAzNF0sIFs2LCAyMiwgMzhdLCBbNiwgMjQsIDQyXSwgWzYsIDI2LCA0Nl0sIFs2LCAyOCwgNTBdLCBbNiwgMzAsIDU0XSwgWzYsIDMyLCA1OF0sIFs2LCAzNCwgNjJdLCBbNiwgMjYsIDQ2LCA2Nl0sIFs2LCAyNiwgNDgsIDcwXSwgWzYsIDI2LCA1MCwgNzRdLCBbNiwgMzAsIDU0LCA3OF0sIFs2LCAzMCwgNTYsIDgyXSwgWzYsIDMwLCA1OCwgODZdLCBbNiwgMzQsIDYyLCA5MF0sIFs2LCAyOCwgNTAsIDcyLCA5NF0sIFs2LCAyNiwgNTAsIDc0LCA5OF0sIFs2LCAzMCwgNTQsIDc4LCAxMDJdLCBbNiwgMjgsIDU0LCA4MCwgMTA2XSwgWzYsIDMyLCA1OCwgODQsIDExMF0sIFs2LCAzMCwgNTgsIDg2LCAxMTRdLCBbNiwgMzQsIDYyLCA5MCwgMTE4XSwgWzYsIDI2LCA1MCwgNzQsIDk4LCAxMjJdLCBbNiwgMzAsIDU0LCA3OCwgMTAyLCAxMjZdLCBbNiwgMjYsIDUyLCA3OCwgMTA0LCAxMzBdLCBbNiwgMzAsIDU2LCA4MiwgMTA4LCAxMzRdLCBbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdLCBbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdLCBbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdLCBbNiwgMzAsIDU0LCA3OCwgMTAyLCAxMjYsIDE1MF0sIFs2LCAyNCwgNTAsIDc2LCAxMDIsIDEyOCwgMTU0XSwgWzYsIDI4LCA1NCwgODAsIDEwNiwgMTMyLCAxNThdLCBbNiwgMzIsIDU4LCA4NCwgMTEwLCAxMzYsIDE2Ml0sIFs2LCAyNiwgNTQsIDgyLCAxMTAsIDEzOCwgMTY2XSwgWzYsIDMwLCA1OCwgODYsIDExNCwgMTQyLCAxNzBdXSxcbiAgICBHMTU6ICgxIDw8IDEwKSB8ICgxIDw8IDgpIHwgKDEgPDwgNSkgfCAoMSA8PCA0KSB8ICgxIDw8IDIpIHwgKDEgPDwgMSkgfCAoMSA8PCAwKSxcbiAgICBHMTg6ICgxIDw8IDEyKSB8ICgxIDw8IDExKSB8ICgxIDw8IDEwKSB8ICgxIDw8IDkpIHwgKDEgPDwgOCkgfCAoMSA8PCA1KSB8ICgxIDw8IDIpIHwgKDEgPDwgMCksXG4gICAgRzE1X01BU0s6ICgxIDw8IDE0KSB8ICgxIDw8IDEyKSB8ICgxIDw8IDEwKSB8ICgxIDw8IDQpIHwgKDEgPDwgMSksXG4gICAgZ2V0QkNIVHlwZUluZm86IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgZCA9IGRhdGEgPDwgMTA7XG4gICAgICB3aGlsZSAoUVJVdGlsLmdldEJDSERpZ2l0KGQpIC0gUVJVdGlsLmdldEJDSERpZ2l0KFFSVXRpbC5HMTUpID49IDApIHtcbiAgICAgICAgZCBePSAoUVJVdGlsLkcxNSA8PCAoUVJVdGlsLmdldEJDSERpZ2l0KGQpIC0gUVJVdGlsLmdldEJDSERpZ2l0KFFSVXRpbC5HMTUpKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKChkYXRhIDw8IDEwKSB8IGQpIF4gUVJVdGlsLkcxNV9NQVNLO1xuICAgIH0sXG4gICAgZ2V0QkNIVHlwZU51bWJlcjogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIHZhciBkID0gZGF0YSA8PCAxMjtcbiAgICAgIHdoaWxlIChRUlV0aWwuZ2V0QkNIRGlnaXQoZCkgLSBRUlV0aWwuZ2V0QkNIRGlnaXQoUVJVdGlsLkcxOCkgPj0gMCkge1xuICAgICAgICBkIF49IChRUlV0aWwuRzE4IDw8IChRUlV0aWwuZ2V0QkNIRGlnaXQoZCkgLSBRUlV0aWwuZ2V0QkNIRGlnaXQoUVJVdGlsLkcxOCkpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoZGF0YSA8PCAxMikgfCBkO1xuICAgIH0sXG4gICAgZ2V0QkNIRGlnaXQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICB2YXIgZGlnaXQgPSAwO1xuICAgICAgd2hpbGUgKGRhdGEgIT0gMCkge1xuICAgICAgICBkaWdpdCsrO1xuICAgICAgICBkYXRhID4+Pj0gMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkaWdpdDtcbiAgICB9LFxuICAgIGdldFBhdHRlcm5Qb3NpdGlvbjogZnVuY3Rpb24gKHR5cGVOdW1iZXIpIHtcbiAgICAgIHJldHVybiBRUlV0aWwuUEFUVEVSTl9QT1NJVElPTl9UQUJMRVt0eXBlTnVtYmVyIC0gMV07XG4gICAgfSxcbiAgICBnZXRNYXNrOiBmdW5jdGlvbiAobWFza1BhdHRlcm4sIGksIGopIHtcbiAgICAgIHN3aXRjaCAobWFza1BhdHRlcm4pIHtcbiAgICAgICAgY2FzZSBRUk1hc2tQYXR0ZXJuLlBBVFRFUk4wMDA6XG4gICAgICAgICAgcmV0dXJuIChpICsgaikgJSAyID09IDA7XG4gICAgICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMDAxOlxuICAgICAgICAgIHJldHVybiBpICUgMiA9PSAwO1xuICAgICAgICBjYXNlIFFSTWFza1BhdHRlcm4uUEFUVEVSTjAxMDpcbiAgICAgICAgICByZXR1cm4gaiAlIDMgPT0gMDtcbiAgICAgICAgY2FzZSBRUk1hc2tQYXR0ZXJuLlBBVFRFUk4wMTE6XG4gICAgICAgICAgcmV0dXJuIChpICsgaikgJSAzID09IDA7XG4gICAgICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMTAwOlxuICAgICAgICAgIHJldHVybiAoTWF0aC5mbG9vcihpIC8gMikgKyBNYXRoLmZsb29yKGogLyAzKSkgJSAyID09IDA7XG4gICAgICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMTAxOlxuICAgICAgICAgIHJldHVybiAoaSAqIGopICUgMiArIChpICogaikgJSAzID09IDA7XG4gICAgICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMTEwOlxuICAgICAgICAgIHJldHVybiAoKGkgKiBqKSAlIDIgKyAoaSAqIGopICUgMykgJSAyID09IDA7XG4gICAgICAgIGNhc2UgUVJNYXNrUGF0dGVybi5QQVRURVJOMTExOlxuICAgICAgICAgIHJldHVybiAoKGkgKiBqKSAlIDMgKyAoaSArIGopICUgMikgJSAyID09IDA7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYmFkIG1hc2tQYXR0ZXJuOlwiICsgbWFza1BhdHRlcm4pO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0RXJyb3JDb3JyZWN0UG9seW5vbWlhbDogZnVuY3Rpb24gKGVycm9yQ29ycmVjdExlbmd0aCkge1xuICAgICAgdmFyIGEgPSBuZXcgUVJQb2x5bm9taWFsKFsxXSwgMCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVycm9yQ29ycmVjdExlbmd0aDsgaSsrKSB7XG4gICAgICAgIGEgPSBhLm11bHRpcGx5KG5ldyBRUlBvbHlub21pYWwoWzEsIFFSTWF0aC5nZXhwKGkpXSwgMCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGE7XG4gICAgfSxcbiAgICBnZXRMZW5ndGhJbkJpdHM6IGZ1bmN0aW9uIChtb2RlLCB0eXBlKSB7XG4gICAgICBpZiAoMSA8PSB0eXBlICYmIHR5cGUgPCAxMCkge1xuICAgICAgICBzd2l0Y2ggKG1vZGUpIHtcbiAgICAgICAgICBjYXNlIFFSTW9kZS5NT0RFX05VTUJFUjpcbiAgICAgICAgICAgIHJldHVybiAxMDtcbiAgICAgICAgICBjYXNlIFFSTW9kZS5NT0RFX0FMUEhBX05VTTpcbiAgICAgICAgICAgIHJldHVybiA5O1xuICAgICAgICAgIGNhc2UgUVJNb2RlLk1PREVfOEJJVF9CWVRFOlxuICAgICAgICAgICAgcmV0dXJuIDg7XG4gICAgICAgICAgY2FzZSBRUk1vZGUuTU9ERV9LQU5KSTpcbiAgICAgICAgICAgIHJldHVybiA4O1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJtb2RlOlwiICsgbW9kZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodHlwZSA8IDI3KSB7XG4gICAgICAgIHN3aXRjaCAobW9kZSkge1xuICAgICAgICAgIGNhc2UgUVJNb2RlLk1PREVfTlVNQkVSOlxuICAgICAgICAgICAgcmV0dXJuIDEyO1xuICAgICAgICAgIGNhc2UgUVJNb2RlLk1PREVfQUxQSEFfTlVNOlxuICAgICAgICAgICAgcmV0dXJuIDExO1xuICAgICAgICAgIGNhc2UgUVJNb2RlLk1PREVfOEJJVF9CWVRFOlxuICAgICAgICAgICAgcmV0dXJuIDE2O1xuICAgICAgICAgIGNhc2UgUVJNb2RlLk1PREVfS0FOSkk6XG4gICAgICAgICAgICByZXR1cm4gMTA7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIm1vZGU6XCIgKyBtb2RlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0eXBlIDwgNDEpIHtcbiAgICAgICAgc3dpdGNoIChtb2RlKSB7XG4gICAgICAgICAgY2FzZSBRUk1vZGUuTU9ERV9OVU1CRVI6XG4gICAgICAgICAgICByZXR1cm4gMTQ7XG4gICAgICAgICAgY2FzZSBRUk1vZGUuTU9ERV9BTFBIQV9OVU06XG4gICAgICAgICAgICByZXR1cm4gMTM7XG4gICAgICAgICAgY2FzZSBRUk1vZGUuTU9ERV84QklUX0JZVEU6XG4gICAgICAgICAgICByZXR1cm4gMTY7XG4gICAgICAgICAgY2FzZSBRUk1vZGUuTU9ERV9LQU5KSTpcbiAgICAgICAgICAgIHJldHVybiAxMjtcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibW9kZTpcIiArIG1vZGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0eXBlOlwiICsgdHlwZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRMb3N0UG9pbnQ6IGZ1bmN0aW9uIChxckNvZGUpIHtcbiAgICAgIHZhciBtb2R1bGVDb3VudCA9IHFyQ29kZS5nZXRNb2R1bGVDb3VudCgpO1xuICAgICAgdmFyIGxvc3RQb2ludCA9IDA7XG4gICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBtb2R1bGVDb3VudDsgcm93KyspIHtcbiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgbW9kdWxlQ291bnQ7IGNvbCsrKSB7XG4gICAgICAgICAgdmFyIHNhbWVDb3VudCA9IDA7XG4gICAgICAgICAgdmFyIGRhcmsgPSBxckNvZGUuaXNEYXJrKHJvdywgY29sKTtcbiAgICAgICAgICBmb3IgKHZhciByID0gLTE7IHIgPD0gMTsgcisrKSB7XG4gICAgICAgICAgICBpZiAocm93ICsgciA8IDAgfHwgbW9kdWxlQ291bnQgPD0gcm93ICsgcikge1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGMgPSAtMTsgYyA8PSAxOyBjKyspIHtcbiAgICAgICAgICAgICAgaWYgKGNvbCArIGMgPCAwIHx8IG1vZHVsZUNvdW50IDw9IGNvbCArIGMpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAociA9PSAwICYmIGMgPT0gMCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChkYXJrID09IHFyQ29kZS5pc0Rhcmsocm93ICsgciwgY29sICsgYykpIHtcbiAgICAgICAgICAgICAgICBzYW1lQ291bnQrKztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2FtZUNvdW50ID4gNSkge1xuICAgICAgICAgICAgbG9zdFBvaW50ICs9ICgzICsgc2FtZUNvdW50IC0gNSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBtb2R1bGVDb3VudCAtIDE7IHJvdysrKSB7XG4gICAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG1vZHVsZUNvdW50IC0gMTsgY29sKyspIHtcbiAgICAgICAgICB2YXIgY291bnQgPSAwO1xuICAgICAgICAgIGlmIChxckNvZGUuaXNEYXJrKHJvdywgY29sKSkgY291bnQrKztcbiAgICAgICAgICBpZiAocXJDb2RlLmlzRGFyayhyb3cgKyAxLCBjb2wpKSBjb3VudCsrO1xuICAgICAgICAgIGlmIChxckNvZGUuaXNEYXJrKHJvdywgY29sICsgMSkpIGNvdW50Kys7XG4gICAgICAgICAgaWYgKHFyQ29kZS5pc0Rhcmsocm93ICsgMSwgY29sICsgMSkpIGNvdW50Kys7XG4gICAgICAgICAgaWYgKGNvdW50ID09IDAgfHwgY291bnQgPT0gNCkge1xuICAgICAgICAgICAgbG9zdFBvaW50ICs9IDM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBtb2R1bGVDb3VudDsgcm93KyspIHtcbiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgbW9kdWxlQ291bnQgLSA2OyBjb2wrKykge1xuICAgICAgICAgIGlmIChxckNvZGUuaXNEYXJrKHJvdywgY29sKSAmJiAhcXJDb2RlLmlzRGFyayhyb3csIGNvbCArIDEpICYmIHFyQ29kZS5pc0Rhcmsocm93LCBjb2wgKyAyKSAmJiBxckNvZGUuaXNEYXJrKHJvdywgY29sICsgMykgJiYgcXJDb2RlLmlzRGFyayhyb3csIGNvbCArIDQpICYmICFxckNvZGUuaXNEYXJrKHJvdywgY29sICsgNSkgJiYgcXJDb2RlLmlzRGFyayhyb3csIGNvbCArIDYpKSB7XG4gICAgICAgICAgICBsb3N0UG9pbnQgKz0gNDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBtb2R1bGVDb3VudDsgY29sKyspIHtcbiAgICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbW9kdWxlQ291bnQgLSA2OyByb3crKykge1xuICAgICAgICAgIGlmIChxckNvZGUuaXNEYXJrKHJvdywgY29sKSAmJiAhcXJDb2RlLmlzRGFyayhyb3cgKyAxLCBjb2wpICYmIHFyQ29kZS5pc0Rhcmsocm93ICsgMiwgY29sKSAmJiBxckNvZGUuaXNEYXJrKHJvdyArIDMsIGNvbCkgJiYgcXJDb2RlLmlzRGFyayhyb3cgKyA0LCBjb2wpICYmICFxckNvZGUuaXNEYXJrKHJvdyArIDUsIGNvbCkgJiYgcXJDb2RlLmlzRGFyayhyb3cgKyA2LCBjb2wpKSB7XG4gICAgICAgICAgICBsb3N0UG9pbnQgKz0gNDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICB2YXIgZGFya0NvdW50ID0gMDtcbiAgICAgIGZvciAodmFyIGNvbCA9IDA7IGNvbCA8IG1vZHVsZUNvdW50OyBjb2wrKykge1xuICAgICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBtb2R1bGVDb3VudDsgcm93KyspIHtcbiAgICAgICAgICBpZiAocXJDb2RlLmlzRGFyayhyb3csIGNvbCkpIHtcbiAgICAgICAgICAgIGRhcmtDb3VudCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIHJhdGlvID0gTWF0aC5hYnMoMTAwICogZGFya0NvdW50IC8gbW9kdWxlQ291bnQgLyBtb2R1bGVDb3VudCAtIDUwKSAvIDU7XG4gICAgICBsb3N0UG9pbnQgKz0gcmF0aW8gKiAxMDtcbiAgICAgIHJldHVybiBsb3N0UG9pbnQ7XG4gICAgfVxuICB9O1xuICB2YXIgUVJNYXRoID0ge1xuICAgIGdsb2c6IGZ1bmN0aW9uIChuKSB7XG4gICAgICBpZiAobiA8IDEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZ2xvZyhcIiArIG4gKyBcIilcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gUVJNYXRoLkxPR19UQUJMRVtuXTtcbiAgICB9LCBnZXhwOiBmdW5jdGlvbiAobikge1xuICAgICAgd2hpbGUgKG4gPCAwKSB7XG4gICAgICAgIG4gKz0gMjU1O1xuICAgICAgfVxuICAgICAgd2hpbGUgKG4gPj0gMjU2KSB7XG4gICAgICAgIG4gLT0gMjU1O1xuICAgICAgfVxuICAgICAgcmV0dXJuIFFSTWF0aC5FWFBfVEFCTEVbbl07XG4gICAgfSwgRVhQX1RBQkxFOiBuZXcgQXJyYXkoMjU2KSwgTE9HX1RBQkxFOiBuZXcgQXJyYXkoMjU2KVxuICB9O1xuICBmb3IgKHZhciBpID0gMDsgaSA8IDg7IGkrKykge1xuICAgIFFSTWF0aC5FWFBfVEFCTEVbaV0gPSAxIDw8IGk7XG4gIH1cbiAgZm9yICh2YXIgaSA9IDg7IGkgPCAyNTY7IGkrKykge1xuICAgIFFSTWF0aC5FWFBfVEFCTEVbaV0gPSBRUk1hdGguRVhQX1RBQkxFW2kgLSA0XSBeIFFSTWF0aC5FWFBfVEFCTEVbaSAtIDVdIF4gUVJNYXRoLkVYUF9UQUJMRVtpIC0gNl0gXiBRUk1hdGguRVhQX1RBQkxFW2kgLSA4XTtcbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NTsgaSsrKSB7XG4gICAgUVJNYXRoLkxPR19UQUJMRVtRUk1hdGguRVhQX1RBQkxFW2ldXSA9IGk7XG4gIH1cblxuICBmdW5jdGlvbiBRUlBvbHlub21pYWwobnVtLCBzaGlmdCkge1xuICAgIGlmIChudW0ubGVuZ3RoID09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKG51bS5sZW5ndGggKyBcIi9cIiArIHNoaWZ0KTtcbiAgICB9XG4gICAgdmFyIG9mZnNldCA9IDA7XG4gICAgd2hpbGUgKG9mZnNldCA8IG51bS5sZW5ndGggJiYgbnVtW29mZnNldF0gPT0gMCkge1xuICAgICAgb2Zmc2V0Kys7XG4gICAgfVxuICAgIHRoaXMubnVtID0gbmV3IEFycmF5KG51bS5sZW5ndGggLSBvZmZzZXQgKyBzaGlmdCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW0ubGVuZ3RoIC0gb2Zmc2V0OyBpKyspIHtcbiAgICAgIHRoaXMubnVtW2ldID0gbnVtW2kgKyBvZmZzZXRdO1xuICAgIH1cbiAgfVxuXG4gIFFSUG9seW5vbWlhbC5wcm90b3R5cGUgPSB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgIHJldHVybiB0aGlzLm51bVtpbmRleF07XG4gICAgfSwgZ2V0TGVuZ3RoOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5udW0ubGVuZ3RoO1xuICAgIH0sIG11bHRpcGx5OiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIG51bSA9IG5ldyBBcnJheSh0aGlzLmdldExlbmd0aCgpICsgZS5nZXRMZW5ndGgoKSAtIDEpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdldExlbmd0aCgpOyBpKyspIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBlLmdldExlbmd0aCgpOyBqKyspIHtcbiAgICAgICAgICBudW1baSArIGpdIF49IFFSTWF0aC5nZXhwKFFSTWF0aC5nbG9nKHRoaXMuZ2V0KGkpKSArIFFSTWF0aC5nbG9nKGUuZ2V0KGopKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgUVJQb2x5bm9taWFsKG51bSwgMCk7XG4gICAgfSwgbW9kOiBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKHRoaXMuZ2V0TGVuZ3RoKCkgLSBlLmdldExlbmd0aCgpIDwgMCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHZhciByYXRpbyA9IFFSTWF0aC5nbG9nKHRoaXMuZ2V0KDApKSAtIFFSTWF0aC5nbG9nKGUuZ2V0KDApKTtcbiAgICAgIHZhciBudW0gPSBuZXcgQXJyYXkodGhpcy5nZXRMZW5ndGgoKSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2V0TGVuZ3RoKCk7IGkrKykge1xuICAgICAgICBudW1baV0gPSB0aGlzLmdldChpKTtcbiAgICAgIH1cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZS5nZXRMZW5ndGgoKTsgaSsrKSB7XG4gICAgICAgIG51bVtpXSBePSBRUk1hdGguZ2V4cChRUk1hdGguZ2xvZyhlLmdldChpKSkgKyByYXRpbyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IFFSUG9seW5vbWlhbChudW0sIDApLm1vZChlKTtcbiAgICB9XG4gIH07XG5cbiAgZnVuY3Rpb24gUVJSU0Jsb2NrKHRvdGFsQ291bnQsIGRhdGFDb3VudCkge1xuICAgIHRoaXMudG90YWxDb3VudCA9IHRvdGFsQ291bnQ7XG4gICAgdGhpcy5kYXRhQ291bnQgPSBkYXRhQ291bnQ7XG4gIH1cblxuICBRUlJTQmxvY2suUlNfQkxPQ0tfVEFCTEUgPSBbWzEsIDI2LCAxOV0sIFsxLCAyNiwgMTZdLCBbMSwgMjYsIDEzXSwgWzEsIDI2LCA5XSwgWzEsIDQ0LCAzNF0sIFsxLCA0NCwgMjhdLCBbMSwgNDQsIDIyXSwgWzEsIDQ0LCAxNl0sIFsxLCA3MCwgNTVdLCBbMSwgNzAsIDQ0XSwgWzIsIDM1LCAxN10sIFsyLCAzNSwgMTNdLCBbMSwgMTAwLCA4MF0sIFsyLCA1MCwgMzJdLCBbMiwgNTAsIDI0XSwgWzQsIDI1LCA5XSwgWzEsIDEzNCwgMTA4XSwgWzIsIDY3LCA0M10sIFsyLCAzMywgMTUsIDIsIDM0LCAxNl0sIFsyLCAzMywgMTEsIDIsIDM0LCAxMl0sIFsyLCA4NiwgNjhdLCBbNCwgNDMsIDI3XSwgWzQsIDQzLCAxOV0sIFs0LCA0MywgMTVdLCBbMiwgOTgsIDc4XSwgWzQsIDQ5LCAzMV0sIFsyLCAzMiwgMTQsIDQsIDMzLCAxNV0sIFs0LCAzOSwgMTMsIDEsIDQwLCAxNF0sIFsyLCAxMjEsIDk3XSwgWzIsIDYwLCAzOCwgMiwgNjEsIDM5XSwgWzQsIDQwLCAxOCwgMiwgNDEsIDE5XSwgWzQsIDQwLCAxNCwgMiwgNDEsIDE1XSwgWzIsIDE0NiwgMTE2XSwgWzMsIDU4LCAzNiwgMiwgNTksIDM3XSwgWzQsIDM2LCAxNiwgNCwgMzcsIDE3XSwgWzQsIDM2LCAxMiwgNCwgMzcsIDEzXSwgWzIsIDg2LCA2OCwgMiwgODcsIDY5XSwgWzQsIDY5LCA0MywgMSwgNzAsIDQ0XSwgWzYsIDQzLCAxOSwgMiwgNDQsIDIwXSwgWzYsIDQzLCAxNSwgMiwgNDQsIDE2XSwgWzQsIDEwMSwgODFdLCBbMSwgODAsIDUwLCA0LCA4MSwgNTFdLCBbNCwgNTAsIDIyLCA0LCA1MSwgMjNdLCBbMywgMzYsIDEyLCA4LCAzNywgMTNdLCBbMiwgMTE2LCA5MiwgMiwgMTE3LCA5M10sIFs2LCA1OCwgMzYsIDIsIDU5LCAzN10sIFs0LCA0NiwgMjAsIDYsIDQ3LCAyMV0sIFs3LCA0MiwgMTQsIDQsIDQzLCAxNV0sIFs0LCAxMzMsIDEwN10sIFs4LCA1OSwgMzcsIDEsIDYwLCAzOF0sIFs4LCA0NCwgMjAsIDQsIDQ1LCAyMV0sIFsxMiwgMzMsIDExLCA0LCAzNCwgMTJdLCBbMywgMTQ1LCAxMTUsIDEsIDE0NiwgMTE2XSwgWzQsIDY0LCA0MCwgNSwgNjUsIDQxXSwgWzExLCAzNiwgMTYsIDUsIDM3LCAxN10sIFsxMSwgMzYsIDEyLCA1LCAzNywgMTNdLCBbNSwgMTA5LCA4NywgMSwgMTEwLCA4OF0sIFs1LCA2NSwgNDEsIDUsIDY2LCA0Ml0sIFs1LCA1NCwgMjQsIDcsIDU1LCAyNV0sIFsxMSwgMzYsIDEyXSwgWzUsIDEyMiwgOTgsIDEsIDEyMywgOTldLCBbNywgNzMsIDQ1LCAzLCA3NCwgNDZdLCBbMTUsIDQzLCAxOSwgMiwgNDQsIDIwXSwgWzMsIDQ1LCAxNSwgMTMsIDQ2LCAxNl0sIFsxLCAxMzUsIDEwNywgNSwgMTM2LCAxMDhdLCBbMTAsIDc0LCA0NiwgMSwgNzUsIDQ3XSwgWzEsIDUwLCAyMiwgMTUsIDUxLCAyM10sIFsyLCA0MiwgMTQsIDE3LCA0MywgMTVdLCBbNSwgMTUwLCAxMjAsIDEsIDE1MSwgMTIxXSwgWzksIDY5LCA0MywgNCwgNzAsIDQ0XSwgWzE3LCA1MCwgMjIsIDEsIDUxLCAyM10sIFsyLCA0MiwgMTQsIDE5LCA0MywgMTVdLCBbMywgMTQxLCAxMTMsIDQsIDE0MiwgMTE0XSwgWzMsIDcwLCA0NCwgMTEsIDcxLCA0NV0sIFsxNywgNDcsIDIxLCA0LCA0OCwgMjJdLCBbOSwgMzksIDEzLCAxNiwgNDAsIDE0XSwgWzMsIDEzNSwgMTA3LCA1LCAxMzYsIDEwOF0sIFszLCA2NywgNDEsIDEzLCA2OCwgNDJdLCBbMTUsIDU0LCAyNCwgNSwgNTUsIDI1XSwgWzE1LCA0MywgMTUsIDEwLCA0NCwgMTZdLCBbNCwgMTQ0LCAxMTYsIDQsIDE0NSwgMTE3XSwgWzE3LCA2OCwgNDJdLCBbMTcsIDUwLCAyMiwgNiwgNTEsIDIzXSwgWzE5LCA0NiwgMTYsIDYsIDQ3LCAxN10sIFsyLCAxMzksIDExMSwgNywgMTQwLCAxMTJdLCBbMTcsIDc0LCA0Nl0sIFs3LCA1NCwgMjQsIDE2LCA1NSwgMjVdLCBbMzQsIDM3LCAxM10sIFs0LCAxNTEsIDEyMSwgNSwgMTUyLCAxMjJdLCBbNCwgNzUsIDQ3LCAxNCwgNzYsIDQ4XSwgWzExLCA1NCwgMjQsIDE0LCA1NSwgMjVdLCBbMTYsIDQ1LCAxNSwgMTQsIDQ2LCAxNl0sIFs2LCAxNDcsIDExNywgNCwgMTQ4LCAxMThdLCBbNiwgNzMsIDQ1LCAxNCwgNzQsIDQ2XSwgWzExLCA1NCwgMjQsIDE2LCA1NSwgMjVdLCBbMzAsIDQ2LCAxNiwgMiwgNDcsIDE3XSwgWzgsIDEzMiwgMTA2LCA0LCAxMzMsIDEwN10sIFs4LCA3NSwgNDcsIDEzLCA3NiwgNDhdLCBbNywgNTQsIDI0LCAyMiwgNTUsIDI1XSwgWzIyLCA0NSwgMTUsIDEzLCA0NiwgMTZdLCBbMTAsIDE0MiwgMTE0LCAyLCAxNDMsIDExNV0sIFsxOSwgNzQsIDQ2LCA0LCA3NSwgNDddLCBbMjgsIDUwLCAyMiwgNiwgNTEsIDIzXSwgWzMzLCA0NiwgMTYsIDQsIDQ3LCAxN10sIFs4LCAxNTIsIDEyMiwgNCwgMTUzLCAxMjNdLCBbMjIsIDczLCA0NSwgMywgNzQsIDQ2XSwgWzgsIDUzLCAyMywgMjYsIDU0LCAyNF0sIFsxMiwgNDUsIDE1LCAyOCwgNDYsIDE2XSwgWzMsIDE0NywgMTE3LCAxMCwgMTQ4LCAxMThdLCBbMywgNzMsIDQ1LCAyMywgNzQsIDQ2XSwgWzQsIDU0LCAyNCwgMzEsIDU1LCAyNV0sIFsxMSwgNDUsIDE1LCAzMSwgNDYsIDE2XSwgWzcsIDE0NiwgMTE2LCA3LCAxNDcsIDExN10sIFsyMSwgNzMsIDQ1LCA3LCA3NCwgNDZdLCBbMSwgNTMsIDIzLCAzNywgNTQsIDI0XSwgWzE5LCA0NSwgMTUsIDI2LCA0NiwgMTZdLCBbNSwgMTQ1LCAxMTUsIDEwLCAxNDYsIDExNl0sIFsxOSwgNzUsIDQ3LCAxMCwgNzYsIDQ4XSwgWzE1LCA1NCwgMjQsIDI1LCA1NSwgMjVdLCBbMjMsIDQ1LCAxNSwgMjUsIDQ2LCAxNl0sIFsxMywgMTQ1LCAxMTUsIDMsIDE0NiwgMTE2XSwgWzIsIDc0LCA0NiwgMjksIDc1LCA0N10sIFs0MiwgNTQsIDI0LCAxLCA1NSwgMjVdLCBbMjMsIDQ1LCAxNSwgMjgsIDQ2LCAxNl0sIFsxNywgMTQ1LCAxMTVdLCBbMTAsIDc0LCA0NiwgMjMsIDc1LCA0N10sIFsxMCwgNTQsIDI0LCAzNSwgNTUsIDI1XSwgWzE5LCA0NSwgMTUsIDM1LCA0NiwgMTZdLCBbMTcsIDE0NSwgMTE1LCAxLCAxNDYsIDExNl0sIFsxNCwgNzQsIDQ2LCAyMSwgNzUsIDQ3XSwgWzI5LCA1NCwgMjQsIDE5LCA1NSwgMjVdLCBbMTEsIDQ1LCAxNSwgNDYsIDQ2LCAxNl0sIFsxMywgMTQ1LCAxMTUsIDYsIDE0NiwgMTE2XSwgWzE0LCA3NCwgNDYsIDIzLCA3NSwgNDddLCBbNDQsIDU0LCAyNCwgNywgNTUsIDI1XSwgWzU5LCA0NiwgMTYsIDEsIDQ3LCAxN10sIFsxMiwgMTUxLCAxMjEsIDcsIDE1MiwgMTIyXSwgWzEyLCA3NSwgNDcsIDI2LCA3NiwgNDhdLCBbMzksIDU0LCAyNCwgMTQsIDU1LCAyNV0sIFsyMiwgNDUsIDE1LCA0MSwgNDYsIDE2XSwgWzYsIDE1MSwgMTIxLCAxNCwgMTUyLCAxMjJdLCBbNiwgNzUsIDQ3LCAzNCwgNzYsIDQ4XSwgWzQ2LCA1NCwgMjQsIDEwLCA1NSwgMjVdLCBbMiwgNDUsIDE1LCA2NCwgNDYsIDE2XSwgWzE3LCAxNTIsIDEyMiwgNCwgMTUzLCAxMjNdLCBbMjksIDc0LCA0NiwgMTQsIDc1LCA0N10sIFs0OSwgNTQsIDI0LCAxMCwgNTUsIDI1XSwgWzI0LCA0NSwgMTUsIDQ2LCA0NiwgMTZdLCBbNCwgMTUyLCAxMjIsIDE4LCAxNTMsIDEyM10sIFsxMywgNzQsIDQ2LCAzMiwgNzUsIDQ3XSwgWzQ4LCA1NCwgMjQsIDE0LCA1NSwgMjVdLCBbNDIsIDQ1LCAxNSwgMzIsIDQ2LCAxNl0sIFsyMCwgMTQ3LCAxMTcsIDQsIDE0OCwgMTE4XSwgWzQwLCA3NSwgNDcsIDcsIDc2LCA0OF0sIFs0MywgNTQsIDI0LCAyMiwgNTUsIDI1XSwgWzEwLCA0NSwgMTUsIDY3LCA0NiwgMTZdLCBbMTksIDE0OCwgMTE4LCA2LCAxNDksIDExOV0sIFsxOCwgNzUsIDQ3LCAzMSwgNzYsIDQ4XSwgWzM0LCA1NCwgMjQsIDM0LCA1NSwgMjVdLCBbMjAsIDQ1LCAxNSwgNjEsIDQ2LCAxNl1dO1xuICBRUlJTQmxvY2suZ2V0UlNCbG9ja3MgPSBmdW5jdGlvbiAodHlwZU51bWJlciwgZXJyb3JDb3JyZWN0TGV2ZWwpIHtcbiAgICB2YXIgcnNCbG9jayA9IFFSUlNCbG9jay5nZXRSc0Jsb2NrVGFibGUodHlwZU51bWJlciwgZXJyb3JDb3JyZWN0TGV2ZWwpO1xuICAgIGlmIChyc0Jsb2NrID09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYmFkIHJzIGJsb2NrIEAgdHlwZU51bWJlcjpcIiArIHR5cGVOdW1iZXIgKyBcIi9lcnJvckNvcnJlY3RMZXZlbDpcIiArIGVycm9yQ29ycmVjdExldmVsKTtcbiAgICB9XG4gICAgdmFyIGxlbmd0aCA9IHJzQmxvY2subGVuZ3RoIC8gMztcbiAgICB2YXIgbGlzdCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjb3VudCA9IHJzQmxvY2tbaSAqIDMgKyAwXTtcbiAgICAgIHZhciB0b3RhbENvdW50ID0gcnNCbG9ja1tpICogMyArIDFdO1xuICAgICAgdmFyIGRhdGFDb3VudCA9IHJzQmxvY2tbaSAqIDMgKyAyXTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY291bnQ7IGorKykge1xuICAgICAgICBsaXN0LnB1c2gobmV3IFFSUlNCbG9jayh0b3RhbENvdW50LCBkYXRhQ291bnQpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxpc3Q7XG4gIH07XG4gIFFSUlNCbG9jay5nZXRSc0Jsb2NrVGFibGUgPSBmdW5jdGlvbiAodHlwZU51bWJlciwgZXJyb3JDb3JyZWN0TGV2ZWwpIHtcbiAgICBzd2l0Y2ggKGVycm9yQ29ycmVjdExldmVsKSB7XG4gICAgICBjYXNlIFFSRXJyb3JDb3JyZWN0TGV2ZWwuTDpcbiAgICAgICAgcmV0dXJuIFFSUlNCbG9jay5SU19CTE9DS19UQUJMRVsodHlwZU51bWJlciAtIDEpICogNCArIDBdO1xuICAgICAgY2FzZSBRUkVycm9yQ29ycmVjdExldmVsLk06XG4gICAgICAgIHJldHVybiBRUlJTQmxvY2suUlNfQkxPQ0tfVEFCTEVbKHR5cGVOdW1iZXIgLSAxKSAqIDQgKyAxXTtcbiAgICAgIGNhc2UgUVJFcnJvckNvcnJlY3RMZXZlbC5ROlxuICAgICAgICByZXR1cm4gUVJSU0Jsb2NrLlJTX0JMT0NLX1RBQkxFWyh0eXBlTnVtYmVyIC0gMSkgKiA0ICsgMl07XG4gICAgICBjYXNlIFFSRXJyb3JDb3JyZWN0TGV2ZWwuSDpcbiAgICAgICAgcmV0dXJuIFFSUlNCbG9jay5SU19CTE9DS19UQUJMRVsodHlwZU51bWJlciAtIDEpICogNCArIDNdO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH07XG5cbiAgZnVuY3Rpb24gUVJCaXRCdWZmZXIoKSB7XG4gICAgdGhpcy5idWZmZXIgPSBbXTtcbiAgICB0aGlzLmxlbmd0aCA9IDA7XG4gIH1cblxuICBRUkJpdEJ1ZmZlci5wcm90b3R5cGUgPSB7XG4gICAgZ2V0OiBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgIHZhciBidWZJbmRleCA9IE1hdGguZmxvb3IoaW5kZXggLyA4KTtcbiAgICAgIHJldHVybiAoKHRoaXMuYnVmZmVyW2J1ZkluZGV4XSA+Pj4gKDcgLSBpbmRleCAlIDgpKSAmIDEpID09IDE7XG4gICAgfSwgcHV0OiBmdW5jdGlvbiAobnVtLCBsZW5ndGgpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGhpcy5wdXRCaXQoKChudW0gPj4+IChsZW5ndGggLSBpIC0gMSkpICYgMSkgPT0gMSk7XG4gICAgICB9XG4gICAgfSwgZ2V0TGVuZ3RoSW5CaXRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5sZW5ndGg7XG4gICAgfSwgcHV0Qml0OiBmdW5jdGlvbiAoYml0KSB7XG4gICAgICB2YXIgYnVmSW5kZXggPSBNYXRoLmZsb29yKHRoaXMubGVuZ3RoIC8gOCk7XG4gICAgICBpZiAodGhpcy5idWZmZXIubGVuZ3RoIDw9IGJ1ZkluZGV4KSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLnB1c2goMCk7XG4gICAgICB9XG4gICAgICBpZiAoYml0KSB7XG4gICAgICAgIHRoaXMuYnVmZmVyW2J1ZkluZGV4XSB8PSAoMHg4MCA+Pj4gKHRoaXMubGVuZ3RoICUgOCkpO1xuICAgICAgfVxuICAgICAgdGhpcy5sZW5ndGgrKztcbiAgICB9XG4gIH07XG4gIHZhciBRUkNvZGVMaW1pdExlbmd0aCA9IFtbMTcsIDE0LCAxMSwgN10sIFszMiwgMjYsIDIwLCAxNF0sIFs1MywgNDIsIDMyLCAyNF0sIFs3OCwgNjIsIDQ2LCAzNF0sIFsxMDYsIDg0LCA2MCwgNDRdLCBbMTM0LCAxMDYsIDc0LCA1OF0sIFsxNTQsIDEyMiwgODYsIDY0XSwgWzE5MiwgMTUyLCAxMDgsIDg0XSwgWzIzMCwgMTgwLCAxMzAsIDk4XSwgWzI3MSwgMjEzLCAxNTEsIDExOV0sIFszMjEsIDI1MSwgMTc3LCAxMzddLCBbMzY3LCAyODcsIDIwMywgMTU1XSwgWzQyNSwgMzMxLCAyNDEsIDE3N10sIFs0NTgsIDM2MiwgMjU4LCAxOTRdLCBbNTIwLCA0MTIsIDI5MiwgMjIwXSwgWzU4NiwgNDUwLCAzMjIsIDI1MF0sIFs2NDQsIDUwNCwgMzY0LCAyODBdLCBbNzE4LCA1NjAsIDM5NCwgMzEwXSwgWzc5MiwgNjI0LCA0NDIsIDMzOF0sIFs4NTgsIDY2NiwgNDgyLCAzODJdLCBbOTI5LCA3MTEsIDUwOSwgNDAzXSwgWzEwMDMsIDc3OSwgNTY1LCA0MzldLCBbMTA5MSwgODU3LCA2MTEsIDQ2MV0sIFsxMTcxLCA5MTEsIDY2MSwgNTExXSwgWzEyNzMsIDk5NywgNzE1LCA1MzVdLCBbMTM2NywgMTA1OSwgNzUxLCA1OTNdLCBbMTQ2NSwgMTEyNSwgODA1LCA2MjVdLCBbMTUyOCwgMTE5MCwgODY4LCA2NThdLCBbMTYyOCwgMTI2NCwgOTA4LCA2OThdLCBbMTczMiwgMTM3MCwgOTgyLCA3NDJdLCBbMTg0MCwgMTQ1MiwgMTAzMCwgNzkwXSwgWzE5NTIsIDE1MzgsIDExMTIsIDg0Ml0sIFsyMDY4LCAxNjI4LCAxMTY4LCA4OThdLCBbMjE4OCwgMTcyMiwgMTIyOCwgOTU4XSwgWzIzMDMsIDE4MDksIDEyODMsIDk4M10sIFsyNDMxLCAxOTExLCAxMzUxLCAxMDUxXSwgWzI1NjMsIDE5ODksIDE0MjMsIDEwOTNdLCBbMjY5OSwgMjA5OSwgMTQ5OSwgMTEzOV0sIFsyODA5LCAyMjEzLCAxNTc5LCAxMjE5XSwgWzI5NTMsIDIzMzEsIDE2NjMsIDEyNzNdXTtcblxuICBmdW5jdGlvbiBfaXNTdXBwb3J0Q2FudmFzKCkge1xuICAgIHJldHVybiB0eXBlb2YgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEICE9IFwidW5kZWZpbmVkXCI7XG4gIH1cblxuICAvLyBhbmRyb2lkIDIueCBkb2Vzbid0IHN1cHBvcnQgRGF0YS1VUkkgc3BlY1xuICBmdW5jdGlvbiBfZ2V0QW5kcm9pZCgpIHtcbiAgICB2YXIgYW5kcm9pZCA9IGZhbHNlO1xuICAgIHZhciBzQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuXG4gICAgaWYgKC9hbmRyb2lkL2kudGVzdChzQWdlbnQpKSB7IC8vIGFuZHJvaWRcbiAgICAgIGFuZHJvaWQgPSB0cnVlO1xuICAgICAgdmFyIGFNYXQgPSBzQWdlbnQudG9TdHJpbmcoKS5tYXRjaCgvYW5kcm9pZCAoWzAtOV1cXC5bMC05XSkvaSk7XG5cbiAgICAgIGlmIChhTWF0ICYmIGFNYXRbMV0pIHtcbiAgICAgICAgYW5kcm9pZCA9IHBhcnNlRmxvYXQoYU1hdFsxXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGFuZHJvaWQ7XG4gIH1cblxuICB2YXIgc3ZnRHJhd2VyID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBEcmF3aW5nID0gZnVuY3Rpb24gKCBodE9wdGlvbikge1xuICAgICAgdGhpcy5faHRPcHRpb24gPSBodE9wdGlvbjtcbiAgICB9O1xuXG4gICAgRHJhd2luZy5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uIChvUVJDb2RlKSB7XG4gICAgICB2YXIgX2h0T3B0aW9uID0gdGhpcy5faHRPcHRpb247XG4gICAgICB2YXIgbkNvdW50ID0gb1FSQ29kZS5nZXRNb2R1bGVDb3VudCgpO1xuICAgICAgdmFyIG5XaWR0aCA9IE1hdGguZmxvb3IoX2h0T3B0aW9uLndpZHRoIC8gbkNvdW50KTtcbiAgICAgIHZhciBuSGVpZ2h0ID0gTWF0aC5mbG9vcihfaHRPcHRpb24uaGVpZ2h0IC8gbkNvdW50KTtcblxuICAgICAgdGhpcy5jbGVhcigpO1xuXG4gICAgICBmdW5jdGlvbiBtYWtlU1ZHKHRhZywgYXR0cnMpIHtcbiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsIHRhZyk7XG4gICAgICAgIGZvciAodmFyIGsgaW4gYXR0cnMpXG4gICAgICAgICAgaWYgKGF0dHJzLmhhc093blByb3BlcnR5KGspKSBlbC5zZXRBdHRyaWJ1dGUoaywgYXR0cnNba10pO1xuICAgICAgICByZXR1cm4gZWw7XG4gICAgICB9XG5cbiAgICAgIHZhciBzdmcgPSBtYWtlU1ZHKFwic3ZnXCIsIHtcbiAgICAgICAgJ3ZpZXdCb3gnOiAnMCAwICcgKyBTdHJpbmcobkNvdW50KSArIFwiIFwiICsgU3RyaW5nKG5Db3VudCksXG4gICAgICAgICd3aWR0aCc6ICcxMDAlJyxcbiAgICAgICAgJ2hlaWdodCc6ICcxMDAlJyxcbiAgICAgICAgJ2ZpbGwnOiBfaHRPcHRpb24uY29sb3JMaWdodFxuICAgICAgfSk7XG4gICAgICBzdmcuc2V0QXR0cmlidXRlTlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zL1wiLCBcInhtbG5zOnhsaW5rXCIsIFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiKTtcbiAgICAgIHN2Zy5hcHBlbmRDaGlsZChtYWtlU1ZHKFwicmVjdFwiLCB7XCJmaWxsXCI6IF9odE9wdGlvbi5jb2xvckxpZ2h0LCBcIndpZHRoXCI6IFwiMTAwJVwiLCBcImhlaWdodFwiOiBcIjEwMCVcIn0pKTtcbiAgICAgIHN2Zy5hcHBlbmRDaGlsZChtYWtlU1ZHKFwicmVjdFwiLCB7XCJmaWxsXCI6IF9odE9wdGlvbi5jb2xvckRhcmssIFwid2lkdGhcIjogXCIxXCIsIFwiaGVpZ2h0XCI6IFwiMVwiLCBcImlkXCI6IFwidGVtcGxhdGVcIn0pKTtcblxuICAgICAgZm9yICh2YXIgcm93ID0gMDsgcm93IDwgbkNvdW50OyByb3crKykge1xuICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBuQ291bnQ7IGNvbCsrKSB7XG4gICAgICAgICAgaWYgKG9RUkNvZGUuaXNEYXJrKHJvdywgY29sKSkge1xuICAgICAgICAgICAgdmFyIGNoaWxkID0gbWFrZVNWRyhcInVzZVwiLCB7XCJ4XCI6IFN0cmluZyhjb2wpLCBcInlcIjogU3RyaW5nKHJvdyl9KTtcbiAgICAgICAgICAgIGNoaWxkLnNldEF0dHJpYnV0ZU5TKFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiLCBcImhyZWZcIiwgXCIjdGVtcGxhdGVcIilcbiAgICAgICAgICAgIHN2Zy5hcHBlbmRDaGlsZChjaGlsZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gc3ZnO1xuICAgIH07XG4gICAgcmV0dXJuIERyYXdpbmc7XG4gIH0pKCk7XG5cbiAgdmFyIHVzZVNWRyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IFwic3ZnXCI7XG5cbiAgLy8gRHJhd2luZyBpbiBET00gYnkgdXNpbmcgVGFibGUgdGFnXG4gIHZhciBEcmF3aW5nID0gdXNlU1ZHID8gc3ZnRHJhd2VyIDogIV9pc1N1cHBvcnRDYW52YXMoKSA/IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIERyYXdpbmcgPSBmdW5jdGlvbiAoIGh0T3B0aW9uKSB7XG4gICAgICB0aGlzLl9odE9wdGlvbiA9IGh0T3B0aW9uO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBEcmF3IHRoZSBRUkNvZGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7UVJDb2RlfSBvUVJDb2RlXG4gICAgICovXG4gICAgRHJhd2luZy5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uIChvUVJDb2RlKSB7XG4gICAgICB2YXIgX2h0T3B0aW9uID0gdGhpcy5faHRPcHRpb247XG4gICAgICB2YXIgbkNvdW50ID0gb1FSQ29kZS5nZXRNb2R1bGVDb3VudCgpO1xuICAgICAgdmFyIG5XaWR0aCA9IE1hdGguZmxvb3IoX2h0T3B0aW9uLndpZHRoIC8gbkNvdW50KTtcbiAgICAgIHZhciBuSGVpZ2h0ID0gTWF0aC5mbG9vcihfaHRPcHRpb24uaGVpZ2h0IC8gbkNvdW50KTtcbiAgICAgIHZhciBhSFRNTCA9IFsnPHRhYmxlIHN0eWxlPVwiYm9yZGVyOjA7Ym9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlO1wiPiddO1xuXG4gICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCBuQ291bnQ7IHJvdysrKSB7XG4gICAgICAgIGFIVE1MLnB1c2goJzx0cj4nKTtcblxuICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCBuQ291bnQ7IGNvbCsrKSB7XG4gICAgICAgICAgYUhUTUwucHVzaCgnPHRkIHN0eWxlPVwiYm9yZGVyOjA7Ym9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlO3BhZGRpbmc6MDttYXJnaW46MDt3aWR0aDonICsgbldpZHRoICsgJ3B4O2hlaWdodDonICsgbkhlaWdodCArICdweDtiYWNrZ3JvdW5kLWNvbG9yOicgKyAob1FSQ29kZS5pc0Rhcmsocm93LCBjb2wpID8gX2h0T3B0aW9uLmNvbG9yRGFyayA6IF9odE9wdGlvbi5jb2xvckxpZ2h0KSArICc7XCI+PC90ZD4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFIVE1MLnB1c2goJzwvdHI+Jyk7XG4gICAgICB9XG5cbiAgICAgIGFIVE1MLnB1c2goJzwvdGFibGU+Jyk7XG4gICAgICBfZWwuaW5uZXJIVE1MID0gYUhUTUwuam9pbignJyk7XG5cbiAgICAgIC8vIEZpeCB0aGUgbWFyZ2luIHZhbHVlcyBhcyByZWFsIHNpemUuXG4gICAgICB2YXIgZWxUYWJsZSA9IF9lbC5jaGlsZE5vZGVzWzBdO1xuICAgICAgdmFyIG5MZWZ0TWFyZ2luVGFibGUgPSAoX2h0T3B0aW9uLndpZHRoIC0gZWxUYWJsZS5vZmZzZXRXaWR0aCkgLyAyO1xuICAgICAgdmFyIG5Ub3BNYXJnaW5UYWJsZSA9IChfaHRPcHRpb24uaGVpZ2h0IC0gZWxUYWJsZS5vZmZzZXRIZWlnaHQpIC8gMjtcblxuICAgICAgaWYgKG5MZWZ0TWFyZ2luVGFibGUgPiAwICYmIG5Ub3BNYXJnaW5UYWJsZSA+IDApIHtcbiAgICAgICAgZWxUYWJsZS5zdHlsZS5tYXJnaW4gPSBuVG9wTWFyZ2luVGFibGUgKyBcInB4IFwiICsgbkxlZnRNYXJnaW5UYWJsZSArIFwicHhcIjtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIFFSQ29kZVxuICAgICAqL1xuICAgIERyYXdpbmcucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fZWwuaW5uZXJIVE1MID0gJyc7XG4gICAgfTtcblxuICAgIHJldHVybiBEcmF3aW5nO1xuICB9KSgpIDogKGZ1bmN0aW9uICgpIHsgLy8gRHJhd2luZyBpbiBDYW52YXNcbiAgICBmdW5jdGlvbiBfb25NYWtlSW1hZ2UoKSB7XG5cbiAgICAgIHRoaXMuX2VsQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIC8vIHRoaXMuX2VsSW1hZ2Uuc3JjID0gdGhpcy5fZWxDYW52YXMudG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpO1xuICAgICAgLy8gdGhpcy5fZWxJbWFnZS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgLy8gdGhpcy5fZWxDYW52YXMuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH1cblxuICAgIC8vIEFuZHJvaWQgMi4xIGJ1ZyB3b3JrYXJvdW5kXG4gICAgLy8gaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2FuZHJvaWQvaXNzdWVzL2RldGFpbD9pZD01MTQxXG4gICAgaWYgKHdpbmRvdy5fYW5kcm9pZCAmJiB3aW5kb3cuX2FuZHJvaWQgPD0gMi4xKSB7XG4gICAgICB2YXIgZmFjdG9yID0gMSAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvO1xuICAgICAgdmFyIGRyYXdJbWFnZSA9IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRC5wcm90b3R5cGUuZHJhd0ltYWdlO1xuICAgICAgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELnByb3RvdHlwZS5kcmF3SW1hZ2UgPSBmdW5jdGlvbiAoaW1hZ2UsIHN4LCBzeSwgc3csIHNoLCBkeCwgZHksIGR3LCBkaCkge1xuICAgICAgICBpZiAoKFwibm9kZU5hbWVcIiBpbiBpbWFnZSkgJiYgL2ltZy9pLnRlc3QoaW1hZ2Uubm9kZU5hbWUpKSB7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOyBpID49IDE7IGktLSkge1xuICAgICAgICAgICAgYXJndW1lbnRzW2ldID0gYXJndW1lbnRzW2ldICogZmFjdG9yO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZHcgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgIGFyZ3VtZW50c1sxXSAqPSBmYWN0b3I7XG4gICAgICAgICAgYXJndW1lbnRzWzJdICo9IGZhY3RvcjtcbiAgICAgICAgICBhcmd1bWVudHNbM10gKj0gZmFjdG9yO1xuICAgICAgICAgIGFyZ3VtZW50c1s0XSAqPSBmYWN0b3I7XG4gICAgICAgIH1cblxuICAgICAgICBkcmF3SW1hZ2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgd2hldGhlciB0aGUgdXNlcidzIGJyb3dzZXIgc3VwcG9ydHMgRGF0YSBVUkkgb3Igbm90XG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZTdWNjZXNzIE9jY3VycyBpZiBpdCBzdXBwb3J0cyBEYXRhIFVSSVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGZGYWlsIE9jY3VycyBpZiBpdCBkb2Vzbid0IHN1cHBvcnQgRGF0YSBVUklcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBfc2FmZVNldERhdGFVUkkoZlN1Y2Nlc3MsIGZGYWlsKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBzZWxmLl9mRmFpbCA9IGZGYWlsO1xuICAgICAgc2VsZi5fZlN1Y2Nlc3MgPSBmU3VjY2VzcztcblxuICAgICAgLy8gQ2hlY2sgaXQganVzdCBvbmNlXG4gICAgICBpZiAoc2VsZi5fYlN1cHBvcnREYXRhVVJJID09PSBudWxsKSB7XG4gICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgICAgIHZhciBmT25FcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzZWxmLl9iU3VwcG9ydERhdGFVUkkgPSBmYWxzZTtcblxuICAgICAgICAgIGlmIChzZWxmLl9mRmFpbCkge1xuICAgICAgICAgICAgc2VsZi5fZkZhaWwuY2FsbChzZWxmKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBmT25TdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHNlbGYuX2JTdXBwb3J0RGF0YVVSSSA9IHRydWU7XG5cbiAgICAgICAgICBpZiAoc2VsZi5fZlN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHNlbGYuX2ZTdWNjZXNzLmNhbGwoc2VsZik7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGVsLm9uYWJvcnQgPSBmT25FcnJvcjtcbiAgICAgICAgZWwub25lcnJvciA9IGZPbkVycm9yO1xuICAgICAgICBlbC5vbmxvYWQgPSBmT25TdWNjZXNzO1xuICAgICAgICBlbC5zcmMgPSBcImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQVVBQUFBRkNBWUFBQUNOYnlibEFBQUFIRWxFUVZRSTEyUDQvLzgvdzM4R0lBWERJQktFMERIeGdsak5CQUFPOVRYTDBZNE9Id0FBQUFCSlJVNUVya0pnZ2c9PVwiOyAvLyB0aGUgSW1hZ2UgY29udGFpbnMgMXB4IGRhdGEuXG4gICAgICAgIHJldHVybiBlbDtcbiAgICAgIH0gZWxzZSBpZiAoc2VsZi5fYlN1cHBvcnREYXRhVVJJID09PSB0cnVlICYmIHNlbGYuX2ZTdWNjZXNzKSB7XG4gICAgICAgIHNlbGYuX2ZTdWNjZXNzLmNhbGwoc2VsZik7XG4gICAgICB9IGVsc2UgaWYgKHNlbGYuX2JTdXBwb3J0RGF0YVVSSSA9PT0gZmFsc2UgJiYgc2VsZi5fZkZhaWwpIHtcbiAgICAgICAgc2VsZi5fZkZhaWwuY2FsbChzZWxmKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRHJhd2luZyBRUkNvZGUgYnkgdXNpbmcgY2FudmFzXG4gICAgICpcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gaHRPcHRpb24gUVJDb2RlIE9wdGlvbnNcbiAgICAgKi9cbiAgICB2YXIgRHJhd2luZyA9IGZ1bmN0aW9uIChodE9wdGlvbikge1xuICAgICAgdGhpcy5fYklzUGFpbnRlZCA9IGZhbHNlO1xuICAgICAgd2luZG93Ll9hbmRyb2lkID0gX2dldEFuZHJvaWQoKTtcblxuICAgICAgdGhpcy5faHRPcHRpb24gPSBodE9wdGlvbjtcbiAgICAgIHRoaXMuX2VsQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICAgIHRoaXMuX2VsQ2FudmFzLndpZHRoID0gaHRPcHRpb24ud2lkdGg7XG4gICAgICB0aGlzLl9lbENhbnZhcy5oZWlnaHQgPSBodE9wdGlvbi5oZWlnaHQ7XG4gICAgICB0aGlzLl9vQ29udGV4dCA9IHRoaXMuX2VsQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIHRoaXMuX2JJc1BhaW50ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuX2VsSW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xuICAgICAgdGhpcy5fZWxJbWFnZS5hbHQgPSBcIlNjYW4gbWUhXCI7XG4gICAgICB0aGlzLl9lbEltYWdlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIHRoaXMuX2JTdXBwb3J0RGF0YVVSSSA9IG51bGw7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERyYXcgdGhlIFFSQ29kZVxuICAgICAqXG4gICAgICogQHBhcmFtIHtRUkNvZGV9IG9RUkNvZGVcbiAgICAgKi9cbiAgICBEcmF3aW5nLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKG9RUkNvZGUpIHtcbiAgICAgIHZhciBfZWxJbWFnZSA9IHRoaXMuX2VsSW1hZ2U7XG4gICAgICB2YXIgX29Db250ZXh0ID0gdGhpcy5fb0NvbnRleHQ7XG4gICAgICB2YXIgX2h0T3B0aW9uID0gdGhpcy5faHRPcHRpb247XG5cbiAgICAgIHZhciBuQ291bnQgPSBvUVJDb2RlLmdldE1vZHVsZUNvdW50KCk7XG4gICAgICB2YXIgbldpZHRoID0gX2h0T3B0aW9uLndpZHRoIC8gbkNvdW50O1xuICAgICAgdmFyIG5IZWlnaHQgPSBfaHRPcHRpb24uaGVpZ2h0IC8gbkNvdW50O1xuICAgICAgdmFyIG5Sb3VuZGVkV2lkdGggPSBNYXRoLnJvdW5kKG5XaWR0aCk7XG4gICAgICB2YXIgblJvdW5kZWRIZWlnaHQgPSBNYXRoLnJvdW5kKG5IZWlnaHQpO1xuXG4gICAgICBfZWxJbWFnZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICB0aGlzLmNsZWFyKCk7XG5cbiAgICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IG5Db3VudDsgcm93KyspIHtcbiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgbkNvdW50OyBjb2wrKykge1xuICAgICAgICAgIHZhciBiSXNEYXJrID0gb1FSQ29kZS5pc0Rhcmsocm93LCBjb2wpO1xuICAgICAgICAgIHZhciBuTGVmdCA9IGNvbCAqIG5XaWR0aDtcbiAgICAgICAgICB2YXIgblRvcCA9IHJvdyAqIG5IZWlnaHQ7XG4gICAgICAgICAgX29Db250ZXh0LnN0cm9rZVN0eWxlID0gYklzRGFyayA/IF9odE9wdGlvbi5jb2xvckRhcmsgOiBfaHRPcHRpb24uY29sb3JMaWdodDtcbiAgICAgICAgICBfb0NvbnRleHQubGluZVdpZHRoID0gMTtcbiAgICAgICAgICBfb0NvbnRleHQuZmlsbFN0eWxlID0gYklzRGFyayA/IF9odE9wdGlvbi5jb2xvckRhcmsgOiBfaHRPcHRpb24uY29sb3JMaWdodDtcbiAgICAgICAgICBfb0NvbnRleHQuZmlsbFJlY3QobkxlZnQsIG5Ub3AsIG5XaWR0aCwgbkhlaWdodCk7XG5cbiAgICAgICAgICAvLyDslYjti7Ag7JWo66as7Ja07IuxIOuwqeyngCDsspjrpqxcbiAgICAgICAgICBfb0NvbnRleHQuc3Ryb2tlUmVjdChcbiAgICAgICAgICAgIE1hdGguZmxvb3IobkxlZnQpICsgMC41LFxuICAgICAgICAgICAgTWF0aC5mbG9vcihuVG9wKSArIDAuNSxcbiAgICAgICAgICAgIG5Sb3VuZGVkV2lkdGgsXG4gICAgICAgICAgICBuUm91bmRlZEhlaWdodFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBfb0NvbnRleHQuc3Ryb2tlUmVjdChcbiAgICAgICAgICAgIE1hdGguY2VpbChuTGVmdCkgLSAwLjUsXG4gICAgICAgICAgICBNYXRoLmNlaWwoblRvcCkgLSAwLjUsXG4gICAgICAgICAgICBuUm91bmRlZFdpZHRoLFxuICAgICAgICAgICAgblJvdW5kZWRIZWlnaHRcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2JJc1BhaW50ZWQgPSB0cnVlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBNYWtlIHRoZSBpbWFnZSBmcm9tIENhbnZhcyBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBEYXRhIFVSSS5cbiAgICAgKi9cbiAgICBEcmF3aW5nLnByb3RvdHlwZS5tYWtlSW1hZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5fYklzUGFpbnRlZCkge1xuICAgICAgICBfc2FmZVNldERhdGFVUkkuY2FsbCh0aGlzLCBfb25NYWtlSW1hZ2UpO1xuICAgICAgfVxuICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgaW1nLnNyYyA9IHRoaXMuX2VsQ2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgcmV0dXJuIGltZztcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJuIHdoZXRoZXIgdGhlIFFSQ29kZSBpcyBwYWludGVkIG9yIG5vdFxuICAgICAqXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKi9cbiAgICBEcmF3aW5nLnByb3RvdHlwZS5pc1BhaW50ZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5fYklzUGFpbnRlZDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgdGhlIFFSQ29kZVxuICAgICAqL1xuICAgIERyYXdpbmcucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fb0NvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuX2VsQ2FudmFzLndpZHRoLCB0aGlzLl9lbENhbnZhcy5oZWlnaHQpO1xuICAgICAgdGhpcy5fYklzUGFpbnRlZCA9IGZhbHNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBuTnVtYmVyXG4gICAgICovXG4gICAgRHJhd2luZy5wcm90b3R5cGUucm91bmQgPSBmdW5jdGlvbiAobk51bWJlcikge1xuICAgICAgaWYgKCFuTnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBuTnVtYmVyO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTWF0aC5mbG9vcihuTnVtYmVyICogMTAwMCkgLyAxMDAwO1xuICAgIH07XG5cbiAgICByZXR1cm4gRHJhd2luZztcbiAgfSkoKTtcblxuICAvKipcbiAgICogR2V0IHRoZSB0eXBlIGJ5IHN0cmluZyBsZW5ndGhcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IHNUZXh0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBuQ29ycmVjdExldmVsXG4gICAqIEByZXR1cm4ge051bWJlcn0gdHlwZVxuICAgKi9cbiAgZnVuY3Rpb24gX2dldFR5cGVOdW1iZXIoc1RleHQsIG5Db3JyZWN0TGV2ZWwpIHtcbiAgICB2YXIgblR5cGUgPSAxO1xuICAgIHZhciBsZW5ndGggPSBfZ2V0VVRGOExlbmd0aChzVGV4dCk7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gUVJDb2RlTGltaXRMZW5ndGgubGVuZ3RoOyBpIDw9IGxlbjsgaSsrKSB7XG4gICAgICB2YXIgbkxpbWl0ID0gMDtcblxuICAgICAgc3dpdGNoIChuQ29ycmVjdExldmVsKSB7XG4gICAgICAgIGNhc2UgUVJFcnJvckNvcnJlY3RMZXZlbC5MIDpcbiAgICAgICAgICBuTGltaXQgPSBRUkNvZGVMaW1pdExlbmd0aFtpXVswXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBRUkVycm9yQ29ycmVjdExldmVsLk0gOlxuICAgICAgICAgIG5MaW1pdCA9IFFSQ29kZUxpbWl0TGVuZ3RoW2ldWzFdO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFFSRXJyb3JDb3JyZWN0TGV2ZWwuUSA6XG4gICAgICAgICAgbkxpbWl0ID0gUVJDb2RlTGltaXRMZW5ndGhbaV1bMl07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgUVJFcnJvckNvcnJlY3RMZXZlbC5IIDpcbiAgICAgICAgICBuTGltaXQgPSBRUkNvZGVMaW1pdExlbmd0aFtpXVszXTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgaWYgKGxlbmd0aCA8PSBuTGltaXQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuVHlwZSsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChuVHlwZSA+IFFSQ29kZUxpbWl0TGVuZ3RoLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVG9vIGxvbmcgZGF0YVwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gblR5cGU7XG4gIH1cblxuICBmdW5jdGlvbiBfZ2V0VVRGOExlbmd0aChzVGV4dCkge1xuICAgIHZhciByZXBsYWNlZFRleHQgPSBlbmNvZGVVUkkoc1RleHQpLnRvU3RyaW5nKCkucmVwbGFjZSgvXFwlWzAtOWEtZkEtRl17Mn0vZywgJ2EnKTtcbiAgICByZXR1cm4gcmVwbGFjZWRUZXh0Lmxlbmd0aCArIChyZXBsYWNlZFRleHQubGVuZ3RoICE9IHNUZXh0ID8gMyA6IDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEBjbGFzcyBRUkNvZGVcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBleGFtcGxlXG4gICAqIG5ldyBRUkNvZGUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0ZXN0XCIpLCBcImh0dHA6Ly9qaW5kby5kZXYubmF2ZXIuY29tL2NvbGxpZVwiKTtcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogdmFyIG9RUkNvZGUgPSBuZXcgUVJDb2RlKFwidGVzdFwiLCB7XG5cdCAqICAgIHRleHQgOiBcImh0dHA6Ly9uYXZlci5jb21cIixcblx0ICogICAgd2lkdGggOiAxMjgsXG5cdCAqICAgIGhlaWdodCA6IDEyOFxuXHQgKiB9KTtcbiAgICpcbiAgICogb1FSQ29kZS5jbGVhcigpOyAvLyBDbGVhciB0aGUgUVJDb2RlLlxuICAgKiBvUVJDb2RlLm1ha2VDb2RlKFwiaHR0cDovL21hcC5uYXZlci5jb21cIik7IC8vIFJlLWNyZWF0ZSB0aGUgUVJDb2RlLlxuICAgKlxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fFN0cmluZ30gZWwgdGFyZ2V0IGVsZW1lbnQgb3IgJ2lkJyBhdHRyaWJ1dGUgb2YgZWxlbWVudC5cbiAgICogQHBhcmFtIHtPYmplY3R8U3RyaW5nfSB2T3B0aW9uXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB2T3B0aW9uLnRleHQgUVJDb2RlIGxpbmsgZGF0YVxuICAgKiBAcGFyYW0ge051bWJlcn0gW3ZPcHRpb24ud2lkdGg9MjU2XVxuICAgKiBAcGFyYW0ge051bWJlcn0gW3ZPcHRpb24uaGVpZ2h0PTI1Nl1cbiAgICogQHBhcmFtIHtTdHJpbmd9IFt2T3B0aW9uLmNvbG9yRGFyaz1cIiMwMDAwMDBcIl1cbiAgICogQHBhcmFtIHtTdHJpbmd9IFt2T3B0aW9uLmNvbG9yTGlnaHQ9XCIjZmZmZmZmXCJdXG4gICAqIEBwYXJhbSB7UVJDb2RlLkNvcnJlY3RMZXZlbH0gW3ZPcHRpb24uY29ycmVjdExldmVsPVFSQ29kZS5Db3JyZWN0TGV2ZWwuSF0gW0x8TXxRfEhdXG4gICAqL1xuICBRUkNvZGUgPSBmdW5jdGlvbiAoIHZPcHRpb24pIHtcbiAgICB0aGlzLl9odE9wdGlvbiA9IHtcbiAgICAgIHdpZHRoOiAyNTYsXG4gICAgICBoZWlnaHQ6IDI1NixcbiAgICAgIHR5cGVOdW1iZXI6IDQsXG4gICAgICBjb2xvckRhcms6IFwiIzAwMDAwMFwiLFxuICAgICAgY29sb3JMaWdodDogXCIjZmZmZmZmXCIsXG4gICAgICBjb3JyZWN0TGV2ZWw6IFFSRXJyb3JDb3JyZWN0TGV2ZWwuSFxuICAgIH07XG5cbiAgICBpZiAodHlwZW9mIHZPcHRpb24gPT09ICdzdHJpbmcnKSB7XG4gICAgICB2T3B0aW9uID0ge1xuICAgICAgICB0ZXh0OiB2T3B0aW9uXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIE92ZXJ3cml0ZXMgb3B0aW9uc1xuICAgIGlmICh2T3B0aW9uKSB7XG4gICAgICBmb3IgKHZhciBpIGluIHZPcHRpb24pIHtcbiAgICAgICAgdGhpcy5faHRPcHRpb25baV0gPSB2T3B0aW9uW2ldO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLl9odE9wdGlvbi51c2VTVkcpIHtcbiAgICAgIERyYXdpbmcgPSBzdmdEcmF3ZXI7XG4gICAgfVxuXG4gICAgd2luZG93Ll9hbmRyb2lkID0gX2dldEFuZHJvaWQoKTtcbiAgICB0aGlzLl9vUVJDb2RlID0gbnVsbDtcbiAgICB0aGlzLl9vRHJhd2luZyA9IG5ldyBEcmF3aW5nKHRoaXMuX2h0T3B0aW9uKTtcblxuICAgIGlmICh0aGlzLl9odE9wdGlvbi50ZXh0KSB7XG4gICAgICB0aGlzLm1ha2VDb2RlKHRoaXMuX2h0T3B0aW9uLnRleHQpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogTWFrZSB0aGUgUVJDb2RlXG4gICAqXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBzVGV4dCBsaW5rIGRhdGFcbiAgICovXG4gIFFSQ29kZS5wcm90b3R5cGUubWFrZUNvZGUgPSBmdW5jdGlvbiAoc1RleHQpIHtcbiAgICB0aGlzLl9vUVJDb2RlID0gbmV3IFFSQ29kZU1vZGVsKF9nZXRUeXBlTnVtYmVyKHNUZXh0LCB0aGlzLl9odE9wdGlvbi5jb3JyZWN0TGV2ZWwpLCB0aGlzLl9odE9wdGlvbi5jb3JyZWN0TGV2ZWwpO1xuICAgIHRoaXMuX29RUkNvZGUuYWRkRGF0YShzVGV4dCk7XG4gICAgdGhpcy5fb1FSQ29kZS5tYWtlKCk7XG4gICAgdGhpcy5fb0RyYXdpbmcuZHJhdyh0aGlzLl9vUVJDb2RlKTtcbiAgICByZXR1cm4gdGhpcy5tYWtlSW1hZ2UoKTtcbiAgfTtcblxuICAvKipcbiAgICogTWFrZSB0aGUgSW1hZ2UgZnJvbSBDYW52YXMgZWxlbWVudFxuICAgKiAtIEl0IG9jY3VycyBhdXRvbWF0aWNhbGx5XG4gICAqIC0gQW5kcm9pZCBiZWxvdyAzIGRvZXNuJ3Qgc3VwcG9ydCBEYXRhLVVSSSBzcGVjLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgUVJDb2RlLnByb3RvdHlwZS5tYWtlSW1hZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLl9vRHJhd2luZy5tYWtlSW1hZ2UgPT0gXCJmdW5jdGlvblwiICYmICghd2luZG93Ll9hbmRyb2lkIHx8IHdpbmRvdy5fYW5kcm9pZCA+PSAzKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX29EcmF3aW5nLm1ha2VJbWFnZSgpO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQ2xlYXIgdGhlIFFSQ29kZVxuICAgKi9cbiAgUVJDb2RlLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9vRHJhd2luZy5jbGVhcigpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmFtZSBRUkNvZGUuQ29ycmVjdExldmVsXG4gICAqL1xuICBRUkNvZGUuQ29ycmVjdExldmVsID0gUVJFcnJvckNvcnJlY3RMZXZlbDtcblxuICByZXR1cm4gUVJDb2RlO1xufSkoKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBwbHVnaW5zL3FyY29kZS5qcyIsIlxuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGV4dGJveC5wcm90b3R5cGUsIHtcbiAgICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5UZXh0Ym94LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcIm1heExpbmVzXCIsXCJtYXhXaWR0aFwiLFwiZml4ZWRXaWR0aFwiLFwibWF4SGVpZ2h0XCIsXCJlYXN5RWRpdFwiXSksXG4gICAgbWF4TGluZXM6IDAsXG4gICAgbWF4V2lkdGg6IDAsXG4gICAgZml4ZWRXaWR0aDogZmFsc2UsXG4gICAgbWF4SGVpZ2h0OiAwLFxuICAgIF9sb25nTGluZXM6IFtdLFxuICAgIGVhc3lFZGl0OiBmYWxzZSxcbiAgICBzZXRFYXN5RWRpdDogZnVuY3Rpb24odmFsKXtcbiAgICAgIHRoaXMuZWFzeUVkaXQgPSB2YWw7XG4gICAgICBpZih2YWwpe1xuICAgICAgICB0aGlzLl9lbnRlckVkaXRpbmcgPSB0aGlzLmVudGVyRWRpdGluZy5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm9uKCdzZWxlY3RlZCcsIHRoaXMuX2VudGVyRWRpdGluZyk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5vZmYoJ3NlbGVjdGVkJywgdGhpcy5fZW50ZXJFZGl0aW5nKTtcbiAgICAgICAgZGVsZXRlIHRoaXMuX2VudGVyRWRpdGluZztcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbmRlcjogZnVuY3Rpb24oY3R4KXtcbiAgICAgIGlmKHRoaXMuZGlydHkpe1xuICAgICAgICB0aGlzLl9mb3JjZUNsZWFyQ2FjaGUgPSB0cnVlO1xuICAgICAgICB0aGlzLl90ZXh0TGluZXMgPSB0aGlzLl9zcGxpdFRleHRJbnRvTGluZXMoY3R4KTtcbiAgICAgICAgdGhpcy5fdXBkYXRlVGV4dGFyZWEoKTtcbiAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY2FsbFN1cGVyKFwicmVuZGVyXCIsY3R4KTtcbiAgICB9LFxuICAgIF9nZXROZXdTZWxlY3Rpb25TdGFydEZyb21PZmZzZXQ6IGZ1bmN0aW9uKG1vdXNlT2Zmc2V0LCBwcmV2V2lkdGgsIHdpZHRoLCBpbmRleCwgamxlbikge1xuXG4gICAgICAgIHZhciBkaXN0YW5jZUJ0d0xhc3RDaGFyQW5kQ3Vyc29yID0gbW91c2VPZmZzZXQueCAtIHByZXZXaWR0aCxcbiAgICAgICAgICAgIGRpc3RhbmNlQnR3TmV4dENoYXJBbmRDdXJzb3IgPSB3aWR0aCAtIG1vdXNlT2Zmc2V0LngsXG4gICAgICAgICAgICBvZmZzZXQgPSBkaXN0YW5jZUJ0d05leHRDaGFyQW5kQ3Vyc29yID4gZGlzdGFuY2VCdHdMYXN0Q2hhckFuZEN1cnNvciA/IDAgOiAxLFxuICAgICAgICAgICAgbmV3U2VsZWN0aW9uU3RhcnQgPSBpbmRleCArIG9mZnNldDtcblxuICAgICAgICAvLyBpZiBvYmplY3QgaXMgaG9yaXpvbnRhbGx5IGZsaXBwZWQsIG1pcnJvciBjdXJzb3IgbG9jYXRpb24gZnJvbSB0aGUgZW5kXG4gICAgICAgIGlmICh0aGlzLmZsaXBYKSB7XG4gICAgICAgICAgICBuZXdTZWxlY3Rpb25TdGFydCA9IGpsZW4gLSBuZXdTZWxlY3Rpb25TdGFydDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRoZSBpbmRleCBwYXNzZWQgaW50byB0aGUgZnVuY3Rpb24gaXMgcGFkZGVkIGJ5IHRoZSBhbW91bnQgb2YgbGluZXMgZnJvbSBfdGV4dExpbmVzICh0byBhY2NvdW50IGZvciBcXG4pXG4gICAgICAgIC8vIHdlIG5lZWQgdG8gcmVtb3ZlIHRoaXMgcGFkZGluZywgYW5kIHBhZCBpdCBieSBhY3R1YWwgbGluZXMsIGFuZCAvIG9yIHNwYWNlcyB0aGF0IGFyZSBtZWFudCB0byBiZSB0aGVyZVxuICAgICAgICB2YXIgdG1wICAgICA9IDAsXG4gICAgICAgICAgICByZW1vdmVkID0gMCxcbiAgICAgICAgICAgIF9sb25nID0gMDsgLy9tb2RpZmllZCBAZGVuLnBvbm9tYXJldlxuXG4gICAgICAgIC8vIGFjY291bnQgZm9yIHJlbW92ZWQgY2hhcmFjdGVyc1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX3RleHRMaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdG1wICs9IHRoaXMuX3RleHRMaW5lc1tpXS5sZW5ndGg7XG4gICAgICAgICAgICBpZiAodG1wICsgcmVtb3ZlZCA+PSBuZXdTZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9tb2RpZmllZCBAZGVuLnBvbm9tYXJldlxuICAgICAgICAgICAgaWYodGhpcy5fbG9uZ0xpbmVzW2ldKXtcbiAgICAgICAgICAgICAgICBuZXdTZWxlY3Rpb25TdGFydC0tO1xuICAgICAgICAgICAgICAgIF9sb25nKys7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnRleHRbdG1wICsgcmVtb3ZlZF0gPT09ICdcXG4nIHx8IHRoaXMudGV4dFt0bXAgKyByZW1vdmVkXSA9PT0gJyAnKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlZCsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG5ld1NlbGVjdGlvblN0YXJ0ID4gdGhpcy50ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgbmV3U2VsZWN0aW9uU3RhcnQgPSB0aGlzLnRleHQubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIC8vbW9kaWZpZWQgQGRlbi5wb25vbWFyZXZcbiAgICAgICAgcmV0dXJuIG5ld1NlbGVjdGlvblN0YXJ0IC0gaSArIHJlbW92ZWQgKyBfbG9uZztcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFdyYXBzIGEgbGluZSBvZiB0ZXh0IHVzaW5nIHRoZSB3aWR0aCBvZiB0aGUgVGV4dGJveCBhbmQgYSBjb250ZXh0LlxuICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byB1c2UgZm9yIG1lYXN1cmVtZW50c1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSBzdHJpbmcgb2YgdGV4dCB0byBzcGxpdCBpbnRvIGxpbmVzXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGxpbmVJbmRleFxuICAgICAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgb2YgbGluZShzKSBpbnRvIHdoaWNoIHRoZSBnaXZlbiB0ZXh0IGlzIHdyYXBwZWRcbiAgICAgKiB0by5cbiAgICAgKi9cbiAgICBfd3JhcExpbmU6IGZ1bmN0aW9uKGN0eCwgdGV4dCwgbGluZUluZGV4KSB7XG4gICAgICAgIHZhciBsaW5lV2lkdGggICAgICAgID0gMCxcbiAgICAgICAgICAgIGxpbmVzICAgICAgICAgICAgPSBbXSxcbiAgICAgICAgICAgIGxpbmUgICAgICAgICAgICAgPSAnJyxcbiAgICAgICAgICAgIHdvcmRzICAgICAgICAgICAgPSB0ZXh0LnNwbGl0KCcgJyksXG4gICAgICAgICAgICB3b3JkICAgICAgICAgICAgID0gJycsXG4gICAgICAgICAgICBvZmZzZXQgICAgICAgICAgID0gMCxcbiAgICAgICAgICAgIGluZml4ICAgICAgICAgICAgPSAnICcsXG4gICAgICAgICAgICB3b3JkV2lkdGggICAgICAgID0gMCxcbiAgICAgICAgICAgIGluZml4V2lkdGggICAgICAgPSAwLFxuICAgICAgICAgICAgbGFyZ2VzdFdvcmRXaWR0aCA9IDAsXG4gICAgICAgICAgICBsaW5lSnVzdFN0YXJ0ZWQgPSB0cnVlLFxuICAgICAgICAgICAgYWRkaXRpb25hbFNwYWNlID0gdGhpcy5fZ2V0V2lkdGhPZkNoYXJTcGFjaW5nKCk7XG5cblxuICAgICAgICB0aGlzLl9sb25nTGluZXMgPSBbXTtcbiAgICAgICAgdmFyIF9tYXhXaWR0aCA9IHRoaXMubWF4V2lkdGggfHwgdGhpcy5maXhlZFdpZHRoICYmIHRoaXMud2lkdGg7XG4gICAgICAgIHZhciBpc0xvbmdXb3JkID0gZmFsc2U7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHdvcmQgPSB3b3Jkc1tpXTtcbiAgICAgICAgICAgIHdvcmRXaWR0aCA9IHRoaXMuX21lYXN1cmVUZXh0KGN0eCwgd29yZCwgbGluZUluZGV4LCBvZmZzZXQpO1xuXG5cblxuICAgICAgICAgICAgdmFyIF9pc0xvbmcgPSBfbWF4V2lkdGggICYmIHdvcmRXaWR0aCA+IF9tYXhXaWR0aDtcbiAgICAgICAgICAgIGlmKF9pc0xvbmcpe1xuICAgICAgICAgICAgICAgIGlmKGxpbmUgIT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluZXMucHVzaChsaW5lKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9uZ0xpbmVzLnB1c2goaXNMb25nV29yZCk7XG4gICAgICAgICAgICAgICAgICAgIGlzTG9uZ1dvcmQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgbGluZSA9ICcnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBfYmlnV29yZFdpZHRoID0gMDsvLyBsaW5lV2lkdGggKyBpbmZpeFdpZHRoO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwLCBsZW4gPSB3b3JkLmxlbmd0aDsgayA8IGxlbiAgJiYgX2JpZ1dvcmRXaWR0aCA8IF9tYXhXaWR0aCAtIDEwOyBrKyspIHtcbiAgICAgICAgICAgICAgICAgICAgX2JpZ1dvcmRXaWR0aCArPSB0aGlzLl9nZXRXaWR0aE9mQ2hhcihjdHgsIHdvcmRba10sIGxpbmVJbmRleCwgayArIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBuZXdfd29yZCA9d29yZC5zdWJzdHJpbmcoMCxrIC0gMSk7XG4gICAgICAgICAgICAgICAgaXNMb25nV29yZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICB3b3Jkcy5zcGxpY2UoaSwxLG5ld193b3JkLCB3b3JkLnN1YnN0cihrIC0gMSkpO1xuICAgICAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgICAgICAvLyBsaW5lID0nJztcbiAgICAgICAgICAgICAgICBsaW5lSnVzdFN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGluZVdpZHRoICs9IGluZml4V2lkdGggKyB3b3JkV2lkdGggLSBhZGRpdGlvbmFsU3BhY2U7XG5cbiAgICAgICAgICAgIGlmIChsaW5lV2lkdGggPj0gdGhpcy53aWR0aCl7XG4gICAgICAgICAgICAgICAgaWYoIWxpbmVKdXN0U3RhcnRlZCl7XG4gICAgICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gobGluZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xvbmdMaW5lcy5wdXNoKGlzTG9uZ1dvcmQpO1xuICAgICAgICAgICAgICAgICAgICBpc0xvbmdXb3JkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGxpbmUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgbGluZVdpZHRoID0gd29yZFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICBsaW5lSnVzdFN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgbGluZVdpZHRoICs9IGFkZGl0aW9uYWxTcGFjZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9mZnNldCArPSB3b3JkLmxlbmd0aDtcblxuICAgICAgICAgICAgaWYgKCFsaW5lSnVzdFN0YXJ0ZWQpIHtcbiAgICAgICAgICAgICAgICBsaW5lICs9IGluZml4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGluZSArPSB3b3JkO1xuXG4gICAgICAgICAgICBpbmZpeFdpZHRoID0gdGhpcy5fbWVhc3VyZVRleHQoY3R4LCBpbmZpeCwgbGluZUluZGV4LCBvZmZzZXQpO1xuICAgICAgICAgICAgb2Zmc2V0Kys7XG5cbiAgICAgICAgICAgIC8vIGtlZXAgdHJhY2sgb2YgbGFyZ2VzdCB3b3JkXG4gICAgICAgICAgICBpZiAod29yZFdpZHRoID4gbGFyZ2VzdFdvcmRXaWR0aCkge1xuICAgICAgICAgICAgICAgIGxhcmdlc3RXb3JkV2lkdGggPSB3b3JkV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaW5lSnVzdFN0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGkgJiYgbGluZXMucHVzaChsaW5lKTtcbiAgICAgICAgdGhpcy5fbG9uZ0xpbmVzLnB1c2goZmFsc2UpO1xuXG4gICAgICAgIGlmIChsYXJnZXN0V29yZFdpZHRoID4gdGhpcy5keW5hbWljTWluV2lkdGgpIHtcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY01pbldpZHRoID0gbGFyZ2VzdFdvcmRXaWR0aCAtIGFkZGl0aW9uYWxTcGFjZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGluZXM7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciBvblxuICAgICAqL1xuICAgIF9yZW5kZXJUZXh0OiBmdW5jdGlvbihjdHgpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyVGV4dEZpbGwoY3R4KTtcbiAgICAgICAgdGhpcy5fcmVuZGVyVGV4dFN0cm9rZShjdHgpO1xuICAgICAgICB0aGlzLl9yZW5kZXJUZXh0T3ZlcnNpemUoY3R4KTtcbiAgICB9LFxuICAgIF9yZW5kZXJUZXh0T3ZlcnNpemU6IGZ1bmN0aW9uKGN0eCl7XG5cbiAgICAgICAgdmFyIGxpbmVIZWlnaHQgPSAwO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5fdGV4dExpbmVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG5cbiAgICAgICAgICAgIHZhciBsaW5lV2lkdGggPSB0aGlzLl9nZXRMaW5lV2lkdGgoY3R4LCBpKTtcbiAgICAgICAgICAgIHZhciBsaW5lTGVmdE9mZnNldCA9IHRoaXMuX2dldExpbmVMZWZ0T2Zmc2V0KGxpbmVXaWR0aCk7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0T2ZMaW5lID0gdGhpcy5fZ2V0SGVpZ2h0T2ZMaW5lKGN0eCwgaSk7XG5cbiAgICAgICAgICAgIGlmKHRoaXMuX2xvbmdMaW5lc1tpXSl7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHRoaXMuX2dldExlZnRPZmZzZXQoKSArIGxpbmVMZWZ0T2Zmc2V0ICsgbGluZVdpZHRoICsgMiwgdGhpcy5fZ2V0VG9wT2Zmc2V0KCkgKyBsaW5lSGVpZ2h0ICsgaGVpZ2h0T2ZMaW5lLzIgLSAxLCA1LCB0aGlzLmZvbnRTaXplIC8gMTUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaW5lSGVpZ2h0ICs9IGhlaWdodE9mTGluZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBpbnNlcnRDaGFyOiBmdW5jdGlvbihfY2hhciwgc2tpcFVwZGF0ZSwgc3R5bGVPYmplY3QpIHtcbiAgICAgICAgdmFyIGlzRW5kT2ZMaW5lID0gdGhpcy50ZXh0W3RoaXMuc2VsZWN0aW9uU3RhcnRdID09PSAnXFxuJztcblxuICAgICAgICB2YXIgX29sZF90ZXh0ID0gdGhpcy50ZXh0O1xuICAgICAgICB2YXIgX29sZF90ZXh0TGluZXMgPSB0aGlzLl90ZXh0TGluZXM7XG4gICAgICAgIHZhciBfb2xkX3N0eWxlTWFwID0gdGhpcy5fc3R5bGVNYXA7XG4gICAgICAgIHRoaXMudGV4dCA9IHRoaXMudGV4dC5zbGljZSgwLCB0aGlzLnNlbGVjdGlvblN0YXJ0KSArXG4gICAgICAgICAgICBfY2hhciArIHRoaXMudGV4dC5zbGljZSh0aGlzLnNlbGVjdGlvbkVuZCk7XG4gICAgICAgIHRoaXMuX3RleHRMaW5lcyA9IHRoaXMuX3NwbGl0VGV4dEludG9MaW5lcygpO1xuICAgICAgICB0aGlzLmluc2VydFN0eWxlT2JqZWN0cyhfY2hhciwgaXNFbmRPZkxpbmUsIHN0eWxlT2JqZWN0KTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydCArPSBfY2hhci5sZW5ndGg7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcblxuICAgICAgICB2YXIgb3ZlcnNpemUgPSBmYWxzZTtcbiAgICAgICAgaWYoIHRoaXMubWF4SGVpZ2h0ICl7XG4gICAgICAgICAgICB2YXIgX2ggPSAwO1xuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuX3RleHRMaW5lcy5sZW5ndGg7IGkrKyApe1xuICAgICAgICAgICAgICAgIF9oICs9IHRoaXMuX2dldEhlaWdodE9mTGluZSggdGhpcy5jdHgsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIF9oID4gdGhpcy5tYXhIZWlnaHQpe1xuICAgICAgICAgICAgICAgIG92ZXJzaXplID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIHRoaXMubWF4TGluZXMgJiYgdGhpcy5fdGV4dExpbmVzLmxlbmd0aCA+IHRoaXMubWF4TGluZXMpe1xuICAgICAgICAgICAgb3ZlcnNpemUgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYob3ZlcnNpemUpe1xuICAgICAgICAgICAgdGhpcy50ZXh0ID0gX29sZF90ZXh0O1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydCAtPSBfY2hhci5sZW5ndGg7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbkVuZCA9IHRoaXMuc2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgICAgICB0aGlzLl90ZXh0TGluZXMgPSB0aGlzLl9zcGxpdFRleHRJbnRvTGluZXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChza2lwVXBkYXRlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl91cGRhdGVUZXh0YXJlYSgpO1xuICAgICAgICB0aGlzLnNldENvb3JkcygpO1xuICAgICAgICB0aGlzLl9maXJlU2VsZWN0aW9uQ2hhbmdlZCgpO1xuICAgICAgICB0aGlzLmZpcmUoJ2NoYW5nZWQnKTtcbiAgICAgICAgdGhpcy5yZXN0YXJ0Q3Vyc29ySWZOZWVkZWQoKTtcbiAgICAgICAgaWYgKHRoaXMuY2FudmFzKSB7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlKCd0ZXh0OmNoYW5nZWQnLCB7IHRhcmdldDogdGhpcyB9KTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy90ZXh0Ym94Lm1heExpbmVzLmpzIiwiXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcblxuICBfc2hvd01haW5Mb2FkZXJJbmRpY2F0b3I6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIGNhbnZhcyA9IGUudGFyZ2V0O1xuICAgIGNhbnZhcy5sb2FkZXJFbGVtZW50ID0gJCh0aGlzLmxvYWRlci50ZW1wbGF0ZSk7XG4gICAgJChjYW52YXMud3JhcHBlckVsKS5hcHBlbmQoY2FudmFzLmxvYWRlckVsZW1lbnQpLmFkZENsYXNzKFwibG9hZGluZ1wiKTtcbiAgfSxcbiAgX2hpZGVNYWluTG9hZGVySW5kaWNhdG9yOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBjYW52YXMgPSBlLnRhcmdldDtcbiAgICBjYW52YXMubG9hZGVyRWxlbWVudC5yZW1vdmUoKTtcbiAgICAkKGNhbnZhcy53cmFwcGVyRWwpLnJlbW92ZUNsYXNzKFwibG9hZGluZ1wiKTtcbiAgfSxcbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLCB7XG4gIHBlbmRpbmc6IGZhbHNlLFxuICBzZXRQZW5kaW5nOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMucGVuZGluZyA9IHZhbDtcbiAgICBpZih2YWwpe1xuICAgICAgaWYodGhpcy5jYW52YXMpe1xuICAgICAgICB0aGlzLmNhbnZhcy5pbnRlcmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5zbGlkZXMpe1xuICAgICAgICBmb3IobGV0IHNsaWRlIG9mIHRoaXMuc2xpZGVzKXtcbiAgICAgICAgICBzbGlkZS5pbnRlcmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBsb2FkZXI6IHtcbiAgICBjb250YWluZXI6IFwiXCIsXG4gICAgdGVtcGxhdGU6IFwiPGRpdiBjbGFzcz0nY2FudmFzLWxvYWRlcic+PHNwYW4gY2xhc3M9J2xvYWRlci1zcGlubmVyIGZhIGZhLXB1bHNlIGZhLXNwaW5uZXIgY2FudmFzLWxvYWQtc3Bpbm5lcic+PC9zcGFuPjxzcGFuIGNsYXNzPSdsb2FkZXItbWVzc2FnZSc+TG9hZGluZy4uLjwvc3Bhbj48L2Rpdj5cIixcbiAgICBpY29uOiAgICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcgKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vLi4vbWVkaWEvbG9hZGVyLnN2ZycpLFxuICB9LFxuICBfc2hvd01haW5Mb2FkZXJJbmRpY2F0b3I6IGZ1bmN0aW9uIChlKSB7XG4gICAgJCh0aGlzLmNhbnZhc0NvbnRhaW5lcikuYXBwZW5kKHRoaXMuX2xvYWRlckVsZW1lbnQpLmFkZENsYXNzKFwibG9hZGluZ1wiKTtcbiAgfSxcbiAgX2hpZGVNYWluTG9hZGVySW5kaWNhdG9yOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmKHRoaXMucGVuZGluZyl7XG4gICAgICB0aGlzLnBlbmRpbmcgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fbG9hZGVyRWxlbWVudC5yZW1vdmUoKTtcbiAgICAkKHRoaXMuY2FudmFzQ29udGFpbmVyKS5yZW1vdmVDbGFzcyhcImxvYWRpbmdcIik7XG4gIH0sXG4gIHNldExvYWRlcjogZnVuY3Rpb24gKHZhbCkge1xuICAgIGlmKCF2YWwpcmV0dXJuO1xuICAgIGlmKHZhbC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIHZhbCA9IHtcbiAgICAgICAgaWQ6IHZhbFxuICAgICAgfVxuICAgIH1cbiAgICBpZih2YWwuaWQpe1xuICAgICAgdGhpcy5fbG9hZGVyRWxlbWVudCA9ICQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodmFsLmlkKSk7XG4gICAgfVxuICAgIGlmKHZhbC50ZW1wbGF0ZSl7XG4gICAgICB0aGlzLmxvYWRlci50ZW1wbGF0ZSA9IHZhbC50ZW1wbGF0ZS5yZXBsYWNlKFwie2xvYWRlckljb259XCIsdGhpcy5sb2FkZXIuaWNvbik7XG4gICAgICB0aGlzLl9sb2FkZXJFbGVtZW50ID0gJCh0aGlzLmxvYWRlci50ZW1wbGF0ZSk7XG4gICAgfVxuICAgIGlmKHZhbCkge1xuICAgICAgLy8gdGhpcy5sb2FkZXIuY29udGFpbmVyID0gJCh2YWwuY29udGFpbmVyKTtcbiAgICAgIC8vIHRoaXMubG9hZGVyLmVsZW1lbnQgPSAkKHZhbC50ZW1wbGF0ZSkuaGlkZSgpO1xuICAgICAgLy8gdGhpcy5vbihcImxvYWRpbmc6YmVnaW5cIiwgdGhpcy5fc2hvd01haW5Mb2FkZXJJbmRpY2F0b3IpO1xuICAgICAgLy8gdGhpcy5vbihcImxvYWRpbmc6ZW5kXCIsIHRoaXMuX2hpZGVNYWluTG9hZGVySW5kaWNhdG9yKTtcbiAgICAgIGlmKHRoaXMuX2xvYWRpbmcpe1xuICAgICAgICB0aGlzLl9zaG93TWFpbkxvYWRlckluZGljYXRvcigpXG4gICAgICB9XG4gICAgICBpZih2YWwucGVuZGluZyl7XG4gICAgICAgIHRoaXMuX3Nob3dNYWluTG9hZGVySW5kaWNhdG9yKClcbiAgICAgIH1cbiAgICAgIHRoaXMub24oXCJsb2FkaW5nOmJlZ2luXCIsIHRoaXMuX3Nob3dNYWluTG9hZGVySW5kaWNhdG9yLmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5vbihcImxvYWRpbmc6ZW5kXCIsIHRoaXMuX2hpZGVNYWluTG9hZGVySW5kaWNhdG9yLmJpbmQodGhpcykpO1xuICAgICAgLy8gdGhpcy5vbihcInNsaWRlOmxvYWRpbmc6YmVnaW5cIiwgdGhpcy5fc2hvd01haW5Mb2FkZXJJbmRpY2F0b3IuYmluZCh0aGlzKSk7XG4gICAgICAvLyB0aGlzLm9uKFwic2xpZGU6bG9hZGluZzplbmRcIiwgdGhpcy5faGlkZU1haW5Mb2FkZXJJbmRpY2F0b3IuYmluZCh0aGlzKSk7XG5cblxuICAgIH1cbiAgfVxufSk7XG5cblxuLy8gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuLy8gICAvLyBsb2FkZXJUZW1wbGF0ZTogXCI8c3BhbiBjbGFzcz0nZmEgZmEtcHVsc2UgZmEtc3Bpbm5lciBjYW52YXMtbG9hZC1zcGlubmVyJz48L3NwYW4+XCIsXG4vLyAgIHNldExvYWRlclRlbXBsYXRlOiBmdW5jdGlvbiAodmFsKSB7XG4vLyAgICAgaWYodGhpcy52aXJ0dWFsKSByZXR1cm4gZmFsc2U7XG4vLyAgICAgdGhpcy5sb2FkZXJUZW1wbGF0ZSA9IHZhbDtcbi8vICAgICBpZih2YWwpIHtcbi8vICAgICAgIHRoaXMubG9hZGVyRWwgPSAkKHRoaXMubG9hZGVyVGVtcGxhdGUpLmhpZGUoKTtcbi8vICAgICAgICQodGhpcy53cmFwcGVyRWwpLmFwcGVuZCh0aGlzLmxvYWRlckVsKTtcbi8vICAgICAgIHRoaXMub24oXCJsb2FkaW5nOmJlZ2luXCIsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgdGhpcy5sb2FkZXJFbC5zaG93KCk7XG4vLyAgICAgICAgICQodGhpcy53cmFwcGVyRWwpLmFkZENsYXNzKFwibG9hZGluZ1wiKTtcbi8vICAgICAgIH0pO1xuLy8gICAgICAgdGhpcy5vbihcImxvYWRpbmc6ZW5kXCIsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgdGhpcy5sb2FkZXJFbC5oaWRlKCk7XG4vLyAgICAgICAgICQodGhpcy53cmFwcGVyRWwpLnJlbW92ZUNsYXNzKFwibG9hZGluZ1wiKTtcbi8vICAgICAgIH0pO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gfSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvbG9hZGVyLmpzIiwibW9kdWxlLmV4cG9ydHMgPSBcIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NDhjM1puSUhkcFpIUm9QU2N4T0Rod2VDY2dhR1ZwWjJoMFBTY3hPRGh3ZUNjZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWlCMmFXVjNRbTk0UFNJd0lEQWdNVEF3SURFd01DSWdjSEpsYzJWeWRtVkJjM0JsWTNSU1lYUnBiejBpZUUxcFpGbE5hV1FpSUdOc1lYTnpQU0oxYVd3dGMzQnBiaUkrUEhKbFkzUWdlRDBpTUNJZ2VUMGlNQ0lnZDJsa2RHZzlJakV3TUNJZ2FHVnBaMmgwUFNJeE1EQWlJR1pwYkd3OUltNXZibVVpSUdOc1lYTnpQU0ppYXlJK1BDOXlaV04wUGp4bklIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLRFV3SURVd0tTSStQR2NnZEhKaGJuTm1iM0p0UFNKeWIzUmhkR1VvTUNrZ2RISmhibk5zWVhSbEtETTBJREFwSWo0OFkybHlZMnhsSUdONFBTSXdJaUJqZVQwaU1DSWdjajBpT0NJZ1ptbHNiRDBpSTJObVptWmtaaUkrUEdGdWFXMWhkR1VnWVhSMGNtbGlkWFJsVG1GdFpUMGliM0JoWTJsMGVTSWdabkp2YlQwaU1TSWdkRzg5SWpBdU1TSWdZbVZuYVc0OUlqQnpJaUJrZFhJOUlqRnpJaUJ5WlhCbFlYUkRiM1Z1ZEQwaWFXNWtaV1pwYm1sMFpTSStQQzloYm1sdFlYUmxQanhoYm1sdFlYUmxWSEpoYm5ObWIzSnRJR0YwZEhKcFluVjBaVTVoYldVOUluUnlZVzV6Wm05eWJTSWdkSGx3WlQwaWMyTmhiR1VpSUdaeWIyMDlJakV1TlNJZ2RHODlJakVpSUdKbFoybHVQU0l3Y3lJZ1pIVnlQU0l4Y3lJZ2NtVndaV0YwUTI5MWJuUTlJbWx1WkdWbWFXNXBkR1VpUGp3dllXNXBiV0YwWlZSeVlXNXpabTl5YlQ0OEwyTnBjbU5zWlQ0OEwyYytQR2NnZEhKaGJuTm1iM0p0UFNKeWIzUmhkR1VvTkRVcElIUnlZVzV6YkdGMFpTZ3pOQ0F3S1NJK1BHTnBjbU5zWlNCamVEMGlNQ0lnWTNrOUlqQWlJSEk5SWpnaUlHWnBiR3c5SWlOalptWm1aR1lpUGp4aGJtbHRZWFJsSUdGMGRISnBZblYwWlU1aGJXVTlJbTl3WVdOcGRIa2lJR1p5YjIwOUlqRWlJSFJ2UFNJd0xqRWlJR0psWjJsdVBTSXdMakV5Y3lJZ1pIVnlQU0l4Y3lJZ2NtVndaV0YwUTI5MWJuUTlJbWx1WkdWbWFXNXBkR1VpUGp3dllXNXBiV0YwWlQ0OFlXNXBiV0YwWlZSeVlXNXpabTl5YlNCaGRIUnlhV0oxZEdWT1lXMWxQU0owY21GdWMyWnZjbTBpSUhSNWNHVTlJbk5qWVd4bElpQm1jbTl0UFNJeExqVWlJSFJ2UFNJeElpQmlaV2RwYmowaU1DNHhNbk1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1ZVY21GdWMyWnZjbTArUEM5amFYSmpiR1UrUEM5blBqeG5JSFJ5WVc1elptOXliVDBpY205MFlYUmxLRGt3S1NCMGNtRnVjMnhoZEdVb016UWdNQ2tpUGp4amFYSmpiR1VnWTNnOUlqQWlJR041UFNJd0lpQnlQU0k0SWlCbWFXeHNQU0lqWTJabVptUm1JajQ4WVc1cGJXRjBaU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSnZjR0ZqYVhSNUlpQm1jbTl0UFNJeElpQjBiejBpTUM0eElpQmlaV2RwYmowaU1DNHlOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1UrUEdGdWFXMWhkR1ZVY21GdWMyWnZjbTBnWVhSMGNtbGlkWFJsVG1GdFpUMGlkSEpoYm5ObWIzSnRJaUIwZVhCbFBTSnpZMkZzWlNJZ1puSnZiVDBpTVM0MUlpQjBiejBpTVNJZ1ltVm5hVzQ5SWpBdU1qVnpJaUJrZFhJOUlqRnpJaUJ5WlhCbFlYUkRiM1Z1ZEQwaWFXNWtaV1pwYm1sMFpTSStQQzloYm1sdFlYUmxWSEpoYm5ObWIzSnRQand2WTJseVkyeGxQand2Wno0OFp5QjBjbUZ1YzJadmNtMDlJbkp2ZEdGMFpTZ3hNelVwSUhSeVlXNXpiR0YwWlNnek5DQXdLU0krUEdOcGNtTnNaU0JqZUQwaU1DSWdZM2s5SWpBaUlISTlJamdpSUdacGJHdzlJaU5qWm1abVpHWWlQanhoYm1sdFlYUmxJR0YwZEhKcFluVjBaVTVoYldVOUltOXdZV05wZEhraUlHWnliMjA5SWpFaUlIUnZQU0l3TGpFaUlHSmxaMmx1UFNJd0xqTTNjeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVDQ4WVc1cGJXRjBaVlJ5WVc1elptOXliU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSjBjbUZ1YzJadmNtMGlJSFI1Y0dVOUluTmpZV3hsSWlCbWNtOXRQU0l4TGpVaUlIUnZQU0l4SWlCaVpXZHBiajBpTUM0ek4zTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp4bklIUnlZVzV6Wm05eWJUMGljbTkwWVhSbEtERTRNQ2tnZEhKaGJuTnNZWFJsS0RNMElEQXBJajQ4WTJseVkyeGxJR040UFNJd0lpQmplVDBpTUNJZ2NqMGlPQ0lnWm1sc2JEMGlJMk5tWm1aa1ppSStQR0Z1YVcxaGRHVWdZWFIwY21saWRYUmxUbUZ0WlQwaWIzQmhZMmwwZVNJZ1puSnZiVDBpTVNJZ2RHODlJakF1TVNJZ1ltVm5hVzQ5SWpBdU5YTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVStQR0Z1YVcxaGRHVlVjbUZ1YzJadmNtMGdZWFIwY21saWRYUmxUbUZ0WlQwaWRISmhibk5tYjNKdElpQjBlWEJsUFNKelkyRnNaU0lnWm5KdmJUMGlNUzQxSWlCMGJ6MGlNU0lnWW1WbmFXNDlJakF1TlhNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdWVWNtRnVjMlp2Y20wK1BDOWphWEpqYkdVK1BDOW5QanhuSUhSeVlXNXpabTl5YlQwaWNtOTBZWFJsS0RJeU5Ta2dkSEpoYm5Oc1lYUmxLRE0wSURBcElqNDhZMmx5WTJ4bElHTjRQU0l3SWlCamVUMGlNQ0lnY2owaU9DSWdabWxzYkQwaUkyTm1abVprWmlJK1BHRnVhVzFoZEdVZ1lYUjBjbWxpZFhSbFRtRnRaVDBpYjNCaFkybDBlU0lnWm5KdmJUMGlNU0lnZEc4OUlqQXVNU0lnWW1WbmFXNDlJakF1TmpKeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFBqeGhibWx0WVhSbFZISmhibk5tYjNKdElHRjBkSEpwWW5WMFpVNWhiV1U5SW5SeVlXNXpabTl5YlNJZ2RIbHdaVDBpYzJOaGJHVWlJR1p5YjIwOUlqRXVOU0lnZEc4OUlqRWlJR0psWjJsdVBTSXdMall5Y3lJZ1pIVnlQU0l4Y3lJZ2NtVndaV0YwUTI5MWJuUTlJbWx1WkdWbWFXNXBkR1VpUGp3dllXNXBiV0YwWlZSeVlXNXpabTl5YlQ0OEwyTnBjbU5zWlQ0OEwyYytQR2NnZEhKaGJuTm1iM0p0UFNKeWIzUmhkR1VvTWpjd0tTQjBjbUZ1YzJ4aGRHVW9NelFnTUNraVBqeGphWEpqYkdVZ1kzZzlJakFpSUdONVBTSXdJaUJ5UFNJNElpQm1hV3hzUFNJalkyWm1abVJtSWo0OFlXNXBiV0YwWlNCaGRIUnlhV0oxZEdWT1lXMWxQU0p2Y0dGamFYUjVJaUJtY205dFBTSXhJaUIwYnowaU1DNHhJaUJpWldkcGJqMGlNQzQzTlhNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdVK1BHRnVhVzFoZEdWVWNtRnVjMlp2Y20wZ1lYUjBjbWxpZFhSbFRtRnRaVDBpZEhKaGJuTm1iM0p0SWlCMGVYQmxQU0p6WTJGc1pTSWdabkp2YlQwaU1TNDFJaUIwYnowaU1TSWdZbVZuYVc0OUlqQXVOelZ6SWlCa2RYSTlJakZ6SWlCeVpYQmxZWFJEYjNWdWREMGlhVzVrWldacGJtbDBaU0krUEM5aGJtbHRZWFJsVkhKaGJuTm1iM0p0UGp3dlkybHlZMnhsUGp3dlp6NDhaeUIwY21GdWMyWnZjbTA5SW5KdmRHRjBaU2d6TVRVcElIUnlZVzV6YkdGMFpTZ3pOQ0F3S1NJK1BHTnBjbU5zWlNCamVEMGlNQ0lnWTNrOUlqQWlJSEk5SWpnaUlHWnBiR3c5SWlOalptWm1aR1lpUGp4aGJtbHRZWFJsSUdGMGRISnBZblYwWlU1aGJXVTlJbTl3WVdOcGRIa2lJR1p5YjIwOUlqRWlJSFJ2UFNJd0xqRWlJR0psWjJsdVBTSXdMamczY3lJZ1pIVnlQU0l4Y3lJZ2NtVndaV0YwUTI5MWJuUTlJbWx1WkdWbWFXNXBkR1VpUGp3dllXNXBiV0YwWlQ0OFlXNXBiV0YwWlZSeVlXNXpabTl5YlNCaGRIUnlhV0oxZEdWT1lXMWxQU0owY21GdWMyWnZjbTBpSUhSNWNHVTlJbk5qWVd4bElpQm1jbTl0UFNJeExqVWlJSFJ2UFNJeElpQmlaV2RwYmowaU1DNDROM01pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1ZVY21GdWMyWnZjbTArUEM5amFYSmpiR1UrUEM5blBqd3ZaejQ4TDNOMlp6ND1cIlxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL25vZGVfbW9kdWxlcy9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvbG9hZGVyLnN2Z1xuLy8gbW9kdWxlIGlkID0gNjRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG4vL2lmICggZmFicmljLmlzTGlrZWx5Tm9kZSApe1xuLy8gICAgLy9mYWJyaWMud2ViRm9udHNMb2FkZXIgPSByZXF1aXJlKFwid2ViZm9udGxvYWRlclwiKTtcbi8vfSBlbHNlIHtcbiAgICBmYWJyaWMud2ViRm9udHNMb2FkZXIgPSByZXF1aXJlKFwiLi8uLi8uLi9wbHVnaW5zL3dlYmZvbnQuanNcIik7XG4vL31cblxuXG4vLyBpZih0eXBlb2YgV2ViRm9udCA9PSBcInVuZGVmaW5lZFwiKXtcbi8vICAgZmFicmljLndlYkZvbnRzTG9hZGVyID0gcmVxdWlyZShcIi4vLi4vLi4vcGx1Z2lucy93ZWJmb250LmpzXCIpO1xuLy8gfSBlbHNlIHtcbi8vICAgZmFicmljLndlYkZvbnRzTG9hZGVyID0gV2ViRm9udDtcbi8vIH1cblxuLy/QuNC90YLQtdGA0LXRgdC90LDRjyDQsdC40LHQu9C40L7RgtC10LrQsFxuLy8gaHR0cDovL29wZW50eXBlLmpzLm9yZy9pbmRleC5odG1sXG4vL3RvZG8gYWRkIHN0ZXBcbi8vXG4vLyBmYWJyaWMuRWRpdG9yLnByb3RvdHlwZS5zdGVwcy5zcGxpY2UoMywwLFwibG9hZFdlYmZvbnRzXCIpO1xuXG5mYWJyaWMubG9hZEZvbnRzID0gZnVuY3Rpb24ob3B0aW9ucyl7XG5cbiAgdGhpcy53ZWJGb250c1N0YXR1cyA9IFwibG9hZGluZ1wiO1xuICB2YXIgb3B0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgIGFjdGl2ZTogKCkgPT4ge1xuICAgICAgaWYgKHRoaXMud2FpdEZvcldlYmZvbnRzKSB7XG4gICAgICAgIGZhYnJpYy51dGlsLmZvbnRzLndhaXRGb3Iob3B0aW9ucy5nb29nbGUuZmFtaWxpZXMuY29uY2F0KG9wdGlvbnMuY3VzdG9tLmZhbWlsaWVzKSwgKCkgPT4ge1xuICAgICAgICAgIHRoaXMud2ViRm9udHNTdGF0dXMgPSBcInJlYWR5XCI7XG4gICAgICAgICAgdGhpcy5maXJlKFwiZm9udHM6bG9hZGVkXCIpO1xuICAgICAgICB9KVxuICAgICAgfWVsc2V7XG5cbiAgICAgICAgaWYob3B0aW9ucy5nb29nbGUgJiYgb3B0aW9ucy5nb29nbGUuZmFtaWxpZXMubGVuZ3RoKXtcbiAgICAgICAgICBmb3IobGV0IGZhbWlseSBvZiBvcHRpb25zLmdvb2dsZS5mYW1pbGllcyl7XG4gICAgICAgICAgICBmYWJyaWMudXRpbC5jbGVhckZhYnJpY0ZvbnRDYWNoZShmYW1pbHkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihvcHRpb25zLmN1c3RvbSAmJiBvcHRpb25zLmN1c3RvbS5mYW1pbGllcy5sZW5ndGgpIHtcbiAgICAgICAgICBmb3IgKGxldCBmYW1pbHkgb2Ygb3B0aW9ucy5jdXN0b20uZmFtaWxpZXMpIHtcbiAgICAgICAgICAgIGZhYnJpYy51dGlsLmNsZWFyRmFicmljRm9udENhY2hlKGZhbWlseSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2FsbGJhY2soKVxuICAgICAgICB0aGlzLndlYkZvbnRzU3RhdHVzID0gXCJyZWFkeVwiO1xuICAgICAgICB0aGlzLmZpcmUoXCJmb250czpsb2FkZWRcIik7XG4gICAgICB9XG4gICAgfSxcbiAgICBpbmFjdGl2ZTogKCkgPT4ge1xuICAgICAgY29uc29sZS53YXJuKFwiZm9udHMgY291bGQgbm90IGJlIGxvYWRlZFwiKTtcbiAgICAgIHRoaXMud2ViRm9udHNTdGF0dXMgPSBcImZhaWxlZFwiO1xuICAgICAgdGhpcy5maXJlKFwiZm9udHM6bG9hZGVkXCIpO1xuICAgIH1cbiAgfSxvcHRpb25zKTtcbiAgZmFicmljLndlYkZvbnRzTG9hZGVyLmxvYWQob3B0aW9ucyk7XG59O1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkVkaXRvci5wcm90b3R5cGUsIHtcbiAgc2V0V2ViZm9udHM6IGZ1bmN0aW9uIChvcHRpb25zLGNhbGxiYWNrKSB7XG5cbiAgICB2YXIgX2ZvbnRzID0gW11cbiAgICAgIC5jb25jYXQob3B0aW9ucy5uYXRpdmUgfHwgW10pXG4gICAgICAuY29uY2F0KG9wdGlvbnMuY3VzdG9tIHx8IFtdKVxuICAgICAgLmNvbmNhdChvcHRpb25zLmdvb2dsZSB8fCBbXSk7XG4gICAgdGhpcy5mb250cyA9IGZhYnJpYy51dGlsLm9iamVjdC5zb3J0QnkoX2ZvbnRzLCBmb250ID0+eyByZXR1cm4gZm9udDsgfSk7XG5cblxuXG4gICAgaWYgKGZhYnJpYy53ZWJGb250c1N0YXR1cyA9PT0gXCJyZWFkeVwiIHx8IGZhYnJpYy53ZWJGb250c1N0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKClcbiAgICB9XG4gICAgZmFicmljLm9uKFwiZm9udHM6bG9hZGVkIGZvbnRzOmZhaWxlZFwiLCAoKSA9PiB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0pO1xuICAgIGlmIChmYWJyaWMud2ViRm9udHNTdGF0dXMgPT09IFwibG9hZGluZ1wiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgICAgZmFicmljLndlYkZvbnRzU3RhdHVzID0gXCJmYWlsZWRcIlxuICAgICAgLy90b2RvINGI0YDQuNGE0YLRiyDQvdC1INCz0YDRg9C30Y/RgtGB0Y8g0L3QsCDRgdC10YDQstC10YDQtVxuICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuXG4gICAgaWYob3B0aW9ucy5nb29nbGUpe1xuICAgICAgaWYob3B0aW9ucy5nb29nbGUubGVuZ3RoKXtcbiAgICAgICAgb3B0aW9ucy5nb29nbGUgPSB7ZmFtaWxpZXM6IG9wdGlvbnMuZ29vZ2xlfVxuICAgICAgfWVsc2V7XG4gICAgICAgIGRlbGV0ZSBvcHRpb25zLmdvb2dsZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYob3B0aW9ucy5jdXN0b20pe1xuICAgICAgaWYob3B0aW9ucy5jdXN0b20ubGVuZ3RoKXtcbiAgICAgICAgb3B0aW9ucy5jdXN0b20gPSB7ZmFtaWxpZXM6IG9wdGlvbnMuY3VzdG9tfVxuICAgICAgfWVsc2V7XG4gICAgICAgIGRlbGV0ZSBvcHRpb25zLmN1c3RvbTtcbiAgICAgIH1cbiAgICB9XG4gICAgZmFicmljLmxvYWRGb250cyhvcHRpb25zKTtcblxuICB9LFxuICBzZXRGb250czogZnVuY3Rpb24gKGZvbnRzKSB7XG4gICAgdGhpcy5mb250cyA9IGZvbnRzO1xuICB9LFxuICBmb250czogW1xuICAgICdBcmlhbCcsXG4gICAgJ0FyaWFsIEJsYWNrJyxcbiAgICAnQ29taWMgU2FucyBNUycsXG4gICAgJ0NvdXJpZXIgTmV3JyxcbiAgICAnR2VvcmdpYScsXG4gICAgJ0ltcGFjdCcsXG4gICAgJ0x1Y2lkYSBDb25zb2xlJyxcbiAgICAnVGFob21hJyxcbiAgICAnVGltZXMgTmV3IFJvbWFuJyxcbiAgICAnR2VuZXZhJyxcbiAgICAnc2Fucy1zZXJpZicsXG4gICAgJ3NlcmlmJyxcbiAgICAnbW9ub3NwYWNlJyxcbiAgICAnY3Vyc2l2ZSdcbiAgXSxcbiAgLypcbiAge1xuICAgIG5hdGl2ZTogW11cbiAgICBnb29nbGU6IFtdLFxuICAgIGN1c3RvbTogW11cbiAgfVxuICAgKi9cbiAgd2ViZm9udHM6IG51bGxcbn0pO1xuXG5cbmZhYnJpYy51dGlsLmZvbnRzID0ge1xuICB3YWl0Rm9yOiBmdW5jdGlvbiAoZm9udHMsIGNhbGxiYWNrKSB7XG4gICAgbGV0IGNoZWNrbGlzdCA9IFtdO1xuICAgIHZhciBpbnRlcnZhbDtcbiAgICBsZXQgbm9kZSwgZm9udDtcbiAgICBsZXQgaW5pdGlhbFdpZHRoO1xuICAgIGZvciAobGV0IGkgPSAwLCBsID0gZm9udHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICBmb250ID0gZm9udHNbaV07XG5cbiAgICAgIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAvLyBDaGFyYWN0ZXJzIHRoYXQgdmFyeSBzaWduaWZpY2FudGx5IGFtb25nIGRpZmZlcmVudCBmb250c1xuICAgICAgbm9kZS5pbm5lckhUTUwgPSAnZ2lJdFQxV1F5QCEtLyMnO1xuICAgICAgLy8gVmlzaWJsZSAtIHNvIHdlIGNhbiBtZWFzdXJlIGl0IC0gYnV0IG5vdCBvbiB0aGUgc2NyZWVuXG4gICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgIG5vZGUuc3R5bGUubGVmdCA9ICctMTAwMDBweCc7XG4gICAgICBub2RlLnN0eWxlLnRvcCA9ICctMTAwMDBweCc7XG4gICAgICAvLyBMYXJnZSBmb250IHNpemUgbWFrZXMgZXZlbiBzdWJ0bGUgY2hhbmdlcyBvYnZpb3VzXG4gICAgICBub2RlLnN0eWxlLmZvbnRTaXplID0gJzMwMHB4JztcbiAgICAgIC8vIFJlc2V0IGFueSBmb250IHByb3BlcnRpZXNcbiAgICAgIG5vZGUuc3R5bGUuZm9udEZhbWlseSA9ICdzYW5zLXNlcmlmJztcbiAgICAgIG5vZGUuc3R5bGUuZm9udFZhcmlhbnQgPSAnbm9ybWFsJztcbiAgICAgIG5vZGUuc3R5bGUuZm9udFN0eWxlID0gJ25vcm1hbCc7XG4gICAgICBub2RlLnN0eWxlLmZvbnRXZWlnaHQgPSAnbm9ybWFsJztcbiAgICAgIG5vZGUuc3R5bGUubGV0dGVyU3BhY2luZyA9ICcwJztcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICBpbml0aWFsV2lkdGggPSBub2RlLm9mZnNldFdpZHRoO1xuICAgICAgLy8gUmVtZW1iZXIgd2lkdGggd2l0aCBubyBhcHBsaWVkIHdlYiBmb250XG4gICAgICBub2RlLnN0eWxlLmZvbnRGYW1pbHkgPSBmb250O1xuICAgICAgaWYobm9kZS5vZmZzZXRXaWR0aCA9PT0gaW5pdGlhbFdpZHRoKXtcbiAgICAgICAgY2hlY2tsaXN0LnB1c2gobm9kZSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgZmFicmljLmNsZWFyRmFicmljRm9udENhY2hlKG5vZGUuc3R5bGUuZm9udEZhbWlseSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2hlY2tGb250cygpIHtcbiAgICAgIGZvcih2YXIgaSA9IGNoZWNrbGlzdC5sZW5ndGg7IGktLTspe1xuICAgICAgICBpZiAobm9kZS5vZmZzZXRXaWR0aCAhPT0gaW5pdGlhbFdpZHRoKSB7XG4gICAgICAgICAgY2hlY2tsaXN0LnNwbGljZShjaGVja2xpc3QuaW5kZXhPZihmb250KSwxKTtcbiAgICAgICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7XG5cbiAgICAgICAgICBmYWJyaWMuY2xlYXJGYWJyaWNGb250Q2FjaGUobm9kZS5zdHlsZS5mb250RmFtaWx5KTtcbiAgICAgICAgICAvLyBJZiBhbGwgZm9udHMgaGF2ZSBiZWVuIGxvYWRlZFxuICAgICAgICAgIGlmICghY2hlY2tsaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICB9XG4gICAgaWYoY2hlY2tsaXN0Lmxlbmd0aCl7XG4gICAgICBpbnRlcnZhbCA9IHNldEludGVydmFsKGNoZWNrRm9udHMsIDUwKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cblxuICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2ZvbnRzLmpzIiwiLyogV2ViIEZvbnQgTG9hZGVyIHYxLjYuMjggLSAoYykgQWRvYmUgU3lzdGVtcywgR29vZ2xlLiBMaWNlbnNlOiBBcGFjaGUgMi4wICovKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gYWEoYSxiLGMpe3JldHVybiBhLmNhbGwuYXBwbHkoYS5iaW5kLGFyZ3VtZW50cyl9ZnVuY3Rpb24gYmEoYSxiLGMpe2lmKCFhKXRocm93IEVycm9yKCk7aWYoMjxhcmd1bWVudHMubGVuZ3RoKXt2YXIgZD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtBcnJheS5wcm90b3R5cGUudW5zaGlmdC5hcHBseShjLGQpO3JldHVybiBhLmFwcGx5KGIsYyl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGIsYXJndW1lbnRzKX19ZnVuY3Rpb24gcChhLGIsYyl7cD1GdW5jdGlvbi5wcm90b3R5cGUuYmluZCYmLTEhPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLnRvU3RyaW5nKCkuaW5kZXhPZihcIm5hdGl2ZSBjb2RlXCIpP2FhOmJhO3JldHVybiBwLmFwcGx5KG51bGwsYXJndW1lbnRzKX12YXIgcT1EYXRlLm5vd3x8ZnVuY3Rpb24oKXtyZXR1cm4rbmV3IERhdGV9O2Z1bmN0aW9uIGNhKGEsYil7dGhpcy5hPWE7dGhpcy5vPWJ8fGE7dGhpcy5jPXRoaXMuby5kb2N1bWVudH12YXIgZGE9ISF3aW5kb3cuRm9udEZhY2U7ZnVuY3Rpb24gdChhLGIsYyxkKXtiPWEuYy5jcmVhdGVFbGVtZW50KGIpO2lmKGMpZm9yKHZhciBlIGluIGMpYy5oYXNPd25Qcm9wZXJ0eShlKSYmKFwic3R5bGVcIj09ZT9iLnN0eWxlLmNzc1RleHQ9Y1tlXTpiLnNldEF0dHJpYnV0ZShlLGNbZV0pKTtkJiZiLmFwcGVuZENoaWxkKGEuYy5jcmVhdGVUZXh0Tm9kZShkKSk7cmV0dXJuIGJ9ZnVuY3Rpb24gdShhLGIsYyl7YT1hLmMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYilbMF07YXx8KGE9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTthLmluc2VydEJlZm9yZShjLGEubGFzdENoaWxkKX1mdW5jdGlvbiB2KGEpe2EucGFyZW50Tm9kZSYmYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGEpfVxuICAgIGZ1bmN0aW9uIHcoYSxiLGMpe2I9Ynx8W107Yz1jfHxbXTtmb3IodmFyIGQ9YS5jbGFzc05hbWUuc3BsaXQoL1xccysvKSxlPTA7ZTxiLmxlbmd0aDtlKz0xKXtmb3IodmFyIGY9ITEsZz0wO2c8ZC5sZW5ndGg7Zys9MSlpZihiW2VdPT09ZFtnXSl7Zj0hMDticmVha31mfHxkLnB1c2goYltlXSl9Yj1bXTtmb3IoZT0wO2U8ZC5sZW5ndGg7ZSs9MSl7Zj0hMTtmb3IoZz0wO2c8Yy5sZW5ndGg7Zys9MSlpZihkW2VdPT09Y1tnXSl7Zj0hMDticmVha31mfHxiLnB1c2goZFtlXSl9YS5jbGFzc05hbWU9Yi5qb2luKFwiIFwiKS5yZXBsYWNlKC9cXHMrL2csXCIgXCIpLnJlcGxhY2UoL15cXHMrfFxccyskLyxcIlwiKX1mdW5jdGlvbiB5KGEsYil7Zm9yKHZhciBjPWEuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyksZD0wLGU9Yy5sZW5ndGg7ZDxlO2QrKylpZihjW2RdPT1iKXJldHVybiEwO3JldHVybiExfVxuICAgIGZ1bmN0aW9uIGVhKGEpe3JldHVybiBhLm8ubG9jYXRpb24uaG9zdG5hbWV8fGEuYS5sb2NhdGlvbi5ob3N0bmFtZX1mdW5jdGlvbiB6KGEsYixjKXtmdW5jdGlvbiBkKCl7bSYmZSYmZiYmKG0oZyksbT1udWxsKX1iPXQoYSxcImxpbmtcIix7cmVsOlwic3R5bGVzaGVldFwiLGhyZWY6YixtZWRpYTpcImFsbFwifSk7dmFyIGU9ITEsZj0hMCxnPW51bGwsbT1jfHxudWxsO2RhPyhiLm9ubG9hZD1mdW5jdGlvbigpe2U9ITA7ZCgpfSxiLm9uZXJyb3I9ZnVuY3Rpb24oKXtlPSEwO2c9RXJyb3IoXCJTdHlsZXNoZWV0IGZhaWxlZCB0byBsb2FkXCIpO2QoKX0pOnNldFRpbWVvdXQoZnVuY3Rpb24oKXtlPSEwO2QoKX0sMCk7dShhLFwiaGVhZFwiLGIpfVxuICAgIGZ1bmN0aW9uIEEoYSxiLGMsZCl7dmFyIGU9YS5jLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXTtpZihlKXt2YXIgZj10KGEsXCJzY3JpcHRcIix7c3JjOmJ9KSxnPSExO2Yub25sb2FkPWYub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7Z3x8dGhpcy5yZWFkeVN0YXRlJiZcImxvYWRlZFwiIT10aGlzLnJlYWR5U3RhdGUmJlwiY29tcGxldGVcIiE9dGhpcy5yZWFkeVN0YXRlfHwoZz0hMCxjJiZjKG51bGwpLGYub25sb2FkPWYub25yZWFkeXN0YXRlY2hhbmdlPW51bGwsXCJIRUFEXCI9PWYucGFyZW50Tm9kZS50YWdOYW1lJiZlLnJlbW92ZUNoaWxkKGYpKX07ZS5hcHBlbmRDaGlsZChmKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Z3x8KGc9ITAsYyYmYyhFcnJvcihcIlNjcmlwdCBsb2FkIHRpbWVvdXRcIikpKX0sZHx8NUUzKTtyZXR1cm4gZn1yZXR1cm4gbnVsbH07ZnVuY3Rpb24gQigpe3RoaXMuYT0wO3RoaXMuYz1udWxsfWZ1bmN0aW9uIEMoYSl7YS5hKys7cmV0dXJuIGZ1bmN0aW9uKCl7YS5hLS07RChhKX19ZnVuY3Rpb24gRShhLGIpe2EuYz1iO0QoYSl9ZnVuY3Rpb24gRChhKXswPT1hLmEmJmEuYyYmKGEuYygpLGEuYz1udWxsKX07ZnVuY3Rpb24gRihhKXt0aGlzLmE9YXx8XCItXCJ9Ri5wcm90b3R5cGUuYz1mdW5jdGlvbihhKXtmb3IodmFyIGI9W10sYz0wO2M8YXJndW1lbnRzLmxlbmd0aDtjKyspYi5wdXNoKGFyZ3VtZW50c1tjXS5yZXBsYWNlKC9bXFxXX10rL2csXCJcIikudG9Mb3dlckNhc2UoKSk7cmV0dXJuIGIuam9pbih0aGlzLmEpfTtmdW5jdGlvbiBHKGEsYil7dGhpcy5jPWE7dGhpcy5mPTQ7dGhpcy5hPVwiblwiO3ZhciBjPShifHxcIm40XCIpLm1hdGNoKC9eKFtuaW9dKShbMS05XSkkL2kpO2MmJih0aGlzLmE9Y1sxXSx0aGlzLmY9cGFyc2VJbnQoY1syXSwxMCkpfWZ1bmN0aW9uIGZhKGEpe3JldHVybiBIKGEpK1wiIFwiKyhhLmYrXCIwMFwiKStcIiAzMDBweCBcIitJKGEuYyl9ZnVuY3Rpb24gSShhKXt2YXIgYj1bXTthPWEuc3BsaXQoLyxcXHMqLyk7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspe3ZhciBkPWFbY10ucmVwbGFjZSgvWydcIl0vZyxcIlwiKTstMSE9ZC5pbmRleE9mKFwiIFwiKXx8L15cXGQvLnRlc3QoZCk/Yi5wdXNoKFwiJ1wiK2QrXCInXCIpOmIucHVzaChkKX1yZXR1cm4gYi5qb2luKFwiLFwiKX1mdW5jdGlvbiBKKGEpe3JldHVybiBhLmErYS5mfWZ1bmN0aW9uIEgoYSl7dmFyIGI9XCJub3JtYWxcIjtcIm9cIj09PWEuYT9iPVwib2JsaXF1ZVwiOlwiaVwiPT09YS5hJiYoYj1cIml0YWxpY1wiKTtyZXR1cm4gYn1cbiAgICBmdW5jdGlvbiBnYShhKXt2YXIgYj00LGM9XCJuXCIsZD1udWxsO2EmJigoZD1hLm1hdGNoKC8obm9ybWFsfG9ibGlxdWV8aXRhbGljKS9pKSkmJmRbMV0mJihjPWRbMV0uc3Vic3RyKDAsMSkudG9Mb3dlckNhc2UoKSksKGQ9YS5tYXRjaCgvKFsxLTldMDB8bm9ybWFsfGJvbGQpL2kpKSYmZFsxXSYmKC9ib2xkL2kudGVzdChkWzFdKT9iPTc6L1sxLTldMDAvLnRlc3QoZFsxXSkmJihiPXBhcnNlSW50KGRbMV0uc3Vic3RyKDAsMSksMTApKSkpO3JldHVybiBjK2J9O2Z1bmN0aW9uIGhhKGEsYil7dGhpcy5jPWE7dGhpcy5mPWEuby5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7dGhpcy5oPWI7dGhpcy5hPW5ldyBGKFwiLVwiKTt0aGlzLmo9ITEhPT1iLmV2ZW50czt0aGlzLmc9ITEhPT1iLmNsYXNzZXN9ZnVuY3Rpb24gaWEoYSl7YS5nJiZ3KGEuZixbYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKV0pO0soYSxcImxvYWRpbmdcIil9ZnVuY3Rpb24gTChhKXtpZihhLmcpe3ZhciBiPXkoYS5mLGEuYS5jKFwid2ZcIixcImFjdGl2ZVwiKSksYz1bXSxkPVthLmEuYyhcIndmXCIsXCJsb2FkaW5nXCIpXTtifHxjLnB1c2goYS5hLmMoXCJ3ZlwiLFwiaW5hY3RpdmVcIikpO3coYS5mLGMsZCl9SyhhLFwiaW5hY3RpdmVcIil9ZnVuY3Rpb24gSyhhLGIsYyl7aWYoYS5qJiZhLmhbYl0paWYoYylhLmhbYl0oYy5jLEooYykpO2Vsc2UgYS5oW2JdKCl9O2Z1bmN0aW9uIGphKCl7dGhpcy5jPXt9fWZ1bmN0aW9uIGthKGEsYixjKXt2YXIgZD1bXSxlO2ZvcihlIGluIGIpaWYoYi5oYXNPd25Qcm9wZXJ0eShlKSl7dmFyIGY9YS5jW2VdO2YmJmQucHVzaChmKGJbZV0sYykpfXJldHVybiBkfTtmdW5jdGlvbiBNKGEsYil7dGhpcy5jPWE7dGhpcy5mPWI7dGhpcy5hPXQodGhpcy5jLFwic3BhblwiLHtcImFyaWEtaGlkZGVuXCI6XCJ0cnVlXCJ9LHRoaXMuZil9ZnVuY3Rpb24gTihhKXt1KGEuYyxcImJvZHlcIixhLmEpfWZ1bmN0aW9uIE8oYSl7cmV0dXJuXCJkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3RvcDotOTk5OXB4O2xlZnQ6LTk5OTlweDtmb250LXNpemU6MzAwcHg7d2lkdGg6YXV0bztoZWlnaHQ6YXV0bztsaW5lLWhlaWdodDpub3JtYWw7bWFyZ2luOjA7cGFkZGluZzowO2ZvbnQtdmFyaWFudDpub3JtYWw7d2hpdGUtc3BhY2U6bm93cmFwO2ZvbnQtZmFtaWx5OlwiK0koYS5jKStcIjtcIisoXCJmb250LXN0eWxlOlwiK0goYSkrXCI7Zm9udC13ZWlnaHQ6XCIrKGEuZitcIjAwXCIpK1wiO1wiKX07ZnVuY3Rpb24gUChhLGIsYyxkLGUsZil7dGhpcy5nPWE7dGhpcy5qPWI7dGhpcy5hPWQ7dGhpcy5jPWM7dGhpcy5mPWV8fDNFMzt0aGlzLmg9Znx8dm9pZCAwfVAucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jLm8uZG9jdW1lbnQsYj10aGlzLGM9cSgpLGQ9bmV3IFByb21pc2UoZnVuY3Rpb24oZCxlKXtmdW5jdGlvbiBmKCl7cSgpLWM+PWIuZj9lKCk6YS5mb250cy5sb2FkKGZhKGIuYSksYi5oKS50aGVuKGZ1bmN0aW9uKGEpezE8PWEubGVuZ3RoP2QoKTpzZXRUaW1lb3V0KGYsMjUpfSxmdW5jdGlvbigpe2UoKX0pfWYoKX0pLGU9bnVsbCxmPW5ldyBQcm9taXNlKGZ1bmN0aW9uKGEsZCl7ZT1zZXRUaW1lb3V0KGQsYi5mKX0pO1Byb21pc2UucmFjZShbZixkXSkudGhlbihmdW5jdGlvbigpe2UmJihjbGVhclRpbWVvdXQoZSksZT1udWxsKTtiLmcoYi5hKX0sZnVuY3Rpb24oKXtiLmooYi5hKX0pfTtmdW5jdGlvbiBRKGEsYixjLGQsZSxmLGcpe3RoaXMudj1hO3RoaXMuQj1iO3RoaXMuYz1jO3RoaXMuYT1kO3RoaXMucz1nfHxcIkJFU2Jzd3lcIjt0aGlzLmY9e307dGhpcy53PWV8fDNFMzt0aGlzLnU9Znx8bnVsbDt0aGlzLm09dGhpcy5qPXRoaXMuaD10aGlzLmc9bnVsbDt0aGlzLmc9bmV3IE0odGhpcy5jLHRoaXMucyk7dGhpcy5oPW5ldyBNKHRoaXMuYyx0aGlzLnMpO3RoaXMuaj1uZXcgTSh0aGlzLmMsdGhpcy5zKTt0aGlzLm09bmV3IE0odGhpcy5jLHRoaXMucyk7YT1uZXcgRyh0aGlzLmEuYytcIixzZXJpZlwiLEoodGhpcy5hKSk7YT1PKGEpO3RoaXMuZy5hLnN0eWxlLmNzc1RleHQ9YTthPW5ldyBHKHRoaXMuYS5jK1wiLHNhbnMtc2VyaWZcIixKKHRoaXMuYSkpO2E9TyhhKTt0aGlzLmguYS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgRyhcInNlcmlmXCIsSih0aGlzLmEpKTthPU8oYSk7dGhpcy5qLmEuc3R5bGUuY3NzVGV4dD1hO2E9bmV3IEcoXCJzYW5zLXNlcmlmXCIsSih0aGlzLmEpKTthPVxuICAgICAgICBPKGEpO3RoaXMubS5hLnN0eWxlLmNzc1RleHQ9YTtOKHRoaXMuZyk7Tih0aGlzLmgpO04odGhpcy5qKTtOKHRoaXMubSl9dmFyIFI9e0Q6XCJzZXJpZlwiLEM6XCJzYW5zLXNlcmlmXCJ9LFM9bnVsbDtmdW5jdGlvbiBUKCl7aWYobnVsbD09PVMpe3ZhciBhPS9BcHBsZVdlYktpdFxcLyhbMC05XSspKD86XFwuKFswLTldKykpLy5leGVjKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtTPSEhYSYmKDUzNj5wYXJzZUludChhWzFdLDEwKXx8NTM2PT09cGFyc2VJbnQoYVsxXSwxMCkmJjExPj1wYXJzZUludChhWzJdLDEwKSl9cmV0dXJuIFN9US5wcm90b3R5cGUuc3RhcnQ9ZnVuY3Rpb24oKXt0aGlzLmYuc2VyaWY9dGhpcy5qLmEub2Zmc2V0V2lkdGg7dGhpcy5mW1wic2Fucy1zZXJpZlwiXT10aGlzLm0uYS5vZmZzZXRXaWR0aDt0aGlzLkE9cSgpO1UodGhpcyl9O1xuICAgIGZ1bmN0aW9uIGxhKGEsYixjKXtmb3IodmFyIGQgaW4gUilpZihSLmhhc093blByb3BlcnR5KGQpJiZiPT09YS5mW1JbZF1dJiZjPT09YS5mW1JbZF1dKXJldHVybiEwO3JldHVybiExfWZ1bmN0aW9uIFUoYSl7dmFyIGI9YS5nLmEub2Zmc2V0V2lkdGgsYz1hLmguYS5vZmZzZXRXaWR0aCxkOyhkPWI9PT1hLmYuc2VyaWYmJmM9PT1hLmZbXCJzYW5zLXNlcmlmXCJdKXx8KGQ9VCgpJiZsYShhLGIsYykpO2Q/cSgpLWEuQT49YS53P1QoKSYmbGEoYSxiLGMpJiYobnVsbD09PWEudXx8YS51Lmhhc093blByb3BlcnR5KGEuYS5jKSk/VihhLGEudik6VihhLGEuQik6bWEoYSk6VihhLGEudil9ZnVuY3Rpb24gbWEoYSl7c2V0VGltZW91dChwKGZ1bmN0aW9uKCl7VSh0aGlzKX0sYSksNTApfWZ1bmN0aW9uIFYoYSxiKXtzZXRUaW1lb3V0KHAoZnVuY3Rpb24oKXt2KHRoaXMuZy5hKTt2KHRoaXMuaC5hKTt2KHRoaXMuai5hKTt2KHRoaXMubS5hKTtiKHRoaXMuYSl9LGEpLDApfTtmdW5jdGlvbiBXKGEsYixjKXt0aGlzLmM9YTt0aGlzLmE9Yjt0aGlzLmY9MDt0aGlzLm09dGhpcy5qPSExO3RoaXMucz1jfXZhciBYPW51bGw7Vy5wcm90b3R5cGUuZz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmE7Yi5nJiZ3KGIuZixbYi5hLmMoXCJ3ZlwiLGEuYyxKKGEpLnRvU3RyaW5nKCksXCJhY3RpdmVcIildLFtiLmEuYyhcIndmXCIsYS5jLEooYSkudG9TdHJpbmcoKSxcImxvYWRpbmdcIiksYi5hLmMoXCJ3ZlwiLGEuYyxKKGEpLnRvU3RyaW5nKCksXCJpbmFjdGl2ZVwiKV0pO0soYixcImZvbnRhY3RpdmVcIixhKTt0aGlzLm09ITA7bmEodGhpcyl9O1xuICAgIFcucHJvdG90eXBlLmg9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hO2lmKGIuZyl7dmFyIGM9eShiLmYsYi5hLmMoXCJ3ZlwiLGEuYyxKKGEpLnRvU3RyaW5nKCksXCJhY3RpdmVcIikpLGQ9W10sZT1bYi5hLmMoXCJ3ZlwiLGEuYyxKKGEpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpXTtjfHxkLnB1c2goYi5hLmMoXCJ3ZlwiLGEuYyxKKGEpLnRvU3RyaW5nKCksXCJpbmFjdGl2ZVwiKSk7dyhiLmYsZCxlKX1LKGIsXCJmb250aW5hY3RpdmVcIixhKTtuYSh0aGlzKX07ZnVuY3Rpb24gbmEoYSl7MD09LS1hLmYmJmEuaiYmKGEubT8oYT1hLmEsYS5nJiZ3KGEuZixbYS5hLmMoXCJ3ZlwiLFwiYWN0aXZlXCIpXSxbYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKSxhLmEuYyhcIndmXCIsXCJpbmFjdGl2ZVwiKV0pLEsoYSxcImFjdGl2ZVwiKSk6TChhLmEpKX07ZnVuY3Rpb24gb2EoYSl7dGhpcy5qPWE7dGhpcy5hPW5ldyBqYTt0aGlzLmg9MDt0aGlzLmY9dGhpcy5nPSEwfW9hLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3RoaXMuYz1uZXcgY2EodGhpcy5qLGEuY29udGV4dHx8dGhpcy5qKTt0aGlzLmc9ITEhPT1hLmV2ZW50czt0aGlzLmY9ITEhPT1hLmNsYXNzZXM7cGEodGhpcyxuZXcgaGEodGhpcy5jLGEpLGEpfTtcbiAgICBmdW5jdGlvbiBxYShhLGIsYyxkLGUpe3ZhciBmPTA9PS0tYS5oOyhhLmZ8fGEuZykmJnNldFRpbWVvdXQoZnVuY3Rpb24oKXt2YXIgYT1lfHxudWxsLG09ZHx8bnVsbHx8e307aWYoMD09PWMubGVuZ3RoJiZmKUwoYi5hKTtlbHNle2IuZis9Yy5sZW5ndGg7ZiYmKGIuaj1mKTt2YXIgaCxsPVtdO2ZvcihoPTA7aDxjLmxlbmd0aDtoKyspe3ZhciBrPWNbaF0sbj1tW2suY10scj1iLmEseD1rO3IuZyYmdyhyLmYsW3IuYS5jKFwid2ZcIix4LmMsSih4KS50b1N0cmluZygpLFwibG9hZGluZ1wiKV0pO0socixcImZvbnRsb2FkaW5nXCIseCk7cj1udWxsO2lmKG51bGw9PT1YKWlmKHdpbmRvdy5Gb250RmFjZSl7dmFyIHg9L0dlY2tvLipGaXJlZm94XFwvKFxcZCspLy5leGVjKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSx4YT0vT1MgWC4qVmVyc2lvblxcLzEwXFwuLipTYWZhcmkvLmV4ZWMod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpJiYvQXBwbGUvLmV4ZWMod2luZG93Lm5hdmlnYXRvci52ZW5kb3IpO1xuICAgICAgICBYPXg/NDI8cGFyc2VJbnQoeFsxXSwxMCk6eGE/ITE6ITB9ZWxzZSBYPSExO1g/cj1uZXcgUChwKGIuZyxiKSxwKGIuaCxiKSxiLmMsayxiLnMsbik6cj1uZXcgUShwKGIuZyxiKSxwKGIuaCxiKSxiLmMsayxiLnMsYSxuKTtsLnB1c2gocil9Zm9yKGg9MDtoPGwubGVuZ3RoO2grKylsW2hdLnN0YXJ0KCl9fSwwKX1mdW5jdGlvbiBwYShhLGIsYyl7dmFyIGQ9W10sZT1jLnRpbWVvdXQ7aWEoYik7dmFyIGQ9a2EoYS5hLGMsYS5jKSxmPW5ldyBXKGEuYyxiLGUpO2EuaD1kLmxlbmd0aDtiPTA7Zm9yKGM9ZC5sZW5ndGg7YjxjO2IrKylkW2JdLmxvYWQoZnVuY3Rpb24oYixkLGMpe3FhKGEsZixiLGQsYyl9KX07ZnVuY3Rpb24gcmEoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn1cbiAgICByYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKCl7aWYoZltcIl9fbXRpX2ZudExzdFwiK2RdKXt2YXIgYz1mW1wiX19tdGlfZm50THN0XCIrZF0oKSxlPVtdLGg7aWYoYylmb3IodmFyIGw9MDtsPGMubGVuZ3RoO2wrKyl7dmFyIGs9Y1tsXS5mb250ZmFtaWx5O3ZvaWQgMCE9Y1tsXS5mb250U3R5bGUmJnZvaWQgMCE9Y1tsXS5mb250V2VpZ2h0PyhoPWNbbF0uZm9udFN0eWxlK2NbbF0uZm9udFdlaWdodCxlLnB1c2gobmV3IEcoayxoKSkpOmUucHVzaChuZXcgRyhrKSl9YShlKX1lbHNlIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtiKCl9LDUwKX12YXIgYz10aGlzLGQ9Yy5hLnByb2plY3RJZCxlPWMuYS52ZXJzaW9uO2lmKGQpe3ZhciBmPWMuYy5vO0EodGhpcy5jLChjLmEuYXBpfHxcImh0dHBzOi8vZmFzdC5mb250cy5uZXQvanNhcGlcIikrXCIvXCIrZCtcIi5qc1wiKyhlP1wiP3Y9XCIrZTpcIlwiKSxmdW5jdGlvbihlKXtlP2EoW10pOihmW1wiX19Nb25vdHlwZUNvbmZpZ3VyYXRpb25fX1wiK1xuICAgIGRdPWZ1bmN0aW9uKCl7cmV0dXJuIGMuYX0sYigpKX0pLmlkPVwiX19Nb25vdHlwZUFQSVNjcmlwdF9fXCIrZH1lbHNlIGEoW10pfTtmdW5jdGlvbiBzYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifXNhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiLGMsZD10aGlzLmEudXJsc3x8W10sZT10aGlzLmEuZmFtaWxpZXN8fFtdLGY9dGhpcy5hLnRlc3RTdHJpbmdzfHx7fSxnPW5ldyBCO2I9MDtmb3IoYz1kLmxlbmd0aDtiPGM7YisrKXoodGhpcy5jLGRbYl0sQyhnKSk7dmFyIG09W107Yj0wO2ZvcihjPWUubGVuZ3RoO2I8YztiKyspaWYoZD1lW2JdLnNwbGl0KFwiOlwiKSxkWzFdKWZvcih2YXIgaD1kWzFdLnNwbGl0KFwiLFwiKSxsPTA7bDxoLmxlbmd0aDtsKz0xKW0ucHVzaChuZXcgRyhkWzBdLGhbbF0pKTtlbHNlIG0ucHVzaChuZXcgRyhkWzBdKSk7RShnLGZ1bmN0aW9uKCl7YShtLGYpfSl9O2Z1bmN0aW9uIHRhKGEsYil7YT90aGlzLmM9YTp0aGlzLmM9dWE7dGhpcy5hPVtdO3RoaXMuZj1bXTt0aGlzLmc9Ynx8XCJcIn12YXIgdWE9XCJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzc1wiO2Z1bmN0aW9uIHZhKGEsYil7Zm9yKHZhciBjPWIubGVuZ3RoLGQ9MDtkPGM7ZCsrKXt2YXIgZT1iW2RdLnNwbGl0KFwiOlwiKTszPT1lLmxlbmd0aCYmYS5mLnB1c2goZS5wb3AoKSk7dmFyIGY9XCJcIjsyPT1lLmxlbmd0aCYmXCJcIiE9ZVsxXSYmKGY9XCI6XCIpO2EuYS5wdXNoKGUuam9pbihmKSl9fVxuICAgIGZ1bmN0aW9uIHdhKGEpe2lmKDA9PWEuYS5sZW5ndGgpdGhyb3cgRXJyb3IoXCJObyBmb250cyB0byBsb2FkIVwiKTtpZigtMSE9YS5jLmluZGV4T2YoXCJraXQ9XCIpKXJldHVybiBhLmM7Zm9yKHZhciBiPWEuYS5sZW5ndGgsYz1bXSxkPTA7ZDxiO2QrKyljLnB1c2goYS5hW2RdLnJlcGxhY2UoLyAvZyxcIitcIikpO2I9YS5jK1wiP2ZhbWlseT1cIitjLmpvaW4oXCIlN0NcIik7MDxhLmYubGVuZ3RoJiYoYis9XCImc3Vic2V0PVwiK2EuZi5qb2luKFwiLFwiKSk7MDxhLmcubGVuZ3RoJiYoYis9XCImdGV4dD1cIitlbmNvZGVVUklDb21wb25lbnQoYS5nKSk7cmV0dXJuIGJ9O2Z1bmN0aW9uIHlhKGEpe3RoaXMuZj1hO3RoaXMuYT1bXTt0aGlzLmM9e319XG4gICAgdmFyIHphPXtsYXRpbjpcIkJFU2Jzd3lcIixcImxhdGluLWV4dFwiOlwiXFx1MDBlN1xcdTAwZjZcXHUwMGZjXFx1MDExZlxcdTAxNWZcIixjeXJpbGxpYzpcIlxcdTA0MzlcXHUwNDRmXFx1MDQxNlwiLGdyZWVrOlwiXFx1MDNiMVxcdTAzYjJcXHUwM2EzXCIsa2htZXI6XCJcXHUxNzgwXFx1MTc4MVxcdTE3ODJcIixIYW51bWFuOlwiXFx1MTc4MFxcdTE3ODFcXHUxNzgyXCJ9LEFhPXt0aGluOlwiMVwiLGV4dHJhbGlnaHQ6XCIyXCIsXCJleHRyYS1saWdodFwiOlwiMlwiLHVsdHJhbGlnaHQ6XCIyXCIsXCJ1bHRyYS1saWdodFwiOlwiMlwiLGxpZ2h0OlwiM1wiLHJlZ3VsYXI6XCI0XCIsYm9vazpcIjRcIixtZWRpdW06XCI1XCIsXCJzZW1pLWJvbGRcIjpcIjZcIixzZW1pYm9sZDpcIjZcIixcImRlbWktYm9sZFwiOlwiNlwiLGRlbWlib2xkOlwiNlwiLGJvbGQ6XCI3XCIsXCJleHRyYS1ib2xkXCI6XCI4XCIsZXh0cmFib2xkOlwiOFwiLFwidWx0cmEtYm9sZFwiOlwiOFwiLHVsdHJhYm9sZDpcIjhcIixibGFjazpcIjlcIixoZWF2eTpcIjlcIixsOlwiM1wiLHI6XCI0XCIsYjpcIjdcIn0sQmE9e2k6XCJpXCIsaXRhbGljOlwiaVwiLG46XCJuXCIsbm9ybWFsOlwiblwifSxcbiAgICAgICAgQ2E9L14odGhpbnwoPzooPzpleHRyYXx1bHRyYSktPyk/bGlnaHR8cmVndWxhcnxib29rfG1lZGl1bXwoPzooPzpzZW1pfGRlbWl8ZXh0cmF8dWx0cmEpLT8pP2JvbGR8YmxhY2t8aGVhdnl8bHxyfGJ8WzEtOV0wMCk/KG58aXxub3JtYWx8aXRhbGljKT8kLztcbiAgICBmdW5jdGlvbiBEYShhKXtmb3IodmFyIGI9YS5mLmxlbmd0aCxjPTA7YzxiO2MrKyl7dmFyIGQ9YS5mW2NdLnNwbGl0KFwiOlwiKSxlPWRbMF0ucmVwbGFjZSgvXFwrL2csXCIgXCIpLGY9W1wibjRcIl07aWYoMjw9ZC5sZW5ndGgpe3ZhciBnO3ZhciBtPWRbMV07Zz1bXTtpZihtKWZvcih2YXIgbT1tLnNwbGl0KFwiLFwiKSxoPW0ubGVuZ3RoLGw9MDtsPGg7bCsrKXt2YXIgaztrPW1bbF07aWYoay5tYXRjaCgvXltcXHctXSskLykpe3ZhciBuPUNhLmV4ZWMoay50b0xvd2VyQ2FzZSgpKTtpZihudWxsPT1uKWs9XCJcIjtlbHNle2s9blsyXTtrPW51bGw9PWt8fFwiXCI9PWs/XCJuXCI6QmFba107bj1uWzFdO2lmKG51bGw9PW58fFwiXCI9PW4pbj1cIjRcIjtlbHNlIHZhciByPUFhW25dLG49cj9yOmlzTmFOKG4pP1wiNFwiOm4uc3Vic3RyKDAsMSk7az1bayxuXS5qb2luKFwiXCIpfX1lbHNlIGs9XCJcIjtrJiZnLnB1c2goayl9MDxnLmxlbmd0aCYmKGY9Zyk7Mz09ZC5sZW5ndGgmJihkPWRbMl0sZz1bXSxkPWQ/ZC5zcGxpdChcIixcIik6XG4gICAgICAgIGcsMDxkLmxlbmd0aCYmKGQ9emFbZFswXV0pJiYoYS5jW2VdPWQpKX1hLmNbZV18fChkPXphW2VdKSYmKGEuY1tlXT1kKTtmb3IoZD0wO2Q8Zi5sZW5ndGg7ZCs9MSlhLmEucHVzaChuZXcgRyhlLGZbZF0pKX19O2Z1bmN0aW9uIEVhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9dmFyIEZhPXtBcmltbzohMCxDb3VzaW5lOiEwLFRpbm9zOiEwfTtFYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj1uZXcgQixjPXRoaXMuYyxkPW5ldyB0YSh0aGlzLmEuYXBpLHRoaXMuYS50ZXh0KSxlPXRoaXMuYS5mYW1pbGllczt2YShkLGUpO3ZhciBmPW5ldyB5YShlKTtEYShmKTt6KGMsd2EoZCksQyhiKSk7RShiLGZ1bmN0aW9uKCl7YShmLmEsZi5jLEZhKX0pfTtmdW5jdGlvbiBHYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifUdhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYS5pZCxjPXRoaXMuYy5vO2I/QSh0aGlzLmMsKHRoaXMuYS5hcGl8fFwiaHR0cHM6Ly91c2UudHlwZWtpdC5uZXRcIikrXCIvXCIrYitcIi5qc1wiLGZ1bmN0aW9uKGIpe2lmKGIpYShbXSk7ZWxzZSBpZihjLlR5cGVraXQmJmMuVHlwZWtpdC5jb25maWcmJmMuVHlwZWtpdC5jb25maWcuZm4pe2I9Yy5UeXBla2l0LmNvbmZpZy5mbjtmb3IodmFyIGU9W10sZj0wO2Y8Yi5sZW5ndGg7Zis9Milmb3IodmFyIGc9YltmXSxtPWJbZisxXSxoPTA7aDxtLmxlbmd0aDtoKyspZS5wdXNoKG5ldyBHKGcsbVtoXSkpO3RyeXtjLlR5cGVraXQubG9hZCh7ZXZlbnRzOiExLGNsYXNzZXM6ITEsYXN5bmM6ITB9KX1jYXRjaChsKXt9YShlKX19LDJFMyk6YShbXSl9O2Z1bmN0aW9uIEhhKGEsYil7dGhpcy5jPWE7dGhpcy5mPWI7dGhpcy5hPVtdfUhhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZi5pZCxjPXRoaXMuYy5vLGQ9dGhpcztiPyhjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX198fChjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX189e30pLGMuX193ZWJmb250Zm9udGRlY2ttb2R1bGVfX1tiXT1mdW5jdGlvbihiLGMpe2Zvcih2YXIgZz0wLG09Yy5mb250cy5sZW5ndGg7ZzxtOysrZyl7dmFyIGg9Yy5mb250c1tnXTtkLmEucHVzaChuZXcgRyhoLm5hbWUsZ2EoXCJmb250LXdlaWdodDpcIitoLndlaWdodCtcIjtmb250LXN0eWxlOlwiK2guc3R5bGUpKSl9YShkLmEpfSxBKHRoaXMuYywodGhpcy5mLmFwaXx8XCJodHRwczovL2YuZm9udGRlY2suY29tL3MvY3NzL2pzL1wiKStlYSh0aGlzLmMpK1wiL1wiK2IrXCIuanNcIixmdW5jdGlvbihiKXtiJiZhKFtdKX0pKTphKFtdKX07dmFyIFk9bmV3IG9hKHdpbmRvdyk7WS5hLmMuY3VzdG9tPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBzYShiLGEpfTtZLmEuYy5mb250ZGVjaz1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgSGEoYixhKX07WS5hLmMubW9ub3R5cGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IHJhKGIsYSl9O1kuYS5jLnR5cGVraXQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IEdhKGIsYSl9O1kuYS5jLmdvb2dsZT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgRWEoYixhKX07dmFyIFo9e2xvYWQ6cChZLmxvYWQsWSl9O1wiZnVuY3Rpb25cIj09PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIFp9KTpcInVuZGVmaW5lZFwiIT09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9Wjood2luZG93LldlYkZvbnQ9Wix3aW5kb3cuV2ViRm9udENvbmZpZyYmWS5sb2FkKHdpbmRvdy5XZWJGb250Q29uZmlnKSk7fSgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBwbHVnaW5zL3dlYmZvbnQuanMiLCIndXNlIHN0cmljdCc7XG5pZighVG9vbGJhcil7XG4gIHJlcXVpcmUoJy4vLi4vLi4vcGx1Z2lucy8kLnV0aWwuanMnKTtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvdG9vbGJhcicpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmNvbG9ycycpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmZvbnRzJyk7XG4gIHJlcXVpcmUoJy4vLi4vLi4vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIub3B0aW9ucycpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLnNlbGVjdCcpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmVmZmVjdCcpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS5zZXRGdW5jdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24odGFyZ2V0KXtcbiAgaWYodGFyZ2V0LmNhbnZhcyl7XG4gICAgcmV0dXJuIHRhcmdldC5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH1cbiAgaWYodGFyZ2V0LnJlbmRlckFsbCl7XG4gICAgcmV0dXJuIHRhcmdldC5yZW5kZXJBbGwoKVxuICB9XG59O1xuXG5mYWJyaWMuVG9vbHNNaXhpbiA9IHtcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB0b29scyBbXCJ4XCIsIFwiKlwiLCBcInlcIl1cbiAgICogQHBhcmFtIHByb3RvXG4gICAqIEByZXR1cm5zIFtcInhcIiwgXCJhXCIsIFwiYlwiLCBcImNcIiwgXCJ5XCJdXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfZ2V0VG9vbHM6IGZ1bmN0aW9uKHRvb2xzLHByb3RvKXtcbiAgICB2YXIgaW5kZXhPZlN0YXIgPSAtMTtcbiAgICBpZigoaW5kZXhPZlN0YXIgPSB0b29scy5pbmRleE9mKFwiKlwiKSkgPT0gLTEpe1xuICAgICAgcmV0dXJuIHRvb2xzO1xuICAgIH1cblxuICAgIHZhciBrbGFzc25hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUocHJvdG8udHlwZSksdHJ1ZSk7XG4gICAgdmFyIHByb3RvRmFicmljID0gZmFicmljW2tsYXNzbmFtZV0ucHJvdG90eXBlO1xuICAgIHZhciBwcm90b0FwcCA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlc1trbGFzc25hbWVdO1xuXG4gICAgdmFyIHRvb2xzMiA9IHByb3RvQXBwICYmIHByb3RvQXBwLnRvb2xzIHx8IHByb3RvRmFicmljLnRvb2xzO1xuICAgIGlmKHRvb2xzMil7XG4gICAgICB0b29scy5zcGxpY2UuYXBwbHkodG9vbHMsIFtpbmRleE9mU3RhciwgMV0uY29uY2F0KHRvb2xzMikpO1xuICAgIH1cbiAgICB2YXIgX3Rvb2xzID0gdGhpcy5fZ2V0VG9vbHModG9vbHMsIHByb3RvRmFicmljLl9fcHJvdG9fXyApO1xuICAgIHJldHVybiBfdG9vbHNcbiAgfSxcbiAgc2V0VG9vbHM6IGZ1bmN0aW9uKHRvb2xzKXtcbiAgICBpZih0aGlzLmFwcGxpY2F0aW9uLnRvb2xiYXJzLm9iamVjdHMpe1xuICAgICAgdmFyIF90b29scyA9IFtdLmNvbmNhdCh0b29scyk7Ly9cbiAgICAgIHRoaXMudG9vbHMgPSB0aGlzLl9nZXRUb29scyhfdG9vbHMgLCB0aGlzLl9fcHJvdG9fXy5fX3Byb3RvX18pO1xuICAgICAgdGhpcy5tYWtlQWN0aW9ucygpO1xuICAgIH1cbiAgfSxcbiAgbWFrZUFjdGlvbnM6IGZ1bmN0aW9uKCl7XG4gICAgbGV0IGFjdGlvbnMgPSB7fTtcbiAgICBmb3IobGV0IHRvb2wgb2YgdGhpcy50b29scyl7XG4gICAgICBsZXQgX3ZhbCA9IHRoaXMuX2dldEFjdGlvblZhbHVlKHRvb2wpO1xuICAgICAgaWYoX3ZhbCl7XG4gICAgICAgIGFjdGlvbnNbdG9vbF0gPSBfdmFsO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGNvbnNvbGUud2FybihcInRvb2wgXCIgKyB0b29sICsgXCIgaXMgdW5kZWZpbmVkXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmdlbmVyYXRlZEFjdGlvbnMgPSBUb29sYmFyLm1ha2VBY3Rpb25zKGFjdGlvbnMsdGhpcyk7XG4gIH1cbn07XG5cbmZhYnJpYy5Ub29sYmFyID0gVG9vbGJhcjtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSxmYWJyaWMuVG9vbHNNaXhpbix7XG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAgIG9vLnB1c2goXCJhY3Rpb25zXCIsXCJ0b29sc1wiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKClcbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLCBmYWJyaWMuVG9vbHNNaXhpbiAse1xuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciBvbyA9IGZhYnJpYy5FZGl0b3IucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcInByb3RvdHlwZXNcIikgKyAxLDAsXCJhY3Rpb25zXCIpO1xuICAgIG9vLnNwbGljZShvby5pbmRleE9mKFwib2JqZWN0c1wiKSwwLFwidG9vbGJhcnNcIixcInRvb2xzXCIpO1xuICAgIHJldHVybiBvbztcbiAgfSkoKSxcbiAgb2JqZWN0c1Rvb2xiYXJDb250YWluZXI6IG51bGwsXG4gIHRhcmdldDogbnVsbCxcbiAgc2V0VG9vbGJhckNvb3JkczogZnVuY3Rpb24gKCRtZW51LCB0YXJnZXQsIG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIG9yaWdpblg6IFwibGVmdFwiLFxuICAgICAgb3JpZ2luWTogXCJ0b3BcIixcbiAgICAgIG1hcmdpblg6IDAsXG4gICAgICBtYXJnaW5ZOiAwXG4gICAgfSwgb3B0aW9ucyk7XG5cbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgdmFyIHIgPSB0YXJnZXQuZ2V0Qm91bmRpbmdSZWN0KCk7XG5cbiAgICB2YXIgX2xlZnQ7XG4gICAgc3dpdGNoIChvcHRpb25zLm9yaWdpblgpIHtcbiAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgIF9sZWZ0ID0gci5sZWZ0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdCArIHIud2lkdGg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImNlbnRlclwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdCArIHIud2lkdGggLyAyO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICB2YXIgX3RvcDtcbiAgICBzd2l0Y2ggKG9wdGlvbnMub3JpZ2luWSkge1xuICAgICAgY2FzZSBcInRvcFwiOlxuICAgICAgICBfdG9wID0gci50b3AgLSAkbWVudS5oZWlnaHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYm90dG9tXCI6XG4gICAgICAgIF90b3AgPSByLnRvcCArIHIuaGVpZ2h0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJjZW50ZXJcIjpcbiAgICAgICAgX3RvcCA9IHIudG9wICsgci5oZWlnaHQgLyAyIC0gJG1lbnUuaGVpZ2h0KCkgLyAyO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cblxuICAgIHZhciAkd3JhcHBlciA9ICRtZW51LnJlbGF0aXZlUGFyZW50KCk7Ly8gJCh0YXJnZXQuY2FudmFzLndyYXBwZXJFbCk7XG4gICAgdmFyIF9tZW51Q29udGFpbmVyT2Zmc2V0ID0gJCgkbWVudS5wYXJlbnRzKClbMF0pLm9mZnNldCgpO1xuICAgIHZhciBfY2FudmFzT2Zmc2V0ID0gJCh0YXJnZXQuY2FudmFzLndyYXBwZXJFbCkub2Zmc2V0KCk7XG4gICAgdmFyIF9wb3MgPSAkKHRhcmdldC5jYW52YXMud3JhcHBlckVsKS5wb3NpdGlvbigpXG5cblxuICAgIHZhciBfc2NhbGUgPSAkKHRhcmdldC5jYW52YXMud3JhcHBlckVsKS5oZWlnaHQoKSAvIHRhcmdldC5jYW52YXMuaGVpZ2h0O1xuICAgIF90b3AgKj0gX3NjYWxlO1xuICAgIF9sZWZ0ICo9IF9zY2FsZTtcblxuICAgIF90b3AgKz0gb3B0aW9ucy5tYXJnaW5ZICsgX2NhbnZhc09mZnNldC50b3AgLSBfbWVudUNvbnRhaW5lck9mZnNldC50b3A7Ly8gKyBfcG9zLnRvcDtcbiAgICBfbGVmdCArPSBvcHRpb25zLm1hcmdpblggKyBfY2FudmFzT2Zmc2V0LmxlZnQgLSBfbWVudUNvbnRhaW5lck9mZnNldC5sZWZ0Oy8vICsgX3Bvcy5sZWZ0O1xuXG4gICAgX2xlZnQgPSBNYXRoLm1heCgzLCBfbGVmdClcblxuICAgIHZhciBfb3ZlcmZsb3cgPSAtICR3cmFwcGVyLndpZHRoKCkgKyBfbGVmdCArICRtZW51LndpZHRoKCkgKyAzO1xuXG4gICAgaWYoX292ZXJmbG93ID4gMCl7XG4gICAgICBfbGVmdCAtPSBfb3ZlcmZsb3c7XG4gICAgfVxuXG4gICAgdmFyIGNvb3JkcyA9IHtcbiAgICAgIHRvcDogTWF0aC5tYXgoMywgX3RvcCksXG4gICAgICBsZWZ0OiBfbGVmdFxuICAgIH07XG5cbiAgLy8gICQodGhpcy53cmFwcGVyRWwpLm9mZnNldCgpO1xuXG4gICAgJG1lbnUuY3NzKGNvb3Jkcyk7XG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfSxcbiAgX2NyZWF0ZU9iamVjdHNUb29sYmFyOiBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICB2YXIgJGN0cjtcbiAgICBpZiAob3B0aW9ucy5jb250YWluZXIpIHtcbiAgICAgICRjdHIgPSAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9wdGlvbnMuY29udGFpbmVyKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRjdHIgPSAkKCc8ZGl2PicpO1xuICAgICAgJCh0aGlzLndyYXBwZXJFbCkucHJlcGVuZCgkY3RyKTtcbiAgICB9XG4gICAgaWYob3B0aW9ucy5wb3NpdGlvbil7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMob3B0aW9ucy5wb3NpdGlvbiwge1xuICAgICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgICAgb3JpZ2luWTogXCJ0b3BcIixcbiAgICAgICAgbWFyZ2luWDogMCxcbiAgICAgICAgbWFyZ2luWTogMFxuICAgICAgfSk7XG4gICAgICAkY3RyLmFkZENsYXNzKFwiZmxvYXRlZC1tZW51XCIpO1xuICAgICAgJGN0ci5jc3Moe1xuICAgICAgICBcInBvc2l0aW9uXCI6IFwiYWJzb2x1dGVcIixcbiAgICAgICAgXCJ6LWluZGV4XCI6IDk5OVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgJGN0ci5oaWRlKCk7XG4gICAgdGhpcy5vbih7XG4gICAgICAndGFyZ2V0OmNsZWFyZWQnOiBldmVudCA9PiB7XG4gICAgICAgIGlmIChldmVudC5wcmV2aW91cykge1xuICAgICAgICAgICRjdHIuaGlkZSgpO1xuICAgICAgICAgIHRoaXMub2JqZWN0VG9vbGJhci5kZXN0cm95KCk7XG4gICAgICAgICAgZGVsZXRlIHRoaXMub2JqZWN0VG9vbGJhcjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICd0YXJnZXQ6Y2hhbmdlZCc6IGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LnByZXZpb3VzKSB7XG4gICAgICAgICAgdGhpcy5vYmplY3RUb29sYmFyLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICAkY3RyLnNob3coKTtcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0LmFjdGlvbnMpIHtcbiAgICAgICAgICB0aGlzLm9iamVjdFRvb2xiYXIgPSBuZXcgZmFicmljLlRvb2xiYXIodGhpcy50YXJnZXQsICRjdHIsIHRoaXMudGFyZ2V0LmdlbmVyYXRlZEFjdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLnBvc2l0aW9uKSB7XG4gICAgICAgICAgdGhpcy5zZXRUb29sYmFyQ29vcmRzKCRjdHIsIHRoaXMudGFyZ2V0LCBvcHRpb25zLnBvc2l0aW9uKTtcbiAgICAgICAgICAvLyB0aGlzLm9iamVjdFRvb2xiYXIubW92aW5nX2V2ZW50TGlzdGVuZXIgPSB0aGlzLnNldFRvb2xiYXJDb29yZHMuYmluZCh0aGlzLCAkY3RyLCB0aGlzLnRhcmdldCwgb3B0aW9ucy5wb3NpdGlvbik7XG4gICAgICAgICAgLy8gdGhpcy50YXJnZXQub24oXCJtb3ZpbmdcIix0aGlzLm9iamVjdFRvb2xiYXIubW92aW5nX2V2ZW50TGlzdGVuZXIpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAndGFyZ2V0Om1vZGlmaWVkJzogZXZlbnQgPT4ge1xuICAgICAgICBpZihvcHRpb25zLnBvc2l0aW9uKXtcbiAgICAgICAgICB0aGlzLnNldFRvb2xiYXJDb29yZHMoJGN0ciwgdGhpcy50YXJnZXQsIG9wdGlvbnMucG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIF9jcmVhdGVDYW52YXNUb29sYmFyOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgaWYoIW9wdGlvbnMpcmV0dXJuO1xuXG4gICAgdGhpcy5vbihcInNsaWRlOmNoYW5nZWRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBjYW52YXMgPSBlLmNhbnZhcztcbiAgICAgIGlmICh0aGlzLnNsaWRlVG9vbGJhcikge1xuICAgICAgICB0aGlzLnNsaWRlVG9vbGJhci5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICB0aGlzLnNsaWRlVG9vbGJhciA9IG5ldyBmYWJyaWMuVG9vbGJhcihjYW52YXMsIG9wdGlvbnMuY29udGFpbmVyLCBjYW52YXMuZ2VuZXJhdGVkQWN0aW9ucywgb3B0aW9ucyk7XG4gICAgfSk7XG5cbiAgICBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLnNsaWRlVG9vbGJhciA9IG5ldyBmYWJyaWMuVG9vbGJhcih0aGlzLmNhbnZhcywgb3B0aW9ucy5jb250YWluZXIsICB0aGlzLmNhbnZhcy5nZW5lcmF0ZWRBY3Rpb25zLCBvcHRpb25zKTtcbiAgICB9XG4gIH0sXG4gIHNldFRvb2xiYXJzOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdGhpcy50b29sYmFycyA9IG9wdGlvbnM7XG5cbiAgICBpZihvcHRpb25zLnRvb2xzKXtcbiAgICAgIGlmKG9wdGlvbnMudG9vbHMuRWRpdG9yKXtcbiAgICAgICAgdGhpcy5zZXRUb29scyhvcHRpb25zLnRvb2xzLkVkaXRvcik7XG4gICAgICAgIGRlbGV0ZSBvcHRpb25zLnRvb2xzLkVkaXRvcjtcbiAgICAgIH1cbiAgICAgIGZvciAodmFyIGtsYXNzTmFtZSBpbiBvcHRpb25zLnRvb2xzKSB7XG4gICAgICAgIGlmKCF0aGlzLnByb3RvdHlwZXNba2xhc3NOYW1lXSl7XG4gICAgICAgICAgdGhpcy5wcm90b3R5cGVzW2tsYXNzTmFtZV0gPSB7fTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnByb3RvdHlwZXNba2xhc3NOYW1lXS50b29scyA9IG9wdGlvbnMudG9vbHNba2xhc3NOYW1lXTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuYXBwbGljYXRpb24pIHt9XG4gICAgaWYgKG9wdGlvbnMub2JqZWN0cykge1xuICAgICAgdGhpcy5fY3JlYXRlT2JqZWN0c1Rvb2xiYXIob3B0aW9ucy5vYmplY3RzKTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY2FudmFzKSB7XG4gICAgICB0aGlzLl9jcmVhdGVDYW52YXNUb29sYmFyKG9wdGlvbnMuY2FudmFzKTtcbiAgICB9XG4gIH0sXG4gIHNldFRvb2xzOiBmdW5jdGlvbih0b29scyl7XG4gICAgaWYodGhpcy50b29sYmFycy5hcHBsaWNhdGlvbil7XG4gICAgICB2YXIgX3Rvb2xzID0gW10uY29uY2F0KHRvb2xzKTsvL1xuICAgICAgdGhpcy50b29scyA9IHRoaXMuX2dldFRvb2xzKF90b29scyAsIHRoaXMuX19wcm90b19fLl9fcHJvdG9fXyk7XG4gICAgICB0aGlzLm1ha2VBY3Rpb25zKCk7XG4gICAgICBuZXcgZmFicmljLlRvb2xiYXIodGhpcywgdGhpcy50b29sYmFycy5hcHBsaWNhdGlvbi5jb250YWluZXIsIHRoaXMuZ2VuZXJhdGVkQWN0aW9ucywgdGhpcy50b29sYmFycy5hcHBsaWNhdGlvbik7XG4gICAgfVxuICB9LFxuICAvKnNldFRvb2xiYXJPcHRpb25zOiBmdW5jdGlvbih0b29sYmFyT3B0aW9ucyl7XG5cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZChUb29sYmFyLnRvb2xzLCB0b29sYmFyT3B0aW9ucy50b29scyk7XG4gICAgZm9yICh2YXIga2xhc3NOYW1lIGluIHRvb2xiYXJPcHRpb25zLmFjdGlvbnMpIHtcbiAgICAgIHZhciBhY3Rpb25zID0gdG9vbGJhck9wdGlvbnMuYWN0aW9uc1trbGFzc05hbWVdO1xuICAgICAgaWYoIWZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zKXtcbiAgICAgICAgZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnMgPSB7fVxuICAgICAgfVxuICAgICAgdmFyIHByb3RvQWN0aW9ucyA9IGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zO1xuXG4gICAgICBpZiAoYWN0aW9ucy5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBhY3Rpb25zID0gYWN0aW9ucy5jYWxsKGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZSlcbiAgICAgIH1lbHNle1xuICAgICAgICBhY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChhY3Rpb25zKTtcbiAgICAgIH1cbiAgICAgLy8gdmFyICRvcmRlciA9IGFjdGlvbnNbXCIkb3JkZXJcIl07XG4gICAgIC8vIGRlbGV0ZSBhY3Rpb25zW1wiJG9yZGVyXCJdO1xuXG4gICAgICBmb3IgKHZhciBqIGluIGFjdGlvbnMpIHtcbiAgICAgICAgaWYocHJvdG9BY3Rpb25zW2pdKXtcbiAgICAgICAgICBpZiAoYWN0aW9uc1tqXVtcIiRjbG9uZVwiXSkge1xuICAgICAgICAgICAgcHJvdG9BY3Rpb25zW2pdID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoe30sIHByb3RvQWN0aW9uc1tqXSk7XG4gICAgICAgICAgICBkZWxldGUgYWN0aW9uc1tqXVtcIiRjbG9uZVwiXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQocHJvdG9BY3Rpb25zW2pdLCBhY3Rpb25zW2pdKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgcHJvdG9BY3Rpb25zW2pdID0gYWN0aW9uc1tqXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwqL1xuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuRWRpdG9yLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgLy8gXCJjYW52YXM6Y3JlYXRlZFwiIDogZnVuY3Rpb24oKXtcbiAgICAvLyAgdGhpcy5pbml0VG9vbHMoKTtcbiAgIC8vIH0sXG4gICAvLyAgXCJjYW52YXM6Y3JlYXRlZFwiOiBmdW5jdGlvbigpe1xuICAgLy8gICAgdGhpcy5jcmVhdGVUb29sYmFycygpO1xuICAgLy8gIH1cbiAgfSlcbn0pO1xuXG4vL3RvZG8g0L3Rg9C20L3QviDRgdC00LXQu9Cw0YLRjCDQv9C+0YDRj9C00L7QuiDRgdCy0L7QudGB0YIg0YPQvdCw0YHQu9C10LTRg9C10LzRi9C8XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCBmYWJyaWMuVG9vbHNNaXhpbiwge1xuICBzZXRUb29sczogZnVuY3Rpb24odG9vbHMpe1xuICAgIGlmKHRoaXMuYXBwbGljYXRpb24udG9vbGJhcnMuY2FudmFzKXtcbiAgICAgIHZhciBfdG9vbHMgPSBbXS5jb25jYXQodG9vbHMpO1xuICAgICAgdGhpcy50b29scyA9IHRoaXMuX2dldFRvb2xzKF90b29scyAsIHRoaXMuX19wcm90b19fLl9fcHJvdG9fXyk7XG4gICAgICB0aGlzLm1ha2VBY3Rpb25zKCk7XG4gICAgfVxuICB9LFxuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG9vID0gZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAgIG9vLnB1c2goXCJhY3Rpb25zXCIsIFwidG9vbHNcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy90b29sYmFycy5qcyIsIlxuJC5mbi5leHRlbmQoe1xuXHRyZWxhdGl2ZVBhcmVudDogZnVuY3Rpb24oICApIHtcbiAgICAgIHZhciByZWdleCA9IC8oc3RhdGljfHJlbGF0aXZlfGFic29sdXRlKS87XG4gICAgICB2YXIgcmVsYXRpdmVQYXJlbnQgPSB0aGlzLnBhcmVudHMoKS5maWx0ZXIoIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcGFyZW50ID0gJCggdGhpcyApO1xuICAgICAgICByZXR1cm4gcmVnZXgudGVzdCggcGFyZW50LmNzcyggXCJwb3NpdGlvblwiICkgKTtcbiAgICAgIH0pLmVxKCAwICk7XG5cbiAgICByZXR1cm4gIXJlbGF0aXZlUGFyZW50Lmxlbmd0aCA/ICQoIHRoaXNbIDAgXS5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50ICkgOiByZWxhdGl2ZVBhcmVudDtcbiAgfSxcblx0c2Nyb2xsUGFyZW50OiBmdW5jdGlvbiggaW5jbHVkZUhpZGRlbiApIHtcblx0XHR2YXIgcG9zaXRpb24gPSB0aGlzLmNzcyggXCJwb3NpdGlvblwiICksXG5cdFx0XHRleGNsdWRlU3RhdGljUGFyZW50ID0gcG9zaXRpb24gPT09IFwiYWJzb2x1dGVcIixcblx0XHRcdG92ZXJmbG93UmVnZXggPSBpbmNsdWRlSGlkZGVuID8gLyhhdXRvfHNjcm9sbHxoaWRkZW4pLyA6IC8oYXV0b3xzY3JvbGwpLyxcblx0XHRcdHNjcm9sbFBhcmVudCA9IHRoaXMucGFyZW50cygpLmZpbHRlciggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciBwYXJlbnQgPSAkKCB0aGlzICk7XG5cdFx0XHRcdGlmICggZXhjbHVkZVN0YXRpY1BhcmVudCAmJiBwYXJlbnQuY3NzKCBcInBvc2l0aW9uXCIgKSA9PT0gXCJzdGF0aWNcIiApIHtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIG92ZXJmbG93UmVnZXgudGVzdCggcGFyZW50LmNzcyggXCJvdmVyZmxvd1wiICkgKyBwYXJlbnQuY3NzKCBcIm92ZXJmbG93LXlcIiApICsgcGFyZW50LmNzcyggXCJvdmVyZmxvdy14XCIgKSApO1xuXHRcdFx0fSkuZXEoIDAgKTtcblxuXHRcdHJldHVybiBwb3NpdGlvbiA9PT0gXCJmaXhlZFwiIHx8ICFzY3JvbGxQYXJlbnQubGVuZ3RoID8gJCggdGhpc1sgMCBdLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQgKSA6IHNjcm9sbFBhcmVudDtcblx0fSxcbiAgZWFjaFNlbGYgOiBmdW5jdGlvbihzZWxlY3Rvcixmb28pe1xuICAgICAgdGhpcy5maW5kKHNlbGVjdG9yKS5lYWNoKGZvbyk7XG4gICAgICBpZih0aGlzLmlzKHNlbGVjdG9yKSl7XG4gICAgICAgIGZvby5jYWxsKHRoaXNbMF0pO1xuICAgICAgfVxuICB9XG5cbn0pO1xuXG4kLmZuLmFwcGVuZFRleHQgPSBmdW5jdGlvbih0ZXh0KSB7XG4gIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgdmFyIHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGV4dCk7XG4gICAgJCh0aGlzKS5hcHBlbmQodGV4dE5vZGUpO1xuICB9KTtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gcGx1Z2lucy8kLnV0aWwuanMiLCJpZighJC5taW5pY29sb3JzKXtcbiAgICByZXF1aXJlKFwiLi4vLi4vcGx1Z2lucy8kLm1pbmljb2xvcnNcIik7XG59XG5cbmlmKHR5cGVvZiBUb29sYmFyID09PSBcInVuZGVmaW5lZFwiKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi4vdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUuY29sb3JwaWNrZXIgPSBmdW5jdGlvbiAoZWwsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucy5mb3JtYXQgPSAncmdiJztcbiAgb3B0aW9ucy5vcGFjaXR5ID0gdHJ1ZTtcbiAgZWwubWluaWNvbG9ycyhvcHRpb25zKTtcbn07XG5cblRvb2xiYXIucHJvdG90eXBlLmNvbG9ycGlja2VyT3B0aW9ucyA9IHtcbiAgcG9zaXRpb246IFwicmlnaHQgYm90dG9tXCJcbn07XG5cblRvb2xiYXIucHJvdG90eXBlLnRvb2xzLmNvbG9yID0ge1xuICB0ZW1wbGF0ZTpcbiAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAnPGRpdiBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiPicgK1xuICAgICc8aW5wdXQgdHlwZT1cInRleHRcIiBkYXRhLWZvcm1hdD1cInJnYmFcIiBkYXRhLW9wYWNpdHk9XCJ0cnVlXCIgZGF0YS10ZXh0PVwidHJ1ZVwiIGRhdGEtY29udHJvbD1cInNhdHVyYXRpb25cIiBkYXRhLXN3YXRjaGVzPVwiI2ZmZnwjMDAwfCNmMDB8IzBmMHwjMDBmfCNmZjB8IzBmZlwiICB2YWx1ZT1cInt2YWx1ZUN1cnJlbnR9XCIgdHJhbnNjbHVkZT4nLFxuICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcbiAgICAvL3ZhciB0YXJnZXQgPSBkYXRhLnRhcmdldDtcblxuICAgIHZhciBfdmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuY29sb3JwaWNrZXIodHJhbnNjbHVkZSwgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICAvLyB2YWx1ZTogICAgICAgIGRhdGEudmFsdWUuZ2V0KCkgLC8vfHwgZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogLypkYXRhLnZhbHVlLmRlZmF1bHRWYWx1ZSB8fCovIGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICBjb250cm9sOiAgICAgICdodWUnLFxuICAgICAgZm9ybWF0OiAgICAgICAnaGV4JyxcbiAgICAgIGtleXdvcmRzOiAgICAgJycsXG4gICAgICBpbmxpbmU6ICAgICAgIGZhbHNlLFxuICAgICAgbGV0dGVyQ2FzZTogICAnbG93ZXJjYXNlJyxcbiAgICAgIG9wYWNpdHk6ICAgICAgdHJ1ZSxcbiAgICAgIHBvc2l0aW9uOiAgICAgXCJyaWdodCBib3R0b21cIixcbiAgICAgIHN3YXRjaGVzOiAgICAgXCIjZmZmfCMwMDB8I2YwMHwjMGYwfCMwMGZ8I2ZmMHwjMGZmXCIuc3BsaXQoJ3wnKSxcbiAgICAgIHRleHQ6ICAgICAgICAgdHJ1ZSxcbiAgICAgIGhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3Zpc2libGUgPSBmYWxzZVxuICAgICAgfSxcbiAgICAgIHNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3Zpc2libGUgPSB0cnVlO1xuICAgICAgfSxcbiAgICAgIGNoYW5nZTogZnVuY3Rpb24gKHZhbHVlLCBvcGFjaXR5KSB7XG4gICAgICAgIGRhdGEudmFsdWUuc2V0KHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LG9wdGlvbnMuY29sb3JwaWNrZXIpKTtcblxuICAgIHZhciBfZWwgPSAkKHRyYW5zY2x1ZGUucGFyZW50cygpWzBdKS5maW5kKFwiLm1pbmljb2xvcnMtcGFuZWxcIik7XG5cbiAgICB2YXIgX0hJREUgPSBmdW5jdGlvbihlKXtcbiAgICAgIGlmKF92aXNpYmxlICYmICQoZS50YXJnZXQpLnBhcmVudHMoKS5pbmRleChfZWwpID09IC0xKXtcbiAgICAgICAgdHJhbnNjbHVkZS5taW5pY29sb3JzKFwiaGlkZVwiKTtcbiAgICAgICAgJChcImJvZHlcIikub2ZmKFwibW91c2Vkb3duXCIsX0hJREUpO1xuICAgICAgfVxuICAgIH07XG4gICAgJChcImJvZHlcIikub24oXCJtb3VzZWRvd25cIixfSElERSlcbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5jb2xvcnMuanMiLCIvKlxuICogalF1ZXJ5IE1pbmlDb2xvcnM6IEEgdGlueSBjb2xvciBwaWNrZXIgYnVpbHQgb24galF1ZXJ5XG4gKlxuICogQ29weXJpZ2h0OiBDb3J5IExhVmlza2EgZm9yIEEgQmVhdXRpZnVsIFNpdGUsIExMQzogaHR0cDovL3d3dy5hYmVhdXRpZnVsc2l0ZS5uZXQvXG4gKlxuICogQ29udHJpYnV0ZTogaHR0cHM6Ly9naXRodWIuY29tL2NsYXZpc2thL2pxdWVyeS1taW5pY29sb3JzXG4gKlxuICogQGxpY2Vuc2U6IGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKi9cblxuXG5cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KGpRdWVyeSk7XG4gIH1cbn0oXG4gIGZ1bmN0aW9uICgkKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy9pZihfICYmIF8uc3R5bGVTaGVldENvbnRhaW5zICYmICFfLnN0eWxlU2hlZXRDb250YWlucygnLm1pbmljb2xvcnMnKSl7XG4gICAgLy8gIF8ubGlua0NTUyhfLnNjcmlwdFVSTCgpICsgXCIvLi4vLi4vY3NzL2pxdWVyeS5taW5pY29sb3JzLmNzc1wiKTtcbiAgICAvL31cblxuICAgIC8vIERlZmF1bHRzXG4gICAgJC5taW5pY29sb3JzID0ge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgYW5pbWF0aW9uU3BlZWQ6IDUwLFxuICAgICAgICBhbmltYXRpb25FYXNpbmc6ICdzd2luZycsXG4gICAgICAgIGNoYW5nZTogbnVsbCxcbiAgICAgICAgY2hhbmdlRGVsYXk6IDAsXG4gICAgICAgIGNvbnRyb2w6ICdodWUnLFxuICAgICAgICBkYXRhVXJpczogdHJ1ZSxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAnJyxcbiAgICAgICAgZm9ybWF0OiAnaGV4JyxcbiAgICAgICAgaGlkZTogbnVsbCxcbiAgICAgICAgaGlkZVNwZWVkOiAxMDAsXG4gICAgICAgIGlubGluZTogZmFsc2UsXG4gICAgICAgIGtleXdvcmRzOiAnJyxcbiAgICAgICAgbGV0dGVyQ2FzZTogJ2xvd2VyY2FzZScsXG4gICAgICAgIG9wYWNpdHk6IGZhbHNlLFxuICAgICAgICBwb3NpdGlvbjogJ2JvdHRvbSBsZWZ0JyxcbiAgICAgICAgc2hvdzogbnVsbCxcbiAgICAgICAgc2hvd1NwZWVkOiAxMDAsXG4gICAgICAgIHRoZW1lOiAnZGVmYXVsdCcsXG4gICAgICAgIHN3YXRjaGVzOiBbXVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBQdWJsaWMgbWV0aG9kc1xuICAgICQuZXh0ZW5kKCQuZm4sIHtcbiAgICAgIG1pbmljb2xvcnM6IGZ1bmN0aW9uKG1ldGhvZCwgZGF0YSkge1xuXG4gICAgICAgIHN3aXRjaChtZXRob2QpIHtcblxuICAgICAgICAgIC8vIERlc3Ryb3kgdGhlIGNvbnRyb2xcbiAgICAgICAgICBjYXNlICdkZXN0cm95JzpcbiAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gSGlkZSB0aGUgY29sb3IgcGlja2VyXG4gICAgICAgICAgY2FzZSAnaGlkZSc6XG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ29wYWNpdHknOlxuICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICBpZiggZGF0YSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAvLyBHZXR0ZXJcbiAgICAgICAgICAgICAgcmV0dXJuICQodGhpcykuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBTZXR0ZXJcbiAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKS5hdHRyKCdkYXRhLW9wYWNpdHknLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBHZXQgYW4gUkdCKEEpIG9iamVjdCBiYXNlZCBvbiB0aGUgY3VycmVudCBjb2xvci9vcGFjaXR5XG4gICAgICAgICAgY2FzZSAncmdiT2JqZWN0JzpcbiAgICAgICAgICAgIHJldHVybiByZ2JPYmplY3QoJCh0aGlzKSwgbWV0aG9kID09PSAncmdiYU9iamVjdCcpO1xuXG4gICAgICAgICAgLy8gR2V0IGFuIFJHQihBKSBzdHJpbmcgYmFzZWQgb24gdGhlIGN1cnJlbnQgY29sb3Ivb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ3JnYlN0cmluZyc6XG4gICAgICAgICAgY2FzZSAncmdiYVN0cmluZyc6XG4gICAgICAgICAgICByZXR1cm4gcmdiU3RyaW5nKCQodGhpcyksIG1ldGhvZCA9PT0gJ3JnYmFTdHJpbmcnKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgc2V0dGluZ3Mgb24gdGhlIGZseVxuICAgICAgICAgIGNhc2UgJ3NldHRpbmdzJzpcbiAgICAgICAgICAgIGlmKCBkYXRhID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFNldHRlclxuICAgICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9ICQodGhpcykuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpIHx8IHt9O1xuICAgICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5taW5pY29sb3JzKCQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBTaG93IHRoZSBjb2xvciBwaWNrZXJcbiAgICAgICAgICBjYXNlICdzaG93JzpcbiAgICAgICAgICAgIHNob3coICQodGhpcykuZXEoMCkgKTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gR2V0L3NldCB0aGUgaGV4IGNvbG9yIHZhbHVlXG4gICAgICAgICAgY2FzZSAndmFsdWUnOlxuICAgICAgICAgICAgaWYoIGRhdGEgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gU2V0dGVyXG4gICAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoIHR5cGVvZihkYXRhKSA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5vcGFjaXR5ICkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2RhdGEtb3BhY2l0eScsIGtlZXBXaXRoaW4oZGF0YS5vcGFjaXR5LCAwLCAxKSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5jb2xvciApIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS52YWwoZGF0YS5jb2xvcik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBJbml0aWFsaXplcyB0aGUgY29udHJvbFxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBpZiggbWV0aG9kICE9PSAnY3JlYXRlJyApIGRhdGEgPSBtZXRob2Q7XG4gICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpbml0KCQodGhpcyksIGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBpbnB1dFRleHQsIGdsb2JhbFNldHRpbmdzLCBnbG9iYWxUYXJnZXQgLCBnbG9iYWxJbnB1dCA7XG4gICAgLy8gSW5pdGlhbGl6ZSBpbnB1dCBlbGVtZW50c1xuICAgIGZ1bmN0aW9uIGluaXQoaW5wdXQsIHNldHRpbmdzKSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gJCgnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnNcIiAvPicpLFxuICAgICAgICBkZWZhdWx0cyA9ICQubWluaWNvbG9ycy5kZWZhdWx0cyxcbiAgICAgICAgc2l6ZSxcbiAgICAgICAgc3dhdGNoZXMsXG4gICAgICAgIHRleHRQYW5lbCxcbiAgICAgICAgc3dhdGNoLFxuICAgICAgICBwYW5lbCxcbiAgICAgICAgZ2xvYmFsVGFyZ2V0ID0gaW5wdXQsXG4gICAgICAgIGk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgYWxyZWFkeSBpbml0aWFsaXplZFxuICAgICAgaWYoIGlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcblxuICAgICAgLy8gSGFuZGxlIHNldHRpbmdzXG4gICAgICBnbG9iYWxTZXR0aW5ncyA9IHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBzZXR0aW5ncyk7XG5cbiAgICAgIC8vIFRoZSB3cmFwcGVyXG4gICAgICBtaW5pY29sb3JzXG4gICAgICAgIC5hZGRDbGFzcygnbWluaWNvbG9ycy10aGVtZS0nICsgc2V0dGluZ3MudGhlbWUpXG4gICAgICAgIC50b2dnbGVDbGFzcygnbWluaWNvbG9ycy13aXRoLW9wYWNpdHknLCBzZXR0aW5ncy5vcGFjaXR5KVxuICAgICAgICAudG9nZ2xlQ2xhc3MoJ21pbmljb2xvcnMtbm8tZGF0YS11cmlzJywgc2V0dGluZ3MuZGF0YVVyaXMgIT09IHRydWUpO1xuXG4gICAgICAvLyBDdXN0b20gcG9zaXRpb25pbmdcbiAgICAgIGlmKCBzZXR0aW5ncy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAkLmVhY2goc2V0dGluZ3MucG9zaXRpb24uc3BsaXQoJyAnKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbWluaWNvbG9ycy5hZGRDbGFzcygnbWluaWNvbG9ycy1wb3NpdGlvbi0nICsgdGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBJbnB1dCBzaXplXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgc2l6ZSA9IHNldHRpbmdzLm9wYWNpdHkgPyAnMjUnIDogJzIwJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpemUgPSBzZXR0aW5ncy5rZXl3b3JkcyA/ICcxMScgOiAnNyc7XG4gICAgICB9XG4gICAgICAgZ2xvYmFsSW5wdXQgPSBpbnB1dDtcbiAgICAgIC8vIFRoZSBpbnB1dFxuICAgICAgaW5wdXRcbiAgICAgICAgLmFkZENsYXNzKCdtaW5pY29sb3JzLWlucHV0JylcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnLCBmYWxzZSlcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnLCBzZXR0aW5ncylcbiAgICAgICAgLnByb3AoJ3NpemUnLCBzaXplKVxuICAgICAgICAud3JhcChtaW5pY29sb3JzKVxuICAgICAgICAuYWZ0ZXIoXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1wYW5lbCBtaW5pY29sb3JzLXNsaWRlci0nICsgc2V0dGluZ3MuY29udHJvbCArICdcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLXNsaWRlciBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLW9wYWNpdHktc2xpZGVyIG1pbmljb2xvcnMtc3ByaXRlXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1waWNrZXJcIj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZCBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZC1pbm5lclwiPjwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PGRpdj48L2Rpdj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+J1xuICAgICAgKTtcblxuICAgICAgLy8gVGhlIHN3YXRjaFxuICAgICAgaWYoICFzZXR0aW5ncy5pbmxpbmUgKSB7XG4gICAgICAgIGlucHV0LmFmdGVyKCc8c3BhbiBjbGFzcz1cIm1pbmljb2xvcnMtc3dhdGNoIG1pbmljb2xvcnMtc3ByaXRlIG1pbmljb2xvcnMtaW5wdXQtc3dhdGNoXCI+PHNwYW4gY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaC1jb2xvclwiPjwvc3Bhbj48L3NwYW4+Jyk7XG4gICAgICAgIGlucHV0Lm5leHQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJldmVudCB0ZXh0IHNlbGVjdGlvbiBpbiBJRVxuICAgICAgcGFuZWwgPSBpbnB1dC5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1wYW5lbCcpO1xuICAgICAgcGFuZWwub24oJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfSkuZW5kKCk7XG5cbiAgICAgIC8vIFN3YXRjaGVzXG4gICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGggPiA3KSB7XG4gICAgICAgICAgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoID0gNztcbiAgICAgICAgfVxuICAgICAgICBwYW5lbC5hZGRDbGFzcygnbWluaWNvbG9ycy13aXRoLXN3YXRjaGVzJyk7XG4gICAgICAgIHN3YXRjaGVzID0gJCgnPHVsIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2hlc1wiPjwvdWw+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgIHN3YXRjaCA9IHNldHRpbmdzLnN3YXRjaGVzW2ldO1xuICAgICAgICAgIHN3YXRjaCA9IGlzUmdiKHN3YXRjaCkgPyBwYXJzZVJnYihzd2F0Y2gsIHRydWUpIDogaGV4MnJnYihwYXJzZUhleChzd2F0Y2gsIHRydWUpKTtcbiAgICAgICAgICAkKCc8bGkgY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaCBtaW5pY29sb3JzLXNwcml0ZVwiPjxzcGFuIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2gtY29sb3JcIj48L3NwYW4+PC9saT4nKVxuICAgICAgICAgICAgLmFwcGVuZFRvKHN3YXRjaGVzKVxuICAgICAgICAgICAgLmRhdGEoJ3N3YXRjaC1jb2xvcicsIHNldHRpbmdzLnN3YXRjaGVzW2ldKVxuICAgICAgICAgICAgLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaC1jb2xvcicpXG4gICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiByZ2IyaGV4KHN3YXRjaCksXG4gICAgICAgICAgICAgIG9wYWNpdHk6IHN3YXRjaC5hXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBzZXR0aW5ncy5zd2F0Y2hlc1tpXSA9IHN3YXRjaDtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cblxuICAgICAgLy8gU3dhdGNoZXNcbiAgICAgIGlmIChzZXR0aW5ncy50ZXh0KSB7XG4gICAgICAgIHBhbmVsLmFkZENsYXNzKCdtaW5pY29sb3JzLXdpdGgtdGV4dCcpO1xuICAgICAgICB0ZXh0UGFuZWwgPSAkKCc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy10ZXh0XCI+PC9kaXY+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBpbnB1dFRleHQgPSAkKCc8aW5wdXQgdHlwZT1cInRleHRcIj4nKVxuICAgICAgICAgIC5hcHBlbmRUbyh0ZXh0UGFuZWwpO1xuXG4gICAgICAgICQoaW5wdXRUZXh0KS5jaGFuZ2UoZnVuY3Rpb24oKXtcbiAgICAgICAgICBpbnB1dC52YWwoaW5wdXRUZXh0LnZhbCgpKTtcbiAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIHRydWUpO1xuICAgICAgICB9KVxuXG4gICAgICB9XG5cbiAgICAgIC8vIElubGluZSBjb250cm9sc1xuICAgICAgaWYoIHNldHRpbmdzLmlubGluZSApIGlucHV0LnBhcmVudCgpLmFkZENsYXNzKCdtaW5pY29sb3JzLWlubGluZScpO1xuXG4gICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIGZhbHNlKTtcblxuICAgICAgaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcsIHRydWUpO1xuXG4gICAgfVxuXG4gICAgLy8gUmV0dXJucyB0aGUgaW5wdXQgYmFjayB0byBpdHMgb3JpZ2luYWwgc3RhdGVcbiAgICBmdW5jdGlvbiBkZXN0cm95KGlucHV0KSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCk7XG5cbiAgICAgIC8vIFJldmVydCB0aGUgaW5wdXQgZWxlbWVudFxuICAgICAgaW5wdXRcbiAgICAgICAgLnJlbW92ZURhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKVxuICAgICAgICAucmVtb3ZlRGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpXG4gICAgICAgIC5yZW1vdmVQcm9wKCdzaXplJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdtaW5pY29sb3JzLWlucHV0Jyk7XG5cbiAgICAgIC8vIFJlbW92ZSB0aGUgd3JhcCBhbmQgZGVzdHJveSB3aGF0ZXZlciByZW1haW5zXG4gICAgICBtaW5pY29sb3JzLmJlZm9yZShpbnB1dCkucmVtb3ZlKCk7XG5cbiAgICB9XG5cbiAgICAvLyBTaG93cyB0aGUgc3BlY2lmaWVkIGRyb3Bkb3duIHBhbmVsXG4gICAgZnVuY3Rpb24gc2hvdyhpbnB1dCkge1xuXG4gICAgICB2YXIgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpLFxuICAgICAgICBwYW5lbCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgdW5pbml0aWFsaXplZCwgZGlzYWJsZWQsIGlubGluZSwgb3IgYWxyZWFkeSBvcGVuXG4gICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSB8fFxuICAgICAgICBpbnB1dC5wcm9wKCdkaXNhYmxlZCcpIHx8XG4gICAgICAgIG1pbmljb2xvcnMuaGFzQ2xhc3MoJ21pbmljb2xvcnMtaW5saW5lJykgfHxcbiAgICAgICAgbWluaWNvbG9ycy5oYXNDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpXG4gICAgICApIHJldHVybjtcblxuICAgICAgaGlkZSgpO1xuXG4gICAgICBtaW5pY29sb3JzLmFkZENsYXNzKCdtaW5pY29sb3JzLWZvY3VzJyk7XG4gICAgICBwYW5lbFxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuZmFkZUluKHNldHRpbmdzLnNob3dTcGVlZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIHNldHRpbmdzLnNob3cgKSBzZXR0aW5ncy5zaG93LmNhbGwoaW5wdXQuZ2V0KDApKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvLyBIaWRlcyBhbGwgZHJvcGRvd24gcGFuZWxzXG4gICAgZnVuY3Rpb24gaGlkZSgpIHtcblxuICAgICAgJCgnLm1pbmljb2xvcnMtZm9jdXMnKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgbWluaWNvbG9ycyA9ICQodGhpcyksXG4gICAgICAgICAgaW5wdXQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0JyksXG4gICAgICAgICAgcGFuZWwgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXBhbmVsJyksXG4gICAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgICAgcGFuZWwuZmFkZU91dChzZXR0aW5ncy5oaWRlU3BlZWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBzZXR0aW5ncy5oaWRlICkgc2V0dGluZ3MuaGlkZS5jYWxsKGlucHV0LmdldCgwKSk7XG4gICAgICAgICAgbWluaWNvbG9ycy5yZW1vdmVDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpO1xuICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTW92ZXMgdGhlIHNlbGVjdGVkIHBpY2tlclxuICAgIGZ1bmN0aW9uIG1vdmUodGFyZ2V0LCBldmVudCwgYW5pbWF0ZSkge1xuXG4gICAgICB2YXIgaW5wdXQgPSAgdGFyZ2V0LnBhcmVudHMoJy5taW5pY29sb3JzJykuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHBpY2tlciA9IHRhcmdldC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9mZnNldFggPSB0YXJnZXQub2Zmc2V0KCkubGVmdCxcbiAgICAgICAgb2Zmc2V0WSA9IHRhcmdldC5vZmZzZXQoKS50b3AsXG4gICAgICAgIHggPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VYIC0gb2Zmc2V0WCksXG4gICAgICAgIHkgPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VZIC0gb2Zmc2V0WSksXG4gICAgICAgIGR1cmF0aW9uID0gYW5pbWF0ZSA/IHNldHRpbmdzLmFuaW1hdGlvblNwZWVkIDogMCxcbiAgICAgICAgd3gsIHd5LCByLCBwaGk7XG5cbiAgICAgIC8vIFRvdWNoIHN1cHBvcnRcbiAgICAgIGlmKCBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzICkge1xuICAgICAgICB4ID0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCAtIG9mZnNldFg7XG4gICAgICAgIHkgPSBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIC0gb2Zmc2V0WTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29uc3RyYWluIHBpY2tlciB0byBpdHMgY29udGFpbmVyXG4gICAgICBpZiggeCA8IDAgKSB4ID0gMDtcbiAgICAgIGlmKCB5IDwgMCApIHkgPSAwO1xuICAgICAgaWYoIHggPiB0YXJnZXQud2lkdGgoKSApIHggPSB0YXJnZXQud2lkdGgoKTtcbiAgICAgIGlmKCB5ID4gdGFyZ2V0LmhlaWdodCgpICkgeSA9IHRhcmdldC5oZWlnaHQoKTtcblxuICAgICAgLy8gQ29uc3RyYWluIGNvbG9yIHdoZWVsIHZhbHVlcyB0byB0aGUgd2hlZWxcbiAgICAgIGlmKCB0YXJnZXQucGFyZW50KCkuaXMoJy5taW5pY29sb3JzLXNsaWRlci13aGVlbCcpICYmIHBpY2tlci5wYXJlbnQoKS5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICB3eCA9IDc1IC0geDtcbiAgICAgICAgd3kgPSA3NSAtIHk7XG4gICAgICAgIHIgPSBNYXRoLnNxcnQod3ggKiB3eCArIHd5ICogd3kpO1xuICAgICAgICBwaGkgPSBNYXRoLmF0YW4yKHd5LCB3eCk7XG4gICAgICAgIGlmKCBwaGkgPCAwICkgcGhpICs9IE1hdGguUEkgKiAyO1xuICAgICAgICBpZiggciA+IDc1ICkge1xuICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICB4ID0gNzUgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICB5ID0gNzUgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgfVxuICAgICAgICB4ID0gTWF0aC5yb3VuZCh4KTtcbiAgICAgICAgeSA9IE1hdGgucm91bmQoeSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgdGhlIHBpY2tlclxuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0sIGR1cmF0aW9uLCBzZXR0aW5ncy5hbmltYXRpb25FYXNpbmcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdXBkYXRlRnJvbUNvbnRyb2woaW5wdXQsIHRhcmdldCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCdcbiAgICAgICAgICB9LCBkdXJhdGlvbiwgc2V0dGluZ3MuYW5pbWF0aW9uRWFzaW5nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHVwZGF0ZUZyb21Db250cm9sKGlucHV0LCB0YXJnZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gU2V0cyB0aGUgaW5wdXQgYmFzZWQgb24gdGhlIGNvbG9yIHBpY2tlciB2YWx1ZXNcbiAgICBmdW5jdGlvbiB1cGRhdGVGcm9tQ29udHJvbChpbnB1dCwgdGFyZ2V0KSB7XG5cbiAgICAgIGZ1bmN0aW9uIGdldENvb3JkcyhwaWNrZXIsIGNvbnRhaW5lcikge1xuXG4gICAgICAgIHZhciBsZWZ0LCB0b3A7XG4gICAgICAgIGlmKCAhcGlja2VyLmxlbmd0aCB8fCAhY29udGFpbmVyICkgcmV0dXJuIG51bGw7XG4gICAgICAgIGxlZnQgPSBwaWNrZXIub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgdG9wID0gcGlja2VyLm9mZnNldCgpLnRvcDtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHg6IGxlZnQgLSBjb250YWluZXIub2Zmc2V0KCkubGVmdCArIChwaWNrZXIub3V0ZXJXaWR0aCgpIC8gMiksXG4gICAgICAgICAgeTogdG9wIC0gY29udGFpbmVyLm9mZnNldCgpLnRvcCArIChwaWNrZXIub3V0ZXJIZWlnaHQoKSAvIDIpXG4gICAgICAgIH07XG5cbiAgICAgIH1cblxuICAgICAgdmFyIGh1ZSwgc2F0dXJhdGlvbiwgYnJpZ2h0bmVzcywgeCwgeSwgciwgcGhpLFxuXG4gICAgICAgIGhleCA9IGlucHV0LnZhbCgpLFxuICAgICAgICBvcGFjaXR5ID0gaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JyksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLFxuXG4gICAgICAvLyBQYW5lbCBvYmplY3RzXG4gICAgICAgIGdyaWQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWdyaWQnKSxcbiAgICAgICAgc2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1zbGlkZXInKSxcbiAgICAgICAgb3BhY2l0eVNsaWRlciA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtb3BhY2l0eS1zbGlkZXInKSxcblxuICAgICAgLy8gUGlja2VyIG9iamVjdHNcbiAgICAgICAgZ3JpZFBpY2tlciA9IGdyaWQuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBzbGlkZXJQaWNrZXIgPSBzbGlkZXIuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBvcGFjaXR5UGlja2VyID0gb3BhY2l0eVNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG5cbiAgICAgIC8vIFBpY2tlciBwb3NpdGlvbnNcbiAgICAgICAgZ3JpZFBvcyA9IGdldENvb3JkcyhncmlkUGlja2VyLCBncmlkKSxcbiAgICAgICAgc2xpZGVyUG9zID0gZ2V0Q29vcmRzKHNsaWRlclBpY2tlciwgc2xpZGVyKSxcbiAgICAgICAgb3BhY2l0eVBvcyA9IGdldENvb3JkcyhvcGFjaXR5UGlja2VyLCBvcGFjaXR5U2xpZGVyKTtcblxuICAgICAgLy8gSGFuZGxlIGNvbG9yc1xuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCwgLm1pbmljb2xvcnMtc2xpZGVyLCAubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpICkge1xuXG4gICAgICAgIC8vIERldGVybWluZSBIU0IgdmFsdWVzXG4gICAgICAgIHN3aXRjaChzZXR0aW5ncy5jb250cm9sKSB7XG5cbiAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgeCA9IChncmlkLndpZHRoKCkgLyAyKSAtIGdyaWRQb3MueDtcbiAgICAgICAgICAgIHkgPSAoZ3JpZC5oZWlnaHQoKSAvIDIpIC0gZ3JpZFBvcy55O1xuICAgICAgICAgICAgciA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcbiAgICAgICAgICAgIHBoaSA9IE1hdGguYXRhbjIoeSwgeCk7XG4gICAgICAgICAgICBpZiggcGhpIDwgMCApIHBoaSArPSBNYXRoLlBJICogMjtcbiAgICAgICAgICAgIGlmKCByID4gNzUgKSB7XG4gICAgICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy54ID0gNjkgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy55ID0gNjkgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKHIgLyAwLjc1LCAwLCAxMDApO1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbihwaGkgKiAxODAgLyBNYXRoLlBJLCAwLCAzNjApO1xuICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGtlZXBXaXRoaW4oMTAwIC0gTWF0aC5mbG9vcihzbGlkZXJQb3MueSAqICgxMDAgLyBzbGlkZXIuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIHNsaWRlci5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBodWUsIHM6IHNhdHVyYXRpb24sIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3NhdHVyYXRpb24nOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBicmlnaHRuZXNzID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKGdyaWRQb3MueSAqICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IGJyaWdodG5lc3MgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5Jywgc2F0dXJhdGlvbiAvIDEwMCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2JyaWdodG5lc3MnOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiBzYXR1cmF0aW9uLCBiOiAxMDAgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5JywgMSAtIChicmlnaHRuZXNzIC8gMTAwKSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbigzNjAgLSBwYXJzZUludChzbGlkZXJQb3MueSAqICgzNjAgLyBzbGlkZXIuaGVpZ2h0KCkpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICBzYXR1cmF0aW9uID0ga2VlcFdpdGhpbihNYXRoLmZsb29yKGdyaWRQb3MueCAqICgxMDAgLyBncmlkLndpZHRoKCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIGdyaWQuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIG9wYWNpdHlcbiAgICAgICAgaWYoIHNldHRpbmdzLm9wYWNpdHkgKSB7XG4gICAgICAgICAgb3BhY2l0eSA9IHBhcnNlRmxvYXQoMSAtIChvcGFjaXR5UG9zLnkgLyBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKSkudG9GaXhlZCgyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvcGFjaXR5ID0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHVwZGF0ZUlucHV0KGlucHV0LCBoZXgsIG9wYWNpdHkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIFNldCBzd2F0Y2ggY29sb3JcbiAgICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaGV4LFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgICBkb0NoYW5nZShpbnB1dCwgaGV4LCBvcGFjaXR5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYW5kIGRvZXMgdGhlIGFwcHJvcHJpYXRlIGNvbnZlcnNpb25zXG4gICAgLy8gdG8gcmVzcGVjdCBzZXR0aW5ncywgYWxzbyB1cGRhdGVzIHRoZSBzd2F0Y2hcbiAgICBmdW5jdGlvbiB1cGRhdGVJbnB1dChpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcbiAgICAgIHZhciByZ2IsXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpO1xuXG4gICAgICBpZiggc2V0dGluZ3Mub3BhY2l0eSApIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIG9wYWNpdHkpO1xuXG4gICAgICAvLyBTZXQgY29sb3Igc3RyaW5nXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgLy8gUmV0dXJucyBSR0IoQSkgc3RyaW5nXG5cbiAgICAgICAgLy8gQ2hlY2tzIGZvciBpbnB1dCBmb3JtYXQgYW5kIGRvZXMgdGhlIGNvbnZlcnNpb25cbiAgICAgICAgaWYgKCBpc1JnYih2YWx1ZSkgKSB7XG4gICAgICAgICAgcmdiID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJnYiA9IGhleDJyZ2IocGFyc2VIZXgodmFsdWUsIHRydWUpKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKCBwYXJzZUZsb2F0KCBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSApLnRvRml4ZWQoMiksIDAsIDEgKTtcbiAgICAgICAgaWYoIGlzTmFOKCBvcGFjaXR5ICkgfHwgIXNldHRpbmdzLm9wYWNpdHkgKSBvcGFjaXR5ID0gMTtcblxuICAgICAgICBpZiggaW5wdXQubWluaWNvbG9ycygncmdiT2JqZWN0JykuYSA8PSAxICYmIHJnYiAmJiBzZXR0aW5ncy5vcGFjaXR5KSB7XG4gICAgICAgICAgLy8gU2V0IFJHQkEgc3RyaW5nIGlmIGFscGhhXG4gICAgICAgICAgdmFsdWUgPSAncmdiYSgnICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnLCAnICsgcGFyc2VGbG9hdCggb3BhY2l0eSApICsgJyknO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFNldCBSR0Igc3RyaW5nIChhbHBoYSA9IDEpXG4gICAgICAgICAgdmFsdWUgPSAncmdiKCcgKyByZ2IuciArICcsICcgKyByZ2IuZyArICcsICcgKyByZ2IuYiArICcpJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmV0dXJucyBoZXggY29sb3JcblxuICAgICAgICAvLyBDaGVja3MgZm9yIGlucHV0IGZvcm1hdCBhbmQgZG9lcyB0aGUgY29udmVyc2lvblxuICAgICAgICBpZiAoIGlzUmdiKHZhbHVlKSApIHtcbiAgICAgICAgICB2YWx1ZSA9IHJnYlN0cmluZzJoZXgodmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFsdWUgPSBjb252ZXJ0Q2FzZSggdmFsdWUsIHNldHRpbmdzLmxldHRlckNhc2UgKTtcbiAgICAgIH1cblxuXG5cblxuICAgICAgLy8gVXBkYXRlIHZhbHVlIGZyb20gcGlja2VyXG4gICAgICAvL2dsb2JhbElucHV0LnZhbCggdmFsdWUgKTtcbiAgICAgIGlucHV0LnZhbCggdmFsdWUgKTtcblxuICAgICAgaWYoaW5wdXRUZXh0KXtcbiAgICAgICAgaW5wdXRUZXh0LnZhbCh2YWx1ZSk7XG4gICAgICB9XG5cblxuICAgICAgLy8gU2V0IHN3YXRjaCBjb2xvclxuICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHZhbHVlLFxuICAgICAgICBvcGFjaXR5OiBvcGFjaXR5XG4gICAgICB9KTtcblxuICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgZG9DaGFuZ2UoaW5wdXQsIHZhbHVlLCBvcGFjaXR5KTtcbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSBjb2xvciBwaWNrZXIgdmFsdWVzIGZyb20gdGhlIGlucHV0XG4gICAgZnVuY3Rpb24gdXBkYXRlRnJvbUlucHV0KGlucHV0LCBwcmVzZXJ2ZUlucHV0VmFsdWUpIHtcbiAgICAgdmFyICBzZXR0aW5ncyA9IGdsb2JhbFNldHRpbmdzO1xuICAgICAgdmFyIGhleCxcbiAgICAgICAgaHNiLFxuICAgICAgICBvcGFjaXR5LFxuICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgYWxwaGEsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICB4LCB5LCByLCBwaGksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAvLyAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHN3YXRjaCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJyksXG5cbiAgICAgIC8vIFBhbmVsIG9iamVjdHNcbiAgICAgICAgZ3JpZCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZCcpLFxuICAgICAgICBzbGlkZXIgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXNsaWRlcicpLFxuICAgICAgICBvcGFjaXR5U2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpLFxuXG4gICAgICAvLyBQaWNrZXIgb2JqZWN0c1xuICAgICAgICBncmlkUGlja2VyID0gZ3JpZC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIHNsaWRlclBpY2tlciA9IHNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9wYWNpdHlQaWNrZXIgPSBvcGFjaXR5U2xpZGVyLmZpbmQoJ1tjbGFzcyQ9LXBpY2tlcl0nKTtcblxuICAgICAgLy8gRGV0ZXJtaW5lIGhleC9IU0IgdmFsdWVzXG4gICAgICBpZiggaXNSZ2IoaW5wdXQudmFsKCkpICkge1xuICAgICAgICAvLyBJZiBpbnB1dCB2YWx1ZSBpcyBhIHJnYihhKSBzdHJpbmcsIGNvbnZlcnQgaXQgdG8gaGV4IGNvbG9yIGFuZCB1cGRhdGUgb3BhY2l0eVxuICAgICAgICBoZXggPSByZ2JTdHJpbmcyaGV4KGlucHV0LnZhbCgpKTtcbiAgICAgICAgYWxwaGEgPSBrZWVwV2l0aGluKHBhcnNlRmxvYXQoZ2V0QWxwaGEoaW5wdXQudmFsKCkpKS50b0ZpeGVkKDIpLCAwLCAxKTtcbiAgICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICAgIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIGFscGhhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VIZXgoaW5wdXQudmFsKCksIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cblxuICAgICAgaWYoICFoZXggKXtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VJbnB1dChzZXR0aW5ncy5kZWZhdWx0VmFsdWUsIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cbiAgICAgIGhzYiA9IGhleDJoc2IoaGV4KTtcblxuICAgICAgLy8gR2V0IGFycmF5IG9mIGxvd2VyY2FzZSBrZXl3b3Jkc1xuICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgcmV0dXJuICQudHJpbShhLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgIGlmKCBpbnB1dC52YWwoKSAhPT0gJycgJiYgJC5pbkFycmF5KGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCksIGtleXdvcmRzKSA+IC0xICkge1xuICAgICAgICB2YWx1ZSA9IGNvbnZlcnRDYXNlKGlucHV0LnZhbCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlID0gaXNSZ2IoaW5wdXQudmFsKCkpID8gcGFyc2VSZ2IoaW5wdXQudmFsKCkpIDogaGV4O1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgaW5wdXQgdmFsdWVcbiAgICAgIGlmKCAhcHJlc2VydmVJbnB1dFZhbHVlICl7XG4gICAgICAgIGdsb2JhbElucHV0LnZhbCh2YWx1ZSk7XG5cbiAgICAgICAgaW5wdXRUZXh0ICYmIGlucHV0VGV4dC52YWwodmFsdWUpO1xuICAgICAgfVxuICAgICAgZ2xvYmFsU2V0dGluZ3MgPSBzZXR0aW5nc1xuICAgICAgLy8gRGV0ZXJtaW5lIG9wYWNpdHkgdmFsdWVcbiAgICAgIGlmKCBzZXR0aW5ncy5vcGFjaXR5ICkge1xuICAgICAgICAvLyBHZXQgZnJvbSBkYXRhLW9wYWNpdHkgYXR0cmlidXRlIGFuZCBrZWVwIHdpdGhpbiAwLTEgcmFuZ2VcbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKHBhcnNlRmxvYXQoaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JykpLnRvRml4ZWQoMiksIDAsIDEpO1xuICAgICAgICBpZiggaXNOYU4ob3BhY2l0eSkgKSBvcGFjaXR5ID0gMTtcbiAgICAgICAgaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7XG5cbiAgICAgICAgLy8gU2V0IG9wYWNpdHkgcGlja2VyIHBvc2l0aW9uXG4gICAgICAgIHkgPSBrZWVwV2l0aGluKG9wYWNpdHlTbGlkZXIuaGVpZ2h0KCkgLSAob3BhY2l0eVNsaWRlci5oZWlnaHQoKSAqIG9wYWNpdHkpLCAwLCBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgb3BhY2l0eVBpY2tlci5jc3MoJ3RvcCcsIHkgKyAncHgnKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IG9wYWNpdHkgdG8gemVybyBpZiBpbnB1dCB2YWx1ZSBpcyB0cmFuc3BhcmVudFxuICAgICAgaWYoIGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCkgPT09ICd0cmFuc3BhcmVudCcgKSB7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5JywgMCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBzd2F0Y2hcbiAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoZXgpO1xuXG4gICAgICAvLyBEZXRlcm1pbmUgcGlja2VyIGxvY2F0aW9uc1xuICAgICAgc3dpdGNoKHNldHRpbmdzLmNvbnRyb2wpIHtcblxuICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICByID0ga2VlcFdpdGhpbihNYXRoLmNlaWwoaHNiLnMgKiAwLjc1KSwgMCwgZ3JpZC5oZWlnaHQoKSAvIDIpO1xuICAgICAgICAgIHBoaSA9IGhzYi5oICogTWF0aC5QSSAvIDE4MDtcbiAgICAgICAgICB4ID0ga2VlcFdpdGhpbig3NSAtIE1hdGguY29zKHBoaSkgKiByLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKDc1IC0gTWF0aC5zaW4ocGhpKSAqIHIsIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSAxNTAgLSAoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpO1xuICAgICAgICAgIGlmKCBoZXggPT09ICcnICkgeSA9IDA7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGhzYi5oLCBzOiBoc2IucywgYjogMTAwIH0pKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdzYXR1cmF0aW9uJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IuYiAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IucyAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IDEwMCwgYjogaHNiLmIgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIGhzYi5zIC8gMTAwKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdicmlnaHRuZXNzJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IucyAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IuYiAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IGhzYi5zLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIDEgLSAoaHNiLmIgLyAxMDApKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIC8vIFNldCBncmlkIHBvc2l0aW9uXG4gICAgICAgICAgeCA9IGtlZXBXaXRoaW4oTWF0aC5jZWlsKGhzYi5zIC8gKDEwMCAvIGdyaWQud2lkdGgoKSkpLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKGdyaWQuaGVpZ2h0KCkgLSBNYXRoLmNlaWwoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpLCAwLCBncmlkLmhlaWdodCgpKTtcbiAgICAgICAgICBncmlkUGlja2VyLmNzcyh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbihzbGlkZXIuaGVpZ2h0KCkgLSAoaHNiLmggLyAoMzYwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIHNsaWRlci5oZWlnaHQoKSk7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgZ3JpZC5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBoc2IuaCwgczogMTAwLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICB9XG5cbiAgICAgIC8vIEZpcmUgY2hhbmdlIGV2ZW50LCBidXQgb25seSBpZiBtaW5pY29sb3JzIGlzIGZ1bGx5IGluaXRpYWxpemVkXG4gICAgICBpZiggaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkge1xuICAgICAgICBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gUnVucyB0aGUgY2hhbmdlIGFuZCBjaGFuZ2VEZWxheSBjYWxsYmFja3NcbiAgICBmdW5jdGlvbiBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcblxuICAgICAgdmFyIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBsYXN0Q2hhbmdlID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1sYXN0Q2hhbmdlJyksXG4gICAgICAgIG9iaixcbiAgICAgICAgc2VsLFxuICAgICAgICBpO1xuXG4gICAgICAvLyBPbmx5IHJ1biBpZiBpdCBhY3R1YWxseSBjaGFuZ2VkXG4gICAgICBpZiggIWxhc3RDaGFuZ2UgfHwgbGFzdENoYW5nZS52YWx1ZSAhPT0gdmFsdWUgfHwgbGFzdENoYW5nZS5vcGFjaXR5ICE9PSBvcGFjaXR5ICkge1xuXG4gICAgICAgIC8vIFJlbWVtYmVyIGxhc3QtY2hhbmdlZCB2YWx1ZVxuICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWxhc3RDaGFuZ2UnLCB7XG4gICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2hlY2sgYW5kIHNlbGVjdCBhcHBsaWNhYmxlIHN3YXRjaFxuICAgICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgaWYoIWlzUmdiKHZhbHVlKSkge1xuICAgICAgICAgICAgb2JqID0gaGV4MnJnYih2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb2JqID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWwgPSAtMTtcbiAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKG9iai5yID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5yICYmIG9iai5nID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5nICYmIG9iai5iID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5iICYmIG9iai5hID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5hKSB7XG4gICAgICAgICAgICAgIHNlbCA9IGk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlucHV0LnBhcmVudCgpLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaGVzIC5taW5pY29sb3JzLXN3YXRjaCcpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgIGlmIChpICE9PSAtMSkge1xuICAgICAgICAgICAgaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtc3dhdGNoZXMgLm1pbmljb2xvcnMtc3dhdGNoJykuZXEoaSkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlyZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgaWYoIHNldHRpbmdzLmNoYW5nZSApIHtcbiAgICAgICAgICBpZiggc2V0dGluZ3MuY2hhbmdlRGVsYXkgKSB7XG4gICAgICAgICAgICAvLyBDYWxsIGFmdGVyIGEgZGVsYXlcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnKSk7XG4gICAgICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnLCBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3MuY2hhbmdlLmNhbGwoaW5wdXQuZ2V0KDApLCB2YWx1ZSwgb3BhY2l0eSk7XG4gICAgICAgICAgICB9LCBzZXR0aW5ncy5jaGFuZ2VEZWxheSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBDYWxsIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICBzZXR0aW5ncy5jaGFuZ2UuY2FsbChpbnB1dC5nZXQoMCksIHZhbHVlLCBvcGFjaXR5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaW5wdXQudHJpZ2dlcignY2hhbmdlJykudHJpZ2dlcignaW5wdXQnKTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgb2JqZWN0IGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiT2JqZWN0KGlucHV0KSB7XG4gICAgICB2YXIgaGV4ID0gcGFyc2VIZXgoJChpbnB1dCkudmFsKCksIHRydWUpLFxuICAgICAgICByZ2IgPSBoZXgycmdiKGhleCksXG4gICAgICAgIG9wYWNpdHkgPSAkKGlucHV0KS5hdHRyKCdkYXRhLW9wYWNpdHknKTtcbiAgICAgIGlmKCAhcmdiICkgcmV0dXJuIG51bGw7XG4gICAgICBpZiggb3BhY2l0eSAhPT0gdW5kZWZpbmVkICkgJC5leHRlbmQocmdiLCB7IGE6IHBhcnNlRmxvYXQob3BhY2l0eSkgfSk7XG4gICAgICByZXR1cm4gcmdiO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgc3RyaW5nIGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiU3RyaW5nKGlucHV0LCBhbHBoYSkge1xuICAgICAgdmFyIGhleCA9IHBhcnNlSGV4KCQoaW5wdXQpLnZhbCgpLCB0cnVlKSxcbiAgICAgICAgcmdiID0gaGV4MnJnYihoZXgpLFxuICAgICAgICBvcGFjaXR5ID0gJChpbnB1dCkuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICBpZiggIXJnYiApIHJldHVybiBudWxsO1xuICAgICAgaWYoIG9wYWNpdHkgPT09IHVuZGVmaW5lZCApIG9wYWNpdHkgPSAxO1xuICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICByZXR1cm4gJ3JnYmEoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJywgJyArIHBhcnNlRmxvYXQob3BhY2l0eSkgKyAnKSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3JnYignICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnKSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgdG8gdGhlIGxldHRlciBjYXNlIHNwZWNpZmllZCBpbiBzZXR0aW5nc1xuICAgIGZ1bmN0aW9uIGNvbnZlcnRDYXNlKHN0cmluZywgbGV0dGVyQ2FzZSkge1xuICAgICAgcmV0dXJuIGxldHRlckNhc2UgPT09ICd1cHBlcmNhc2UnID8gc3RyaW5nLnRvVXBwZXJDYXNlKCkgOiBzdHJpbmcudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZXMgYSBzdHJpbmcgYW5kIHJldHVybnMgYSB2YWxpZCBoZXggc3RyaW5nIHdoZW4gcG9zc2libGVcbiAgICBmdW5jdGlvbiBwYXJzZUhleChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL14jL2csICcnKTtcbiAgICAgIGlmKCAhc3RyaW5nLm1hdGNoKC9eW0EtRjAtOV17Myw2fS9pZykgKSByZXR1cm4gJyc7XG4gICAgICBpZiggc3RyaW5nLmxlbmd0aCAhPT0gMyAmJiBzdHJpbmcubGVuZ3RoICE9PSA2ICkgcmV0dXJuICcnO1xuICAgICAgaWYoIHN0cmluZy5sZW5ndGggPT09IDMgJiYgZXhwYW5kICkge1xuICAgICAgICBzdHJpbmcgPSBzdHJpbmdbMF0gKyBzdHJpbmdbMF0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMl0gKyBzdHJpbmdbMl07XG4gICAgICB9XG4gICAgICByZXR1cm4gJyMnICsgc3RyaW5nO1xuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIFJHQihBKSBzdHJpbmcgd2hlbiBwb3NzaWJsZVxuICAgIGZ1bmN0aW9uIHBhcnNlUmdiKHN0cmluZywgb2JqKSB7XG5cbiAgICAgIHZhciB2YWx1ZXMgPSBzdHJpbmcucmVwbGFjZSgvW15cXGQsLl0vZywgJycpLFxuICAgICAgICByZ2JhID0gdmFsdWVzLnNwbGl0KCcsJyk7XG5cbiAgICAgIHJnYmFbMF0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMF0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMV0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMV0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMl0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMl0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIGlmKCByZ2JhWzNdICkge1xuICAgICAgICByZ2JhWzNdID0ga2VlcFdpdGhpbihwYXJzZUZsb2F0KHJnYmFbM10sIDEwKSwgMCwgMSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBSR0JBIG9iamVjdFxuICAgICAgaWYoIG9iaiApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByOiByZ2JhWzBdLFxuICAgICAgICAgIGc6IHJnYmFbMV0sXG4gICAgICAgICAgYjogcmdiYVsyXSxcbiAgICAgICAgICBhOiByZ2JhWzNdID8gcmdiYVszXSA6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIFJHQkEgc3RyaW5nXG4gICAgICBpZiggdHlwZW9mKHJnYmFbM10pICE9PSAndW5kZWZpbmVkJyAmJiByZ2JhWzNdIDw9IDEgKSB7XG4gICAgICAgIHJldHVybiAncmdiYSgnICsgcmdiYVswXSArICcsICcgKyByZ2JhWzFdICsgJywgJyArIHJnYmFbMl0gKyAnLCAnICsgcmdiYVszXSArICcpJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAncmdiKCcgKyByZ2JhWzBdICsgJywgJyArIHJnYmFbMV0gKyAnLCAnICsgcmdiYVsyXSArICcpJztcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIGNvbG9yIHN0cmluZyB3aGVuIHBvc3NpYmxlXG4gICAgZnVuY3Rpb24gcGFyc2VJbnB1dChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgaWYoIGlzUmdiKHN0cmluZykgKSB7XG4gICAgICAgIC8vIFJldHVybnMgYSB2YWxpZCByZ2IoYSkgc3RyaW5nXG4gICAgICAgIHJldHVybiBwYXJzZVJnYihzdHJpbmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSGV4KHN0cmluZywgZXhwYW5kKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBLZWVwcyB2YWx1ZSB3aXRoaW4gbWluIGFuZCBtYXhcbiAgICBmdW5jdGlvbiBrZWVwV2l0aGluKHZhbHVlLCBtaW4sIG1heCkge1xuICAgICAgaWYoIHZhbHVlIDwgbWluICkgdmFsdWUgPSBtaW47XG4gICAgICBpZiggdmFsdWUgPiBtYXggKSB2YWx1ZSA9IG1heDtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVja3MgaWYgYSBzdHJpbmcgaXMgYSB2YWxpZCBSR0IoQSkgc3RyaW5nXG4gICAgZnVuY3Rpb24gaXNSZ2Ioc3RyaW5nKSB7XG4gICAgICB2YXIgcmdiID0gc3RyaW5nLm1hdGNoKC9ecmdiYT9bXFxzK10/XFwoW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYiAmJiByZ2IubGVuZ3RoID09PSA0KSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBGdW5jdGlvbiB0byBnZXQgYWxwaGEgZnJvbSBhIFJHQihBKSBzdHJpbmdcbiAgICBmdW5jdGlvbiBnZXRBbHBoYShyZ2JhKSB7XG4gICAgICByZ2JhID0gcmdiYS5tYXRjaCgvXnJnYmE/W1xccytdP1xcKFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKyhcXC5cXGR7MSwyfSk/fFxcLlxcZHsxLDJ9KVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYmEgJiYgcmdiYS5sZW5ndGggPT09IDYpID8gcmdiYVs0XSA6ICcxJztcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhbiBIU0Igb2JqZWN0IHRvIGFuIFJHQiBvYmplY3RcbiAgICBmdW5jdGlvbiBoc2IycmdiKGhzYikge1xuICAgICAgdmFyIHJnYiA9IHt9O1xuICAgICAgdmFyIGggPSBNYXRoLnJvdW5kKGhzYi5oKTtcbiAgICAgIHZhciBzID0gTWF0aC5yb3VuZChoc2IucyAqIDI1NSAvIDEwMCk7XG4gICAgICB2YXIgdiA9IE1hdGgucm91bmQoaHNiLmIgKiAyNTUgLyAxMDApO1xuICAgICAgaWYocyA9PT0gMCkge1xuICAgICAgICByZ2IuciA9IHJnYi5nID0gcmdiLmIgPSB2O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHQxID0gdjtcbiAgICAgICAgdmFyIHQyID0gKDI1NSAtIHMpICogdiAvIDI1NTtcbiAgICAgICAgdmFyIHQzID0gKHQxIC0gdDIpICogKGggJSA2MCkgLyA2MDtcbiAgICAgICAgaWYoIGggPT09IDM2MCApIGggPSAwO1xuICAgICAgICBpZiggaCA8IDYwICkgeyByZ2IuciA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuZyA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDEyMCApIHtyZ2IuZyA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuciA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDE4MCApIHtyZ2IuZyA9IHQxOyByZ2IuciA9IHQyOyByZ2IuYiA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDI0MCApIHtyZ2IuYiA9IHQxOyByZ2IuciA9IHQyOyByZ2IuZyA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDMwMCApIHtyZ2IuYiA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuciA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDM2MCApIHtyZ2IuciA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuYiA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSB7IHJnYi5yID0gMDsgcmdiLmcgPSAwOyByZ2IuYiA9IDA7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHI6IE1hdGgucm91bmQocmdiLnIpLFxuICAgICAgICBnOiBNYXRoLnJvdW5kKHJnYi5nKSxcbiAgICAgICAgYjogTWF0aC5yb3VuZChyZ2IuYilcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIHN0cmluZyB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2JTdHJpbmcyaGV4KHJnYil7XG4gICAgICByZ2IgPSByZ2IubWF0Y2goL15yZ2JhP1tcXHMrXT9cXChbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPy9pKTtcbiAgICAgIHJldHVybiAocmdiICYmIHJnYi5sZW5ndGggPT09IDQpID8gJyMnICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMV0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMl0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbM10sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpIDogJyc7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2IyaGV4KHJnYikge1xuICAgICAgdmFyIGhleCA9IFtcbiAgICAgICAgcmdiLnIudG9TdHJpbmcoMTYpLFxuICAgICAgICByZ2IuZy50b1N0cmluZygxNiksXG4gICAgICAgIHJnYi5iLnRvU3RyaW5nKDE2KVxuICAgICAgXTtcbiAgICAgICQuZWFjaChoZXgsIGZ1bmN0aW9uKG5yLCB2YWwpIHtcbiAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIGhleFtucl0gPSAnMCcgKyB2YWw7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiAnIycgKyBoZXguam9pbignJyk7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gSFNCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiBoc2IyaGV4KGhzYikge1xuICAgICAgcmV0dXJuIHJnYjJoZXgoaHNiMnJnYihoc2IpKTtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJoc2IoaGV4KSB7XG4gICAgICB2YXIgaHNiID0gcmdiMmhzYihoZXgycmdiKGhleCkpO1xuICAgICAgaWYoIGhzYi5zID09PSAwICkgaHNiLmggPSAzNjA7XG4gICAgICByZXR1cm4gaHNiO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIGFuIFJHQiBvYmplY3QgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIHJnYjJoc2IocmdiKSB7XG4gICAgICB2YXIgaHNiID0geyBoOiAwLCBzOiAwLCBiOiAwIH07XG4gICAgICB2YXIgbWluID0gTWF0aC5taW4ocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgbWF4ID0gTWF0aC5tYXgocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgZGVsdGEgPSBtYXggLSBtaW47XG4gICAgICBoc2IuYiA9IG1heDtcbiAgICAgIGhzYi5zID0gbWF4ICE9PSAwID8gMjU1ICogZGVsdGEgLyBtYXggOiAwO1xuICAgICAgaWYoIGhzYi5zICE9PSAwICkge1xuICAgICAgICBpZiggcmdiLnIgPT09IG1heCApIHtcbiAgICAgICAgICBoc2IuaCA9IChyZ2IuZyAtIHJnYi5iKSAvIGRlbHRhO1xuICAgICAgICB9IGVsc2UgaWYoIHJnYi5nID09PSBtYXggKSB7XG4gICAgICAgICAgaHNiLmggPSAyICsgKHJnYi5iIC0gcmdiLnIpIC8gZGVsdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaHNiLmggPSA0ICsgKHJnYi5yIC0gcmdiLmcpIC8gZGVsdGE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhzYi5oID0gLTE7XG4gICAgICB9XG4gICAgICBoc2IuaCAqPSA2MDtcbiAgICAgIGlmKCBoc2IuaCA8IDAgKSB7XG4gICAgICAgIGhzYi5oICs9IDM2MDtcbiAgICAgIH1cbiAgICAgIGhzYi5zICo9IDEwMC8yNTU7XG4gICAgICBoc2IuYiAqPSAxMDAvMjU1O1xuICAgICAgcmV0dXJuIGhzYjtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gUkdCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJyZ2IoaGV4KSB7XG4gICAgICBoZXggPSBwYXJzZUludCgoKGhleC5pbmRleE9mKCcjJykgPiAtMSkgPyBoZXguc3Vic3RyaW5nKDEpIDogaGV4KSwgMTYpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xuICAgICAgICByOiBoZXggPj4gMTYsXG4gICAgICAgIGc6IChoZXggJiAweDAwRkYwMCkgPj4gOCxcbiAgICAgICAgYjogKGhleCAmIDB4MDAwMEZGKVxuICAgICAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgZXZlbnRzXG4gICAgJChkb2N1bWVudClcbiAgICAgIC8vIEhpZGUgb24gY2xpY2tzIG91dHNpZGUgb2YgdGhlIGNvbnRyb2xcbiAgICAgIC5vbignbW91c2Vkb3duLm1pbmljb2xvcnMgdG91Y2hzdGFydC5taW5pY29sb3JzJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYoICEkKGV2ZW50LnRhcmdldCkucGFyZW50cygpLmFkZChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdtaW5pY29sb3JzJykgKSB7XG4gICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU3RhcnQgbW92aW5nXG4gICAgICAub24oJ21vdXNlZG93bi5taW5pY29sb3JzIHRvdWNoc3RhcnQubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1ncmlkLCAubWluaWNvbG9ycy1zbGlkZXIsIC5taW5pY29sb3JzLW9wYWNpdHktc2xpZGVyJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcyk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQoZG9jdW1lbnQpLmRhdGEoJ21pbmljb2xvcnMtdGFyZ2V0JywgdGFyZ2V0KTtcbiAgICAgICAgbW92ZSh0YXJnZXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBNb3ZlIHBpY2tlcnNcbiAgICAgIC5vbignbW91c2Vtb3ZlLm1pbmljb2xvcnMgdG91Y2htb3ZlLm1pbmljb2xvcnMnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChkb2N1bWVudCkuZGF0YSgnbWluaWNvbG9ycy10YXJnZXQnKTtcbiAgICAgICAgaWYoIHRhcmdldCApIG1vdmUodGFyZ2V0LCBldmVudCk7XG4gICAgICB9KVxuICAgICAgLy8gU3RvcCBtb3ZpbmdcbiAgICAgIC5vbignbW91c2V1cC5taW5pY29sb3JzIHRvdWNoZW5kLm1pbmljb2xvcnMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVEYXRhKCdtaW5pY29sb3JzLXRhcmdldCcpO1xuICAgICAgfSlcbiAgICAgIC8vIFNlbGVjdGVkIGEgc3dhdGNoXG4gICAgICAub24oJ2NsaWNrLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtc3dhdGNoZXMgbGknLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJCh0aGlzKSwgaW5wdXQgPSB0YXJnZXQucGFyZW50cygnLm1pbmljb2xvcnMnKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpLCBjb2xvciA9IHRhcmdldC5kYXRhKCdzd2F0Y2gtY29sb3InKTtcbiAgICAgICAgdXBkYXRlSW5wdXQoaW5wdXQsIGNvbG9yLCBnZXRBbHBoYShjb2xvcikpO1xuICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQpO1xuICAgICAgfSlcbiAgICAgIC8vIFNob3cgcGFuZWwgd2hlbiBzd2F0Y2ggaXMgY2xpY2tlZFxuICAgICAgLm9uKCdtb3VzZWRvd24ubWluaWNvbG9ycyB0b3VjaHN0YXJ0Lm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiggaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKS5jc3MoXCJkaXNwbGF5XCIpICE9PSBcIm5vbmVcIil7XG4gICAgICAgICAgLy90b2RvXG4gICAgICAgICAgLy9oaWRlKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHNob3coaW5wdXQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU2hvdyBvbiBmb2N1c1xuICAgICAgLm9uKCdmb2N1cy5taW5pY29sb3JzJywgJy5taW5pY29sb3JzLWlucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzaG93KGlucHV0KTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgdmFsdWUgb24gYmx1clxuICAgICAgLm9uKCdibHVyLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKSxcbiAgICAgICAgICBzZXR0aW5ncyA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSxcbiAgICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgICBoZXgsXG4gICAgICAgICAgcmdiYSxcbiAgICAgICAgICBzd2F0Y2hPcGFjaXR5LFxuICAgICAgICAgIHZhbHVlO1xuXG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuXG4gICAgICAgIC8vIEdldCBhcnJheSBvZiBsb3dlcmNhc2Uga2V5d29yZHNcbiAgICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICByZXR1cm4gJC50cmltKGEudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgICAgaWYoIGlucHV0LnZhbCgpICE9PSAnJyAmJiAkLmluQXJyYXkoaW5wdXQudmFsKCkudG9Mb3dlckNhc2UoKSwga2V5d29yZHMpID4gLTEgKSB7XG4gICAgICAgICAgdmFsdWUgPSBpbnB1dC52YWwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBHZXQgUkdCQSB2YWx1ZXMgZm9yIGVhc3kgY29udmVyc2lvblxuICAgICAgICAgIGlmKCBpc1JnYihpbnB1dC52YWwoKSkgKSB7XG4gICAgICAgICAgICByZ2JhID0gcGFyc2VSZ2IoaW5wdXQudmFsKCksIHRydWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoZXggPSBwYXJzZUhleChpbnB1dC52YWwoKSwgdHJ1ZSk7XG4gICAgICAgICAgICByZ2JhID0gaGV4ID8gaGV4MnJnYihoZXgpIDogbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IHRvIGZvcm1hdFxuICAgICAgICAgIGlmKCByZ2JhID09PSBudWxsICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5kZWZhdWx0VmFsdWU7XG4gICAgICAgICAgfSBlbHNlIGlmKCBzZXR0aW5ncy5mb3JtYXQgPT09ICdyZ2InICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5vcGFjaXR5ID9cbiAgICAgICAgICAgICAgcGFyc2VSZ2IoJ3JnYmEoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcsJyArIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpICsgJyknKSA6XG4gICAgICAgICAgICAgIHBhcnNlUmdiKCdyZ2IoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcpJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gcmdiMmhleChyZ2JhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgc3dhdGNoIG9wYWNpdHlcbiAgICAgICAgc3dhdGNoT3BhY2l0eSA9IHNldHRpbmdzLm9wYWNpdHkgPyBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSA6IDE7XG4gICAgICAgIGlmKCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJhbnNwYXJlbnQnICkgc3dhdGNoT3BhY2l0eSA9IDA7XG4gICAgICAgIGlucHV0XG4gICAgICAgICAgLmNsb3Nlc3QoJy5taW5pY29sb3JzJylcbiAgICAgICAgICAuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoID4gc3BhbicpXG4gICAgICAgICAgLmNzcygnb3BhY2l0eScsIHN3YXRjaE9wYWNpdHkpO1xuXG4gICAgICAgIC8vIFNldCBpbnB1dCB2YWx1ZVxuICAgICAgICBpbnB1dC52YWwodmFsdWUpO1xuXG4gICAgICAgIC8vIElzIGl0IGJsYW5rP1xuICAgICAgICBpZiggaW5wdXQudmFsKCkgPT09ICcnICkgaW5wdXQudmFsKHBhcnNlSW5wdXQoc2V0dGluZ3MuZGVmYXVsdFZhbHVlLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gQWRqdXN0IGNhc2VcbiAgICAgICAgaW5wdXQudmFsKCBjb252ZXJ0Q2FzZShpbnB1dC52YWwoKSwgc2V0dGluZ3MubGV0dGVyQ2FzZSkgKTtcblxuICAgICAgfSlcbiAgICAgIC8vIEhhbmRsZSBrZXlwcmVzc2VzXG4gICAgICAub24oJ2tleWRvd24ubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgIGNhc2UgOTogLy8gdGFiXG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDEzOiAvLyBlbnRlclxuICAgICAgICAgIGNhc2UgMjc6IC8vIGVzY1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICAgICAgaW5wdXQuYmx1cigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24ga2V5dXBcbiAgICAgIC5vbigna2V5dXAubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24gcGFzdGVcbiAgICAgIC5vbigncGFzdGUubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgc2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgICAgfSwgMSk7XG4gICAgICB9KTtcblxuICB9KSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gcGx1Z2lucy8kLm1pbmljb2xvcnMuanMiLCJcbmlmKCEkLmZvbnRTZWxlY3Rvcil7XG4gIHJlcXVpcmUoXCIuLi8uLi9wbHVnaW5zLyQuZm9udFNlbGVjdG9yXCIpO1xufVxuXG5pZih0eXBlb2YgVG9vbGJhciA9PT0gXCJ1bmRlZmluZWRcIil7XG4gIHZhciBUb29sYmFyID0gcmVxdWlyZShcIi4uL3Rvb2xiYXJcIik7XG59XG5cblRvb2xiYXIucHJvdG90eXBlLmZvbnRzID0gW1xuICAnQXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWYnLFxuICAnQXJpYWwgQmxhY2ssR2FkZ2V0LHNhbnMtc2VyaWYnLFxuICAnQ29taWMgU2FucyBNUyxjdXJzaXZlJyxcbiAgJ0NvdXJpZXIgTmV3LENvdXJpZXIsbW9ub3NwYWNlJyxcbiAgJ0dlb3JnaWEsc2VyaWYnLFxuICAnSW1wYWN0LENoYXJjb2FsLHNhbnMtc2VyaWYnLFxuICAnTHVjaWRhIENvbnNvbGUsTW9uYWNvLG1vbm9zcGFjZScsXG4gICdMdWNpZGEgU2FucyBVbmljb2RlLEx1Y2lkYSBHcmFuZGUsc2Fucy1zZXJpZicsXG4gICdQYWxhdGlubyBMaW5vdHlwZSxCb29rIEFudGlxdWEsUGFsYXRpbm8sc2VyaWYnLFxuICAnVGFob21hLEdlbmV2YSxzYW5zLXNlcmlmJyxcbiAgJ1RpbWVzIE5ldyBSb21hbixUaW1lcyxzZXJpZicsXG4gICdUcmVidWNoZXQgTVMsSGVsdmV0aWNhLHNhbnMtc2VyaWYnLFxuICAnVmVyZGFuYSxHZW5ldmEsc2Fucy1zZXJpZicsXG4gICdHaWxsIFNhbnMsR2VuZXZhLHNhbnMtc2VyaWYnXG5dO1xuXG5cblRvb2xiYXIucHJvdG90eXBlLnRvb2xzLmZvbnRGYW1pbHkgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICAvL2N1cnJlbnRWYWx1ZTogZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBkYXRhLnZhbHVlLnNldChwYXJzZUZsb2F0KCQoZS50YXJnZXQpLnZhbCgpKSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB0ZW1wbGF0ZTpcbiAgICBgPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtZm9udC1mYW1pbHlcIiB0aXRsZT1cInt0aXRsZX1cIj5cbiAgICAgIDxsYWJlbCBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImZvbnRTZWxlY3RcIiB0cmFuc2NsdWRlPjxkaXYgY2xhc3M9XCJhcnJvdy1kb3duXCI+YCxcbiAgICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcblxuICAgIHRyYW5zY2x1ZGUuZm9udFNlbGVjdG9yKHtcbiAgICAgICdoaWRlX2ZhbGxiYWNrcyc6IHRydWUsXG4gICAgICAnaW5pdGlhbCc6IGRhdGEudmFsdWUuZ2V0KCksLy8nQ291cmllciBOZXcsQ291cmllciBOZXcsQ291cmllcixtb25vc3BhY2UnLFxuICAgICAgJ3NlbGVjdGVkJzogZGF0YS52YWx1ZS5zZXQuYmluZChkYXRhLnRhcmdldCksXG4gICAgICAnZm9udHMnOiBkYXRhLmRhdGFcbiAgICB9KTtcblxuICAgIHRoaXMub24oXCJkZXN0cm95XCIsKCkgPT4ge1xuICAgICAgdHJhbnNjbHVkZS5mb250U2VsZWN0b3IoXCJkZXN0cm95XCIpO1xuICAgIH0pXG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuZm9udHMuanMiLCIvKipcbiAqIEZvbnQgU2VsZWN0b3IgLSBqUXVlcnkgcGx1Z2luIDAuMVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMiBDaHJpcyBEeWVyXG4gKlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZ1xuICogY29uZGl0aW9ucyBhcmUgbWV0OlxuICpcbiAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmdcbiAqIGRpc2NsYWltZXIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnNcbiAqIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKlxuICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyBcIkFTIElTXCIgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLFxuICogQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PXG4gKiBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUlxuICogQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7XG4gKiBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVFxuICogKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0ZcbiAqIFNVQ0ggREFNQUdFLlxuICpcbiAqL1xuXG5cblxuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnanF1ZXJ5JykpO1xuICB9IGVsc2Uge1xuICAgIGZhY3RvcnkoalF1ZXJ5KTtcbiAgfVxufShcbiAgICBmdW5jdGlvbiggJCApIHtcblxuICAndXNlIHN0cmljdCc7XG4gIC8vaWYoXyAmJiBfLnN0eWxlU2hlZXRDb250YWlucyAmJiAhXy5zdHlsZVNoZWV0Q29udGFpbnMoJy5mb250U2VsZWN0Jykpe1xuICAvLyAgXy5saW5rQ1NTKF8uc2NyaXB0VVJMKCkgKyBcIi8uLi8uLi9jc3MvanF1ZXJ5LmZvbnRTZWxlY3Rvci5jc3NcIik7XG4gIC8vfVxuXG4gIHZhciBzZXR0aW5ncztcblxuICB2YXIgbWV0aG9kcyA9IHtcbiAgICBkZXN0cm95IDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdGhpcy51bC5yZW1vdmUoKTtcbiAgICB9LFxuICAgIGNsb3NlIDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgdGhpcy5jbG9zZVVsKCk7XG4gICAgfSxcbiAgICBpbml0IDogZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKCB7XG4gICAgICAgICdoaWRlX2ZhbGxiYWNrcycgOiBmYWxzZSxcbiAgICAgICAgJ3NlbGVjdGVkJyA6IGZ1bmN0aW9uKHN0eWxlKSB7fSxcbiAgICAgICAgJ29wZW5lZCcgOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICAnY2xvc2VkJyA6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgICdpbml0aWFsJyA6ICcnLFxuICAgICAgICAnZm9udHMnIDogW11cbiAgICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgICB2YXIgcm9vdCA9IHRoaXM7XG4gICAgICB2YXIgJHJvb3QgPSAkKHRoaXMpO1xuICAgICAgcm9vdC5zZWxlY3RlZENhbGxiYWNrID0gc2V0dGluZ3NbJ3NlbGVjdGVkJ107XG4gICAgICByb290Lm9wZW5lZENhbGxiYWNrID0gc2V0dGluZ3NbJ29wZW5lZCddO1xuICAgICAgcm9vdC5jbG9zZWRDYWxsYmFjayA9IHNldHRpbmdzWydjbG9zZWQnXTtcbiAgICAgIHZhciB2aXNpYmxlID0gZmFsc2U7XG4gICAgICB2YXIgc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIHZhciBvcGVuZWRDbGFzcyA9ICdmb250U2VsZWN0T3Blbic7XG5cbiAgICAgIHZhciBkaXNwbGF5TmFtZSA9IGZ1bmN0aW9uKGZvbnQpIHtcbiAgICAgICAgaWYgKHNldHRpbmdzWydoaWRlX2ZhbGxiYWNrcyddKXtcbiAgICAgICAgICB2YXIgaW5kZXggPSBmb250LmluZGV4T2YoJywnKTtcbiAgICAgICAgICBpZihpbmRleCA9PSAtMSApcmV0dXJuIGZvbnQ7XG4gICAgICAgICAgcmV0dXJuIGZvbnQuc3Vic3RyKDAsIGluZGV4KTtcbiAgICAgICAgfWVsc2VcbiAgICAgICAgICByZXR1cm4gZm9udDtcbiAgICAgIH1cblxuXG4gICAgICB2YXIgc2VsZWN0ID0gZnVuY3Rpb24oZm9udCxpbml0aWFsKSB7XG4gICAgICAgIHJvb3QuZmluZCgnc3BhbicpLmh0bWwoZGlzcGxheU5hbWUoZm9udCkucmVwbGFjZSgvW1wiJ117MX0vZ2ksXCJcIikpO1xuICAgICAgICByb290LmNzcygnZm9udC1mYW1pbHknLCBmb250KTtcbiAgICAgICAgc2VsZWN0ZWQgPSBmb250O1xuXG4gICAgICAgIGlmKCFpbml0aWFsKXJvb3Quc2VsZWN0ZWRDYWxsYmFjayhzZWxlY3RlZCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBwb3NpdGlvblVsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBsZWZ0LCB0b3A7XG4gICAgICAgIGxlZnQgPSAkKHJvb3QpLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgIHRvcCA9ICQocm9vdCkub2Zmc2V0KCkudG9wICsgJChyb290KS5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgICQodWwpLmNzcyh7XG4gICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJyxcbiAgICAgICAgICAnbGVmdCc6IGxlZnQgKyAncHgnLFxuICAgICAgICAgICd0b3AnOiB0b3AgKyAncHgnLFxuICAgICAgICAgICd3aWR0aCc6ICQocm9vdCkub3V0ZXJXaWR0aCgpICsgJ3B4J1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdmFyIGNsb3NlVWwgPSB0aGlzLmNsb3NlVWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdWwuc2xpZGVVcCgnZmFzdCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHJvb3QucmVtb3ZlQ2xhc3Mob3BlbmVkQ2xhc3MpO1xuXG4gICAgICAgIHJvb3QuY2xvc2VkQ2FsbGJhY2soKTtcbiAgICAgIH1cblxuICAgICAgdmFyIG9wZW5VaSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB1bC5zbGlkZURvd24oJ2Zhc3QnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHJvb3QuYWRkQ2xhc3Mob3BlbmVkQ2xhc3MpO1xuXG4gICAgICAgIHJvb3Qub3BlbmVkQ2FsbGJhY2soKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0dXAgbWFya3VwXG4gICAgICAkcm9vdC5wcmVwZW5kKCc8c3Bhbj4nICsgc2V0dGluZ3NbJ2luaXRpYWwnXS5yZXBsYWNlKC8nL2csJyYjMDM5OycpICsgJzwvc3Bhbj4nKTtcbiAgICAgIHZhciB1bCA9IHRoaXMudWwgPSAkKCc8dWwgY2xhc3M9XCJmb250U2VsZWN0VWxcIj48L3VsPicpLmFwcGVuZFRvKCdib2R5Jyk7XG4gICAgICB1bC5oaWRlKCk7XG4gICAgICBwb3NpdGlvblVsKCk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2V0dGluZ3NbJ2ZvbnRzJ10ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSAkKCc8bGk+JyArIGRpc3BsYXlOYW1lKHNldHRpbmdzWydmb250cyddW2ldKSArICc8L2xpPicpLmFwcGVuZFRvKHVsKTtcbiAgICAgICAgaXRlbS5jc3MoJ2ZvbnQtZmFtaWx5Jywgc2V0dGluZ3NbJ2ZvbnRzJ11baV0pO1xuICAgICAgICBpdGVtWzBdLmRhdGEgPSBzZXR0aW5nc1snZm9udHMnXVtpXTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNldHRpbmdzWydpbml0aWFsJ10gIT0gJycpXG4gICAgICAgIHNlbGVjdChzZXR0aW5nc1snaW5pdGlhbCddLHRydWUpO1xuXG4gICAgICB1bC5maW5kKCdsaScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmICghdmlzaWJsZSlcbiAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgcG9zaXRpb25VbCgpO1xuICAgICAgICBjbG9zZVVsKCk7XG5cbiAgICAgICAgc2VsZWN0KHRoaXMuZGF0YSk7XG4gICAgICB9KTtcblxuICAgICAgJHJvb3QuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICBpZiAodmlzaWJsZSlcbiAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgcG9zaXRpb25VbCgpO1xuICAgICAgICBvcGVuVWkoKTtcbiAgICAgIH0pO1xuXG4gICAgICAkKCdodG1sJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh2aXNpYmxlKVxuICAgICAgICB7XG4gICAgICAgICAgY2xvc2VVbCgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gICAgc2VsZWN0ZWQgOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmRhdGE7XG4gICAgfSxcbiAgICBzZWxlY3QgOiBmdW5jdGlvbihmb250KSB7XG4gICAgICB0aGlzLmZpbmQoJ3NwYW4nKS5odG1sKGZvbnQuc3Vic3RyKDAsIGZvbnQuaW5kZXhPZignLCcpKS5yZXBsYWNlKC9bXCInXXsxfS9naSxcIlwiKSk7XG4gICAgICB0aGlzLmNzcygnZm9udC1mYW1pbHknLCBmb250KTtcbiAgICAgIHZhciBzZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgc2VsZWN0ZWQgPSBmb250O1xuICAgIH1cbiAgfTtcbiAgJC5mb250U2VsZWN0b3IgPSB7XG5cbiAgfTtcblxuICAkLmZuLmZvbnRTZWxlY3RvciA9IGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgIGlmICggbWV0aG9kc1ttZXRob2RdICkge1xuICAgICAgcmV0dXJuIG1ldGhvZHNbIG1ldGhvZCBdLmFwcGx5KCB0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJndW1lbnRzLCAxICkpO1xuICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBtZXRob2QgPT09ICdvYmplY3QnIHx8ICEgbWV0aG9kICkge1xuICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQuZXJyb3IoICdNZXRob2QgJyArICBtZXRob2QgKyAnIGRvZXMgbm90IGV4aXN0IG9uIGpRdWVyeS5mb250U2VsZWN0b3InICk7XG4gICAgfVxuICB9XG59KSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gcGx1Z2lucy8kLmZvbnRTZWxlY3Rvci5qcyIsIjtcbmlmKHR5cGVvZiBUb29sYmFyID09PSBcInVuZGVmaW5lZFwiKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi4vdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUudXBkYXRlU2VsZWN0ZWRPcHRpb24gPSBmdW5jdGlvbihkYXRhKXtcbiAgdmFyICRjaGVja2VkID0gZGF0YS4kaXRlbS5maW5kKFwiOmNoZWNrZWRcIik7XG4gIHZhciAkY2hlY2tlZE9wdGlvbkVsID0gJCgkY2hlY2tlZC5wYXJlbnRzKClbMF0pO1xuXG5cbiAgdmFyIHNlbE9wdGlvbiA9IGRhdGEuJGl0ZW0uZmluZCgnLmJ0bi1zZWxlY3RlZC1vcHRpb24nKTtcbiAgc2VsT3B0aW9uLmh0bWwoICRjaGVja2VkT3B0aW9uRWwuZmluZChcImxhYmVsXCIpWzBdLm91dGVySFRNTCApO1xufTtcblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMub3B0aW9uID0ge1xuICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIHJldHVybiB7XG4gICAgICBwYXJlbnRJZDogZGF0YS5wYXJlbnQuaWQsXG4gICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEucGFyZW50LnZhbHVlLmdldCgpID09PSBkYXRhLm9wdGlvbixcbiAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8v0L7Qv9GC0LjQvNC40LfQuNGA0L7QstCw0YLRjFxuXG4gICAgICAgIHZhciAkY2hlY2tlZCA9IGRhdGEuJGl0ZW0uZmluZChcIjpjaGVja2VkXCIpO1xuICAgICAgICB2YXIgX3ZhbHVlID0gJGNoZWNrZWQudmFsKCk7XG4gICAgICAgIGlmIChfdmFsdWUgPT0gZGF0YS5vcHRpb24pIHtcbiAgICAgICAgICBkYXRhLnBhcmVudC52YWx1ZS5zZXQoX3ZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBfc2VsZi51cGRhdGVTZWxlY3RlZE9wdGlvbihkYXRhLnBhcmVudCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB0ZW1wbGF0ZTpcbiAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtb3B0aW9uIFwiIHRpdGxlPVwie3RpdGxlfVwiID4nICtcbiAgICAnPGlucHV0IHR5cGU9XCJyYWRpb1wiIGlkPVwidG9vbC17aWR9XCIgZHAtY2hlY2tlZD1cInt2YWx1ZUN1cnJlbnR9XCIgbmFtZT1cIntwYXJlbnRJZH1cIiB2YWx1ZT1cIntvcHRpb259XCIgb25jaGFuZ2U9XCJvbmNoYW5nZSgpXCI+JyArXG4gICAgJzxsYWJlbCBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiIGZvcj1cInRvb2wte2lkfVwiPicgK1xuICAgICAgJzxpbWcgZHAtaWY9XCJpY29uXCIgZHAtc3JjPVwiaWNvblwiPicgK1xuICAgICAgJzxzcGFuIGRwLWluY2x1ZGU9XCJzdmdcIiBkcC1pZj1cInN2Z1wiPjwvc3Bhbj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cInRpdGxlXCIgY2xhc3M9XCJvcHRpb24tdGl0bGVcIj57dGl0bGV9PC9zcGFuPidcbn07XG5cblRvb2xiYXIucHJvdG90eXBlLnRvb2xzLm9wdGlvbnMgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICBwb3NpdGlvbjogb3B0aW9ucy5vcHRpb25zICYmIG9wdGlvbnMub3B0aW9ucy5wb3NpdGlvbixcbiAgICAgIGNsYXNzTmFtZTogZGF0YS5jbGFzc05hbWUgfHwgJ2l0ZW1zLWNvbHVtbicsXG4gICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICBidXR0b25zQ2xhc3NOYW1lOiAob3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOlxuICAgIGA8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1vcHRpb25zIHtjbGFzc05hbWV9XCIgdGl0bGU9XCJ7dGl0bGV9XCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiYnRuLXNlbGVjdGVkLW9wdGlvblwiPjwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LW9wdGlvbnMtY29udGFpbmVyIHtwb3NpdGlvbn1cIiB0cmFuc2NsdWRlPmAsXG4gIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdHJhbnNjbHVkZSkge1xuICAgIHRoaXMuZ2VuZXJhdGVNZW51KGRhdGEudGFyZ2V0LCB0cmFuc2NsdWRlLCBvcHRpb25zLCBkYXRhLm1lbnUpO1xuICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRPcHRpb24oZGF0YSk7XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIub3B0aW9ucy5qcyIsIjtcbmlmKHR5cGVvZiBUb29sYmFyID09PSBcInVuZGVmaW5lZFwiKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi4vdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMuc2VsZWN0ID0gIHtcbiAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoZGF0YS4kaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKCkpO1xuICAgICAgfSxcbiAgICAgIGdldFZhbHVlOiBkYXRhLnZhbHVlLmdldCxcbiAgICAgIHNldFZhbHVlOiBkYXRhLnZhbHVlLnNldCxcbiAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSxtb2RlbCkge1xuICAgICAgICBkYXRhLnZhbHVlLnNldChlLnBhcmFtcy5kYXRhLmlkLG1vZGVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtc2VsZWN0IHtpdGVtQ2xhc3NOYW1lfVwiIHRpdGxlPVwie3RpdGxlfVwiID48bGFiZWwgZm9yPVwieHh4XCIgY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX1cIj48L2xhYmVsPjxzZWxlY3QgaWQ9XCJ4eHhcIj4nLFxuICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgY29uc3QgbW9kZWwgPSAgZGF0YS52YWx1ZS5vcHRpb25zKCksXG4gICAgICBfdmFsID0gZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgIF9zZWxlY3QgPSAkaXRlbS5maW5kKFwic2VsZWN0XCIpO1xuXG4gICAgX3NlbGVjdC5kcFNlbGVjdChcImRhdGFcIiwgbW9kZWwpO1xuICAgIF9zZWxlY3QuZHBTZWxlY3QoXCJ2YWxcIixbX3ZhbF0pO1xuICB9LFxuICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgIGNvbnN0IG1vZGVsID0gIGRhdGEudmFsdWUub3B0aW9ucygpLFxuICAgICAgX3ZhbCA9IGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICBfc2VsZWN0ID0gJGl0ZW0uZmluZChcInNlbGVjdFwiKTtcbiAgICBjb25zdCBkcm9wZG93biA9IGRhdGEuZHJvcGRvd247XG5cbiAgICBfc2VsZWN0LmRwU2VsZWN0KHtcbiAgICAgIHdpZHRoOiBkcm9wZG93bi53aWR0aCB8fCA0MCxcbiAgICAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiBkcm9wZG93bi5taW5pbXVtUmVzdWx0c0ZvclNlYXJjaCB8fCAgSW5maW5pdHksXG4gICAgICBkcm9wZG93blBhcmVudDogdGhpcy5jb250YWluZXIucmVsYXRpdmVQYXJlbnQoKSxcbiAgICAgIGRhdGE6ICBtb2RlbCxcbiAgICAgIHRoZW1lOiBkcm9wZG93bi50aGVtZSxcbiAgICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyKSB7XG4gICAgICAgIHJldHVybiBkcm9wZG93bi50ZW1wbGF0ZVNlbGVjdGlvbihzdGF0ZSwgY29udGFpbmVyLGRhdGEpO1xuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlUmVzdWx0OiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyKXtcbiAgICAgICAgcmV0dXJuIGRyb3Bkb3duLnRlbXBsYXRlUmVzdWx0KHN0YXRlLCBjb250YWluZXIsZGF0YSk7XG4gICAgICB9LFxuICAgIH0pLm9uKFwic2VsZWN0MjpzZWxlY3RcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgZGF0YS5vbmNoYW5nZShlLCBtb2RlbCk7XG4gICAgfSk7XG4gICAgX3NlbGVjdC5kcFNlbGVjdChcInZhbFwiLFtfdmFsXSk7XG5cblxuICAgIHRoaXMub24oXCJkZXN0cm95XCIsKCkgPT4ge1xuICAgICAgX3NlbGVjdC5kcFNlbGVjdChcImRlc3Ryb3lcIik7XG4gICAgfSlcbiAgfVxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHRvb2xiYXIvbW9kdWxlcy90b29sYmFyLnNlbGVjdC5qcyIsIlxuaWYodHlwZW9mIFRvb2xiYXIgPT09IFwidW5kZWZpbmVkXCIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuLi90b29sYmFyXCIpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS5jb2xvcnBpY2tlciA9IGZ1bmN0aW9uIChlbCwgb3B0aW9ucykge1xuICAvLyBvcHRpb25zLmZvcm1hdCA9ICdyZ2InO1xuICAvLyBvcHRpb25zLm9wYWNpdHkgPSB0cnVlO1xuICBlbC5taW5pY29sb3JzKG9wdGlvbnMpO1xufTtcblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMuZWZmZWN0ID0ge1xuICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYnV0dG9uc1RpdGxlOiBvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLnRpdGxlIHx8IGZhbHNlLFxuICAgICAgaXNQYXJhbWV0ZXJzOiAhIWRhdGEuYWN0aW9uUGFyYW1ldGVycyxcbiAgICAgIGJ1dHRvbnNDbGFzc05hbWU6IChvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICAgIC8vIGVmZmVjdENsYXNzTmFtZTogZGF0YVxuICAgIH1cbiAgfSxcbiAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX0ge2J1dHRvbnNDbGFzc05hbWV9XCI+JyArXG4gICAgICAnPHNwYW4gZHAtaWY9XCJidXR0b25zVGl0bGVcIiBjbGFzcz1cImJ1dHRvbi10aXRsZVwiPnt0aXRsZX08L3NwYW4+JyArXG4gICAgICAnPC9idXR0b24+JyArXG4gICAgICAnPGRpdiBkcC1pZj1cImlzUGFyYW1ldGVyc1wiIGNsYXNzPVwibWVudS1hY3Rpb24tcGFyYW1ldGVycyB7ZWZmZWN0Q2xhc3NOYW1lfVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZVwiIHRyYW5zY2x1ZGU+PC9kaXY+JyArXG4gICAgJzwvZGl2PicsXG4gICAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG5cbiAgICBpZihkYXRhLmNvbnRhaW5lcil7XG4gICAgICB0cmFuc2NsdWRlID0gJChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkYXRhLmNvbnRhaW5lcikpO1xuICAgIH1cblxuICAgIHZhciAkdHBsO1xuICAgIHZhciBmb28gPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoZGF0YS5lZmZlY3RUcGwpIHtcbiAgICAgICAgJHRwbCA9ICQoZGF0YS5lZmZlY3RUcGwpO1xuICAgICAgICB0cmFuc2NsdWRlLmh0bWwoJHRwbCk7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5hY3Rpb25QYXJhbWV0ZXJzSWQpIHtcbiAgICAgICAgJHRwbCA9ICQoXCIjXCIgKyBkYXRhLmFjdGlvblBhcmFtZXRlcnNJZCkuY2xvbmUoKTtcbiAgICAgICAgdHJhbnNjbHVkZS5odG1sKCR0cGwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRhdGEuYWN0aW9uUGFyYW1ldGVycy5jYWxsKGRhdGEudGFyZ2V0LCB0cmFuc2NsdWRlLCBkYXRhLCBvcHRpb25zKTtcbiAgICB9O1xuICAgIHRoaXMudG9nZ2xlQnlCdXR0b24oJGl0ZW0sIHRyYW5zY2x1ZGUsIGZvbyAsZGF0YSk7XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuZWZmZWN0LmpzIiwibW9kdWxlLmV4cG9ydHMgPSBcIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlWVlJHTFRnaUlITjBZVzVrWVd4dmJtVTlJbTV2SWo4K0Nqd2hMUzBnUTNKbFlYUmxaQ0IzYVhSb0lFbHVhM05qWVhCbElDaG9kSFJ3T2k4dmQzZDNMbWx1YTNOallYQmxMbTl5Wnk4cElDMHRQZ284YzNabkNpQWdJQ0I0Yld4dWN6cHBibXR6WTJGd1pUMGlhSFIwY0RvdkwzZDNkeTVwYm10elkyRndaUzV2Y21jdmJtRnRaWE53WVdObGN5OXBibXR6WTJGd1pTSUtJQ0FnSUhodGJHNXpPbkprWmowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzh3TWk4eU1pMXlaR1l0YzNsdWRHRjRMVzV6SXlJS0lDQWdJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SUtJQ0FnSUhodGJHNXpPbk52Wkdsd2IyUnBQU0pvZEhSd09pOHZjMjlrYVhCdlpHa3VjMjkxY21ObFptOXlaMlV1Ym1WMEwwUlVSQzl6YjJScGNHOWthUzB3TG1SMFpDSUtJQ0FnSUhodGJHNXpPbU5qUFNKb2RIUndPaTh2WTNKbFlYUnBkbVZqYjIxdGIyNXpMbTl5Wnk5dWN5TWlDaUFnSUNCNGJXeHVjenA0YkdsdWF6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M5NGJHbHVheUlLSUNBZ0lIaHRiRzV6T21SalBTSm9kSFJ3T2k4dmNIVnliQzV2Y21jdlpHTXZaV3hsYldWdWRITXZNUzR4THlJS0lDQWdJSGh0Ykc1ek9uTjJaejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpQ2lBZ0lDQjRiV3h1Y3pwdWN6RTlJbWgwZEhBNkx5OXpiM3BwTG1KaGFXVnliM1ZuWlM1bWNpSUtJQ0FnSUdsa1BTSnpkbWMwT0RnNElnb2dJQ0FnYzI5a2FYQnZaR2s2Wkc5amJtRnRaVDBpZDJGeWJtbHVaMTlpZFhSMGIyNHVjM1puSWdvZ0lDQWdkbWxsZDBKdmVEMGlNQ0F3SURRd01DQTBNREFpQ2lBZ0lDQjJaWEp6YVc5dVBTSXhMakVpQ2lBZ0lDQnBibXR6WTJGd1pUcDJaWEp6YVc5dVBTSXdMalE0TGpBZ2NqazJOVFFpQ2lBZ1Bnb2dJRHhrWldaekNpQWdJQ0FnSUdsa1BTSmtaV1p6TkRnNU1DSUtJQ0FnSUQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnSUNBZ0lHbGtQU0pzYVc1bFlYSkhjbUZrYVdWdWREZzBNVEVpQ2lBZ0lDQWdJQ0FnZVRJOUlqTTJOeTQ0T0NJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQjVNVDBpTWpnM0xqUTVJZ29nSUNBZ0lDQWdJSGd5UFNJek1UVXVORGNpQ2lBZ0lDQWdJQ0FnZURFOUlqSTBNUzQwTVNJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwamIyeHNaV04wUFNKaGJIZGhlWE1pQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQSE4wYjNBS0lDQWdJQ0FnSUNBZ0lHbGtQU0p6ZEc5d05ERTFPQ0lLSUNBZ0lDQWdJQ0FnSUhOMGVXeGxQU0p6ZEc5d0xXTnZiRzl5T2lObVptWm1abVlpQ2lBZ0lDQWdJQ0FnSUNCdlptWnpaWFE5SWpBaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRFF4TmpBaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pabVptWm1abU8zTjBiM0F0YjNCaFkybDBlVG93SWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJeElnb2dJQ0FnSUNBdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkQW9nSUNBZ1Bnb2dJQ0FnUEdacGJIUmxjZ29nSUNBZ0lDQWdJR2xrUFNKbWFXeDBaWEkyTVRJMklnb2dJQ0FnSUNBZ0lHTnZiRzl5TFdsdWRHVnljRzlzWVhScGIyNHRabWxzZEdWeWN6MGljMUpIUWlJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwamIyeHNaV04wUFNKaGJIZGhlWE1pQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQR1psUjJGMWMzTnBZVzVDYkhWeUNpQWdJQ0FnSUNBZ0lDQnBaRDBpWm1WSFlYVnpjMmxoYmtKc2RYSTJNVEk0SWdvZ0lDQWdJQ0FnSUNBZ2MzUmtSR1YyYVdGMGFXOXVQU0l3TGpVek1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2FXNXJjMk5oY0dVNlkyOXNiR1ZqZEQwaVlXeDNZWGx6SWdvZ0lDQWdJQ0F2UGdvZ0lDQWdQQzltYVd4MFpYSUtJQ0FnSUQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnSUNBZ0lHbGtQU0pzYVc1bFlYSkhjbUZrYVdWdWREZzBNVE1pQ2lBZ0lDQWdJQ0FnZVRJOUlqTTVNUzQwTlNJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQjVNVDBpTXpBd0xqZzJJZ29nSUNBZ0lDQWdJSGd5UFNJek5ESWlDaUFnSUNBZ0lDQWdlREU5SWpJM05TNDJNU0lLSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BITjBiM0FLSUNBZ0lDQWdJQ0FnSUdsa1BTSnpkRzl3TnpJd01TSUtJQ0FnSUNBZ0lDQWdJSE4wZVd4bFBTSnpkRzl3TFdOdmJHOXlPaU0xTlRBd01EQWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakFpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHh6ZEc5d0NpQWdJQ0FnSUNBZ0lDQnBaRDBpYzNSdmNEY3lNRE1pQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWXdNREF3SWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJeElnb2dJQ0FnSUNBdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkQW9nSUNBZ1Bnb2dJQ0FnUEhKaFpHbGhiRWR5WVdScFpXNTBDaUFnSUNBZ0lDQWdhV1E5SW5KaFpHbGhiRWR5WVdScFpXNTBPRFF4TlNJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQmplRDBpTXpFeUxqYzRJZ29nSUNBZ0lDQWdJR041UFNJek9EWXVOVGNpQ2lBZ0lDQWdJQ0FnY2owaU5UTXVNRE0ySWdvZ0lDQWdJQ0FnSUdkeVlXUnBaVzUwVkhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTFM0MU9UTXlOeUF0TGpVNU16STNJQzQzTVRVd05TQXRMamN4TlRBMUlESTBNeTR5TnlBNE5Ea3VNRE1wSWdvZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJHeGxZM1E5SW1Gc2QyRjVjeUlLSUNBZ0lDQWdQZ29nSUNBZ0lDQThjM1J2Y0FvZ0lDQWdJQ0FnSUNBZ2FXUTlJbk4wYjNBM01URXpMVGNpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWm1abVptTzNOMGIzQXRiM0JoWTJsMGVUb3VOREE0TVRZaUNpQWdJQ0FnSUNBZ0lDQnZabVp6WlhROUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHpkRzl3Q2lBZ0lDQWdJQ0FnSUNCcFpEMGljM1J2Y0RjeE1UVXROeUlLSUNBZ0lDQWdJQ0FnSUhOMGVXeGxQU0p6ZEc5d0xXTnZiRzl5T2lObVptWm1abVk3YzNSdmNDMXZjR0ZqYVhSNU9qQWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakVpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQThMM0poWkdsaGJFZHlZV1JwWlc1MENpQWdJQ0ErQ2lBZ0lDQThiR2x1WldGeVIzSmhaR2xsYm5RS0lDQWdJQ0FnSUNCcFpEMGliR2x1WldGeVIzSmhaR2xsYm5ReE1EUTBPU0lLSUNBZ0lDQWdJQ0I1TWowaU16TTRMamd5SWdvZ0lDQWdJQ0FnSUdkeVlXUnBaVzUwVlc1cGRITTlJblZ6WlhKVGNHRmpaVTl1VlhObElnb2dJQ0FnSUNBZ0lIa3hQU0l5T0RZdU5qY2lDaUFnSUNBZ0lDQWdaM0poWkdsbGJuUlVjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVFUxTXpRZ01DQXdJQzQ1TlRVek5DQXhNell1TVRJZ01UUXVNRFUxS1NJS0lDQWdJQ0FnSUNCNE1qMGlNekF3TGpJM0lnb2dJQ0FnSUNBZ0lIZ3hQU0l5TlRVdU16SWlDaUFnSUNBZ0lDQWdhVzVyYzJOaGNHVTZZMjlzYkdWamREMGlZV3gzWVhseklnb2dJQ0FnSUNBK0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRFF4TlRBaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pabVptWm1abUlnb2dJQ0FnSUNBZ0lDQWdiMlptYzJWMFBTSXdJZ29nSUNBZ0lDQXZQZ29nSUNBZ0lDQThjM1J2Y0FvZ0lDQWdJQ0FnSUNBZ2FXUTlJbk4wYjNBME1UVXlJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbk4wYjNBdFkyOXNiM0k2STJabVptWm1aanR6ZEc5d0xXOXdZV05wZEhrNk1DSUtJQ0FnSUNBZ0lDQWdJRzltWm5ObGREMGlNU0lLSUNBZ0lDQWdMejRLSUNBZ0lEd3ZiR2x1WldGeVIzSmhaR2xsYm5RS0lDQWdJRDRLSUNBZ0lEeG1hV3gwWlhJS0lDQWdJQ0FnSUNCcFpEMGlabWxzZEdWeU1URTBNamdpQ2lBZ0lDQWdJQ0FnWTI5c2IzSXRhVzUwWlhKd2IyeGhkR2x2YmkxbWFXeDBaWEp6UFNKelVrZENJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbU52Ykd4bFkzUTlJbUZzZDJGNWN5SUtJQ0FnSUNBZ1Bnb2dJQ0FnSUNBOFptVkhZWFZ6YzJsaGJrSnNkWElLSUNBZ0lDQWdJQ0FnSUdsa1BTSm1aVWRoZFhOemFXRnVRbXgxY2pFeE5ETXdJZ29nSUNBZ0lDQWdJQ0FnYzNSa1JHVjJhV0YwYVc5dVBTSXhMakkwTXpRMk56Z2lDaUFnSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lDOCtDaUFnSUNBOEwyWnBiSFJsY2dvZ0lDQWdQZ29nSUR3dlpHVm1jd29nSUQ0S0lDQThjMjlrYVhCdlpHazZibUZ0WldSMmFXVjNDaUFnSUNBZ0lHbGtQU0ppWVhObElnb2dJQ0FnSUNCaWIzSmtaWEpqYjJ4dmNqMGlJelkyTmpZMk5pSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmNHRm5aWE5vWVdSdmR6MGlNaUlLSUNBZ0lDQWdhVzVyYzJOaGNHVTZkMmx1Wkc5M0xYazlJaTA0SWdvZ0lDQWdJQ0J3WVdkbFkyOXNiM0k5SWlObVptWm1abVlpQ2lBZ0lDQWdJR2x1YTNOallYQmxPbmRwYm1SdmR5MW9aV2xuYUhROUlqazRPQ0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZkMmx1Wkc5M0xXMWhlR2x0YVhwbFpEMGlNU0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZlbTl2YlQwaU1DNDNNRGN4TURZM09DSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmQybHVaRzkzTFhnOUlpMDRJZ29nSUNBZ0lDQnphRzkzWjNKcFpEMGlabUZzYzJVaUNpQWdJQ0FnSUdKdmNtUmxjbTl3WVdOcGRIazlJakV1TUNJS0lDQWdJQ0FnYVc1cmMyTmhjR1U2WTNWeWNtVnVkQzFzWVhsbGNqMGliR0Y1WlhJeElnb2dJQ0FnSUNCcGJtdHpZMkZ3WlRwamVEMGlNekEwTGpnNU5EQTVJZ29nSUNBZ0lDQnBibXR6WTJGd1pUcGplVDBpTXpReExqVXlNVGcySWdvZ0lDQWdJQ0JwYm10elkyRndaVHAzYVc1a2IzY3RkMmxrZEdnOUlqRTJPREFpQ2lBZ0lDQWdJR2x1YTNOallYQmxPbkJoWjJWdmNHRmphWFI1UFNJd0xqQWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9tUnZZM1Z0Wlc1MExYVnVhWFJ6UFNKd2VDSUtJQ0F2UGdvZ0lEeG5DaUFnSUNBZ0lHbGtQU0pzWVhsbGNqRWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9teGhZbVZzUFNKTVlYbGxjaUF4SWdvZ0lDQWdJQ0JwYm10elkyRndaVHBuY205MWNHMXZaR1U5SW14aGVXVnlJZ29nSUNBZ0lDQjBjbUZ1YzJadmNtMDlJblJ5WVc1emJHRjBaU2d3SUMwMk5USXVNellwSWdvZ0lDQWdQZ29nSUNBZ1BHY0tJQ0FnSUNBZ0lDQnBaRDBpWnpFeE5ETXlJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbVY0Y0c5eWRDMTVaSEJwUFNJNU1DSUtJQ0FnSUNBZ0lDQnBibXR6WTJGd1pUcGxlSEJ2Y25RdGVHUndhVDBpT1RBaUNpQWdJQ0FnSUNBZ2RISmhibk5tYjNKdFBTSnRZWFJ5YVhnb01pNDVNRFV4SURBZ01DQXlMamt3TlRFZ0xURXdNREV1T1NBdE56Z3VPVFl4S1NJS0lDQWdJQ0FnUGdvZ0lDQWdJQ0E4Y0dGMGFBb2dJQ0FnSUNBZ0lDQWdhV1E5SW5CaGRHZzNNamMySWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmNuZzlJalV6TGpBek5UY3hNeUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNVBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzYkRvak9UazVPVGs1SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmRIbHdaVDBpWVhKaklnb2dJQ0FnSUNBZ0lDQWdaRDBpYlRNMU5pNDNPU0F6TkRZdU1URmpNQ0F5T1M0eU9URXRNak11TnpRMUlEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJjeTAxTXk0d016WXRNak11TnpRMUxUVXpMakF6TmkwMU15NHdNellnTWpNdU56UTFMVFV6TGpBek5pQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpOaUF5TXk0M05EVWdOVE11TURNMklEVXpMakF6Tm5vaUNpQWdJQ0FnSUNBZ0lDQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVGN6TlRRZ01DQXdJQzQ1TnpNMU5DQXhNakF1TURrZ0xURXlMall5T0NraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJM09DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJHdzZkWEpzS0NOc2FXNWxZWEpIY21Ga2FXVnVkRGcwTVRFcElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZkSGx3WlQwaVlYSmpJZ29nSUNBZ0lDQWdJQ0FnWkQwaWJUTTFOaTQzT1NBek5EWXVNVEZqTUNBeU9TNHlPVEV0TWpNdU56UTFJRFV6TGpBek5pMDFNeTR3TXpZZ05UTXVNRE0yY3kwMU15NHdNell0TWpNdU56UTFMVFV6TGpBek5pMDFNeTR3TXpZZ01qTXVOelExTFRVekxqQXpOaUExTXk0d016WXROVE11TURNMklEVXpMakF6TmlBeU15NDNORFVnTlRNdU1ETTJJRFV6TGpBek5ub2lDaUFnSUNBZ0lDQWdJQ0IwY21GdWMyWnZjbTA5SW0xaGRISnBlQ2d1T1RVNU5qQWdNQ0F3SUM0NU5UazJNQ0F4TWpRdU16TWdMVGN1T0RBeE5Da2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STRNQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiSFJsY2pwMWNtd29JMlpwYkhSbGNqWXhNallwTzJacGJHdzZJMlZqWldObFl5SUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPblI1Y0dVOUltRnlZeUlLSUNBZ0lDQWdJQ0FnSUdROUltMHpOVFl1TnprZ016UTJMakV4WXpBZ01qa3VNamt4TFRJekxqYzBOU0ExTXk0d016WXROVE11TURNMklEVXpMakF6Tm5NdE5UTXVNRE0yTFRJekxqYzBOUzAxTXk0d016WXROVE11TURNMklESXpMamMwTlMwMU15NHdNellnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpZZ01qTXVOelExSURVekxqQXpOaUExTXk0d016WjZJZ29nSUNBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTGpnM016VTFJREFnTUNBdU9EY3pOVFVnTVRVd0xqUTNJREl4TGprNE1Ta2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STRNaUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiSFJsY2pwMWNtd29JMlpwYkhSbGNqWXhNallwTzJacGJHdzZJems1T1RrNU9TSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPblI1Y0dVOUltRnlZeUlLSUNBZ0lDQWdJQ0FnSUdROUltMHpOVFl1TnprZ016UTJMakV4WXpBZ01qa3VNamt4TFRJekxqYzBOU0ExTXk0d016WXROVE11TURNMklEVXpMakF6Tm5NdE5UTXVNRE0yTFRJekxqYzBOUzAxTXk0d016WXROVE11TURNMklESXpMamMwTlMwMU15NHdNellnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpZZ01qTXVOelExSURVekxqQXpOaUExTXk0d016WjZJZ29nSUNBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTGpnek9ETTRJREFnTUNBdU9ETTRNemdnTVRZeExqRTFJRE0wTGpFMU1pa2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STROQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiR3c2ZFhKc0tDTnNhVzVsWVhKSGNtRmthV1Z1ZERnME1UTXBJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2ZEhsd1pUMGlZWEpqSWdvZ0lDQWdJQ0FnSUNBZ1pEMGliVE0xTmk0M09TQXpORFl1TVRGak1DQXlPUzR5T1RFdE1qTXVOelExSURVekxqQXpOaTAxTXk0d016WWdOVE11TURNMmN5MDFNeTR3TXpZdE1qTXVOelExTFRVekxqQXpOaTAxTXk0d016WWdNak11TnpRMUxUVXpMakF6TmlBMU15NHdNell0TlRNdU1ETTJJRFV6TGpBek5pQXlNeTQzTkRVZ05UTXVNRE0ySURVekxqQXpObm9pQ2lBZ0lDQWdJQ0FnSUNCMGNtRnVjMlp2Y20wOUltMWhkSEpwZUNndU9EQTFPRGNnTUNBd0lDNDRNRFU0TnlBeE56RXVNRE1nTkRVdU5EQTFLU0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT21ONVBTSXpORFl1TVRFeU1UZ2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZUQwaU16QXpMamMxSWdvZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0E4Y0dGMGFBb2dJQ0FnSUNBZ0lDQWdhV1E5SW5CaGRHZzNNamcySWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmNuZzlJalV6TGpBek5UY3hNeUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNVBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzYkRwMWNtd29JM0poWkdsaGJFZHlZV1JwWlc1ME9EUXhOU2tpQ2lBZ0lDQWdJQ0FnSUNCemIyUnBjRzlrYVRwMGVYQmxQU0poY21NaUNpQWdJQ0FnSUNBZ0lDQmtQU0p0TXpVMkxqYzVJRE0wTmk0eE1XTXdJREk1TGpJNU1TMHlNeTQzTkRVZ05UTXVNRE0yTFRVekxqQXpOaUExTXk0d016WnpMVFV6TGpBek5pMHlNeTQzTkRVdE5UTXVNRE0yTFRVekxqQXpOaUF5TXk0M05EVXROVE11TURNMklEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJJREl6TGpjME5TQTFNeTR3TXpZZ05UTXVNRE0yZWlJS0lDQWdJQ0FnSUNBZ0lIUnlZVzV6Wm05eWJUMGliV0YwY21sNEtDNDNOVGd5TlNBd0lEQWdMamMxT0RJMUlERTROaTQzTlNBMk15NDVNRFlwSWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzazlJak0wTmk0eE1USXhPQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT21ONFBTSXpNRE11TnpVaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4d1lYUm9DaUFnSUNBZ0lDQWdJQ0JwWkQwaWNHRjBhRGN5T0RnaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWIzQmhZMmwwZVRvdU16RTNOekU3Wm1sc2JEcDFjbXdvSTJ4cGJtVmhja2R5WVdScFpXNTBNVEEwTkRrcElnb2dJQ0FnSUNBZ0lDQWdhVzVyYzJOaGNHVTZZMjl1Ym1WamRHOXlMV04xY25aaGRIVnlaVDBpTUNJS0lDQWdJQ0FnSUNBZ0lHUTlJbTAwTVRRdU9DQXlPRFF1TVRWakxURXpMak16TVNBd0xqTXdNRFk1TFRJMkxqRTROaUEzTGpNMU9DMHpNeTR6TXpZZ01Ua3VOelF5TFRjdU5qa3dNeUF4TXk0ek1pMDJMamN4TXprZ01qa3VNalkySURFdU1UVTBOU0EwTVM0ek16RWdNQzQ0TlRNd05pMHlOaTQxTXpJZ01qRXVNVE15TFRRMkxqVXhOU0EwTmk0ek1qUXRORFV1TURVMElEZ3VNalU0T1NBd0xqUTNPVEEzSURFMkxqQTFOQ0F6TGpJd01ERWdNakl1T0RVNUlEY3VOVGt3T0MwekxqSTFOemd0Tnk0ME5EazRMVGd1T0RFM01TMHhNeTQ1TlRNdE1UWXVNemswTFRFNExqTXlOeTAyTGpRNE5qY3RNeTQzTkRVeExURXpMall5TlMwMUxqUXpPVE10TWpBdU5qQTRMVFV1TWpneE9Ib2lDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHdZWFJvQ2lBZ0lDQWdJQ0FnSUNCcFpEMGljbVZqZERjek56QWlDaUFnSUNBZ0lDQWdJQ0JrUFNKdE5EQXlMamc0SURNd01DNHdPUzB4TVM0MU9ERWdNVEV1TlRneElERXpMakk1TlNBeE15NHlPVFV0TVRNdU1qazFJREV6TGpJNE1TQXhNUzQxT0RFZ01URXVOVGd4SURFekxqSTRNUzB4TXk0eU9UVWdNVE11TWprMUlERXpMakk1TlNBeE1TNDFPREV0TVRFdU5UZ3hMVEV6TGpJNE1TMHhNeTR5T0RFZ01UTXVNamd4TFRFekxqSTVOUzB4TVM0MU9ERXRNVEV1TlRneExURXpMakk1TlNBeE15NHlPREV0TVRNdU1qZ3hMVEV6TGpJNE1Yb2lDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzZEdWeU9uVnliQ2dqWm1sc2RHVnlNVEUwTWpncE8yWnBiR3c2SXpGaE1XRXhZU0lLSUNBZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJtNWxZM1J2Y2kxamRYSjJZWFIxY21VOUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHdZWFJvQ2lBZ0lDQWdJQ0FnSUNCcFpEMGljR0YwYURFd05EVTNJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbVpwYkd3NkkyWm1abVptWmlJS0lDQWdJQ0FnSUNBZ0lHbHVhM05qWVhCbE9tTnZibTVsWTNSdmNpMWpkWEoyWVhSMWNtVTlJakFpQ2lBZ0lDQWdJQ0FnSUNCa1BTSnROREF6TGpRMUlETXdNUzR4TlMweE1TNHdPRGNnTVRFdU1EZzNJREV5TGpjeU9DQXhNaTQzTWpndE1USXVOekk0SURFeUxqY3hOQ0F4TVM0d09EY2dNVEV1TURnM0lERXlMamN4TkMweE1pNDNNamdnTVRJdU56STRJREV5TGpjeU9DQXhNUzR3T0RjdE1URXVNRGczTFRFeUxqY3hOQzB4TWk0M01UUWdNVEl1TnpFMExURXlMamN5T0MweE1TNHdPRGN0TVRFdU1EZzNMVEV5TGpjeU9DQXhNaTQzTVRRdE1USXVOekUwTFRFeUxqY3hOSG9pQ2lBZ0lDQWdJQzgrQ2lBZ0lDQThMMmNLSUNBZ0lENEtJQ0E4TDJjS0lDQStDaUFnUEcxbGRHRmtZWFJoQ2lBZ0lDQStDaUFnSUNBOGNtUm1PbEpFUmdvZ0lDQWdJQ0ErQ2lBZ0lDQWdJRHhqWXpwWGIzSnJDaUFnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHhrWXpwbWIzSnRZWFFLSUNBZ0lDQWdJQ0FnSUQ1cGJXRm5aUzl6ZG1jcmVHMXNQQzlrWXpwbWIzSnRZWFFLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9uUjVjR1VLSUNBZ0lDQWdJQ0FnSUNBZ2NtUm1PbkpsYzI5MWNtTmxQU0pvZEhSd09pOHZjSFZ5YkM1dmNtY3ZaR012WkdOdGFYUjVjR1V2VTNScGJHeEpiV0ZuWlNJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGpZenBzYVdObGJuTmxDaUFnSUNBZ0lDQWdJQ0FnSUhKa1pqcHlaWE52ZFhKalpUMGlhSFIwY0RvdkwyTnlaV0YwYVhabFkyOXRiVzl1Y3k1dmNtY3ZiR2xqWlc1elpYTXZjSFZpYkdsalpHOXRZV2x1THlJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGtZenB3ZFdKc2FYTm9aWElLSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lEeGpZenBCWjJWdWRBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUhKa1pqcGhZbTkxZEQwaWFIUjBjRG92TDI5d1pXNWpiR2x3WVhKMExtOXlaeThpQ2lBZ0lDQWdJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQazl3Wlc1amJHbHdZWEowUEM5a1l6cDBhWFJzWlFvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0E4TDJOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BDOWtZenB3ZFdKc2FYTm9aWElLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBK1pYSnliM0lnWW5WMGRHOXVQQzlrWXpwMGFYUnNaUW9nSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0E4WkdNNlpHRjBaUW9nSUNBZ0lDQWdJQ0FnUGpJd01URXRNREl0TWpSVU1UYzZORFU2TkRVOEwyUmpPbVJoZEdVS0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BHUmpPbVJsYzJOeWFYQjBhVzl1Q2lBZ0lDQWdJQ0FnTHo0S0lDQWdJQ0FnSUNBOFpHTTZjMjkxY21ObENpQWdJQ0FnSUNBZ0lDQSthSFIwY0hNNkx5OXZjR1Z1WTJ4cGNHRnlkQzV2Y21jdlpHVjBZV2xzTHpFeU1qUXlOUzlsY25KdmNpMWlkWFIwYjI0dFlua3RjbWxqWVhKa2IyMWhhV0U4TDJSak9uTnZkWEpqWlFvZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBOFpHTTZZM0psWVhSdmNnb2dJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJQ0FnUEdOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQbkpwWTJGeVpHOXRZV2xoUEM5a1l6cDBhWFJzWlFvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0E4TDJOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BDOWtZenBqY21WaGRHOXlDaUFnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHhrWXpwemRXSnFaV04wQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQThjbVJtT2tKaFp3b2dJQ0FnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnSUNBZ0lEeHlaR1k2YkdrS0lDQWdJQ0FnSUNBZ0lDQWdJQ0ErWW5WMGRHOXVQQzl5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJQ0FnUG1OaGJtTmxiRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSEprWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUQ1amFYSmpiR1U4TDNKa1pqcHNhUW9nSUNBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQWdJRHh5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnSUNBK1pHVnNaWFJsUEM5eVpHWTZiR2tLSUNBZ0lDQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lDQWdJQ0E4Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUNBZ1BuSmxaRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSEprWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUQ1eWIzVnVaRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lEd3ZjbVJtT2tKaFp3b2dJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHd2WkdNNmMzVmlhbVZqZEFvZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnUEM5all6cFhiM0pyQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQR05qT2t4cFkyVnVjMlVLSUNBZ0lDQWdJQ0FnSUhKa1pqcGhZbTkxZEQwaWFIUjBjRG92TDJOeVpXRjBhWFpsWTI5dGJXOXVjeTV2Y21jdmJHbGpaVzV6WlhNdmNIVmliR2xqWkc5dFlXbHVMeUlLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdOak9uQmxjbTFwZEhNS0lDQWdJQ0FnSUNBZ0lDQWdjbVJtT25KbGMyOTFjbU5sUFNKb2RIUndPaTh2WTNKbFlYUnBkbVZqYjIxdGIyNXpMbTl5Wnk5dWN5TlNaWEJ5YjJSMVkzUnBiMjRpQ2lBZ0lDQWdJQ0FnTHo0S0lDQWdJQ0FnSUNBOFkyTTZjR1Z5YldsMGN3b2dJQ0FnSUNBZ0lDQWdJQ0J5WkdZNmNtVnpiM1Z5WTJVOUltaDBkSEE2THk5amNtVmhkR2wyWldOdmJXMXZibk11YjNKbkwyNXpJMFJwYzNSeWFXSjFkR2x2YmlJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGpZenB3WlhKdGFYUnpDaUFnSUNBZ0lDQWdJQ0FnSUhKa1pqcHlaWE52ZFhKalpUMGlhSFIwY0RvdkwyTnlaV0YwYVhabFkyOXRiVzl1Y3k1dmNtY3Zibk1qUkdWeWFYWmhkR2wyWlZkdmNtdHpJZ29nSUNBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHd2WTJNNlRHbGpaVzV6WlFvZ0lDQWdJQ0ErQ2lBZ0lDQThMM0prWmpwU1JFWUtJQ0FnSUQ0S0lDQThMMjFsZEdGa1lYUmhDaUFnUGdvOEwzTjJad28rQ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9lcnJvci1idXR0b24uc3ZnXG4vLyBtb2R1bGUgaWQgPSA3NlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwibWFwcGluZ3MiOiI7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUM3REE7Ozs7Ozs7OztBQ0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7Ozs7Ozs7OztBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUNBO0FBQ0E7QUFQQTtBQUFBO0FBQUE7QUFDQTtBQVdBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQWFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFwQkE7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFoQkE7QUFrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFmQTtBQWlCQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTtBQXFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBUEE7QUE5RkE7QUE2R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpjQTtBQW1jQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUMzeUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFsQkE7QUFvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBalFBO0FBQ0E7QUFtUUE7Ozs7Ozs7Ozs7O0FDblFBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBeFBBO0FBQ0E7QUEyUEE7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNqUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTs7Ozs7Ozs7Ozs7QUNDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTlHQTtBQWdIQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNuSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQTNCQTtBQUNBO0FBNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE1QkE7QUFDQTtBQThCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThEQTs7Ozs7OztBQy9LQTs7Ozs7Ozs7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7OztBQUdBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNwR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEzUEE7QUFDQTtBQTZQQTs7Ozs7Ozs7Ozs7QUM3YUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTtBQUNBO0FBcUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FDdC9DQTs7Ozs7Ozs7O0FDRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTVCQTs7Ozs7Ozs7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaEZBO0FBQ0E7QUFrRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUVBO0FBS0E7QUFFQTtBQUdBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFHQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUF4SEE7Ozs7Ozs7OztBQ3BGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUNBOzs7Ozs7Ozs7QUNDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7Ozs7QUMzQkE7Ozs7Ozs7Ozs7QUNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF0SUE7Ozs7Ozs7O0FDRkE7QUFDQTtBQUVBOzs7Ozs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3BHQTtBQUNBOzs7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEzUUE7Ozs7Ozs7Ozs7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRJQTtBQUNBO0FBd0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQ3hMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTFDQTs7Ozs7Ozs7OztBQ0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF0RUE7QUFDQTtBQXdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1QkE7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyYUE7QUFDQTtBQXVhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF2QkE7QUF5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBTEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBcEJBO0FBc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUxBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQXBCQTtBQXNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBdkZBO0FBaUdBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFXQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBekJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQXlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFKQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFKQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUxBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFNQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBUkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBU0E7QUFWQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBV0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQWJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFPQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbmVBO0FBQ0E7QUFxZUE7QUFDQTtBQURBOzs7Ozs7Ozs7O0FDditCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQU9BO0FBelJBO0FBQ0E7QUEyUkE7QUFDQTtBQURBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkE7QUFDQTtBQUNBO0FBbkVBOzs7Ozs7OztBQ2xTQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUZBO0FBSUE7Ozs7Ozs7Ozs7OztBQVlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTlCQTtBQWlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5U0E7QUFDQTtBQWdUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ25YQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTZFQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBcEdBO0FBQ0E7QUF3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7O0FBR0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUhBO0FBVUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyQ0E7QUF1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTVMQTtBQThMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDMVhBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFIQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBTEE7QUFNQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBL1NBO0FBQ0E7QUFpVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaERBOzs7Ozs7Ozs7O0FDM1RBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTVCQTtBQUNBO0FBK0JBO0FBQ0E7QUFEQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQURBO0FBSkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWEE7QUF4SUE7Ozs7Ozs7Ozs7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBcEJBO0FBQ0E7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVEE7QUFwQkE7QUFDQTtBQXlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBL0JBO0FBREE7QUFDQTtBQXNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBaERBO0FBSEE7QUFzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBSEE7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBSEE7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBakJBO0FBSEE7QUF1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQUhBO0FBeEJBO0FBSEE7QUFtREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBbkNBO0FBcFJBO0FBREE7QUFDQTtBQTRUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBSEE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBaEJBO0FBTEE7QUE0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUE1SEE7QUFEQTtBQUNBO0FBMElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBREE7QUFEQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFEQTtBQURBOzs7Ozs7Ozs7O0FDeGpCQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBSkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpFQTtBQUNBO0FBMkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTs7Ozs7Ozs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdENBO0FBQ0E7QUF3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDeEZBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBcENBOzs7Ozs7Ozs7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFEQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7O0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpEQTs7Ozs7Ozs7OztBQ2xCQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoR0E7QUFDQTtBQWtHQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTlEQTs7Ozs7Ozs7QUN0R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQVhBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFaQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQVhBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBRkE7QUFNQTtBQVBBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBRkE7QUFqQ0E7QUFDQTtBQWtEQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFVQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQWVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7Ozs7Ozs7Ozs7O0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQW5CQTtBQUNBO0FBcUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUF6Q0E7QUEzQkE7QUFEQTtBQTdMQTtBQUNBO0FBdVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUM5ZkE7Ozs7OztBQU9BO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFwR0E7QUFDQTtBQXVHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUExQkE7QUE0QkE7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF0Q0E7QUF3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbE5BO0FBb05BOzs7Ozs7OztBQ2pWQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBRkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQURBO0FBbFJBO0FBMFJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBREE7QUFEQTtBQUNBO0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBREE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTs7OztBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBT0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQUNBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFsQkE7QUFDQTtBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbFhBO0FBQ0E7QUF1WEE7QUFDQTs7Ozs7Ozs7QUMxc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVlBO0FBakJBO0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUZBO0FBcEVBO0FBQ0E7QUF5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF4REE7QUEwREE7Ozs7Ozs7O0FDdElBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpCQTtBQUNBO0FBOEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Ozs7Ozs7O0FDM1BBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQVFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBU0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBREE7QUF4REE7Ozs7Ozs7Ozs7QUNoSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbERBO0FBQ0E7QUFvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFHQTtBQUNBO0FBbkJBO0FBREE7QUFEQTs7Ozs7Ozs7OztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdkRBO0FBQ0E7QUF5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBaEJBO0FBREE7QUFEQTs7Ozs7Ozs7QUM1REE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUdBOzs7Ozs7OztBQ0hBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQS9RQTs7Ozs7Ozs7OztBQ1JBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQWZBO0FBdUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQTFCQTtBQUNBO0FBZ0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFEQTtBQS9WQTs7Ozs7Ozs7OztBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQUE7QUFNQTtBQVJBOzs7Ozs7Ozs7O0FDREE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBN0hBOzs7Ozs7Ozs7O0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL0JBO0FBaUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFJQTtBQTdHQTtBQUNBO0FBZ0hBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBalRBO0FBQ0E7QUFtVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdkNBO0FBQ0E7QUF5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhDQTtBQWtDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUdBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBOWZBO0FBQ0E7QUFraEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUM5OEJBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBS0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQVBBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7O0FBZ0JBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFDQTs7Ozs7QUFLQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaFVBO0FBQ0E7QUFrVUE7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBYkE7QUFKQTs7Ozs7Ozs7OztBQ3ZVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdkRBO0FBQ0E7QUF5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFqREE7QUE5SUE7QUFDQTtBQTZNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFsRkE7Ozs7Ozs7O0FDblNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBaEJBO0FBa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQTFCQTtBQXVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFsRUE7QUFDQTtBQTBFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBZEE7QUFnQkE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFwQkE7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTtBQXFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXhLQTtBQUNBO0FBMEtBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQWpEQTs7Ozs7Ozs7OztBQzlQQTtBQUNBO0FBQ0E7QUFFQTs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUN2SkE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUExQkE7QUFEQTtBQUNBO0FBK0JBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBT0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhRQTtBQUNBO0FBcVFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFEQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBRkE7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFaQTs7Ozs7Ozs7OztBQy9WQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvRUE7QUFDQTtBQWlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWRBO0FBZ0JBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvRkE7Ozs7Ozs7Ozs7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBM0JBOzs7Ozs7OztBQ0RBOzs7O0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF0T0E7Ozs7Ozs7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFDQTtBQVNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBREE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpCQTtBQUNBO0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFGQTtBQUxBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFobEJBO0FBQ0E7QUFrbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUkE7QUFDQTtBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQzdwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFDQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BOzs7Ozs7Ozs7O0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBclJBOzs7Ozs7Ozs7O0FDQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBeEJBO0FBMEJBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQy9CQTs7Ozs7Ozs7OztBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFDQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyTEE7QUF1TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFsQkE7QUFvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF4S0E7QUEwS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZEE7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUJBO0FBQ0E7QUE0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbkJBO0FBcUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQUNBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2ptQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5T0E7Ozs7Ozs7Ozs7QUNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQUNBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFIQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBL0RBO0FBQ0E7QUFrRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNyR0E7Ozs7Ozs7OztBQ0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUhBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE3QkE7QUErQkE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFnQkE7Ozs7Ozs7QUFPQTtBQXJFQTtBQUNBO0FBd0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQTNEQTs7Ozs7Ozs7OztBQ25JQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7Ozs7O0FDaEJBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBU0E7QUFDQTtBQTNDQTtBQUNBO0FBNkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBQ0E7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUJBO0FBNEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQStCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBak5BO0FBQ0E7QUEwTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVpBOzs7Ozs7Ozs7O0FDdlNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBOUJBO0FBQ0E7QUFnQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBcEJBO0FBQ0E7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6Q0E7Ozs7Ozs7Ozs7OztBQ2xCQTs7Ozs7Ozs7Ozs7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFuQkE7QUFEQTtBQUNBO0FBdUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdEZBO0FBeUZBO0FBNUZBO0FBQ0E7QUE4RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFOQTtBQUFBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFYQTtBQUFBO0FBQ0E7QUFDQTtBQWFBO0FBQ0E7QUFoQkE7QUFBQTtBQUNBO0FBQ0E7QUFrQkE7QUFDQTtBQXJCQTtBQUFBO0FBQ0E7QUF3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBekVBO0FBQ0E7QUEyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFIQTtBQUFBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQWRBO0FBQUE7QUFDQTtBQUNBO0FBZ0JBO0FBQ0E7QUFuQkE7QUFBQTtBQUNBO0FBc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUVBO0FBQ0E7QUE0RUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWRBO0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBbkJBO0FBcUJBO0FBQ0E7QUFDQTtBQXZCQTtBQXlCQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBOUJBO0FBZ0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBekNBO0FBMkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvQ0E7QUFpREE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUExR0E7QUE0R0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUF6SEE7QUEySEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQS9IQTtBQWlJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7O0FDbnBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBekJBOzs7Ozs7Ozs7OztBQzNCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFsSUE7QUFvSUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7QUFDQTtBQWxCQTtBQUNBO0FBMEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFoQkE7Ozs7Ozs7OztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFqREE7Ozs7Ozs7OztBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbENBOzs7Ozs7QUNYQTs7O0EiLCJzb3VyY2VSb290IjoiIn0=